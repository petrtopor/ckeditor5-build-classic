{"version":3,"sources":["webpack://ClassicEditor/webpack/universalModuleDefinition","webpack://ClassicEditor/webpack/bootstrap","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/ckeditorerror.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/log.js","webpack://ClassicEditor/./node_modules/style-loader/lib/addStyles.js","webpack://ClassicEditor/./node_modules/lodash-es/_root.js","webpack://ClassicEditor/./node_modules/lodash-es/_nodeUtil.js","webpack://ClassicEditor/./node_modules/lodash-es/isBuffer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/check.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/cancel.svg","webpack://ClassicEditor/./node_modules/lodash-es/_freeGlobal.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/object-right.svg","webpack://ClassicEditor/(webpack)/buildin/harmony-module.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/object-full-width.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/object-left.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/object-center.svg","webpack://ClassicEditor/(webpack)/buildin/global.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/theme/heading.css?a27e","webpack://ClassicEditor/./node_modules/lodash-es/stubFalse.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneBuffer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/theme/icons/undo.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/theme/icons/redo.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/theme/icons/bold.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/theme/icons/italic.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/quote.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ckfinder/theme/icons/browse-files.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/theme/icons/drag-handler.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/low-vision.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/image.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/icons/image_placeholder.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/icons/dropdown-arrow.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/icons/unlink.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/theme/icons/pencil.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/icons/link.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/theme/icons/numberedlist.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/theme/icons/bulletedlist.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/icons/media-placeholder.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/icons/media.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/icons/table.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/icons/table-column.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/icons/table-row.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/icons/table-merge-cell.svg","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/version.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/globals/globals.css?1f37","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/globals/globals.css","webpack://ClassicEditor/./node_modules/style-loader/lib/urls.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/editorui/editorui.css?0a5d","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/editorui/editorui.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/label/label.css?9c0f","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/label/label.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/panel/stickypanel.css?0caa","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/panel/stickypanel.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/toolbar/toolbar.css?8b79","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/toolbar/toolbar.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-editor-classic/theme/classiceditor.css?73ea","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-editor-classic/theme/classiceditor.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/icon/icon.css?8bf2","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/icon/icon.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/tooltip/tooltip.css?5a2e","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/tooltip/tooltip.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/button/button.css?d6ed","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/button/button.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/theme/blockquote.css?d156","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/theme/blockquote.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/theme/widget.css?7391","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/theme/widget.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/labeledinput/labeledinput.css?2c3d","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/labeledinput/labeledinput.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/inputtext/inputtext.css?3d59","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/inputtext/inputtext.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/textalternativeform.css?5c5d","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/textalternativeform.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/panel/balloonpanel.css?31d4","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/panel/balloonpanel.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/image.css?89fc","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/image.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-upload/src/ui/filePickDialogStyle.scss?c09e","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-upload/src/ui/filePickDialogStyle.scss","webpack://ClassicEditor/./node_modules/css-loader/dist/runtime/api.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadprogress.css?8d37","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadprogress.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadicon.css?3de7","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadicon.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadloader.css?d654","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imageuploadloader.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/dropdown.css?d866","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/dropdown.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/list/list.css?2849","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/list/list.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/button/switchbutton.css?fa6e","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/button/switchbutton.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/toolbardropdown.css?dcf3","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/toolbardropdown.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/listdropdown.css?dc17","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/theme/components/dropdown/listdropdown.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/theme/heading.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/theme/placeholder.css?66af","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/theme/placeholder.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imagecaption.css?3c32","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imagecaption.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imagestyle.css?0777","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/theme/imagestyle.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/link.css?2fc5","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/link.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/linkform.css?1bc3","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/linkform.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/linkactions.css?478c","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/theme/linkactions.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaembedediting.css?731f","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaembedediting.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaform.css?3759","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaform.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaembed.css?9309","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/theme/mediaembed.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/tableediting.css?4664","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/tableediting.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/inserttable.css?acc3","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/inserttable.css","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/table.css?95e1","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/theme/table.css","webpack://ClassicEditor/./node_modules/lodash-es/_Symbol.js","webpack://ClassicEditor/./node_modules/lodash-es/_getRawTag.js","webpack://ClassicEditor/./node_modules/lodash-es/_objectToString.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseGetTag.js","webpack://ClassicEditor/./node_modules/lodash-es/_overArg.js","webpack://ClassicEditor/./node_modules/lodash-es/_getPrototype.js","webpack://ClassicEditor/./node_modules/lodash-es/isObjectLike.js","webpack://ClassicEditor/./node_modules/lodash-es/isPlainObject.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/config.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/spy.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/eventinfo.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/uid.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/priorities.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/emittermixin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/mix.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/comparearrays.js","webpack://ClassicEditor/./node_modules/lodash-es/_listCacheClear.js","webpack://ClassicEditor/./node_modules/lodash-es/eq.js","webpack://ClassicEditor/./node_modules/lodash-es/_assocIndexOf.js","webpack://ClassicEditor/./node_modules/lodash-es/_listCacheDelete.js","webpack://ClassicEditor/./node_modules/lodash-es/_listCacheGet.js","webpack://ClassicEditor/./node_modules/lodash-es/_listCacheHas.js","webpack://ClassicEditor/./node_modules/lodash-es/_listCacheSet.js","webpack://ClassicEditor/./node_modules/lodash-es/_ListCache.js","webpack://ClassicEditor/./node_modules/lodash-es/_stackClear.js","webpack://ClassicEditor/./node_modules/lodash-es/_stackDelete.js","webpack://ClassicEditor/./node_modules/lodash-es/_stackGet.js","webpack://ClassicEditor/./node_modules/lodash-es/_stackHas.js","webpack://ClassicEditor/./node_modules/lodash-es/isObject.js","webpack://ClassicEditor/./node_modules/lodash-es/isFunction.js","webpack://ClassicEditor/./node_modules/lodash-es/_coreJsData.js","webpack://ClassicEditor/./node_modules/lodash-es/_isMasked.js","webpack://ClassicEditor/./node_modules/lodash-es/_toSource.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsNative.js","webpack://ClassicEditor/./node_modules/lodash-es/_getValue.js","webpack://ClassicEditor/./node_modules/lodash-es/_getNative.js","webpack://ClassicEditor/./node_modules/lodash-es/_Map.js","webpack://ClassicEditor/./node_modules/lodash-es/_nativeCreate.js","webpack://ClassicEditor/./node_modules/lodash-es/_hashClear.js","webpack://ClassicEditor/./node_modules/lodash-es/_hashDelete.js","webpack://ClassicEditor/./node_modules/lodash-es/_hashGet.js","webpack://ClassicEditor/./node_modules/lodash-es/_hashHas.js","webpack://ClassicEditor/./node_modules/lodash-es/_hashSet.js","webpack://ClassicEditor/./node_modules/lodash-es/_Hash.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapCacheClear.js","webpack://ClassicEditor/./node_modules/lodash-es/_isKeyable.js","webpack://ClassicEditor/./node_modules/lodash-es/_getMapData.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapCacheDelete.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapCacheGet.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapCacheHas.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapCacheSet.js","webpack://ClassicEditor/./node_modules/lodash-es/_MapCache.js","webpack://ClassicEditor/./node_modules/lodash-es/_stackSet.js","webpack://ClassicEditor/./node_modules/lodash-es/_Stack.js","webpack://ClassicEditor/./node_modules/lodash-es/_arrayEach.js","webpack://ClassicEditor/./node_modules/lodash-es/_defineProperty.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseAssignValue.js","webpack://ClassicEditor/./node_modules/lodash-es/_assignValue.js","webpack://ClassicEditor/./node_modules/lodash-es/_copyObject.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseTimes.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsArguments.js","webpack://ClassicEditor/./node_modules/lodash-es/isArguments.js","webpack://ClassicEditor/./node_modules/lodash-es/isArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_isIndex.js","webpack://ClassicEditor/./node_modules/lodash-es/isLength.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsTypedArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseUnary.js","webpack://ClassicEditor/./node_modules/lodash-es/isTypedArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_arrayLikeKeys.js","webpack://ClassicEditor/./node_modules/lodash-es/_isPrototype.js","webpack://ClassicEditor/./node_modules/lodash-es/_nativeKeys.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseKeys.js","webpack://ClassicEditor/./node_modules/lodash-es/isArrayLike.js","webpack://ClassicEditor/./node_modules/lodash-es/keys.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseAssign.js","webpack://ClassicEditor/./node_modules/lodash-es/_nativeKeysIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseKeysIn.js","webpack://ClassicEditor/./node_modules/lodash-es/keysIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseAssignIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_copyArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_arrayFilter.js","webpack://ClassicEditor/./node_modules/lodash-es/stubArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_getSymbols.js","webpack://ClassicEditor/./node_modules/lodash-es/_copySymbols.js","webpack://ClassicEditor/./node_modules/lodash-es/_arrayPush.js","webpack://ClassicEditor/./node_modules/lodash-es/_getSymbolsIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_copySymbolsIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseGetAllKeys.js","webpack://ClassicEditor/./node_modules/lodash-es/_getAllKeys.js","webpack://ClassicEditor/./node_modules/lodash-es/_getAllKeysIn.js","webpack://ClassicEditor/./node_modules/lodash-es/_DataView.js","webpack://ClassicEditor/./node_modules/lodash-es/_Promise.js","webpack://ClassicEditor/./node_modules/lodash-es/_Set.js","webpack://ClassicEditor/./node_modules/lodash-es/_WeakMap.js","webpack://ClassicEditor/./node_modules/lodash-es/_getTag.js","webpack://ClassicEditor/./node_modules/lodash-es/_initCloneArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_Uint8Array.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneArrayBuffer.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneDataView.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneRegExp.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneSymbol.js","webpack://ClassicEditor/./node_modules/lodash-es/_cloneTypedArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_initCloneByTag.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseCreate.js","webpack://ClassicEditor/./node_modules/lodash-es/_initCloneObject.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsMap.js","webpack://ClassicEditor/./node_modules/lodash-es/isMap.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsSet.js","webpack://ClassicEditor/./node_modules/lodash-es/isSet.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseClone.js","webpack://ClassicEditor/./node_modules/lodash-es/clone.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/node.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/text.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/textproxy.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/objecttomap.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/isiterable.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/matcher.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/element.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/containerelement.js","webpack://ClassicEditor/./node_modules/lodash-es/identity.js","webpack://ClassicEditor/./node_modules/lodash-es/_apply.js","webpack://ClassicEditor/./node_modules/lodash-es/_overRest.js","webpack://ClassicEditor/./node_modules/lodash-es/constant.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseSetToString.js","webpack://ClassicEditor/./node_modules/lodash-es/_shortOut.js","webpack://ClassicEditor/./node_modules/lodash-es/_setToString.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseRest.js","webpack://ClassicEditor/./node_modules/lodash-es/_isIterateeCall.js","webpack://ClassicEditor/./node_modules/lodash-es/_createAssigner.js","webpack://ClassicEditor/./node_modules/lodash-es/assignIn.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/observablemixin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/editableelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/rooteditableelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/treewalker.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/position.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/range.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/count.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/selection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/documentselection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/collection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/document.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/attributeelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/emptyelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/env.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/keyboard.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/uielement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/documentfragment.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/downcastwriter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/istext.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/filler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/diff.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/insertat.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/remove.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/isnode.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/fastdiff.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/renderer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/global.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/indexof.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/getancestors.js","webpack://ClassicEditor/./node_modules/lodash-es/isElement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/domconverter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/getcommonancestor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/iswindow.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/emittermixin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/observer.js","webpack://ClassicEditor/./node_modules/lodash-es/_setCacheAdd.js","webpack://ClassicEditor/./node_modules/lodash-es/_setCacheHas.js","webpack://ClassicEditor/./node_modules/lodash-es/_SetCache.js","webpack://ClassicEditor/./node_modules/lodash-es/_arraySome.js","webpack://ClassicEditor/./node_modules/lodash-es/_cacheHas.js","webpack://ClassicEditor/./node_modules/lodash-es/_equalArrays.js","webpack://ClassicEditor/./node_modules/lodash-es/_mapToArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_setToArray.js","webpack://ClassicEditor/./node_modules/lodash-es/_equalByTag.js","webpack://ClassicEditor/./node_modules/lodash-es/_equalObjects.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsEqualDeep.js","webpack://ClassicEditor/./node_modules/lodash-es/_baseIsEqual.js","webpack://ClassicEditor/./node_modules/lodash-es/isEqualWith.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/mutationobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/domeventdata.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/domeventobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/keyobserver.js","webpack://ClassicEditor/./node_modules/lodash-es/now.js","webpack://ClassicEditor/./node_modules/lodash-es/isSymbol.js","webpack://ClassicEditor/./node_modules/lodash-es/toNumber.js","webpack://ClassicEditor/./node_modules/lodash-es/debounce.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/fakeselectionobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/selectionobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/focusobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/compositionobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/isrange.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/getborderwidths.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/rect.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/scroll.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/view.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/tomap.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/node.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/text.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/textproxy.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/nodelist.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/element.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/treewalker.js","webpack://ClassicEditor/./node_modules/lodash-es/last.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/position.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/range.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/mapper.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/modelconsumable.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/downcastdispatcher.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/selection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/liverange.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/documentselection.js","webpack://ClassicEditor/./node_modules/lodash-es/cloneDeep.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/downcast-converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/controller/editingcontroller.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/upcast-selection-converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/downcast-selection-converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/plugincollection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/commandcollection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/translation-service.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/locale.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/viewconsumable.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/schema.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/upcastdispatcher.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/upcast-converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/controller/datacontroller.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/conversion/conversion.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/batch.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/operation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/documentfragment.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/utils.js","webpack://ClassicEditor/./node_modules/lodash-es/isEqual.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/attributeoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/detachoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/moveoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/insertoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/markeroperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/renameoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/rootattributeoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/mergeoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/splitoperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/rootelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/writer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/differ.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/history.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/unicode.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/document.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/markercollection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/liveposition.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/utils/insertcontent.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/utils/deletecontent.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/utils/modifyselection.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/utils/getselectedcontent.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/utils/selection-post-fixer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/model.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/keystrokehandler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editingkeystrokehandler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editor/editor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editor/utils/dataapimixin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editor/utils/elementapimixin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/setdatainelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/dataprocessor/basichtmlwriter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/dataprocessor/htmldataprocessor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/componentfactory.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/focustracker.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editor/editorui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-editor-classic/src/classiceditorui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/toolbar/normalizetoolbarconfig.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/toolbar/enabletoolbarkeyboardfocus.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/viewcollection.js","webpack://ClassicEditor/./node_modules/lodash-es/cloneDeepWith.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/template.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/view.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/editorui/editoruiview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/label/labelview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/editorui/boxed/boxededitoruiview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/editableui/editableuiview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/editableui/inline/inlineeditableuiview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/tounit.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/panel/sticky/stickypanelview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/focuscycler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarseparatorview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/bindings/preventdefault.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-editor-classic/src/classiceditoruiview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/elementreplacer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-editor-classic/src/classiceditor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/editor/utils/attachtoform.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/getdatafromelement.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/plugin.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/datatransfer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/clipboardobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/utils/viewtoplaintext.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/clipboard.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/utils/normalizeclipboarddata.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-clipboard/src/utils/plaintexttohtml.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/command.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-enter/src/entercommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-enter/src/enterobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-enter/src/enter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-enter/src/shiftentercommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-enter/src/shiftenter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/utils/changebuffer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/inputcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/utils/injectunsafekeystrokeshandling.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/utils/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/difftochanges.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/input.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/deletecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/deleteobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/utils/injectandroidbackspacemutationshandling.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/delete.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-typing/src/typing.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/nooperation.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/model/operation/transform.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/basecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/undocommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/redocommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/undoediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/icon/iconview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/tooltip/tooltipview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/button/buttonview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/undoui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-undo/src/undo.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-core/src/pendingactions.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-upload/src/filereader.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-upload/src/filerepository.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-adapter-ckfinder/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-adapter-ckfinder/src/uploadadapter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-autoformat/src/blockautoformatediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-autoformat/src/inlineautoformatediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/attributecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/bold/boldediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/bold/boldui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/italic/italicediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/italic/italicui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/first.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/src/blockquotecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/src/blockquoteediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/src/blockquoteui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ckfinder/src/ckfinderui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/notification/notification.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ckfinder/src/ckfindercommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ckfinder/src/ckfinderediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor-cloud-services-core/src/uploadgateway/fileuploader.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor-cloud-services-core/src/token/token.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-cloud-services/src/cloudservices.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-easy-image/src/cloudservicesuploadadapter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor-cloud-services-core/src/uploadgateway/uploadgateway.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/imageloadobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/src/highlightstack.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/imageinsertcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/imageediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/mouseobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/src/widget.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativeediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/bindings/clickoutsidehandler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/labeledinput/labeledinputview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/inputtext/inputtextview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/bindings/submithandler.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetextalternative/ui/textalternativeformview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/position.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-utils/src/dom/getpositionedancestor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/panel/balloon/balloonpanelview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image/ui/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativeui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetextalternative.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/image.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-upload/src/ui/filedialogbuttonview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload/imageuploadui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload/imageuploadprogress.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/upcastwriter.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload/imageuploadcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload/imageuploadediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imageupload.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paragraph/src/paragraphcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paragraph/src/paragraph.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/src/headingcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/src/headingediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/model.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/dropdown/dropdownpanelview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/dropdown/dropdownview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/dropdown/button/dropdownbuttonview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/list/listview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/list/listitemview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/list/listseparatorview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/button/switchbuttonview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ui/src/dropdown/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/src/headingui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/placeholder.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagecaption/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagecaption/imagecaptionediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle/imagestylecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle/converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle/imagestyleediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle/imagestyleui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-widget/src/widgettoolbarrepository.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/findlinkrange.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/linkcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/unlinkcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/utils/bindtwostepcarettoattribute.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/linkediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-engine/src/view/observer/clickobserver.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/ui/linkformview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/ui/linkactionsview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/linkui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/listcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/indentcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/listediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/listui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/converters.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/mediaembedcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/mediaregistry.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/mediaembedediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/automediaembed.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/ui/mediaformview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/mediaembedui.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paste-from-office/src/filters/space.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paste-from-office/src/filters/parse.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paste-from-office/src/filters/list.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paste-from-office/src/filters/image.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/converters/upcasttable.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/tablewalker.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/utils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/converters/downcast.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/tableutils.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/inserttablecommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/insertrowcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/insertcolumncommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/splitcellcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/mergecellcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/removerowcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/removecolumncommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/setheaderrowcommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/commands/setheadercolumncommand.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/converters/table-layout-post-fixer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/converters/table-cell-content-post-fixer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/converters/tablecell-post-fixer.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/tableediting.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/ui/inserttableview.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/tableui.js","webpack://ClassicEditor/./src/ckeditor.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-essentials/src/essentials.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-autoformat/src/autoformat.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/bold.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-basic-styles/src/italic.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-block-quote/src/blockquote.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-ckfinder/src/ckfinder.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-easy-image/src/easyimage.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-heading/src/heading.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagecaption.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagestyle.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-image/src/imagetoolbar.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-link/src/link.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-list/src/list.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-media-embed/src/mediaembed.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-paste-from-office/src/pastefromoffice.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/table.js","webpack://ClassicEditor/./node_modules/@ckeditor/ckeditor5-table/src/tabletoolbar.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","CKEditorError","attachLinkToDocumentation","DOCUMENTATION_URL","Error","[object Object]","message","data","JSON","stringify","super","this","error","matchedErrorName","match","_ckeditorerror__WEBPACK_IMPORTED_MODULE_0__","log","console","warn","stylesInDom","isOldIE","fn","memo","apply","arguments","memoize","document","all","atob","getElement","target","parent","styleTarget","querySelector","HTMLIFrameElement","contentDocument","head","e","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","addStylesToDom","styles","options","length","item","domStyle","id","refs","j","parts","push","addStyle","listToStyles","list","newStyles","base","part","css","media","sourceMap","insertStyleElement","style","insertInto","lastStyleElementInsertedAtTop","insertAt","nextSibling","insertBefore","appendChild","firstChild","before","removeStyleElement","parentNode","removeChild","idx","indexOf","splice","createStyleElement","createElement","undefined","attrs","type","nonce","nc","getNonce","addAttrs","el","keys","forEach","setAttribute","obj","update","remove","result","transform","default","styleIndex","applyToSingletonTag","URL","createObjectURL","revokeObjectURL","Blob","btoa","link","rel","createLinkElement","autoFixUrls","convertToAbsoluteUrls","unescape","encodeURIComponent","blob","oldSrc","href","styleSheet","cssText","createTextNode","newObj","DEBUG","newList","mayRemove","replaceText","textStore","index","replacement","filter","Boolean","join","cssNode","childNodes","_freeGlobal_js__WEBPACK_IMPORTED_MODULE_0__","freeSelf","self","Function","freeExports","nodeType","freeModule","freeProcess","process","nodeUtil","types","require","binding","_root_js__WEBPACK_IMPORTED_MODULE_0__","_stubFalse_js__WEBPACK_IMPORTED_MODULE_1__","Buffer","isBuffer","global","freeGlobal","originalModule","webpackPolyfill","children","g","content","hmr","locals","allocUnsafe","buffer","isDeep","slice","constructor","copy","_log__WEBPACK_IMPORTED_MODULE_0__","ckeditor5_package_json__WEBPACK_IMPORTED_MODULE_1__","windowOrGlobal","CKEDITOR_VERSION","collidingVersion","version","location","baseUrl","protocol","host","currentDir","pathname","replace","fullMatch","origUrl","newUrl","unquotedOrigUrl","trim","$1","test","useSourceMap","toString","map","cssMapping","sourceMapping","toComment","sourceURLs","sources","source","sourceRoot","concat","cssWithMappingToString","mediaQuery","alreadyImportedModules","_Symbol","_root","objectProto","_getRawTag_hasOwnProperty","nativeObjectToString","symToStringTag","_getRawTag","isOwn","tag","unmasked","_objectToString_nativeObjectToString","_objectToString","nullTag","undefinedTag","_baseGetTag_symToStringTag","_baseGetTag","_overArg","func","arg","_getPrototype","getPrototypeOf","lodash_es_isObjectLike","objectTag","funcProto","isPlainObject_objectProto","funcToString","isPlainObject_hasOwnProperty","objectCtorString","lodash_es_isPlainObject","proto","Ctor","config_Config","configurations","defaultConfigurations","_config","_setObjectToTarget","_setToTarget","_getFromSource","isDefine","split","pop","configuration","src_spy","spy","called","eventinfo_EventInfo","path","stop","off","uid_uid","uuid","Math","floor","random","substring","src_priorities","priority","normal","highest","high","low","lowest","_listeningTo","_emitterId","emittermixin","event","callback","listenTo","args","stopListening","emitter","emitterInfo","eventCallbacks","emitters","_getEmitterId","_setEmitterId","emitterId","callbacks","eventName","events","getEvents","childEventName","newEventNodes","childEvents","substr","lastIndexOf","node","createEventNamespace","lists","getCallbacksListsForNamespace","callbackDefinition","added","removeCallback","eventOrInfo","eventInfo","getCallbacksForEvent","_events","callbackArgs","Array","from","_delegations","destinations","passAllDestinations","fireDelegatedEvents","return","to","nameOrFunction","Map","set","delete","clear","eventNode","callbacksLists","childCallbacksLists","fireArgs","delegatedInfo","fire","mix","baseClass","mixins","mixin","getOwnPropertyNames","getOwnPropertySymbols","sourceDescriptor","getOwnPropertyDescriptor","compareArrays","a","b","minLen","min","_listCacheClear","__data__","size","lodash_es_eq","other","_assocIndexOf","array","_listCacheDelete","_listCacheGet","_listCacheHas","_listCacheSet","ListCache","entries","entry","has","_ListCache","_stackClear","_stackDelete","_stackGet","_stackHas","lodash_es_isObject","asyncTag","funcTag","genTag","proxyTag","lodash_es_isFunction","_coreJsData","maskSrcKey","uid","exec","IE_PROTO","_isMasked","_toSource_funcToString","_toSource","reIsHostCtor","_baseIsNative_funcProto","_baseIsNative_objectProto","_baseIsNative_funcToString","_baseIsNative_hasOwnProperty","reIsNative","RegExp","_baseIsNative","_getValue","_getNative","_Map","_nativeCreate","_hashClear","_hashDelete","HASH_UNDEFINED","_hashGet_hasOwnProperty","_hashGet","_hashHas_hasOwnProperty","_hashHas","_hashSet_HASH_UNDEFINED","_hashSet","Hash","_Hash","_mapCacheClear","hash","string","_isKeyable","_getMapData","_mapCacheDelete","_mapCacheGet","_mapCacheHas","_mapCacheSet","MapCache","_MapCache","LARGE_ARRAY_SIZE","_stackSet","pairs","Stack","_Stack","_arrayEach","iteratee","_defineProperty","_baseAssignValue","configurable","writable","_assignValue_hasOwnProperty","_assignValue","objValue","_copyObject","props","customizer","isNew","newValue","_baseTimes","argsTag","_baseIsArguments","isArguments_objectProto","isArguments_hasOwnProperty","propertyIsEnumerable","lodash_es_isArguments","lodash_es_isArray","isArray","MAX_SAFE_INTEGER","reIsUint","_isIndex","isLength_MAX_SAFE_INTEGER","lodash_es_isLength","typedArrayTags","_baseIsTypedArray","_baseUnary","nodeIsTypedArray","_nodeUtil","isTypedArray","lodash_es_isTypedArray","_arrayLikeKeys_hasOwnProperty","_arrayLikeKeys","inherited","isArr","isArg","isBuff","isType","skipIndexes","String","_isPrototype_objectProto","_isPrototype","_nativeKeys","_baseKeys_hasOwnProperty","_baseKeys","lodash_es_isArrayLike","lodash_es_keys","_baseAssign","_nativeKeysIn","_baseKeysIn_hasOwnProperty","_baseKeysIn","isProto","lodash_es_keysIn","_baseAssignIn","_copyArray","_arrayFilter","predicate","resIndex","lodash_es_stubArray","_getSymbols_propertyIsEnumerable","nativeGetSymbols","_getSymbols","symbol","_copySymbols","_arrayPush","values","offset","_getSymbolsIn","_copySymbolsIn","_baseGetAllKeys","keysFunc","symbolsFunc","_getAllKeys","_getAllKeysIn","_DataView","_Promise","_Set","_WeakMap","dataViewCtorString","mapCtorString","promiseCtorString","setCtorString","weakMapCtorString","getTag","ArrayBuffer","resolve","ctorString","_getTag","_initCloneArray_hasOwnProperty","_initCloneArray","input","_Uint8Array","Uint8Array","_cloneArrayBuffer","arrayBuffer","byteLength","_cloneDataView","dataView","byteOffset","reFlags","_cloneRegExp","regexp","lastIndex","symbolProto","symbolValueOf","valueOf","_cloneSymbol","_cloneTypedArray","typedArray","_initCloneByTag_boolTag","_initCloneByTag_dateTag","_initCloneByTag_mapTag","_initCloneByTag_numberTag","_initCloneByTag_regexpTag","_initCloneByTag_setTag","_initCloneByTag_stringTag","symbolTag","_initCloneByTag_arrayBufferTag","_initCloneByTag_dataViewTag","_initCloneByTag_float32Tag","_initCloneByTag_float64Tag","_initCloneByTag_int8Tag","_initCloneByTag_int16Tag","_initCloneByTag_int32Tag","_initCloneByTag_uint8Tag","_initCloneByTag_uint8ClampedTag","_initCloneByTag_uint16Tag","_initCloneByTag_uint32Tag","_initCloneByTag","objectCreate","_baseCreate","_initCloneObject","_baseIsMap_mapTag","_baseIsMap","nodeIsMap","isMap","lodash_es_isMap","_baseIsSet_setTag","_baseIsSet","nodeIsSet","isSet","lodash_es_isSet","CLONE_DEEP_FLAG","CLONE_FLAT_FLAG","CLONE_SYMBOLS_FLAG","_baseClone_argsTag","_baseClone_funcTag","_baseClone_genTag","_baseClone_objectTag","cloneableTags","_baseClone","baseClone","bitmask","stack","isFlat","isFull","isFunc","_cloneBuffer","stacked","subValue","add","keysIn","clone_CLONE_SYMBOLS_FLAG","lodash_es_clone","node_Node","pos","getChildIndex","ckeditorerror","getChild","previousSibling","unshift","includeSelf","parentFirst","ancestors","ancestorsA","getAncestors","ancestorsB","thisPath","getPath","nodePath","isBefore","_removeChildren","_fireChange","json","text_Text","_textData","is","_data","otherNode","textproxy_TextProxy","textNode","offsetInText","offsetSize","isPartial","objectToMap","isIterable","iterator","Matcher","pattern","_patterns","classes","element","singleElement","isElementMatching","results","matchName","attributes","patterns","hasAttribute","attribute","getAttribute","matchAttributes","getClassNames","hasClass","matchClasses","hasStyle","getStyle","matchStyles","element_Element","_attrs","parseAttributes","_children","_insertChild","_classes","Set","classString","parseClasses","_styles","parseInlineStyles","_customProperties","childCount","isEmpty","styleString","otherElement","className","matcher","sort","deep","childrenClone","child","getChildren","_clone","cloned","getFillerOffset","items","count","nodes","normalize","_remove","howMany","stylesMap","stylesString","quoteType","propertyNameStart","propertyValueStart","propertyName","charAt","char","propertyValue","classesSet","classesString","classArray","containerelement_ContainerElement","lastChild","lodash_es_identity","_apply","thisArg","nativeMax","max","_overRest","start","otherArgs","lodash_es_constant","_baseSetToString","HOT_COUNT","HOT_SPAN","nativeNow","Date","now","_setToString","lastCalled","stamp","remaining","_shortOut","_baseRest","_isIterateeCall","lodash_es_assignIn","assigner","guard","_createAssigner","observablePropertiesSymbol","boundObservablesSymbol","boundPropertiesSymbol","ObservableMixin","initObservable","properties","oldValue","bindProperties","isStringArray","boundProperties","bindings","bindTo","toMany","bindToMany","_observable","_bindProperties","_to","_bindings","unbindProperties","boundObservables","toObservable","toProperty","toProperties","toPropertyBindings","boundObservable","methodName","originalMethod","on","evt","observablemixin","observable","parsedArgs","parsed","lastObservable","parseBindToArgs","bindingsKeys","numberOfBindings","toBindings","updateBoundObservableProperty","attachBindToListeners","chain","toPropertyName","bindingsToObservable","updateBoundObservables","updateBindToBound","observables","observableAndAttributePairs","getBindingTargets","arr","every","documentSymbol","editableelement_EditableElement","getCustomProperty","_document","_setCustomProperty","isFocused","selection","editableElement","rootNameSymbol","rooteditableelement_RootEditableElement","rootName","_name","treewalker_TreeWalker","boundaries","startPosition","direction","position","position_Position","_createAt","singleCharacters","shallow","ignoreElementEnd","_boundaryStartParent","_boundaryEndParent","end","skip","done","prevPosition","next","_next","_previous","clone","previousPosition","isAtEnd","_createAfter","_formatReturnValue","charactersCount","textLength","textProxy","isAtStart","_createBefore","startOffset","nextPosition","isEqual","nodeAfter","nodeBefore","endOffset","editable","shift","shifted","treeWalker","otherPosition","compareWith","otherPath","itemOrPosition","range_Range","isCollapsed","getLastMatchingPosition","enlargeTrimSkip","isAfter","nodeAfterStart","nodeBeforeEnd","otherRange","loose","containsStart","containsPosition","containsEnd","ranges","isIntersecting","commonRangeStart","commonRangeEnd","getCommonAncestor","startElement","endElement","getShiftedBy","_createFromParentsAndOffsets","_createFromPositionAndShift","count_count","_","selection_Selection","selectable","placeOrOffset","_ranges","_lastRangeBackward","_isFake","_fakeSelectionLabel","setTo","isFake","fakeSelectionLabel","anchor","range","focus","rangeCount","isBackward","first","last","firstRange","getFirstRange","lastRange","getLastRange","otherSelection","thisRange","found","numOfRangesA","getRanges","rangeA","getTrimmed","rangeB","_setRanges","_setFakeOptions","documentselection_DocumentSelection","fake","label","backward","_createIn","_createOn","newFocus","_addRange","newRanges","isLastBackward","_pushRange","storedRange","addedRange","intersectingRange","_selection","delegate","getFirstPosition","getLastPosition","getSelectedElement","isSimilar","setFocus","collection_Collection","_items","_itemMap","_idProperty","idProperty","_bindToExternalToInternalMap","WeakMap","_bindToInternalToExternalMap","_skippedIndexesFromExternal","itemId","idOrIndex","idOrItem","subject","itemDoesNotExist","externalItem","ctx","find","_bindToCollection","externalCollection","as","Class","_setUpBindToBinding","using","callbackOrProperty","addItem","isExternalBoundToThis","externalItemBound","finalIndex","skipped","getIndex","reduce","document_Document","roots","_postFixers","postFixer","writer","wasFixed","DEFAULT_PRIORITY","attributeelement_AttributeElement","attributeelement_getFillerOffset","_priority","_id","_clonesGroup","nonUiChildrenCount","emptyelement_EmptyElement","emptyelement_getFillerOffset","userAgent","navigator","toLowerCase","src_env","isMac","isEdge","isGecko","macGlyphsToModifiers","⌘","⇧","⌥","modifiersToMacGlyphs","ctrl","alt","keyCodes","arrowleft","arrowup","arrowright","arrowdown","backspace","enter","space","esc","tab","cmd","code","letter","fromCharCode","generateKnownKeyCodes","getCode","keyCode","altKey","ctrlKey","shiftKey","parseKeystroke","keystroke","splitKeystrokeText","sum","uielement_UIElement","uielement_getFillerOffset","domDocument","toDomElement","domElement","getAttributeKeys","injectUiElementHandling","view","domConverter","domSelection","domTarget","ownerDocument","defaultView","getSelection","domSelectionCollapsed","getRangeAt","collapsed","domParent","focusNode","domOffset","focusOffset","viewPosition","domPositionToView","jumpedOverAnyUiElement","nextViewPosition","newDomPosition","viewPositionToDom","collapse","extend","jumpOverUiElement","documentfragment_DocumentFragment","documentfragment_normalize","downcastwriter_DowncastWriter","_cloneGroups","_setTo","_setFocus","attributeElement","renderFunction","uiElement","render","_setAttribute","_removeAttribute","_addClass","_removeClass","_setStyle","_removeStyle","_removeCustomProperty","positionOrRange","_breakAttributes","_breakAttributesRange","newElement","insert","sourceRange","targetPosition","move","positionOffset","positionParent","_removeFromClonedElementsGroup","mergeAttributes","mergeTextNodes","_appendChild","prev","newPosition","validateNodesToInsert","validNodesToInsert","some","validNode","container","getParentContainer","insertionPosition","_addToClonedElementsGroup","endPosition","rangeOrItem","validateRangeContainer","breakStart","breakEnd","parentContainer","removed","mergePosition","walker","getWalker","current","rangeToRemove","parentElement","ancestor","countBefore","_hasNonUiChildren","_wrapPosition","viewSelection","setSelection","_wrapRange","_unwrapAttributeElement","newRange","_unwrapChildren","newName","viewElement","getAttributes","groupName","wrapPositions","isText","isAttribute","isUI","shouldABeOutsideB","newAttribute","_wrapChildren","offsetChange","unwrapPositions","unwrapped","rangeSpansOnAllChildren","_wrapAttributeElement","unwrappedRange","movePositionToTextNode","breakTextNode","fakePosition","createAttributeElement","Number","POSITIVE_INFINITY","wrapRange","wrap","wrapper","toWrap","canBeJoined","getStyleNames","setStyle","addClass","toUnwrap","removeAttribute","removeClass","removeStyle","forceSplitText","rangeStart","rangeEnd","isContainerOrFragment","offsetAfter","clonedNode","nodesToMove","group","getIdentity","textToMove","t1","t2","nodeBeforeLength","startContainer","endContainer","istext_isText","BR_FILLER","fillerBr","dataset","ckeFiller","NBSP_FILLER","INLINE_FILLER_LENGTH","INLINE_FILLER","startsWithFiller","domNode","isInlineFiller","domText","getDataWithoutFiller","templateBlockFillers","isBlockFiller","blockFiller","templateBlockFiller","isEqualNode","jumpOverInlineFiller","diff_diff","cmp","_insert","_delete","tmp","delta","es","fp","snake","k","y1","y2","dir","y","x","insertat_insertAt","nodeToInsert","remove_remove","isNode","Document","Node","fastDiff","oldText","newText","changeIndexes","firstIndex","lastIndexOld","lastIndexNew","changeIndexesToChanges","findFirstDifferenceIndex","oldTextReversed","cutAndReverse","newTextReversed","findChangeBoundaryIndexes","text","reverse","renderer_Renderer","domDocuments","markedAttributes","markedChildren","markedTexts","_inlineFiller","_fakeSelectionContainer","mapViewToDom","inlineFillerPosition","_updateChildrenMappings","_isSelectionInInlineFiller","_removeInlineFiller","_getInlineFillerPosition","_needsInlineFillerAtSelection","_updateAttrs","_updateChildren","_updateText","fillerDomPosition","addInlineFiller","_updateSelection","_updateFocus","actualDomChildren","expectedDomChildren","viewChildrenToDom","withChildren","diff","_diffNodeLists","actions","_findReplaceActions","counter","equal","action","insertIndex","deleteIndex","viewChild","_updateElementMappings","unbindDomElement","bindElements","firstPos","selectionPosition","domFillerNode","selectionParent","selectionOffset","findAncestor","isEditable","viewText","findCorrespondingDomText","newDomText","viewToDom","actualText","expectedText","filler","insertData","deleteData","domAttrKeys","attr","viewAttrKeys","nodesToUnbind","_markDescendantTextToSync","domToView","actualDomChild","expectedDomChild","actualDom","expectedDom","newActions","actualSlice","expectedSlice","areSimilar","viewNode","_removeDomSelection","_removeFakeSelection","domRoot","_updateFakeSelection","_updateDomSelection","assign","top","left","width","domRange","createRange","removeAllRanges","selectNodeContents","addRange","bindFakeSelection","_domSelectionNeedsUpdate","ELEMENT_NODE","childAtOffset","tagName","fixGeckoSelectionAfterBr","isDomSelectionCorrect","oldViewSelection","domSelectionToView","doc","activeDomElement","activeElement","mapDomToView","domParentOrArray","nodeAfterFiller","fillerNode","node1","node2","DOCUMENT_NODE","lodash_es_isElement","domconverter_DomConverter","preElements","blockElements","_domToViewMapping","_viewToDomMapping","_fakeSelectionMapping","viewDocumentSelection","domFragment","viewFragment","textData","_processDataFromViewText","createDocumentFragment","bindDocumentFragments","fillerPositionOffset","childView","viewRange","domStart","domEnd","setStart","setEnd","viewParent","domBefore","domAfter","getParentUIElement","_processDataFromDomText","isComment","isDocumentFragment","viewName","keepOriginalCase","domChildrenToView","domChild","fakeSelectionToView","isDomSelectionBackward","viewRanges","domRangeToView","viewStart","viewEnd","findCorrespondingViewText","viewBefore","domElementOrDocumentFragment","isElement","documentFragmentOrElement","viewEditable","domEditable","scrollX","scrollY","scrollPositions","forEachDomNodeAncestor","scrollLeft","scrollTop","scrollTo","DOCUMENT_FRAGMENT_NODE","COMMENT_NODE","anchorNode","anchorOffset","detach","_isDomSelectionPositionCorrect","includes","prevNode","_getTouchingViewTextNode","_nodeEndsWithSpace","_hasDomParentOfType","_getTouchingInlineDomNode","nextNode","shouldLeftTrim","_checkShouldLeftTrimDomText","shouldRightTrim","_checkShouldRightTrimDomText","Text","getNext","topmostParent","createTreeWalker","NodeFilter","SHOW_TEXT","SHOW_ELEMENT","acceptNode","FILTER_ACCEPT","FILTER_SKIP","currentNode","touchingNode","lca","nodeA","nodeB","boundaryParent","parents","isWindow","stringifiedObject","dom_emittermixin","rest","proxy","_getProxyEmitter","emittermixin_ProxyEmitter","attach","listeningEmitter","listenedToEmitterId","_getEmitterListenedTo","getNodeUID","_domNode","_domListeners","domListener","_createDomListener","useCapture","addEventListener","removeListener","domEvt","removeEventListener","Observer","isEnabled","disable","_setCacheAdd_HASH_UNDEFINED","_setCacheAdd","_setCacheHas","SetCache","_SetCache","_arraySome","_cacheHas","cache","COMPARE_PARTIAL_FLAG","COMPARE_UNORDERED_FLAG","_equalArrays","equalFunc","arrLength","othLength","seen","arrValue","othValue","compared","othIndex","_mapToArray","_setToArray","_equalByTag_COMPARE_PARTIAL_FLAG","_equalByTag_COMPARE_UNORDERED_FLAG","_equalByTag_boolTag","_equalByTag_dateTag","_equalByTag_errorTag","_equalByTag_mapTag","_equalByTag_numberTag","_equalByTag_regexpTag","_equalByTag_setTag","_equalByTag_stringTag","_equalByTag_symbolTag","_equalByTag_arrayBufferTag","_equalByTag_dataViewTag","_equalByTag_symbolProto","_equalByTag_symbolValueOf","_equalByTag","convert","_equalObjects_COMPARE_PARTIAL_FLAG","_equalObjects_hasOwnProperty","_equalObjects","objProps","objLength","skipCtor","objCtor","othCtor","_baseIsEqualDeep_COMPARE_PARTIAL_FLAG","_baseIsEqualDeep_argsTag","_baseIsEqualDeep_arrayTag","_baseIsEqualDeep_objectTag","_baseIsEqualDeep_hasOwnProperty","_baseIsEqualDeep","objIsArr","othIsArr","objTag","othTag","objIsObj","othIsObj","isSameTag","objIsWrapped","othIsWrapped","objUnwrapped","othUnwrapped","_baseIsEqual","baseIsEqual","lodash_es_isEqualWith","mutationobserver_MutationObserver","childList","characterData","characterDataOldValue","subtree","renderer","_renderer","_domElements","_mutationObserver","MutationObserver","_onMutations","takeRecords","observe","enable","disconnect","destroy","domMutations","mutatedTexts","mutatedElements","mutation","_isBogusBrMutation","viewMutations","mutatedText","markToSync","viewChildren","newViewChildren","sameNodes","oldChildren","newChildren","viewSelectionAnchor","viewSelectionFocus","child1","child2","addedNode","removedNodes","addedNodes","domeventdata_DomEventData","domEvent","additionalData","preventDefault","stopPropagation","domeventobserver_DomEventObserver","domEventType","onDomEvent","eventType","keyobserver_KeyObserver","metaKey","lodash_es_now","isSymbol_symbolTag","lodash_es_isSymbol","NAN","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","lodash_es_toNumber","isBinary","FUNC_ERROR_TEXT","debounce_nativeMax","nativeMin","lodash_es_debounce","wait","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","timeWaiting","remainingWait","debounced","isInvoking","leadingEdge","cancel","clearTimeout","flush","fakeselectionobserver_FakeSelectionObserver","_fireSelectionChangeDoneDebounced","_isArrowKeyCode","_handleSelectionMove","newSelection","oldSelection","selectionobserver_SelectionObserver","mutationObserver","getObserver","_documents","WeakSet","_clearInfiniteLoopInterval","setInterval","_clearInfiniteLoop","_loopbackCounter","_handleSelectionChange","clearInterval","isReadOnly","newViewSelection","focusobserver_FocusObserver","_renderTimeoutId","selectedEditable","compositionobserver_CompositionObserver","isComposing","isRange","getBorderWidths","getComputedStyle","borderTopWidth","right","borderRightWidth","bottom","borderBottomWidth","borderLeftWidth","rectProperties","rect_Rect","isSourceRange","_source","sourceNode","body","contains","copyRectProperties","getDomRangeRects","getBoundingClientRect","innerWidth","innerHeight","height","anotherRect","rect","getIntersection","getArea","visibleRect","isBody","commonAncestorContainer","parentRect","intersectionRect","prop","intersectRect","scrollBarWidth","scrollBarHeight","documentElement","clientWidth","clientHeight","borderWidths","offsetWidth","offsetHeight","moveBy","rects","clientRects","getClientRects","elementOrRange","scrollViewportToShowTarget","viewportOffset","targetWindow","getWindow","currentWindow","currentFrame","firstAncestorToScroll","scrollAncestorsToShowRect","getParentElement","getRectRelativeToWindow","targetRect","scrollWindowToShowRect","frameElement","targetShiftedDownRect","targetShiftedUpRect","viewportRect","excludeScrollbarsAndBorders","isAbove","isBelow","isLeftOf","isRightOf","getRect","parentWindow","firstRect","secondRect","relativeWindow","frame","frameRect","scrollAncestorsToShowTarget","view_View","domRoots","_observers","_ongoingChange","_renderingInProgress","_postFixersInProgress","_renderingDisabled","_writer","addObserver","injectQuirksHandling","_render","viewRoot","getRoot","observer","viewRangeToDom","callbackResult","_callPostFixers","change","disableObservers","enableObservers","toMap","model_node_Node","getChildStartOffset","model_text_Text","toJSON","model_textproxy_TextProxy","nodelist_NodeList","_nodes","_insertNodes","maxOffset","getNodeIndex","getNodeStartOffset","totalOffset","nodeList","indexStart","model_element_Element","getNode","offsetToIndex","relativePath","element_normalize","_removeNodes","fromJSON","model_treewalker_TreeWalker","model_position_Position","stickiness","_visitedParent","prevVisitedParent","formatReturnValue","offsetInTextNode","lodash_es_last","newOffset","diffAt","leftParent","getParentPath","operation","_getTransformedByInsertOperation","_getTransformedByMoveOperation","_getTransformedBySplitOperation","_getTransformedByMergeOperation","_getTransformedByInsertion","_getTransformedByMove","sourcePosition","movedRange","_getCombined","splitPosition","moveTargetPosition","graveyardPosition","_getTransformedByDeletion","deletionPosition","deletePosition","transformed","insertPosition","combined","graveyard","model_range_Range","getCommonPath","posParent","operations","getTransformedByOperation","containsRange","spread","newPos","moveRange","differenceSet","getDifference","difference","common","transformedCommon","newStart","newEnd","ref","refIndex","mapper_Mapper","_modelToViewMapping","_viewToModelMapping","_viewToModelLengthCallbacks","_markerNameToElements","viewContainer","modelPosition","_findPositionIn","viewBlock","modelParent","modelOffset","_toModelOffset","modelElement","toModelElement","toViewElement","elements","toModelPosition","modelRange","toViewPosition","mapper","isPhantom","boundElements","getElementsWithSameId","viewElementName","lengthCallback","viewOffset","getModelLength","len","expectedOffset","lastLength","_moveViewPositionToTextNode","modelconsumable_ModelConsumable","_consumable","_textProxyRegistry","_normalizeConsumableType","_getSymbolForTextProxy","itemConsumables","startMap","endMap","_addSymbolForTextProxy","downcastdispatcher_DowncastDispatcher","conversionApi","dispatcher","differ","getMarkersToRemove","convertMarkerRemove","getChanges","convertInsert","convertRemove","convertAttribute","attributeKey","attributeOldValue","attributeNewValue","getMarkersToAdd","convertMarkerAdd","consumable","_createInsertConsumable","_testAndFire","_clearConversionApi","_createConsumableForRange","markers","markersAtSelection","getMarkersAtPosition","_createSelectionConsumable","marker","markerRange","getRange","shouldMarkerChangeBeConverted","markerName","getItems","containsItem","model_selection_Selection","anyNewRange","oldRange","_removeAllRanges","directChange","_popRange","attributeKeys","visited","startBlock","getParentBlock","isUnvisitedBlockContainer","endBlock","isTouching","limitStartPosition","limitEndPosition","_checkRange","model","schema","isBlock","block","liverange_LiveRange","isDocumentOperation","_createFromRanges","boundariesChanged","contentChanged","doesOperationChangeRangeContent","toRange","storePrefix","model_documentselection_DocumentSelection","documentselection_LiveSelection","hasOwnRange","isGravityOverridden","getSelectedBlocks","containsEntireContent","_getStoredAttributes","overrideGravity","restoreGravity","startsWith","_model","_attributePriority","_fixGraveyardRangesData","_hasChangedRange","_overriddenGravityRegister","_validateSelectionRange","batch","_updateAttributes","changeParent","isNoLongerEmpty","enqueueChange","storedAttributes","clearAttributesStoredInElement","liveRange","_fixGraveyardSelection","_getDefaultRange","optionsOrPlaceOrOffset","_refreshAttributes","overrideUid","_prepareRange","fromRange","clearAll","newAttributes","_getSurroundingAttributes","oldAttributes","_setAttributesTo","changed","newKey","oldKey","getAttrsIfCharacter","isObject","removedRangeStart","positionCandidate","selectionRange","getNearestSelectionRange","cloneDeep_CLONE_DEEP_FLAG","cloneDeep_CLONE_SYMBOLS_FLAG","lodash_es_cloneDeep","downcastElementToElement","config","_normalizeToElementConfig","elementCreator","consume","insertElement","converterPriority","downcastAttributeToElement","modelValue","_getFromAttributeCreator","oldViewElement","newViewElement","viewWriter","toViewRange","unwrap","downcastAttributeToAttribute","_normalizeToAttributeConfig","attributeCreator","oldAttribute","changeAttribute","viewElementType","modelData","viewElementDefinition","createContainerElement","createUIElement","_createViewElementFromDefinition","modelAttributeValue","editingcontroller_EditingController","downcastDispatcher","convertChanges","convertSelection","modelSelection","toModelRange","convertSelectionChange","createText","modelEnd","createRangeIn","unbindViewElement","brokenPosition","breakAttributes","plugincollection_PluginCollection","editor","availablePlugins","_editor","_availablePlugins","_plugins","PluginConstructor","pluginName","plugins","removePlugins","that","loading","loaded","pluginConstructors","mapToAvailableConstructors","removePluginConstructors","missingPlugins","pluginNameOrConstructor","getPluginConstructor","getMissingPluginNames","errorMsg","Promise","reject","loadPlugin","then","requires","RequiredPluginConstructorOrName","RequiredPluginConstructor","plugin","requiredBy","_add","instantiatePlugin","catch","err","PluginConstructorOrName","promises","pluginInstance","plugin1","plugin2","commandcollection_CommandCollection","_commands","commandName","command","execute","commands","translate","language","translationKey","numberOfLanguages","CKEDITOR_TRANSLATIONS","hasTranslation","locale_Locale","_t","str","translatedString","ViewConsumable","_consumables","consumables","elementConsumables","viewconsumable_ViewElementConsumables","revert","instance","consumablesFromElement","createFrom","_canConsumeName","_test","_consume","_revert","consumableName","schema_Schema","_sourceDefinitions","decorate","SchemaContext","getDefinition","itemName","definition","_clearCache","_compiledDefinitions","_compile","getDefinitions","def","isLimit","context","_checkContextMatch","attributeName","allowAttributes","positionOrBaseElement","elementToMerge","checkMerge","checkChild","childDef","retValue","selectionOrRangeOrPosition","rangeCommonAncestor","checkAttribute","getMinimalFlatRanges","convertToMinimalFlatRanges","_getValidRangesForRange","backwardWalker","forwardWalker","forward","step","combineWalkers","removeDisallowedAttributes","compiledDefinitions","sourceRules","itemNames","compileBaseItemRule","compileAllowContentOf","compileAllowWhere","compileAllowAttributesOf","compileInheritPropertiesFrom","cleanUpAllowIn","cleanUpAllowAttributes","contextItemIndex","contextItem","getItem","allowIn","parentRule","mapContextItem","query","getNames","endsWith","sourceItemRules","itemRule","allowContentOf","allowWhere","allowAttributesOf","inheritTypesFrom","sourceItemRule","typeNames","copyTypes","copyProperty","inheritFrom","inheritAllFrom","makeInheritAllWork","allowContentOfItemName","getAllowedChildren","allowedItem","allowWhereItemName","allowedIn","allowAttributeOfItem","inheritAttributes","inheritPropertiesOfItem","existingItems","itemToCheck","getValues","ctxItem","upcastdispatcher_UpcastDispatcher","_removeIfEmpty","_modelCursor","convertItem","_convertItem","convertChildren","_convertChildren","splitToAllowedParent","_splitToAllowedParent","viewItem","contextDefinition","append","createContextTree","store","documentFragment","_removeEmptyElements","modelItem","markerElements","markerElement","currentPosition","createPositionBefore","extractMarkersFromModelFragment","modelCursor","nextModelCursor","allowedParent","findAllowedParent","splitResult","getPositions","cursorParent","upcastElementToElement","converter","_getModelElement","childrenResult","createPositionAt","createPositionAfter","_prepareToElementConverter","elementName","_getViewElementNameFromConfig","upcastElementToAttribute","_normalizeModelAttributeConfig","_prepareToAttributeConverter","upcastAttributeToAttribute","viewKey","normalized","keyName","_normalizeViewAttributeKeyValueConfig","viewAttributeKeyToCopy","defaultModelValue","modelKey","_onlyViewNameIsDefined","modelAttribute","_setAttributeOn","datacontroller_DataController","dataProcessor","processor","upcastDispatcher","modelElementOrFragment","viewDocumentFragment","toView","toData","clearBindings","elementRange","intersection","_getMarkersRelativeToElement","modelRoot","parse","removeSelectionAttribute","toModel","viewElementOrFragment","conversion_Conversion","_dispatchersGroups","dispatchers","_getDispatchers","conversionHelper","_addToDispatchers","for","_getAllUpcastDefinitions","_getUpcastDefinition","upcastAlso","upcastAlsoItem","Batch","baseVersion","op","Operation","__className","model_documentfragment_DocumentFragment","model_documentfragment_normalize","_normalizeNodes","_splitNodeAtPosition","_mergeNodesAtIndex","_move","_haveSameAttributes","mergedNode","offsetDiff","firstPart","secondPart","iteratorA","iteratorB","lodash_es_isEqual","attributeoperation_AttributeOperation","detachoperation_DetachOperation","moveoperation_MoveOperation","newTargetPosition","getMovedRangeStart","sourceElement","targetElement","sourceOffset","targetOffset","insertoperation_InsertOperation","shouldReceiveAttributes","gyPosition","originalNodes","markeroperation_MarkerOperation","affectsData","_markers","renameoperation_RenameOperation","oldName","rootattributeoperation_RootAttributeOperation","mergeoperation_MergeOperation","splitoperation_SplitOperation","mergedElement","getInsertionPosition","splitElement","rootelement_RootElement","_doc","writer_Writer","_assertWriterUsedCorrectly","isSameTree","addOperation","applyOperation","rangeRootPosition","addMarker","usingOperation","itemOrRange","setAttributeOnRange","setAttributeOnItem","val","removeAttributesFromItem","flat","applyRemoveOperation","_merge","_mergeDetached","createPositionFromPath","createRangeOn","createSelection","merge","renameOperation","limitElement","firstSplitElement","firstCopyElement","elementOrString","applyMarkerOperation","_set","markerOrName","currentMarker","hasUsingOperationDefined","affectsDataDefined","currentRange","updatedRange","managedUsingOperations","keyOrObjectOrIterable","_setSelectionAttribute","keyOrIterableOfKeys","_removeSelectionAttribute","_overrideGravity","_restoreGravity","storeKey","_getStoreAttributeKey","_currentWriter","valueBefore","valueAfter","lastSplitPosition","previousValue","rootA","rootB","differ_Differ","markerCollection","_markerCollection","_changesInElement","_elementSnapshots","_changedMarkers","_changeCount","_cachedChanges","_cachedChangesWithGraveyard","_isInInsertedElement","_markInsert","_markAttribute","sourceParentInserted","targetParentInserted","_markRemove","getMarkersIntersectingRange","bufferMarkerChange","graveyardParent","mergedIntoElement","buffered","includeChangesInGraveyard","diffSet","changes","snapshotChildren","elementChildren","_getChildrenSnapshot","_generateActionsFromChanges","_getInsertDiff","_getRemoveDiff","elementAttributes","snapshotAttributes","_getAttributesDiff","changeCount","prevDiff","thisDiff","isConsecutiveTextRemove","isConsecutiveTextAdd","isConsecutiveAttributeChange","_changesInGraveyardFilter","changeItem","_markChange","_removeAllNestedChanges","_makeSnapshot","_getChangesForElement","_handleChange","inc","nodesToHandle","old","incEnd","oldEnd","intersectionLength","howManyAfter","attributePart","diffs","snapshot","oldChildrenLength","oldChildrenHandled","repeat","posInGy","rangeInGy","History","_operations","_undoPairs","_undoneOperations","undoneOperation","undoingOperation","isInsideSurrogatePair","character","isHighSurrogateHalf","isLowSurrogateHalf","isInsideCombinedSymbol","isCombiningMark","graveyardName","model_document_Document","history","createRoot","bufferOperation","hasSelectionChanged","hasDataChanges","reset","defaultRoot","_getDefaultRoot","validateTextNodePosition","rangeBoundary","markercollection_MarkerCollection","markercollection_Marker","oldMarker","hasChanged","_attachLiveRange","_managedUsingOperations","_affectsData","_destroyMarker","prefix","_detachLiveRange","_liveRange","stopDelegating","liveposition_LivePosition","oldPosition","toPosition","insertcontent_Insertion","canMergeWith","_filterAttributesOf","parentContext","_handleNode","isFirst","isLast","nodeToSelect","_handleObject","_checkAndSplitToAllowedPosition","_mergeSiblingsOf","_handleDisallowedNode","_tryAutoparagraphing","handleNodes","livePos","fromPosition","mergeLeft","_canMergeLeft","mergeRight","_canMergeRight","mergePosLeft","mergePosRight","livePosition","paragraph","_getAllowedIn","tempPos","deleteContent","doNotResetEntireContent","getLimitElement","shouldEntireContentBeReplacedWithParagraph","insertParagraph","replaceEntireContentWithParagraph","selRange","startPos","endPos","leaveUnmerged","mergeBranches","startParent","endParent","leftPos","rightPos","rangeToCheck","checkCanBeMerged","parentToRemove","isTextAllowed","isParagraphAllowed","shouldAutoparagraph","wordBoundaryCharacters","modifySelection","isForward","unit","searchEnd","getSearchRange","tryExtendingTo","setSelectionFocus","isAtWordBoundary","isAtNodeBoundary","boundaryChar","getCorrectWordBreakPosition","getCorrectPosition","offsetToCheck","removeRangeContent","parentsToCheck","itemRange","parentToCheck","removeRange","injectSelectionPostFixer","registerPostFixer","correctedRange","tryFixingRange","fixedRanges","selectionStart","selectionEnd","selectionPostFixer","originalPosition","nearestSelectionRange","fixedPosition","tryFixingCollapsedRange","isTextAllowedOnStart","isTextAllowedOnEnd","startLimitElement","endLimitElement","startIsOnBlock","endIsOnBlock","checkSelectionOnNonLimitElements","fixedStart","fixedEnd","isStartInLimit","isEndInLimit","expandSelectionOnIsLimitNode","tryFixingNonCollapsedRage","expandToDirection","model_Model","_pendingChanges","_validate","register","_runPendingChanges","batchOrType","_execute","insertion","nodesToInsert","getSelectionRange","insertContent","frag","commonPath","commonParent","getNodeByPath","flatSubtreeRange","appendText","leftExcessRange","getSelectedContent","rangeOrElement","ret","currentBatch","callbackReturnValue","keystrokehandler_KeystrokeHandler","_listener","keyEvtData","editingkeystrokehandler_EditingKeystrokeHandler","evtData","editor_Editor","builtinPlugins","defaultConfig","locale","once","state","editing","conversion","keystrokes","extraPlugins","load","loadPlugins","loadedPlugins","initPlugins","method","promise","readyPromise","dataapimixin","elementapimixin","HTMLTextAreaElement","innerHTML","setDataInElement","BasicHtmlWriter","fragment","implementation","createHTMLDocument","htmldataprocessor_HtmlDataProcessor","_domParser","DOMParser","_domConverter","_htmlWriter","getHtml","_toDom","parseFromString","componentfactory_ComponentFactory","_components","originalName","getNormalized","focustracker_FocusTracker","focusedElement","_elements","_nextEventLoopTimeout","_focus","_blur","editorui_EditorUI","componentFactory","focusTracker","classiceditorui_ClassicEditorUI","_toolbarConfig","normalizeToolbarConfig","stickyPanel","limiterElement","viewportTopOffset","editingRoot","toolbar","fillFromConfig","origin","originKeystrokeHandler","originFocusTracker","beforeFocus","afterBlur","enableToolbarKeyboardFocus","viewcollection_ViewCollection","isRendered","_parentElement","elementOrDocFragment","viewcollection_isStringArray","dest","evtName","cloneDeepWith_CLONE_DEEP_FLAG","cloneDeepWith_CLONE_SYMBOLS_FLAG","lodash_es_cloneDeepWith","xhtmlNs","template_Template","template_normalize","template_clone","_isRendered","_revertData","_renderNode","intoFragment","isApplying","revertData","_revertTemplateFromNode","search","isView","isTemplate","eventNameOrFunctionOrAttribute","TemplateToBinding","eventNameOrFunction","if","valueIfTrue","TemplateIfBinding","template","extendTemplate","extendObjectValueArray","eventListeners","childIndex","isInvalid","_renderText","_renderElement","createElementNS","_renderAttributes","_renderElementChildren","_setUpListeners","textContent","hasTemplateBinding","_bindToObservable","updater","getTextUpdater","attrName","attrValue","domAttrValue","attrNs","valueToBind","shouldExtend","getAttributeUpdater","_renderStyleAttribute","isFalsy","arrayValueReducer","setAttributeNS","styleName","styleValue","getStyleUpdater","isViewCollection","setParent","childRevertData","revertBindings","schemaItem","domEvtName","domSelector","activateDomEventListener","syncValueSchemaValue","templateBinding","activateAttributeListener","revertBinding","TemplateBinding","matches","getValue","getValueSchemaValue","removeAttributeNS","normalizePlainTextDefinition","normalizeTextDefinition","listeners","arrayify","normalizeListeners","normalizeAttributes","cur","ext","src_view_View","_viewCollections","_unboundChildren","createCollection","collection","bindTemplate","_bindTemplate","registerChild","getViews","editoruiview_EditorUIView","_renderBodyCollection","_bodyCollectionContainer","bodyElement","class","labelview_LabelView","setTemplate","boxededitoruiview_BoxedEditorUIView","ariaLabelUid","main","_voiceLabelView","_createVoiceLabel","role","lang","aria-labelledby","voiceLabel","editableuiview_EditableUIView","contenteditable","externalElement","inlineeditableuiview_InlineEditableUIView","aria-label","toUnit","toPx","stickypanelview_StickyPanelView","_contentPanelPlaceholder","display","isSticky","_panelRect","_contentPanel","_hasViewportTopOffset","_isStickyToTheLimiter","limiterBottomOffset","marginLeft","_checkIfShouldBeSticky","panelRect","limiterRect","_limiterRect","isActive","_marginLeft","FocusCycler","keystrokeHandler","focusables","isFocusable","_getFocusableItem","previous","viewIndex","focused","collectionLength","toolbarseparatorview_ToolbarSeparatorView","toolbarview_ToolbarView","_focusCycler","focusPrevious","focusNext","mousedown","focusFirst","focusLast","classiceditoruiview_ClassicEditorUIView","ElementReplacer","_replacedElements","classiceditor_ClassicEditor","sourceElementOrData","_elementReplacer","ui","updateSourceElement","form","originalSubmit","onSubmit","submit","attachToForm","restore","init","attachDomRoot","initialData","getDataFromElement","Plugin","DataTransfer","nativeDataTransfer","files","kind","getAsFile","getFiles","_native","getData","setData","clipboardobserver_ClipboardObserver","viewDocument","handleInput","targetRanges","dropRange","dataTransfer","clipboardData","domDoc","clientX","clientY","caretRangeFromPoint","rangeParent","rangeOffset","getDropViewRange","smallPaddingElements","clipboard_Clipboard","modelDocument","onCopyCut","_htmlDataProcessor","spaces","normalizeClipboardData","plainTextToHtml","scrollToTheSelection","dataController","modelFragment","viewToPlainText","childText","Command","refresh","forceDisable","entercommand_EnterCommand","isSelectionEmpty","splitBlock","isContainedWithinOneElement","enterBlock","splitPos","enterobserver_EnterObserver","isSoft","enter_Enter","shiftentercommand_ShiftEnterCommand","insertBreak","softBreakAction","anchorPos","isInsideLimitElement","breakLineElement","shiftenter_ShiftEnter","createEmptyElement","ChangeBuffer","limit","isLocked","_changeCallback","_batch","_reset","_selectionChangeCallback","createBatch","ignoreLock","inputcommand_InputCommand","undoStepSize","_buffer","textInsertions","resultRange","isCollapsedRange","lock","insertText","unlock","injectUnsafeKeystrokesHandling","latestCompositionSelection","inputCommand","deleteSelectionContent","isSelectionUnchanged","keyData","safeKeycodes","isSafeKeystroke","handleKeydown","isFlatSelection","containerChildrenMutated","mutations","getSingleTextNodeChange","output","lastOperation","pushLast","isContinuationOf","expected","diffToChanges","compareChildNodes","oldChild","newChild","injecttypingmutationshandling_MutationHandler","_handleContainerChildrenMutations","_handleTextMutation","_handleTextNodeInsertion","mutationsCommonAncestor","commonAncestor","getMutationsContainer","domMutationCommonAncestor","freshDomConverter","modelFromCurrentDom","currentModel","modelFromDomChildren","currentModelChildren","lastDomChild","lastCurrentChild","isSafeForTextMutation","diffResult","firstChangeAt","insertions","deletions","calculateChanges","modelSelectionRange","viewPos","modelPos","insertedText","lastChangeAt","input_Input","handle","injectTypingMutationsHandling","deletecommand_DeleteCommand","_shouldEntireContentBeReplacedWithParagraph","sequence","_replaceEntireContentWithParagraph","limitElementFirstChild","deleteobserver_DeleteObserver","hasWordModifier","injectAndroidBackspaceMutationsHandling","selectionChangeToleranceMs","previousSelection","currentSelection","latestSelectionChangeMs","childrenBefore","childrenAfter","hasOnlyContainers","hasDelete","hasInsert","containsContainersRemoval","handleContainerRemovalMutations","delete_Delete","typing_Typing","nooperation_NoOperation","transformations","setTransformation","OperationA","OperationB","transformationFunction","aGroup","noUpdateTransformation","transform_transform","getTransformation","aIsStrong","aWasUndone","bWasUndone","abRelation","baRelation","transformSets","operationsA","operationsB","nextTransformIndex","nextBaseVersionA","nextBaseVersionB","originalOperationsACount","originalOperationsBCount","contextFactory","transform_ContextFactory","useRelations","setOriginalOperations","opA","indexB","opB","newOpsA","getContext","newOpsB","updateRelation","newOpA","padWithNoOps","brokenOperationsACount","brokenOperationsBCount","updateBaseVersions","_history","_useRelations","_originalOperations","_relations","takeFrom","originalOperation","_setRelation","_wasUndone","_getRelation","originalOp","wasUndone","isUndoneOperation","origB","undoneB","getUndoneOperation","origA","relationsA","relation","_getComplementaryAttributeOperations","insertOperation","insertValue","_moveTargetIntoMovedRange","_makeMoveOperationsFromRanges","hasSameParentAs","moveOp","_breakRangeByMoveOperation","aToGraveyard","bToGraveyard","removedRange","mergeInside","mergeSplittingElement","getReversed","aCompB","shouldSpread","rightRange","movesGraveyardElement","gyMoveSource","splitNodesMoveSource","gyMoveTarget","gyMove","targetPositionPath","splitNodesMoveTarget","splitNodesMove","splitPath","additionalSplit","rangeToMove","newParentPosition","newTargetPath","howManyRemoved","aInGraveyard","bInGraveyard","newPositionPath","basecommand_BaseCommand","_stack","_createdBatches","docSelection","selectionRanges","transformSelectionRange","batchToUndo","undoingBatch","operationsToUndo","operationToUndo","nextBaseVersion","historyOperations","getOperations","reversedOperations","setOperationAsUndone","getTransformedByOperations","undocommand_UndoCommand","batchIndex","findIndex","_undo","_restoreSelection","redocommand_RedoCommand","redoingBatch","undoediting_UndoEditing","_batchRegistry","_undoCommand","_redoCommand","addBatch","clearStack","undoneBatch","iconview_IconView","viewBox","_updateXMLContent","_colorFillPaths","svg","fillColor","querySelectorAll","fill","tooltipview_TooltipView","buttonview_ButtonView","tooltipView","_createTooltipView","labelView","_createLabelView","iconView","_getTooltipString","tabindex","aria-disabled","aria-pressed","click","icon","tooltip","getEnvKeystrokeText","undoui_UndoUI","_addButton","undo_default","redo_default","Icon","undo_Undo","pendingactions_PendingActions","_actions","hasAny","FileReader","reader","_reader","onprogress","file","total","onload","onerror","onabort","readAsDataURL","abort","filerepository_FileRepository","loaders","_updatePendingAction","_pendingAction","uploaded","loader","createUploadAdapter","filerepository_FileLoader","_adapter","aggregatedUploaded","aggregatedTotal","uploadTotal","fileOrLoader","getLoader","_destroy","pendingActions","getMessage","uploadedPercent","adapter","status","read","upload","uploadResponse","TOKEN_COOKIE_NAME","TOKEN_LENGTH","tokenCharset","getCsrfToken","token","cookie","pair","decodeURIComponent","getCookie","randValues","crypto","getRandomValues","toUpperCase","generateToken","setCookie","uploadadapter_CKFinderUploadAdapter","url","uploadadapter_UploadAdapter","_initRequest","_initListeners","_sendRequest","xhr","XMLHttpRequest","open","responseType","genericError","response","lengthComputable","FormData","send","BlockAutoformatEditing","callbackOrCommand","InlineAutoformatEditing","testRegexpOrCallback","attributeOrCallback","regExp","testCallback","formatCallback","format","1","leftDel","2","3","rightDel","delStart","delEnd","validRanges","getText","testOutput","rangesToFormat","testOutputToRanges","rangesToRemove","getValidRanges","arrays","attributecommand_AttributeCommand","_getValueFromFirstAllowedNode","checkAttributeInSelection","forceValue","setSelectionAttribute","BOLD","boldediting_BoldEditing","attributeToElement","font-weight","boldui_BOLD","boldui_BoldUI","bold_default","ITALIC","italicediting_ItalicEditing","font-style","italicui_ITALIC","italicui_ItalicUI","italic_default","first_first","iterable","iteratorItem","blockquotecommand_BlockQuoteCommand","_checkEnabled","blocks","_removeQuote","findQuote","blocksToQuote","checkCanBeQuoted","_applyQuote","firstBlock","getRangesOfBlockGroups","groupRange","positionBefore","positionAfter","quotesToMerge","quote","currentQuote","nextQuote","elementOrPosition","nextBlock","isBQAllowed","isBlockAllowedInBQ","blockquoteediting_BlockQuoteEditing","addChildCheck","elementToElement","blockquoteui_BlockQuoteUI","buttonView","quote_default","ckfinderui_CKFinderUI","button","browse_files_default","notification_Notification","alert","_showNotification","namespace","title","ckfindercommand_CKFinderCommand","imageCommand","linkCommand","openerMethod","chooseFiles","originalOnInit","onInit","finder","toArray","links","isImage","images","linkFile","getUrl","imagesUrls","image","request","insertImages","resizedUrl","notification","showWarning","CKFinder","urls","ckfinderediting_CKFinderEditing","BASE64_HEADER_REG_EXP","FileUploader","fileOrData","apiAddress","_isBase64","base64","sliceSize","contentType","base64Data","byteArrays","byteNumbers","charCodeAt","_base64ToBlob","_token","_apiAddress","_prepareRequest","_attachXHRListeners","setRequestHeader","onError","statusCode","xhrResponse","formData","fileuploader","DEFAULT_OPTIONS","refreshInterval","autoRefresh","Token","tokenUrlOrRefreshToken","initValue","_refresh","tokenUrl","defaultRefreshToken","_options","_startRefreshing","_refreshToken","_stopRefreshing","_refreshInterval","token_token","cloudservices_CloudServices","optionName","cloudservicesuploadadapter_CloudServicesUploadAdapter","cloudServices","uploadUrl","_uploadGateway","_UploadGateway","Adapter","uploadGateway","fileUploader","imageloadobserver_ImageLoadObserver","_observedElements","_updateObservedElements","_fireEvents","modelToViewAttributeConverter","img","HighlightStack","descriptor","oldTop","_insertDescriptor","newTop","compareDescriptors","oldDescriptor","newDescriptor","_removeDescriptor","shouldABeBeforeB","classesToString","widgetSymbol","labelSymbol","WIDGET_CLASS_NAME","WIDGET_SELECTED_CLASS_NAME","isWidget","toWidget","setCustomProperty","utils_getFillerOffset","labelOrCreator","setLabel","hasSelectionHandler","selectionHandler","drag_handler_default","addSelectionHandler","setHighlightHandling","normalizeToArray","getLabel","labelCreator","toWidgetEditable","findOptimalInsertionPosition","selectedElement","imageSymbol","isImageWidgetSelected","isImageWidget","insertImage","imageElement","insertAtSelection","isImageAllowed","getInsertImageParent","isImageAllowedInParent","isSelectionOnObject","isSelectionInObject","checkSelectionWithObject","imageinsertcommand_ImageInsertCommand","src","imageediting_ImageEditing","createImageViewElement","altText","toImageWidget","srcset","srcsetAttributeConverter","viewImage","modelWriter","conversionResult","modelImage","viewFigureToModel","emptyElement","figure","mouseobserver_MouseObserver","selectAllKeystrokeCode","widget_Widget","_previouslySelected","_clearPreviouslySelectedWidgets","lastMarked","isChild","_onMousedown","_onKeydown","_handleDelete","domEventData","isInsideNestedEditable","_setSelectionOverElement","wasHandled","isArrowKeyCode","isSelectAllKeyCode","_handleEnterKey","_selectAllNestedEditableContent","_selectAllContent","_handleArrowKeys","objectElement","_getObjectElementNextToSelection","previousNode","nodeToRemove","objectElement2","isBackwards","documentSelection","widgetParent","probe","widget","imagetextalternativecommand_ImageTextAlternativeCommand","imagetextalternativeediting_ImageTextAlternativeEditing","clickOutsideHandler","activator","contextElements","contextElement","labeledinputview_LabeledInputView","InputView","inputUid","statusUid","inputView","_createInputView","statusView","_createStatusView","errorText","infoText","ariaDesribedById","select","inputtextview_InputTextView","placeholder","readonly","aria-invalid","aria-describedby","setValue","submitHandler","textalternativeformview_TextAlternativeFormView","labeledInput","_createLabeledInputView","saveButtonView","_createButton","check_default","cancelButtonView","cancel_default","_focusables","v","getOptimalPosition","positions","limiter","fitInViewport","positionedElementAncestor","getPositionedAncestor","elementRect","bestPosition","getVisible","bestPositionRect","bestPositionName","maxLimiterIntersectArea","maxViewportIntersectArea","elementRectArea","positionName","positionRect","getPosition","limiterIntersectArea","viewportIntersectArea","limiterViewportIntersectRect","getIntersectionArea","setBestPosition","getBestPosition","getAbsoluteRectCoordinates","ancestorPosition","ancestorBorderWidths","moveTo","balloonpanelview_toPx","defaultLimiterElement","balloonpanelview_BalloonPanelView","isVisible","show","defaultPositions","positionOptions","southArrowNorth","southArrowNorthWest","southArrowNorthEast","northArrowSouth","northArrowSouthWest","northArrowSouthEast","_getOptimalPosition","unpin","_pinWhenIsVisibleCallback","_startPinning","_stopPinning","hide","attachTo","getDomElement","scrollTarget","isWithinScrollTarget","isLimiterWithinScrollTarget","getNorthTop","balloonRect","arrowVerticalOffset","getSouthTop","arrowHorizontalOffset","northWestArrowSouth","northWestArrowSouthWest","northWestArrowSouthEast","northEastArrowSouth","northEastArrowSouthEast","northEastArrowSouthWest","southWestArrowNorth","southWestArrowNorthWest","southWestArrowNorthEast","southEastArrowNorth","southEastArrowNorthEast","southEastArrowNorthWest","contextualballoon_ContextualBalloon","positionLimiter","visibleView","hasView","_show","pin","_getBalloonPosition","balloonClassName","getBalloonPositionData","editingView","imagetextalternativeui_ImageTextAlternativeUI","_createForm","low_vision_default","_showForm","_balloon","_form","_hideForm","_isVisible","balloon","updatePosition","repositionContextualBalloon","focusEditable","imagetextalternative_ImageTextAlternative","image_Image","filedialogbuttonview_FileDialogButtonView","_fileInputView","filedialogbuttonview_FileInputView","msg","imgSrc","toggleVisible","filedialogbuttonview_PidorView","imgName","picturesViews","fetchImagesFromServer","pidorView","imagePickDialogueTemplate","accept","classList","toggle","responseText","statusText","isImageType","fetchLocalImage","fetch","resource","mimeType","getImageMimeType","filename","File","createFileFromBlob","imageuploadui_ImageUploadUI","acceptedType","allowMultipleFiles","icons_image_default","imageuploadprogress_ImageUploadProgress","image_placeholder_default","uploadStatusChange","uploadId","fileRepository","viewFigure","_startAppearEffect","_showPlaceholder","_hidePlaceholder","progressBar","progressBarSymbol","_createProgressBar","_showProgressBar","completeIcon","_showCompleteIcon","_removeUIElement","_hideProgressBar","_stopAppearEffect","placeholderSymbol","viewImg","_getUIElement","_createPlaceholder","imageFigure","uniqueProperty","upcastwriter_UpcastWriter","removeChildren","oldElement","insertChild","imageuploadcommand_ImageUploadCommand","filesToUpload","uploadImage","createLoader","imageuploadediting_ImageUploadEditing","isHtmlIncluded","fetchableImages","isLocalImage","isInGraveyard","_readAndUpload","setAttributes","uploadStatus","_parseAndSetSrcsetAttributeOnImage","clean","destroyLoader","maxWidth","srcsetAttribute","isNaN","imageupload_ImageUpload","paragraphcommand_ParagraphCommand","checkCanBecomeParagraph","rename","paragraph_Paragraph","paragraphLikeElements","isParagraphable","wrapInParagraph","_autoparagraphEmptyRoots","getRootNames","createContext","headingcommand_HeadingCommand","modelElements","heading","checkCanBecomeHeading","defaultModelElement","headingediting_HeadingEditing","option","_addDefaultH1Conversion","enterCommand","src_model_Model","dropdownpanelview_DropdownPanelView","selectstart","dropdownview_DropdownView","panelView","isOpen","panelPosition","defaultPanelPositions","southEast","southWest","northEast","northWest","closeDropdown","buttonRect","dropdownbuttonview_DropdownButtonView","arrowView","_createArrowView","aria-haspopup","dropdown_arrow_default","listview_ListView","listitemview_ListItemView","listseparatorview_ListSeparatorView","switchbuttonview_SwitchButtonView","toggleSwitchView","_createToggleView","createDropdown","ButtonClass","dropdownView","closeDropdownOnBlur","closeDropdownOnExecute","focusDropdownContentsOnArrows","addDefaultBehavior","addListToDropdown","listView","listItemView","headingui_HeadingUI","localizedTitles","Paragraph","Heading 1","Heading 2","Heading 3","getLocalizedOptions","defaultTitle","dropdownTooltip","titles","itemDefinitions","headingCommand","paragraphCommand","withText","commandValue","isOn","areEnabled","para","whichModel","documentPlaceholders","attachPlaceholder","placeholderText","checkFunction","placeholders","info","updateSinglePlaceholder","updateAllPlaceholders","isEmptyish","captionSymbol","getCaptionFromImage","imageModelElement","matchImageCaption","imagecaptionediting_ImageCaptionEditing","_insertMissingModelCaptionElement","captionModelToView","createCaptionForEditing","createEditableElement","captionElementCreator","_fixCaptionVisibility","_updateCaptionVisibility","lastCaption","_lastSelectedCaption","viewCaption","modelCaption","getParentCaption","showCaption","hideCaptionIfEmpty","viewModified","nodeFinder","appendElement","captionElement","insertViewCaptionAndBind","caption","imagestylecommand_ImageStyleCommand","_defaultStyle","isDefault","attributeValue","getStyleByName","defaultStyles","full","object_full_width_default","side","object_right_default","alignLeft","object_left_default","alignCenter","object_center_default","alignRight","defaultIcons","center","normalizeImageStyles","configuredStyles","_normalizeStyle","defaultStyle","extendedStyle","imagestyleediting_ImageStyleEditing","modelToViewConverter","newStyle","oldStyle","modelToViewStyleAttribute","filteredStyles","viewFigureElement","modelImageElement","viewToModelStyleAttribute","imagestyleui_ImageStyleUI","localizedDefaultStylesTitles","Full size image","Side image","Left aligned image","Centered image","Right aligned image","translatedStyles","translateStyles","componentName","widgettoolbarrepository_WidgetToolbarRepository","balloonToolbar","isWidgetSelected","_toolbars","_updateToolbarsVisibility","toolbarId","visibleWhen","toolbarView","_showToolbar","_hideToolbar","_isToolbarVisible","widgettoolbarrepository_getBalloonPositionData","widgettoolbarrepository_repositionContextualBalloon","getParentWidget","findLinkRange","_findBound","lookBack","lastNode","linkcommand_LinkCommand","linkRange","unlinkcommand_UnlinkCommand","rangesToUnlink","linkElementSymbol","ATTRIBUTE_WHITESPACES","SAFE_URL","linkElement","ensureSafeUrl","isSafeUrl","TwoStepCaretHandler","_modelSelection","_overrideUid","_isNextGravityRestorationSkipped","_isGravityOverridden","isAtBoundary","_hasSelectionAttribute","isBetweenDifferentValues","_preventCaretMovement","isAtStartBoundary","isAtEndBoundary","_setSelectionAttributeFromTheNodeBefore","isStepAfterTheAttributeBoundary","_skipNextAutomaticGravityRestoration","overrideSelectionGravity","restoreSelectionGravity","isAttrBefore","isAttrAfter","HIGHLIGHT_CLASS","linkediting_LinkEditing","twoStepCaretHandler","arrowRightPressed","arrowLeftPressed","isMovementHandled","handleForwardMovement","handleBackwardMovement","bindTwoStepCaretToAttribute","_setupLinkHighlight","highlightedLinks","removeHighlight","clickobserver_ClickObserver","linkformview_LinkFormView","urlInputView","_createUrlInput","linkactionsview_LinkActionsView","previewButtonView","_createPreviewButton","unlinkButtonView","unlink_default","editButtonView","pencil_default","linkKeystroke","linkui_LinkUI","actionsView","_createActionsView","formView","_createFormView","_createToolbarLinkButton","_enableUserBalloonInteractions","unlinkCommand","_addFormView","_hideUI","_removeFormView","_showUI","icons_link_default","_getSelectedLinkElement","_areActionsVisible","_isUIVisible","_areActionsInPanel","_getBalloonPositionData","_isFormInPanel","_addActionsView","_startUpdatingUI","_isUIInPanel","prevSelectedLink","prevSelectionParent","getSelectionParent","selectedLink","targetLink","findLinkElementAncestor","startLink","endLink","isLinkElement","listcommand_ListCommand","checkCanBecomeListItem","turnOff","currentIndent","indent","newIndent","listIndent","lowestIndent","_fixType","listType","listItem","startingItem","indentcommand_IndentCommand","indentDirection","_indentBy","itemsToChange","lastItem","getListItemFillerOffset","hasOnlyLists","modelViewInsertion","injectViewList","createViewListItemElement","viewList","generateLiInUl","modelViewRemove","breakContainer","viewListPrev","mergeViewLists","hoistNestedLists","modelViewChangeType","listName","modelViewChangeIndent","modelViewSplitOnInsert","removeStart","removeEnd","previousList","mergePos","modelViewMergeAfter","viewItemPrev","viewItemNext","viewModelConverter","conversionStore","listItemModel","lastListItem","convertedChild","viewToModelListItemChildrenConverter","cleanList","cleanListItem","foundList","firstNode","modelToViewPosition","topmostViewList","modelIndentPasteFixer","refItem","indentChange","getSiblingListItem","sameIndent","smallerIndent","itemIndent","firstList","secondList","mergeContainers","injectedItem","injectedList","prevItem","positionAfterUiElements","prevView","breakPosition","nextViewList","lastSubChild","modelChild","nextIndent","modelRemoveStartPosition","viewRemoveStartPosition","viewRemovedItem","prevModelItem","foo","prevIndent","prevViewList","listediting_ListEditing","itemToListHead","applied","_addListToFix","listHead","_fixListIndents","_fixListTypes","maxIndent","fixBy","typesStack","modelChangePostFixer","registerViewToModelLength","getViewListItemLength","modelNode","modelLength","viewToModelPosition","firstPosition","getCommandExecuter","listui_ListUI","numberedlist_default","bulletedlist_default","modelToViewUrlAttributeConverter","registry","mediaViewElement","getMediaViewElement","mediaSymbol","createMediaFigureElement","src_utils_getFillerOffset","getSelectedMediaElement","mediaembedcommand_MediaEmbedCommand","selectedMedia","mediaElement","mediaPlaceholderIconViewBox","mediaregistry_MediaRegistry","providers","extraProviders","removedProviders","removeProviders","providerDefinitions","provider","_getMedia","getViewElement","mediaregistry_Media","previewRenderer","html","subPattern","_getUrlMatches","rawUrl","_getValidUrl","_match","_previewRenderer","renderForEditingView","renderMediaPreview","mediaHtml","_getPreviewHtml","_getPlaceholderHtml","media_placeholder_default","outerHTML","mediaembedediting_MediaEmbedEditing","toMediaWidget","viewMedia","hasMedia","data-oembed-url","URL_REGEXP","automediaembed_AutoMediaEmbed","_timeoutId","_positionToInsert","leftLivePosition","rightLivePosition","_embedMediaBetweenPositions","leftPosition","rightPosition","mediaRegistry","urlRange","mediaEmbedCommand","mediaformview_MediaFormView","validators","_validators","resetFormStatus","validator","mediaembedui_MediaEmbedUI","getFormValidators","dropdown","_setUpDropdown","_setUpForm","closeUI","media_default","isValid","normalizeSafariSpaceSpans","htmlString","parseHtml","domParser","normalizedHtml","normalizeSpacing","cleanContentAfterBody","htmlDocument","innerTextLength","normalizeSpacerunSpans","bodyString","bodyView","documentToView","stylesObject","styleTags","getElementsByTagName","sheet","cssRules","extractStyles","transformListItemLikeElementsIntoLists","itemLikeElements","itemLikeElementsMatcher","mso-list","itemData","getListItemData","order","findAllItemLikeElements","currentList","itemLikeElement","previousItem","currentItem","isNewListNeeded","listStyle","listLikeItem","listStyleTypeRegex","listStyleMatch","listStyleType","listStyleTypeMatch","detectListStyle","insertNewEmptyList","bulletMatcher","removeBulletElement","transformElementIntoListItem","replaceImagesSourceWithBase64","rtfData","upcastWriter","shapesIds","imageElementsMatcher","imgs","shapes","shape","removeAllImgElementsRepresentingShapes","shapeElementsMatcher","prevSiblingName","findAllShapesIds","removeAllShapeElements","findAllImageElementsWithLocalSource","imageElements","imagesHexSources","newSrc","_convertHexToBase64","hex","replaceImagesFileSourceWithInlineRepresentation","regexPictureHeader","regexPicture","imageType","extractImageDataFromRtf","hexString","parentName","updateNumericAttribute","defaultValue","createEmptyTableCell","tableCell","upcastTable","viewTable","rows","headingRows","headingColumns","tableMeta","headRows","bodyRows","firstTheadElement","tableChild","trs","tr","headingCols","scanRowForHeadingColumns","scanTable","table","row","upcastTableCell","viewTableCell","th","TableWalker","startRow","endRow","includeSpanned","column","_skipRows","_row","_column","_cell","_spannedCells","_isOverEndRow","_isSpanned","currentColumn","outValue","_formatOutValue","_shouldSkipRow","_shouldSkipColumn","cell","colspan","rowspan","_recordSpans","cellIndex","rowIsBelowStartRow","rowIsMarkedAsSkipped","isCurrentColumn","isPreviousThatOverlapsColumn","columnToUpdate","_markSpannedCell","rowToUpdate","tableSymbol","isTableWidget","isTableWidgetSelected","isTableContentSelected","parentTable","downcastInsertTable","asWidget","figureElement","tableElement","tableWidget","toTableWidget","tableWalker","tableAttributes","tableWalkerValue","tableSection","getOrCreateTableSection","getSectionName","trElement","getOrCreateTr","createViewTableCellElement","downcastInsertRow","tableRow","getViewTable","downcastInsertCell","rowIndex","downcastTableHeadingRowsChange","oldRows","newRows","rowsToMove","isBetween","moveViewRowsToTableSection","renameViewTableCell","removeTableSectionIfEmpty","renameViewTableCellIfRequired","lower","upper","downcastTableHeadingColumnsChange","oldColumns","newColumns","lastColumnToCheck","desiredCellElementName","viewCell","renamedCell","getCellElementName","cellElementName","cellElement","isSingleParagraph","innerParagraph","paragraphInsertPosition","containerName","fakeParagraph","sectionName","viewTableSection","getExistingTableSectionElement","tableChildElement","createTableSection","viewTableRow","tableutils_TableUtils","columns","createEmptyRows","at","rowsToInsert","getColumns","tableIterator","cellsToInsert","columnsToInsert","tableColumns","createCells","skipRow","numberOfCells","newCellsSpan","updatedSpan","breakSpanEvenly","newCellsAttributes","tableMap","splitCellColumn","cellsToUpdate","splitCellRow","cellColumn","rowspanToSet","tableCellToInsert","cells","span","inserttablecommand_InsertTableCommand","validParent","getInsertTableParent","tableUtils","createTable","insertrowcommand_InsertRowCommand","tableParent","insertRows","insertcolumncommand_InsertColumnCommand","getCellLocation","insertColumns","splitcellcommand_SplitCellCommand","isHorizontally","splitCellHorizontally","splitCellVertically","mergecellcommand_MergeCellCommand","isHorizontal","cellToMerge","_getMergeableCell","isMergeNext","cellToExpand","cellToRemove","removedTableCellRow","mergecellcommand_isEmpty","mergeTableCells","spanAttribute","cellSpan","cellToMergeSpan","removedRowIndex","overlapsRemovedRow","removeEmptyRow","horizontalCell","cellOnLeft","cellOnRight","leftCellColumn","rightCellColumn","leftCellSpan","getHorizontalCell","currentCellRowSpan","rowOfCellToMerge","mergeColumn","cellToMergeData","getVerticalCell","removerowcommand_RemoveRowCommand","currentRow","cellsToMove","targetRow","previousCell","cellToMove","removecolumncommand_RemoveColumnCommand","removedColumn","setheaderrowcommand_SetHeaderRowCommand","isInTable","_isInHeading","currentHeadingRows","selectionRow","headingRowsToSet","cellsToSplit","getOverlappingCells","splitHorizontally","newRowspan","spanToSet","columnIndex","setheadercolumncommand_SetHeaderColumnCommand","currentHeadingColumns","selectionColumn","headingColumnsToSet","injectTableLayoutPostFixer","analyzedTables","isTableAttributeEntry","fixTableCellsRowspan","fixTableRowsSizes","tableLayoutPostFixer","cellsToTrim","maxRows","isInHeader","rowLimit","findCellsToTrim","rowsLengths","lengths","getRowsLengths","tableSize","maxColumns","isAttributeType","injectTableCellContentPostFixer","fixTableCellContent","fixTable","fixTableRow","tableCellContentsPostFixer","injectTableCellPostFixer","elementsToCheck","elementsWithChangedAttributes","isSpanOrP","isTdOrTh","changedChildren","childrenToCheck","getElementsToCheck","ensureProperElementName","updateRangesInViewSelection","tableCellPostFixer","currentViewElement","modelParagraph","expectedViewElementName","isOnlyChild","hasAttributes","getExpectedElementName","renamedViewElement","tableediting_TableEditing","childDefinition","attributeToAttribute","_handleTabOnSelectedTable","_getTabHandler","currentRowIndex","currentCellIndex","isFirstCellInRow","isLastCellInRow","isLastRow","cellToFocus","nextRow","previousRow","inserttableview_InsertTableView","boxView","inserttableview_TableSizeGridBoxView","_highlightGridBoxes","mouseover","tableui_TableUI","table_default","insertTableView","bindIsOn","_prepareDropdown","table_column_default","table_row_default","table_merge_cell_default","addListOption","ckeditor_ClassicEditor","_addListAutoformats","_addBasicStylesAutoformats","_addHeadingAutoformats","_addBlockQuoteAutoformats","level","pasteFromOfficeProcessed","isWordInput","_normalizeWordInput","widgetToolbarRepository","tableContentToolbarItems","deprecatedTableContentToolbarItems","tableToolbarItems","contentToolbar"],"mappings":"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","file":"ckeditor.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ClassicEditor\"] = factory();\n\telse\n\t\troot[\"ClassicEditor\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 120);\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/ckeditorerror\r\n */\r\n\r\n/**\r\n * URL to the documentation with error codes.\r\n */\r\nexport const DOCUMENTATION_URL =\r\n\t'https://ckeditor.com/docs/ckeditor5/latest/framework/guides/support/error-codes.html';\r\n\r\n/**\r\n * The CKEditor error class.\r\n *\r\n * All errors will be shortened during the minification process in order to reduce the code size.\r\n * Therefore, all error messages should be documented in the same way as those in {@link module:utils/log}.\r\n *\r\n * Read more in the {@link module:utils/log} module.\r\n *\r\n * @extends Error\r\n */\r\nexport default class CKEditorError extends Error {\r\n\t/**\r\n\t * Creates an instance of the CKEditorError class.\r\n\t *\r\n\t * Read more about error logging in the {@link module:utils/log} module.\r\n\t *\r\n\t * @param {String} message The error message in an `error-name: Error message.` format.\r\n\t * During the minification process the \"Error message\" part will be removed to limit the code size\r\n\t * and a link to this error documentation will be added to the `message`.\r\n\t * @param {Object} [data] Additional data describing the error. A stringified version of this object\r\n\t * will be appended to the error message, so the data are quickly visible in the console. The original\r\n\t * data object will also be later available under the {@link #data} property.\r\n\t */\r\n\tconstructor( message, data ) {\r\n\t\tmessage = attachLinkToDocumentation( message );\r\n\r\n\t\tif ( data ) {\r\n\t\t\tmessage += ' ' + JSON.stringify( data );\r\n\t\t}\r\n\r\n\t\tsuper( message );\r\n\r\n\t\t/**\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.name = 'CKEditorError';\r\n\r\n\t\t/**\r\n\t\t * The additional error data passed to the constructor. Undefined if none was passed.\r\n\t\t *\r\n\t\t * @member {Object|undefined}\r\n\t\t */\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if error is an instance of CKEditorError class.\r\n\t *\r\n\t * @param {Object} error Object to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tstatic isCKEditorError( error ) {\r\n\t\treturn error instanceof CKEditorError;\r\n\t}\r\n}\r\n\r\n/**\r\n * Attaches link to the documentation at the end of the error message.\r\n *\r\n * @param {String} message Message to be logged.\r\n * @returns {String}\r\n */\r\nexport function attachLinkToDocumentation( message ) {\r\n\tconst matchedErrorName = message.match( /^([^:]+):/ );\r\n\r\n\tif ( !matchedErrorName ) {\r\n\t\treturn message;\r\n\t}\r\n\r\n\treturn message + ` Read more: ${ DOCUMENTATION_URL }#error-${ matchedErrorName[ 1 ] }\\n`;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* global console */\r\n\r\n/**\r\n * @module utils/log\r\n */\r\n\r\nimport { attachLinkToDocumentation } from './ckeditorerror';\r\n\r\n/**\r\n * The logging module.\r\n *\r\n * This object features two functions that should be used across CKEditor code base to log errors and warnings.\r\n * Despite being an overridable interface for native `console.*` this module serves also the goal to limit the\r\n * code size of a minified CKEditor package. During minification process the messages will be shortened and\r\n * links to their documentation will be logged to the console.\r\n *\r\n * All errors and warning should be documented in the following way:\r\n *\r\n *\t\t/**\r\n *\t\t * Error thrown when a plugin cannot be loaded due to JavaScript errors, lack of plugins with a given name, etc.\r\n *\t\t *\r\n *\t\t * @error plugin-load\r\n *\t\t * @param pluginName The name of the plugin that could not be loaded.\r\n *\t\t * @param moduleName The name of the module which tried to load this plugin.\r\n *\t\t * /\r\n *\t\tlog.error( 'plugin-load: It was not possible to load the \"{$pluginName}\" plugin in module \"{$moduleName}', {\r\n *\t\t\tpluginName: 'foo',\r\n *\t\t\tmoduleName: 'bar'\r\n *\t\t} );\r\n *\r\n * ### Warning vs Error vs Throw\r\n *\r\n * * Whenever a potentially incorrect situation occurs, which does not directly lead to an incorrect behavior,\r\n * log a warning.\r\n * * Whenever an incorrect situation occurs, but the app may continue working (although perhaps incorrectly),\r\n * log an error.\r\n * * Whenever it's really bad and it does not make sense to continue working, throw a {@link module:utils/ckeditorerror~CKEditorError}.\r\n *\r\n * @namespace\r\n */\r\nconst log = {\r\n\t/**\r\n\t * Logs an error to the console.\r\n\t *\r\n\t * Read more about error logging in the {@link module:utils/log} module.\r\n\t *\r\n\t * @param {String} message The error message in an `error-name: Error message.` format.\r\n\t * During the minification process the \"Error message\" part will be removed to limit the code size\r\n\t * and a link to this error documentation will be logged to the console.\r\n\t * @param {Object} [data] Additional data describing the error.\r\n\t */\r\n\terror( message, data ) {\r\n\t\tconsole.error( attachLinkToDocumentation( message ), data );\r\n\t},\r\n\r\n\t/**\r\n\t * Logs a warning to the console.\r\n\t *\r\n\t * Read more about error logging in the {@link module:utils/log} module.\r\n\t *\r\n\t * @param {String} message The warning message in a `warning-name: Warning message.` format.\r\n\t * During the minification process the \"Warning message\" part will be removed to limit the code size\r\n\t * and a link to this error documentation will be logged to the console.\r\n\t * @param {Object} [data] Additional data describing the warning.\r\n\t */\r\n\twarn( message, data ) {\r\n\t\tconsole.warn( attachLinkToDocumentation( message ), data );\r\n\t}\r\n};\r\n\r\nexport default log;\r\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getTarget = function (target, parent) {\n  if (parent){\n    return parent.querySelector(target);\n  }\n  return document.querySelector(target);\n};\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(target, parent) {\n                // If passing function in options, then use it for resolve \"head\" element.\n                // Useful for Shadow Root style i.e\n                // {\n                //   insertInto: function () { return document.querySelector(\"#foo\").shadowRoot }\n                // }\n                if (typeof target === 'function') {\n                        return target();\n                }\n                if (typeof memo[target] === \"undefined\") {\n\t\t\tvar styleTarget = getTarget.call(this, target, parent);\n\t\t\t// Special case to return head of iframe instead of iframe itself\n\t\t\tif (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n\t\t\t\ttry {\n\t\t\t\t\t// This will throw an exception if access to iframe is blocked\n\t\t\t\t\t// due to cross-origin restrictions\n\t\t\t\t\tstyleTarget = styleTarget.contentDocument.head;\n\t\t\t\t} catch(e) {\n\t\t\t\t\tstyleTarget = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmemo[target] = styleTarget;\n\t\t}\n\t\treturn memo[target]\n\t};\n})();\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton && typeof options.singleton !== \"boolean\") options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n        if (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else if (typeof options.insertAt === \"object\" && options.insertAt.before) {\n\t\tvar nextSibling = getElement(options.insertAt.before, target);\n\t\ttarget.insertBefore(style, nextSibling);\n\t} else {\n\t\tthrow new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\n\tif(options.attrs.nonce === undefined) {\n\t\tvar nonce = getNonce();\n\t\tif (nonce) {\n\t\t\toptions.attrs.nonce = nonce;\n\t\t}\n\t}\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction getNonce() {\n\tif (typeof __webpack_nonce__ === 'undefined') {\n\t\treturn null;\n\t}\n\n\treturn __webpack_nonce__;\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = typeof options.transform === 'function'\n\t\t ? options.transform(obj.css) \n\t\t : options.transform.default(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a.997.997 0 0 1-.745.292z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M11.591 10.177l4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z\\\"/></svg>\"","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M2 4.5V3h16v1.5zm0 3V6h5.674v1.5zm0 3V9h5.674v1.5zm0 3V12h5.674v1.5zm8.5-6V12h6V7.5h-6zM9.682 6h7.636c.377 0 .682.407.682.91v5.68c0 .503-.305.91-.682.91H9.682c-.377 0-.682-.407-.682-.91V6.91c0-.503.305-.91.682-.91zM2 16.5V15h16v1.5z\\\"/></svg>\"","module.exports = function(originalModule) {\n\tif (!originalModule.webpackPolyfill) {\n\t\tvar module = Object.create(originalModule);\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"exports\", {\n\t\t\tenumerable: true\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M2 4.5V3h16v1.5zm2.5 3V12h11V7.5h-11zM4.061 6H15.94c.586 0 1.061.407 1.061.91v5.68c0 .503-.475.91-1.061.91H4.06c-.585 0-1.06-.407-1.06-.91V6.91C3 6.406 3.475 6 4.061 6zM2 16.5V15h16v1.5z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" clip-rule=\\\"evenodd\\\" stroke-linejoin=\\\"round\\\" stroke-miterlimit=\\\"1.414\\\"><path d=\\\"M18 4.5V3H2v1.5h16zm0 3V6h-5.674v1.5H18zm0 3V9h-5.674v1.5H18zm0 3V12h-5.674v1.5H18zm-8.5-6V12h-6V7.5h6zm.818-1.5H2.682C2.305 6 2 6.407 2 6.91v5.68c0 .503.305.91.682.91h7.636c.377 0 .682-.407.682-.91V6.91c0-.503-.305-.91-.682-.91zM18 16.5V15H2v1.5h16z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M2 4.5V3h16v1.5zm4.5 3V12h7V7.5h-7zM5.758 6h8.484c.419 0 .758.407.758.91v5.681c0 .502-.34.909-.758.909H5.758c-.419 0-.758-.407-.758-.91V6.91c0-.503.34-.91.758-.91zM2 16.5V15h16v1.5z\\\"/></svg>\"","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./heading.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./heading.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./heading.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import root from './_root.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined;\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var length = buffer.length,\n      result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);\n\n  buffer.copy(result);\n  return result;\n}\n\nexport default cloneBuffer;\n","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M5.042 9.367l2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M14.958 9.367l-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M9.586 14.633l.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M3 10.423a6.5 6.5 0 0 1 6.056-6.408l.038.67C6.448 5.423 5.354 7.663 5.22 10H9c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574zm8 0a6.5 6.5 0 0 1 6.056-6.408l.038.67c-2.646.739-3.74 2.979-3.873 5.315H17c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M11.627 16.5a3.496 3.496 0 0 1 0 0zm5.873-.196a3.484 3.484 0 0 1 0 0zm0-7.001V8h-13v8.5h4.341c.191.54.457 1.044.785 1.5H2a1.5 1.5 0 0 1-1.5-1.5v-13A1.5 1.5 0 0 1 2 2h4.5a1.5 1.5 0 0 1 1.06.44L9.122 4H16a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 19 8v2.531a6.027 6.027 0 0 0-1.5-1.228zM16 6.5v-1H8.5l-2-2H2v13h1V8a1.5 1.5 0 0 1 1.5-1.5H16z\\\"/><path d=\\\"M14.5 19.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM15 14v-2h-1v2h-2v1h2v2h1v-2h2v-1h-2z\\\"/></svg>\\r\\n\"","module.exports = \"<svg viewBox=\\\"0 0 16 16\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M4 0v1H1v3H0V.5A.5.5 0 0 1 .5 0H4zm8 0h3.5a.5.5 0 0 1 .5.5V4h-1V1h-3V0zM4 16H.5a.5.5 0 0 1-.5-.5V12h1v3h3v1zm8 0v-1h3v-3h1v3.5a.5.5 0 0 1-.5.5H12z\\\"/><path fill-opacity=\\\".256\\\" d=\\\"M1 1h14v14H1z\\\"/><g class=\\\"ck-icon__selected-indicator\\\"><path d=\\\"M7 0h2v1H7V0zM0 7h1v2H0V7zm15 0h1v2h-1V7zm-8 8h2v1H7v-1z\\\"/><path fill-opacity=\\\".254\\\" d=\\\"M1 1h14v14H1z\\\"/></g></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M5.085 6.22L2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.094 11.094 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.488.488 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304c-.258.11-.51.233-.757.365l6.239 6.24-.006.005.78.78c-.388.094-.78.166-1.174.215l-1.11-1.11h.011L4.55 8.197a7.2 7.2 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10.164 10.164 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a2.563 2.563 0 0 0-.124.2c-.043.077-.08.158-.108.241a.534.534 0 0 0-.028.133.29.29 0 0 0 .008.072.927.927 0 0 0 .082.226c.067.133.145.26.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93zm7.07.531a4.632 4.632 0 0 1 1.108 5.992l.345.344.046-.018a9.313 9.313 0 0 0 2-1.112c.256-.187.5-.392.727-.613.137-.134.27-.277.392-.431.072-.091.141-.185.203-.286.057-.093.107-.19.148-.292a.72.72 0 0 0 .036-.12.29.29 0 0 0 .008-.072.492.492 0 0 0-.028-.133.999.999 0 0 0-.036-.096 2.165 2.165 0 0 0-.071-.145 2.917 2.917 0 0 0-.125-.2 3.592 3.592 0 0 0-.263-.335 5.444 5.444 0 0 0-.53-.523 7.955 7.955 0 0 0-1.054-.768 9.766 9.766 0 0 0-1.879-.891c-.337-.118-.68-.219-1.027-.301zm-2.85.21l-.069.002a.508.508 0 0 0-.254.097.496.496 0 0 0-.104.679.498.498 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.494.494 0 0 0 .45.287h.008a.496.496 0 0 0 .35-.158.482.482 0 0 0 .13-.335.638.638 0 0 0-.048-.219 3.379 3.379 0 0 0-.36-.723 3.438 3.438 0 0 0-2.791-1.543l-.028-.001h-.013z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z\\\"/></svg>\"","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 700 250\\\"><rect rx=\\\"4\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 10 10\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M.941 4.523a.75.75 0 1 1 1.06-1.06l3.006 3.005 3.005-3.005a.75.75 0 1 1 1.06 1.06l-3.549 3.55a.75.75 0 0 1-1.168-.136L.941 4.523z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M11.077 15l.991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562l-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M7.3 17.37l-.061.088a1.518 1.518 0 0 1-.934.535l-4.178.663-.806-4.153a1.495 1.495 0 0 1 .187-1.058l.056-.086L8.77 2.639c.958-1.351 2.803-1.076 4.296-.03 1.497 1.047 2.387 2.693 1.433 4.055L7.3 17.37zM9.14 4.728l-5.545 8.346 3.277 2.294 5.544-8.346L9.14 4.728zM6.07 16.512l-3.276-2.295.53 2.73 2.746-.435zM9.994 3.506L13.271 5.8c.316-.452-.16-1.333-1.065-1.966-.905-.634-1.895-.78-2.212-.328zM8 18.5L9.375 17H19v1.5H8z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M11.077 15l.991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 64 42\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M47.426 17V3.713L63.102 0v19.389h-.001l.001.272c0 1.595-2.032 3.43-4.538 4.098-2.506.668-4.538-.083-4.538-1.678 0-1.594 2.032-3.43 4.538-4.098.914-.244 2.032-.565 2.888-.603V4.516L49.076 7.447v9.556A1.014 1.014 0 0 0 49 17h-1.574zM29.5 17h-8.343a7.073 7.073 0 1 0-4.657 4.06v3.781H3.3a2.803 2.803 0 0 1-2.8-2.804V8.63a2.803 2.803 0 0 1 2.8-2.805h4.082L8.58 2.768A1.994 1.994 0 0 1 10.435 1.5h8.985c.773 0 1.477.448 1.805 1.149l1.488 3.177H26.7c1.546 0 2.8 1.256 2.8 2.805V17zm-11.637 0H17.5a1 1 0 0 0-1 1v.05A4.244 4.244 0 1 1 17.863 17zm29.684 2c.97 0 .953-.048.953.889v20.743c0 .953.016.905-.953.905H19.453c-.97 0-.953.048-.953-.905V19.89c0-.937-.016-.889.97-.889h28.077zm-4.701 19.338V22.183H24.154v16.155h18.692zM20.6 21.375v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616V37.53H20.6zm24.233-16.155v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615V37.53h-1.615zM29.485 25.283a.4.4 0 0 1 .593-.35l9.05 4.977a.4.4 0 0 1 0 .701l-9.05 4.978a.4.4 0 0 1-.593-.35v-9.956z\\\"/></svg>\\r\\n\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M18.68 2.53c.6 0 .59-.03.59.55v12.84c0 .59.01.56-.59.56H1.29c-.6 0-.59.03-.59-.56V3.08c0-.58-.01-.55.6-.55h17.38zM15.77 14.5v-10H4.2v10h11.57zM2 4v1h1V4H2zm0 2v1h1V6H2zm0 2v1h1V8H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zM17 4v1h1V4h-1zm0 2v1h1V6h-1zm0 2v1h1V8h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zM7.5 6.677a.4.4 0 0 1 .593-.351l5.133 2.824a.4.4 0 0 1 0 .7l-5.133 2.824a.4.4 0 0 1-.593-.35V6.676z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M3 6v3h4V6H3zm0 4v3h4v-3H3zm0 4v3h4v-3H3zm5 3h4v-3H8v3zm5 0h4v-3h-4v3zm4-4v-3h-4v3h4zm0-4V6h-4v3h4zm1.5 8a1.5 1.5 0 0 1-1.5 1.5H3A1.5 1.5 0 0 1 1.5 17V4c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13zM12 13v-3H8v3h4zm0-4V6H8v3h4z\\\"/></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><path d=\\\"M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z\\\" opacity=\\\".6\\\"/><path d=\\\"M18 7v1H2V7h16zm0 5v1H2v-1h16z\\\" opacity=\\\".6\\\"/><path d=\\\"M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z\\\"/></g></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><path d=\\\"M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z\\\" opacity=\\\".6\\\"/><path d=\\\"M7 2h1v16H7V2zm5 0h1v16h-1V2z\\\" opacity=\\\".6\\\"/><path d=\\\"M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z\\\"/></g></svg>\"","module.exports = \"<svg viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><path d=\\\"M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z\\\" opacity=\\\".6\\\"/><path d=\\\"M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z\\\" opacity=\\\".6\\\"/><path d=\\\"M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z\\\"/></g></svg>\"","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/version\r\n */\r\n\r\n/* globals window, global */\r\n\r\nimport log from './log';\r\nimport { version } from 'ckeditor5/package.json';\r\n\r\nconst windowOrGlobal = typeof window === 'object' ? window : global;\r\n\r\nif ( windowOrGlobal.CKEDITOR_VERSION ) {\r\n\t/**\r\n\t * This error is thrown when the `CKEDITOR_VERSION` global is being set more than once. This happens when in\r\n\t * two scenarios described above.\r\n\t *\r\n\t * # Some packages were duplicated\r\n\t *\r\n\t * CKEditor 5 was built from source packages which were duplicated during installation via npm.\r\n\t * Normally, npm deduplicates all packages so e.g. `@ckeditor/ckeditor5-core` is installed only once in `node_modules/`.\r\n\t * However, subsequent `npm install` calls or conflicting version dependencies may cause npm to install some packages\r\n\t * more than once. Furthermore, [npm in version 5+](https://github.com/npm/npm/issues/16991)\r\n\t * is also known for randomly failing to deduplicate packages.\r\n\t *\r\n\t * We recommend checking if any of the below steps helps:\r\n\t *\r\n\t * * `rm -rf node_modules && npm install` to make sure you have a clean `node_modules/` – this step\r\n\t * is known to help in majority of cases,\r\n\t * * check whether all CKEditor 5 packages are up to date and reinstall them\r\n\t * if you changed anything (`rm -rf node_modules && npm install`),\r\n\t * * downgrade npm to version 4 if you use a newer version.\r\n\t *\r\n\t * If all packages are correct and compatible with each other the above steps are known to help. If not, you may\r\n\t * try to check with `npm ls` how many times `@ckeditor/ckeditor5-core` is installed. If more than once, verify\r\n\t * which package causes that.\r\n\t *\r\n\t * # Two+ builds are loaded\r\n\t *\r\n\t * If you use CKEditor 5 builds, you might have loaded two (or more) `ckeditor.js` files in one web page\r\n\t * – check your web page for duplicated `<script>` elements or make sure your page builder/bundler includes CKEditor only once.\r\n\t *\r\n\t * @error ckeditor-version-collision\r\n\t * @param {String} collidingVersion The version of the build which has already been (incorrectly) loaded.\r\n\t * @param {String} version The version of the build which is supposed to be loaded.\r\n\t */\r\n\tlog.error( 'ckeditor-version-collision: The global CKEDITOR_VERSION constant has already been set.', {\r\n\t\tcollidingVersion: windowOrGlobal.CKEDITOR_VERSION,\r\n\t\tversion\r\n\t} );\r\n} else {\r\n\twindowOrGlobal.CKEDITOR_VERSION = version;\r\n}\r\n","\nvar content = require(\"!!../../../../postcss-loader/src/index.js??ref--5-1!./globals.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../postcss-loader/src/index.js??ref--5-1!./globals.css\", function() {\n\t\tvar newContent = require(\"!!../../../../postcss-loader/src/index.js??ref--5-1!./globals.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-hidden{display:none!important}.ck.ck-reset,.ck.ck-reset_all,.ck.ck-reset_all *{box-sizing:border-box;width:auto;height:auto;position:static}:root{--ck-z-default:1;--ck-z-modal:calc(var(--ck-z-default) + 999);--ck-color-base-foreground:#fafafa;--ck-color-base-background:#fff;--ck-color-base-border:#c4c4c4;--ck-color-base-action:#61b045;--ck-color-base-focus:#6cb5f9;--ck-color-base-text:#333;--ck-color-base-active:#198cf0;--ck-color-base-active-focus:#0e7fe1;--ck-color-base-error:#db3700;--ck-color-focus-border:#47a4f5;--ck-color-focus-shadow:rgba(119,186,248,0.5);--ck-color-focus-disabled-shadow:rgba(119,186,248,0.3);--ck-color-focus-error-shadow:rgba(255,64,31,0.3);--ck-color-text:var(--ck-color-base-text);--ck-color-shadow-drop:rgba(0,0,0,0.15);--ck-color-shadow-inner:rgba(0,0,0,0.1);--ck-color-button-default-background:transparent;--ck-color-button-default-hover-background:#e6e6e6;--ck-color-button-default-active-background:#d9d9d9;--ck-color-button-default-active-shadow:#bfbfbf;--ck-color-button-default-disabled-background:transparent;--ck-color-button-on-background:#dedede;--ck-color-button-on-hover-background:#c4c4c4;--ck-color-button-on-active-background:#bababa;--ck-color-button-on-active-shadow:#a1a1a1;--ck-color-button-on-disabled-background:#dedede;--ck-color-button-action-background:var(--ck-color-base-action);--ck-color-button-action-hover-background:#579e3d;--ck-color-button-action-active-background:#53973b;--ck-color-button-action-active-shadow:#498433;--ck-color-button-action-disabled-background:#7ec365;--ck-color-button-action-text:var(--ck-color-base-background);--ck-color-button-save:#008a00;--ck-color-button-cancel:#db3700;--ck-color-switch-button-off-background:#b0b0b0;--ck-color-switch-button-on-background:var(--ck-color-button-action-background);--ck-color-switch-button-inner-background:var(--ck-color-base-background);--ck-color-dropdown-panel-background:var(--ck-color-base-background);--ck-color-dropdown-panel-border:var(--ck-color-base-border);--ck-color-input-background:var(--ck-color-base-background);--ck-color-input-border:#c7c7c7;--ck-color-input-error-border:var(--ck-color-base-error);--ck-color-input-text:var(--ck-color-base-text);--ck-color-input-disabled-background:#f2f2f2;--ck-color-input-disabled-border:#c7c7c7;--ck-color-input-disabled-text:#5c5c5c;--ck-color-list-background:var(--ck-color-base-background);--ck-color-list-button-hover-background:var(--ck-color-base-foreground);--ck-color-list-button-on-background:var(--ck-color-base-active);--ck-color-list-button-on-background-focus:var(--ck-color-base-active-focus);--ck-color-list-button-on-text:var(--ck-color-base-background);--ck-color-panel-background:var(--ck-color-base-background);--ck-color-panel-border:var(--ck-color-base-border);--ck-color-toolbar-background:var(--ck-color-base-foreground);--ck-color-toolbar-border:var(--ck-color-base-border);--ck-color-tooltip-background:var(--ck-color-base-text);--ck-color-tooltip-text:var(--ck-color-base-background);--ck-color-engine-placeholder-text:#c2c2c2;--ck-color-upload-bar-background:#6cb5f9;--ck-color-upload-infinite-background:rgba(0,0,0,0.1);--ck-color-link-default:#0000f0;--ck-color-link-selected-background:rgba(31,177,255,0.1);--ck-disabled-opacity:.5;--ck-focus-outer-shadow-geometry:0 0 0 3px;--ck-focus-outer-shadow:var(--ck-focus-outer-shadow-geometry) var(--ck-color-focus-shadow);--ck-focus-disabled-outer-shadow:var(--ck-focus-outer-shadow-geometry) var(--ck-color-focus-disabled-shadow);--ck-focus-error-outer-shadow:var(--ck-focus-outer-shadow-geometry) var(--ck-color-focus-error-shadow);--ck-focus-ring:1px solid var(--ck-color-focus-border);--ck-font-size-base:13px;--ck-line-height-base:1.84615;--ck-font-face:Helvetica,Arial,Tahoma,Verdana,Sans-Serif;--ck-font-size-tiny:0.7em;--ck-font-size-small:0.75em;--ck-font-size-normal:1em;--ck-font-size-big:1.4em;--ck-font-size-large:1.8em;--ck-ui-component-min-height:2.3em}.ck.ck-reset,.ck.ck-reset_all,.ck.ck-reset_all *{margin:0;padding:0;border:0;background:transparent;text-decoration:none;vertical-align:middle;transition:none;word-wrap:break-word}.ck.ck-reset_all,.ck.ck-reset_all *{border-collapse:collapse;font:normal normal normal var(--ck-font-size-base)/var(--ck-line-height-base) var(--ck-font-face);color:var(--ck-color-text);text-align:left;white-space:nowrap;cursor:auto;float:none}.ck.ck-reset_all .ck-rtl *{text-align:right}.ck.ck-reset_all iframe{vertical-align:inherit}.ck.ck-reset_all textarea{white-space:pre-wrap}.ck.ck-reset_all input[type=password],.ck.ck-reset_all input[type=text],.ck.ck-reset_all textarea{cursor:text}.ck.ck-reset_all input[type=password][disabled],.ck.ck-reset_all input[type=text][disabled],.ck.ck-reset_all textarea[disabled]{cursor:default}.ck.ck-reset_all fieldset{padding:10px;border:2px groove #dfdee3}.ck.ck-reset_all button::-moz-focus-inner{padding:0;border:0}:root{--ck-border-radius:2px;--ck-inner-shadow:2px 2px 3px var(--ck-color-shadow-inner) inset;--ck-drop-shadow:0 1px 2px 1px var(--ck-color-shadow-drop);--ck-spacing-unit:0.6em;--ck-spacing-large:calc(var(--ck-spacing-unit)*1.5);--ck-spacing-standard:var(--ck-spacing-unit);--ck-spacing-medium:calc(var(--ck-spacing-unit)*0.8);--ck-spacing-small:calc(var(--ck-spacing-unit)*0.5);--ck-spacing-tiny:calc(var(--ck-spacing-unit)*0.3);--ck-spacing-extra-tiny:calc(var(--ck-spacing-unit)*0.16)}\"","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./editorui.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./editorui.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./editorui.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-editor__editable:not(.ck-editor__nested-editable){border-radius:0}.ck-rounded-corners .ck.ck-editor__editable:not(.ck-editor__nested-editable),.ck.ck-editor__editable:not(.ck-editor__nested-editable).ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-editor__editable:not(.ck-editor__nested-editable).ck-focused{outline:none;border:var(--ck-focus-ring);box-shadow:var(--ck-inner-shadow),0 0}.ck.ck-editor__editable_inline{overflow:auto;padding:0 var(--ck-spacing-standard);border:1px solid transparent}.ck.ck-editor__editable_inline>:first-child{margin-top:var(--ck-spacing-large)}.ck.ck-editor__editable_inline>:last-child{margin-bottom:var(--ck-spacing-large)}.ck.ck-balloon-panel.ck-toolbar-container[class*=arrow_n]:after{border-bottom-color:var(--ck-color-base-foreground)}.ck.ck-balloon-panel.ck-toolbar-container[class*=arrow_s]:after{border-top-color:var(--ck-color-base-foreground)}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./label.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./label.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./label.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-label{display:block}.ck.ck-voice-label{display:none}.ck.ck-label{font-weight:700}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./stickypanel.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./stickypanel.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./stickypanel.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-sticky-panel .ck-sticky-panel__content_sticky{z-index:var(--ck-z-modal);position:fixed;top:0}.ck.ck-sticky-panel .ck-sticky-panel__content_sticky_bottom-limit{top:auto;position:absolute}.ck.ck-sticky-panel .ck-sticky-panel__content_sticky{box-shadow:var(--ck-drop-shadow),0 0;border-width:0 1px 1px;border-top-left-radius:0;border-top-right-radius:0}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbar.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbar.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbar.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-toolbar{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex-flow:row wrap;align-items:center}.ck.ck-toolbar.ck-toolbar_vertical{flex-direction:column}.ck.ck-toolbar.ck-toolbar_floating{flex-wrap:nowrap}.ck.ck-toolbar__separator{display:inline-block}.ck.ck-toolbar__newline{display:block;width:100%}.ck.ck-toolbar{border-radius:0}.ck-rounded-corners .ck.ck-toolbar,.ck.ck-toolbar.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-toolbar{background:var(--ck-color-toolbar-background);padding:0 var(--ck-spacing-small);border:1px solid var(--ck-color-toolbar-border)}.ck.ck-toolbar>*{margin-right:var(--ck-spacing-small);margin-top:var(--ck-spacing-small);margin-bottom:var(--ck-spacing-small)}.ck.ck-toolbar.ck-toolbar_vertical{padding:0}.ck.ck-toolbar.ck-toolbar_vertical>*{width:100%;margin:0;border-radius:0;border:0}.ck.ck-toolbar>:last-child{margin-right:0}.ck-toolbar-container .ck.ck-toolbar{border:0}.ck.ck-toolbar__separator{align-self:stretch;width:1px;margin-top:0;margin-bottom:0;background:var(--ck-color-toolbar-border)}.ck.ck-toolbar__newline{margin:0}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./classiceditor.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./classiceditor.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./classiceditor.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-editor{position:relative}.ck.ck-editor .ck-editor__top .ck-sticky-panel .ck-toolbar{z-index:var(--ck-z-modal)}.ck.ck-editor__top .ck-sticky-panel .ck-toolbar{border-radius:0}.ck-rounded-corners .ck.ck-editor__top .ck-sticky-panel .ck-toolbar,.ck.ck-editor__top .ck-sticky-panel .ck-toolbar.ck-rounded-corners{border-radius:var(--ck-border-radius);border-bottom-left-radius:0;border-bottom-right-radius:0}.ck.ck-editor__top .ck-sticky-panel .ck-toolbar{border-bottom-width:0}.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content_sticky .ck-toolbar{border-bottom-width:1px;border-radius:0}.ck-rounded-corners .ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content_sticky .ck-toolbar,.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content_sticky .ck-toolbar.ck-rounded-corners{border-radius:var(--ck-border-radius);border-radius:0}.ck.ck-editor__main>.ck-editor__editable{background:var(--ck-color-base-background);border-radius:0}.ck-rounded-corners .ck.ck-editor__main>.ck-editor__editable,.ck.ck-editor__main>.ck-editor__editable.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0;border-top-right-radius:0}.ck.ck-editor__main>.ck-editor__editable:not(.ck-focused){border-color:var(--ck-color-base-border)}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./icon.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./icon.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./icon.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-icon{vertical-align:middle}:root{--ck-icon-size:calc(var(--ck-line-height-base)*var(--ck-font-size-normal))}.ck.ck-icon{width:var(--ck-icon-size);height:var(--ck-icon-size);font-size:.8333350694em;will-change:transform}.ck.ck-icon,.ck.ck-icon *{color:inherit;cursor:inherit}.ck.ck-icon :not([fill]){fill:currentColor}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./tooltip.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./tooltip.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./tooltip.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-tooltip,.ck.ck-tooltip .ck-tooltip__text:after{position:absolute;pointer-events:none;-webkit-backface-visibility:hidden}.ck-tooltip{visibility:hidden;opacity:0;display:none;z-index:var(--ck-z-modal)}.ck-tooltip .ck-tooltip__text{display:inline-block}.ck-tooltip .ck-tooltip__text:after{content:\\\"\\\";width:0;height:0}:root{--ck-tooltip-arrow-size:5px}.ck.ck-tooltip{left:50%}.ck.ck-tooltip.ck-tooltip_s{bottom:calc(-1*var(--ck-tooltip-arrow-size));transform:translateY(100%)}.ck.ck-tooltip.ck-tooltip_s .ck-tooltip__text:after{top:calc(-1*var(--ck-tooltip-arrow-size));transform:translateX(-50%);border-left-color:transparent;border-bottom-color:var(--ck-color-tooltip-background);border-right-color:transparent;border-top-color:transparent;border-left-width:var(--ck-tooltip-arrow-size);border-bottom-width:var(--ck-tooltip-arrow-size);border-right-width:var(--ck-tooltip-arrow-size);border-top-width:0}.ck.ck-tooltip.ck-tooltip_n{top:calc(-1*var(--ck-tooltip-arrow-size));transform:translateY(-100%)}.ck.ck-tooltip.ck-tooltip_n .ck-tooltip__text:after{bottom:calc(-1*var(--ck-tooltip-arrow-size));transform:translateX(-50%);border-left-color:transparent;border-bottom-color:transparent;border-right-color:transparent;border-top-color:var(--ck-color-tooltip-background);border-left-width:var(--ck-tooltip-arrow-size);border-bottom-width:0;border-right-width:var(--ck-tooltip-arrow-size);border-top-width:var(--ck-tooltip-arrow-size)}.ck.ck-tooltip .ck-tooltip__text{border-radius:0}.ck-rounded-corners .ck.ck-tooltip .ck-tooltip__text,.ck.ck-tooltip .ck-tooltip__text.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-tooltip .ck-tooltip__text{font-size:.9em;line-height:1.5;color:var(--ck-color-tooltip-text);padding:var(--ck-spacing-small) var(--ck-spacing-medium);background:var(--ck-color-tooltip-background);position:relative;left:-50%}.ck.ck-tooltip .ck-tooltip__text:after{border-style:solid;left:50%}.ck.ck-tooltip,.ck.ck-tooltip .ck-tooltip__text:after{transition:opacity .2s ease-in-out .2s}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./button.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./button.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./button.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-button,a.ck.ck-button{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.ck.ck-button .ck-tooltip,a.ck.ck-button .ck-tooltip{display:block}@media (hover:none){.ck.ck-button .ck-tooltip,a.ck.ck-button .ck-tooltip{display:none}}.ck.ck-button,a.ck.ck-button{position:relative;display:inline-flex;align-items:center;justify-content:left}.ck.ck-button.ck-button_with-text .ck-button__label,a.ck.ck-button.ck-button_with-text .ck-button__label{display:inline-block}.ck.ck-button:not(.ck-button_with-text),a.ck.ck-button:not(.ck-button_with-text){justify-content:center}.ck.ck-button:hover .ck-tooltip,a.ck.ck-button:hover .ck-tooltip{visibility:visible;opacity:1}.ck.ck-button .ck-button__label,.ck.ck-button:focus:not(:hover) .ck-tooltip,a.ck.ck-button .ck-button__label,a.ck.ck-button:focus:not(:hover) .ck-tooltip{display:none}.ck.ck-button,a.ck.ck-button{background:var(--ck-color-button-default-background)}.ck.ck-button:not(.ck-disabled):hover,a.ck.ck-button:not(.ck-disabled):hover{background:var(--ck-color-button-default-hover-background)}.ck.ck-button:not(.ck-disabled):active,a.ck.ck-button:not(.ck-disabled):active{background:var(--ck-color-button-default-active-background);box-shadow:inset 0 2px 2px var(--ck-color-button-default-active-shadow)}.ck.ck-button.ck-disabled,a.ck.ck-button.ck-disabled{background:var(--ck-color-button-default-disabled-background)}.ck.ck-button,a.ck.ck-button{border-radius:0}.ck-rounded-corners .ck.ck-button,.ck-rounded-corners a.ck.ck-button,.ck.ck-button.ck-rounded-corners,a.ck.ck-button.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-button,a.ck.ck-button{white-space:nowrap;cursor:default;vertical-align:middle;padding:var(--ck-spacing-tiny);text-align:center;min-width:var(--ck-ui-component-min-height);min-height:var(--ck-ui-component-min-height);line-height:1;font-size:inherit;border:1px solid transparent;transition:box-shadow .2s ease-in-out;-webkit-appearance:none}.ck.ck-button:active,.ck.ck-button:focus,a.ck.ck-button:active,a.ck.ck-button:focus{outline:none;border:var(--ck-focus-ring);box-shadow:var(--ck-focus-outer-shadow),0 0;border-color:transparent}.ck.ck-button.ck-disabled:active,.ck.ck-button.ck-disabled:focus,a.ck.ck-button.ck-disabled:active,a.ck.ck-button.ck-disabled:focus{box-shadow:var(--ck-focus-disabled-outer-shadow),0 0}.ck.ck-button.ck-disabled .ck-button__icon,a.ck.ck-button.ck-disabled .ck-button__icon{opacity:var(--ck-disabled-opacity)}.ck.ck-button.ck-disabled .ck-button__label,a.ck.ck-button.ck-disabled .ck-button__label{opacity:var(--ck-disabled-opacity)}.ck.ck-button.ck-button_with-text,a.ck.ck-button.ck-button_with-text{padding:var(--ck-spacing-tiny) var(--ck-spacing-standard)}.ck.ck-button.ck-button_with-text .ck-button__icon,a.ck.ck-button.ck-button_with-text .ck-button__icon{margin-left:calc(-1*var(--ck-spacing-small));margin-right:var(--ck-spacing-small)}.ck.ck-button.ck-on,a.ck.ck-button.ck-on{background:var(--ck-color-button-on-background)}.ck.ck-button.ck-on:not(.ck-disabled):hover,a.ck.ck-button.ck-on:not(.ck-disabled):hover{background:var(--ck-color-button-on-hover-background)}.ck.ck-button.ck-on:not(.ck-disabled):active,a.ck.ck-button.ck-on:not(.ck-disabled):active{background:var(--ck-color-button-on-active-background);box-shadow:inset 0 2px 2px var(--ck-color-button-on-active-shadow)}.ck.ck-button.ck-on.ck-disabled,a.ck.ck-button.ck-on.ck-disabled{background:var(--ck-color-button-on-disabled-background)}.ck.ck-button.ck-button-save,a.ck.ck-button.ck-button-save{color:var(--ck-color-button-save)}.ck.ck-button.ck-button-cancel,a.ck.ck-button.ck-button-cancel{color:var(--ck-color-button-cancel)}.ck.ck-button .ck-button__icon use,.ck.ck-button .ck-button__icon use *,a.ck.ck-button .ck-button__icon use,a.ck.ck-button .ck-button__icon use *{color:inherit}.ck.ck-button .ck-button__label,a.ck.ck-button .ck-button__label{font-size:inherit;font-weight:inherit;color:inherit;cursor:inherit;vertical-align:middle}.ck.ck-button-action,a.ck.ck-button-action{background:var(--ck-color-button-action-background)}.ck.ck-button-action:not(.ck-disabled):hover,a.ck.ck-button-action:not(.ck-disabled):hover{background:var(--ck-color-button-action-hover-background)}.ck.ck-button-action:not(.ck-disabled):active,a.ck.ck-button-action:not(.ck-disabled):active{background:var(--ck-color-button-action-active-background);box-shadow:inset 0 2px 2px var(--ck-color-button-action-active-shadow)}.ck.ck-button-action.ck-disabled,a.ck.ck-button-action.ck-disabled{background:var(--ck-color-button-action-disabled-background)}.ck.ck-button-action,a.ck.ck-button-action{color:var(--ck-color-button-action-text)}.ck.ck-button-bold,a.ck.ck-button-bold{font-weight:700}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./blockquote.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./blockquote.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./blockquote.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content blockquote{overflow:hidden;padding-right:1.5em;padding-left:1.5em;margin-left:0;font-style:italic;border-left:5px solid #ccc}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./widget.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./widget.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./widget.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck .ck-widget.ck-widget_selectable{position:relative}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler{visibility:hidden;position:absolute}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler .ck-icon{display:block}.ck .ck-widget.ck-widget_selectable.ck-widget_selected .ck-widget__selection-handler,.ck .ck-widget.ck-widget_selectable:hover .ck-widget__selection-handler{visibility:visible}:root{--ck-widget-outline-thickness:3px;--ck-widget-handler-icon-size:16px;--ck-widget-handler-animation-duration:200ms;--ck-widget-handler-animation-curve:ease;--ck-color-widget-blurred-border:#dedede;--ck-color-widget-hover-border:#ffc83d;--ck-color-widget-editable-focus-background:var(--ck-color-base-background);--ck-color-widget-drag-handler-icon-color:var(--ck-color-base-background)}.ck .ck-widget{outline-width:var(--ck-widget-outline-thickness);outline-style:solid;outline-color:transparent;transition:outline-color var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve)}.ck .ck-widget.ck-widget_selected,.ck .ck-widget.ck-widget_selected:hover{outline:var(--ck-widget-outline-thickness) solid var(--ck-color-focus-border)}.ck .ck-widget:hover{outline-color:var(--ck-color-widget-hover-border)}.ck .ck-editor__nested-editable{border:1px solid transparent}.ck .ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck .ck-editor__nested-editable:focus{outline:none;border:var(--ck-focus-ring);box-shadow:var(--ck-inner-shadow),0 0;background-color:var(--ck-color-widget-editable-focus-background)}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler{padding:4px;box-sizing:border-box;background-color:transparent;opacity:0;transition:background-color var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve),visibility var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve),opacity var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve);border-radius:var(--ck-border-radius) var(--ck-border-radius) 0 0;transform:translateY(-100%);left:calc(0px - var(--ck-widget-outline-thickness))}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler:hover .ck-icon .ck-icon__selected-indicator{opacity:1}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler .ck-icon{width:var(--ck-widget-handler-icon-size);height:var(--ck-widget-handler-icon-size);color:var(--ck-color-widget-drag-handler-icon-color)}.ck .ck-widget.ck-widget_selectable .ck-widget__selection-handler .ck-icon .ck-icon__selected-indicator{opacity:0;transition:opacity .3s var(--ck-widget-handler-animation-curve)}.ck .ck-widget.ck-widget_selectable.ck-widget_selected .ck-widget__selection-handler,.ck .ck-widget.ck-widget_selectable.ck-widget_selected:hover .ck-widget__selection-handler{opacity:1;background-color:var(--ck-color-focus-border)}.ck .ck-widget.ck-widget_selectable.ck-widget_selected .ck-widget__selection-handler .ck-icon .ck-icon__selected-indicator,.ck .ck-widget.ck-widget_selectable.ck-widget_selected:hover .ck-widget__selection-handler .ck-icon .ck-icon__selected-indicator{opacity:1}.ck .ck-widget.ck-widget_selectable:hover .ck-widget__selection-handler{opacity:1;background-color:var(--ck-color-widget-hover-border)}.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected,.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected:hover{outline-color:var(--ck-color-widget-blurred-border)}.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected .ck-widget__selection-handler,.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected .ck-widget__selection-handler:hover,.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected:hover .ck-widget__selection-handler,.ck-editor__editable.ck-blurred .ck-widget.ck-widget_selected:hover .ck-widget__selection-handler:hover{background:var(--ck-color-widget-blurred-border)}.ck-editor__editable.ck-read-only .ck-widget{--ck-widget-outline-thickness:0}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./labeledinput.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./labeledinput.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./labeledinput.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-labeled-input .ck-labeled-input__status{font-size:var(--ck-font-size-small);margin-top:var(--ck-spacing-small);white-space:normal}.ck.ck-labeled-input .ck-labeled-input__status_error{color:var(--ck-color-base-error)}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./inputtext.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./inputtext.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./inputtext.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \":root{--ck-input-text-width:18em}.ck.ck-input-text{border-radius:0}.ck-rounded-corners .ck.ck-input-text,.ck.ck-input-text.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-input-text{box-shadow:var(--ck-inner-shadow),0 0;background:var(--ck-color-input-background);border:1px solid var(--ck-color-input-border);padding:var(--ck-spacing-extra-tiny) var(--ck-spacing-medium);min-width:var(--ck-input-text-width);min-height:var(--ck-ui-component-min-height);transition-property:box-shadow,border;transition:.2s ease-in-out}.ck.ck-input-text:focus{outline:none;border:var(--ck-focus-ring);box-shadow:var(--ck-focus-outer-shadow),var(--ck-inner-shadow)}.ck.ck-input-text[readonly]{border:1px solid var(--ck-color-input-disabled-border);background:var(--ck-color-input-disabled-background);color:var(--ck-color-input-disabled-text)}.ck.ck-input-text[readonly]:focus{box-shadow:var(--ck-focus-disabled-outer-shadow),var(--ck-inner-shadow)}.ck.ck-input-text.ck-error{border-color:var(--ck-color-input-error-border);animation:ck-text-input-shake .3s ease both}.ck.ck-input-text.ck-error:focus{box-shadow:var(--ck-focus-error-outer-shadow),var(--ck-inner-shadow)}@keyframes ck-text-input-shake{20%{transform:translateX(-2px)}40%{transform:translateX(2px)}60%{transform:translateX(-1px)}80%{transform:translateX(1px)}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./textalternativeform.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./textalternativeform.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./textalternativeform.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-text-alternative-form{display:flex;flex-direction:row;flex-wrap:nowrap}.ck.ck-text-alternative-form .ck-labeled-input{display:inline-block}.ck.ck-text-alternative-form .ck-label{display:none}@media screen and (max-width:600px){.ck.ck-text-alternative-form{flex-wrap:wrap}.ck.ck-text-alternative-form .ck-labeled-input{flex-basis:100%}.ck.ck-text-alternative-form .ck-button{flex-basis:50%}}.ck.ck-text-alternative-form{padding:var(--ck-spacing-standard)}.ck.ck-text-alternative-form:focus{outline:none}.ck.ck-text-alternative-form>:not(:first-child){margin-left:var(--ck-spacing-standard)}@media screen and (max-width:600px){.ck.ck-text-alternative-form{padding:0;width:calc(0.8*var(--ck-input-text-width))}.ck.ck-text-alternative-form .ck-labeled-input{margin:var(--ck-spacing-standard) var(--ck-spacing-standard) 0}.ck.ck-text-alternative-form .ck-labeled-input .ck-input-text{min-width:0;width:100%}.ck.ck-text-alternative-form .ck-button{padding:var(--ck-spacing-standard);margin-top:var(--ck-spacing-standard);margin-left:0;border-radius:0;border:0;border-top:1px solid var(--ck-color-base-border)}.ck.ck-text-alternative-form .ck-button:first-of-type{border-right:1px solid var(--ck-color-base-border)}}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./balloonpanel.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./balloonpanel.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./balloonpanel.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \":root{--ck-balloon-panel-arrow-z-index:calc(var(--ck-z-default) - 3)}.ck.ck-balloon-panel{display:none;position:absolute;z-index:var(--ck-z-modal)}.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:after,.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:before{content:\\\"\\\";position:absolute}.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:before{z-index:var(--ck-balloon-panel-arrow-z-index)}.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:after{z-index:calc(var(--ck-balloon-panel-arrow-z-index) + 1)}.ck.ck-balloon-panel[class*=arrow_n]:before{z-index:var(--ck-balloon-panel-arrow-z-index)}.ck.ck-balloon-panel[class*=arrow_n]:after{z-index:calc(var(--ck-balloon-panel-arrow-z-index) + 1)}.ck.ck-balloon-panel[class*=arrow_s]:before{z-index:var(--ck-balloon-panel-arrow-z-index)}.ck.ck-balloon-panel[class*=arrow_s]:after{z-index:calc(var(--ck-balloon-panel-arrow-z-index) + 1)}.ck.ck-balloon-panel.ck-balloon-panel_visible{display:block}:root{--ck-balloon-arrow-offset:2px;--ck-balloon-arrow-height:10px;--ck-balloon-arrow-half-width:8px}.ck.ck-balloon-panel{border-radius:0}.ck-rounded-corners .ck.ck-balloon-panel,.ck.ck-balloon-panel.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-balloon-panel{box-shadow:var(--ck-drop-shadow),0 0;min-height:15px;background:var(--ck-color-panel-background);border:1px solid var(--ck-color-panel-border)}.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:after,.ck.ck-balloon-panel.ck-balloon-panel_with-arrow:before{width:0;height:0;border-style:solid}.ck.ck-balloon-panel[class*=arrow_n]:after,.ck.ck-balloon-panel[class*=arrow_n]:before{border-left-width:var(--ck-balloon-arrow-half-width);border-bottom-width:var(--ck-balloon-arrow-height);border-right-width:var(--ck-balloon-arrow-half-width);border-top-width:0}.ck.ck-balloon-panel[class*=arrow_n]:before{border-bottom-color:var(--ck-color-panel-border)}.ck.ck-balloon-panel[class*=arrow_n]:after,.ck.ck-balloon-panel[class*=arrow_n]:before{border-left-color:transparent;border-right-color:transparent;border-top-color:transparent}.ck.ck-balloon-panel[class*=arrow_n]:after{border-bottom-color:var(--ck-color-panel-background);margin-top:var(--ck-balloon-arrow-offset)}.ck.ck-balloon-panel[class*=arrow_s]:after,.ck.ck-balloon-panel[class*=arrow_s]:before{border-left-width:var(--ck-balloon-arrow-half-width);border-bottom-width:0;border-right-width:var(--ck-balloon-arrow-half-width);border-top-width:var(--ck-balloon-arrow-height)}.ck.ck-balloon-panel[class*=arrow_s]:before{border-top-color:var(--ck-color-panel-border)}.ck.ck-balloon-panel[class*=arrow_s]:after,.ck.ck-balloon-panel[class*=arrow_s]:before{border-left-color:transparent;border-bottom-color:transparent;border-right-color:transparent}.ck.ck-balloon-panel[class*=arrow_s]:after{border-top-color:var(--ck-color-panel-background);margin-bottom:var(--ck-balloon-arrow-offset)}.ck.ck-balloon-panel.ck-balloon-panel_arrow_n:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_n:before{left:50%;margin-left:calc(-1*var(--ck-balloon-arrow-half-width));top:calc(-1*var(--ck-balloon-arrow-height))}.ck.ck-balloon-panel.ck-balloon-panel_arrow_nw:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_nw:before{left:calc(2*var(--ck-balloon-arrow-half-width));top:calc(-1*var(--ck-balloon-arrow-height))}.ck.ck-balloon-panel.ck-balloon-panel_arrow_ne:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_ne:before{right:calc(2*var(--ck-balloon-arrow-half-width));top:calc(-1*var(--ck-balloon-arrow-height))}.ck.ck-balloon-panel.ck-balloon-panel_arrow_s:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_s:before{left:50%;margin-left:calc(-1*var(--ck-balloon-arrow-half-width));bottom:calc(-1*var(--ck-balloon-arrow-height))}.ck.ck-balloon-panel.ck-balloon-panel_arrow_sw:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_sw:before{left:calc(2*var(--ck-balloon-arrow-half-width));bottom:calc(-1*var(--ck-balloon-arrow-height))}.ck.ck-balloon-panel.ck-balloon-panel_arrow_se:after,.ck.ck-balloon-panel.ck-balloon-panel_arrow_se:before{right:calc(2*var(--ck-balloon-arrow-half-width));bottom:calc(-1*var(--ck-balloon-arrow-height))}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./image.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./image.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./image.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content .image{clear:both;text-align:center;margin:1em 0}.ck-content .image>img{display:block;margin:0 auto;max-width:100%}\"","\nvar content = require(\"!!../../../../css-loader/dist/cjs.js!../../../../sass-loader/lib/loader.js!./filePickDialogStyle.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../css-loader/dist/cjs.js!../../../../sass-loader/lib/loader.js!./filePickDialogStyle.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../css-loader/dist/cjs.js!../../../../sass-loader/lib/loader.js!./filePickDialogStyle.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".visible {\\n  display: flex !important;\\n  z-index: 1; }\\n\\ndiv#dialogue {\\n  display: none;\\n  flex-direction: column;\\n  width: 640px;\\n  height: 640px;\\n  position: absolute;\\n  background: #f8f8f8; }\\n  div#dialogue div#dialogue_title {\\n    display: flex;\\n    width: 640px;\\n    height: 40px;\\n    background: #f8f8f8;\\n    cursor: move;\\n    color: #484848;\\n    border-bottom: 1px solid #d1d1d1; }\\n    div#dialogue div#dialogue_title span {\\n      display: flex;\\n      align-self: center;\\n      font-weight: bold;\\n      font-size: 12px;\\n      padding: 12px 19px 12px 12px;\\n      letter-spacing: .3px;\\n      color: #484848; }\\n  div#dialogue div#dialogue_content {\\n    padding: 5px 10px 10px 9px; }\\n    div#dialogue div#dialogue_content div#pictures {\\n      display: flex;\\n      flex-direction: row;\\n      height: 380px;\\n      flex-wrap: wrap; }\\n      div#dialogue div#dialogue_content div#pictures div.picture_box {\\n        display: flex;\\n        flex-direction: column;\\n        width: 125px;\\n        height: 95px;\\n        margin: 10px;\\n        border: 5px solid;\\n        border-radius: 10px;\\n        border-color: #dedede; }\\n        div#dialogue div#dialogue_content div#pictures div.picture_box div.picture_box_main {\\n          overflow: hidden; }\\n          div#dialogue div#dialogue_content div#pictures div.picture_box div.picture_box_main img {\\n            max-width: 100%; }\\n        div#dialogue div#dialogue_content div#pictures div.picture_box div.picture_box_name span {\\n          overflow: hidden;\\n          display: inline-block;\\n          max-width: 100%;\\n          height: 18px; }\\n    div#dialogue div#dialogue_content div#dialogue_controls {\\n      display: flex;\\n      flex-direction: column;\\n      height: 180px; }\\n      div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick {\\n        display: flex;\\n        flex-direction: row;\\n        height: 60px; }\\n        div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#link {\\n          display: flex;\\n          flex-direction: column;\\n          width: 50%;\\n          padding-right: 10px; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#link div.caption {\\n            display: flex;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#link div.caption label {\\n              font: normal normal normal 12px Arial,Helvetica,Tahoma,Verdana,Sans-Serif;\\n              color: #000;\\n              text-align: left;\\n              display: flex;\\n              align-self: flex-end; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#link div.input {\\n            display: flex;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#link div.input input#link_input {\\n              width: 100%; }\\n        div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#upload {\\n          display: flex;\\n          flex-direction: column;\\n          width: 50%; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#upload div.caption {\\n            display: flex;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#upload div.caption label {\\n              margin-bottom: 4px;\\n              display: flex;\\n              align-self: flex-end;\\n              font: 12px Arial,Helvetica,Tahoma,Verdana,Sans-Serif;\\n              font-weight: bold; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#upload div.input {\\n            display: flex;\\n            flex-direction: row;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_pick div#upload div.input form.files_upload {\\n              font: normal normal normal 12px Arial,Helvetica,Tahoma,Verdana,Sans-Serif;\\n              color: #000;\\n              text-align: left; }\\n      div#dialogue div#dialogue_content div#dialogue_controls div#alt_txt {\\n        display: flex;\\n        flex-direction: column;\\n        height: 60px; }\\n        div#dialogue div#dialogue_content div#dialogue_controls div#alt_txt div.caption {\\n          display: flex;\\n          height: 50%; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#alt_txt div.caption label {\\n            display: flex;\\n            align-self: flex-end;\\n            font: normal normal normal 12px Arial,Helvetica,Tahoma,Verdana,Sans-Serif;\\n            letter-spacing: .3px; }\\n        div#dialogue div#dialogue_content div#dialogue_controls div#alt_txt div.input {\\n          display: flex;\\n          height: 50%; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#alt_txt div.input input#alttxt_input {\\n            width: 100%; }\\n      div#dialogue div#dialogue_content div#dialogue_controls div#pic_props {\\n        display: flex;\\n        flex-direction: row;\\n        height: 60px; }\\n        div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop {\\n          display: flex;\\n          flex-direction: column;\\n          width: 16.66%; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop div.caption {\\n            display: flex;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop div.caption span {\\n              font-size: 12px;\\n              align-self: flex-end; }\\n          div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop div.input {\\n            display: flex;\\n            height: 50%; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop div.input input {\\n              width: 79px;\\n              height: 18px;\\n              padding: 4px 6px 4px 6px; }\\n            div#dialogue div#dialogue_content div#dialogue_controls div#pic_props div.pic_prop div.input select {\\n              width: 100%; }\\n  div#dialogue div#dialogue_footer {\\n    display: flex;\\n    flex-direction: row; }\\n    div#dialogue div#dialogue_footer span.footer_button {\\n      height: 24px;\\n      min-width: 64px;\\n      width: fit-content;\\n      background-color: green;\\n      border-width: 1px;\\n      border-style: solid;\\n      margin-left: 8px;\\n      margin-right: 8px;\\n      vertical-align: center;\\n      text-align: center;\\n      align-content: center;\\n      text-align: center; }\\n\", \"\"]);\n\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return '@media ' + item[2] + '{' + content + '}';\n      } else {\n        return content;\n      }\n    }).join('');\n  }; // import a list of modules into the list\n\n\n  list.i = function (modules, mediaQuery) {\n    if (typeof modules === 'string') {\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    for (var i = 0; i < this.length; i++) {\n      var id = this[i][0];\n\n      if (id != null) {\n        alreadyImportedModules[id] = true;\n      }\n    }\n\n    for (i = 0; i < modules.length; i++) {\n      var item = modules[i]; // skip already imported module\n      // this implementation is not 100% perfect for weird media query combinations\n      // when a module is imported multiple times with different media queries.\n      // I hope this will never occur (Hey this way we have smaller bundles)\n\n      if (item[0] == null || !alreadyImportedModules[item[0]]) {\n        if (mediaQuery && !item[2]) {\n          item[2] = mediaQuery;\n        } else if (mediaQuery) {\n          item[2] = '(' + item[2] + ') and (' + mediaQuery + ')';\n        }\n\n        list.push(item);\n      }\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || '';\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */';\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n  return '/*# ' + data + ' */';\n}","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadprogress.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadprogress.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadprogress.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content .image{position:relative;overflow:hidden}.ck-content .image .ck-progress-bar{position:absolute;top:0;left:0}:root{--ck-image-upload-progress-line-width:30px}.ck-content .image.ck-appear{animation:fadeIn .7s}.ck-content .image .ck-progress-bar{height:2px;width:0;background:var(--ck-color-upload-bar-background);transition:width .1s}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadicon.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadicon.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadicon.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-image-upload-complete-icon{display:block;position:absolute;top:10px;right:10px;border-radius:50%}.ck-image-upload-complete-icon:after{content:\\\"\\\";position:absolute}:root{--ck-color-image-upload-icon:#fff;--ck-color-image-upload-icon-background:#008a00;--ck-image-upload-icon-size:20px;--ck-image-upload-icon-width:2px}.ck-image-upload-complete-icon{width:var(--ck-image-upload-icon-size);height:var(--ck-image-upload-icon-size);opacity:0;background:var(--ck-color-image-upload-icon-background);animation-name:ck-upload-complete-icon-show,ck-upload-complete-icon-hide;animation-fill-mode:forwards,forwards;animation-duration:.5s,.5s;font-size:var(--ck-image-upload-icon-size);animation-delay:0ms,3s}.ck-image-upload-complete-icon:after{left:25%;top:50%;opacity:0;height:0;width:0;transform:scaleX(-1) rotate(135deg);transform-origin:left top;border-top:var(--ck-image-upload-icon-width) solid var(--ck-color-image-upload-icon);border-right:var(--ck-image-upload-icon-width) solid var(--ck-color-image-upload-icon);animation-name:ck-upload-complete-icon-check;animation-duration:.5s;animation-delay:.5s;animation-fill-mode:forwards;box-sizing:border-box}@keyframes ck-upload-complete-icon-show{0%{opacity:0}to{opacity:1}}@keyframes ck-upload-complete-icon-hide{0%{opacity:1}to{opacity:0}}@keyframes ck-upload-complete-icon-check{0%{opacity:1;width:0;height:0}33%{width:.3em;height:0}to{opacity:1;width:.3em;height:.45em}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadloader.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadloader.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imageuploadloader.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck .ck-upload-placeholder-loader{position:absolute;display:flex;align-items:center;justify-content:center;top:0;left:0}.ck .ck-upload-placeholder-loader:before{content:\\\"\\\";position:relative}:root{--ck-color-upload-placeholder-loader:#b3b3b3;--ck-upload-placeholder-loader-size:32px}.ck .ck-image-upload-placeholder{width:100%;margin:0}.ck .ck-upload-placeholder-loader{width:100%;height:100%}.ck .ck-upload-placeholder-loader:before{width:var(--ck-upload-placeholder-loader-size);height:var(--ck-upload-placeholder-loader-size);border-radius:50%;border-top:3px solid var(--ck-color-upload-placeholder-loader);border-right:2px solid transparent;animation:ck-upload-placeholder-loader 1s linear infinite}@keyframes ck-upload-placeholder-loader{to{transform:rotate(1turn)}}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./dropdown.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./dropdown.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./dropdown.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-dropdown{display:inline-block;position:relative}.ck.ck-dropdown .ck-dropdown__arrow{pointer-events:none;z-index:var(--ck-z-default)}.ck.ck-dropdown .ck-button.ck-dropdown__button{width:100%}.ck.ck-dropdown .ck-button.ck-dropdown__button.ck-on .ck-tooltip{display:none}.ck.ck-dropdown .ck-dropdown__panel{-webkit-backface-visibility:hidden;display:none;z-index:var(--ck-z-modal);position:absolute}.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel-visible{display:inline-block;will-change:transform}.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_ne,.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_nw{bottom:100%}.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_se,.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_sw{transform:translate3d(0,100%,0)}.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_ne,.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_se{left:0}.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_nw,.ck.ck-dropdown .ck-dropdown__panel.ck-dropdown__panel_sw{right:0}:root{--ck-dropdown-arrow-size:calc(0.5*var(--ck-icon-size))}.ck.ck-dropdown{font-size:inherit}.ck.ck-dropdown .ck-dropdown__arrow{right:var(--ck-spacing-standard);width:var(--ck-dropdown-arrow-size);margin-left:var(--ck-spacing-small)}.ck.ck-dropdown.ck-disabled .ck-dropdown__arrow{opacity:var(--ck-disabled-opacity)}.ck.ck-dropdown .ck-button.ck-dropdown__button:not(.ck-button_with-text){padding-left:var(--ck-spacing-small)}.ck.ck-dropdown .ck-button.ck-dropdown__button.ck-disabled .ck-button__label{opacity:var(--ck-disabled-opacity)}.ck.ck-dropdown .ck-button.ck-dropdown__button.ck-on{border-bottom-left-radius:0;border-bottom-right-radius:0}.ck.ck-dropdown .ck-button.ck-dropdown__button .ck-button__label{width:7em;overflow:hidden;text-overflow:ellipsis}.ck.ck-dropdown__panel{box-shadow:var(--ck-drop-shadow),0 0;border-radius:0}.ck-rounded-corners .ck.ck-dropdown__panel,.ck.ck-dropdown__panel.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0}.ck.ck-dropdown__panel{background:var(--ck-color-dropdown-panel-background);border:1px solid var(--ck-color-dropdown-panel-border);bottom:0;min-width:100%}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./list.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./list.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./list.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-list{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex-direction:column}.ck.ck-list .ck-list__item,.ck.ck-list .ck-list__separator{display:block}.ck.ck-list .ck-list__item>:focus{position:relative;z-index:var(--ck-z-default)}.ck.ck-list{border-radius:0}.ck-rounded-corners .ck.ck-list,.ck.ck-list.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-list{list-style-type:none;background:var(--ck-color-list-background)}.ck.ck-list__item{cursor:default;min-width:12em}.ck.ck-list__item .ck-button{min-height:unset;width:100%;text-align:left;border-radius:0;border:0;padding:calc(0.2*var(--ck-line-height-base)*var(--ck-font-size-base)) calc(0.4*var(--ck-line-height-base)*var(--ck-font-size-base))}.ck.ck-list__item .ck-button .ck-button__label{line-height:calc(1.2*var(--ck-line-height-base)*var(--ck-font-size-base))}.ck.ck-list__item .ck-button:active{box-shadow:none}.ck.ck-list__item .ck-button.ck-on{background:var(--ck-color-list-button-on-background);color:var(--ck-color-list-button-on-text)}.ck.ck-list__item .ck-button.ck-on:hover:not(ck-disabled){background:var(--ck-color-list-button-on-background-focus)}.ck.ck-list__item .ck-button.ck-on:active{box-shadow:none}.ck.ck-list__item .ck-button:hover:not(.ck-disabled){background:var(--ck-color-list-button-hover-background)}.ck.ck-list__item .ck-switchbutton.ck-on{background:var(--ck-color-list-background);color:inherit}.ck.ck-list__item .ck-switchbutton.ck-on:hover:not(ck-disabled){background:var(--ck-color-list-button-hover-background);color:inherit}.ck.ck-list__separator{height:1px;width:100%;background:var(--ck-color-base-border)}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./switchbutton.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./switchbutton.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./switchbutton.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-button.ck-switchbutton .ck-button__toggle,.ck.ck-button.ck-switchbutton .ck-button__toggle .ck-button__toggle__inner{display:block}:root{--ck-switch-button-toggle-width:2.6153846154em;--ck-switch-button-toggle-inner-size:1.0769230769em;--ck-switch-button-toggle-spacing:1px}.ck.ck-button.ck-switchbutton .ck-button__label{margin-right:calc(2*var(--ck-spacing-large))}.ck.ck-button.ck-switchbutton.ck-disabled .ck-button__toggle{opacity:var(--ck-disabled-opacity)}.ck.ck-button.ck-switchbutton .ck-button__toggle{border-radius:0}.ck-rounded-corners .ck.ck-button.ck-switchbutton .ck-button__toggle,.ck.ck-button.ck-switchbutton .ck-button__toggle.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-button.ck-switchbutton .ck-button__toggle{margin-left:auto;transition:background .4s ease;width:var(--ck-switch-button-toggle-width);background:var(--ck-color-switch-button-off-background)}.ck.ck-button.ck-switchbutton .ck-button__toggle .ck-button__toggle__inner{border-radius:0}.ck-rounded-corners .ck.ck-button.ck-switchbutton .ck-button__toggle .ck-button__toggle__inner,.ck.ck-button.ck-switchbutton .ck-button__toggle .ck-button__toggle__inner.ck-rounded-corners{border-radius:var(--ck-border-radius);border-radius:calc(0.5*var(--ck-border-radius))}.ck.ck-button.ck-switchbutton .ck-button__toggle .ck-button__toggle__inner{margin:var(--ck-switch-button-toggle-spacing);width:var(--ck-switch-button-toggle-inner-size);height:var(--ck-switch-button-toggle-inner-size);background:var(--ck-color-switch-button-inner-background);transition:transform .3s ease}.ck.ck-button.ck-switchbutton.ck-on .ck-button__toggle{background:var(--ck-color-switch-button-on-background)}.ck.ck-button.ck-switchbutton.ck-on .ck-button__toggle .ck-button__toggle__inner{transform:translateX(1.3846153847em)}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbardropdown.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbardropdown.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./toolbardropdown.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-toolbar-dropdown .ck-toolbar{flex-wrap:nowrap}.ck.ck-toolbar-dropdown .ck-dropdown__panel .ck-button:focus{z-index:calc(var(--ck-z-default) + 1)}.ck.ck-toolbar-dropdown .ck-toolbar{border:0}\"","\nvar content = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./listdropdown.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./listdropdown.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../postcss-loader/src/index.js??ref--5-1!./listdropdown.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-dropdown .ck-dropdown__panel .ck-list{border-radius:0}.ck-rounded-corners .ck.ck-dropdown .ck-dropdown__panel .ck-list,.ck.ck-dropdown .ck-dropdown__panel .ck-list.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0}.ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:first-child .ck-button{border-radius:0}.ck-rounded-corners .ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:first-child .ck-button,.ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:first-child .ck-button.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0}.ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:last-child .ck-button{border-radius:0}.ck-rounded-corners .ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:last-child .ck-button,.ck.ck-dropdown .ck-dropdown__panel .ck-list .ck-list__item:last-child .ck-button.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0;border-top-right-radius:0}\"","module.exports = \".ck.ck-heading_heading1{font-size:20px}.ck.ck-heading_heading2{font-size:17px}.ck.ck-heading_heading3{font-size:14px}.ck[class*=ck-heading_heading]{font-weight:700}.ck.ck-dropdown.ck-heading-dropdown .ck-dropdown__button .ck-button__label{width:8em}.ck.ck-dropdown.ck-heading-dropdown .ck-dropdown__panel .ck-list__item{min-width:18em}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./placeholder.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./placeholder.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./placeholder.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-placeholder:before,.ck .ck-placeholder:before{content:attr(data-placeholder);pointer-events:none;cursor:text;color:var(--ck-color-engine-placeholder-text)}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagecaption.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagecaption.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagecaption.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content .image>figcaption{color:#333;background-color:#f7f7f7;padding:.6em;font-size:.75em;outline-offset:-1px}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagestyle.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagestyle.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./imagestyle.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \":root{--ck-image-style-spacing:1.5em}.ck-content .image-style-align-center,.ck-content .image-style-align-left,.ck-content .image-style-align-right,.ck-content .image-style-side{max-width:50%}.ck-content .image-style-side{float:right;margin-left:var(--ck-image-style-spacing)}.ck-content .image-style-align-left{float:left;margin-right:var(--ck-image-style-spacing)}.ck-content .image-style-align-center{margin-left:auto;margin-right:auto}.ck-content .image-style-align-right{float:right;margin-left:var(--ck-image-style-spacing)}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./link.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./link.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./link.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck .ck-link_selected{background:var(--ck-color-link-selected-background)}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkform.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkform.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkform.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-link-form{display:flex;flex-direction:row;flex-wrap:nowrap}.ck.ck-link-form .ck-label{display:none}@media screen and (max-width:600px){.ck.ck-link-form{flex-wrap:wrap}.ck.ck-link-form .ck-labeled-input{flex-basis:100%}.ck.ck-link-form .ck-button{flex-basis:50%}}.ck.ck-link-form{padding:var(--ck-spacing-standard)}.ck.ck-link-form:focus{outline:none}.ck.ck-link-form>:not(:first-child){margin-left:var(--ck-spacing-standard)}@media screen and (max-width:600px){.ck.ck-link-form{padding:0;width:calc(0.8*var(--ck-input-text-width))}.ck.ck-link-form .ck-labeled-input{margin:var(--ck-spacing-standard) var(--ck-spacing-standard) 0}.ck.ck-link-form .ck-labeled-input .ck-input-text{min-width:0;width:100%}.ck.ck-link-form .ck-button{padding:var(--ck-spacing-standard);margin-top:var(--ck-spacing-standard);margin-left:0;border-radius:0;border:0;border-top:1px solid var(--ck-color-base-border)}.ck.ck-link-form .ck-button:first-of-type{border-right:1px solid var(--ck-color-base-border)}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkactions.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkactions.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./linkactions.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-link-actions{display:flex;flex-direction:row;flex-wrap:nowrap}.ck.ck-link-actions .ck-link-actions__preview{display:inline-block}.ck.ck-link-actions .ck-link-actions__preview .ck-button__label{overflow:hidden}@media screen and (max-width:600px){.ck.ck-link-actions{flex-wrap:wrap}.ck.ck-link-actions .ck-link-actions__preview{flex-basis:100%}.ck.ck-link-actions .ck-button:not(.ck-link-actions__preview){flex-basis:50%}}.ck.ck-link-actions{padding:var(--ck-spacing-standard)}.ck.ck-link-actions .ck-button.ck-link-actions__preview{padding-left:0;padding-right:0}.ck.ck-link-actions .ck-button.ck-link-actions__preview,.ck.ck-link-actions .ck-button.ck-link-actions__preview:active,.ck.ck-link-actions .ck-button.ck-link-actions__preview:focus,.ck.ck-link-actions .ck-button.ck-link-actions__preview:hover{background:none}.ck.ck-link-actions .ck-button.ck-link-actions__preview:active{box-shadow:none}.ck.ck-link-actions .ck-button.ck-link-actions__preview:focus .ck-button__label{text-decoration:underline}.ck.ck-link-actions .ck-button.ck-link-actions__preview .ck-button__label{padding:0 var(--ck-spacing-medium);color:var(--ck-color-link-default);text-overflow:ellipsis;cursor:pointer;max-width:var(--ck-input-text-width);min-width:3em;text-align:center}.ck.ck-link-actions .ck-button.ck-link-actions__preview .ck-button__label:hover{text-decoration:underline}.ck.ck-link-actions:focus{outline:none}.ck.ck-link-actions .ck-button:not(.ck-link-actions__preview){margin-left:var(--ck-spacing-standard)}@media screen and (max-width:600px){.ck.ck-link-actions{padding:0;width:calc(0.8*var(--ck-input-text-width))}.ck.ck-link-actions .ck-button.ck-link-actions__preview{margin:var(--ck-spacing-standard) var(--ck-spacing-standard) 0}.ck.ck-link-actions .ck-button.ck-link-actions__preview .ck-button__label{min-width:0;max-width:100%}.ck.ck-link-actions .ck-button:not(.ck-link-actions__preview){padding:var(--ck-spacing-standard);margin-top:var(--ck-spacing-standard);margin-left:0;border-radius:0;border:0;border-top:1px solid var(--ck-color-base-border)}.ck.ck-link-actions .ck-button:not(.ck-link-actions__preview):first-of-type{border-right:1px solid var(--ck-color-base-border)}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembedediting.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembedediting.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembedediting.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-media__wrapper .ck-media__placeholder{display:flex;flex-direction:column;align-items:center}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url .ck-tooltip{display:block}@media (hover:none){.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url .ck-tooltip{display:none}}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url{max-width:100%;position:relative}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url:hover .ck-tooltip{visibility:visible;opacity:1}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url .ck-media__placeholder__url__text{overflow:hidden;display:block}.ck-media__wrapper[data-oembed-url*=\\\"facebook.com\\\"] .ck-media__placeholder__icon *,.ck-media__wrapper[data-oembed-url*=\\\"google.com/maps\\\"] .ck-media__placeholder__icon *,.ck-media__wrapper[data-oembed-url*=\\\"instagram.com\\\"] .ck-media__placeholder__icon *,.ck-media__wrapper[data-oembed-url*=\\\"twitter.com\\\"] .ck-media__placeholder__icon *{display:none}[contenteditable=true] .ck-media__wrapper>:not(.ck-media__placeholder){pointer-events:none}:root{--ck-media-embed-placeholder-icon-size:3em;--ck-color-media-embed-placeholder-url-text:#757575;--ck-color-media-embed-placeholder-url-text-hover:var(--ck-color-base-text)}.ck-media__wrapper{margin:0 auto}.ck-media__wrapper .ck-media__placeholder{padding:calc(3*var(--ck-spacing-standard));background:var(--ck-color-base-foreground)}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__icon{min-width:var(--ck-media-embed-placeholder-icon-size);height:var(--ck-media-embed-placeholder-icon-size);margin-bottom:var(--ck-spacing-large);background-position:50%;background-size:cover}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__icon .ck-icon{width:100%;height:100%}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url .ck-media__placeholder__url__text{color:var(--ck-color-media-embed-placeholder-url-text);white-space:nowrap;text-align:center;font-style:italic;text-overflow:ellipsis}.ck-media__wrapper .ck-media__placeholder .ck-media__placeholder__url .ck-media__placeholder__url__text:hover{color:var(--ck-color-media-embed-placeholder-url-text-hover);cursor:pointer;text-decoration:underline}.ck-media__wrapper[data-oembed-url*=\\\"open.spotify.com\\\"]{max-width:300px;max-height:380px}.ck-media__wrapper[data-oembed-url*=\\\"twitter.com\\\"] .ck.ck-media__placeholder{background:linear-gradient(90deg,#71c6f4,#0d70a5)}.ck-media__wrapper[data-oembed-url*=\\\"twitter.com\\\"] .ck.ck-media__placeholder .ck-media__placeholder__icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MDAgNDAwIj48cGF0aCBkPSJNNDAwIDIwMGMwIDExMC41LTg5LjUgMjAwLTIwMCAyMDBTMCAzMTAuNSAwIDIwMCA4OS41IDAgMjAwIDBzMjAwIDg5LjUgMjAwIDIwMHpNMTYzLjQgMzA1LjVjODguNyAwIDEzNy4yLTczLjUgMTM3LjItMTM3LjIgMC0yLjEgMC00LjItLjEtNi4yIDkuNC02LjggMTcuNi0xNS4zIDI0LjEtMjUtOC42IDMuOC0xNy45IDYuNC0yNy43IDcuNiAxMC02IDE3LjYtMTUuNCAyMS4yLTI2LjctOS4zIDUuNS0xOS42IDkuNS0zMC42IDExLjctOC44LTkuNC0yMS4zLTE1LjItMzUuMi0xNS4yLTI2LjYgMC00OC4yIDIxLjYtNDguMiA0OC4yIDAgMy44LjQgNy41IDEuMyAxMS00MC4xLTItNzUuNi0yMS4yLTk5LjQtNTAuNC00LjEgNy4xLTYuNSAxNS40LTYuNSAyNC4yIDAgMTYuNyA4LjUgMzEuNSAyMS41IDQwLjEtNy45LS4yLTE1LjMtMi40LTIxLjgtNnYuNmMwIDIzLjQgMTYuNiA0Mi44IDM4LjcgNDcuMy00IDEuMS04LjMgMS43LTEyLjcgMS43LTMuMSAwLTYuMS0uMy05LjEtLjkgNi4xIDE5LjIgMjMuOSAzMy4xIDQ1IDMzLjUtMTYuNSAxMi45LTM3LjMgMjAuNi01OS45IDIwLjYtMy45IDAtNy43LS4yLTExLjUtLjcgMjEuMSAxMy44IDQ2LjUgMjEuOCA3My43IDIxLjgiIGZpbGw9IiNmZmYiLz48L3N2Zz4=)}.ck-media__wrapper[data-oembed-url*=\\\"twitter.com\\\"] .ck.ck-media__placeholder .ck-media__placeholder__url__text{color:#b8e6ff}.ck-media__wrapper[data-oembed-url*=\\\"twitter.com\\\"] .ck.ck-media__placeholder .ck-media__placeholder__url__text:hover{color:#fff}.ck-media__wrapper[data-oembed-url*=\\\"google.com/maps\\\"] .ck-media__placeholder__icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAuMzc4IiBoZWlnaHQ9IjI1NC4xNjciIHZpZXdCb3g9IjAgMCA2Ni4yNDYgNjcuMjQ4Ij48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTcyLjUzMSAtMjE4LjQ1NSkgc2NhbGUoLjk4MDEyKSI+PHJlY3Qgcnk9IjUuMjM4IiByeD0iNS4yMzgiIHk9IjIzMS4zOTkiIHg9IjE3Ni4wMzEiIGhlaWdodD0iNjAuMDk5IiB3aWR0aD0iNjAuMDk5IiBmaWxsPSIjMzRhNjY4IiBwYWludC1vcmRlcj0ibWFya2VycyBzdHJva2UgZmlsbCIvPjxwYXRoIGQ9Ik0yMDYuNDc3IDI2MC45bC0yOC45ODcgMjguOTg3YTUuMjE4IDUuMjE4IDAgMCAwIDMuNzggMS42MWg0OS42MjFjMS42OTQgMCAzLjE5LS43OTggNC4xNDYtMi4wMzd6IiBmaWxsPSIjNWM4OGM1Ii8+PHBhdGggZD0iTTIyNi43NDIgMjIyLjk4OGMtOS4yNjYgMC0xNi43NzcgNy4xNy0xNi43NzcgMTYuMDE0LjAwNyAyLjc2Mi42NjMgNS40NzQgMi4wOTMgNy44NzUuNDMuNzAzLjgzIDEuNDA4IDEuMTkgMi4xMDcuMzMzLjUwMi42NSAxLjAwNS45NSAxLjUwOC4zNDMuNDc3LjY3My45NTcuOTg4IDEuNDQgMS4zMSAxLjc2OSAyLjUgMy41MDIgMy42MzcgNS4xNjguNzkzIDEuMjc1IDEuNjgzIDIuNjQgMi40NjYgMy45OSAyLjM2MyA0LjA5NCA0LjAwNyA4LjA5MiA0LjYgMTMuOTE0di4wMTJjLjE4Mi40MTIuNTE2LjY2Ni44NzkuNjY3LjQwMy0uMDAxLjc2OC0uMzE0LjkzLS43OTkuNjAzLTUuNzU2IDIuMjM4LTkuNzI5IDQuNTg1LTEzLjc5NC43ODItMS4zNSAxLjY3My0yLjcxNSAyLjQ2NS0zLjk5IDEuMTM3LTEuNjY2IDIuMzI4LTMuNCAzLjYzOC01LjE2OS4zMTUtLjQ4Mi42NDUtLjk2Mi45ODgtMS40MzkuMy0uNTAzLjYxNy0xLjAwNi45NS0xLjUwOC4zNTktLjcuNzYtMS40MDQgMS4xOS0yLjEwNyAxLjQyNi0yLjQwMiAyLTUuMTE0IDIuMDA0LTcuODc1IDAtOC44NDQtNy41MTEtMTYuMDE0LTE2Ljc3Ni0xNi4wMTR6IiBmaWxsPSIjZGQ0YjNlIiBwYWludC1vcmRlcj0ibWFya2VycyBzdHJva2UgZmlsbCIvPjxlbGxpcHNlIHJ5PSI1LjU2NCIgcng9IjUuODI4IiBjeT0iMjM5LjAwMiIgY3g9IjIyNi43NDIiIGZpbGw9IiM4MDJkMjciIHBhaW50LW9yZGVyPSJtYXJrZXJzIHN0cm9rZSBmaWxsIi8+PHBhdGggZD0iTTE5MC4zMDEgMjM3LjI4M2MtNC42NyAwLTguNDU3IDMuODUzLTguNDU3IDguNjA2czMuNzg2IDguNjA3IDguNDU3IDguNjA3YzMuMDQzIDAgNC44MDYtLjk1OCA2LjMzNy0yLjUxNiAxLjUzLTEuNTU3IDIuMDg3LTMuOTEzIDIuMDg3LTYuMjkgMC0uMzYyLS4wMjMtLjcyMi0uMDY0LTEuMDc5aC04LjI1N3YzLjA0M2g0Ljg1Yy0uMTk3Ljc1OS0uNTMxIDEuNDUtMS4wNTggMS45ODYtLjk0Mi45NTgtMi4wMjggMS41NDgtMy45MDEgMS41NDgtMi44NzYgMC01LjIwOC0yLjM3Mi01LjIwOC01LjI5OSAwLTIuOTI2IDIuMzMyLTUuMjk5IDUuMjA4LTUuMjk5IDEuMzk5IDAgMi42MTguNDA3IDMuNTg0IDEuMjkzbDIuMzgxLTIuMzhjMC0uMDAyLS4wMDMtLjAwNC0uMDA0LS4wMDUtMS41ODgtMS41MjQtMy42Mi0yLjIxNS01Ljk1NS0yLjIxNXptNC40MyA1LjY2bC4wMDMuMDA2di0uMDAzeiIgZmlsbD0iI2ZmZiIgcGFpbnQtb3JkZXI9Im1hcmtlcnMgc3Ryb2tlIGZpbGwiLz48cGF0aCBkPSJNMjE1LjE4NCAyNTEuOTI5bC03Ljk4IDcuOTc5IDI4LjQ3NyAyOC40NzVhNS4yMzMgNS4yMzMgMCAwIDAgLjQ0OS0yLjEyM3YtMzEuMTY1Yy0uNDY5LjY3NS0uOTM0IDEuMzQ5LTEuMzgyIDIuMDA1LS43OTIgMS4yNzUtMS42ODIgMi42NC0yLjQ2NSAzLjk5LTIuMzQ3IDQuMDY1LTMuOTgyIDguMDM4LTQuNTg1IDEzLjc5NC0uMTYyLjQ4NS0uNTI3Ljc5OC0uOTMuNzk5LS4zNjMtLjAwMS0uNjk3LS4yNTUtLjg3OS0uNjY3di0uMDEyYy0uNTkzLTUuODIyLTIuMjM3LTkuODItNC42LTEzLjkxNC0uNzgzLTEuMzUtMS42NzMtMi43MTUtMi40NjYtMy45OS0xLjEzNy0xLjY2Ni0yLjMyNy0zLjQtMy42MzctNS4xNjlsLS4wMDItLjAwM3oiIGZpbGw9IiNjM2MzYzMiLz48cGF0aCBkPSJNMjEyLjk4MyAyNDguNDk1bC0zNi45NTIgMzYuOTUzdi44MTJhNS4yMjcgNS4yMjcgMCAwIDAgNS4yMzggNS4yMzhoMS4wMTVsMzUuNjY2LTM1LjY2NmExMzYuMjc1IDEzNi4yNzUgMCAwIDAtMi43NjQtMy45IDM3LjU3NSAzNy41NzUgMCAwIDAtLjk4OS0xLjQ0IDM1LjEyNyAzNS4xMjcgMCAwIDAtLjk1LTEuNTA4Yy0uMDgzLS4xNjItLjE3Ni0uMzI2LS4yNjQtLjQ4OXoiIGZpbGw9IiNmZGRjNGYiIHBhaW50LW9yZGVyPSJtYXJrZXJzIHN0cm9rZSBmaWxsIi8+PHBhdGggZD0iTTIxMS45OTggMjYxLjA4M2wtNi4xNTIgNi4xNTEgMjQuMjY0IDI0LjI2NGguNzgxYTUuMjI3IDUuMjI3IDAgMCAwIDUuMjM5LTUuMjM4di0xLjA0NXoiIGZpbGw9IiNmZmYiIHBhaW50LW9yZGVyPSJtYXJrZXJzIHN0cm9rZSBmaWxsIi8+PC9nPjwvc3ZnPg==)}.ck-media__wrapper[data-oembed-url*=\\\"facebook.com\\\"] .ck-media__placeholder{background:#4268b3}.ck-media__wrapper[data-oembed-url*=\\\"facebook.com\\\"] .ck-media__placeholder .ck-media__placeholder__icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyNCIgaGVpZ2h0PSIxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik05NjcuNDg0IDBINTYuNTE3QzI1LjMwNCAwIDAgMjUuMzA0IDAgNTYuNTE3djkxMC45NjZDMCA5OTguNjk0IDI1LjI5NyAxMDI0IDU2LjUyMiAxMDI0SDU0N1Y2MjhINDE0VjQ3M2gxMzNWMzU5LjAyOWMwLTEzMi4yNjIgODAuNzczLTIwNC4yODIgMTk4Ljc1Ni0yMDQuMjgyIDU2LjUxMyAwIDEwNS4wODYgNC4yMDggMTE5LjI0NCA2LjA4OVYyOTlsLTgxLjYxNi4wMzdjLTYzLjk5MyAwLTc2LjM4NCAzMC40OTItNzYuMzg0IDc1LjIzNlY0NzNoMTUzLjQ4N2wtMTkuOTg2IDE1NUg3MDd2Mzk2aDI2MC40ODRjMzEuMjEzIDAgNTYuNTE2LTI1LjMwMyA1Ni41MTYtNTYuNTE2VjU2LjUxNUMxMDI0IDI1LjMwMyA5OTguNjk3IDAgOTY3LjQ4NCAwIiBmaWxsPSIjRkZGRkZFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=)}.ck-media__wrapper[data-oembed-url*=\\\"facebook.com\\\"] .ck-media__placeholder .ck-media__placeholder__url__text{color:#cdf}.ck-media__wrapper[data-oembed-url*=\\\"facebook.com\\\"] .ck-media__placeholder .ck-media__placeholder__url__text:hover{color:#fff}.ck-media__wrapper[data-oembed-url*=\\\"instagram.com\\\"] .ck-media__placeholder{background:linear-gradient(-135deg,#1400c8,#b900b4,#f50000)}.ck-media__wrapper[data-oembed-url*=\\\"instagram.com\\\"] .ck-media__placeholder .ck-media__placeholder__icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTA0IiBoZWlnaHQ9IjUwNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0wIC4xNTloNTAzLjg0MVY1MDMuOTRIMHoiLz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48bWFzayBpZD0iYiIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48cGF0aCBkPSJNMjUxLjkyMS4xNTljLTY4LjQxOCAwLTc2Ljk5Ny4yOS0xMDMuODY3IDEuNTE2LTI2LjgxNCAxLjIyMy00NS4xMjcgNS40ODItNjEuMTUxIDExLjcxLTE2LjU2NiA2LjQzNy0zMC42MTUgMTUuMDUxLTQ0LjYyMSAyOS4wNTYtMTQuMDA1IDE0LjAwNi0yMi42MTkgMjguMDU1LTI5LjA1NiA0NC42MjEtNi4yMjggMTYuMDI0LTEwLjQ4NyAzNC4zMzctMTEuNzEgNjEuMTUxQy4yOSAxNzUuMDgzIDAgMTgzLjY2MiAwIDI1Mi4wOGMwIDY4LjQxNy4yOSA3Ni45OTYgMS41MTYgMTAzLjg2NiAxLjIyMyAyNi44MTQgNS40ODIgNDUuMTI3IDExLjcxIDYxLjE1MSA2LjQzNyAxNi41NjYgMTUuMDUxIDMwLjYxNSAyOS4wNTYgNDQuNjIxIDE0LjAwNiAxNC4wMDUgMjguMDU1IDIyLjYxOSA0NC42MjEgMjkuMDU3IDE2LjAyNCA2LjIyNyAzNC4zMzcgMTAuNDg2IDYxLjE1MSAxMS43MDkgMjYuODcgMS4yMjYgMzUuNDQ5IDEuNTE2IDEwMy44NjcgMS41MTYgNjguNDE3IDAgNzYuOTk2LS4yOSAxMDMuODY2LTEuNTE2IDI2LjgxNC0xLjIyMyA0NS4xMjctNS40ODIgNjEuMTUxLTExLjcwOSAxNi41NjYtNi40MzggMzAuNjE1LTE1LjA1MiA0NC42MjEtMjkuMDU3IDE0LjAwNS0xNC4wMDYgMjIuNjE5LTI4LjA1NSAyOS4wNTctNDQuNjIxIDYuMjI3LTE2LjAyNCAxMC40ODYtMzQuMzM3IDExLjcwOS02MS4xNTEgMS4yMjYtMjYuODcgMS41MTYtMzUuNDQ5IDEuNTE2LTEwMy44NjYgMC02OC40MTgtLjI5LTc2Ljk5Ny0xLjUxNi0xMDMuODY3LTEuMjIzLTI2LjgxNC01LjQ4Mi00NS4xMjctMTEuNzA5LTYxLjE1MS02LjQzOC0xNi41NjYtMTUuMDUyLTMwLjYxNS0yOS4wNTctNDQuNjIxLTE0LjAwNi0xNC4wMDUtMjguMDU1LTIyLjYxOS00NC42MjEtMjkuMDU2LTE2LjAyNC02LjIyOC0zNC4zMzctMTAuNDg3LTYxLjE1MS0xMS43MUMzMjguOTE3LjQ0OSAzMjAuMzM4LjE1OSAyNTEuOTIxLjE1OXptMCA0NS4zOTFjNjcuMjY1IDAgNzUuMjMzLjI1NyAxMDEuNzk3IDEuNDY5IDI0LjU2MiAxLjEyIDM3LjkwMSA1LjIyNCA0Ni43NzggOC42NzQgMTEuNzU5IDQuNTcgMjAuMTUxIDEwLjAyOSAyOC45NjYgMTguODQ1IDguODE2IDguODE1IDE0LjI3NSAxNy4yMDcgMTguODQ1IDI4Ljk2NiAzLjQ1IDguODc3IDcuNTU0IDIyLjIxNiA4LjY3NCA0Ni43NzggMS4yMTIgMjYuNTY0IDEuNDY5IDM0LjUzMiAxLjQ2OSAxMDEuNzk4IDAgNjcuMjY1LS4yNTcgNzUuMjMzLTEuNDY5IDEwMS43OTctMS4xMiAyNC41NjItNS4yMjQgMzcuOTAxLTguNjc0IDQ2Ljc3OC00LjU3IDExLjc1OS0xMC4wMjkgMjAuMTUxLTE4Ljg0NSAyOC45NjYtOC44MTUgOC44MTYtMTcuMjA3IDE0LjI3NS0yOC45NjYgMTguODQ1LTguODc3IDMuNDUtMjIuMjE2IDcuNTU0LTQ2Ljc3OCA4LjY3NC0yNi41NiAxLjIxMi0zNC41MjcgMS40NjktMTAxLjc5NyAxLjQ2OS02Ny4yNzEgMC03NS4yMzctLjI1Ny0xMDEuNzk4LTEuNDY5LTI0LjU2Mi0xLjEyLTM3LjkwMS01LjIyNC00Ni43NzgtOC42NzQtMTEuNzU5LTQuNTctMjAuMTUxLTEwLjAyOS0yOC45NjYtMTguODQ1LTguODE1LTguODE1LTE0LjI3NS0xNy4yMDctMTguODQ1LTI4Ljk2Ni0zLjQ1LTguODc3LTcuNTU0LTIyLjIxNi04LjY3NC00Ni43NzgtMS4yMTItMjYuNTY0LTEuNDY5LTM0LjUzMi0xLjQ2OS0xMDEuNzk3IDAtNjcuMjY2LjI1Ny03NS4yMzQgMS40NjktMTAxLjc5OCAxLjEyLTI0LjU2MiA1LjIyNC0zNy45MDEgOC42NzQtNDYuNzc4IDQuNTctMTEuNzU5IDEwLjAyOS0yMC4xNTEgMTguODQ1LTI4Ljk2NiA4LjgxNS04LjgxNiAxNy4yMDctMTQuMjc1IDI4Ljk2Ni0xOC44NDUgOC44NzctMy40NSAyMi4yMTYtNy41NTQgNDYuNzc4LTguNjc0IDI2LjU2NC0xLjIxMiAzNC41MzItMS40NjkgMTAxLjc5OC0xLjQ2OXoiIGZpbGw9IiNGRkYiIG1hc2s9InVybCgjYikiLz48cGF0aCBkPSJNMjUxLjkyMSAzMzYuMDUzYy00Ni4zNzggMC04My45NzQtMzcuNTk2LTgzLjk3NC04My45NzMgMC00Ni4zNzggMzcuNTk2LTgzLjk3NCA4My45NzQtODMuOTc0IDQ2LjM3NyAwIDgzLjk3MyAzNy41OTYgODMuOTczIDgzLjk3NCAwIDQ2LjM3Ny0zNy41OTYgODMuOTczLTgzLjk3MyA4My45NzN6bTAtMjEzLjMzOGMtNzEuNDQ3IDAtMTI5LjM2NSA1Ny45MTgtMTI5LjM2NSAxMjkuMzY1IDAgNzEuNDQ2IDU3LjkxOCAxMjkuMzY0IDEyOS4zNjUgMTI5LjM2NCA3MS40NDYgMCAxMjkuMzY0LTU3LjkxOCAxMjkuMzY0LTEyOS4zNjQgMC03MS40NDctNTcuOTE4LTEyOS4zNjUtMTI5LjM2NC0xMjkuMzY1ek00MTYuNjI3IDExNy42MDRjMCAxNi42OTYtMTMuNTM1IDMwLjIzLTMwLjIzMSAzMC4yMy0xNi42OTUgMC0zMC4yMy0xMy41MzQtMzAuMjMtMzAuMjMgMC0xNi42OTYgMTMuNTM1LTMwLjIzMSAzMC4yMy0zMC4yMzEgMTYuNjk2IDAgMzAuMjMxIDEzLjUzNSAzMC4yMzEgMzAuMjMxIiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg==)}.ck-media__wrapper[data-oembed-url*=\\\"instagram.com\\\"] .ck-media__placeholder .ck-media__placeholder__url__text{color:#ffe0fe}.ck-media__wrapper[data-oembed-url*=\\\"instagram.com\\\"] .ck-media__placeholder .ck-media__placeholder__url__text:hover{color:#fff}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaform.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaform.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaform.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck.ck-media-form{display:flex;align-items:flex-start;flex-direction:row;flex-wrap:nowrap}.ck.ck-media-form .ck-labeled-input{display:inline-block}.ck.ck-media-form .ck-label{display:none}@media screen and (max-width:600px){.ck.ck-media-form{flex-wrap:wrap}.ck.ck-media-form .ck-labeled-input{flex-basis:100%}.ck.ck-media-form .ck-button{flex-basis:50%}}.ck.ck-media-form{padding:var(--ck-spacing-standard)}.ck.ck-media-form:focus{outline:none}.ck.ck-media-form>:not(:first-child){margin-left:var(--ck-spacing-standard)}@media screen and (max-width:600px){.ck.ck-media-form{padding:0;width:calc(0.8*var(--ck-input-text-width))}.ck.ck-media-form .ck-labeled-input{margin:var(--ck-spacing-standard) var(--ck-spacing-standard) 0}.ck.ck-media-form .ck-labeled-input .ck-input-text{min-width:0;width:100%}.ck.ck-media-form .ck-labeled-input .ck-labeled-input__error{white-space:normal}.ck.ck-media-form .ck-button{padding:var(--ck-spacing-standard);margin-top:var(--ck-spacing-standard);margin-left:0;border-radius:0;border:0;border-top:1px solid var(--ck-color-base-border)}.ck.ck-media-form .ck-button:first-of-type{border-right:1px solid var(--ck-color-base-border)}}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembed.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembed.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./mediaembed.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content .media{clear:both;margin:1em 0}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./tableediting.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./tableediting.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./tableediting.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \":root{--ck-color-table-focused-cell-background:#f5fafe}.ck-widget.table td.ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck-widget.table th.ck-editor__nested-editable.ck-editor__nested-editable_focused{background:var(--ck-color-table-focused-cell-background);border-style:none;outline:1px solid var(--ck-color-focus-border);outline-offset:-1px}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./inserttable.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./inserttable.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./inserttable.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \":root{--ck-insert-table-dropdown-padding:10px;--ck-insert-table-dropdown-box-height:11px;--ck-insert-table-dropdown-box-width:12px;--ck-insert-table-dropdown-box-margin:1px;--ck-insert-table-dropdown-box-border-color:#bfbfbf;--ck-insert-table-dropdown-box-border-active-color:#53a0e4;--ck-insert-table-dropdown-box-active-background:#c7e5ff}.ck .ck-insert-table-dropdown__grid{display:flex;flex-direction:row;flex-wrap:wrap;width:calc(var(--ck-insert-table-dropdown-box-width)*10 + var(--ck-insert-table-dropdown-box-margin)*20 + var(--ck-insert-table-dropdown-padding)*2);padding:var(--ck-insert-table-dropdown-padding) var(--ck-insert-table-dropdown-padding) 0}.ck .ck-insert-table-dropdown__label{text-align:center}.ck .ck-insert-table-dropdown-grid-box{width:var(--ck-insert-table-dropdown-box-width);height:var(--ck-insert-table-dropdown-box-height);margin:var(--ck-insert-table-dropdown-box-margin);border:1px solid var(--ck-insert-table-dropdown-box-border-color);border-radius:1px}.ck .ck-insert-table-dropdown-grid-box.ck-on{border-color:var(--ck-insert-table-dropdown-box-border-active-color);background:var(--ck-insert-table-dropdown-box-active-background)}\"","\nvar content = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./table.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"singleton\":true,\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../postcss-loader/src/index.js??ref--5-1!./table.css\", function() {\n\t\tvar newContent = require(\"!!../../../postcss-loader/src/index.js??ref--5-1!./table.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \".ck-content .table{margin:1em auto;display:table}.ck-content .table table{border-collapse:collapse;border-spacing:0;border:1px double #b3b3b3}.ck-content .table table td,.ck-content .table table th{min-width:2em;padding:.4em;border-color:#d9d9d9}.ck-content .table table th{font-weight:700;background:#fafafa}\"","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/config\r\n */\r\n\r\nimport { isPlainObject } from 'lodash-es';\r\n\r\n/**\r\n * Handles a configuration dictionary.\r\n */\r\nexport default class Config {\r\n\t/**\r\n\t * Creates an instance of the {@link ~Config} class.\r\n\t *\r\n\t * @param {Object} [configurations] The initial configurations to be set. Usually, provided by the user.\r\n\t * @param {Object} [defaultConfigurations] The default configurations. Usually, provided by the system.\r\n\t */\r\n\tconstructor( configurations, defaultConfigurations ) {\r\n\t\t/**\r\n\t\t * Store for the whole configuration.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis._config = {};\r\n\r\n\t\t// Set default configuration.\r\n\t\tif ( defaultConfigurations ) {\r\n\t\t\tthis.define( defaultConfigurations );\r\n\t\t}\r\n\r\n\t\t// Set initial configuration.\r\n\t\tif ( configurations ) {\r\n\t\t\tthis._setObjectToTarget( this._config, configurations );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set configuration values.\r\n\t *\r\n\t * It accepts both a name/value pair or an object, which properties and values will be used to set\r\n\t * configurations.\r\n\t *\r\n\t * It also accepts setting a \"deep configuration\" by using dots in the name. For example, `'resize.width'` sets\r\n\t * the value for the `width` configuration in the `resize` subset.\r\n\t *\r\n\t *\t\tconfig.set( 'width', 500 );\r\n\t *\t\tconfig.set( 'toolbar.collapsed', true );\r\n\t *\r\n\t *\t\t// Equivalent to:\r\n\t *\t\tconfig.set( {\r\n\t *\t\t\twidth: 500\r\n\t *\t\t\ttoolbar: {\r\n\t *\t\t\t\tcollapsed: true\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * Passing an object as the value will amend the configuration, not replace it.\r\n\t *\r\n\t *\t\tconfig.set( 'toolbar', {\r\n\t *\t\t\tcollapsed: true,\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\tconfig.set( 'toolbar', {\r\n\t *\t\t\tcolor: 'red',\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\tconfig.get( 'toolbar.collapsed' ); // true\r\n\t *\t\tconfig.get( 'toolbar.color' ); // 'red'\r\n\t *\r\n\t * @param {String|Object} name The configuration name or an object from which take properties as\r\n\t * configuration entries. Configuration names are case-sensitive.\r\n\t * @param {*} value The configuration value. Used if a name is passed.\r\n\t */\r\n\tset( name, value ) {\r\n\t\tthis._setToTarget( this._config, name, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Does exactly the same as {@link #set} with one exception – passed configuration extends\r\n\t * existing one, but does not overwrite already defined values.\r\n\t *\r\n\t * This method is supposed to be called by plugin developers to setup plugin's configurations. It would be\r\n\t * rarely used for other needs.\r\n\t *\r\n\t * @param {String|Object} name The configuration name or an object from which take properties as\r\n\t * configuration entries. Configuration names are case-sensitive.\r\n\t * @param {*} value The configuration value. Used if a name is passed.\r\n\t */\r\n\tdefine( name, value ) {\r\n\t\tconst isDefine = true;\r\n\r\n\t\tthis._setToTarget( this._config, name, value, isDefine );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the value for a configuration entry.\r\n\t *\r\n\t *\t\tconfig.get( 'name' );\r\n\t *\r\n\t * Deep configurations can be retrieved by separating each part with a dot.\r\n\t *\r\n\t *\t\tconfig.get( 'toolbar.collapsed' );\r\n\t *\r\n\t * @param {String} name The configuration name. Configuration names are case-sensitive.\r\n\t * @returns {*} The configuration value or `undefined` if the configuration entry was not found.\r\n\t */\r\n\tget( name ) {\r\n\t\treturn this._getFromSource( this._config, name );\r\n\t}\r\n\r\n\t/**\r\n\t * Saves passed configuration to the specified target (nested object).\r\n\t *\r\n\t * @private\r\n\t * @param {Object} target Nested config object.\r\n\t * @param {String|Object} name The configuration name or an object from which take properties as\r\n\t * configuration entries. Configuration names are case-sensitive.\r\n\t * @param {*} value The configuration value. Used if a name is passed.\r\n\t * @param {Boolean} [isDefine=false] Define if passed configuration should overwrite existing one.\r\n\t */\r\n\t_setToTarget( target, name, value, isDefine = false ) {\r\n\t\t// In case of an object, iterate through it and call `_setToTarget` again for each property.\r\n\t\tif ( isPlainObject( name ) ) {\r\n\t\t\tthis._setObjectToTarget( target, name, isDefine );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// The configuration name should be split into parts if it has dots. E.g. `resize.width` -> [`resize`, `width`].\r\n\t\tconst parts = name.split( '.' );\r\n\r\n\t\t// Take the name of the configuration out of the parts. E.g. `resize.width` -> `width`.\r\n\t\tname = parts.pop();\r\n\r\n\t\t// Iterate over parts to check if currently stored configuration has proper structure.\r\n\t\tfor ( const part of parts ) {\r\n\t\t\t// If there is no object for specified part then create one.\r\n\t\t\tif ( !isPlainObject( target[ part ] ) ) {\r\n\t\t\t\ttarget[ part ] = {};\r\n\t\t\t}\r\n\r\n\t\t\t// Nested object becomes a target.\r\n\t\t\ttarget = target[ part ];\r\n\t\t}\r\n\r\n\t\t// In case of value is an object.\r\n\t\tif ( isPlainObject( value ) ) {\r\n\t\t\t// We take care of proper config structure.\r\n\t\t\tif ( !isPlainObject( target[ name ] ) ) {\r\n\t\t\t\ttarget[ name ] = {};\r\n\t\t\t}\r\n\r\n\t\t\ttarget = target[ name ];\r\n\r\n\t\t\t// And iterate through this object calling `_setToTarget` again for each property.\r\n\t\t\tthis._setObjectToTarget( target, value, isDefine );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Do nothing if we are defining configuration for non empty name.\r\n\t\tif ( isDefine && typeof target[ name ] != 'undefined' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttarget[ name ] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Get specified configuration from specified source (nested object).\r\n\t *\r\n\t * @private\r\n\t * @param {Object} source level of nested object.\r\n\t * @param {String} name The configuration name. Configuration names are case-sensitive.\r\n\t * @returns {*} The configuration value or `undefined` if the configuration entry was not found.\r\n\t */\r\n\t_getFromSource( source, name ) {\r\n\t\t// The configuration name should be split into parts if it has dots. E.g. `resize.width` -> [`resize`, `width`].\r\n\t\tconst parts = name.split( '.' );\r\n\r\n\t\t// Take the name of the configuration out of the parts. E.g. `resize.width` -> `width`.\r\n\t\tname = parts.pop();\r\n\r\n\t\t// Iterate over parts to check if currently stored configuration has proper structure.\r\n\t\tfor ( const part of parts ) {\r\n\t\t\tif ( !isPlainObject( source[ part ] ) ) {\r\n\t\t\t\tsource = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Nested object becomes a source.\r\n\t\t\tsource = source[ part ];\r\n\t\t}\r\n\r\n\t\t// Always returns undefined for non existing configuration\r\n\t\treturn source ? source[ name ] : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Iterates through passed object and calls {@link #_setToTarget} method with object key and value for each property.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} target Nested config object.\r\n\t * @param {Object} configuration Configuration data set\r\n\t * @param {Boolean} [isDefine] Defines if passed configuration is default configuration or not.\r\n\t */\r\n\t_setObjectToTarget( target, configuration, isDefine ) {\r\n\t\tObject.keys( configuration ).forEach( key => {\r\n\t\t\tthis._setToTarget( target, key, configuration[ key ], isDefine );\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/spy\r\n */\r\n\r\n/**\r\n * Creates a spy function (ala Sinon.js) that can be used to inspect call to it.\r\n *\r\n * The following are the present features:\r\n *\r\n * * spy.called: property set to `true` if the function has been called at least once.\r\n *\r\n * @returns {Function} The spy function.\r\n */\r\nfunction spy() {\r\n\treturn function spy() {\r\n\t\tspy.called = true;\r\n\t};\r\n}\r\n\r\nexport default spy;\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/eventinfo\r\n */\r\n\r\nimport spy from './spy';\r\n\r\n/**\r\n * The event object passed to event callbacks. It is used to provide information about the event as well as a tool to\r\n * manipulate it.\r\n */\r\nexport default class EventInfo {\r\n\t/**\r\n\t * @param {Object} source The emitter.\r\n\t * @param {String} name The event name.\r\n\t */\r\n\tconstructor( source, name ) {\r\n\t\t/**\r\n\t\t * The object that fired the event.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis.source = source;\r\n\r\n\t\t/**\r\n\t\t * The event name.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.name = name;\r\n\r\n\t\t/**\r\n\t\t * Path this event has followed. See {@link module:utils/emittermixin~EmitterMixin#delegate}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<Object>}\r\n\t\t */\r\n\t\tthis.path = [];\r\n\r\n\t\t// The following methods are defined in the constructor because they must be re-created per instance.\r\n\r\n\t\t/**\r\n\t\t * Stops the event emitter to call further callbacks for this event interaction.\r\n\t\t *\r\n\t\t * @method #stop\r\n\t\t */\r\n\t\tthis.stop = spy();\r\n\r\n\t\t/**\r\n\t\t * Removes the current callback from future interactions of this event.\r\n\t\t *\r\n\t\t * @method #off\r\n\t\t */\r\n\t\tthis.off = spy();\r\n\r\n\t\t/**\r\n\t\t * The value which will be returned by {@link module:utils/emittermixin~EmitterMixin#fire}.\r\n\t\t *\r\n\t\t * It's `undefined` by default and can be changed by an event listener:\r\n\t\t *\r\n\t\t *\t\tdataController.fire( 'getSelectedContent', ( evt ) => {\r\n\t\t *\t\t\t// This listener will make `dataController.fire( 'getSelectedContent' )`\r\n\t\t *\t\t\t// always return an empty DocumentFragment.\r\n\t\t *\t\t\tevt.return = new DocumentFragment();\r\n\t\t *\r\n\t\t *\t\t\t// Make sure no other listeners are executed.\r\n\t\t *\t\t\tevt.stop();\r\n\t\t *\t\t} );\r\n\t\t *\r\n\t\t * @member #return\r\n\t\t */\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/uid\r\n */\r\n\r\n/**\r\n * Returns a unique id. This id consist of an 'e' character and a randomly generated string of 32 aphanumeric characters.\r\n * Each character in uid string represents a hexadecimal digit (base 16).\r\n *\r\n * @returns {String} A hexadecimal number representing the id.\r\n */\r\nexport default function uid() {\r\n\tlet uuid = 'e'; // Make sure that id does not start with number.\r\n\r\n\tfor ( let i = 0; i < 8; i++ ) {\r\n\t\tuuid += Math.floor( ( 1 + Math.random() ) * 0x10000 ).toString( 16 ).substring( 1 );\r\n\t}\r\n\r\n\treturn uuid;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/priorities\r\n */\r\n\r\n/**\r\n * String representing a priority value.\r\n *\r\n * @typedef {'highest'|'high'|'normal'|'low'|'lowest'} module:utils/priorities~PriorityString\r\n */\r\n\r\n/**\r\n * Provides group of constants to use instead of hardcoding numeric priority values.\r\n *\r\n * @namespace\r\n */\r\nconst priorities = {\r\n\t/**\r\n\t * Converts a string with priority name to it's numeric value. If `Number` is given, it just returns it.\r\n\t *\r\n\t * @static\r\n\t * @param {module:utils/priorities~PriorityString|Number} priority Priority to convert.\r\n\t * @returns {Number} Converted priority.\r\n\t */\r\n\tget( priority ) {\r\n\t\tif ( typeof priority != 'number' ) {\r\n\t\t\treturn this[ priority ] || this.normal;\r\n\t\t} else {\r\n\t\t\treturn priority;\r\n\t\t}\r\n\t},\r\n\r\n\thighest: 100000,\r\n\thigh: 1000,\r\n\tnormal: 0,\r\n\tlow: -1000,\r\n\tlowest: -100000\r\n};\r\n\r\nexport default priorities;\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/emittermixin\r\n */\r\n\r\nimport EventInfo from './eventinfo';\r\nimport uid from './uid';\r\nimport priorities from './priorities';\r\n\r\nconst _listeningTo = Symbol( 'listeningTo' );\r\nconst _emitterId = Symbol( 'emitterId' );\r\n\r\n/**\r\n * Mixin that injects the {@link ~Emitter events API} into its host.\r\n *\r\n * @mixin EmitterMixin\r\n * @implements module:utils/emittermixin~Emitter\r\n */\r\nconst EmitterMixin = {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ton( event, callback, options = {} ) {\r\n\t\tthis.listenTo( this, event, callback, options );\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tonce( event, callback, options ) {\r\n\t\tconst onceCallback = function( event, ...args ) {\r\n\t\t\t// Go off() at the first call.\r\n\t\t\tevent.off();\r\n\r\n\t\t\t// Go with the original callback.\r\n\t\t\tcallback.call( this, event, ...args );\r\n\t\t};\r\n\r\n\t\t// Make a similar on() call, simply replacing the callback.\r\n\t\tthis.listenTo( this, event, onceCallback, options );\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\toff( event, callback ) {\r\n\t\tthis.stopListening( this, event, callback );\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tlistenTo( emitter, event, callback, options = {} ) {\r\n\t\tlet emitterInfo, eventCallbacks;\r\n\r\n\t\t// _listeningTo contains a list of emitters that this object is listening to.\r\n\t\t// This list has the following format:\r\n\t\t//\r\n\t\t// _listeningTo: {\r\n\t\t//     emitterId: {\r\n\t\t//         emitter: emitter,\r\n\t\t//         callbacks: {\r\n\t\t//             event1: [ callback1, callback2, ... ]\r\n\t\t//             ....\r\n\t\t//         }\r\n\t\t//     },\r\n\t\t//     ...\r\n\t\t// }\r\n\r\n\t\tif ( !this[ _listeningTo ] ) {\r\n\t\t\tthis[ _listeningTo ] = {};\r\n\t\t}\r\n\r\n\t\tconst emitters = this[ _listeningTo ];\r\n\r\n\t\tif ( !_getEmitterId( emitter ) ) {\r\n\t\t\t_setEmitterId( emitter );\r\n\t\t}\r\n\r\n\t\tconst emitterId = _getEmitterId( emitter );\r\n\r\n\t\tif ( !( emitterInfo = emitters[ emitterId ] ) ) {\r\n\t\t\temitterInfo = emitters[ emitterId ] = {\r\n\t\t\t\temitter,\r\n\t\t\t\tcallbacks: {}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif ( !( eventCallbacks = emitterInfo.callbacks[ event ] ) ) {\r\n\t\t\teventCallbacks = emitterInfo.callbacks[ event ] = [];\r\n\t\t}\r\n\r\n\t\teventCallbacks.push( callback );\r\n\r\n\t\t// Finally register the callback to the event.\r\n\t\tcreateEventNamespace( emitter, event );\r\n\t\tconst lists = getCallbacksListsForNamespace( emitter, event );\r\n\t\tconst priority = priorities.get( options.priority );\r\n\r\n\t\tconst callbackDefinition = {\r\n\t\t\tcallback,\r\n\t\t\tpriority\r\n\t\t};\r\n\r\n\t\t// Add the callback to all callbacks list.\r\n\t\tfor ( const callbacks of lists ) {\r\n\t\t\t// Add the callback to the list in the right priority position.\r\n\t\t\tlet added = false;\r\n\r\n\t\t\tfor ( let i = 0; i < callbacks.length; i++ ) {\r\n\t\t\t\tif ( callbacks[ i ].priority < priority ) {\r\n\t\t\t\t\tcallbacks.splice( i, 0, callbackDefinition );\r\n\t\t\t\t\tadded = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add at the end, if right place was not found.\r\n\t\t\tif ( !added ) {\r\n\t\t\t\tcallbacks.push( callbackDefinition );\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstopListening( emitter, event, callback ) {\r\n\t\tconst emitters = this[ _listeningTo ];\r\n\t\tlet emitterId = emitter && _getEmitterId( emitter );\r\n\t\tconst emitterInfo = emitters && emitterId && emitters[ emitterId ];\r\n\t\tconst eventCallbacks = emitterInfo && event && emitterInfo.callbacks[ event ];\r\n\r\n\t\t// Stop if nothing has been listened.\r\n\t\tif ( !emitters || ( emitter && !emitterInfo ) || ( event && !eventCallbacks ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// All params provided. off() that single callback.\r\n\t\tif ( callback ) {\r\n\t\t\tremoveCallback( emitter, event, callback );\r\n\t\t}\r\n\t\t// Only `emitter` and `event` provided. off() all callbacks for that event.\r\n\t\telse if ( eventCallbacks ) {\r\n\t\t\twhile ( ( callback = eventCallbacks.pop() ) ) {\r\n\t\t\t\tremoveCallback( emitter, event, callback );\r\n\t\t\t}\r\n\r\n\t\t\tdelete emitterInfo.callbacks[ event ];\r\n\t\t}\r\n\t\t// Only `emitter` provided. off() all events for that emitter.\r\n\t\telse if ( emitterInfo ) {\r\n\t\t\tfor ( event in emitterInfo.callbacks ) {\r\n\t\t\t\tthis.stopListening( emitter, event );\r\n\t\t\t}\r\n\t\t\tdelete emitters[ emitterId ];\r\n\t\t}\r\n\t\t// No params provided. off() all emitters.\r\n\t\telse {\r\n\t\t\tfor ( emitterId in emitters ) {\r\n\t\t\t\tthis.stopListening( emitters[ emitterId ].emitter );\r\n\t\t\t}\r\n\t\t\tdelete this[ _listeningTo ];\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tfire( eventOrInfo, ...args ) {\r\n\t\tconst eventInfo = eventOrInfo instanceof EventInfo ? eventOrInfo : new EventInfo( this, eventOrInfo );\r\n\t\tconst event = eventInfo.name;\r\n\t\tlet callbacks = getCallbacksForEvent( this, event );\r\n\r\n\t\t// Record that the event passed this emitter on its path.\r\n\t\teventInfo.path.push( this );\r\n\r\n\t\t// Handle event listener callbacks first.\r\n\t\tif ( callbacks ) {\r\n\t\t\t// Arguments passed to each callback.\r\n\t\t\tconst callbackArgs = [ eventInfo, ...args ];\r\n\r\n\t\t\t// Copying callbacks array is the easiest and most secure way of preventing infinite loops, when event callbacks\r\n\t\t\t// are added while processing other callbacks. Previous solution involved adding counters (unique ids) but\r\n\t\t\t// failed if callbacks were added to the queue before currently processed callback.\r\n\t\t\t// If this proves to be too inefficient, another method is to change `.on()` so callbacks are stored if same\r\n\t\t\t// event is currently processed. Then, `.fire()` at the end, would have to add all stored events.\r\n\t\t\tcallbacks = Array.from( callbacks );\r\n\r\n\t\t\tfor ( let i = 0; i < callbacks.length; i++ ) {\r\n\t\t\t\tcallbacks[ i ].callback.apply( this, callbackArgs );\r\n\r\n\t\t\t\t// Remove the callback from future requests if off() has been called.\r\n\t\t\t\tif ( eventInfo.off.called ) {\r\n\t\t\t\t\t// Remove the called mark for the next calls.\r\n\t\t\t\t\tdelete eventInfo.off.called;\r\n\r\n\t\t\t\t\tremoveCallback( this, event, callbacks[ i ].callback );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Do not execute next callbacks if stop() was called.\r\n\t\t\t\tif ( eventInfo.stop.called ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Delegate event to other emitters if needed.\r\n\t\tif ( this._delegations ) {\r\n\t\t\tconst destinations = this._delegations.get( event );\r\n\t\t\tconst passAllDestinations = this._delegations.get( '*' );\r\n\r\n\t\t\tif ( destinations ) {\r\n\t\t\t\tfireDelegatedEvents( destinations, eventInfo, args );\r\n\t\t\t}\r\n\r\n\t\t\tif ( passAllDestinations ) {\r\n\t\t\t\tfireDelegatedEvents( passAllDestinations, eventInfo, args );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn eventInfo.return;\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdelegate( ...events ) {\r\n\t\treturn {\r\n\t\t\tto: ( emitter, nameOrFunction ) => {\r\n\t\t\t\tif ( !this._delegations ) {\r\n\t\t\t\t\tthis._delegations = new Map();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( const eventName of events ) {\r\n\t\t\t\t\tconst destinations = this._delegations.get( eventName );\r\n\r\n\t\t\t\t\tif ( !destinations ) {\r\n\t\t\t\t\t\tthis._delegations.set( eventName, new Map( [ [ emitter, nameOrFunction ] ] ) );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdestinations.set( emitter, nameOrFunction );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstopDelegating( event, emitter ) {\r\n\t\tif ( !this._delegations ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !event ) {\r\n\t\t\tthis._delegations.clear();\r\n\t\t} else if ( !emitter ) {\r\n\t\t\tthis._delegations.delete( event );\r\n\t\t} else {\r\n\t\t\tconst destinations = this._delegations.get( event );\r\n\r\n\t\t\tif ( destinations ) {\r\n\t\t\t\tdestinations.delete( emitter );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default EmitterMixin;\r\n\r\n/**\r\n * Emitter/listener interface.\r\n *\r\n * Can be easily implemented by a class by mixing the {@link module:utils/emittermixin~EmitterMixin} mixin.\r\n *\r\n * @interface Emitter\r\n */\r\n\r\n/**\r\n * Registers a callback function to be executed when an event is fired.\r\n *\r\n * Shorthand for {@link #listenTo `this.listenTo( this, event, callback, options )`} (it makes the emitter\r\n * listen on itself).\r\n *\r\n * @method #on\r\n * @param {String} event The name of the event.\r\n * @param {Function} callback The function to be called on event.\r\n * @param {Object} [options={}] Additional options.\r\n * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of this event callback. The higher\r\n * the priority value the sooner the callback will be fired. Events having the same priority are called in the\r\n * order they were added.\r\n */\r\n\r\n/**\r\n * Registers a callback function to be executed on the next time the event is fired only. This is similar to\r\n * calling {@link #on} followed by {@link #off} in the callback.\r\n *\r\n * @method #once\r\n * @param {String} event The name of the event.\r\n * @param {Function} callback The function to be called on event.\r\n * @param {Object} [options={}] Additional options.\r\n * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of this event callback. The higher\r\n * the priority value the sooner the callback will be fired. Events having the same priority are called in the\r\n * order they were added.\r\n */\r\n\r\n/**\r\n * Stops executing the callback on the given event.\r\n * Shorthand for {@link #stopListening `this.stopListening( this, event, callback )`}.\r\n *\r\n * @method #off\r\n * @param {String} event The name of the event.\r\n * @param {Function} callback The function to stop being called.\r\n */\r\n\r\n/**\r\n * Registers a callback function to be executed when an event is fired in a specific (emitter) object.\r\n *\r\n * Events can be grouped in namespaces using `:`.\r\n * When namespaced event is fired, it additionally fires all callbacks for that namespace.\r\n *\r\n *\t\t// myEmitter.on( ... ) is a shorthand for myEmitter.listenTo( myEmitter, ... ).\r\n *\t\tmyEmitter.on( 'myGroup', genericCallback );\r\n *\t\tmyEmitter.on( 'myGroup:myEvent', specificCallback );\r\n *\r\n *\t\t// genericCallback is fired.\r\n *\t\tmyEmitter.fire( 'myGroup' );\r\n *\t\t// both genericCallback and specificCallback are fired.\r\n *\t\tmyEmitter.fire( 'myGroup:myEvent' );\r\n *\t\t// genericCallback is fired even though there are no callbacks for \"foo\".\r\n *\t\tmyEmitter.fire( 'myGroup:foo' );\r\n *\r\n * An event callback can {@link module:utils/eventinfo~EventInfo#stop stop the event} and\r\n * set the {@link module:utils/eventinfo~EventInfo#return return value} of the {@link #fire} method.\r\n *\r\n * @method #listenTo\r\n * @param {module:utils/emittermixin~Emitter} emitter The object that fires the event.\r\n * @param {String} event The name of the event.\r\n * @param {Function} callback The function to be called on event.\r\n * @param {Object} [options={}] Additional options.\r\n * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of this event callback. The higher\r\n * the priority value the sooner the callback will be fired. Events having the same priority are called in the\r\n * order they were added.\r\n */\r\n\r\n/**\r\n * Stops listening for events. It can be used at different levels:\r\n *\r\n * * To stop listening to a specific callback.\r\n * * To stop listening to a specific event.\r\n * * To stop listening to all events fired by a specific object.\r\n * * To stop listening to all events fired by all objects.\r\n *\r\n * @method #stopListening\r\n * @param {module:utils/emittermixin~Emitter} [emitter] The object to stop listening to. If omitted, stops it for all objects.\r\n * @param {String} [event] (Requires the `emitter`) The name of the event to stop listening to. If omitted, stops it\r\n * for all events from `emitter`.\r\n * @param {Function} [callback] (Requires the `event`) The function to be removed from the call list for the given\r\n * `event`.\r\n */\r\n\r\n/**\r\n * Fires an event, executing all callbacks registered for it.\r\n *\r\n * The first parameter passed to callbacks is an {@link module:utils/eventinfo~EventInfo} object,\r\n * followed by the optional `args` provided in the `fire()` method call.\r\n *\r\n * @method #fire\r\n * @param {String|module:utils/eventinfo~EventInfo} eventOrInfo The name of the event or `EventInfo` object if event is delegated.\r\n * @param {...*} [args] Additional arguments to be passed to the callbacks.\r\n * @returns {*} By default the method returns `undefined`. However, the return value can be changed by listeners\r\n * through modification of the {@link module:utils/eventinfo~EventInfo#return `evt.return`}'s property (the event info\r\n * is the first param of every callback).\r\n */\r\n\r\n/**\r\n * Delegates selected events to another {@link module:utils/emittermixin~Emitter}. For instance:\r\n *\r\n *\t\temitterA.delegate( 'eventX' ).to( emitterB );\r\n *\t\temitterA.delegate( 'eventX', 'eventY' ).to( emitterC );\r\n *\r\n * then `eventX` is delegated (fired by) `emitterB` and `emitterC` along with `data`:\r\n *\r\n *\t\temitterA.fire( 'eventX', data );\r\n *\r\n * and `eventY` is delegated (fired by) `emitterC` along with `data`:\r\n *\r\n *\t\temitterA.fire( 'eventY', data );\r\n *\r\n * @method #delegate\r\n * @param {...String} events Event names that will be delegated to another emitter.\r\n * @returns {module:utils/emittermixin~EmitterMixinDelegateChain}\r\n */\r\n\r\n/**\r\n * Stops delegating events. It can be used at different levels:\r\n *\r\n * * To stop delegating all events.\r\n * * To stop delegating a specific event to all emitters.\r\n * * To stop delegating a specific event to a specific emitter.\r\n *\r\n * @method #stopDelegating\r\n * @param {String} [event] The name of the event to stop delegating. If omitted, stops it all delegations.\r\n * @param {module:utils/emittermixin~Emitter} [emitter] (requires `event`) The object to stop delegating a particular event to.\r\n * If omitted, stops delegation of `event` to all emitters.\r\n */\r\n\r\n/**\r\n * Checks if `listeningEmitter` listens to an emitter with given `listenedToEmitterId` and if so, returns that emitter.\r\n * If not, returns `null`.\r\n *\r\n * @protected\r\n * @param {module:utils/emittermixin~EmitterMixin} listeningEmitter Emitter that listens.\r\n * @param {String} listenedToEmitterId Unique emitter id of emitter listened to.\r\n * @returns {module:utils/emittermixin~EmitterMixin|null}\r\n */\r\nexport function _getEmitterListenedTo( listeningEmitter, listenedToEmitterId ) {\r\n\tif ( listeningEmitter[ _listeningTo ] && listeningEmitter[ _listeningTo ][ listenedToEmitterId ] ) {\r\n\t\treturn listeningEmitter[ _listeningTo ][ listenedToEmitterId ].emitter;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Sets emitter's unique id.\r\n *\r\n * **Note:** `_emitterId` can be set only once.\r\n *\r\n * @protected\r\n * @param {module:utils/emittermixin~EmitterMixin} emitter Emitter for which id will be set.\r\n * @param {String} [id] Unique id to set. If not passed, random unique id will be set.\r\n */\r\nexport function _setEmitterId( emitter, id ) {\r\n\tif ( !emitter[ _emitterId ] ) {\r\n\t\temitter[ _emitterId ] = id || uid();\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns emitter's unique id.\r\n *\r\n * @protected\r\n * @param {module:utils/emittermixin~EmitterMixin} emitter Emitter which id will be returned.\r\n */\r\nexport function _getEmitterId( emitter ) {\r\n\treturn emitter[ _emitterId ];\r\n}\r\n\r\n// Gets the internal `_events` property of the given object.\r\n// `_events` property store all lists with callbacks for registered event names.\r\n// If there were no events registered on the object, empty `_events` object is created.\r\nfunction getEvents( source ) {\r\n\tif ( !source._events ) {\r\n\t\tObject.defineProperty( source, '_events', {\r\n\t\t\tvalue: {}\r\n\t\t} );\r\n\t}\r\n\r\n\treturn source._events;\r\n}\r\n\r\n// Creates event node for generic-specific events relation architecture.\r\nfunction makeEventNode() {\r\n\treturn {\r\n\t\tcallbacks: [],\r\n\t\tchildEvents: []\r\n\t};\r\n}\r\n\r\n// Creates an architecture for generic-specific events relation.\r\n// If needed, creates all events for given eventName, i.e. if the first registered event\r\n// is foo:bar:abc, it will create foo:bar:abc, foo:bar and foo event and tie them together.\r\n// It also copies callbacks from more generic events to more specific events when\r\n// specific events are created.\r\nfunction createEventNamespace( source, eventName ) {\r\n\tconst events = getEvents( source );\r\n\r\n\t// First, check if the event we want to add to the structure already exists.\r\n\tif ( events[ eventName ] ) {\r\n\t\t// If it exists, we don't have to do anything.\r\n\t\treturn;\r\n\t}\r\n\r\n\t// In other case, we have to create the structure for the event.\r\n\t// Note, that we might need to create intermediate events too.\r\n\t// I.e. if foo:bar:abc is being registered and we only have foo in the structure,\r\n\t// we need to also register foo:bar.\r\n\r\n\t// Currently processed event name.\r\n\tlet name = eventName;\r\n\t// Name of the event that is a child event for currently processed event.\r\n\tlet childEventName = null;\r\n\r\n\t// Array containing all newly created specific events.\r\n\tconst newEventNodes = [];\r\n\r\n\t// While loop can't check for ':' index because we have to handle generic events too.\r\n\t// In each loop, we truncate event name, going from the most specific name to the generic one.\r\n\t// I.e. foo:bar:abc -> foo:bar -> foo.\r\n\twhile ( name !== '' ) {\r\n\t\tif ( events[ name ] ) {\r\n\t\t\t// If the currently processed event name is already registered, we can be sure\r\n\t\t\t// that it already has all the structure created, so we can break the loop here\r\n\t\t\t// as no more events need to be registered.\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// If this event is not yet registered, create a new object for it.\r\n\t\tevents[ name ] = makeEventNode();\r\n\t\t// Add it to the array with newly created events.\r\n\t\tnewEventNodes.push( events[ name ] );\r\n\r\n\t\t// Add previously processed event name as a child of this event.\r\n\t\tif ( childEventName ) {\r\n\t\t\tevents[ name ].childEvents.push( childEventName );\r\n\t\t}\r\n\r\n\t\tchildEventName = name;\r\n\t\t// If `.lastIndexOf()` returns -1, `.substr()` will return '' which will break the loop.\r\n\t\tname = name.substr( 0, name.lastIndexOf( ':' ) );\r\n\t}\r\n\r\n\tif ( name !== '' ) {\r\n\t\t// If name is not empty, we found an already registered event that was a parent of the\r\n\t\t// event we wanted to register.\r\n\r\n\t\t// Copy that event's callbacks to newly registered events.\r\n\t\tfor ( const node of newEventNodes ) {\r\n\t\t\tnode.callbacks = events[ name ].callbacks.slice();\r\n\t\t}\r\n\r\n\t\t// Add last newly created event to the already registered event.\r\n\t\tevents[ name ].childEvents.push( childEventName );\r\n\t}\r\n}\r\n\r\n// Gets an array containing callbacks list for a given event and it's more specific events.\r\n// I.e. if given event is foo:bar and there is also foo:bar:abc event registered, this will\r\n// return callback list of foo:bar and foo:bar:abc (but not foo).\r\nfunction getCallbacksListsForNamespace( source, eventName ) {\r\n\tconst eventNode = getEvents( source )[ eventName ];\r\n\r\n\tif ( !eventNode ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tlet callbacksLists = [ eventNode.callbacks ];\r\n\r\n\tfor ( let i = 0; i < eventNode.childEvents.length; i++ ) {\r\n\t\tconst childCallbacksLists = getCallbacksListsForNamespace( source, eventNode.childEvents[ i ] );\r\n\r\n\t\tcallbacksLists = callbacksLists.concat( childCallbacksLists );\r\n\t}\r\n\r\n\treturn callbacksLists;\r\n}\r\n\r\n// Get the list of callbacks for a given event, but only if there any callbacks have been registered.\r\n// If there are no callbacks registered for given event, it checks if this is a specific event and looks\r\n// for callbacks for it's more generic version.\r\nfunction getCallbacksForEvent( source, eventName ) {\r\n\tlet event;\r\n\r\n\tif ( !source._events || !( event = source._events[ eventName ] ) || !event.callbacks.length ) {\r\n\t\t// There are no callbacks registered for specified eventName.\r\n\t\t// But this could be a specific-type event that is in a namespace.\r\n\t\tif ( eventName.indexOf( ':' ) > -1 ) {\r\n\t\t\t// If the eventName is specific, try to find callback lists for more generic event.\r\n\t\t\treturn getCallbacksForEvent( source, eventName.substr( 0, eventName.lastIndexOf( ':' ) ) );\r\n\t\t} else {\r\n\t\t\t// If this is a top-level generic event, return null;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn event.callbacks;\r\n}\r\n\r\n// Fires delegated events for given map of destinations.\r\n//\r\n// @private\r\n// * @param {Map.<utils.Emitter>} destinations A map containing `[ {@link utils.Emitter}, \"event name\" ]` pair destinations.\r\n// * @param {utils.EventInfo} eventInfo The original event info object.\r\n// * @param {Array.<*>} fireArgs Arguments the original event was fired with.\r\nfunction fireDelegatedEvents( destinations, eventInfo, fireArgs ) {\r\n\tfor ( let [ emitter, name ] of destinations ) {\r\n\t\tif ( !name ) {\r\n\t\t\tname = eventInfo.name;\r\n\t\t} else if ( typeof name == 'function' ) {\r\n\t\t\tname = name( eventInfo.name );\r\n\t\t}\r\n\r\n\t\tconst delegatedInfo = new EventInfo( eventInfo.source, name );\r\n\r\n\t\tdelegatedInfo.path = [ ...eventInfo.path ];\r\n\r\n\t\temitter.fire( delegatedInfo, ...fireArgs );\r\n\t}\r\n}\r\n\r\n// Removes callback from emitter for given event.\r\n//\r\n// @param {module:utils/emittermixin~Emitter} emitter\r\n// @param {String} event\r\n// @param {Function} callback\r\nfunction removeCallback( emitter, event, callback ) {\r\n\tconst lists = getCallbacksListsForNamespace( emitter, event );\r\n\r\n\tfor ( const callbacks of lists ) {\r\n\t\tfor ( let i = 0; i < callbacks.length; i++ ) {\r\n\t\t\tif ( callbacks[ i ].callback == callback ) {\r\n\t\t\t\t// Remove the callback from the list (fixing the next index).\r\n\t\t\t\tcallbacks.splice( i, 1 );\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * The return value of {@link ~EmitterMixin#delegate}.\r\n *\r\n * @interface module:utils/emittermixin~EmitterMixinDelegateChain\r\n */\r\n\r\n/**\r\n * Selects destination for {@link module:utils/emittermixin~EmitterMixin#delegate} events.\r\n *\r\n * @method #to\r\n * @param {module:utils/emittermixin~Emitter} emitter An `EmitterMixin` instance which is the destination for delegated events.\r\n * @param {String|Function} [nameOrFunction] A custom event name or function which converts the original name string.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/mix\r\n */\r\n\r\n/**\r\n * Copies enumerable properties and symbols from the objects given as 2nd+ parameters to the\r\n * prototype of first object (a constructor).\r\n *\r\n *\t\tclass Editor {\r\n *\t\t\t...\r\n *\t\t}\r\n *\r\n *\t\tconst SomeMixin = {\r\n *\t\t\ta() {\r\n *\t\t\t\treturn 'a';\r\n *\t\t\t}\r\n *\t\t};\r\n *\r\n *\t\tmix( Editor, SomeMixin, ... );\r\n *\r\n *\t\tnew Editor().a(); // -> 'a'\r\n *\r\n * Note: Properties which already exist in the base class will not be overriden.\r\n *\r\n * @param {Function} [baseClass] Class which prototype will be extended.\r\n * @param {Object} [...mixins] Objects from which to get properties.\r\n */\r\nexport default function mix( baseClass, ...mixins ) {\r\n\tmixins.forEach( mixin => {\r\n\t\tObject.getOwnPropertyNames( mixin ).concat( Object.getOwnPropertySymbols( mixin ) )\r\n\t\t\t.forEach( key => {\r\n\t\t\t\tif ( key in baseClass.prototype ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst sourceDescriptor = Object.getOwnPropertyDescriptor( mixin, key );\r\n\t\t\t\tsourceDescriptor.enumerable = false;\r\n\r\n\t\t\t\tObject.defineProperty( baseClass.prototype, key, sourceDescriptor );\r\n\t\t\t} );\r\n\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/comparearrays\r\n */\r\n\r\n/**\r\n * Compares how given arrays relate to each other. One array can be: same as another array, prefix of another array\r\n * or completely different. If arrays are different, first index at which they differ is returned. Otherwise,\r\n * a flag specifying the relation is returned. Flags are negative numbers, so whenever a number >= 0 is returned\r\n * it means that arrays differ.\r\n *\r\n *\t\tcompareArrays( [ 0, 2 ], [ 0, 2 ] );\t\t// 'same'\r\n *\t\tcompareArrays( [ 0, 2 ], [ 0, 2, 1 ] );\t\t// 'prefix'\r\n *\t\tcompareArrays( [ 0, 2 ], [ 0 ] );\t\t\t// 'extension'\r\n *\t\tcompareArrays( [ 0, 2 ], [ 1, 2 ] );\t\t// 0\r\n *\t\tcompareArrays( [ 0, 2 ], [ 0, 1 ] );\t\t// 1\r\n *\r\n * @param {Array} a Array that is compared.\r\n * @param {Array} b Array to compare with.\r\n * @returns {module:utils/comparearrays~ArrayRelation} How array `a` is related to `b`.\r\n */\r\nexport default function compareArrays( a, b ) {\r\n\tconst minLen = Math.min( a.length, b.length );\r\n\r\n\tfor ( let i = 0; i < minLen; i++ ) {\r\n\t\tif ( a[ i ] != b[ i ] ) {\r\n\t\t\t// The arrays are different.\r\n\t\t\treturn i;\r\n\t\t}\r\n\t}\r\n\r\n\t// Both arrays were same at all points.\r\n\tif ( a.length == b.length ) {\r\n\t\t// If their length is also same, they are the same.\r\n\t\treturn 'same';\r\n\t} else if ( a.length < b.length ) {\r\n\t\t// Compared array is shorter so it is a prefix of the other array.\r\n\t\treturn 'prefix';\r\n\t} else {\r\n\t\t// Compared array is longer so it is an extension of the other array.\r\n\t\treturn 'extension';\r\n\t}\r\n}\r\n\r\n/**\r\n * @typedef {'extension'|'same'|'prefix'} module:utils/comparearrays~ArrayRelation\r\n */\r\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import ListCache from './_ListCache.js';\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\nexport default stackClear;\n","/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\nexport default stackDelete;\n","/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\nexport default stackGet;\n","/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\nexport default stackHas;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import ListCache from './_ListCache.js';\nimport Map from './_Map.js';\nimport MapCache from './_MapCache.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\nexport default stackSet;\n","import ListCache from './_ListCache.js';\nimport stackClear from './_stackClear.js';\nimport stackDelete from './_stackDelete.js';\nimport stackGet from './_stackGet.js';\nimport stackHas from './_stackHas.js';\nimport stackSet from './_stackSet.js';\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\nexport default Stack;\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nexport default arrayEach;\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","import defineProperty from './_defineProperty.js';\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nexport default baseAssignValue;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignValue;\n","import assignValue from './_assignValue.js';\nimport baseAssignValue from './_baseAssignValue.js';\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nexport default copyObject;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nexport default baseTimes;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","import baseTimes from './_baseTimes.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isIndex from './_isIndex.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default arrayLikeKeys;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeys from './_baseKeys.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nexport default keys;\n","import copyObject from './_copyObject.js';\nimport keys from './keys.js';\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\nexport default baseAssign;\n","/**\n * This function is like\n * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * except that it includes inherited enumerable properties.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction nativeKeysIn(object) {\n  var result = [];\n  if (object != null) {\n    for (var key in Object(object)) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default nativeKeysIn;\n","import isObject from './isObject.js';\nimport isPrototype from './_isPrototype.js';\nimport nativeKeysIn from './_nativeKeysIn.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeysIn(object) {\n  if (!isObject(object)) {\n    return nativeKeysIn(object);\n  }\n  var isProto = isPrototype(object),\n      result = [];\n\n  for (var key in object) {\n    if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeysIn;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeysIn from './_baseKeysIn.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own and inherited enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keysIn(new Foo);\n * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n */\nfunction keysIn(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);\n}\n\nexport default keysIn;\n","import copyObject from './_copyObject.js';\nimport keysIn from './keysIn.js';\n\n/**\n * The base implementation of `_.assignIn` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssignIn(object, source) {\n  return object && copyObject(source, keysIn(source), object);\n}\n\nexport default baseAssignIn;\n","/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\nexport default copyArray;\n","/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default arrayFilter;\n","/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\nexport default stubArray;\n","import arrayFilter from './_arrayFilter.js';\nimport stubArray from './stubArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\nexport default getSymbols;\n","import copyObject from './_copyObject.js';\nimport getSymbols from './_getSymbols.js';\n\n/**\n * Copies own symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\nexport default copySymbols;\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","import arrayPush from './_arrayPush.js';\nimport getPrototype from './_getPrototype.js';\nimport getSymbols from './_getSymbols.js';\nimport stubArray from './stubArray.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own and inherited enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {\n  var result = [];\n  while (object) {\n    arrayPush(result, getSymbols(object));\n    object = getPrototype(object);\n  }\n  return result;\n};\n\nexport default getSymbolsIn;\n","import copyObject from './_copyObject.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\n\n/**\n * Copies own and inherited symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbolsIn(source, object) {\n  return copyObject(source, getSymbolsIn(source), object);\n}\n\nexport default copySymbolsIn;\n","import arrayPush from './_arrayPush.js';\nimport isArray from './isArray.js';\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\nexport default baseGetAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbols from './_getSymbols.js';\nimport keys from './keys.js';\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\nexport default getAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\nimport keysIn from './keysIn.js';\n\n/**\n * Creates an array of own and inherited enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeysIn(object) {\n  return baseGetAllKeys(object, keysIn, getSymbolsIn);\n}\n\nexport default getAllKeysIn;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = new array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\nexport default initCloneArray;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Uint8Array = root.Uint8Array;\n\nexport default Uint8Array;\n","import Uint8Array from './_Uint8Array.js';\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\nexport default cloneArrayBuffer;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\nexport default cloneDataView;\n","/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\nexport default cloneRegExp;\n","import Symbol from './_Symbol.js';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\nexport default cloneSymbol;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\nexport default cloneTypedArray;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\nimport cloneDataView from './_cloneDataView.js';\nimport cloneRegExp from './_cloneRegExp.js';\nimport cloneSymbol from './_cloneSymbol.js';\nimport cloneTypedArray from './_cloneTypedArray.js';\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Map`, `Number`, `RegExp`, `Set`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return new Ctor;\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return new Ctor;\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\nexport default initCloneByTag;\n","import isObject from './isObject.js';\n\n/** Built-in value references. */\nvar objectCreate = Object.create;\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} proto The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nvar baseCreate = (function() {\n  function object() {}\n  return function(proto) {\n    if (!isObject(proto)) {\n      return {};\n    }\n    if (objectCreate) {\n      return objectCreate(proto);\n    }\n    object.prototype = proto;\n    var result = new object;\n    object.prototype = undefined;\n    return result;\n  };\n}());\n\nexport default baseCreate;\n","import baseCreate from './_baseCreate.js';\nimport getPrototype from './_getPrototype.js';\nimport isPrototype from './_isPrototype.js';\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\nexport default initCloneObject;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]';\n\n/**\n * The base implementation of `_.isMap` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n */\nfunction baseIsMap(value) {\n  return isObjectLike(value) && getTag(value) == mapTag;\n}\n\nexport default baseIsMap;\n","import baseIsMap from './_baseIsMap.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsMap = nodeUtil && nodeUtil.isMap;\n\n/**\n * Checks if `value` is classified as a `Map` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n * @example\n *\n * _.isMap(new Map);\n * // => true\n *\n * _.isMap(new WeakMap);\n * // => false\n */\nvar isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;\n\nexport default isMap;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar setTag = '[object Set]';\n\n/**\n * The base implementation of `_.isSet` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n */\nfunction baseIsSet(value) {\n  return isObjectLike(value) && getTag(value) == setTag;\n}\n\nexport default baseIsSet;\n","import baseIsSet from './_baseIsSet.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsSet = nodeUtil && nodeUtil.isSet;\n\n/**\n * Checks if `value` is classified as a `Set` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n * @example\n *\n * _.isSet(new Set);\n * // => true\n *\n * _.isSet(new WeakSet);\n * // => false\n */\nvar isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;\n\nexport default isSet;\n","import Stack from './_Stack.js';\nimport arrayEach from './_arrayEach.js';\nimport assignValue from './_assignValue.js';\nimport baseAssign from './_baseAssign.js';\nimport baseAssignIn from './_baseAssignIn.js';\nimport cloneBuffer from './_cloneBuffer.js';\nimport copyArray from './_copyArray.js';\nimport copySymbols from './_copySymbols.js';\nimport copySymbolsIn from './_copySymbolsIn.js';\nimport getAllKeys from './_getAllKeys.js';\nimport getAllKeysIn from './_getAllKeysIn.js';\nimport getTag from './_getTag.js';\nimport initCloneArray from './_initCloneArray.js';\nimport initCloneByTag from './_initCloneByTag.js';\nimport initCloneObject from './_initCloneObject.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isMap from './isMap.js';\nimport isObject from './isObject.js';\nimport isSet from './isSet.js';\nimport keys from './keys.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_FLAT_FLAG = 2,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Deep clone\n *  2 - Flatten inherited properties\n *  4 - Clone symbols\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, bitmask, customizer, key, object, stack) {\n  var result,\n      isDeep = bitmask & CLONE_DEEP_FLAG,\n      isFlat = bitmask & CLONE_FLAT_FLAG,\n      isFull = bitmask & CLONE_SYMBOLS_FLAG;\n\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      result = (isFlat || isFunc) ? {} : initCloneObject(value);\n      if (!isDeep) {\n        return isFlat\n          ? copySymbolsIn(value, baseAssignIn(result, value))\n          : copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (isSet(value)) {\n    value.forEach(function(subValue) {\n      result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));\n    });\n\n    return result;\n  }\n\n  if (isMap(value)) {\n    value.forEach(function(subValue, key) {\n      result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));\n    });\n\n    return result;\n  }\n\n  var keysFunc = isFull\n    ? (isFlat ? getAllKeysIn : getAllKeys)\n    : (isFlat ? keysIn : keys);\n\n  var props = isArr ? undefined : keysFunc(value);\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));\n  });\n  return result;\n}\n\nexport default baseClone;\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * Creates a shallow clone of `value`.\n *\n * **Note:** This method is loosely based on the\n * [structured clone algorithm](https://mdn.io/Structured_clone_algorithm)\n * and supports cloning arrays, array buffers, booleans, date objects, maps,\n * numbers, `Object` objects, regexes, sets, strings, symbols, and typed\n * arrays. The own enumerable properties of `arguments` objects are cloned\n * as plain objects. An empty object is returned for uncloneable values such\n * as error objects, functions, DOM nodes, and WeakMaps.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to clone.\n * @returns {*} Returns the cloned value.\n * @see _.cloneDeep\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var shallow = _.clone(objects);\n * console.log(shallow[0] === objects[0]);\n * // => true\n */\nfunction clone(value) {\n  return baseClone(value, CLONE_SYMBOLS_FLAG);\n}\n\nexport default clone;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/node\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\nimport { clone } from 'lodash-es';\r\n\r\n/**\r\n * Abstract tree view node class.\r\n *\r\n * This is an abstract class. Its constructor should not be used directly.\r\n * Use the {@link module:engine/view/element~Element} class to create view elements\r\n * or {@link module:engine/view/text~Text} class to create view text nodes.\r\n *\r\n * @abstract\r\n */\r\nexport default class Node {\r\n\t/**\r\n\t * Creates a tree view node.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Parent element. Null by default. Set by {@link module:engine/view/element~Element#_insertChild}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment|null}\r\n\t\t */\r\n\t\tthis.parent = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Index of the node in the parent element or null if the node has no parent.\r\n\t *\r\n\t * Accessing this property throws an error if this node's parent element does not contain it.\r\n\t * This means that view tree got broken.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number|null}\r\n\t */\r\n\tget index() {\r\n\t\tlet pos;\r\n\r\n\t\tif ( !this.parent ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// No parent or child doesn't exist in parent's children.\r\n\t\tif ( ( pos = this.parent.getChildIndex( this ) ) == -1 ) {\r\n\t\t\t/**\r\n\t\t\t * The node's parent does not contain this node. It means that the document tree is corrupted.\r\n\t\t\t *\r\n\t\t\t * @error view-node-not-found-in-parent\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-node-not-found-in-parent: The node\\'s parent does not contain this node.' );\r\n\t\t}\r\n\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**\r\n\t * Node's next sibling, or `null` if it is the last child.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|null}\r\n\t */\r\n\tget nextSibling() {\r\n\t\tconst index = this.index;\r\n\r\n\t\treturn ( index !== null && this.parent.getChild( index + 1 ) ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Node's previous sibling, or `null` if it is the first child.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|null}\r\n\t */\r\n\tget previousSibling() {\r\n\t\tconst index = this.index;\r\n\r\n\t\treturn ( index !== null && this.parent.getChild( index - 1 ) ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Top-most ancestor of the node. If the node has no parent it is the root itself.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\tlet root = this; // eslint-disable-line consistent-this\r\n\r\n\t\twhile ( root.parent ) {\r\n\t\t\troot = root.parent;\r\n\t\t}\r\n\r\n\t\treturn root;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/document~Document View document} that owns this node, or `null` if the node is inside\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/document~Document|null}\r\n\t */\r\n\tget document() {\r\n\t\t// Parent might be Node, null or DocumentFragment.\r\n\t\tif ( this.parent instanceof Node ) {\r\n\t\t\treturn this.parent.document;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a path to the node. The path is an array containing indices of consecutive ancestors of this node,\r\n\t * beginning from {@link module:engine/view/node~Node#root root}, down to this node's index.\r\n\t *\r\n\t *\t\tconst abc = downcastWriter.createText( 'abc' );\r\n\t *\t\tconst foo = downcastWriter.createText( 'foo' );\r\n\t *\t\tconst h1 = downcastWriter.createElement( 'h1', null, downcastWriter.createText( 'header' ) );\r\n\t *\t\tconst p = downcastWriter.createElement( 'p', null, [ abc, foo ] );\r\n\t *\t\tconst div = downcastWriter.createElement( 'div', null, [ h1, p ] );\r\n\t *\t\tfoo.getPath(); // Returns [ 1, 3 ]. `foo` is in `p` which is in `div`. `p` starts at offset 1, while `foo` at 3.\r\n\t *\t\th1.getPath(); // Returns [ 0 ].\r\n\t *\t\tdiv.getPath(); // Returns [].\r\n\t *\r\n\t * @returns {Array.<Number>} The path.\r\n\t */\r\n\tgetPath() {\r\n\t\tconst path = [];\r\n\t\tlet node = this; // eslint-disable-line consistent-this\r\n\r\n\t\twhile ( node.parent ) {\r\n\t\t\tpath.unshift( node.index );\r\n\t\t\tnode = node.parent;\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this node.\r\n\t *\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` this node will be also included in parent's array.\r\n\t * @param {Boolean} [options.parentFirst=false] When set to `true`, array will be sorted from node's parent to root element,\r\n\t * otherwise root element will be the first item in the array.\r\n\t * @returns {Array} Array with ancestors.\r\n\t */\r\n\tgetAncestors( options = { includeSelf: false, parentFirst: false } ) {\r\n\t\tconst ancestors = [];\r\n\t\tlet parent = options.includeSelf ? this : this.parent;\r\n\r\n\t\twhile ( parent ) {\r\n\t\t\tancestors[ options.parentFirst ? 'push' : 'unshift' ]( parent );\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn ancestors;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a {@link module:engine/view/element~Element} or {@link module:engine/view/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of both nodes.\r\n\t *\r\n\t * @param {module:engine/view/node~Node} node The second node.\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` both nodes will be considered \"ancestors\" too.\r\n\t * Which means that if e.g. node A is inside B, then their common ancestor will be B.\r\n\t * @returns {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor( node, options = {} ) {\r\n\t\tconst ancestorsA = this.getAncestors( options );\r\n\t\tconst ancestorsB = node.getAncestors( options );\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\twhile ( ancestorsA[ i ] == ancestorsB[ i ] && ancestorsA[ i ] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i === 0 ? null : ancestorsA[ i - 1 ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this node is before given node. `false` is returned if nodes are in different trees (for example,\r\n\t * in different {@link module:engine/view/documentfragment~DocumentFragment}s).\r\n\t *\r\n\t * @param {module:engine/view/node~Node} node Node to compare with.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisBefore( node ) {\r\n\t\t// Given node is not before this node if they are same.\r\n\t\tif ( this == node ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Return `false` if it is impossible to compare nodes.\r\n\t\tif ( this.root !== node.root ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst thisPath = this.getPath();\r\n\t\tconst nodePath = node.getPath();\r\n\r\n\t\tconst result = compareArrays( thisPath, nodePath );\r\n\r\n\t\tswitch ( result ) {\r\n\t\t\tcase 'prefix':\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tcase 'extension':\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn thisPath[ result ] < nodePath[ result ];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this node is after given node. `false` is returned if nodes are in different trees (for example,\r\n\t * in different {@link module:engine/view/documentfragment~DocumentFragment}s).\r\n\t *\r\n\t * @param {module:engine/view/node~Node} node Node to compare with.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisAfter( node ) {\r\n\t\t// Given node is not before this node if they are same.\r\n\t\tif ( this == node ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Return `false` if it is impossible to compare nodes.\r\n\t\tif ( this.root !== node.root ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// In other cases, just check if the `node` is before, and return the opposite.\r\n\t\treturn !this.isBefore( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes node from parent.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_remove() {\r\n\t\tthis.parent._removeChildren( this.index );\r\n\t}\r\n\r\n\t/**\r\n\t * @protected\r\n\t * @param {module:engine/view/document~ChangeType} type Type of the change.\r\n\t * @param {module:engine/view/node~Node} node Changed node.\r\n\t * @fires change\r\n\t */\r\n\t_fireChange( type, node ) {\r\n\t\tthis.fire( 'change:' + type, node );\r\n\r\n\t\tif ( this.parent ) {\r\n\t\t\tthis.parent._fireChange( type, node );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Custom toJSON method to solve child-parent circular dependencies.\r\n\t *\r\n\t * @returns {Object} Clone of this object with the parent property removed.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = clone( this );\r\n\r\n\t\t// Due to circular references we need to remove parent reference.\r\n\t\tdelete json.parent;\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given view tree object is of given type.\r\n\t *\r\n\t * This method is useful when processing view tree objects that are of unknown type. For example, a function\r\n\t * may return {@link module:engine/view/documentfragment~DocumentFragment} or {@link module:engine/view/node~Node}\r\n\t * that can be either text node or element. This method can be used to check what kind of object is returned.\r\n\t *\r\n\t *\t\tobj.is( 'node' ); // true for any node, false for document fragment and text fragment\r\n\t *\t\tobj.is( 'documentFragment' ); // true for document fragment, false for any node\r\n\t *\t\tobj.is( 'element' ); // true for any element, false for text node or document fragment\r\n\t *\t\tobj.is( 'element', 'p' ); // true only for element which name is 'p'\r\n\t *\t\tobj.is( 'p' ); // shortcut for obj.is( 'element', 'p' )\r\n\t *\t\tobj.is( 'text' ); // true for text node, false for element and document fragment\r\n\t *\r\n\t * @method #is\r\n\t * @param {'element'|'containerElement'|'attributeElement'|'emptyElement'|'uiElement'|\r\n\t * 'rootElement'|'documentFragment'|'text'|'textProxy'} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'node';\r\n\t}\r\n\r\n\t/**\r\n\t * Clones this node.\r\n\t *\r\n\t * @protected\r\n\t * @method #_clone\r\n\t * @returns {module:engine/view/node~Node} Clone of this node.\r\n\t */\r\n\r\n\t/**\r\n\t * Checks if provided node is similar to this node.\r\n\t *\r\n\t * @method #isSimilar\r\n\t * @returns {Boolean} True if nodes are similar.\r\n\t */\r\n}\r\n\r\n/**\r\n * Fired when list of {@link module:engine/view/element~Element elements} children changes.\r\n *\r\n * Change event is bubbled – it is fired on all ancestors.\r\n *\r\n * @event change:children\r\n * @param {module:engine/view/node~Node} changedNode\r\n */\r\n\r\n/**\r\n * Fired when list of {@link module:engine/view/element~Element elements} attributes changes.\r\n *\r\n * Change event is bubbled – it is fired on all ancestors.\r\n *\r\n * @event change:attributes\r\n * @param {module:engine/view/node~Node} changedNode\r\n */\r\n\r\n/**\r\n * Fired when {@link module:engine/view/text~Text text nodes} data changes.\r\n *\r\n * Change event is bubbled – it is fired on all ancestors.\r\n *\r\n * @event change:text\r\n * @param {module:engine/view/node~Node} changedNode\r\n */\r\n\r\n/**\r\n * @event change\r\n */\r\n\r\nmix( Node, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/text\r\n */\r\n\r\nimport Node from './node';\r\n\r\n/**\r\n * Tree view text node.\r\n *\r\n * The constructor of this class shouldn't be used directly. To create new Text instances\r\n * use the {@link module:engine/view/downcastwriter~DowncastWriter#createText `DowncastWriter#createText()`}\r\n * method when working on data downcasted from the model or the\r\n * {@link module:engine/view/upcastwriter~UpcastWriter#createText `UpcastWriter#createText()`}\r\n * method when working on non-semantic views.\r\n *\r\n * @extends module:engine/view/node~Node\r\n */\r\nexport default class Text extends Node {\r\n\t/**\r\n\t * Creates a tree view text node.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} data The text's data.\r\n\t */\r\n\tconstructor( data ) {\r\n\t\tsuper();\r\n\r\n\t\t/**\r\n\t\t * The text content.\r\n\t\t *\r\n\t\t * Setting the data fires the {@link module:engine/view/node~Node#event:change:text change event}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {String} module:engine/view/text~Text#_textData\r\n\t\t */\r\n\t\tthis._textData = data;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'text' || super.is( type );\r\n\t}\r\n\r\n\t/**\r\n\t * The text content.\r\n\t *\r\n\t * @readonly\r\n\t * @type {String}\r\n\t */\r\n\tget data() {\r\n\t\treturn this._textData;\r\n\t}\r\n\r\n\t/**\r\n\t * This getter is required when using the addition assignment operator on protected property:\r\n\t *\r\n\t *\t\tconst foo = downcastWriter.createText( 'foo' );\r\n\t *\t\tconst bar = downcastWriter.createText( 'bar' );\r\n\t *\r\n\t *\t\tfoo._data += bar.data;   // executes: `foo._data = foo._data + bar.data`\r\n\t *\t\tconsole.log( foo.data ); // prints: 'foobar'\r\n\t *\r\n\t * If the protected getter didn't exist, `foo._data` will return `undefined` and result of the merge will be invalid.\r\n\t *\r\n\t * @protected\r\n\t * @type {String}\r\n\t */\r\n\tget _data() {\r\n\t\treturn this.data;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets data and fires the {@link module:engine/view/node~Node#event:change:text change event}.\r\n\t *\r\n\t * @protected\r\n\t * @fires change:text\r\n\t * @param {String} data New data for the text node.\r\n\t */\r\n\tset _data( data ) {\r\n\t\tthis._fireChange( 'text', this );\r\n\r\n\t\tthis._textData = data;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this text node is similar to other text node.\r\n\t * Both nodes should have the same data to be considered as similar.\r\n\t *\r\n\t * @param {module:engine/view/text~Text} otherNode Node to check if it is same as this node.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisSimilar( otherNode ) {\r\n\t\tif ( !( otherNode instanceof Text ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this === otherNode || this.data === otherNode.data;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones this node.\r\n\t *\r\n\t * @protected\r\n\t * @returns {module:engine/view/text~Text} Text node that is a clone of this node.\r\n\t */\r\n\t_clone() {\r\n\t\treturn new Text( this.data );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/textproxy\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * TextProxy is a wrapper for substring of {@link module:engine/view/text~Text}. Instance of this class is created by\r\n * {@link module:engine/view/treewalker~TreeWalker} when only a part of {@link module:engine/view/text~Text} needs to be returned.\r\n *\r\n * `TextProxy` has an API similar to {@link module:engine/view/text~Text Text} and allows to do most of the common tasks performed\r\n * on view nodes.\r\n *\r\n * **Note:** Some `TextProxy` instances may represent whole text node, not just a part of it.\r\n * See {@link module:engine/view/textproxy~TextProxy#isPartial}.\r\n *\r\n * **Note:** `TextProxy` is a readonly interface.\r\n *\r\n * **Note:** `TextProxy` instances are created on the fly basing on the current state of parent {@link module:engine/view/text~Text}.\r\n * Because of this it is highly unrecommended to store references to `TextProxy instances because they might get\r\n * invalidated due to operations on Document. Also TextProxy is not a {@link module:engine/view/node~Node} so it can not be\r\n * inserted as a child of {@link module:engine/view/element~Element}.\r\n *\r\n * `TextProxy` instances are created by {@link module:engine/view/treewalker~TreeWalker view tree walker}. You should not need to create\r\n * an instance of this class by your own.\r\n */\r\nexport default class TextProxy {\r\n\t/**\r\n\t * Creates a text proxy.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/text~Text} textNode Text node which part is represented by this text proxy.\r\n\t * @param {Number} offsetInText Offset in {@link module:engine/view/textproxy~TextProxy#textNode text node}\r\n\t * from which the text proxy starts.\r\n\t * @param {Number} length Text proxy length, that is how many text node's characters, starting from `offsetInText` it represents.\r\n\t * @constructor\r\n\t */\r\n\tconstructor( textNode, offsetInText, length ) {\r\n\t\t/**\r\n\t\t * Reference to the {@link module:engine/view/text~Text} element which TextProxy is a substring.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/text~Text} module:engine/view/textproxy~TextProxy#textNode\r\n\t\t */\r\n\t\tthis.textNode = textNode;\r\n\r\n\t\tif ( offsetInText < 0 || offsetInText > textNode.data.length ) {\r\n\t\t\t/**\r\n\t\t\t * Given offsetInText value is incorrect.\r\n\t\t\t *\r\n\t\t\t * @error view-textproxy-wrong-offsetintext\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-textproxy-wrong-offsetintext: Given offsetInText value is incorrect.' );\r\n\t\t}\r\n\r\n\t\tif ( length < 0 || offsetInText + length > textNode.data.length ) {\r\n\t\t\t/**\r\n\t\t\t * Given length value is incorrect.\r\n\t\t\t *\r\n\t\t\t * @error view-textproxy-wrong-length\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-textproxy-wrong-length: Given length value is incorrect.' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Text data represented by this text proxy.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} module:engine/view/textproxy~TextProxy#data\r\n\t\t */\r\n\t\tthis.data = textNode.data.substring( offsetInText, offsetInText + length );\r\n\r\n\t\t/**\r\n\t\t * Offset in the `textNode` where this `TextProxy` instance starts.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} module:engine/view/textproxy~TextProxy#offsetInText\r\n\t\t */\r\n\t\tthis.offsetInText = offsetInText;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset size of this node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget offsetSize() {\r\n\t\treturn this.data.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Flag indicating whether `TextProxy` instance covers only part of the original {@link module:engine/view/text~Text text node}\r\n\t * (`true`) or the whole text node (`false`).\r\n\t *\r\n\t * This is `false` when text proxy starts at the very beginning of {@link module:engine/view/textproxy~TextProxy#textNode textNode}\r\n\t * ({@link module:engine/view/textproxy~TextProxy#offsetInText offsetInText} equals `0`) and text proxy sizes is equal to\r\n\t * text node size.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isPartial() {\r\n\t\treturn this.data.length !== this.textNode.data.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Parent of this text proxy, which is same as parent of text node represented by this text proxy.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tget parent() {\r\n\t\treturn this.textNode.parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Root of this text proxy, which is same as root of text node represented by this text proxy.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this.textNode.root;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/document~Document View document} that owns this text proxy, or `null` if the text proxy is inside\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/document~Document|null}\r\n\t */\r\n\tget document() {\r\n\t\treturn this.textNode.document;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given view tree object is of given type.\r\n\t *\r\n\t * Read more in {@link module:engine/view/node~Node#is}.\r\n\t *\r\n\t * @param {String} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'textProxy';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this text proxy.\r\n\t *\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` {#textNode} will be also included in parent's array.\r\n\t * @param {Boolean} [options.parentFirst=false] When set to `true`, array will be sorted from text proxy parent to\r\n\t * root element, otherwise root element will be the first item in the array.\r\n\t * @returns {Array} Array with ancestors.\r\n\t */\r\n\tgetAncestors( options = { includeSelf: false, parentFirst: false } ) {\r\n\t\tconst ancestors = [];\r\n\t\tlet parent = options.includeSelf ? this.textNode : this.parent;\r\n\r\n\t\twhile ( parent !== null ) {\r\n\t\t\tancestors[ options.parentFirst ? 'push' : 'unshift' ]( parent );\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn ancestors;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/objecttomap\r\n */\r\n\r\n/**\r\n * Transforms object to map.\r\n *\r\n *\t\tconst map = objectToMap( { 'foo': 1, 'bar': 2 } );\r\n *\t\tmap.get( 'foo' ); // 1\r\n *\r\n * @param {Object} obj Object to transform.\r\n * @returns {Map} Map created from object.\r\n */\r\nexport default function objectToMap( obj ) {\r\n\tconst map = new Map();\r\n\r\n\tfor ( const key in obj ) {\r\n\t\tmap.set( key, obj[ key ] );\r\n\t}\r\n\r\n\treturn map;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/isiterable\r\n */\r\n\r\n/**\r\n * Checks if value implements iterator interface.\r\n *\r\n * @param {*} value The value to check.\r\n * @returns {Boolean} True if value implements iterator interface.\r\n */\r\nexport default function isIterable( value ) {\r\n\treturn !!( value && value[ Symbol.iterator ] );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/matcher\r\n */\r\n\r\n/**\r\n * View matcher class.\r\n * Instance of this class can be used to find {@link module:engine/view/element~Element elements} that match given pattern.\r\n */\r\nexport default class Matcher {\r\n\t/**\r\n\t * Creates new instance of Matcher.\r\n\t *\r\n\t * @param {String|RegExp|Object} [pattern] Match patterns. See {@link module:engine/view/matcher~Matcher#add add method} for\r\n\t * more information.\r\n\t */\r\n\tconstructor( ...pattern ) {\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * @type {Array<String|RegExp|Object>}\r\n\t\t */\r\n\t\tthis._patterns = [];\r\n\r\n\t\tthis.add( ...pattern );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds pattern or patterns to matcher instance.\r\n\t *\r\n\t *\t\t// String.\r\n\t *\t\tmatcher.add( 'div' );\r\n\t *\r\n\t *\t\t// Regular expression.\r\n\t *\t\tmatcher.add( /^\\w/ );\r\n\t *\r\n\t *\t\t// Single class.\r\n\t *\t\tmatcher.add( {\r\n\t *\t\t\tclasses: 'foobar'\r\n\t *\t\t} );\r\n\t *\r\n\t * See {@link module:engine/view/matcher~MatcherPattern} for more examples.\r\n\t *\r\n\t * Multiple patterns can be added in one call:\r\n\t *\r\n\t * \t\tmatcher.add( 'div', { classes: 'foobar' } );\r\n\t *\r\n\t * @param {Object|String|RegExp|Function} pattern Object describing pattern details. If string or regular expression\r\n\t * is provided it will be used to match element's name. Pattern can be also provided in a form\r\n\t * of a function - then this function will be called with each {@link module:engine/view/element~Element element} as a parameter.\r\n\t * Function's return value will be stored under `match` key of the object returned from\r\n\t * {@link module:engine/view/matcher~Matcher#match match} or {@link module:engine/view/matcher~Matcher#matchAll matchAll} methods.\r\n\t * @param {String|RegExp} [pattern.name] Name or regular expression to match element's name.\r\n\t * @param {Object} [pattern.attributes] Object with key-value pairs representing attributes to match. Each object key\r\n\t * represents attribute name. Value under that key can be either:\r\n\t * * `true` - then attribute is just required (can be empty),\r\n\t * * a string - then attribute has to be equal, or\r\n\t * * a regular expression - then attribute has to match the expression.\r\n\t * @param {String|RegExp|Array} [pattern.classes] Class name or array of class names to match. Each name can be\r\n\t * provided in a form of string or regular expression.\r\n\t * @param {Object} [pattern.styles] Object with key-value pairs representing styles to match. Each object key\r\n\t * represents style name. Value under that key can be either a string or a regular expression and it will be used\r\n\t * to match style value.\r\n\t */\r\n\tadd( ...pattern ) {\r\n\t\tfor ( let item of pattern ) {\r\n\t\t\t// String or RegExp pattern is used as element's name.\r\n\t\t\tif ( typeof item == 'string' || item instanceof RegExp ) {\r\n\t\t\t\titem = { name: item };\r\n\t\t\t}\r\n\r\n\t\t\t// Single class name/RegExp can be provided.\r\n\t\t\tif ( item.classes && ( typeof item.classes == 'string' || item.classes instanceof RegExp ) ) {\r\n\t\t\t\titem.classes = [ item.classes ];\r\n\t\t\t}\r\n\r\n\t\t\tthis._patterns.push( item );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Matches elements for currently stored patterns. Returns match information about first found\r\n\t * {@link module:engine/view/element~Element element}, otherwise returns `null`.\r\n\t *\r\n\t * Example of returned object:\r\n\t *\r\n\t *\t\t{\r\n\t *\t\t\telement: <instance of found element>,\r\n\t *\t\t\tpattern: <pattern used to match found element>,\r\n\t *\t\t\tmatch: {\r\n\t *\t\t\t\tname: true,\r\n\t *\t\t\t\tattributes: [ 'title', 'href' ],\r\n\t *\t\t\t\tclasses: [ 'foo' ],\r\n\t *\t\t\t\tstyles: [ 'color', 'position' ]\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t * @see module:engine/view/matcher~Matcher#add\r\n\t * @see module:engine/view/matcher~Matcher#matchAll\r\n\t * @param {...module:engine/view/element~Element} element View element to match against stored patterns.\r\n\t * @returns {Object|null} result\r\n\t * @returns {module:engine/view/element~Element} result.element Matched view element.\r\n\t * @returns {Object|String|RegExp|Function} result.pattern Pattern that was used to find matched element.\r\n\t * @returns {Object} result.match Object representing matched element parts.\r\n\t * @returns {Boolean} [result.match.name] True if name of the element was matched.\r\n\t * @returns {Array} [result.match.attributes] Array with matched attribute names.\r\n\t * @returns {Array} [result.match.classes] Array with matched class names.\r\n\t * @returns {Array} [result.match.styles] Array with matched style names.\r\n\t */\r\n\tmatch( ...element ) {\r\n\t\tfor ( const singleElement of element ) {\r\n\t\t\tfor ( const pattern of this._patterns ) {\r\n\t\t\t\tconst match = isElementMatching( singleElement, pattern );\r\n\r\n\t\t\t\tif ( match ) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\telement: singleElement,\r\n\t\t\t\t\t\tpattern,\r\n\t\t\t\t\t\tmatch\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Matches elements for currently stored patterns. Returns array of match information with all found\r\n\t * {@link module:engine/view/element~Element elements}. If no element is found - returns `null`.\r\n\t *\r\n\t * @see module:engine/view/matcher~Matcher#add\r\n\t * @see module:engine/view/matcher~Matcher#match\r\n\t * @param {...module:engine/view/element~Element} element View element to match against stored patterns.\r\n\t * @returns {Array.<Object>|null} Array with match information about found elements or `null`. For more information\r\n\t * see {@link module:engine/view/matcher~Matcher#match match method} description.\r\n\t */\r\n\tmatchAll( ...element ) {\r\n\t\tconst results = [];\r\n\r\n\t\tfor ( const singleElement of element ) {\r\n\t\t\tfor ( const pattern of this._patterns ) {\r\n\t\t\t\tconst match = isElementMatching( singleElement, pattern );\r\n\r\n\t\t\t\tif ( match ) {\r\n\t\t\t\t\tresults.push( {\r\n\t\t\t\t\t\telement: singleElement,\r\n\t\t\t\t\t\tpattern,\r\n\t\t\t\t\t\tmatch\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn results.length > 0 ? results : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the name of the element to match if there is exactly one pattern added to the matcher instance\r\n\t * and it matches element name defined by `string` (not `RegExp`). Otherwise, returns `null`.\r\n\t *\r\n\t * @returns {String|null} Element name trying to match.\r\n\t */\r\n\tgetElementName() {\r\n\t\tif ( this._patterns.length !== 1 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst pattern = this._patterns[ 0 ];\r\n\t\tconst name = pattern.name;\r\n\r\n\t\treturn ( typeof pattern != 'function' && name && !( name instanceof RegExp ) ) ? name : null;\r\n\t}\r\n}\r\n\r\n// Returns match information if {@link module:engine/view/element~Element element} is matching provided pattern.\r\n// If element cannot be matched to provided pattern - returns `null`.\r\n//\r\n// @param {module:engine/view/element~Element} element\r\n// @param {Object|String|RegExp|Function} pattern\r\n// @returns {Object|null} Returns object with match information or null if element is not matching.\r\nfunction isElementMatching( element, pattern ) {\r\n\t// If pattern is provided as function - return result of that function;\r\n\tif ( typeof pattern == 'function' ) {\r\n\t\treturn pattern( element );\r\n\t}\r\n\r\n\tconst match = {};\r\n\t// Check element's name.\r\n\tif ( pattern.name ) {\r\n\t\tmatch.name = matchName( pattern.name, element.name );\r\n\r\n\t\tif ( !match.name ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check element's attributes.\r\n\tif ( pattern.attributes ) {\r\n\t\tmatch.attributes = matchAttributes( pattern.attributes, element );\r\n\r\n\t\tif ( !match.attributes ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check element's classes.\r\n\tif ( pattern.classes ) {\r\n\t\tmatch.classes = matchClasses( pattern.classes, element );\r\n\r\n\t\tif ( !match.classes ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t// Check element's styles.\r\n\tif ( pattern.styles ) {\r\n\t\tmatch.styles = matchStyles( pattern.styles, element );\r\n\r\n\t\tif ( !match.styles ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn match;\r\n}\r\n\r\n// Checks if name can be matched by provided pattern.\r\n//\r\n// @param {String|RegExp} pattern\r\n// @param {String} name\r\n// @returns {Boolean} Returns `true` if name can be matched, `false` otherwise.\r\nfunction matchName( pattern, name ) {\r\n\t// If pattern is provided as RegExp - test against this regexp.\r\n\tif ( pattern instanceof RegExp ) {\r\n\t\treturn pattern.test( name );\r\n\t}\r\n\r\n\treturn pattern === name;\r\n}\r\n\r\n// Checks if attributes of provided element can be matched against provided patterns.\r\n//\r\n// @param {Object} patterns Object with information about attributes to match. Each key of the object will be\r\n// used as attribute name. Value of each key can be a string or regular expression to match against attribute value.\r\n// @param {module:engine/view/element~Element} element Element which attributes will be tested.\r\n// @returns {Array|null} Returns array with matched attribute names or `null` if no attributes were matched.\r\nfunction matchAttributes( patterns, element ) {\r\n\tconst match = [];\r\n\r\n\tfor ( const name in patterns ) {\r\n\t\tconst pattern = patterns[ name ];\r\n\r\n\t\tif ( element.hasAttribute( name ) ) {\r\n\t\t\tconst attribute = element.getAttribute( name );\r\n\r\n\t\t\tif ( pattern === true ) {\r\n\t\t\t\tmatch.push( name );\r\n\t\t\t} else if ( pattern instanceof RegExp ) {\r\n\t\t\t\tif ( pattern.test( attribute ) ) {\r\n\t\t\t\t\tmatch.push( name );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else if ( attribute === pattern ) {\r\n\t\t\t\tmatch.push( name );\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn match;\r\n}\r\n\r\n// Checks if classes of provided element can be matched against provided patterns.\r\n//\r\n// @param {Array.<String|RegExp>} patterns Array of strings or regular expressions to match against element's classes.\r\n// @param {module:engine/view/element~Element} element Element which classes will be tested.\r\n// @returns {Array|null} Returns array with matched class names or `null` if no classes were matched.\r\nfunction matchClasses( patterns, element ) {\r\n\tconst match = [];\r\n\r\n\tfor ( const pattern of patterns ) {\r\n\t\tif ( pattern instanceof RegExp ) {\r\n\t\t\tconst classes = element.getClassNames();\r\n\r\n\t\t\tfor ( const name of classes ) {\r\n\t\t\t\tif ( pattern.test( name ) ) {\r\n\t\t\t\t\tmatch.push( name );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( match.length === 0 ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else if ( element.hasClass( pattern ) ) {\r\n\t\t\tmatch.push( pattern );\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn match;\r\n}\r\n\r\n// Checks if styles of provided element can be matched against provided patterns.\r\n//\r\n// @param {Object} patterns Object with information about styles to match. Each key of the object will be\r\n// used as style name. Value of each key can be a string or regular expression to match against style value.\r\n// @param {module:engine/view/element~Element} element Element which styles will be tested.\r\n// @returns {Array|null} Returns array with matched style names or `null` if no styles were matched.\r\nfunction matchStyles( patterns, element ) {\r\n\tconst match = [];\r\n\r\n\tfor ( const name in patterns ) {\r\n\t\tconst pattern = patterns[ name ];\r\n\r\n\t\tif ( element.hasStyle( name ) ) {\r\n\t\t\tconst style = element.getStyle( name );\r\n\r\n\t\t\tif ( pattern instanceof RegExp ) {\r\n\t\t\t\tif ( pattern.test( style ) ) {\r\n\t\t\t\t\tmatch.push( name );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else if ( style === pattern ) {\r\n\t\t\t\tmatch.push( name );\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn match;\r\n}\r\n\r\n/**\r\n * An entity that is a valid pattern recognized by a matcher. `MatcherPattern` is used by {@link ~Matcher} to recognize\r\n * if a view element fits in a group of view elements described by the pattern.\r\n *\r\n * `MatcherPattern` can be given as a `String`, a `RegExp`, an `Object` or a `Function`.\r\n *\r\n * If `MatcherPattern` is given as a `String` or `RegExp`, it will match any view element that has a matching name:\r\n *\r\n *\t\t// Match any element with name equal to 'div'.\r\n *\t\tconst pattern = 'div';\r\n *\r\n *\t\t// Match any element which name starts on 'p'.\r\n *\t\tconst pattern = /^p/;\r\n *\r\n * If `MatcherPattern` is given as an `Object`, all the object's properties will be matched with view element properties.\r\n *\r\n *\t\t// Match view element's name.\r\n *\t\tconst pattern = { name: /^p/ };\r\n *\r\n *\t\t// Match view element which has matching attributes.\r\n *\t\tconst pattern = {\r\n *\t\t\tattributes: {\r\n *\t\t\t\ttitle: 'foobar',\t// Attribute title should equal 'foobar'.\r\n *\t\t\t\tfoo: /^\\w+/,\t\t// Attribute foo should match /^\\w+/ regexp.\r\n *\t\t\t\tbar: true\t\t\t// Attribute bar should be set (can be empty).\r\n *\t\t\t}\r\n *\t\t};\r\n *\r\n *\t\t// Match view element which has given class.\r\n *\t\tconst pattern = {\r\n *\t\t\tclasses: 'foobar'\r\n *\t\t};\r\n *\r\n *\t\t// Match view element class using regular expression.\r\n *\t\tconst pattern = {\r\n *\t\t\tclasses: /foo.../\r\n *\t\t};\r\n *\r\n *\t\t// Multiple classes to match.\r\n *\t\tconst pattern = {\r\n *\t\t\tclasses: [ 'baz', 'bar', /foo.../ ]\r\n *\t\t};\r\n *\r\n *\t\t// Match view element which has given styles.\r\n *\t\tconst pattern = {\r\n *\t\t\tstyles: {\r\n *\t\t\t\tposition: 'absolute',\r\n *\t\t\t\tcolor: /^\\w*blue$/\r\n *\t\t\t}\r\n *\t\t};\r\n *\r\n *\t\t// Pattern with multiple properties.\r\n *\t\tconst pattern = {\r\n *\t\t\tname: 'span',\r\n *\t\t\tstyles: {\r\n *\t\t\t\t'font-weight': 'bold'\r\n *\t\t\t},\r\n *\t\t\tclasses: 'highlighted'\r\n *\t\t};\r\n *\r\n * If `MatcherPattern` is given as a `Function`, the function takes a view element as a first and only parameter and\r\n * the function should decide whether that element matches. If so, it should return what part of the view element has been matched.\r\n * Otherwise, the function should return `null`. The returned result will be included in `match` property of the object\r\n * returned by {@link ~Matcher#match} call.\r\n *\r\n *\t\t// Match an empty <div> element.\r\n *\t\tconst pattern = element => {\r\n *\t\t\tif ( element.name == 'div' && element.childCount > 0 ) {\r\n *\t\t\t\t// Return which part of the element was matched.\r\n *\t\t\t\treturn { name: true };\r\n *\t\t\t}\r\n *\r\n *\t\t\treturn null;\r\n *\t\t};\r\n *\r\n *\t\t// Match a <p> element with big font (\"heading-like\" element).\r\n *\t\tconst pattern = element => {\r\n *\t\t\tif ( element.name == 'p' ) {\r\n *\t\t\t\tconst fontSize = element.getStyle( 'font-size' );\r\n *\t\t\t\tconst size = fontSize.match( /(\\d+)/px );\r\n *\r\n *\t\t\t\tif ( size && Number( size[ 1 ] ) > 26 ) {\r\n *\t\t\t\t\treturn { name: true, attribute: [ 'font-size' ] };\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\r\n *\t\t\treturn null;\r\n *\t\t};\r\n *\r\n * `MatcherPattern` is defined in a way that it is a superset of {@link module:engine/view/elementdefinition~ElementDefinition},\r\n * that is, every `ElementDefinition` also can be used as a `MatcherPattern`.\r\n *\r\n * @typedef {String|RegExp|Object|Function} module:engine/view/matcher~MatcherPattern\r\n *\r\n * @property {String|RegExp} [name] View element name to match.\r\n * @property {String|RegExp|Array.<String|RegExp>} [classes] View element's class name(s) to match.\r\n * @property {Object} [styles] Object with key-value pairs representing styles to match.\r\n * Each object key represents style name. Value can be given as `String` or `RegExp`.\r\n * @property {Object} [attributes] Object with key-value pairs representing attributes to match.\r\n * Each object key represents attribute name. Value can be given as `String` or `RegExp`.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/element\r\n */\r\n\r\nimport Node from './node';\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport objectToMap from '@ckeditor/ckeditor5-utils/src/objecttomap';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\nimport Matcher from './matcher';\r\nimport { isPlainObject } from 'lodash-es';\r\n\r\n/**\r\n * View element.\r\n *\r\n * The editing engine does not define a fixed semantics of its elements (it is \"DTD-free\").\r\n * This is why the type of the {@link module:engine/view/element~Element} need to\r\n * be defined by the feature developer. When creating an element you should use one of the following methods:\r\n *\r\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createContainerElement `downcastWriter#createContainerElement()`}\r\n * in order to create a {@link module:engine/view/containerelement~ContainerElement},\r\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createAttributeElement `downcastWriter#createAttributeElement()`}\r\n * in order to create a {@link module:engine/view/attributeelement~AttributeElement},\r\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createEmptyElement `downcastWriter#createEmptyElement()`}\r\n * in order to create a {@link module:engine/view/emptyelement~EmptyElement}.\r\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createUIElement `downcastWriter#createUIElement()`}\r\n * in order to create a {@link module:engine/view/uielement~UIElement}.\r\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createEditableElement `downcastWriter#createEditableElement()`}\r\n * in order to create a {@link module:engine/view/editableelement~EditableElement}.\r\n *\r\n * Note that for view elements which are not created from the model, like elements from mutations, paste or\r\n * {@link module:engine/controller/datacontroller~DataController#set data.set} it is not possible to define the type of the element.\r\n * In such cases the {@link module:engine/view/upcastwriter~UpcastWriter#createElement `UpcastWriter#createElement()`} method\r\n * should be used to create generic view elements.\r\n *\r\n * @extends module:engine/view/node~Node\r\n */\r\nexport default class Element extends Node {\r\n\t/**\r\n\t * Creates a view element.\r\n\t *\r\n\t * Attributes can be passed in various formats:\r\n\t *\r\n\t *\t\tnew Element( 'div', { class: 'editor', contentEditable: 'true' } ); // object\r\n\t *\t\tnew Element( 'div', [ [ 'class', 'editor' ], [ 'contentEditable', 'true' ] ] ); // map-like iterator\r\n\t *\t\tnew Element( 'div', mapOfAttributes ); // map\r\n\t *\r\n\t * @protected\r\n\t * @param {String} name Node name.\r\n\t * @param {Object|Iterable} [attrs] Collection of attributes.\r\n\t * @param {module:engine/view/node~Node|Iterable.<module:engine/view/node~Node>} [children]\r\n\t * A list of nodes to be inserted into created element.\r\n\t */\r\n\tconstructor( name, attrs, children ) {\r\n\t\tsuper();\r\n\r\n\t\t/**\r\n\t\t * Name of the element.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.name = name;\r\n\r\n\t\t/**\r\n\t\t * Map of attributes, where attributes names are keys and attributes values are values.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map} #_attrs\r\n\t\t */\r\n\t\tthis._attrs = parseAttributes( attrs );\r\n\r\n\t\t/**\r\n\t\t * Array of child nodes.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Array.<module:engine/view/node~Node>}\r\n\t\t */\r\n\t\tthis._children = [];\r\n\r\n\t\tif ( children ) {\r\n\t\t\tthis._insertChild( 0, children );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Set of classes associated with element instance.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Set}\r\n\t\t */\r\n\t\tthis._classes = new Set();\r\n\r\n\t\tif ( this._attrs.has( 'class' ) ) {\r\n\t\t\t// Remove class attribute and handle it by class set.\r\n\t\t\tconst classString = this._attrs.get( 'class' );\r\n\t\t\tparseClasses( this._classes, classString );\r\n\t\t\tthis._attrs.delete( 'class' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Map of styles.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map} module:engine/view/element~Element#_styles\r\n\t\t */\r\n\t\tthis._styles = new Map();\r\n\r\n\t\tif ( this._attrs.has( 'style' ) ) {\r\n\t\t\t// Remove style attribute and handle it by styles map.\r\n\t\t\tparseInlineStyles( this._styles, this._attrs.get( 'style' ) );\r\n\t\t\tthis._attrs.delete( 'style' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Map of custom properties.\r\n\t\t * Custom properties can be added to element instance, will be cloned but not rendered into DOM.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._customProperties = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Number of element's children.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget childCount() {\r\n\t\treturn this._children.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if there are no nodes inside this element, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isEmpty() {\r\n\t\treturn this._children.length === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given view tree object is of given type.\r\n\t *\r\n\t * Read more in {@link module:engine/view/node~Node#is}.\r\n\t *\r\n\t * @param {String} type\r\n\t * @param {String} [name] Element name.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'element' || type == this.name || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn type == 'element' && name == this.name;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets child at the given index.\r\n\t *\r\n\t * @param {Number} index Index of child.\r\n\t * @returns {module:engine/view/node~Node} Child node.\r\n\t */\r\n\tgetChild( index ) {\r\n\t\treturn this._children[ index ];\r\n\t}\r\n\r\n\t/**\r\n\t * Gets index of the given child node. Returns `-1` if child node is not found.\r\n\t *\r\n\t * @param {module:engine/view/node~Node} node Child node.\r\n\t * @returns {Number} Index of the child node.\r\n\t */\r\n\tgetChildIndex( node ) {\r\n\t\treturn this._children.indexOf( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets child nodes iterator.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/node~Node>} Child nodes iterator.\r\n\t */\r\n\tgetChildren() {\r\n\t\treturn this._children[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that contains the keys for attributes. Order of inserting attributes is not preserved.\r\n\t *\r\n\t * @returns {Iterable.<String>} Keys for attributes.\r\n\t */\r\n\t* getAttributeKeys() {\r\n\t\tif ( this._classes.size > 0 ) {\r\n\t\t\tyield 'class';\r\n\t\t}\r\n\r\n\t\tif ( this._styles.size > 0 ) {\r\n\t\t\tyield 'style';\r\n\t\t}\r\n\r\n\t\t// This is not an optimal solution because of https://github.com/ckeditor/ckeditor5-engine/issues/454.\r\n\t\t// It can be simplified to `yield* this._attrs.keys();`.\r\n\t\tfor ( const key of this._attrs.keys() ) {\r\n\t\t\tyield key;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over this element's attributes.\r\n\t *\r\n\t * Attributes are returned as arrays containing two items. First one is attribute key and second is attribute value.\r\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\t* getAttributes() {\r\n\t\tyield* this._attrs.entries();\r\n\r\n\t\tif ( this._classes.size > 0 ) {\r\n\t\t\tyield [ 'class', this.getAttribute( 'class' ) ];\r\n\t\t}\r\n\r\n\t\tif ( this._styles.size > 0 ) {\r\n\t\t\tyield [ 'style', this.getAttribute( 'style' ) ];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets attribute by key. If attribute is not present - returns undefined.\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @returns {String|undefined} Attribute value.\r\n\t */\r\n\tgetAttribute( key ) {\r\n\t\tif ( key == 'class' ) {\r\n\t\t\tif ( this._classes.size > 0 ) {\r\n\t\t\t\treturn [ ...this._classes ].join( ' ' );\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tif ( key == 'style' ) {\r\n\t\t\tif ( this._styles.size > 0 ) {\r\n\t\t\t\tlet styleString = '';\r\n\r\n\t\t\t\tfor ( const [ property, value ] of this._styles ) {\r\n\t\t\t\t\tstyleString += `${ property }:${ value };`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn styleString;\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn this._attrs.get( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a boolean indicating whether an attribute with the specified key exists in the element.\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @returns {Boolean} `true` if attribute with the specified key exists in the element, false otherwise.\r\n\t */\r\n\thasAttribute( key ) {\r\n\t\tif ( key == 'class' ) {\r\n\t\t\treturn this._classes.size > 0;\r\n\t\t}\r\n\r\n\t\tif ( key == 'style' ) {\r\n\t\t\treturn this._styles.size > 0;\r\n\t\t}\r\n\r\n\t\treturn this._attrs.has( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this element is similar to other element.\r\n\t * Both elements should have the same name and attributes to be considered as similar. Two similar elements\r\n\t * can contain different set of children nodes.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} otherElement\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisSimilar( otherElement ) {\r\n\t\tif ( !( otherElement instanceof Element ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If exactly the same Element is provided - return true immediately.\r\n\t\tif ( this === otherElement ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Check element name.\r\n\t\tif ( this.name != otherElement.name ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Check number of attributes, classes and styles.\r\n\t\tif ( this._attrs.size !== otherElement._attrs.size || this._classes.size !== otherElement._classes.size ||\r\n\t\t\tthis._styles.size !== otherElement._styles.size ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Check if attributes are the same.\r\n\t\tfor ( const [ key, value ] of this._attrs ) {\r\n\t\t\tif ( !otherElement._attrs.has( key ) || otherElement._attrs.get( key ) !== value ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if classes are the same.\r\n\t\tfor ( const className of this._classes ) {\r\n\t\t\tif ( !otherElement._classes.has( className ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if styles are the same.\r\n\t\tfor ( const [ property, value ] of this._styles ) {\r\n\t\t\tif ( !otherElement._styles.has( property ) || otherElement._styles.get( property ) !== value ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if class is present.\r\n\t * If more then one class is provided - returns true only when all classes are present.\r\n\t *\r\n\t *\t\telement.hasClass( 'foo' ); // Returns true if 'foo' class is present.\r\n\t *\t\telement.hasClass( 'foo', 'bar' ); // Returns true if 'foo' and 'bar' classes are both present.\r\n\t *\r\n\t * @param {...String} className\r\n\t */\r\n\thasClass( ...className ) {\r\n\t\tfor ( const name of className ) {\r\n\t\t\tif ( !this._classes.has( name ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that contains all class names.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetClassNames() {\r\n\t\treturn this._classes.keys();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns style value for given property.\r\n\t * Undefined is returned if style does not exist.\r\n\t *\r\n\t * @param {String} property\r\n\t * @returns {String|undefined}\r\n\t */\r\n\tgetStyle( property ) {\r\n\t\treturn this._styles.get( property );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that contains all style names.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetStyleNames() {\r\n\t\treturn this._styles.keys();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if style keys are present.\r\n\t * If more then one style property is provided - returns true only when all properties are present.\r\n\t *\r\n\t *\t\telement.hasStyle( 'color' ); // Returns true if 'border-top' style is present.\r\n\t *\t\telement.hasStyle( 'color', 'border-top' ); // Returns true if 'color' and 'border-top' styles are both present.\r\n\t *\r\n\t * @param {...String} property\r\n\t */\r\n\thasStyle( ...property ) {\r\n\t\tfor ( const name of property ) {\r\n\t\t\tif ( !this._styles.has( name ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestor element that match specified pattern.\r\n\t * Provided patterns should be compatible with {@link module:engine/view/matcher~Matcher Matcher} as it is used internally.\r\n\t *\r\n\t * @see module:engine/view/matcher~Matcher\r\n\t * @param {Object|String|RegExp|Function} patterns Patterns used to match correct ancestor.\r\n\t * See {@link module:engine/view/matcher~Matcher}.\r\n\t * @returns {module:engine/view/element~Element|null} Found element or `null` if no matching ancestor was found.\r\n\t */\r\n\tfindAncestor( ...patterns ) {\r\n\t\tconst matcher = new Matcher( ...patterns );\r\n\t\tlet parent = this.parent;\r\n\r\n\t\twhile ( parent ) {\r\n\t\t\tif ( matcher.match( parent ) ) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the custom property value for the given key.\r\n\t *\r\n\t * @param {String|Symbol} key\r\n\t * @returns {*}\r\n\t */\r\n\tgetCustomProperty( key ) {\r\n\t\treturn this._customProperties.get( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator which iterates over this element's custom properties.\r\n\t * Iterator provides `[ key, value ]` pairs for each stored property.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\t* getCustomProperties() {\r\n\t\tyield* this._customProperties.entries();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns identity string based on element's name, styles, classes and other attributes.\r\n\t * Two elements that {@link #isSimilar are similar} will have same identity string.\r\n\t * It has the following format:\r\n\t *\r\n\t *\t\t'name class=\"class1,class2\" style=\"style1:value1;style2:value2\" attr1=\"val1\" attr2=\"val2\"'\r\n \t *\r\n\t * For example:\r\n\t *\r\n\t *\t\tconst element = writer.createContainerElement( 'foo', {\r\n\t *\t\t\tbanana: '10',\r\n\t *\t\t\tapple: '20',\r\n\t *\t\t\tstyle: 'color: red; border-color: white;',\r\n\t *\t\t\tclass: 'baz'\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// returns 'foo class=\"baz\" style=\"border-color:white;color:red\" apple=\"20\" banana=\"10\"'\r\n\t *\t\telement.getIdentity();\r\n\t *\r\n\t * NOTE: Classes, styles and other attributes are sorted alphabetically.\r\n\t *\r\n\t * @returns {String}\r\n\t */\r\n\tgetIdentity() {\r\n\t\tconst classes = Array.from( this._classes ).sort().join( ',' );\r\n\t\tconst styles = Array.from( this._styles ).map( i => `${ i[ 0 ] }:${ i[ 1 ] }` ).sort().join( ';' );\r\n\t\tconst attributes = Array.from( this._attrs ).map( i => `${ i[ 0 ] }=\"${ i[ 1 ] }\"` ).sort().join( ' ' );\r\n\r\n\t\treturn this.name +\r\n\t\t\t( classes == '' ? '' : ` class=\"${ classes }\"` ) +\r\n\t\t\t( styles == '' ? '' : ` style=\"${ styles }\"` ) +\r\n\t\t\t( attributes == '' ? '' : ` ${ attributes }` );\r\n\t}\r\n\r\n\t/**\r\n\t * Clones provided element.\r\n\t *\r\n\t * @protected\r\n\t * @param {Boolean} [deep=false] If set to `true` clones element and all its children recursively. When set to `false`,\r\n\t * element will be cloned without any children.\r\n\t * @returns {module:engine/view/element~Element} Clone of this element.\r\n\t */\r\n\t_clone( deep = false ) {\r\n\t\tconst childrenClone = [];\r\n\r\n\t\tif ( deep ) {\r\n\t\t\tfor ( const child of this.getChildren() ) {\r\n\t\t\t\tchildrenClone.push( child._clone( deep ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// ContainerElement and AttributeElement should be also cloned properly.\r\n\t\tconst cloned = new this.constructor( this.name, this._attrs, childrenClone );\r\n\r\n\t\t// Classes and styles are cloned separately - this solution is faster than adding them back to attributes and\r\n\t\t// parse once again in constructor.\r\n\t\tcloned._classes = new Set( this._classes );\r\n\t\tcloned._styles = new Map( this._styles );\r\n\r\n\t\t// Clone custom properties.\r\n\t\tcloned._customProperties = new Map( this._customProperties );\r\n\r\n\t\t// Clone filler offset method.\r\n\t\t// We can't define this method in a prototype because it's behavior which\r\n\t\t// is changed by e.g. toWidget() function from ckeditor5-widget. Perhaps this should be one of custom props.\r\n\t\tcloned.getFillerOffset = this.getFillerOffset;\r\n\r\n\t\treturn cloned;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/element~Element#_insertChild Insert} a child node or a list of child nodes at the end of this node\r\n\t * and sets the parent of these nodes to this element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#insert\r\n\t * @protected\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t * @returns {Number} Number of appended nodes.\r\n\t */\r\n\t_appendChild( items ) {\r\n\t\treturn this._insertChild( this.childCount, items );\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a child node or a list of child nodes on the given index and sets the parent of these nodes to\r\n\t * this element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#insert\r\n\t * @protected\r\n\t * @param {Number} index Position where nodes should be inserted.\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t * @returns {Number} Number of inserted nodes.\r\n\t */\r\n\t_insertChild( index, items ) {\r\n\t\tthis._fireChange( 'children', this );\r\n\t\tlet count = 0;\r\n\r\n\t\tconst nodes = normalize( items );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\t// If node that is being added to this element is already inside another element, first remove it from the old parent.\r\n\t\t\tif ( node.parent !== null ) {\r\n\t\t\t\tnode._remove();\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = this;\r\n\r\n\t\t\tthis._children.splice( index, 0, node );\r\n\t\t\tindex++;\r\n\t\t\tcount++;\r\n\t\t}\r\n\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes number of child nodes starting at the given index and set the parent of these nodes to `null`.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#remove\r\n\t * @protected\r\n\t * @param {Number} index Number of the first node to remove.\r\n\t * @param {Number} [howMany=1] Number of nodes to remove.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t * @returns {Array.<module:engine/view/node~Node>} The array of removed nodes.\r\n\t */\r\n\t_removeChildren( index, howMany = 1 ) {\r\n\t\tthis._fireChange( 'children', this );\r\n\r\n\t\tfor ( let i = index; i < index + howMany; i++ ) {\r\n\t\t\tthis._children[ i ].parent = null;\r\n\t\t}\r\n\r\n\t\treturn this._children.splice( index, howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds or overwrite attribute with a specified key and value.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setAttribute\r\n\t * @protected\r\n\t * @param {String} key Attribute key.\r\n\t * @param {String} value Attribute value.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_setAttribute( key, value ) {\r\n\t\tvalue = String( value );\r\n\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\tif ( key == 'class' ) {\r\n\t\t\tparseClasses( this._classes, value );\r\n\t\t} else if ( key == 'style' ) {\r\n\t\t\tparseInlineStyles( this._styles, value );\r\n\t\t} else {\r\n\t\t\tthis._attrs.set( key, value );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes attribute from the element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeAttribute\r\n\t * @protected\r\n\t * @param {String} key Attribute key.\r\n\t * @returns {Boolean} Returns true if an attribute existed and has been removed.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_removeAttribute( key ) {\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\t// Remove class attribute.\r\n\t\tif ( key == 'class' ) {\r\n\t\t\tif ( this._classes.size > 0 ) {\r\n\t\t\t\tthis._classes.clear();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Remove style attribute.\r\n\t\tif ( key == 'style' ) {\r\n\t\t\tif ( this._styles.size > 0 ) {\r\n\t\t\t\tthis._styles.clear();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Remove other attributes.\r\n\t\treturn this._attrs.delete( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds specified class.\r\n\t *\r\n\t *\t\telement._addClass( 'foo' ); // Adds 'foo' class.\r\n\t *\t\telement._addClass( [ 'foo', 'bar' ] ); // Adds 'foo' and 'bar' classes.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#addClass\r\n\t * @protected\r\n\t * @param {Array.<String>|String} className\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_addClass( className ) {\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\tclassName = Array.isArray( className ) ? className : [ className ];\r\n\t\tclassName.forEach( name => this._classes.add( name ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified class.\r\n\t *\r\n\t *\t\telement._removeClass( 'foo' );  // Removes 'foo' class.\r\n\t *\t\telement._removeClass( [ 'foo', 'bar' ] ); // Removes both 'foo' and 'bar' classes.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeClass\r\n\t * @protected\r\n\t * @param {Array.<String>|String} className\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_removeClass( className ) {\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\tclassName = Array.isArray( className ) ? className : [ className ];\r\n\t\tclassName.forEach( name => this._classes.delete( name ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds style to the element.\r\n\t *\r\n\t *\t\telement._setStyle( 'color', 'red' );\r\n\t *\t\telement._setStyle( {\r\n\t *\t\t\tcolor: 'red',\r\n\t *\t\t\tposition: 'fixed'\r\n\t *\t\t} );\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setStyle\r\n\t * @protected\r\n\t * @param {String|Object} property Property name or object with key - value pairs.\r\n\t * @param {String} [value] Value to set. This parameter is ignored if object is provided as the first parameter.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_setStyle( property, value ) {\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\tif ( isPlainObject( property ) ) {\r\n\t\t\tconst keys = Object.keys( property );\r\n\r\n\t\t\tfor ( const key of keys ) {\r\n\t\t\t\tthis._styles.set( key, property[ key ] );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._styles.set( property, value );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified style.\r\n\t *\r\n\t *\t\telement._removeStyle( 'color' );  // Removes 'color' style.\r\n\t *\t\telement._removeStyle( [ 'color', 'border-top' ] ); // Removes both 'color' and 'border-top' styles.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeStyle\r\n\t * @protected\r\n\t * @param {Array.<String>|String} property\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_removeStyle( property ) {\r\n\t\tthis._fireChange( 'attributes', this );\r\n\r\n\t\tproperty = Array.isArray( property ) ? property : [ property ];\r\n\t\tproperty.forEach( name => this._styles.delete( name ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a custom property. Unlike attributes, custom properties are not rendered to the DOM,\r\n\t * so they can be used to add special data to elements.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setCustomProperty\r\n\t * @protected\r\n\t * @param {String|Symbol} key\r\n\t * @param {*} value\r\n\t */\r\n\t_setCustomProperty( key, value ) {\r\n\t\tthis._customProperties.set( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the custom property stored under the given key.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeCustomProperty\r\n\t * @protected\r\n\t * @param {String|Symbol} key\r\n\t * @returns {Boolean} Returns true if property was removed.\r\n\t */\r\n\t_removeCustomProperty( key ) {\r\n\t\treturn this._customProperties.delete( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns block {@link module:engine/view/filler filler} offset or `null` if block filler is not needed.\r\n\t *\r\n\t * @abstract\r\n\t * @method module:engine/view/element~Element#getFillerOffset\r\n\t */\r\n}\r\n\r\n// Parses attributes provided to the element constructor before they are applied to an element. If attributes are passed\r\n// as an object (instead of `Map`), the object is transformed to the map. Attributes with `null` value are removed.\r\n// Attributes with non-`String` value are converted to `String`.\r\n//\r\n// @param {Object|Map} attrs Attributes to parse.\r\n// @returns {Map} Parsed attributes.\r\nfunction parseAttributes( attrs ) {\r\n\tif ( isPlainObject( attrs ) ) {\r\n\t\tattrs = objectToMap( attrs );\r\n\t} else {\r\n\t\tattrs = new Map( attrs );\r\n\t}\r\n\r\n\tfor ( const [ key, value ] of attrs ) {\r\n\t\tif ( value === null ) {\r\n\t\t\tattrs.delete( key );\r\n\t\t} else if ( typeof value != 'string' ) {\r\n\t\t\tattrs.set( key, String( value ) );\r\n\t\t}\r\n\t}\r\n\r\n\treturn attrs;\r\n}\r\n\r\n// Parses inline styles and puts property - value pairs into styles map.\r\n// Styles map is cleared before insertion.\r\n//\r\n// @param {Map.<String, String>} stylesMap Map to insert parsed properties and values.\r\n// @param {String} stylesString Styles to parse.\r\nfunction parseInlineStyles( stylesMap, stylesString ) {\r\n\t// `null` if no quote was found in input string or last found quote was a closing quote. See below.\r\n\tlet quoteType = null;\r\n\tlet propertyNameStart = 0;\r\n\tlet propertyValueStart = 0;\r\n\tlet propertyName = null;\r\n\r\n\tstylesMap.clear();\r\n\r\n\t// Do not set anything if input string is empty.\r\n\tif ( stylesString === '' ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Fix inline styles that do not end with `;` so they are compatible with algorithm below.\r\n\tif ( stylesString.charAt( stylesString.length - 1 ) != ';' ) {\r\n\t\tstylesString = stylesString + ';';\r\n\t}\r\n\r\n\t// Seek the whole string for \"special characters\".\r\n\tfor ( let i = 0; i < stylesString.length; i++ ) {\r\n\t\tconst char = stylesString.charAt( i );\r\n\r\n\t\tif ( quoteType === null ) {\r\n\t\t\t// No quote found yet or last found quote was a closing quote.\r\n\t\t\tswitch ( char ) {\r\n\t\t\t\tcase ':':\r\n\t\t\t\t\t// Most of time colon means that property name just ended.\r\n\t\t\t\t\t// Sometimes however `:` is found inside property value (for example in background image url).\r\n\t\t\t\t\tif ( !propertyName ) {\r\n\t\t\t\t\t\t// Treat this as end of property only if property name is not already saved.\r\n\t\t\t\t\t\t// Save property name.\r\n\t\t\t\t\t\tpropertyName = stylesString.substr( propertyNameStart, i - propertyNameStart );\r\n\t\t\t\t\t\t// Save this point as the start of property value.\r\n\t\t\t\t\t\tpropertyValueStart = i + 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '\"':\r\n\t\t\t\tcase '\\'':\r\n\t\t\t\t\t// Opening quote found (this is an opening quote, because `quoteType` is `null`).\r\n\t\t\t\t\tquoteType = char;\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase ';': {\r\n\t\t\t\t\t// Property value just ended.\r\n\t\t\t\t\t// Use previously stored property value start to obtain property value.\r\n\t\t\t\t\tconst propertyValue = stylesString.substr( propertyValueStart, i - propertyValueStart );\r\n\r\n\t\t\t\t\tif ( propertyName ) {\r\n\t\t\t\t\t\t// Save parsed part.\r\n\t\t\t\t\t\tstylesMap.set( propertyName.trim(), propertyValue.trim() );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpropertyName = null;\r\n\r\n\t\t\t\t\t// Save this point as property name start. Property name starts immediately after previous property value ends.\r\n\t\t\t\t\tpropertyNameStart = i + 1;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ( char === quoteType ) {\r\n\t\t\t// If a quote char is found and it is a closing quote, mark this fact by `null`-ing `quoteType`.\r\n\t\t\tquoteType = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Parses class attribute and puts all classes into classes set.\r\n// Classes set s cleared before insertion.\r\n//\r\n// @param {Set.<String>} classesSet Set to insert parsed classes.\r\n// @param {String} classesString String with classes to parse.\r\nfunction parseClasses( classesSet, classesString ) {\r\n\tconst classArray = classesString.split( /\\s+/ );\r\n\tclassesSet.clear();\r\n\tclassArray.forEach( name => classesSet.add( name ) );\r\n}\r\n\r\n// Converts strings to Text and non-iterables to arrays.\r\n//\r\n// @param {String|module:engine/view/item~Item|Iterable.<String|module:engine/view/item~Item>}\r\n// @returns {Iterable.<module:engine/view/node~Node>}\r\nfunction normalize( nodes ) {\r\n\t// Separate condition because string is iterable.\r\n\tif ( typeof nodes == 'string' ) {\r\n\t\treturn [ new Text( nodes ) ];\r\n\t}\r\n\r\n\tif ( !isIterable( nodes ) ) {\r\n\t\tnodes = [ nodes ];\r\n\t}\r\n\r\n\t// Array.from to enable .map() on non-arrays.\r\n\treturn Array.from( nodes )\r\n\t\t.map( node => {\r\n\t\t\tif ( typeof node == 'string' ) {\r\n\t\t\t\treturn new Text( node );\r\n\t\t\t}\r\n\r\n\t\t\tif ( node instanceof TextProxy ) {\r\n\t\t\t\treturn new Text( node.data );\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/containerelement\r\n */\r\n\r\nimport Element from './element';\r\n\r\n/**\r\n * Containers are elements which define document structure. They define boundaries for\r\n * {@link module:engine/view/attributeelement~AttributeElement attributes}. They are mostly used for block elements like `<p>` or `<div>`.\r\n *\r\n * Editing engine does not define a fixed HTML DTD. This is why a feature developer needs to choose between various\r\n * types (container element, {@link module:engine/view/attributeelement~AttributeElement attribute element},\r\n * {@link module:engine/view/emptyelement~EmptyElement empty element}, etc) when developing a feature.\r\n *\r\n * The container element should be your default choice when writing a converter, unless:\r\n *\r\n * * this element represents a model text attribute (then use {@link module:engine/view/attributeelement~AttributeElement}),\r\n * * this is an empty element like `<img>` (then use {@link module:engine/view/emptyelement~EmptyElement}),\r\n * * this is a root element,\r\n * * this is a nested editable element (then use  {@link module:engine/view/editableelement~EditableElement}).\r\n *\r\n * To create a new container element instance use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createContainerElement `DowncastWriter#createContainerElement()`}\r\n * method.\r\n *\r\n * @extends module:engine/view/element~Element\r\n */\r\nexport default class ContainerElement extends Element {\r\n\t/**\r\n\t * Creates a container element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#createContainerElement\r\n\t * @see module:engine/view/element~Element\r\n\t * @protected\r\n\t */\r\n\tconstructor( name, attrs, children ) {\r\n\t\tsuper( name, attrs, children );\r\n\r\n\t\t/**\r\n\t\t * Returns block {@link module:engine/view/filler filler} offset or `null` if block filler is not needed.\r\n\t\t *\r\n\t\t * @method #getFillerOffset\r\n\t\t * @returns {Number|null} Block filler offset or `null` if block filler is not needed.\r\n\t\t */\r\n\t\tthis.getFillerOffset = getFillerOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'containerElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'containerElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns block {@link module:engine/view/filler filler} offset or `null` if block filler is not needed.\r\n *\r\n * @returns {Number|null} Block filler offset or `null` if block filler is not needed.\r\n */\r\nexport function getFillerOffset() {\r\n\tconst children = [ ...this.getChildren() ];\r\n\tconst lastChild = children[ this.childCount - 1 ];\r\n\r\n\t// Block filler is required after a `<br>` if it's the last element in its container. See #1422.\r\n\tif ( lastChild && lastChild.is( 'element', 'br' ) ) {\r\n\t\treturn this.childCount;\r\n\t}\r\n\r\n\tfor ( const child of children ) {\r\n\t\t// If there's any non-UI element – don't render the bogus.\r\n\t\tif ( !child.is( 'uiElement' ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t// If there are only UI elements – render the bogus at the end of the element.\r\n\treturn this.childCount;\r\n}\r\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nexport default identity;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nexport default apply;\n","import apply from './_apply.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nexport default overRest;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nexport default constant;\n","import constant from './constant.js';\nimport defineProperty from './_defineProperty.js';\nimport identity from './identity.js';\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nexport default baseSetToString;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nexport default shortOut;\n","import baseSetToString from './_baseSetToString.js';\nimport shortOut from './_shortOut.js';\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nexport default setToString;\n","import identity from './identity.js';\nimport overRest from './_overRest.js';\nimport setToString from './_setToString.js';\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nexport default baseRest;\n","import eq from './eq.js';\nimport isArrayLike from './isArrayLike.js';\nimport isIndex from './_isIndex.js';\nimport isObject from './isObject.js';\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nexport default isIterateeCall;\n","import baseRest from './_baseRest.js';\nimport isIterateeCall from './_isIterateeCall.js';\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nexport default createAssigner;\n","import copyObject from './_copyObject.js';\nimport createAssigner from './_createAssigner.js';\nimport keysIn from './keysIn.js';\n\n/**\n * This method is like `_.assign` except that it iterates over own and\n * inherited source properties.\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @alias extend\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assign\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assignIn({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'b': 2, 'c': 3, 'd': 4 }\n */\nvar assignIn = createAssigner(function(object, source) {\n  copyObject(source, keysIn(source), object);\n});\n\nexport default assignIn;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/observablemixin\r\n */\r\n\r\nimport EmitterMixin from './emittermixin';\r\nimport CKEditorError from './ckeditorerror';\r\nimport { extend, isObject } from 'lodash-es';\r\n\r\nconst observablePropertiesSymbol = Symbol( 'observableProperties' );\r\nconst boundObservablesSymbol = Symbol( 'boundObservables' );\r\nconst boundPropertiesSymbol = Symbol( 'boundProperties' );\r\n\r\n/**\r\n * Mixin that injects the \"observable properties\" and data binding functionality described in the\r\n * {@link ~Observable} interface.\r\n *\r\n * Read more about the concept of observables in the:\r\n * * {@glink framework/guides/architecture/core-editor-architecture#event-system-and-observables \"Event system and observables\"}\r\n * section of the {@glink framework/guides/architecture/core-editor-architecture \"Core editor architecture\"} guide,\r\n * * {@glink framework/guides/deep-dive/observables \"Observables\" deep dive} guide.\r\n *\r\n * @mixin ObservableMixin\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n * @implements module:utils/observablemixin~Observable\r\n */\r\nconst ObservableMixin = {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tset( name, value ) {\r\n\t\t// If the first parameter is an Object, iterate over its properties.\r\n\t\tif ( isObject( name ) ) {\r\n\t\t\tObject.keys( name ).forEach( property => {\r\n\t\t\t\tthis.set( property, name[ property ] );\r\n\t\t\t}, this );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinitObservable( this );\r\n\r\n\t\tconst properties = this[ observablePropertiesSymbol ];\r\n\r\n\t\tif ( ( name in this ) && !properties.has( name ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot override an existing property.\r\n\t\t\t *\r\n\t\t\t * This error is thrown when trying to {@link ~Observable#set set} an property with\r\n\t\t\t * a name of an already existing property. For example:\r\n\t\t\t *\r\n\t\t\t *\t\tlet observable = new Model();\r\n\t\t\t *\t\tobservable.property = 1;\r\n\t\t\t *\t\tobservable.set( 'property', 2 );\t\t\t// throws\r\n\t\t\t *\r\n\t\t\t *\t\tobservable.set( 'property', 1 );\r\n\t\t\t *\t\tobservable.set( 'property', 2 );\t\t\t// ok, because this is an existing property.\r\n\t\t\t *\r\n\t\t\t * @error observable-set-cannot-override\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'observable-set-cannot-override: Cannot override an existing property.' );\r\n\t\t}\r\n\r\n\t\tObject.defineProperty( this, name, {\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true,\r\n\r\n\t\t\tget() {\r\n\t\t\t\treturn properties.get( name );\r\n\t\t\t},\r\n\r\n\t\t\tset( value ) {\r\n\t\t\t\tconst oldValue = properties.get( name );\r\n\r\n\t\t\t\t// Fire `set` event before the new value will be set to make it possible\r\n\t\t\t\t// to override observable property without affecting `change` event.\r\n\t\t\t\t// See https://github.com/ckeditor/ckeditor5-utils/issues/171.\r\n\t\t\t\tlet newValue = this.fire( 'set:' + name, name, value, oldValue );\r\n\r\n\t\t\t\tif ( newValue === undefined ) {\r\n\t\t\t\t\tnewValue = value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Allow undefined as an initial value like A.define( 'x', undefined ) (#132).\r\n\t\t\t\t// Note: When properties map has no such own property, then its value is undefined.\r\n\t\t\t\tif ( oldValue !== newValue || !properties.has( name ) ) {\r\n\t\t\t\t\tproperties.set( name, newValue );\r\n\t\t\t\t\tthis.fire( 'change:' + name, name, newValue, oldValue );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis[ name ] = value;\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tbind( ...bindProperties ) {\r\n\t\tif ( !bindProperties.length || !isStringArray( bindProperties ) ) {\r\n\t\t\t/**\r\n\t\t\t * All properties must be strings.\r\n\t\t\t *\r\n\t\t\t * @error observable-bind-wrong-properties\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'observable-bind-wrong-properties: All properties must be strings.' );\r\n\t\t}\r\n\r\n\t\tif ( ( new Set( bindProperties ) ).size !== bindProperties.length ) {\r\n\t\t\t/**\r\n\t\t\t * Properties must be unique.\r\n\t\t\t *\r\n\t\t\t * @error observable-bind-duplicate-properties\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'observable-bind-duplicate-properties: Properties must be unique.' );\r\n\t\t}\r\n\r\n\t\tinitObservable( this );\r\n\r\n\t\tconst boundProperties = this[ boundPropertiesSymbol ];\r\n\r\n\t\tbindProperties.forEach( propertyName => {\r\n\t\t\tif ( boundProperties.has( propertyName ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Cannot bind the same property more that once.\r\n\t\t\t\t *\r\n\t\t\t\t * @error observable-bind-rebind\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'observable-bind-rebind: Cannot bind the same property more that once.' );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tconst bindings = new Map();\r\n\r\n\t\t// @typedef {Object} Binding\r\n\t\t// @property {Array} property Property which is bound.\r\n\t\t// @property {Array} to Array of observable–property components of the binding (`{ observable: ..., property: .. }`).\r\n\t\t// @property {Array} callback A function which processes `to` components.\r\n\t\tbindProperties.forEach( a => {\r\n\t\t\tconst binding = { property: a, to: [] };\r\n\r\n\t\t\tboundProperties.set( a, binding );\r\n\t\t\tbindings.set( a, binding );\r\n\t\t} );\r\n\r\n\t\t// @typedef {Object} BindChain\r\n\t\t// @property {Function} to See {@link ~ObservableMixin#_bindTo}.\r\n\t\t// @property {Function} toMany See {@link ~ObservableMixin#_bindToMany}.\r\n\t\t// @property {module:utils/observablemixin~Observable} _observable The observable which initializes the binding.\r\n\t\t// @property {Array} _bindProperties Array of `_observable` properties to be bound.\r\n\t\t// @property {Array} _to Array of `to()` observable–properties (`{ observable: toObservable, properties: ...toProperties }`).\r\n\t\t// @property {Map} _bindings Stores bindings to be kept in\r\n\t\t// {@link ~ObservableMixin#_boundProperties}/{@link ~ObservableMixin#_boundObservables}\r\n\t\t// initiated in this binding chain.\r\n\t\treturn {\r\n\t\t\tto: bindTo,\r\n\t\t\ttoMany: bindToMany,\r\n\r\n\t\t\t_observable: this,\r\n\t\t\t_bindProperties: bindProperties,\r\n\t\t\t_to: [],\r\n\t\t\t_bindings: bindings\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tunbind( ...unbindProperties ) {\r\n\t\t// Nothing to do here if not inited yet.\r\n\t\tif ( !( observablePropertiesSymbol in this ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst boundProperties = this[ boundPropertiesSymbol ];\r\n\t\tconst boundObservables = this[ boundObservablesSymbol ];\r\n\r\n\t\tif ( unbindProperties.length ) {\r\n\t\t\tif ( !isStringArray( unbindProperties ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Properties must be strings.\r\n\t\t\t\t *\r\n\t\t\t\t * @error observable-unbind-wrong-properties\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'observable-unbind-wrong-properties: Properties must be strings.' );\r\n\t\t\t}\r\n\r\n\t\t\tunbindProperties.forEach( propertyName => {\r\n\t\t\t\tconst binding = boundProperties.get( propertyName );\r\n\r\n\t\t\t\t// Nothing to do if the binding is not defined\r\n\t\t\t\tif ( !binding ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet toObservable, toProperty, toProperties, toPropertyBindings;\r\n\r\n\t\t\t\tbinding.to.forEach( to => {\r\n\t\t\t\t\t// TODO: ES6 destructuring.\r\n\t\t\t\t\ttoObservable = to[ 0 ];\r\n\t\t\t\t\ttoProperty = to[ 1 ];\r\n\t\t\t\t\ttoProperties = boundObservables.get( toObservable );\r\n\t\t\t\t\ttoPropertyBindings = toProperties[ toProperty ];\r\n\r\n\t\t\t\t\ttoPropertyBindings.delete( binding );\r\n\r\n\t\t\t\t\tif ( !toPropertyBindings.size ) {\r\n\t\t\t\t\t\tdelete toProperties[ toProperty ];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( !Object.keys( toProperties ).length ) {\r\n\t\t\t\t\t\tboundObservables.delete( toObservable );\r\n\t\t\t\t\t\tthis.stopListening( toObservable, 'change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tboundProperties.delete( propertyName );\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tboundObservables.forEach( ( bindings, boundObservable ) => {\r\n\t\t\t\tthis.stopListening( boundObservable, 'change' );\r\n\t\t\t} );\r\n\r\n\t\t\tboundObservables.clear();\r\n\t\t\tboundProperties.clear();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdecorate( methodName ) {\r\n\t\tconst originalMethod = this[ methodName ];\r\n\r\n\t\tif ( !originalMethod ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot decorate an undefined method.\r\n\t\t\t *\r\n\t\t\t * @error observablemixin-cannot-decorate-undefined\r\n\t\t\t * @param {Object} object The object which method should be decorated.\r\n\t\t\t * @param {String} methodName Name of the method which does not exist.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'observablemixin-cannot-decorate-undefined: Cannot decorate an undefined method.',\r\n\t\t\t\t{ object: this, methodName }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.on( methodName, ( evt, args ) => {\r\n\t\t\tevt.return = originalMethod.apply( this, args );\r\n\t\t} );\r\n\r\n\t\tthis[ methodName ] = function( ...args ) {\r\n\t\t\treturn this.fire( methodName, args );\r\n\t\t};\r\n\t}\r\n};\r\n\r\nextend( ObservableMixin, EmitterMixin );\r\n\r\nexport default ObservableMixin;\r\n\r\n// Init symbol properties needed to for the observable mechanism to work.\r\n//\r\n// @private\r\n// @param {module:utils/observablemixin~ObservableMixin} observable\r\nfunction initObservable( observable ) {\r\n\t// Do nothing if already inited.\r\n\tif ( observablePropertiesSymbol in observable ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// The internal hash containing the observable's state.\r\n\t//\r\n\t// @private\r\n\t// @type {Map}\r\n\tObject.defineProperty( observable, observablePropertiesSymbol, {\r\n\t\tvalue: new Map()\r\n\t} );\r\n\r\n\t// Map containing bindings to external observables. It shares the binding objects\r\n\t// (`{ observable: A, property: 'a', to: ... }`) with {@link module:utils/observablemixin~ObservableMixin#_boundProperties} and\r\n\t// it is used to observe external observables to update own properties accordingly.\r\n\t// See {@link module:utils/observablemixin~ObservableMixin#bind}.\r\n\t//\r\n\t//\t\tA.bind( 'a', 'b', 'c' ).to( B, 'x', 'y', 'x' );\r\n\t//\t\tconsole.log( A._boundObservables );\r\n\t//\r\n\t//\t\t\tMap( {\r\n\t//\t\t\t\tB: {\r\n\t//\t\t\t\t\tx: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] },\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'c', to: [ [ B, 'x' ] ] }\r\n\t//\t\t\t\t\t] ),\r\n\t//\t\t\t\t\ty: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\r\n\t//\t\t\t\t\t] )\r\n\t//\t\t\t\t}\r\n\t//\t\t\t} )\r\n\t//\r\n\t//\t\tA.bind( 'd' ).to( B, 'z' ).to( C, 'w' ).as( callback );\r\n\t//\t\tconsole.log( A._boundObservables );\r\n\t//\r\n\t//\t\t\tMap( {\r\n\t//\t\t\t\tB: {\r\n\t//\t\t\t\t\tx: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] },\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'c', to: [ [ B, 'x' ] ] }\r\n\t//\t\t\t\t\t] ),\r\n\t//\t\t\t\t\ty: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\r\n\t//\t\t\t\t\t] ),\r\n\t//\t\t\t\t\tz: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\r\n\t//\t\t\t\t\t] )\r\n\t//\t\t\t\t},\r\n\t//\t\t\t\tC: {\r\n\t//\t\t\t\t\tw: Set( [\r\n\t//\t\t\t\t\t\t{ observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\r\n\t//\t\t\t\t\t] )\r\n\t//\t\t\t\t}\r\n\t//\t\t\t} )\r\n\t//\r\n\t// @private\r\n\t// @type {Map}\r\n\tObject.defineProperty( observable, boundObservablesSymbol, {\r\n\t\tvalue: new Map()\r\n\t} );\r\n\r\n\t// Object that stores which properties of this observable are bound and how. It shares\r\n\t// the binding objects (`{ observable: A, property: 'a', to: ... }`) with {@link utils.ObservableMixin#_boundObservables}.\r\n\t// This data structure is a reverse of {@link utils.ObservableMixin#_boundObservables} and it is helpful for\r\n\t// {@link utils.ObservableMixin#unbind}.\r\n\t//\r\n\t// See {@link utils.ObservableMixin#bind}.\r\n\t//\r\n\t//\t\tA.bind( 'a', 'b', 'c' ).to( B, 'x', 'y', 'x' );\r\n\t//\t\tconsole.log( A._boundProperties );\r\n\t//\r\n\t//\t\t\tMap( {\r\n\t//\t\t\t\ta: { observable: A, property: 'a', to: [ [ B, 'x' ] ] },\r\n\t//\t\t\t\tb: { observable: A, property: 'b', to: [ [ B, 'y' ] ] },\r\n\t//\t\t\t\tc: { observable: A, property: 'c', to: [ [ B, 'x' ] ] }\r\n\t//\t\t\t} )\r\n\t//\r\n\t//\t\tA.bind( 'd' ).to( B, 'z' ).to( C, 'w' ).as( callback );\r\n\t//\t\tconsole.log( A._boundProperties );\r\n\t//\r\n\t//\t\t\tMap( {\r\n\t//\t\t\t\ta: { observable: A, property: 'a', to: [ [ B, 'x' ] ] },\r\n\t//\t\t\t\tb: { observable: A, property: 'b', to: [ [ B, 'y' ] ] },\r\n\t//\t\t\t\tc: { observable: A, property: 'c', to: [ [ B, 'x' ] ] },\r\n\t//\t\t\t\td: { observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\r\n\t//\t\t\t} )\r\n\t//\r\n\t// @private\r\n\t// @type {Map}\r\n\tObject.defineProperty( observable, boundPropertiesSymbol, {\r\n\t\tvalue: new Map()\r\n\t} );\r\n}\r\n\r\n// A chaining for {@link module:utils/observablemixin~ObservableMixin#bind} providing `.to()` interface.\r\n//\r\n// @private\r\n// @param {...[Observable|String|Function]} args Arguments of the `.to( args )` binding.\r\nfunction bindTo( ...args ) {\r\n\tconst parsedArgs = parseBindToArgs( ...args );\r\n\tconst bindingsKeys = Array.from( this._bindings.keys() );\r\n\tconst numberOfBindings = bindingsKeys.length;\r\n\r\n\t// Eliminate A.bind( 'x' ).to( B, C )\r\n\tif ( !parsedArgs.callback && parsedArgs.to.length > 1 ) {\r\n\t\t/**\r\n\t\t * Binding multiple observables only possible with callback.\r\n\t\t *\r\n\t\t * @error observable-bind-no-callback\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'observable-bind-to-no-callback: Binding multiple observables only possible with callback.' );\r\n\t}\r\n\r\n\t// Eliminate A.bind( 'x', 'y' ).to( B, callback )\r\n\tif ( numberOfBindings > 1 && parsedArgs.callback ) {\r\n\t\t/**\r\n\t\t * Cannot bind multiple properties and use a callback in one binding.\r\n\t\t *\r\n\t\t * @error observable-bind-to-extra-callback\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'observable-bind-to-extra-callback: Cannot bind multiple properties and use a callback in one binding.' );\r\n\t}\r\n\r\n\tparsedArgs.to.forEach( to => {\r\n\t\t// Eliminate A.bind( 'x', 'y' ).to( B, 'a' )\r\n\t\tif ( to.properties.length && to.properties.length !== numberOfBindings ) {\r\n\t\t\t/**\r\n\t\t\t * The number of properties must match.\r\n\t\t\t *\r\n\t\t\t * @error observable-bind-to-properties-length\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'observable-bind-to-properties-length: The number of properties must match.' );\r\n\t\t}\r\n\r\n\t\t// When no to.properties specified, observing source properties instead i.e.\r\n\t\t// A.bind( 'x', 'y' ).to( B ) -> Observe B.x and B.y\r\n\t\tif ( !to.properties.length ) {\r\n\t\t\tto.properties = this._bindProperties;\r\n\t\t}\r\n\t} );\r\n\r\n\tthis._to = parsedArgs.to;\r\n\r\n\t// Fill {@link BindChain#_bindings} with callback. When the callback is set there's only one binding.\r\n\tif ( parsedArgs.callback ) {\r\n\t\tthis._bindings.get( bindingsKeys[ 0 ] ).callback = parsedArgs.callback;\r\n\t}\r\n\r\n\tattachBindToListeners( this._observable, this._to );\r\n\r\n\t// Update observable._boundProperties and observable._boundObservables.\r\n\tupdateBindToBound( this );\r\n\r\n\t// Set initial values of bound properties.\r\n\tthis._bindProperties.forEach( propertyName => {\r\n\t\tupdateBoundObservableProperty( this._observable, propertyName );\r\n\t} );\r\n}\r\n\r\n// Binds to an attribute in a set of iterable observables.\r\n//\r\n// @private\r\n// @param {Array.<Observable>} observables\r\n// @param {String} attribute\r\n// @param {Function} callback\r\nfunction bindToMany( observables, attribute, callback ) {\r\n\tif ( this._bindings.size > 1 ) {\r\n\t\t/**\r\n\t\t * Binding one attribute to many observables only possible with one attribute.\r\n\t\t *\r\n\t\t * @error observable-bind-to-many-not-one-binding\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'observable-bind-to-many-not-one-binding: Cannot bind multiple properties with toMany().' );\r\n\t}\r\n\r\n\tthis.to(\r\n\t\t// Bind to #attribute of each observable...\r\n\t\t...getBindingTargets( observables, attribute ),\r\n\t\t// ...using given callback to parse attribute values.\r\n\t\tcallback\r\n\t);\r\n}\r\n\r\n// Returns an array of binding components for\r\n// {@link Observable#bind} from a set of iterable observables.\r\n//\r\n// @param {Array.<Observable>} observables\r\n// @param {String} attribute\r\n// @returns {Array.<String|Observable>}\r\nfunction getBindingTargets( observables, attribute ) {\r\n\tconst observableAndAttributePairs = observables.map( observable => [ observable, attribute ] );\r\n\r\n\t// Merge pairs to one-dimension array of observables and attributes.\r\n\treturn Array.prototype.concat.apply( [], observableAndAttributePairs );\r\n}\r\n\r\n// Check if all entries of the array are of `String` type.\r\n//\r\n// @private\r\n// @param {Array} arr An array to be checked.\r\n// @returns {Boolean}\r\nfunction isStringArray( arr ) {\r\n\treturn arr.every( a => typeof a == 'string' );\r\n}\r\n\r\n// Parses and validates {@link Observable#bind}`.to( args )` arguments and returns\r\n// an object with a parsed structure. For example\r\n//\r\n//\t\tA.bind( 'x' ).to( B, 'a', C, 'b', call );\r\n//\r\n// becomes\r\n//\r\n//\t\t{\r\n//\t\t\tto: [\r\n//\t\t\t\t{ observable: B, properties: [ 'a' ] },\r\n//\t\t\t\t{ observable: C, properties: [ 'b' ] },\r\n//\t\t\t],\r\n//\t\t\tcallback: call\r\n// \t\t}\r\n//\r\n// @private\r\n// @param {...*} args Arguments of {@link Observable#bind}`.to( args )`.\r\n// @returns {Object}\r\nfunction parseBindToArgs( ...args ) {\r\n\t// Eliminate A.bind( 'x' ).to()\r\n\tif ( !args.length ) {\r\n\t\t/**\r\n\t\t * Invalid argument syntax in `to()`.\r\n\t\t *\r\n\t\t * @error observable-bind-to-parse-error\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'observable-bind-to-parse-error: Invalid argument syntax in `to()`.' );\r\n\t}\r\n\r\n\tconst parsed = { to: [] };\r\n\tlet lastObservable;\r\n\r\n\tif ( typeof args[ args.length - 1 ] == 'function' ) {\r\n\t\tparsed.callback = args.pop();\r\n\t}\r\n\r\n\targs.forEach( a => {\r\n\t\tif ( typeof a == 'string' ) {\r\n\t\t\tlastObservable.properties.push( a );\r\n\t\t} else if ( typeof a == 'object' ) {\r\n\t\t\tlastObservable = { observable: a, properties: [] };\r\n\t\t\tparsed.to.push( lastObservable );\r\n\t\t} else {\r\n\t\t\tthrow new CKEditorError( 'observable-bind-to-parse-error: Invalid argument syntax in `to()`.' );\r\n\t\t}\r\n\t} );\r\n\r\n\treturn parsed;\r\n}\r\n\r\n// Synchronizes {@link module:utils/observablemixin#_boundObservables} with {@link Binding}.\r\n//\r\n// @private\r\n// @param {Binding} binding A binding to store in {@link Observable#_boundObservables}.\r\n// @param {Observable} toObservable A observable, which is a new component of `binding`.\r\n// @param {String} toPropertyName A name of `toObservable`'s property, a new component of the `binding`.\r\nfunction updateBoundObservables( observable, binding, toObservable, toPropertyName ) {\r\n\tconst boundObservables = observable[ boundObservablesSymbol ];\r\n\tconst bindingsToObservable = boundObservables.get( toObservable );\r\n\tconst bindings = bindingsToObservable || {};\r\n\r\n\tif ( !bindings[ toPropertyName ] ) {\r\n\t\tbindings[ toPropertyName ] = new Set();\r\n\t}\r\n\r\n\t// Pass the binding to a corresponding Set in `observable._boundObservables`.\r\n\tbindings[ toPropertyName ].add( binding );\r\n\r\n\tif ( !bindingsToObservable ) {\r\n\t\tboundObservables.set( toObservable, bindings );\r\n\t}\r\n}\r\n\r\n// Synchronizes {@link Observable#_boundProperties} and {@link Observable#_boundObservables}\r\n// with {@link BindChain}.\r\n//\r\n// Assuming the following binding being created\r\n//\r\n// \t\tA.bind( 'a', 'b' ).to( B, 'x', 'y' );\r\n//\r\n// the following bindings were initialized by {@link Observable#bind} in {@link BindChain#_bindings}:\r\n//\r\n// \t\t{\r\n// \t\t\ta: { observable: A, property: 'a', to: [] },\r\n// \t\t\tb: { observable: A, property: 'b', to: [] },\r\n// \t\t}\r\n//\r\n// Iterate over all bindings in this chain and fill their `to` properties with\r\n// corresponding to( ... ) arguments (components of the binding), so\r\n//\r\n// \t\t{\r\n// \t\t\ta: { observable: A, property: 'a', to: [ B, 'x' ] },\r\n// \t\t\tb: { observable: A, property: 'b', to: [ B, 'y' ] },\r\n// \t\t}\r\n//\r\n// Then update the structure of {@link Observable#_boundObservables} with updated\r\n// binding, so it becomes:\r\n//\r\n// \t\tMap( {\r\n// \t\t\tB: {\r\n// \t\t\t\tx: Set( [\r\n// \t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] }\r\n// \t\t\t\t] ),\r\n// \t\t\t\ty: Set( [\r\n// \t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\r\n// \t\t\t\t] )\r\n//\t\t\t}\r\n// \t\t} )\r\n//\r\n// @private\r\n// @param {BindChain} chain The binding initialized by {@link Observable#bind}.\r\nfunction updateBindToBound( chain ) {\r\n\tlet toProperty;\r\n\r\n\tchain._bindings.forEach( ( binding, propertyName ) => {\r\n\t\t// Note: For a binding without a callback, this will run only once\r\n\t\t// like in A.bind( 'x', 'y' ).to( B, 'a', 'b' )\r\n\t\t// TODO: ES6 destructuring.\r\n\t\tchain._to.forEach( to => {\r\n\t\t\ttoProperty = to.properties[ binding.callback ? 0 : chain._bindProperties.indexOf( propertyName ) ];\r\n\r\n\t\t\tbinding.to.push( [ to.observable, toProperty ] );\r\n\t\t\tupdateBoundObservables( chain._observable, binding, to.observable, toProperty );\r\n\t\t} );\r\n\t} );\r\n}\r\n\r\n// Updates an property of a {@link Observable} with a value\r\n// determined by an entry in {@link Observable#_boundProperties}.\r\n//\r\n// @private\r\n// @param {Observable} observable A observable which property is to be updated.\r\n// @param {String} propertyName An property to be updated.\r\nfunction updateBoundObservableProperty( observable, propertyName ) {\r\n\tconst boundProperties = observable[ boundPropertiesSymbol ];\r\n\tconst binding = boundProperties.get( propertyName );\r\n\tlet propertyValue;\r\n\r\n\t// When a binding with callback is created like\r\n\t//\r\n\t// \t\tA.bind( 'a' ).to( B, 'b', C, 'c', callback );\r\n\t//\r\n\t// collect B.b and C.c, then pass them to callback to set A.a.\r\n\tif ( binding.callback ) {\r\n\t\tpropertyValue = binding.callback.apply( observable, binding.to.map( to => to[ 0 ][ to[ 1 ] ] ) );\r\n\t} else {\r\n\t\tpropertyValue = binding.to[ 0 ];\r\n\t\tpropertyValue = propertyValue[ 0 ][ propertyValue[ 1 ] ];\r\n\t}\r\n\r\n\tif ( observable.hasOwnProperty( propertyName ) ) {\r\n\t\tobservable[ propertyName ] = propertyValue;\r\n\t} else {\r\n\t\tobservable.set( propertyName, propertyValue );\r\n\t}\r\n}\r\n\r\n// Starts listening to changes in {@link BindChain._to} observables to update\r\n// {@link BindChain._observable} {@link BindChain._bindProperties}. Also sets the\r\n// initial state of {@link BindChain._observable}.\r\n//\r\n// @private\r\n// @param {BindChain} chain The chain initialized by {@link Observable#bind}.\r\nfunction attachBindToListeners( observable, toBindings ) {\r\n\ttoBindings.forEach( to => {\r\n\t\tconst boundObservables = observable[ boundObservablesSymbol ];\r\n\t\tlet bindings;\r\n\r\n\t\t// If there's already a chain between the observables (`observable` listens to\r\n\t\t// `to.observable`), there's no need to create another `change` event listener.\r\n\t\tif ( !boundObservables.get( to.observable ) ) {\r\n\t\t\tobservable.listenTo( to.observable, 'change', ( evt, propertyName ) => {\r\n\t\t\t\tbindings = boundObservables.get( to.observable )[ propertyName ];\r\n\r\n\t\t\t\t// Note: to.observable will fire for any property change, react\r\n\t\t\t\t// to changes of properties which are bound only.\r\n\t\t\t\tif ( bindings ) {\r\n\t\t\t\t\tbindings.forEach( binding => {\r\n\t\t\t\t\t\tupdateBoundObservableProperty( observable, binding.property );\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Interface which adds \"observable properties\" and data binding functionality.\r\n *\r\n * Can be easily implemented by a class by mixing the {@link module:utils/observablemixin~ObservableMixin} mixin.\r\n *\r\n * Read more about the usage of this interface in the:\r\n * * {@glink framework/guides/architecture/core-editor-architecture#event-system-and-observables \"Event system and observables\"}\r\n * section of the {@glink framework/guides/architecture/core-editor-architecture \"Core editor architecture\"} guide,\r\n * * {@glink framework/guides/deep-dive/observables \"Observables\" deep dive} guide.\r\n *\r\n * @interface Observable\r\n * @extends module:utils/emittermixin~Emitter\r\n */\r\n\r\n/**\r\n * Fired when a property changed value.\r\n *\r\n *\t\tobservable.set( 'prop', 1 );\r\n *\r\n *\t\tobservable.on( 'change:prop', ( evt, propertyName, newValue, oldValue ) => {\r\n *\t\t\tconsole.log( `${ propertyName } has changed from ${ oldValue } to ${ newValue }` );\r\n *\t\t} );\r\n *\r\n *\t\tobservable.prop = 2; // -> 'prop has changed from 1 to 2'\r\n *\r\n * @event change:{property}\r\n * @param {String} name The property name.\r\n * @param {*} value The new property value.\r\n * @param {*} oldValue The previous property value.\r\n */\r\n\r\n/**\r\n * Fired when a property value is going to be set but is not set yet (before the `change` event is fired).\r\n *\r\n * You can control the final value of the property by using\r\n * the {@link module:utils/eventinfo~EventInfo#return event's `return` property}.\r\n *\r\n *\t\tobservable.set( 'prop', 1 );\r\n *\r\n *\t\tobservable.on( 'set:prop', ( evt, propertyName, newValue, oldValue ) => {\r\n *\t\t\tconsole.log( `Value is going to be changed from ${ oldValue } to ${ newValue }` );\r\n *\t\t\tconsole.log( `Current property value is ${ observable[ propertyName ] }` );\r\n *\r\n *\t\t\t// Let's override the value.\r\n *\t\t\tevt.return = 3;\r\n *\t\t} );\r\n *\r\n *\t\tobservable.on( 'change:prop', ( evt, propertyName, newValue, oldValue ) => {\r\n *\t\t\tconsole.log( `Value has changed from ${ oldValue } to ${ newValue }` );\r\n *\t\t} );\r\n *\r\n *\t\tobservable.prop = 2; // -> 'Value is going to be changed from 1 to 2'\r\n *\t\t                     // -> 'Current property value is 1'\r\n *\t\t                     // -> 'Value has changed from 1 to 3'\r\n *\r\n * **Note:** Event is fired even when the new value is the same as the old value.\r\n *\r\n * @event set:{property}\r\n * @param {String} name The property name.\r\n * @param {*} value The new property value.\r\n * @param {*} oldValue The previous property value.\r\n */\r\n\r\n/**\r\n * Creates and sets the value of an observable property of this object. Such an property becomes a part\r\n * of the state and is be observable.\r\n *\r\n * It accepts also a single object literal containing key/value pairs with properties to be set.\r\n *\r\n * This method throws the `observable-set-cannot-override` error if the observable instance already\r\n * have a property with the given property name. This prevents from mistakenly overriding existing\r\n * properties and methods, but means that `foo.set( 'bar', 1 )` may be slightly slower than `foo.bar = 1`.\r\n *\r\n * @method #set\r\n * @param {String|Object} name The property's name or object with `name=>value` pairs.\r\n * @param {*} [value] The property's value (if `name` was passed in the first parameter).\r\n */\r\n\r\n/**\r\n * Binds {@link #set obvervable properties} to other objects implementing the\r\n * {@link module:utils/observablemixin~Observable} interface.\r\n *\r\n * Read more in the {@glink framework/guides/deep-dive/observables#property-bindings dedicated guide}\r\n * covering the topic of property bindings with some additional examples.\r\n *\r\n * Let's consider two objects: a `button` and an associated `command` (both `Observable`).\r\n *\r\n * A simple property binding could be as follows:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isEnabled' );\r\n *\r\n * or even shorter:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).to( command );\r\n *\r\n * which works in the following way:\r\n *\r\n * * `button.isEnabled` **instantly equals** `command.isEnabled`,\r\n * * whenever `command.isEnabled` changes, `button.isEnabled` will immediately reflect its value.\r\n *\r\n * **Note**: To release the binding use {@link module:utils/observablemixin~Observable#unbind}.\r\n *\r\n * You can also \"rename\" the property in the binding by specifying the new name in the `to()` chain:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isWorking' );\r\n *\r\n * It is possible to bind more than one property at a time to shorten the code:\r\n *\r\n *\t\tbutton.bind( 'isEnabled', 'value' ).to( command );\r\n *\r\n * which corresponds to:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).to( command );\r\n *\t\tbutton.bind( 'value' ).to( command );\r\n *\r\n * The binding can include more than one observable, combining multiple data sources in a custom callback:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isEnabled', ui, 'isVisible',\r\n *\t\t\t( isCommandEnabled, isUIVisible ) => isCommandEnabled && isUIVisible );\r\n *\r\n * It is also possible to bind to the same property in an array of observables.\r\n * To bind a `button` to multiple commands (also `Observables`) so that each and every one of them\r\n * must be enabled for the button to become enabled, use the following code:\r\n *\r\n *\t\tbutton.bind( 'isEnabled' ).toMany( [ commandA, commandB, commandC ], 'isEnabled',\r\n *\t\t\t( isAEnabled, isBEnabled, isCEnabled ) => isAEnabled && isBEnabled && isCEnabled );\r\n *\r\n * @method #bind\r\n * @param {...String} bindProperties Observable properties that will be bound to another observable(s).\r\n * @returns {Object} The bind chain with the `to()` and `toMany()` methods.\r\n */\r\n\r\n/**\r\n * Removes the binding created with {@link #bind}.\r\n *\r\n *\t\t// Removes the binding for the 'a' property.\r\n *\t\tA.unbind( 'a' );\r\n *\r\n *\t\t// Removes bindings for all properties.\r\n *\t\tA.unbind();\r\n *\r\n * @method #unbind\r\n * @param {...String} [unbindProperties] Observable properties to be unbound. All the bindings will\r\n * be released if no properties provided.\r\n */\r\n\r\n/**\r\n * Turns the given methods of this object into event-based ones. This means that the new method will fire an event\r\n * (named after the method) and the original action will be plugged as a listener to that event.\r\n *\r\n * Read more in the {@glink framework/guides/deep-dive/observables#decorating-object-methods dedicated guide}\r\n * covering the topic of decorating methods with some additional examples.\r\n *\r\n * Decorating the method does not change its behavior (it only adds an event),\r\n * but it allows to modify it later on by listening to the method's event.\r\n *\r\n * For example, to cancel the method execution the event can be {@link module:utils/eventinfo~EventInfo#stop stopped}:\r\n *\r\n *\t\tclass Foo {\r\n *\t\t\tconstructor() {\r\n *\t\t\t\tthis.decorate( 'method' );\r\n *\t\t\t}\r\n *\r\n *\t\t\tmethod() {\r\n *\t\t\t\tconsole.log( 'called!' );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n *\t\tconst foo = new Foo();\r\n *\t\tfoo.on( 'method', ( evt ) => {\r\n *\t\t\tevt.stop();\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n *\t\tfoo.method(); // Nothing is logged.\r\n *\r\n *\r\n * **Note**: The high {@link module:utils/priorities~PriorityString priority} listener\r\n * has been used to execute this particular callback before the one which calls the original method\r\n * (which uses the \"normal\" priority).\r\n *\r\n * It is also possible to change the returned value:\r\n *\r\n *\t\tfoo.on( 'method', ( evt ) => {\r\n *\t\t\tevt.return = 'Foo!';\r\n *\t\t} );\r\n *\r\n *\t\tfoo.method(); // -> 'Foo'\r\n *\r\n * Finally, it is possible to access and modify the arguments the method is called with:\r\n *\r\n *\t\tmethod( a, b ) {\r\n *\t\t\tconsole.log( `${ a }, ${ b }`  );\r\n *\t\t}\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tfoo.on( 'method', ( evt, args ) => {\r\n *\t\t\targs[ 0 ] = 3;\r\n *\r\n *\t\t\tconsole.log( args[ 1 ] ); // -> 2\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n *\t\tfoo.method( 1, 2 ); // -> '3, 2'\r\n *\r\n * @method #decorate\r\n * @param {String} methodName Name of the method to decorate.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/editableelement\r\n */\r\n\r\nimport ContainerElement from './containerelement';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\n\r\nconst documentSymbol = Symbol( 'document' );\r\n\r\n/**\r\n * Editable element which can be a {@link module:engine/view/rooteditableelement~RootEditableElement root}\r\n * or nested editable area in the editor.\r\n *\r\n * Editable is automatically read-only when its {@link module:engine/view/document~Document Document} is read-only.\r\n *\r\n * The constructor of this class shouldn't be used directly. To create new `EditableElement` use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createEditableElement `downcastWriter#createEditableElement()`} method.\r\n *\r\n * @extends module:engine/view/containerelement~ContainerElement\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class EditableElement extends ContainerElement {\r\n\t/**\r\n\t * Creates an editable element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#createEditableElement\r\n\t * @protected\r\n\t */\r\n\tconstructor( name, attrs, children ) {\r\n\t\tsuper( name, attrs, children );\r\n\r\n\t\t/**\r\n\t\t * Whether the editable is in read-write or read-only mode.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} module:engine/view/editableelement~EditableElement#isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * Whether the editable is focused.\r\n\t\t *\r\n\t\t * This property updates when {@link module:engine/view/document~Document#isFocused document.isFocused} or view\r\n\t\t * selection is changed.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} module:engine/view/editableelement~EditableElement#isFocused\r\n\t\t */\r\n\t\tthis.set( 'isFocused', false );\r\n\r\n\t\t/**\r\n\t\t * The {@link module:engine/view/document~Document} which is an owner of this root.\r\n\t\t * Can only by set once.\r\n\t\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-editableelement-document-already-set`\r\n\t\t * when document is already set.\r\n\t\t *\r\n\t\t * @member {module:engine/view/document~Document} #document\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'editableElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'editableElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns document associated with the editable.\r\n\t *\r\n\t * @readonly\r\n\t * @returns {module:engine/view/document~Document}\r\n\t */\r\n\tget document() {\r\n\t\treturn this.getCustomProperty( documentSymbol );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets document of this editable element.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/document~Document} document\r\n\t */\r\n\tset _document( document ) {\r\n\t\tif ( this.getCustomProperty( documentSymbol ) ) {\r\n\t\t\t/**\r\n\t\t\t * View document is already set. It can only be set once.\r\n\t\t\t *\r\n\t\t\t * @error view-editableelement-document-already-set\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-editableelement-document-already-set: View document is already set.' );\r\n\t\t}\r\n\r\n\t\tthis._setCustomProperty( documentSymbol, document );\r\n\r\n\t\tthis.bind( 'isReadOnly' ).to( document );\r\n\r\n\t\tthis.bind( 'isFocused' ).to(\r\n\t\t\tdocument,\r\n\t\t\t'isFocused',\r\n\t\t\tisFocused => isFocused && document.selection.editableElement == this\r\n\t\t);\r\n\r\n\t\t// Update focus state based on selection changes.\r\n\t\tthis.listenTo( document.selection, 'change', () => {\r\n\t\t\tthis.isFocused = document.isFocused && document.selection.editableElement == this;\r\n\t\t} );\r\n\t}\r\n}\r\n\r\nmix( EditableElement, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/rooteditableelement\r\n */\r\n\r\nimport EditableElement from './editableelement';\r\n\r\nconst rootNameSymbol = Symbol( 'rootName' );\r\n\r\n/**\r\n * Class representing a single root in the data view. A root can be either {@link ~RootEditableElement#isReadOnly editable or read-only},\r\n * but in both cases it is called \"an editable\". Roots can contain other {@link module:engine/view/editableelement~EditableElement\r\n * editable elements} making them \"nested editables\".\r\n *\r\n * @extends module:engine/view/editableelement~EditableElement\r\n */\r\nexport default class RootEditableElement extends EditableElement {\r\n\t/**\r\n\t * Creates root editable element.\r\n\t *\r\n\t * @param {String} name Node name.\r\n\t */\r\n\tconstructor( name ) {\r\n\t\tsuper( name );\r\n\r\n\t\t/**\r\n\t\t * Name of this root inside {@link module:engine/view/document~Document} that is an owner of this root. If no\r\n\t\t * other name is set, `main` name is used.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.rootName = 'main';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'rootElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'rootElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\tget rootName() {\r\n\t\treturn this.getCustomProperty( rootNameSymbol );\r\n\t}\r\n\r\n\tset rootName( rootName ) {\r\n\t\tthis._setCustomProperty( rootNameSymbol, rootName );\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides old element name and sets new one.\r\n\t * This is needed because view roots are created before they are attached to the DOM.\r\n\t * The name of the root element is temporary at this stage. It has to be changed when the\r\n\t * view root element is attached to the DOM element.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} name The new name of element.\r\n\t */\r\n\tset _name( name ) {\r\n\t\tthis.name = name;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/treewalker\r\n */\r\n\r\nimport Element from './element';\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport Position from './position';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Position iterator class. It allows to iterate forward and backward over the document.\r\n */\r\nexport default class TreeWalker {\r\n\t/**\r\n\t * Creates a range iterator. All parameters are optional, but you have to specify either `boundaries` or `startPosition`.\r\n\t *\r\n\t * @constructor\r\n\t * @param {Object} options Object with configuration.\r\n\t * @param {module:engine/view/range~Range} [options.boundaries=null] Range to define boundaries of the iterator.\r\n\t * @param {module:engine/view/position~Position} [options.startPosition] Starting position.\r\n\t * @param {'forward'|'backward'} [options.direction='forward'] Walking direction.\r\n\t * @param {Boolean} [options.singleCharacters=false] Flag indicating whether all characters from\r\n\t * {@link module:engine/view/text~Text} should be returned as one {@link module:engine/view/text~Text} (`false`) ore one by one as\r\n\t * {@link module:engine/view/textproxy~TextProxy} (`true`).\r\n\t * @param {Boolean} [options.shallow=false] Flag indicating whether iterator should enter elements or not. If the\r\n\t * iterator is shallow child nodes of any iterated node will not be returned along with `elementEnd` tag.\r\n\t * @param {Boolean} [options.ignoreElementEnd=false] Flag indicating whether iterator should ignore `elementEnd`\r\n\t * tags. If the option is true walker will not return a parent node of start position. If this option is `true`\r\n\t * each {@link module:engine/view/element~Element} will be returned once, while if the option is `false` they might be returned\r\n\t * twice: for `'elementStart'` and `'elementEnd'`.\r\n\t */\r\n\tconstructor( options = {} ) {\r\n\t\tif ( !options.boundaries && !options.startPosition ) {\r\n\t\t\t/**\r\n\t\t\t * Neither boundaries nor starting position have been defined.\r\n\t\t\t *\r\n\t\t\t * @error view-tree-walker-no-start-position\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-tree-walker-no-start-position: Neither boundaries nor starting position have been defined.' );\r\n\t\t}\r\n\r\n\t\tif ( options.direction && options.direction != 'forward' && options.direction != 'backward' ) {\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'view-tree-walker-unknown-direction: Only `backward` and `forward` direction allowed.',\r\n\t\t\t\t{ direction: options.direction }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Iterator boundaries.\r\n\t\t *\r\n\t\t * When the iterator is walking `'forward'` on the end of boundary or is walking `'backward'`\r\n\t\t * on the start of boundary, then `{ done: true }` is returned.\r\n\t\t *\r\n\t\t * If boundaries are not defined they are set before first and after last child of the root node.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/range~Range} module:engine/view/treewalker~TreeWalker#boundaries\r\n\t\t */\r\n\t\tthis.boundaries = options.boundaries || null;\r\n\r\n\t\t/**\r\n\t\t * Iterator position. If start position is not defined then position depends on {@link #direction}. If direction is\r\n\t\t * `'forward'` position starts form the beginning, when direction is `'backward'` position starts from the end.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/position~Position} module:engine/view/treewalker~TreeWalker#position\r\n\t\t */\r\n\t\tif ( options.startPosition ) {\r\n\t\t\tthis.position = Position._createAt( options.startPosition );\r\n\t\t} else {\r\n\t\t\tthis.position = Position._createAt( options.boundaries[ options.direction == 'backward' ? 'end' : 'start' ] );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Walking direction. Defaults `'forward'`.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {'backward'|'forward'} module:engine/view/treewalker~TreeWalker#direction\r\n\t\t */\r\n\t\tthis.direction = options.direction || 'forward';\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether all characters from {@link module:engine/view/text~Text} should be returned as one\r\n\t\t * {@link module:engine/view/text~Text} or one by one as {@link module:engine/view/textproxy~TextProxy}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/view/treewalker~TreeWalker#singleCharacters\r\n\t\t */\r\n\t\tthis.singleCharacters = !!options.singleCharacters;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether iterator should enter elements or not. If the iterator is shallow child nodes of any\r\n\t\t * iterated node will not be returned along with `elementEnd` tag.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/view/treewalker~TreeWalker#shallow\r\n\t\t */\r\n\t\tthis.shallow = !!options.shallow;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether iterator should ignore `elementEnd` tags. If set to `true`, walker will not\r\n\t\t * return a parent node of the start position. Each {@link module:engine/view/element~Element} will be returned once.\r\n\t\t * When set to `false` each element might be returned twice: for `'elementStart'` and `'elementEnd'`.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/view/treewalker~TreeWalker#ignoreElementEnd\r\n\t\t */\r\n\t\tthis.ignoreElementEnd = !!options.ignoreElementEnd;\r\n\r\n\t\t/**\r\n\t\t * Start boundary parent.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/node~Node} module:engine/view/treewalker~TreeWalker#_boundaryStartParent\r\n\t\t */\r\n\t\tthis._boundaryStartParent = this.boundaries ? this.boundaries.start.parent : null;\r\n\r\n\t\t/**\r\n\t\t * End boundary parent.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/node~Node} module:engine/view/treewalker~TreeWalker#_boundaryEndParent\r\n\t\t */\r\n\t\tthis._boundaryEndParent = this.boundaries ? this.boundaries.end.parent : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/treewalker~TreeWalkerValue>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link #position} in the {@link #direction} skipping values as long as the callback function returns `true`.\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t * \t\twalker.skip( value => value.type == 'text' ); // <p>{}foo</p> -> <p>foo[]</p>\r\n\t * \t\twalker.skip( value => true ); // Move the position to the end: <p>{}foo</p> -> <p>foo</p>[]\r\n\t * \t\twalker.skip( value => false ); // Do not move the position.\r\n\t *\r\n\t * @param {Function} skip Callback function. Gets {@link module:engine/view/treewalker~TreeWalkerValue} and should\r\n\t * return `true` if the value should be skipped or `false` if not.\r\n\t */\r\n\tskip( skip ) {\r\n\t\tlet done, value, prevPosition;\r\n\r\n\t\tdo {\r\n\t\t\tprevPosition = this.position;\r\n\r\n\t\t\t( { done, value } = this.next() );\r\n\t\t} while ( !done && skip( value ) );\r\n\r\n\t\tif ( !done ) {\r\n\t\t\tthis.position = prevPosition;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next tree walker's value.\r\n\t *\r\n\t * @returns {module:engine/view/treewalker~TreeWalkerValue} Object implementing iterator interface, returning\r\n\t * information about taken step.\r\n\t */\r\n\tnext() {\r\n\t\tif ( this.direction == 'forward' ) {\r\n\t\t\treturn this._next();\r\n\t\t} else {\r\n\t\t\treturn this._previous();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a step forward in view. Moves the {@link #position} to the next position and returns the encountered value.\r\n\t *\r\n\t * @private\r\n\t * @returns {Object}\r\n\t * @returns {Boolean} return.done `true` if iterator is done, `false` otherwise.\r\n\t * @returns {module:engine/view/treewalker~TreeWalkerValue} return.value Information about taken step.\r\n\t */\r\n\t_next() {\r\n\t\tlet position = this.position.clone();\r\n\t\tconst previousPosition = this.position;\r\n\t\tconst parent = position.parent;\r\n\r\n\t\t// We are at the end of the root.\r\n\t\tif ( parent.parent === null && position.offset === parent.childCount ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// We reached the walker boundary.\r\n\t\tif ( parent === this._boundaryEndParent && position.offset == this.boundaries.end.offset ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// Get node just after current position.\r\n\t\tlet node;\r\n\r\n\t\t// Text is a specific parent because it contains string instead of child nodes.\r\n\t\tif ( parent instanceof Text ) {\r\n\t\t\tif ( position.isAtEnd ) {\r\n\t\t\t\t// Prevent returning \"elementEnd\" for Text node. Skip that value and return the next walker step.\r\n\t\t\t\tthis.position = Position._createAfter( parent );\r\n\r\n\t\t\t\treturn this._next();\r\n\t\t\t}\r\n\r\n\t\t\tnode = parent.data[ position.offset ];\r\n\t\t} else {\r\n\t\t\tnode = parent.getChild( position.offset );\r\n\t\t}\r\n\r\n\t\tif ( node instanceof Element ) {\r\n\t\t\tif ( !this.shallow ) {\r\n\t\t\t\tposition = new Position( node, 0 );\r\n\t\t\t} else {\r\n\t\t\t\tposition.offset++;\r\n\t\t\t}\r\n\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn this._formatReturnValue( 'elementStart', node, previousPosition, position, 1 );\r\n\t\t} else if ( node instanceof Text ) {\r\n\t\t\tif ( this.singleCharacters ) {\r\n\t\t\t\tposition = new Position( node, 0 );\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn this._next();\r\n\t\t\t} else {\r\n\t\t\t\tlet charactersCount = node.data.length;\r\n\t\t\t\tlet item;\r\n\r\n\t\t\t\t// If text stick out of walker range, we need to cut it and wrap by TextProxy.\r\n\t\t\t\tif ( node == this._boundaryEndParent ) {\r\n\t\t\t\t\tcharactersCount = this.boundaries.end.offset;\r\n\t\t\t\t\titem = new TextProxy( node, 0, charactersCount );\r\n\t\t\t\t\tposition = Position._createAfter( item );\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem = new TextProxy( node, 0, node.data.length );\r\n\t\t\t\t\t// If not just keep moving forward.\r\n\t\t\t\t\tposition.offset++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn this._formatReturnValue( 'text', item, previousPosition, position, charactersCount );\r\n\t\t\t}\r\n\t\t} else if ( typeof node == 'string' ) {\r\n\t\t\tlet textLength;\r\n\r\n\t\t\tif ( this.singleCharacters ) {\r\n\t\t\t\ttextLength = 1;\r\n\t\t\t} else {\r\n\t\t\t\t// Check if text stick out of walker range.\r\n\t\t\t\tconst endOffset = parent === this._boundaryEndParent ? this.boundaries.end.offset : parent.data.length;\r\n\r\n\t\t\t\ttextLength = endOffset - position.offset;\r\n\t\t\t}\r\n\r\n\t\t\tconst textProxy = new TextProxy( parent, position.offset, textLength );\r\n\r\n\t\t\tposition.offset += textLength;\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn this._formatReturnValue( 'text', textProxy, previousPosition, position, textLength );\r\n\t\t} else {\r\n\t\t\t// `node` is not set, we reached the end of current `parent`.\r\n\t\t\tposition = Position._createAfter( parent );\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\tif ( this.ignoreElementEnd ) {\r\n\t\t\t\treturn this._next();\r\n\t\t\t} else {\r\n\t\t\t\treturn this._formatReturnValue( 'elementEnd', parent, previousPosition, position );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a step backward in view. Moves the {@link #position} to the previous position and returns the encountered value.\r\n\t *\r\n\t * @private\r\n\t * @returns {Object}\r\n\t * @returns {Boolean} return.done True if iterator is done.\r\n\t * @returns {module:engine/view/treewalker~TreeWalkerValue} return.value Information about taken step.\r\n\t */\r\n\t_previous() {\r\n\t\tlet position = this.position.clone();\r\n\t\tconst previousPosition = this.position;\r\n\t\tconst parent = position.parent;\r\n\r\n\t\t// We are at the beginning of the root.\r\n\t\tif ( parent.parent === null && position.offset === 0 ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// We reached the walker boundary.\r\n\t\tif ( parent == this._boundaryStartParent && position.offset == this.boundaries.start.offset ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// Get node just before current position.\r\n\t\tlet node;\r\n\r\n\t\t// Text {@link module:engine/view/text~Text} element is a specific parent because contains string instead of child nodes.\r\n\t\tif ( parent instanceof Text ) {\r\n\t\t\tif ( position.isAtStart ) {\r\n\t\t\t\t// Prevent returning \"elementStart\" for Text node. Skip that value and return the next walker step.\r\n\t\t\t\tthis.position = Position._createBefore( parent );\r\n\r\n\t\t\t\treturn this._previous();\r\n\t\t\t}\r\n\r\n\t\t\tnode = parent.data[ position.offset - 1 ];\r\n\t\t} else {\r\n\t\t\tnode = parent.getChild( position.offset - 1 );\r\n\t\t}\r\n\r\n\t\tif ( node instanceof Element ) {\r\n\t\t\tif ( !this.shallow ) {\r\n\t\t\t\tposition = new Position( node, node.childCount );\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\tif ( this.ignoreElementEnd ) {\r\n\t\t\t\t\treturn this._previous();\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn this._formatReturnValue( 'elementEnd', node, previousPosition, position );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tposition.offset--;\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn this._formatReturnValue( 'elementStart', node, previousPosition, position, 1 );\r\n\t\t\t}\r\n\t\t} else if ( node instanceof Text ) {\r\n\t\t\tif ( this.singleCharacters ) {\r\n\t\t\t\tposition = new Position( node, node.data.length );\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn this._previous();\r\n\t\t\t} else {\r\n\t\t\t\tlet charactersCount = node.data.length;\r\n\t\t\t\tlet item;\r\n\r\n\t\t\t\t// If text stick out of walker range, we need to cut it and wrap by TextProxy.\r\n\t\t\t\tif ( node == this._boundaryStartParent ) {\r\n\t\t\t\t\tconst offset = this.boundaries.start.offset;\r\n\r\n\t\t\t\t\titem = new TextProxy( node, offset, node.data.length - offset );\r\n\t\t\t\t\tcharactersCount = item.data.length;\r\n\t\t\t\t\tposition = Position._createBefore( item );\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem = new TextProxy( node, 0, node.data.length );\r\n\t\t\t\t\t// If not just keep moving backward.\r\n\t\t\t\t\tposition.offset--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn this._formatReturnValue( 'text', item, previousPosition, position, charactersCount );\r\n\t\t\t}\r\n\t\t} else if ( typeof node == 'string' ) {\r\n\t\t\tlet textLength;\r\n\r\n\t\t\tif ( !this.singleCharacters ) {\r\n\t\t\t\t// Check if text stick out of walker range.\r\n\t\t\t\tconst startOffset = parent === this._boundaryStartParent ? this.boundaries.start.offset : 0;\r\n\r\n\t\t\t\ttextLength = position.offset - startOffset;\r\n\t\t\t} else {\r\n\t\t\t\ttextLength = 1;\r\n\t\t\t}\r\n\r\n\t\t\tposition.offset -= textLength;\r\n\r\n\t\t\tconst textProxy = new TextProxy( parent, position.offset, textLength );\r\n\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn this._formatReturnValue( 'text', textProxy, previousPosition, position, textLength );\r\n\t\t} else {\r\n\t\t\t// `node` is not set, we reached the beginning of current `parent`.\r\n\t\t\tposition = Position._createBefore( parent );\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn this._formatReturnValue( 'elementStart', parent, previousPosition, position, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Format returned data and adjust `previousPosition` and `nextPosition` if reach the bound of the {@link module:engine/view/text~Text}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/treewalker~TreeWalkerValueType} type Type of step.\r\n\t * @param {module:engine/view/item~Item} item Item between old and new position.\r\n\t * @param {module:engine/view/position~Position} previousPosition Previous position of iterator.\r\n\t * @param {module:engine/view/position~Position} nextPosition Next position of iterator.\r\n\t * @param {Number} [length] Length of the item.\r\n\t * @returns {module:engine/view/treewalker~TreeWalkerValue}\r\n\t */\r\n\t_formatReturnValue( type, item, previousPosition, nextPosition, length ) {\r\n\t\t// Text is a specific parent, because contains string instead of children.\r\n\t\t// Walker doesn't enter to the Text except situations when walker is iterating over every single character,\r\n\t\t// or the bound starts/ends inside the Text. So when the position is at the beginning or at the end of the Text\r\n\t\t// we move it just before or just after Text.\r\n\t\tif ( item instanceof TextProxy ) {\r\n\t\t\t// Position is at the end of Text.\r\n\t\t\tif ( item.offsetInText + item.data.length == item.textNode.data.length ) {\r\n\t\t\t\tif ( this.direction == 'forward' && !( this.boundaries && this.boundaries.end.isEqual( this.position ) ) ) {\r\n\t\t\t\t\tnextPosition = Position._createAfter( item.textNode );\r\n\t\t\t\t\t// When we change nextPosition of returned value we need also update walker current position.\r\n\t\t\t\t\tthis.position = nextPosition;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpreviousPosition = Position._createAfter( item.textNode );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Position is at the begining ot the text.\r\n\t\t\tif ( item.offsetInText === 0 ) {\r\n\t\t\t\tif ( this.direction == 'backward' && !( this.boundaries && this.boundaries.start.isEqual( this.position ) ) ) {\r\n\t\t\t\t\tnextPosition = Position._createBefore( item.textNode );\r\n\t\t\t\t\t// When we change nextPosition of returned value we need also update walker current position.\r\n\t\t\t\t\tthis.position = nextPosition;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpreviousPosition = Position._createBefore( item.textNode );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdone: false,\r\n\t\t\tvalue: {\r\n\t\t\t\ttype,\r\n\t\t\t\titem,\r\n\t\t\t\tpreviousPosition,\r\n\t\t\t\tnextPosition,\r\n\t\t\t\tlength\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * Type of the step made by {@link module:engine/view/treewalker~TreeWalker}.\r\n * Possible values: `'elementStart'` if walker is at the beginning of a node, `'elementEnd'` if walker is at the end\r\n * of node, or `'text'` if walker traversed over single and multiple characters.\r\n * For {@link module:engine/view/text~Text} `elementStart` and `elementEnd` is not returned.\r\n *\r\n * @typedef {String} module:engine/view/treewalker~TreeWalkerValueType\r\n */\r\n\r\n/**\r\n * Object returned by {@link module:engine/view/treewalker~TreeWalker} when traversing tree view.\r\n *\r\n * @typedef {Object} module:engine/view/treewalker~TreeWalkerValue\r\n * @property {module:engine/view/treewalker~TreeWalkerValueType} type\r\n * @property {module:engine/view/item~Item} item Item between the old and the new positions\r\n * of the tree walker.\r\n * @property {module:engine/view/position~Position} previousPosition Previous position of the iterator.\r\n * * Forward iteration: For `'elementEnd'` it is the last position inside the element. For all other types it is the\r\n * position before the item.\r\n * * Backward iteration: For `'elementStart'` it is the first position inside the element. For all other types it is\r\n * the position after item.\r\n * * If the position is at the beginning or at the end of the {@link module:engine/view/text~Text} it is always moved from the\r\n * inside of the text to its parent just before or just after that text.\r\n * @property {module:engine/view/position~Position} nextPosition Next position of the iterator.\r\n * * Forward iteration: For `'elementStart'` it is the first position inside the element. For all other types it is\r\n * the position after the item.\r\n * * Backward iteration: For `'elementEnd'` it is last position inside element. For all other types it is the position\r\n * before the item.\r\n * * If the position is at the beginning or at the end of the {@link module:engine/view/text~Text} it is always moved from the\r\n * inside of the text to its parent just before or just after that text.\r\n * @property {Number} [length] Length of the item. For `'elementStart'` it is `1`. For `'text'` it is\r\n * the length of that text. For `'elementEnd'` it is `undefined`.\r\n */\r\n\r\n/**\r\n * Tree walking directions.\r\n *\r\n * @typedef {'forward'|'backward'} module:engine/view/treewalker~TreeWalkerDirection\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/position\r\n */\r\n\r\nimport TreeWalker from './treewalker';\r\n\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport EditableElement from './editableelement';\r\n\r\n/**\r\n * Position in the view tree. Position is represented by its parent node and an offset in this parent.\r\n *\r\n * In order to create a new position instance use the `createPosition*()` factory methods available in:\r\n *\r\n * * {@module:engine/view/view~View}\r\n * * {@module:engine/view/downcastwriter~DowncastWriter}\r\n * * {@module:engine/view/upcastwriter~UpcastWriter}\r\n */\r\nexport default class Position {\r\n\t/**\r\n\t * Creates a position.\r\n\t *\r\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} parent Position parent.\r\n\t * @param {Number} offset Position offset.\r\n\t */\r\n\tconstructor( parent, offset ) {\r\n\t\t/**\r\n\t\t * Position parent.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment}\r\n\t\t * module:engine/view/position~Position#parent\r\n\t\t */\r\n\t\tthis.parent = parent;\r\n\r\n\t\t/**\r\n\t\t * Position offset.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} module:engine/view/position~Position#offset\r\n\t\t */\r\n\t\tthis.offset = offset;\r\n\t}\r\n\r\n\t/**\r\n\t * Node directly after the position. Equals `null` when there is no node after position or position is located\r\n\t * inside text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|null}\r\n\t */\r\n\tget nodeAfter() {\r\n\t\tif ( this.parent.is( 'text' ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.parent.getChild( this.offset ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Node directly before the position. Equals `null` when there is no node before position or position is located\r\n\t * inside text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|null}\r\n\t */\r\n\tget nodeBefore() {\r\n\t\tif ( this.parent.is( 'text' ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.parent.getChild( this.offset - 1 ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if position is at the beginning of its {@link module:engine/view/position~Position#parent parent}, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isAtStart() {\r\n\t\treturn this.offset === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if position is at the end of its {@link module:engine/view/position~Position#parent parent}, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isAtEnd() {\r\n\t\tconst endOffset = this.parent.is( 'text' ) ? this.parent.data.length : this.parent.childCount;\r\n\r\n\t\treturn this.offset === endOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Position's root, that is the root of the position's parent element.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this.parent.root;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/editableelement~EditableElement EditableElement} instance that contains this position, or `null` if\r\n\t * position is not inside an editable element.\r\n\t *\r\n\t * @type {module:engine/view/editableelement~EditableElement|null}\r\n\t */\r\n\tget editableElement() {\r\n\t\tlet editable = this.parent;\r\n\r\n\t\twhile ( !( editable instanceof EditableElement ) ) {\r\n\t\t\tif ( editable.parent ) {\r\n\t\t\t\teditable = editable.parent;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn editable;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new instance of Position with offset incremented by `shift` value.\r\n\t *\r\n\t * @param {Number} shift How position offset should get changed. Accepts negative values.\r\n\t * @returns {module:engine/view/position~Position} Shifted position.\r\n\t */\r\n\tgetShiftedBy( shift ) {\r\n\t\tconst shifted = Position._createAt( this );\r\n\r\n\t\tconst offset = shifted.offset + shift;\r\n\t\tshifted.offset = offset < 0 ? 0 : offset;\r\n\r\n\t\treturn shifted;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the farthest position which matches the callback using\r\n\t * {@link module:engine/view/treewalker~TreeWalker TreeWalker}.\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t * \t\tgetLastMatchingPosition( value => value.type == 'text' ); // <p>{}foo</p> -> <p>foo[]</p>\r\n\t * \t\tgetLastMatchingPosition( value => value.type == 'text', { direction: 'backward' } ); // <p>foo[]</p> -> <p>{}foo</p>\r\n\t * \t\tgetLastMatchingPosition( value => false ); // Do not move the position.\r\n\t *\r\n\t * @param {Function} skip Callback function. Gets {@link module:engine/view/treewalker~TreeWalkerValue} and should\r\n\t * return `true` if the value should be skipped or `false` if not.\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/view/treewalker~TreeWalker}.\r\n\t *\r\n\t * @returns {module:engine/view/position~Position} The position after the last item which matches the `skip` callback test.\r\n\t */\r\n\tgetLastMatchingPosition( skip, options = {} ) {\r\n\t\toptions.startPosition = this;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\t\ttreeWalker.skip( skip );\r\n\r\n\t\treturn treeWalker.position;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this position, that is this position's parent and it's ancestors.\r\n\t *\r\n\t * @returns {Array} Array with ancestors.\r\n\t */\r\n\tgetAncestors() {\r\n\t\tif ( this.parent.is( 'documentFragment' ) ) {\r\n\t\t\treturn [ this.parent ];\r\n\t\t} else {\r\n\t\t\treturn this.parent.getAncestors( { includeSelf: true } );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a {@link module:engine/view/node~Node} or {@link module:engine/view/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of both positions.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} position\r\n\t * @returns {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor( position ) {\r\n\t\tconst ancestorsA = this.getAncestors();\r\n\t\tconst ancestorsB = position.getAncestors();\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\twhile ( ancestorsA[ i ] == ancestorsB[ i ] && ancestorsA[ i ] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i === 0 ? null : ancestorsA[ i - 1 ];\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position equals given position.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} True if positions are same.\r\n\t */\r\n\tisEqual( otherPosition ) {\r\n\t\treturn ( this.parent == otherPosition.parent && this.offset == otherPosition.offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is located before given position. When method returns `false` it does not mean that\r\n\t * this position is after give one. Two positions may be located inside separate roots and in that situation this\r\n\t * method will still return `false`.\r\n\t *\r\n\t * @see module:engine/view/position~Position#isAfter\r\n\t * @see module:engine/view/position~Position#compareWith\r\n\t * @param {module:engine/view/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} Returns `true` if this position is before given position.\r\n\t */\r\n\tisBefore( otherPosition ) {\r\n\t\treturn this.compareWith( otherPosition ) == 'before';\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is located after given position. When method returns `false` it does not mean that\r\n\t * this position is before give one. Two positions may be located inside separate roots and in that situation this\r\n\t * method will still return `false`.\r\n\t *\r\n\t * @see module:engine/view/position~Position#isBefore\r\n\t * @see module:engine/view/position~Position#compareWith\r\n\t * @param {module:engine/view/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} Returns `true` if this position is after given position.\r\n\t */\r\n\tisAfter( otherPosition ) {\r\n\t\treturn this.compareWith( otherPosition ) == 'after';\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is before, after or in same position that other position. Two positions may be also\r\n\t * different when they are located in separate roots.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} otherPosition Position to compare with.\r\n\t * @returns {module:engine/view/position~PositionRelation}\r\n\t */\r\n\tcompareWith( otherPosition ) {\r\n\t\tif ( this.root !== otherPosition.root ) {\r\n\t\t\treturn 'different';\r\n\t\t}\r\n\r\n\t\tif ( this.isEqual( otherPosition ) ) {\r\n\t\t\treturn 'same';\r\n\t\t}\r\n\r\n\t\t// Get path from root to position's parent element.\r\n\t\tconst thisPath = this.parent.is( 'node' ) ? this.parent.getPath() : [];\r\n\t\tconst otherPath = otherPosition.parent.is( 'node' ) ? otherPosition.parent.getPath() : [];\r\n\r\n\t\t// Add the positions' offsets to the parents offsets.\r\n\t\tthisPath.push( this.offset );\r\n\t\totherPath.push( otherPosition.offset );\r\n\r\n\t\t// Compare both path arrays to find common ancestor.\r\n\t\tconst result = compareArrays( thisPath, otherPath );\r\n\r\n\t\tswitch ( result ) {\r\n\t\t\tcase 'prefix':\r\n\t\t\t\treturn 'before';\r\n\r\n\t\t\tcase 'extension':\r\n\t\t\t\treturn 'after';\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn thisPath[ result ] < otherPath[ result ] ? 'before' : 'after';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/view/treewalker~TreeWalker TreeWalker} instance with this positions as a start position.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/view/treewalker~TreeWalker}\r\n\t * @param {module:engine/view/range~Range} [options.boundaries=null] Range to define boundaries of the iterator.\r\n\t * @param {Boolean} [options.singleCharacters=false]\r\n\t * @param {Boolean} [options.shallow=false]\r\n\t * @param {Boolean} [options.ignoreElementEnd=false]\r\n\t */\r\n\tgetWalker( options = {} ) {\r\n\t\toptions.startPosition = this;\r\n\r\n\t\treturn new TreeWalker( options );\r\n\t}\r\n\r\n\tclone() {\r\n\t\treturn new Position( this.parent, this.offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/view/position~Position position},\r\n\t * * parent element and offset (offset defaults to `0`),\r\n\t * * parent element and `'end'` (sets position at the end of that element),\r\n\t * * {@link module:engine/view/item~Item view item} and `'before'` or `'after'` (sets position before or after given view item).\r\n\t *\r\n\t * This method is a shortcut to other constructors such as:\r\n\t *\r\n\t * * {@link module:engine/view/position~Position._createBefore},\r\n\t * * {@link module:engine/view/position~Position._createAfter}.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tstatic _createAt( itemOrPosition, offset ) {\r\n\t\tif ( itemOrPosition instanceof Position ) {\r\n\t\t\treturn new this( itemOrPosition.parent, itemOrPosition.offset );\r\n\t\t} else {\r\n\t\t\tconst node = itemOrPosition;\r\n\r\n\t\t\tif ( offset == 'end' ) {\r\n\t\t\t\toffset = node.is( 'text' ) ? node.data.length : node.childCount;\r\n\t\t\t} else if ( offset == 'before' ) {\r\n\t\t\t\treturn this._createBefore( node );\r\n\t\t\t} else if ( offset == 'after' ) {\r\n\t\t\t\treturn this._createAfter( node );\r\n\t\t\t} else if ( offset !== 0 && !offset ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * {@link module:engine/view/view~View#createPositionAt `View#createPositionAt()`}\r\n\t\t\t\t * requires the offset to be specified when the first parameter is a view item.\r\n\t\t\t\t *\r\n\t\t\t\t * @error view-createPositionAt-offset-required\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'view-createPositionAt-offset-required: ' +\r\n\t\t\t\t\t'View#createPositionAt() requires the offset when the first parameter is a view item.' );\r\n\t\t\t}\r\n\r\n\t\t\treturn new Position( node, offset );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position after given view item.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/item~Item} item View item after which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tstatic _createAfter( item ) {\r\n\t\t// TextProxy is not a instance of Node so we need do handle it in specific way.\r\n\t\tif ( item.is( 'textProxy' ) ) {\r\n\t\t\treturn new Position( item.textNode, item.offsetInText + item.data.length );\r\n\t\t}\r\n\r\n\t\tif ( !item.parent ) {\r\n\t\t\t/**\r\n\t\t\t * You can not make a position after a root.\r\n\t\t\t *\r\n\t\t\t * @error view-position-after-root\r\n\t\t\t * @param {module:engine/view/node~Node} root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-position-after-root: You can not make position after root.', { root: item } );\r\n\t\t}\r\n\r\n\t\treturn new Position( item.parent, item.index + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position before given view item.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/item~Item} item View item before which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tstatic _createBefore( item ) {\r\n\t\t// TextProxy is not a instance of Node so we need do handle it in specific way.\r\n\t\tif ( item.is( 'textProxy' ) ) {\r\n\t\t\treturn new Position( item.textNode, item.offsetInText );\r\n\t\t}\r\n\r\n\t\tif ( !item.parent ) {\r\n\t\t\t/**\r\n\t\t\t * You cannot make a position before a root.\r\n\t\t\t *\r\n\t\t\t * @error view-position-before-root\r\n\t\t\t * @param {module:engine/view/node~Node} root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-position-before-root: You can not make position before root.', { root: item } );\r\n\t\t}\r\n\r\n\t\treturn new Position( item.parent, item.index );\r\n\t}\r\n}\r\n\r\n/**\r\n * A flag indicating whether this position is `'before'` or `'after'` or `'same'` as given position.\r\n * If positions are in different roots `'different'` flag is returned.\r\n *\r\n * @typedef {String} module:engine/view/position~PositionRelation\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/range\r\n */\r\n\r\nimport Position from './position';\r\nimport TreeWalker from './treewalker';\r\n\r\n/**\r\n * Range in the view tree. A range is represented by its start and end {@link module:engine/view/position~Position positions}.\r\n *\r\n * In order to create a new position instance use the `createPosition*()` factory methods available in:\r\n *\r\n * * {@module:engine/view/view~View}\r\n * * {@module:engine/view/downcastwriter~DowncastWriter}\r\n * * {@module:engine/view/upcastwriter~UpcastWriter}\r\n */\r\nexport default class Range {\r\n\t/**\r\n\t * Creates a range spanning from `start` position to `end` position.\r\n\t *\r\n\t * **Note:** Constructor creates it's own {@link module:engine/view/position~Position} instances basing on passed values.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} start Start position.\r\n\t * @param {module:engine/view/position~Position} [end] End position. If not set, range will be collapsed at the `start` position.\r\n\t */\r\n\tconstructor( start, end = null ) {\r\n\t\t/**\r\n\t\t * Start position.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/position~Position}\r\n\t\t */\r\n\t\tthis.start = start.clone();\r\n\r\n\t\t/**\r\n\t\t * End position.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/position~Position}\r\n\t\t */\r\n\t\tthis.end = end ? end.clone() : start.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over all {@link module:engine/view/item~Item view items} that are in this range and returns\r\n\t * them together with additional information like length or {@link module:engine/view/position~Position positions},\r\n\t * grouped as {@link module:engine/view/treewalker~TreeWalkerValue}.\r\n\t *\r\n\t * This iterator uses {@link module:engine/view/treewalker~TreeWalker TreeWalker} with `boundaries` set to this range and\r\n\t * `ignoreElementEnd` option\r\n\t * set to `true`.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/treewalker~TreeWalkerValue>}\r\n\t */\r\n\t* [ Symbol.iterator ]() {\r\n\t\tyield* new TreeWalker( { boundaries: this, ignoreElementEnd: true } );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the range is collapsed, that is it start and end positions are equal.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\treturn this.start.isEqual( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this range is flat, that is if {@link module:engine/view/range~Range#start start} position and\r\n\t * {@link module:engine/view/range~Range#end end} position are in the same {@link module:engine/view/position~Position#parent parent}.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isFlat() {\r\n\t\treturn this.start.parent === this.end.parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Range root element.\r\n\t *\r\n\t * @type {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this.start.root;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a maximal range that has the same content as this range but is expanded in both ways (at the beginning\r\n\t * and at the end).\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t *\t\t<p>Foo</p><p><b>{Bar}</b></p> -> <p>Foo</p>[<p><b>Bar</b>]</p>\r\n\t *\t\t<p><b>foo</b>{bar}<span></span></p> -> <p><b>foo[</b>bar<span></span>]</p>\r\n\t *\r\n\t * Note that in the sample above:\r\n\t *\r\n\t * - `<p>` have type of {@link module:engine/view/containerelement~ContainerElement},\r\n\t * - `<b>` have type of {@link module:engine/view/attributeelement~AttributeElement},\r\n\t * - `<span>` have type of {@link module:engine/view/uielement~UIElement}.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range} Enlarged range.\r\n\t */\r\n\tgetEnlarged() {\r\n\t\tlet start = this.start.getLastMatchingPosition( enlargeTrimSkip, { direction: 'backward' } );\r\n\t\tlet end = this.end.getLastMatchingPosition( enlargeTrimSkip );\r\n\r\n\t\t// Fix positions, in case if they are in Text node.\r\n\t\tif ( start.parent.is( 'text' ) && start.isAtStart ) {\r\n\t\t\tstart = Position._createBefore( start.parent );\r\n\t\t}\r\n\r\n\t\tif ( end.parent.is( 'text' ) && end.isAtEnd ) {\r\n\t\t\tend = Position._createAfter( end.parent );\r\n\t\t}\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a minimum range that has the same content as this range but is trimmed in both ways (at the beginning\r\n\t * and at the end).\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t *\t\t<p>Foo</p>[<p><b>Bar</b>]</p> -> <p>Foo</p><p><b>{Bar}</b></p>\r\n\t *\t\t<p><b>foo[</b>bar<span></span>]</p> -> <p><b>foo</b>{bar}<span></span></p>\r\n\t *\r\n\t * Note that in the sample above:\r\n\t *\r\n\t * - `<p>` have type of {@link module:engine/view/containerelement~ContainerElement},\r\n\t * - `<b>` have type of {@link module:engine/view/attributeelement~AttributeElement},\r\n\t * - `<span>` have type of {@link module:engine/view/uielement~UIElement}.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range} Shrink range.\r\n\t */\r\n\tgetTrimmed() {\r\n\t\tlet start = this.start.getLastMatchingPosition( enlargeTrimSkip );\r\n\r\n\t\tif ( start.isAfter( this.end ) || start.isEqual( this.end ) ) {\r\n\t\t\treturn new Range( start, start );\r\n\t\t}\r\n\r\n\t\tlet end = this.end.getLastMatchingPosition( enlargeTrimSkip, { direction: 'backward' } );\r\n\t\tconst nodeAfterStart = start.nodeAfter;\r\n\t\tconst nodeBeforeEnd = end.nodeBefore;\r\n\r\n\t\t// Because TreeWalker prefers positions next to text node, we need to move them manually into these text nodes.\r\n\t\tif ( nodeAfterStart && nodeAfterStart.is( 'text' ) ) {\r\n\t\t\tstart = new Position( nodeAfterStart, 0 );\r\n\t\t}\r\n\r\n\t\tif ( nodeBeforeEnd && nodeBeforeEnd.is( 'text' ) ) {\r\n\t\t\tend = new Position( nodeBeforeEnd, nodeBeforeEnd.data.length );\r\n\t\t}\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Two ranges are equal if their start and end positions are equal.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} otherRange Range to compare with.\r\n\t * @returns {Boolean} `true` if ranges are equal, `false` otherwise\r\n\t */\r\n\tisEqual( otherRange ) {\r\n\t\treturn this == otherRange || ( this.start.isEqual( otherRange.start ) && this.end.isEqual( otherRange.end ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this range contains given {@link module:engine/view/position~Position position}.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} position Position to check.\r\n\t * @returns {Boolean} `true` if given {@link module:engine/view/position~Position position} is contained in this range,\r\n\t * `false` otherwise.\r\n\t */\r\n\tcontainsPosition( position ) {\r\n\t\treturn position.isAfter( this.start ) && position.isBefore( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this range contains given {@link module:engine/view/range~Range range}.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} otherRange Range to check.\r\n\t * @param {Boolean} [loose=false] Whether the check is loose or strict. If the check is strict (`false`), compared range cannot\r\n\t * start or end at the same position as this range boundaries. If the check is loose (`true`), compared range can start, end or\r\n\t * even be equal to this range. Note that collapsed ranges are always compared in strict mode.\r\n\t * @returns {Boolean} `true` if given {@link module:engine/view/range~Range range} boundaries are contained by this range, `false`\r\n\t * otherwise.\r\n\t */\r\n\tcontainsRange( otherRange, loose = false ) {\r\n\t\tif ( otherRange.isCollapsed ) {\r\n\t\t\tloose = false;\r\n\t\t}\r\n\r\n\t\tconst containsStart = this.containsPosition( otherRange.start ) || ( loose && this.start.isEqual( otherRange.start ) );\r\n\t\tconst containsEnd = this.containsPosition( otherRange.end ) || ( loose && this.end.isEqual( otherRange.end ) );\r\n\r\n\t\treturn containsStart && containsEnd;\r\n\t}\r\n\r\n\t/**\r\n\t * Computes which part(s) of this {@link module:engine/view/range~Range range} is not a part of given\r\n\t * {@link module:engine/view/range~Range range}.\r\n\t * Returned array contains zero, one or two {@link module:engine/view/range~Range ranges}.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tlet foo = downcastWriter.createText( 'foo' );\r\n\t *\t\tlet img = downcastWriter.createContainerElement( 'img' );\r\n\t *\t\tlet bar = downcastWriter.createText( 'bar' );\r\n\t *\t\tlet p = downcastWriter.createContainerElement( 'p', null, [ foo, img, bar ] );\r\n\t *\r\n\t *\t\tlet range = view.createRange( view.createPositionAt( foo, 2 ), view.createPositionAt( bar, 1 ); // \"o\", img, \"b\" are in range.\r\n\t *\t\tlet otherRange = view.createRange( // \"oo\", img, \"ba\" are in range.\r\n\t *\t\t\tview.createPositionAt( foo, 1 ),\r\n\t *\t\t\tview.createPositionAt( bar, 2 )\r\n\t *\t\t);\r\n\t *\t\tlet transformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has no ranges because `otherRange` contains `range`\r\n\t *\r\n\t *\t\totherRange = view.createRange( view.createPositionAt( foo, 1 ), view.createPositionAt( p, 2 ); // \"oo\", img are in range.\r\n\t *\t\ttransformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has one range: from ( p, 2 ) to ( bar, 1 )\r\n\t *\r\n\t *\t\totherRange = view.createRange( view.createPositionAt( p, 1 ), view.createPositionAt( p, 2 ) ); // img is in range.\r\n\t *\t\ttransformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has two ranges: from ( foo, 1 ) to ( p, 1 ) and from ( p, 2 ) to ( bar, 1 )\r\n\t *\r\n\t * @param {module:engine/view/range~Range} otherRange Range to differentiate against.\r\n\t * @returns {Array.<module:engine/view/range~Range>} The difference between ranges.\r\n\t */\r\n\tgetDifference( otherRange ) {\r\n\t\tconst ranges = [];\r\n\r\n\t\tif ( this.isIntersecting( otherRange ) ) {\r\n\t\t\t// Ranges intersect.\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.start ) ) {\r\n\t\t\t\t// Given range start is inside this range. This means that we have to\r\n\t\t\t\t// add shrunken range - from the start to the middle of this range.\r\n\t\t\t\tranges.push( new Range( this.start, otherRange.start ) );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.end ) ) {\r\n\t\t\t\t// Given range end is inside this range. This means that we have to\r\n\t\t\t\t// add shrunken range - from the middle of this range to the end.\r\n\t\t\t\tranges.push( new Range( otherRange.end, this.end ) );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Ranges do not intersect, return the original range.\r\n\t\t\tranges.push( this.clone() );\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an intersection of this {@link module:engine/view/range~Range range} and given {@link module:engine/view/range~Range range}.\r\n\t * Intersection is a common part of both of those ranges. If ranges has no common part, returns `null`.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tlet foo = downcastWriter.createText( 'foo' );\r\n\t *\t\tlet img = downcastWriter.createContainerElement( 'img' );\r\n\t *\t\tlet bar = downcastWriter.createText( 'bar' );\r\n\t *\t\tlet p = downcastWriter.createContainerElement( 'p', null, [ foo, img, bar ] );\r\n\t *\r\n\t *\t\tlet range = view.createRange( view.createPositionAt( foo, 2 ), view.createPositionAt( bar, 1 ); // \"o\", img, \"b\" are in range.\r\n\t *\t\tlet otherRange = view.createRange( view.createPositionAt( foo, 1 ), view.createPositionAt( p, 2 ); // \"oo\", img are in range.\r\n\t *\t\tlet transformed = range.getIntersection( otherRange ); // range from ( foo, 1 ) to ( p, 2 ).\r\n\t *\r\n\t *\t\totherRange = view.createRange( view.createPositionAt( bar, 1 ), view.createPositionAt( bar, 3 ); \"ar\" is in range.\r\n\t *\t\ttransformed = range.getIntersection( otherRange ); // null - no common part.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} otherRange Range to check for intersection.\r\n\t * @returns {module:engine/view/range~Range|null} A common part of given ranges or `null` if ranges have no common part.\r\n\t */\r\n\tgetIntersection( otherRange ) {\r\n\t\tif ( this.isIntersecting( otherRange ) ) {\r\n\t\t\t// Ranges intersect, so a common range will be returned.\r\n\t\t\t// At most, it will be same as this range.\r\n\t\t\tlet commonRangeStart = this.start;\r\n\t\t\tlet commonRangeEnd = this.end;\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.start ) ) {\r\n\t\t\t\t// Given range start is inside this range. This means thaNt we have to\r\n\t\t\t\t// shrink common range to the given range start.\r\n\t\t\t\tcommonRangeStart = otherRange.start;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.end ) ) {\r\n\t\t\t\t// Given range end is inside this range. This means that we have to\r\n\t\t\t\t// shrink common range to the given range end.\r\n\t\t\t\tcommonRangeEnd = otherRange.end;\r\n\t\t\t}\r\n\r\n\t\t\treturn new Range( commonRangeStart, commonRangeEnd );\r\n\t\t}\r\n\r\n\t\t// Ranges do not intersect, so they do not have common part.\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/view/treewalker~TreeWalker TreeWalker} instance with this range as a boundary.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/view/treewalker~TreeWalker}.\r\n\t * @param {module:engine/view/position~Position} [options.startPosition]\r\n\t * @param {Boolean} [options.singleCharacters=false]\r\n\t * @param {Boolean} [options.shallow=false]\r\n\t * @param {Boolean} [options.ignoreElementEnd=false]\r\n\t * @returns {module:engine/view/treewalker~TreeWalker}\r\n\t */\r\n\tgetWalker( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\r\n\t\treturn new TreeWalker( options );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a {@link module:engine/view/node~Node} or {@link module:engine/view/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of range's both ends (in which the entire range is contained).\r\n\t *\r\n\t * @returns {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor() {\r\n\t\treturn this.start.getCommonAncestor( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Clones this range.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tclone() {\r\n\t\treturn new Range( this.start, this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all {@link module:engine/view/item~Item view items} that are in this range and returns\r\n\t * them.\r\n\t *\r\n\t * This method uses {@link module:engine/view/treewalker~TreeWalker} with `boundaries` set to this range and `ignoreElementEnd` option\r\n\t * set to `true`. However it returns only {@link module:engine/view/item~Item items},\r\n\t * not {@link module:engine/view/treewalker~TreeWalkerValue}.\r\n\t *\r\n\t * You may specify additional options for the tree walker. See {@link module:engine/view/treewalker~TreeWalker} for\r\n\t * a full list of available options.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/view/treewalker~TreeWalker}.\r\n\t * @returns {Iterable.<module:engine/view/item~Item>}\r\n\t */\r\n\t* getItems( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\t\toptions.ignoreElementEnd = true;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\r\n\t\tfor ( const value of treeWalker ) {\r\n\t\t\tyield value.item;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all {@link module:engine/view/position~Position positions} that are boundaries or\r\n\t * contained in this range.\r\n\t *\r\n\t * This method uses {@link module:engine/view/treewalker~TreeWalker} with `boundaries` set to this range. However it returns only\r\n\t * {@link module:engine/view/position~Position positions}, not {@link module:engine/view/treewalker~TreeWalkerValue}.\r\n\t *\r\n\t * You may specify additional options for the tree walker. See {@link module:engine/view/treewalker~TreeWalker} for\r\n\t * a full list of available options.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/view/treewalker~TreeWalker}.\r\n\t * @returns {Iterable.<module:engine/view/position~Position>}\r\n\t */\r\n\t* getPositions( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\r\n\t\tyield treeWalker.position;\r\n\r\n\t\tfor ( const value of treeWalker ) {\r\n\t\t\tyield value.nextPosition;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks and returns whether this range intersects with the given range.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} otherRange Range to compare with.\r\n\t * @returns {Boolean} True if ranges intersect.\r\n\t */\r\n\tisIntersecting( otherRange ) {\r\n\t\treturn this.start.isBefore( otherRange.end ) && this.end.isAfter( otherRange.start );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range from the given parents and offsets.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} startElement Start position\r\n\t * parent element.\r\n\t * @param {Number} startOffset Start position offset.\r\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} endElement End position\r\n\t * parent element.\r\n\t * @param {Number} endOffset End position offset.\r\n\t * @returns {module:engine/view/range~Range} Created range.\r\n\t */\r\n\tstatic _createFromParentsAndOffsets( startElement, startOffset, endElement, endOffset ) {\r\n\t\treturn new this(\r\n\t\t\tnew Position( startElement, startOffset ),\r\n\t\t\tnew Position( endElement, endOffset )\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new range, spreading from specified {@link module:engine/view/position~Position position} to a position moved by\r\n\t * given `shift`. If `shift` is a negative value, shifted position is treated as the beginning of the range.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/position~Position} position Beginning of the range.\r\n\t * @param {Number} shift How long the range should be.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tstatic _createFromPositionAndShift( position, shift ) {\r\n\t\tconst start = position;\r\n\t\tconst end = position.getShiftedBy( shift );\r\n\r\n\t\treturn shift > 0 ? new this( start, end ) : new this( end, start );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tstatic _createIn( element ) {\r\n\t\treturn this._createFromParentsAndOffsets( element, 0, element, element.childCount );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before given {@link module:engine/view/item~Item view item} and ends after it.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/item~Item} item\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tstatic _createOn( item ) {\r\n\t\tconst size = item.is( 'textProxy' ) ? item.offsetSize : 1;\r\n\r\n\t\treturn this._createFromPositionAndShift( Position._createBefore( item ), size );\r\n\t}\r\n}\r\n\r\n// Function used by getEnlarged and getTrimmed methods.\r\nfunction enlargeTrimSkip( value ) {\r\n\tif ( value.item.is( 'attributeElement' ) || value.item.is( 'uiElement' ) ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/count\r\n */\r\n\r\n/**\r\n * Returns the number of items return by the iterator.\r\n *\r\n *\t\tcount( [ 1, 2, 3, 4, 5 ] ); // 5;\r\n *\r\n * @param {Iterable.<*>} iterator Any iterator.\r\n * @returns {Number} Number of items returned by that iterator.\r\n */\r\nexport default function count( iterator ) {\r\n\tlet count = 0;\r\n\r\n\tfor ( const _ of iterator ) { // eslint-disable-line no-unused-vars\r\n\t\tcount++;\r\n\t}\r\n\r\n\treturn count;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/selection\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport Range from './range';\r\nimport Position from './position';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport Node from './node';\r\nimport Element from './element';\r\nimport count from '@ckeditor/ckeditor5-utils/src/count';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\nimport DocumentSelection from './documentselection';\r\n\r\n/**\r\n * Class representing an arbirtary selection in the view.\r\n * See also {@link module:engine/view/documentselection~DocumentSelection}.\r\n *\r\n * New selection instances can be created via the constructor or one these methods:\r\n *\r\n * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\r\n * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\r\n *\r\n * A selection can consist of {@link module:engine/view/range~Range ranges} that can be set by using\r\n * the {@link module:engine/view/selection~Selection#setTo `Selection#setTo()`} method.\r\n */\r\nexport default class Selection {\r\n\t/**\r\n\t * Creates new selection instance.\r\n\t *\r\n\t * **Note**: The selection constructor is available as a factory method:\r\n\t *\r\n\t * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\r\n\t * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\r\n\t *\r\n\t * \t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = writer.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = writer.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = writer.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = writer.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the document selection.\r\n\t *\t\tconst selection = writer.createSelection( editor.editing.view.document.selection );\r\n\t *\r\n\t * \t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = writer.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\r\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\r\n\t *\r\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tconst selection = writer.createSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection|\r\n\t * module:engine/view/position~Position|Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} [selectable=null]\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t */\r\n\tconstructor( selectable = null, placeOrOffset, options ) {\r\n\t\t/**\r\n\t\t * Stores all ranges that are selected.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Array.<module:engine/view/range~Range>}\r\n\t\t */\r\n\t\tthis._ranges = [];\r\n\r\n\t\t/**\r\n\t\t * Specifies whether the last added range was added as a backward or forward range.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._lastRangeBackward = false;\r\n\r\n\t\t/**\r\n\t\t * Specifies whether selection instance is fake.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._isFake = false;\r\n\r\n\t\t/**\r\n\t\t * Fake selection's label.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis._fakeSelectionLabel = '';\r\n\r\n\t\tthis.setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if selection instance is marked as `fake`.\r\n\t *\r\n\t * @see #setTo\r\n\t * @returns {Boolean}\r\n\t */\r\n\tget isFake() {\r\n\t\treturn this._isFake;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns fake selection label.\r\n\t *\r\n\t * @see #setTo\r\n\t * @returns {String}\r\n\t */\r\n\tget fakeSelectionLabel() {\r\n\t\treturn this._fakeSelectionLabel;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection anchor. Anchor may be described as a position where the selection starts. Together with\r\n\t * {@link #focus focus} they define the direction of selection, which is important\r\n\t * when expanding/shrinking selection. Anchor is always the start or end of the most recent added range.\r\n\t * It may be a bit unintuitive when there are multiple ranges in selection.\r\n\t *\r\n\t * @see #focus\r\n\t * @type {module:engine/view/position~Position}\r\n\t */\r\n\tget anchor() {\r\n\t\tif ( !this._ranges.length ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\r\n\t\tconst anchor = this._lastRangeBackward ? range.end : range.start;\r\n\r\n\t\treturn anchor.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * Selection focus. Focus is a position where the selection ends.\r\n\t *\r\n\t * @see #anchor\r\n\t * @type {module:engine/view/position~Position}\r\n\t */\r\n\tget focus() {\r\n\t\tif ( !this._ranges.length ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\r\n\t\tconst focus = this._lastRangeBackward ? range.start : range.end;\r\n\r\n\t\treturn focus.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the selection is collapsed. Selection is collapsed when there is exactly one range which is\r\n\t * collapsed.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\treturn this.rangeCount === 1 && this._ranges[ 0 ].isCollapsed;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns number of ranges in selection.\r\n\t *\r\n\t * @type {Number}\r\n\t */\r\n\tget rangeCount() {\r\n\t\treturn this._ranges.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies whether the {@link #focus} precedes {@link #anchor}.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isBackward() {\r\n\t\treturn !this.isCollapsed && this._lastRangeBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/editableelement~EditableElement EditableElement} instance that contains this selection, or `null`\r\n\t * if the selection is not inside an editable element.\r\n\t *\r\n\t * @type {module:engine/view/editableelement~EditableElement|null}\r\n\t */\r\n\tget editableElement() {\r\n\t\tif ( this.anchor ) {\r\n\t\t\treturn this.anchor.editableElement;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterable that contains copies of all ranges added to the selection.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/range~Range>}\r\n\t */\r\n\t* getRanges() {\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tyield range.clone();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the first range in the selection. First range is the one which\r\n\t * {@link module:engine/view/range~Range#start start} position {@link module:engine/view/position~Position#isBefore is before} start\r\n\t * position of all other ranges (not to confuse with the first range added to the selection).\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range|null}\r\n\t */\r\n\tgetFirstRange() {\r\n\t\tlet first = null;\r\n\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tif ( !first || range.start.isBefore( first.start ) ) {\r\n\t\t\t\tfirst = range;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn first ? first.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the last range in the selection. Last range is the one which {@link module:engine/view/range~Range#end end}\r\n\t * position {@link module:engine/view/position~Position#isAfter is after} end position of all other ranges (not to confuse\r\n\t * with the last range added to the selection). Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range|null}\r\n\t */\r\n\tgetLastRange() {\r\n\t\tlet last = null;\r\n\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tif ( !last || range.end.isAfter( last.end ) ) {\r\n\t\t\t\tlast = range;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn last ? last.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the first position in the selection. First position is the position that\r\n\t * {@link module:engine/view/position~Position#isBefore is before} any other position in the selection ranges.\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/position~Position|null}\r\n\t */\r\n\tgetFirstPosition() {\r\n\t\tconst firstRange = this.getFirstRange();\r\n\r\n\t\treturn firstRange ? firstRange.start.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the last position in the selection. Last position is the position that\r\n\t * {@link module:engine/view/position~Position#isAfter is after} any other position in the selection ranges.\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/position~Position|null}\r\n\t */\r\n\tgetLastPosition() {\r\n\t\tconst lastRange = this.getLastRange();\r\n\r\n\t\treturn lastRange ? lastRange.end.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether, this selection is equal to given selection. Selections are equal if they have same directions,\r\n\t * same number of ranges and all ranges from one selection equal to a range from other selection.\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\r\n\t * Selection to compare with.\r\n\t * @returns {Boolean} `true` if selections are equal, `false` otherwise.\r\n\t */\r\n\tisEqual( otherSelection ) {\r\n\t\tif ( this.isFake != otherSelection.isFake ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( this.isFake && this.fakeSelectionLabel != otherSelection.fakeSelectionLabel ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( this.rangeCount != otherSelection.rangeCount ) {\r\n\t\t\treturn false;\r\n\t\t} else if ( this.rangeCount === 0 ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif ( !this.anchor.isEqual( otherSelection.anchor ) || !this.focus.isEqual( otherSelection.focus ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor ( const thisRange of this._ranges ) {\r\n\t\t\tlet found = false;\r\n\r\n\t\t\tfor ( const otherRange of otherSelection._ranges ) {\r\n\t\t\t\tif ( thisRange.isEqual( otherRange ) ) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( !found ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this selection is similar to given selection. Selections are similar if they have same directions, same\r\n\t * number of ranges, and all {@link module:engine/view/range~Range#getTrimmed trimmed} ranges from one selection are\r\n\t * equal to any trimmed range from other selection.\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\r\n\t * Selection to compare with.\r\n\t * @returns {Boolean} `true` if selections are similar, `false` otherwise.\r\n\t */\r\n\tisSimilar( otherSelection ) {\r\n\t\tif ( this.isBackward != otherSelection.isBackward ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst numOfRangesA = count( this.getRanges() );\r\n\t\tconst numOfRangesB = count( otherSelection.getRanges() );\r\n\r\n\t\t// If selections have different number of ranges, they cannot be similar.\r\n\t\tif ( numOfRangesA != numOfRangesB ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If both selections have no ranges, they are similar.\r\n\t\tif ( numOfRangesA == 0 ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Check if each range in one selection has a similar range in other selection.\r\n\t\tfor ( let rangeA of this.getRanges() ) {\r\n\t\t\trangeA = rangeA.getTrimmed();\r\n\r\n\t\t\tlet found = false;\r\n\r\n\t\t\tfor ( let rangeB of otherSelection.getRanges() ) {\r\n\t\t\t\trangeB = rangeB.getTrimmed();\r\n\r\n\t\t\t\tif ( rangeA.start.isEqual( rangeB.start ) && rangeA.end.isEqual( rangeB.end ) ) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// For `rangeA`, neither range in `otherSelection` was similar. So selections are not similar.\r\n\t\t\tif ( !found ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// There were no ranges that weren't matched. Selections are similar.\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the selected element. {@link module:engine/view/element~Element Element} is considered as selected if there is only\r\n\t * one range in the selection, and that range contains exactly one element.\r\n\t * Returns `null` if there is no selected element.\r\n\t *\r\n\t * @returns {module:engine/view/element~Element|null}\r\n\t */\r\n\tgetSelectedElement() {\r\n\t\tif ( this.rangeCount !== 1 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst range = this.getFirstRange();\r\n\t\tconst nodeAfterStart = range.start.nodeAfter;\r\n\t\tconst nodeBeforeEnd = range.end.nodeBefore;\r\n\r\n\t\treturn ( nodeAfterStart instanceof Element && nodeAfterStart == nodeBeforeEnd ) ? nodeAfterStart : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets this selection's ranges and direction to the specified location based on the given\r\n\t * {@link module:engine/view/documentselection~DocumentSelection document selection},\r\n\t * {@link module:engine/view/selection~Selection selection}, {@link module:engine/view/position~Position position},\r\n\t * {@link module:engine/view/item~Item item}, {@link module:engine/view/range~Range range},\r\n\t * an iterable of {@link module:engine/view/range~Range ranges} or null.\r\n\t *\r\n\t *\t\t// Sets selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tselection.setTo( range );\r\n\t *\r\n\t *\t\t// Sets selection to given ranges.\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tselection.setTo( range );\r\n\t *\r\n\t *\t\t// Sets selection to the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tselection.setTo( otherSelection );\r\n\t *\r\n\t *\t \t// Sets selection to contents of DocumentSelection.\r\n\t *\t\tselection.setTo( editor.editing.view.document.selection );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the given position.\r\n\t *\t\tconst position = writer.createPositionAt( root, path );\r\n\t *\t\tselection.setTo( position );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the position of given item and offset.\r\n\t *\t\tselection.setTo( paragraph, offset );\r\n\t *\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t *\t\tselection.setTo( paragraph, 'in' );\r\n\t *\r\n\t * Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends just after the item.\r\n\t *\r\n\t *\t\tselection.setTo( paragraph, 'on' );\r\n\t *\r\n\t * \t\t// Clears selection. Removes all ranges.\r\n\t *\t\tselection.setTo( null );\r\n\t *\r\n\t * `Selection#setTo()` method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Sets selection as backward.\r\n\t *\t\tselection.setTo( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tselection.setTo( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @fires change\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection|\r\n\t * module:engine/view/position~Position|Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t */\r\n\tsetTo( selectable, placeOrOffset, options ) {\r\n\t\tif ( selectable === null ) {\r\n\t\t\tthis._setRanges( [] );\r\n\t\t\tthis._setFakeOptions( placeOrOffset );\r\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\r\n\t\t\tthis._setRanges( selectable.getRanges(), selectable.isBackward );\r\n\t\t\tthis._setFakeOptions( { fake: selectable.isFake, label: selectable.fakeSelectionLabel } );\r\n\t\t} else if ( selectable instanceof Range ) {\r\n\t\t\tthis._setRanges( [ selectable ], placeOrOffset && placeOrOffset.backward );\r\n\t\t\tthis._setFakeOptions( placeOrOffset );\r\n\t\t} else if ( selectable instanceof Position ) {\r\n\t\t\tthis._setRanges( [ new Range( selectable ) ] );\r\n\t\t\tthis._setFakeOptions( placeOrOffset );\r\n\t\t} else if ( selectable instanceof Node ) {\r\n\t\t\tconst backward = !!options && !!options.backward;\r\n\t\t\tlet range;\r\n\r\n\t\t\tif ( placeOrOffset === undefined ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * selection.setTo requires the second parameter when the first parameter is a node.\r\n\t\t\t\t *\r\n\t\t\t\t * @error view-selection-setTo-required-second-parameter\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'view-selection-setTo-required-second-parameter: ' +\r\n\t\t\t\t\t'selection.setTo requires the second parameter when the first parameter is a node.'\r\n\t\t\t\t);\r\n\t\t\t} else if ( placeOrOffset == 'in' ) {\r\n\t\t\t\trange = Range._createIn( selectable );\r\n\t\t\t} else if ( placeOrOffset == 'on' ) {\r\n\t\t\t\trange = Range._createOn( selectable );\r\n\t\t\t} else {\r\n\t\t\t\trange = new Range( Position._createAt( selectable, placeOrOffset ) );\r\n\t\t\t}\r\n\r\n\t\t\tthis._setRanges( [ range ], backward );\r\n\t\t\tthis._setFakeOptions( options );\r\n\t\t} else if ( isIterable( selectable ) ) {\r\n\t\t\t// We assume that the selectable is an iterable of ranges.\r\n\t\t\t// Array.from() is used to prevent setting ranges to the old iterable\r\n\t\t\tthis._setRanges( selectable, placeOrOffset && placeOrOffset.backward );\r\n\t\t\tthis._setFakeOptions( placeOrOffset );\r\n\t\t} else {\r\n\t\t\t/**\r\n\t\t\t * Cannot set selection to given place.\r\n\t\t\t *\r\n\t\t\t * @error view-selection-setTo-not-selectable\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-selection-setTo-not-selectable: Cannot set selection to given place.' );\r\n\t\t}\r\n\r\n\t\tthis.fire( 'change' );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link #focus} to the specified location.\r\n\t *\r\n\t * The location can be specified in the same form as {@link module:engine/view/view~View#createPositionAt view.createPositionAt()}\r\n\t * parameters.\r\n\t *\r\n\t * @fires change\r\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tsetFocus( itemOrPosition, offset ) {\r\n\t\tif ( this.anchor === null ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot set selection focus if there are no ranges in selection.\r\n\t\t\t *\r\n\t\t\t * @error view-selection-setFocus-no-ranges\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'view-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst newFocus = Position._createAt( itemOrPosition, offset );\r\n\r\n\t\tif ( newFocus.compareWith( this.focus ) == 'same' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst anchor = this.anchor;\r\n\r\n\t\tthis._ranges.pop();\r\n\r\n\t\tif ( newFocus.compareWith( anchor ) == 'before' ) {\r\n\t\t\tthis._addRange( new Range( newFocus, anchor ), true );\r\n\t\t} else {\r\n\t\t\tthis._addRange( new Range( anchor, newFocus ) );\r\n\t\t}\r\n\r\n\t\tthis.fire( 'change' );\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces all ranges that were added to the selection with given array of ranges. Last range of the array\r\n\t * is treated like the last added range and is used to set {@link #anchor anchor} and {@link #focus focus}.\r\n\t * Accepts a flag describing in which way the selection is made.\r\n\t *\r\n\t * @private\r\n\t * @param {Iterable.<module:engine/view/range~Range>} newRanges Iterable object of ranges to set.\r\n\t * @param {Boolean} [isLastBackward=false] Flag describing if last added range was selected forward - from start to end\r\n\t * (`false`) or backward - from end to start (`true`). Defaults to `false`.\r\n\t */\r\n\t_setRanges( newRanges, isLastBackward = false ) {\r\n\t\t// New ranges should be copied to prevent removing them by setting them to `[]` first.\r\n\t\t// Only applies to situations when selection is set to the same selection or same selection's ranges.\r\n\t\tnewRanges = Array.from( newRanges );\r\n\r\n\t\tthis._ranges = [];\r\n\r\n\t\tfor ( const range of newRanges ) {\r\n\t\t\tthis._addRange( range );\r\n\t\t}\r\n\r\n\t\tthis._lastRangeBackward = !!isLastBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets this selection instance to be marked as `fake`. A fake selection does not render as browser native selection\r\n\t * over selected elements and is hidden to the user. This way, no native selection UI artifacts are displayed to\r\n\t * the user and selection over elements can be represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM (and be\r\n\t * properly handled by screen readers).\r\n\t *\r\n\t * @private\r\n\t * @param {Object} [options] Options.\r\n\t * @param {Boolean} [options.fake] If set to true selection will be marked as `fake`.\r\n\t * @param {String} [options.label=''] Fake selection label.\r\n\t */\r\n\t_setFakeOptions( options = {} ) {\r\n\t\tthis._isFake = !!options.fake;\r\n\t\tthis._fakeSelectionLabel = options.fake ? options.label || '' : '';\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a range to the selection. Added range is copied. This means that passed range is not saved in the\r\n\t * selection instance and you can safely operate on it.\r\n\t *\r\n\t * Accepts a flag describing in which way the selection is made - passed range might be selected from\r\n\t * {@link module:engine/view/range~Range#start start} to {@link module:engine/view/range~Range#end end}\r\n\t * or from {@link module:engine/view/range~Range#end end} to {@link module:engine/view/range~Range#start start}.\r\n\t * The flag is used to set {@link #anchor anchor} and {@link #focus focus} properties.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\r\n\t * with ranges already stored in Selection instance.\r\n\t *\r\n\t * @private\r\n\t * @fires change\r\n\t * @param {module:engine/view/range~Range} range\r\n\t * @param {Boolean} [isBackward]\r\n\t */\r\n\t_addRange( range, isBackward = false ) {\r\n\t\tif ( !( range instanceof Range ) ) {\r\n\t\t\t/**\r\n\t\t\t * Selection range set to an object that is not an instance of {@link module:engine/view/range~Range}.\r\n\t\t\t *\r\n\t\t\t * @error view-selection-add-range-not-range\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'view-selection-add-range-not-range: ' +\r\n\t\t\t\t'Selection range set to an object that is not an instance of view.Range'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis._pushRange( range );\r\n\t\tthis._lastRangeBackward = !!isBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds range to selection - creates copy of given range so it can be safely used and modified.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\r\n\t * with ranges already stored in selection instance.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/range~Range} range\r\n\t */\r\n\t_pushRange( range ) {\r\n\t\tfor ( const storedRange of this._ranges ) {\r\n\t\t\tif ( range.isIntersecting( storedRange ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Trying to add a range that intersects with another range from selection.\r\n\t\t\t\t *\r\n\t\t\t\t * @error view-selection-range-intersects\r\n\t\t\t\t * @param {module:engine/view/range~Range} addedRange Range that was added to the selection.\r\n\t\t\t\t * @param {module:engine/view/range~Range} intersectingRange Range from selection that intersects with `addedRange`.\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'view-selection-range-intersects: Trying to add a range that intersects with another range from selection.',\r\n\t\t\t\t\t{ addedRange: range, intersectingRange: storedRange }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._ranges.push( new Range( range.start, range.end ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Fired whenever selection ranges are changed through {@link ~Selection Selection API}.\r\n\t *\r\n\t * @event change\r\n\t */\r\n}\r\n\r\nmix( Selection, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/documentselection\r\n */\r\n\r\nimport Selection from './selection';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\n\r\n/**\r\n * Class representing the document selection in the view.\r\n *\r\n * Its instance is available in {@link module:engine/view/document~Document#selection `Document#selection`}.\r\n *\r\n * It is similar to {@link module:engine/view/selection~Selection} but\r\n * it has a read-only API and can be modified only by the writer available in\r\n * the {@link module:engine/view/view~View#change `View#change()`} block\r\n * (so via {@link module:engine/view/downcastwriter~DowncastWriter#setSelection `DowncastWriter#setSelection()`}).\r\n */\r\nexport default class DocumentSelection {\r\n\t/**\r\n\t * Creates new DocumentSelection instance.\r\n\t *\r\n\t * \t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = new DocumentSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = new DocumentSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( start2, end2 ) ];\r\n\t *\t\tconst selection = new DocumentSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = new DocumentSelection( otherSelection );\r\n\t *\r\n\t * \t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionAt( root, offset );\r\n\t *\t\tconst selection = new DocumentSelection( position );\r\n\t *\r\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\r\n\t *\t\tconst selection = new DocumentSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = new DocumentSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = new DocumentSelection( paragraph, 'on' );\r\n\t *\r\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = new DocumentSelection( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tconst selection = new DocumentSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/position~Position|\r\n\t * Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} [selectable=null]\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t */\r\n\tconstructor( selectable = null, placeOrOffset, options ) {\r\n\t\t/**\r\n\t\t * Selection is used internally (`DocumentSelection` is a proxy to that selection).\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/selection~Selection}\r\n\t\t */\r\n\t\tthis._selection = new Selection();\r\n\r\n\t\t// Delegate change event to be fired on DocumentSelection instance.\r\n\t\tthis._selection.delegate( 'change' ).to( this );\r\n\r\n\t\t// Set selection data.\r\n\t\tthis._selection.setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if selection instance is marked as `fake`.\r\n\t *\r\n\t * @see #_setTo\r\n\t * @returns {Boolean}\r\n\t */\r\n\tget isFake() {\r\n\t\treturn this._selection.isFake;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns fake selection label.\r\n\t *\r\n\t * @see #_setTo\r\n\t * @returns {String}\r\n\t */\r\n\tget fakeSelectionLabel() {\r\n\t\treturn this._selection.fakeSelectionLabel;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection anchor. Anchor may be described as a position where the selection starts. Together with\r\n\t * {@link #focus focus} they define the direction of selection, which is important\r\n\t * when expanding/shrinking selection. Anchor is always the start or end of the most recent added range.\r\n\t * It may be a bit unintuitive when there are multiple ranges in selection.\r\n\t *\r\n\t * @see #focus\r\n\t * @type {module:engine/view/position~Position}\r\n\t */\r\n\tget anchor() {\r\n\t\treturn this._selection.anchor;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection focus. Focus is a position where the selection ends.\r\n\t *\r\n\t * @see #anchor\r\n\t * @type {module:engine/view/position~Position}\r\n\t */\r\n\tget focus() {\r\n\t\treturn this._selection.focus;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the selection is collapsed. Selection is collapsed when there is exactly one range which is\r\n\t * collapsed.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\treturn this._selection.isCollapsed;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns number of ranges in selection.\r\n\t *\r\n\t * @type {Number}\r\n\t */\r\n\tget rangeCount() {\r\n\t\treturn this._selection.rangeCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies whether the {@link #focus} precedes {@link #anchor}.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isBackward() {\r\n\t\treturn this._selection.isBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/editableelement~EditableElement EditableElement} instance that contains this selection, or `null`\r\n\t * if the selection is not inside an editable element.\r\n\t *\r\n\t * @type {module:engine/view/editableelement~EditableElement|null}\r\n\t */\r\n\tget editableElement() {\r\n\t\treturn this._selection.editableElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Used for the compatibility with the {@link module:engine/view/selection~Selection#isEqual} method.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tget _ranges() {\r\n\t\treturn this._selection._ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterable that contains copies of all ranges added to the selection.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/range~Range>}\r\n\t */\r\n\t* getRanges() {\r\n\t\tyield* this._selection.getRanges();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the first range in the selection. First range is the one which\r\n\t * {@link module:engine/view/range~Range#start start} position {@link module:engine/view/position~Position#isBefore is before} start\r\n\t * position of all other ranges (not to confuse with the first range added to the selection).\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range|null}\r\n\t */\r\n\tgetFirstRange() {\r\n\t\treturn this._selection.getFirstRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the last range in the selection. Last range is the one which {@link module:engine/view/range~Range#end end}\r\n\t * position {@link module:engine/view/position~Position#isAfter is after} end position of all other ranges (not to confuse\r\n\t * with the last range added to the selection). Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/range~Range|null}\r\n\t */\r\n\tgetLastRange() {\r\n\t\treturn this._selection.getLastRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the first position in the selection. First position is the position that\r\n\t * {@link module:engine/view/position~Position#isBefore is before} any other position in the selection ranges.\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/position~Position|null}\r\n\t */\r\n\tgetFirstPosition() {\r\n\t\treturn this._selection.getFirstPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns copy of the last position in the selection. Last position is the position that\r\n\t * {@link module:engine/view/position~Position#isAfter is after} any other position in the selection ranges.\r\n\t * Returns `null` if no ranges are added to selection.\r\n\t *\r\n\t * @returns {module:engine/view/position~Position|null}\r\n\t */\r\n\tgetLastPosition() {\r\n\t\treturn this._selection.getLastPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the selected element. {@link module:engine/view/element~Element Element} is considered as selected if there is only\r\n\t * one range in the selection, and that range contains exactly one element.\r\n\t * Returns `null` if there is no selected element.\r\n\t *\r\n\t * @returns {module:engine/view/element~Element|null}\r\n\t */\r\n\tgetSelectedElement() {\r\n\t\treturn this._selection.getSelectedElement();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether, this selection is equal to given selection. Selections are equal if they have same directions,\r\n\t * same number of ranges and all ranges from one selection equal to a range from other selection.\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\r\n\t * Selection to compare with.\r\n\t * @returns {Boolean} `true` if selections are equal, `false` otherwise.\r\n\t */\r\n\tisEqual( otherSelection ) {\r\n\t\treturn this._selection.isEqual( otherSelection );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this selection is similar to given selection. Selections are similar if they have same directions, same\r\n\t * number of ranges, and all {@link module:engine/view/range~Range#getTrimmed trimmed} ranges from one selection are\r\n\t * equal to any trimmed range from other selection.\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\r\n\t * Selection to compare with.\r\n\t * @returns {Boolean} `true` if selections are similar, `false` otherwise.\r\n\t */\r\n\tisSimilar( otherSelection ) {\r\n\t\treturn this._selection.isSimilar( otherSelection );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets this selection's ranges and direction to the specified location based on the given\r\n\t * {@link module:engine/view/documentselection~DocumentSelection document selection},\r\n\t * {@link module:engine/view/selection~Selection selection}, {@link module:engine/view/position~Position position},\r\n\t * {@link module:engine/view/item~Item item}, {@link module:engine/view/range~Range range},\r\n\t * an iterable of {@link module:engine/view/range~Range ranges} or null.\r\n\t *\r\n\t *\t\t// Sets selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tdocumentSelection._setTo( range );\r\n\t *\r\n\t *\t\t// Sets selection to given ranges.\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( start2, end2 ) ];\r\n\t *\t\tdocumentSelection._setTo( range );\r\n\t *\r\n\t *\t\t// Sets selection to the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tdocumentSelection._setTo( otherSelection );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the given position.\r\n\t *\t\tconst position = writer.createPositionAt( root, offset );\r\n\t *\t\tdocumentSelection._setTo( position );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the position of given item and offset.\r\n\t *\t\tdocumentSelection._setTo( paragraph, offset );\r\n\t *\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t *\t\tdocumentSelection._setTo( paragraph, 'in' );\r\n\t *\r\n\t * Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends just after the item.\r\n\t *\r\n\t *\t\tdocumentSelection._setTo( paragraph, 'on' );\r\n\t *\r\n\t * \t\t// Clears selection. Removes all ranges.\r\n\t *\t\tdocumentSelection._setTo( null );\r\n\t *\r\n\t * `Selection#_setTo()` method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Sets selection as backward.\r\n\t *\t\tdocumentSelection._setTo( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to des cribe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tdocumentSelection._setTo( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @protected\r\n\t * @fires change\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/position~Position|\r\n\t * Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|module:engine/view/item~Item|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t */\r\n\t_setTo( selectable, placeOrOffset, options ) {\r\n\t\tthis._selection.setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link #focus} to the specified location.\r\n\t *\r\n\t * The location can be specified in the same form as {@link module:engine/view/view~View#createPositionAt view.createPositionAt()}\r\n\t * parameters.\r\n\t *\r\n\t * @protected\r\n\t * @fires change\r\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\t_setFocus( itemOrPosition, offset ) {\r\n\t\tthis._selection.setFocus( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Fired whenever selection ranges are changed through {@link ~DocumentSelection Selection API}.\r\n\t *\r\n\t * @event change\r\n\t */\r\n}\r\n\r\nmix( DocumentSelection, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/collection\r\n */\r\n\r\nimport EmitterMixin from './emittermixin';\r\nimport CKEditorError from './ckeditorerror';\r\nimport uid from './uid';\r\nimport mix from './mix';\r\n\r\n/**\r\n * Collections are ordered sets of objects. Items in the collection can be retrieved by their indexes\r\n * in the collection (like in an array) or by their ids.\r\n *\r\n * If an object without an `id` property is being added to the collection, the `id` property will be generated\r\n * automatically. Note that the automatically generated id is unique only within this single collection instance.\r\n *\r\n * By default an item in the collection is identified by its `id` property. The name of the identifier can be\r\n * configured through the constructor of the collection.\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class Collection {\r\n\t/**\r\n\t * Creates a new Collection instance.\r\n\t *\r\n\t * @param {Object} [options={}] The options object.\r\n\t * @param {String} [options.idProperty='id'] The name of the property which is considered to identify an item.\r\n\t */\r\n\tconstructor( options = {} ) {\r\n\t\t/**\r\n\t\t * The internal list of items in the collection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object[]}\r\n\t\t */\r\n\t\tthis._items = [];\r\n\r\n\t\t/**\r\n\t\t * The internal map of items in the collection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._itemMap = new Map();\r\n\r\n\t\t/**\r\n\t\t * The name of the property which is considered to identify an item.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis._idProperty = options.idProperty || 'id';\r\n\r\n\t\t/**\r\n\t\t * A helper mapping external items of a bound collection ({@link #bindTo})\r\n\t\t * and actual items of this collection. It provides information\r\n\t\t * necessary to properly remove items bound to another collection.\r\n\t\t *\r\n\t\t * See {@link #_bindToInternalToExternalMap}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {WeakMap}\r\n\t\t */\r\n\t\tthis._bindToExternalToInternalMap = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * A helper mapping items of this collection to external items of a bound collection\r\n\t\t * ({@link #bindTo}). It provides information necessary to manage the bindings, e.g.\r\n\t\t * to avoid loops in two–way bindings.\r\n\t\t *\r\n\t\t * See {@link #_bindToExternalToInternalMap}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {WeakMap}\r\n\t\t */\r\n\t\tthis._bindToInternalToExternalMap = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * Stores indexes of skipped items from bound external collection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Array}\r\n\t\t */\r\n\t\tthis._skippedIndexesFromExternal = [];\r\n\r\n\t\t/**\r\n\t\t * A collection instance this collection is bound to as a result\r\n\t\t * of calling {@link #bindTo} method.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:utils/collection~Collection} #_bindToCollection\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * The number of items available in the collection.\r\n\t *\r\n\t * @member {Number} #length\r\n\t */\r\n\tget length() {\r\n\t\treturn this._items.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first item from the collection or null when collection is empty.\r\n\t *\r\n\t * @returns {Object|null} The first item or `null` if collection is empty.\r\n\t */\r\n\tget first() {\r\n\t\treturn this._items[ 0 ] || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the last item from the collection or null when collection is empty.\r\n\t *\r\n\t * @returns {Object|null} The last item or `null` if collection is empty.\r\n\t */\r\n\tget last() {\r\n\t\treturn this._items[ this.length - 1 ] || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an item into the collection.\r\n\t *\r\n\t * If the item does not have an id, then it will be automatically generated and set on the item.\r\n\t *\r\n\t * @chainable\r\n\t * @param {Object} item\r\n\t * @param {Number} [index] The position of the item in the collection. The item\r\n\t * is pushed to the collection when `index` not specified.\r\n\t * @fires add\r\n\t */\r\n\tadd( item, index ) {\r\n\t\tlet itemId;\r\n\t\tconst idProperty = this._idProperty;\r\n\r\n\t\tif ( ( idProperty in item ) ) {\r\n\t\t\titemId = item[ idProperty ];\r\n\r\n\t\t\tif ( typeof itemId != 'string' ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * This item's id should be a string.\r\n\t\t\t\t *\r\n\t\t\t\t * @error collection-add-invalid-id\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'collection-add-invalid-id' );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.get( itemId ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * This item already exists in the collection.\r\n\t\t\t\t *\r\n\t\t\t\t * @error collection-add-item-already-exists\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'collection-add-item-already-exists' );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\titem[ idProperty ] = itemId = uid();\r\n\t\t}\r\n\r\n\t\t// TODO: Use ES6 default function argument.\r\n\t\tif ( index === undefined ) {\r\n\t\t\tindex = this._items.length;\r\n\t\t} else if ( index > this._items.length || index < 0 ) {\r\n\t\t\t/**\r\n\t\t\t * The index number has invalid value.\r\n\t\t\t *\r\n\t\t\t * @error collection-add-item-bad-index\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'collection-add-item-invalid-index' );\r\n\t\t}\r\n\r\n\t\tthis._items.splice( index, 0, item );\r\n\r\n\t\tthis._itemMap.set( itemId, item );\r\n\r\n\t\tthis.fire( 'add', item, index );\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets item by its id or index.\r\n\t *\r\n\t * @param {String|Number} idOrIndex The item id or index in the collection.\r\n\t * @returns {Object|null} The requested item or `null` if such item does not exist.\r\n\t */\r\n\tget( idOrIndex ) {\r\n\t\tlet item;\r\n\r\n\t\tif ( typeof idOrIndex == 'string' ) {\r\n\t\t\titem = this._itemMap.get( idOrIndex );\r\n\t\t} else if ( typeof idOrIndex == 'number' ) {\r\n\t\t\titem = this._items[ idOrIndex ];\r\n\t\t} else {\r\n\t\t\t/**\r\n\t\t\t * Index or id must be given.\r\n\t\t\t *\r\n\t\t\t * @error collection-get-invalid-arg\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'collection-get-invalid-arg: Index or id must be given.' );\r\n\t\t}\r\n\r\n\t\treturn item || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets index of item in the collection.\r\n\t * When item is not defined in the collection then index will be equal -1.\r\n\t *\r\n\t * @param {String|Object} idOrItem The item or its id in the collection.\r\n\t * @returns {Number} Index of given item.\r\n\t */\r\n\tgetIndex( idOrItem ) {\r\n\t\tlet item;\r\n\r\n\t\tif ( typeof idOrItem == 'string' ) {\r\n\t\t\titem = this._itemMap.get( idOrItem );\r\n\t\t} else {\r\n\t\t\titem = idOrItem;\r\n\t\t}\r\n\r\n\t\treturn this._items.indexOf( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an item from the collection.\r\n\t *\r\n\t * @param {Object|Number|String} subject The item to remove, its id or index in the collection.\r\n\t * @returns {Object} The removed item.\r\n\t * @fires remove\r\n\t */\r\n\tremove( subject ) {\r\n\t\tlet index, id, item;\r\n\t\tlet itemDoesNotExist = false;\r\n\t\tconst idProperty = this._idProperty;\r\n\r\n\t\tif ( typeof subject == 'string' ) {\r\n\t\t\tid = subject;\r\n\t\t\titem = this._itemMap.get( id );\r\n\t\t\titemDoesNotExist = !item;\r\n\r\n\t\t\tif ( item ) {\r\n\t\t\t\tindex = this._items.indexOf( item );\r\n\t\t\t}\r\n\t\t} else if ( typeof subject == 'number' ) {\r\n\t\t\tindex = subject;\r\n\t\t\titem = this._items[ index ];\r\n\t\t\titemDoesNotExist = !item;\r\n\r\n\t\t\tif ( item ) {\r\n\t\t\t\tid = item[ idProperty ];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\titem = subject;\r\n\t\t\tid = item[ idProperty ];\r\n\t\t\tindex = this._items.indexOf( item );\r\n\t\t\titemDoesNotExist = ( index == -1 || !this._itemMap.get( id ) );\r\n\t\t}\r\n\r\n\t\tif ( itemDoesNotExist ) {\r\n\t\t\t/**\r\n\t\t\t * Item not found.\r\n\t\t\t *\r\n\t\t\t * @error collection-remove-404\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'collection-remove-404: Item not found.' );\r\n\t\t}\r\n\r\n\t\tthis._items.splice( index, 1 );\r\n\t\tthis._itemMap.delete( id );\r\n\r\n\t\tconst externalItem = this._bindToInternalToExternalMap.get( item );\r\n\t\tthis._bindToInternalToExternalMap.delete( item );\r\n\t\tthis._bindToExternalToInternalMap.delete( externalItem );\r\n\r\n\t\tthis.fire( 'remove', item, index );\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the callback for each item in the collection and composes an array or values returned by this callback.\r\n\t *\r\n\t * @param {Function} callback\r\n\t * @param {Object} callback.item\r\n\t * @param {Number} callback.index\r\n\t * @param {Object} ctx Context in which the `callback` will be called.\r\n\t * @returns {Array} The result of mapping.\r\n\t */\r\n\tmap( callback, ctx ) {\r\n\t\treturn this._items.map( callback, ctx );\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the first item in the collection for which the `callback` returns a true value.\r\n\t *\r\n\t * @param {Function} callback\r\n\t * @param {Object} callback.item\r\n\t * @param {Number} callback.index\r\n\t * @param {Object} ctx Context in which the `callback` will be called.\r\n\t * @returns {Object} The item for which `callback` returned a true value.\r\n\t */\r\n\tfind( callback, ctx ) {\r\n\t\treturn this._items.find( callback, ctx );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array with items for which the `callback` returned a true value.\r\n\t *\r\n\t * @param {Function} callback\r\n\t * @param {Object} callback.item\r\n\t * @param {Number} callback.index\r\n\t * @param {Object} ctx Context in which the `callback` will be called.\r\n\t * @returns {Object[]} The array with matching items.\r\n\t */\r\n\tfilter( callback, ctx ) {\r\n\t\treturn this._items.filter( callback, ctx );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all items from the collection and destroys the binding created using\r\n\t * {@link #bindTo}.\r\n\t */\r\n\tclear() {\r\n\t\tif ( this._bindToCollection ) {\r\n\t\t\tthis.stopListening( this._bindToCollection );\r\n\t\t\tthis._bindToCollection = null;\r\n\t\t}\r\n\r\n\t\twhile ( this.length ) {\r\n\t\t\tthis.remove( 0 );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Binds and synchronizes the collection with another one.\r\n\t *\r\n\t * The binding can be a simple factory:\r\n\t *\r\n\t *\t\tclass FactoryClass {\r\n\t *\t\t\tconstructor( data ) {\r\n\t *\t\t\t\tthis.label = data.label;\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\r\n\t *\t\tconst target = new Collection();\r\n\t *\r\n\t *\t\ttarget.bindTo( source ).as( FactoryClass );\r\n\t *\r\n\t *\t\tsource.add( { label: 'foo' } );\r\n\t *\t\tsource.add( { label: 'bar' } );\r\n\t *\r\n\t *\t\tconsole.log( target.length ); // 2\r\n\t *\t\tconsole.log( target.get( 1 ).label ); // 'bar'\r\n\t *\r\n\t *\t\tsource.remove( 0 );\r\n\t *\t\tconsole.log( target.length ); // 1\r\n\t *\t\tconsole.log( target.get( 0 ).label ); // 'bar'\r\n\t *\r\n\t * or the factory driven by a custom callback:\r\n\t *\r\n\t *\t\tclass FooClass {\r\n\t *\t\t\tconstructor( data ) {\r\n\t *\t\t\t\tthis.label = data.label;\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tclass BarClass {\r\n\t *\t\t\tconstructor( data ) {\r\n\t *\t\t\t\tthis.label = data.label;\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\r\n\t *\t\tconst target = new Collection();\r\n\t *\r\n\t *\t\ttarget.bindTo( source ).using( ( item ) => {\r\n\t *\t\t\tif ( item.label == 'foo' ) {\r\n\t *\t\t\t\treturn new FooClass( item );\r\n\t *\t\t\t} else {\r\n\t *\t\t\t\treturn new BarClass( item );\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\tsource.add( { label: 'foo' } );\r\n\t *\t\tsource.add( { label: 'bar' } );\r\n\t *\r\n\t *\t\tconsole.log( target.length ); // 2\r\n\t *\t\tconsole.log( target.get( 0 ) instanceof FooClass ); // true\r\n\t *\t\tconsole.log( target.get( 1 ) instanceof BarClass ); // true\r\n\t *\r\n\t * or the factory out of property name:\r\n\t *\r\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\r\n\t *\t\tconst target = new Collection();\r\n\t *\r\n\t *\t\ttarget.bindTo( source ).using( 'label' );\r\n\t *\r\n\t *\t\tsource.add( { label: { value: 'foo' } } );\r\n\t *\t\tsource.add( { label: { value: 'bar' } } );\r\n\t *\r\n\t *\t\tconsole.log( target.length ); // 2\r\n\t *\t\tconsole.log( target.get( 0 ).value ); // 'foo'\r\n\t *\t\tconsole.log( target.get( 1 ).value ); // 'bar'\r\n\t *\r\n\t * It's possible to skip specified items by returning falsy value:\r\n\t *\r\n\t *\t\tconst source = new Collection();\r\n\t *\t\tconst target = new Collection();\r\n\t *\r\n\t *\t\ttarget.bindTo( source ).using( item => {\r\n\t *\t\t\tif ( item.hidden ) {\r\n\t *\t\t\t\treturn null;\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\treturn item;\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\tsource.add( { hidden: true } );\r\n\t *\t\tsource.add( { hidden: false } );\r\n\t *\r\n\t *\t\tconsole.log( source.length ); // 2\r\n\t *\t\tconsole.log( target.length ); // 1\r\n\t *\r\n\t * **Note**: {@link #clear} can be used to break the binding.\r\n\t *\r\n\t * @param {module:utils/collection~Collection} externalCollection A collection to be bound.\r\n\t * @returns {Object}\r\n\t * @returns {module:utils/collection~Collection#bindTo#as} return.as\r\n\t * @returns {module:utils/collection~Collection#bindTo#using} return.using\r\n\t */\r\n\tbindTo( externalCollection ) {\r\n\t\tif ( this._bindToCollection ) {\r\n\t\t\t/**\r\n\t\t\t * The collection cannot be bound more than once.\r\n\t\t\t *\r\n\t\t\t * @error collection-bind-to-rebind\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'collection-bind-to-rebind: The collection cannot be bound more than once.' );\r\n\t\t}\r\n\r\n\t\tthis._bindToCollection = externalCollection;\r\n\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Creates the class factory binding.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @param {Function} Class Specifies which class factory is to be initialized.\r\n\t\t\t */\r\n\t\t\tas: Class => {\r\n\t\t\t\tthis._setUpBindToBinding( item => new Class( item ) );\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Creates callback or property binding.\r\n\t\t\t *\r\n\t\t\t * @static\r\n\t\t\t * @param {Function|String} callbackOrProperty When the function is passed, it is used to\r\n\t\t\t * produce the items. When the string is provided, the property value is used to create\r\n\t\t\t * the bound collection items.\r\n\t\t\t */\r\n\t\t\tusing: callbackOrProperty => {\r\n\t\t\t\tif ( typeof callbackOrProperty == 'function' ) {\r\n\t\t\t\t\tthis._setUpBindToBinding( item => callbackOrProperty( item ) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._setUpBindToBinding( item => item[ callbackOrProperty ] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Finalizes and activates a binding initiated by {#bindTo}.\r\n\t *\r\n\t * @protected\r\n\t * @param {Function} factory A function which produces collection items.\r\n\t */\r\n\t_setUpBindToBinding( factory ) {\r\n\t\tconst externalCollection = this._bindToCollection;\r\n\r\n\t\t// Adds the item to the collection once a change has been done to the external collection.\r\n\t\t//\r\n\t\t// @private\r\n\t\tconst addItem = ( evt, externalItem, index ) => {\r\n\t\t\tconst isExternalBoundToThis = externalCollection._bindToCollection == this;\r\n\t\t\tconst externalItemBound = externalCollection._bindToInternalToExternalMap.get( externalItem );\r\n\r\n\t\t\t// If an external collection is bound to this collection, which makes it a 2–way binding,\r\n\t\t\t// and the particular external collection item is already bound, don't add it here.\r\n\t\t\t// The external item has been created **out of this collection's item** and (re)adding it will\r\n\t\t\t// cause a loop.\r\n\t\t\tif ( isExternalBoundToThis && externalItemBound ) {\r\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, externalItemBound );\r\n\t\t\t\tthis._bindToInternalToExternalMap.set( externalItemBound, externalItem );\r\n\t\t\t} else {\r\n\t\t\t\tconst item = factory( externalItem );\r\n\r\n\t\t\t\t// When there is no item we need to remember skipped index first and then we can skip this item.\r\n\t\t\t\tif ( !item ) {\r\n\t\t\t\t\tthis._skippedIndexesFromExternal.push( index );\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lets try to put item at the same index as index in external collection\r\n\t\t\t\t// but when there are a skipped items in one or both collections we need to recalculate this index.\r\n\t\t\t\tlet finalIndex = index;\r\n\r\n\t\t\t\t// When we try to insert item after some skipped items from external collection we need\r\n\t\t\t\t// to include this skipped items and decrease index.\r\n\t\t\t\t//\r\n\t\t\t\t// For the following example:\r\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal' ]\r\n\t\t\t\t// internal -> [ A ]\r\n\t\t\t\t//\r\n\t\t\t\t// Another item is been added at the end of external collection:\r\n\t\t\t\t// external.add( 'D' )\r\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal', 'D' ]\r\n\t\t\t\t//\r\n\t\t\t\t// We can't just add 'D' to internal at the same index as index in external because\r\n\t\t\t\t// this will produce empty indexes what is invalid:\r\n\t\t\t\t// internal -> [ 'A', empty, empty, 'D' ]\r\n\t\t\t\t//\r\n\t\t\t\t// So we need to include skipped items and decrease index\r\n\t\t\t\t// internal -> [ 'A', 'D' ]\r\n\t\t\t\tfor ( const skipped of this._skippedIndexesFromExternal ) {\r\n\t\t\t\t\tif ( index > skipped ) {\r\n\t\t\t\t\t\tfinalIndex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We need to take into consideration that external collection could skip some items from\r\n\t\t\t\t// internal collection.\r\n\t\t\t\t//\r\n\t\t\t\t// For the following example:\r\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external' ]\r\n\t\t\t\t// external -> [ A ]\r\n\t\t\t\t//\r\n\t\t\t\t// Another item is been added at the end of external collection:\r\n\t\t\t\t// external.add( 'D' )\r\n\t\t\t\t// external -> [ 'A', 'D' ]\r\n\t\t\t\t//\r\n\t\t\t\t// We need to include skipped items and place new item after them:\r\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external', 'D' ]\r\n\t\t\t\tfor ( const skipped of externalCollection._skippedIndexesFromExternal ) {\r\n\t\t\t\t\tif ( finalIndex >= skipped ) {\r\n\t\t\t\t\t\tfinalIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, item );\r\n\t\t\t\tthis._bindToInternalToExternalMap.set( item, externalItem );\r\n\t\t\t\tthis.add( item, finalIndex );\r\n\r\n\t\t\t\t// After adding new element to internal collection we need update indexes\r\n\t\t\t\t// of skipped items in external collection.\r\n\t\t\t\tfor ( let i = 0; i < externalCollection._skippedIndexesFromExternal.length; i++ ) {\r\n\t\t\t\t\tif ( finalIndex <= externalCollection._skippedIndexesFromExternal[ i ] ) {\r\n\t\t\t\t\t\texternalCollection._skippedIndexesFromExternal[ i ]++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Load the initial content of the collection.\r\n\t\tfor ( const externalItem of externalCollection ) {\r\n\t\t\taddItem( null, externalItem, externalCollection.getIndex( externalItem ) );\r\n\t\t}\r\n\r\n\t\t// Synchronize the with collection as new items are added.\r\n\t\tthis.listenTo( externalCollection, 'add', addItem );\r\n\r\n\t\t// Synchronize the with collection as new items are removed.\r\n\t\tthis.listenTo( externalCollection, 'remove', ( evt, externalItem, index ) => {\r\n\t\t\tconst item = this._bindToExternalToInternalMap.get( externalItem );\r\n\r\n\t\t\tif ( item ) {\r\n\t\t\t\tthis.remove( item );\r\n\t\t\t}\r\n\r\n\t\t\t// After removing element from external collection we need update/remove indexes\r\n\t\t\t// of skipped items in internal collection.\r\n\t\t\tthis._skippedIndexesFromExternal = this._skippedIndexesFromExternal.reduce( ( result, skipped ) => {\r\n\t\t\t\tif ( index < skipped ) {\r\n\t\t\t\t\tresult.push( skipped - 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( index > skipped ) {\r\n\t\t\t\t\tresult.push( skipped );\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}, [] );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._items[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Fired when an item is added to the collection.\r\n\t *\r\n\t * @event add\r\n\t * @param {Object} item The added item.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when an item is removed from the collection.\r\n\t *\r\n\t * @event remove\r\n\t * @param {Object} item The removed item.\r\n\t * @param {Number} index Index from which item was removed.\r\n\t */\r\n}\r\n\r\nmix( Collection, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/document\r\n */\r\n\r\nimport DocumentSelection from './documentselection';\r\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\n\r\n/**\r\n * Document class creates an abstract layer over the content editable area, contains a tree of view elements and\r\n * {@link module:engine/view/documentselection~DocumentSelection view selection} associated with this document.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Document {\r\n\t/**\r\n\t * Creates a Document instance.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Selection done on this document.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/documentselection~DocumentSelection} module:engine/view/document~Document#selection\r\n\t\t */\r\n\t\tthis.selection = new DocumentSelection();\r\n\r\n\t\t/**\r\n\t\t * Roots of the view tree. Collection of the {@link module:engine/view/element~Element view elements}.\r\n\t\t *\r\n\t\t * View roots are created as a result of binding between {@link module:engine/view/document~Document#roots} and\r\n\t\t * {@link module:engine/model/document~Document#roots} and this is handled by\r\n\t\t * {@link module:engine/controller/editingcontroller~EditingController}, so to create view root we need to create\r\n\t\t * model root using {@link module:engine/model/document~Document#createRoot}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/collection~Collection} module:engine/view/document~Document#roots\r\n\t\t */\r\n\t\tthis.roots = new Collection( { idProperty: 'rootName' } );\r\n\r\n\t\t/**\r\n\t\t * Defines whether document is in read-only mode.\r\n\t\t *\r\n\t\t * When document is read-ony then all roots are read-only as well and caret placed inside this root is hidden.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * True if document is focused.\r\n\t\t *\r\n\t\t * This property is updated by the {@link module:engine/view/observer/focusobserver~FocusObserver}.\r\n\t\t * If the {@link module:engine/view/observer/focusobserver~FocusObserver} is disabled this property will not change.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} module:engine/view/document~Document#isFocused\r\n\t\t */\r\n\t\tthis.set( 'isFocused', false );\r\n\r\n\t\t/**\r\n\t\t * True if composition is in progress inside the document.\r\n\t\t *\r\n\t\t * This property is updated by the {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\r\n\t\t * If the {@link module:engine/view/observer/compositionobserver~CompositionObserver} is disabled this property will not change.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} module:engine/view/document~Document#isComposing\r\n\t\t */\r\n\t\tthis.set( 'isComposing', false );\r\n\r\n\t\t/**\r\n\t\t * Post-fixer callbacks registered to the view document.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Set}\r\n\t\t */\r\n\t\tthis._postFixers = new Set();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a {@link module:engine/view/document~Document#roots view root element} with the specified name. If the name is not\r\n\t * specific \"main\" root is returned.\r\n\t *\r\n\t * @param {String} [name='main'] Name of the root.\r\n\t * @returns {module:engine/view/rooteditableelement~RootEditableElement|null} The view root element with the specified name\r\n\t * or null when there is no root of given name.\r\n\t */\r\n\tgetRoot( name = 'main' ) {\r\n\t\treturn this.roots.get( name );\r\n\t}\r\n\r\n\t/**\r\n\t * Used to register a post-fixer callback. A post-fixers mechanism allows to update view tree just before rendering\r\n\t * to the DOM.\r\n\t *\r\n\t * Post-fixers are fired just after all changes from the outermost change block were applied but\r\n\t * before the {@link module:engine/view/view~View#event:render render event} is fired. If a post-fixer callback made\r\n\t * a change, it should return `true`. When this happens, all post-fixers are fired again to check if something else should\r\n\t * not be fixed in the new document tree state.\r\n\t *\r\n\t * View post-fixers are useful when you wants to update view structure whenever it changes, for instance add some classes\r\n\t * to elements based on the view structure or selection. However, is you need DOM elements to be already updated, use\r\n\t * {@link module:engine/view/view~View#event:render render event}.\r\n\t *\r\n\t * As a parameter, a post-fixer callback receives a {@link module:engine/view/downcastwriter~DowncastWriter downcast writer}\r\n\t * instance connected with the executed changes block.\r\n\t *\r\n\t * @param {Function} postFixer\r\n\t */\r\n\tregisterPostFixer( postFixer ) {\r\n\t\tthis._postFixers.add( postFixer );\r\n\t}\r\n\r\n\t/**\r\n\t * Performs post-fixer loops. Executes post-fixer callbacks as long as none of them has done any changes to the model.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n\t */\r\n\t_callPostFixers( writer ) {\r\n\t\tlet wasFixed = false;\r\n\r\n\t\tdo {\r\n\t\t\tfor ( const callback of this._postFixers ) {\r\n\t\t\t\twasFixed = callback( writer );\r\n\r\n\t\t\t\tif ( wasFixed ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} while ( wasFixed );\r\n\t}\r\n\r\n\t/**\r\n\t * Event fired whenever document content layout changes. It is fired whenever content is\r\n\t * {@link module:engine/view/view~View#event:render rendered}, but should be also fired by observers in case of\r\n\t * other actions which may change layout, for instance when image loads.\r\n\t *\r\n\t * @event layoutChanged\r\n\t */\r\n}\r\n\r\nmix( Document, ObservableMixin );\r\n\r\n/**\r\n * Enum representing type of the change.\r\n *\r\n * Possible values:\r\n *\r\n * * `children` - for child list changes,\r\n * * `attributes` - for element attributes changes,\r\n * * `text` - for text nodes changes.\r\n *\r\n * @typedef {String} module:engine/view/document~ChangeType\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/attributeelement\r\n */\r\n\r\nimport Element from './element';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n// Default attribute priority.\r\nconst DEFAULT_PRIORITY = 10;\r\n\r\n/**\r\n * Attribute elements are used to represent formatting elements in the view (think – `<b>`, `<span style=\"font-size: 2em\">`, etc.).\r\n * Most often they are created when downcasting model text attributes.\r\n *\r\n * Editing engine does not define a fixed HTML DTD. This is why a feature developer needs to choose between various\r\n * types (container element, {@link module:engine/view/attributeelement~AttributeElement attribute element},\r\n * {@link module:engine/view/emptyelement~EmptyElement empty element}, etc) when developing a feature.\r\n *\r\n * To create a new attribute element instance use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createAttributeElement `DowncastWriter#createAttributeElement()`} method.\r\n *\r\n * @extends module:engine/view/element~Element\r\n */\r\nexport default class AttributeElement extends Element {\r\n\t/**\r\n\t * Creates an attribute element.\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#createAttributeElement\r\n\t * @see module:engine/view/element~Element\r\n\t * @protected\r\n\t */\r\n\tconstructor( name, attrs, children ) {\r\n\t\tsuper( name, attrs, children );\r\n\r\n\t\t/**\r\n\t\t * Returns block {@link module:engine/view/filler filler} offset or `null` if block filler is not needed.\r\n\t\t *\r\n\t\t * @method #getFillerOffset\r\n\t\t * @returns {Number|null} Block filler offset or `null` if block filler is not needed.\r\n\t\t */\r\n\t\tthis.getFillerOffset = getFillerOffset;\r\n\r\n\t\t/**\r\n\t\t * Element priority. Decides in what order elements are wrapped by {@link module:engine/view/downcastwriter~DowncastWriter}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis._priority = DEFAULT_PRIORITY;\r\n\r\n\t\t/**\r\n\t\t * Element identifier. If set, it is used by {@link module:engine/view/element~Element#isSimilar},\r\n\t\t * and then two elements are considered similar if, and only if they have the same `_id`.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {String|Number}\r\n\t\t */\r\n\t\tthis._id = null;\r\n\r\n\t\t/**\r\n\t\t * Keeps all the attribute elements that have the same {@link module:engine/view/attributeelement~AttributeElement#id ids}\r\n\t\t * and still exist in the view tree.\r\n\t\t *\r\n\t\t * This property is managed by {@link module:engine/view/downcastwriter~DowncastWriter}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Set.<module:engine/view/attributeelement~AttributeElement>|null}\r\n\t\t */\r\n\t\tthis._clonesGroup = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Element priority. Decides in what order elements are wrapped by {@link module:engine/view/downcastwriter~DowncastWriter}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget priority() {\r\n\t\treturn this._priority;\r\n\t}\r\n\r\n\t/**\r\n\t * Element identifier. If set, it is used by {@link module:engine/view/element~Element#isSimilar},\r\n\t * and then two elements are considered similar if, and only if they have the same `id`.\r\n\t *\r\n\t * @readonly\r\n\t * @type {String|Number}\r\n\t */\r\n\tget id() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all {@link module:engine/view/attributeelement~AttributeElement attribute elements} that has the\r\n\t * same {@link module:engine/view/attributeelement~AttributeElement#id id} and are in the view tree (were not removed).\r\n\t *\r\n\t * Note: If this element has been removed from the tree, returned set will not include it.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError attribute-element-get-elements-with-same-id-no-id}\r\n\t * if this element has no `id`.\r\n\t *\r\n\t * @returns {Set.<module:engine/view/attributeelement~AttributeElement>} Set containing all the attribute elements\r\n\t * with the same `id` that were added and not removed from the view tree.\r\n\t */\r\n\tgetElementsWithSameId() {\r\n\t\tif ( this.id === null ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot get elements with the same id for an attribute element without id.\r\n\t\t\t *\r\n\t\t\t * @error attribute-element-get-elements-with-same-id-no-id\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'attribute-element-get-elements-with-same-id-no-id: ' +\r\n\t\t\t\t'Cannot get elements with the same id for an attribute element without id.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn new Set( this._clonesGroup );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'attributeElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'attributeElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this element is similar to other element.\r\n\t *\r\n\t * If none of elements has set {@link module:engine/view/attributeelement~AttributeElement#id}, then both elements\r\n\t * should have the same name, attributes and priority to be considered as similar. Two similar elements can contain\r\n\t * different set of children nodes.\r\n\t *\r\n\t * If at least one element has {@link module:engine/view/attributeelement~AttributeElement#id} set, then both\r\n\t * elements have to have the same {@link module:engine/view/attributeelement~AttributeElement#id} value to be\r\n\t * considered similar.\r\n\t *\r\n\t * Similarity is important for {@link module:engine/view/downcastwriter~DowncastWriter}. For example:\r\n\t *\r\n\t * * two following similar elements can be merged together into one, longer element,\r\n\t * * {@link module:engine/view/downcastwriter~DowncastWriter#unwrap} checks similarity of passed element and processed element to\r\n\t * decide whether processed element should be unwrapped,\r\n\t * * etc.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} otherElement\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisSimilar( otherElement ) {\r\n\t\t// If any element has an `id` set, just compare the ids.\r\n\t\tif ( this.id !== null || otherElement.id !== null ) {\r\n\t\t\treturn this.id === otherElement.id;\r\n\t\t}\r\n\r\n\t\treturn super.isSimilar( otherElement ) && this.priority == otherElement.priority;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones provided element with priority.\r\n\t *\r\n\t * @protected\r\n\t * @param {Boolean} deep If set to `true` clones element and all its children recursively. When set to `false`,\r\n\t * element will be cloned without any children.\r\n\t * @returns {module:engine/view/attributeelement~AttributeElement} Clone of this element.\r\n\t */\r\n\t_clone( deep ) {\r\n\t\tconst cloned = super._clone( deep );\r\n\r\n\t\t// Clone priority too.\r\n\t\tcloned._priority = this._priority;\r\n\r\n\t\t// And id too.\r\n\t\tcloned._id = this._id;\r\n\r\n\t\treturn cloned;\r\n\t}\r\n}\r\n\r\n/**\r\n * Default attribute priority.\r\n *\r\n * @member {Number} module:engine/view/attributeelement~AttributeElement.DEFAULT_PRIORITY\r\n */\r\nAttributeElement.DEFAULT_PRIORITY = DEFAULT_PRIORITY;\r\n\r\n// Returns block {@link module:engine/view/filler~Filler filler} offset or `null` if block filler is not needed.\r\n//\r\n// @returns {Number|null} Block filler offset or `null` if block filler is not needed.\r\nfunction getFillerOffset() {\r\n\t// <b>foo</b> does not need filler.\r\n\tif ( nonUiChildrenCount( this ) ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tlet element = this.parent;\r\n\r\n\t// <p><b></b></p> needs filler -> <p><b><br></b></p>\r\n\twhile ( element && element.is( 'attributeElement' ) ) {\r\n\t\tif ( nonUiChildrenCount( element ) > 1 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\telement = element.parent;\r\n\t}\r\n\r\n\tif ( !element || nonUiChildrenCount( element ) > 1 ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Render block filler at the end of element (after all ui elements).\r\n\treturn this.childCount;\r\n}\r\n\r\n// Returns total count of children that are not {@link module:engine/view/uielement~UIElement UIElements}.\r\n//\r\n// @param {module:engine/view/element~Element} element\r\n// @returns {Number}\r\nfunction nonUiChildrenCount( element ) {\r\n\treturn Array.from( element.getChildren() ).filter( element => !element.is( 'uiElement' ) ).length;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/emptyelement\r\n */\r\n\r\nimport Element from './element';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport Node from './node';\r\n\r\n/**\r\n * Empty element class. It is used to represent elements that cannot contain any child nodes (for example `<img>` elements).\r\n *\r\n * To create a new empty element use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createEmptyElement `downcastWriter#createEmptyElement()`} method.\r\n *\r\n * @extends module:engine/view/element~Element\r\n */\r\nexport default class EmptyElement extends Element {\r\n\t/**\r\n\t * Creates new instance of EmptyElement.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-emptyelement-cannot-add` when third parameter is passed,\r\n\t * to inform that usage of EmptyElement is incorrect (adding child nodes to EmptyElement is forbidden).\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#createEmptyElement\r\n\t * @protected\r\n\t * @param {String} name Node name.\r\n\t * @param {Object|Iterable} [attributes] Collection of attributes.\r\n\t */\r\n\tconstructor( name, attributes, children ) {\r\n\t\tsuper( name, attributes, children );\r\n\r\n\t\t/**\r\n\t\t * Returns `null` because filler is not needed for EmptyElements.\r\n\t\t *\r\n\t\t * @method #getFillerOffset\r\n\t\t * @returns {null} Always returns null.\r\n\t\t */\r\n\t\tthis.getFillerOffset = getFillerOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'emptyElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'emptyElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides {@link module:engine/view/element~Element#_insertChild} method.\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-emptyelement-cannot-add` to prevent\r\n\t * adding any child nodes to EmptyElement.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_insertChild( index, nodes ) {\r\n\t\tif ( nodes && ( nodes instanceof Node || Array.from( nodes ).length > 0 ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot add children to {@link module:engine/view/emptyelement~EmptyElement}.\r\n\t\t\t *\r\n\t\t\t * @error view-emptyelement-cannot-add\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-emptyelement-cannot-add: Cannot add child nodes to EmptyElement instance.' );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Returns `null` because block filler is not needed for EmptyElements.\r\n//\r\n// @returns {null}\r\nfunction getFillerOffset() {\r\n\treturn null;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals navigator:false */\r\n\r\n/**\r\n * @module utils/env\r\n */\r\n\r\nconst userAgent = navigator.userAgent.toLowerCase();\r\n\r\n/**\r\n * A namespace containing environment and browser information.\r\n *\r\n * @namespace\r\n */\r\nconst env = {\r\n\t/**\r\n\t * Indicates that the application is running on Macintosh.\r\n\t *\r\n\t * @static\r\n\t * @member {Boolean} module:utils/env~env#isMac\r\n\t */\r\n\tisMac: isMac( userAgent ),\r\n\r\n\t/**\r\n\t * Indicates that the application is running in Microsoft Edge.\r\n\t *\r\n\t * @static\r\n\t * @member {Boolean} module:utils/env~env#isEdge\r\n\t */\r\n\tisEdge: isEdge( userAgent ),\r\n\r\n\t/**\r\n\t * Indicates that the application is running in Firefox (Gecko).\r\n\t *\r\n\t * @static\r\n\t * @member {Boolean} module:utils/env~env#isEdge\r\n\t */\r\n\tisGecko: isGecko( userAgent )\r\n};\r\n\r\nexport default env;\r\n\r\n/**\r\n * Checks if User Agent represented by the string is running on Macintosh.\r\n *\r\n * @param {String} userAgent **Lowercase** `navigator.userAgent` string.\r\n * @returns {Boolean} Whether User Agent is running on Macintosh or not.\r\n */\r\nexport function isMac( userAgent ) {\r\n\treturn userAgent.indexOf( 'macintosh' ) > -1;\r\n}\r\n\r\n/**\r\n * Checks if User Agent represented by the string is Microsoft Edge.\r\n *\r\n * @param {String} userAgent **Lowercase** `navigator.userAgent` string.\r\n * @returns {Boolean} Whether User Agent is Edge or not.\r\n */\r\nexport function isEdge( userAgent ) {\r\n\treturn !!userAgent.match( /edge\\/(\\d+.?\\d*)/ );\r\n}\r\n\r\n/**\r\n * Checks if User Agent represented by the string is Firefox (Gecko).\r\n *\r\n * @param {String} userAgent **Lowercase** `navigator.userAgent` string.\r\n * @returns {Boolean} Whether User Agent is Firefox or not.\r\n */\r\nexport function isGecko( userAgent ) {\r\n\treturn !!userAgent.match( /gecko\\/\\d+/ );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * Set of utils related to keyboard support.\r\n *\r\n * @module utils/keyboard\r\n */\r\n\r\nimport CKEditorError from './ckeditorerror';\r\nimport env from './env';\r\n\r\nconst macGlyphsToModifiers = {\r\n\t'⌘': 'ctrl',\r\n\t'⇧': 'shift',\r\n\t'⌥': 'alt'\r\n};\r\n\r\nconst modifiersToMacGlyphs = {\r\n\t'ctrl': '⌘',\r\n\t'shift': '⇧',\r\n\t'alt': '⌥'\r\n};\r\n\r\n/**\r\n * Object with `keyName => keyCode` pairs for a set of known keys.\r\n *\r\n * Contains:\r\n *\r\n * * `a-z`,\r\n * * `0-9`,\r\n * * `f1-f12`,\r\n * * `arrow(left|up|right|bottom)`,\r\n * * `backspace`, `delete`, `enter`, `esc`, `tab`,\r\n * * `ctrl`, `cmd`, `shift`, `alt`.\r\n */\r\nexport const keyCodes = generateKnownKeyCodes();\r\n\r\n/**\r\n * Converts a key name or a {@link module:utils/keyboard~KeystrokeInfo keystroke info} into a key code.\r\n *\r\n * Note: Key names are matched with {@link module:utils/keyboard~keyCodes} in a case-insensitive way.\r\n *\r\n * @param {String|module:utils/keyboard~KeystrokeInfo} Key name (see {@link module:utils/keyboard~keyCodes})\r\n * or a keystroke data object.\r\n * @returns {Number} Key or keystroke code.\r\n */\r\nexport function getCode( key ) {\r\n\tlet keyCode;\r\n\r\n\tif ( typeof key == 'string' ) {\r\n\t\tkeyCode = keyCodes[ key.toLowerCase() ];\r\n\r\n\t\tif ( !keyCode ) {\r\n\t\t\t/**\r\n\t\t\t * Unknown key name. Only key names contained by the {@link module:utils/keyboard~keyCodes} can be used.\r\n\t\t\t *\r\n\t\t\t * @errror keyboard-unknown-key\r\n\t\t\t * @param {String} key\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'keyboard-unknown-key: Unknown key name.', { key } );\r\n\t\t}\r\n\t} else {\r\n\t\tkeyCode = key.keyCode +\r\n\t\t\t( key.altKey ? keyCodes.alt : 0 ) +\r\n\t\t\t( key.ctrlKey ? keyCodes.ctrl : 0 ) +\r\n\t\t\t( key.shiftKey ? keyCodes.shift : 0 );\r\n\t}\r\n\r\n\treturn keyCode;\r\n}\r\n\r\n/**\r\n * Parses keystroke and returns a keystroke code that will match the code returned by\r\n * link {@link module:utils/keyboard.getCode} for a corresponding {@link module:utils/keyboard~KeystrokeInfo keystroke info}.\r\n *\r\n * The keystroke can be passed in two formats:\r\n *\r\n * * as a single string – e.g. `ctrl + A`,\r\n * * as an array of {@link module:utils/keyboard~keyCodes known key names} and key codes – e.g.:\r\n *   * `[ 'ctrl', 32 ]` (ctrl + space),\r\n *   * `[ 'ctrl', 'a' ]` (ctrl + A).\r\n *\r\n * Note: Key names are matched with {@link module:utils/keyboard~keyCodes} in a case-insensitive way.\r\n *\r\n * Note: Only keystrokes with a single non-modifier key are supported (e.g. `ctrl+A` is OK, but `ctrl+A+B` is not).\r\n *\r\n * @param {String|Array.<Number|String>} keystroke Keystroke definition.\r\n * @returns {Number} Keystroke code.\r\n */\r\nexport function parseKeystroke( keystroke ) {\r\n\tif ( typeof keystroke == 'string' ) {\r\n\t\tkeystroke = splitKeystrokeText( keystroke );\r\n\t}\r\n\r\n\treturn keystroke\r\n\t\t.map( key => ( typeof key == 'string' ) ? getCode( key ) : key )\r\n\t\t.reduce( ( key, sum ) => sum + key, 0 );\r\n}\r\n\r\n/**\r\n * It translates any keystroke string text like `\"CTRL+A\"` to an\r\n * environment–specific keystroke, i.e. `\"⌘A\"` on Mac OSX.\r\n *\r\n * @param {String} keystroke Keystroke text.\r\n * @returns {String} Keystroke text specific for the environment.\r\n */\r\nexport function getEnvKeystrokeText( keystroke ) {\r\n\tif ( !env.isMac ) {\r\n\t\treturn keystroke;\r\n\t}\r\n\r\n\treturn splitKeystrokeText( keystroke )\r\n\t\t// Replace modifiers (e.g. \"ctrl\") with Mac glyphs (e.g. \"⌘\") first.\r\n\t\t.map( key => modifiersToMacGlyphs[ key.toLowerCase() ] || key )\r\n\r\n\t\t// Decide whether to put \"+\" between keys in the keystroke or not.\r\n\t\t.reduce( ( value, key ) => {\r\n\t\t\tif ( value.slice( -1 ) in macGlyphsToModifiers ) {\r\n\t\t\t\treturn value + key;\r\n\t\t\t} else {\r\n\t\t\t\treturn value + '+' + key;\r\n\t\t\t}\r\n\t\t} );\r\n}\r\n\r\nfunction generateKnownKeyCodes() {\r\n\tconst keyCodes = {\r\n\t\tarrowleft: 37,\r\n\t\tarrowup: 38,\r\n\t\tarrowright: 39,\r\n\t\tarrowdown: 40,\r\n\t\tbackspace: 8,\r\n\t\tdelete: 46,\r\n\t\tenter: 13,\r\n\t\tspace: 32,\r\n\t\tesc: 27,\r\n\t\ttab: 9,\r\n\r\n\t\t// The idea about these numbers is that they do not collide with any real key codes, so we can use them\r\n\t\t// like bit masks.\r\n\t\tctrl: 0x110000,\r\n\t\t// Has the same code as ctrl, because their behaviour should be unified across the editor.\r\n\t\t// See http://ckeditor.github.io/editor-recommendations/general-policies#ctrl-vs-cmd\r\n\t\tcmd: 0x110000,\r\n\t\tshift: 0x220000,\r\n\t\talt: 0x440000\r\n\t};\r\n\r\n\t// a-z\r\n\tfor ( let code = 65; code <= 90; code++ ) {\r\n\t\tconst letter = String.fromCharCode( code );\r\n\r\n\t\tkeyCodes[ letter.toLowerCase() ] = code;\r\n\t}\r\n\r\n\t// 0-9\r\n\tfor ( let code = 48; code <= 57; code++ ) {\r\n\t\tkeyCodes[ code - 48 ] = code;\r\n\t}\r\n\r\n\t// F1-F12\r\n\tfor ( let code = 112; code <= 123; code++ ) {\r\n\t\tkeyCodes[ 'f' + ( code - 111 ) ] = code;\r\n\t}\r\n\r\n\treturn keyCodes;\r\n}\r\n\r\nfunction splitKeystrokeText( keystroke ) {\r\n\treturn keystroke.split( /\\s*\\+\\s*/ );\r\n}\r\n\r\n/**\r\n * Information about a keystroke.\r\n *\r\n * @interface module:utils/keyboard~KeystrokeInfo\r\n */\r\n\r\n/**\r\n * The [key code](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode).\r\n *\r\n * @member {Number} module:utils/keyboard~KeystrokeInfo#keyCode\r\n */\r\n\r\n/**\r\n * Whether the <kbd>Alt</kbd> modifier was pressed.\r\n *\r\n * @member {Bolean} module:utils/keyboard~KeystrokeInfo#altKey\r\n */\r\n\r\n/**\r\n * Whether the <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> modifier was pressed.\r\n *\r\n * @member {Bolean} module:utils/keyboard~KeystrokeInfo#ctrlKey\r\n */\r\n\r\n/**\r\n * Whether the <kbd>Shift</kbd> modifier was pressed.\r\n *\r\n * @member {Bolean} module:utils/keyboard~KeystrokeInfo#shiftKey\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/uielement\r\n */\r\n\r\nimport Element from './element';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport Node from './node';\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\n/**\r\n * UI element class. It should be used to represent editing UI which needs to be injected into the editing view\r\n * If possible, you should keep your UI outside the editing view. However, if that is not possible,\r\n * UI elements can be used.\r\n *\r\n * How a UI element is rendered is in your control (you pass a callback to\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createUIElement `downcastWriter#createUIElement()`}).\r\n * The editor will ignore your UI element – the selection cannot be placed in it, it is skipped (invisible) when\r\n * the user modifies the selection by using arrow keys and the editor does not listen to any mutations which\r\n * happen inside your UI elements.\r\n *\r\n * The limitation is that you cannot convert a model element to a UI element. UI elements need to be\r\n * created for {@link module:engine/model/markercollection~Marker markers} or as additinal elements\r\n * inside normal {@link module:engine/view/containerelement~ContainerElement container elements}.\r\n *\r\n * To create a new UI element use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter#createUIElement `downcastWriter#createUIElement()`} method.\r\n *\r\n * @extends module:engine/view/element~Element\r\n */\r\nexport default class UIElement extends Element {\r\n\t/**\r\n\t * Creates new instance of UIElement.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-uielement-cannot-add` when third parameter is passed,\r\n\t * to inform that usage of UIElement is incorrect (adding child nodes to UIElement is forbidden).\r\n\t *\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#createUIElement\r\n\t * @protected\r\n\t * @param {String} name Node name.\r\n\t * @param {Object|Iterable} [attributes] Collection of attributes.\r\n\t */\r\n\tconstructor( name, attributes, children ) {\r\n\t\tsuper( name, attributes, children );\r\n\r\n\t\t/**\r\n\t\t * Returns `null` because filler is not needed for UIElements.\r\n\t\t *\r\n\t\t * @method #getFillerOffset\r\n\t\t * @returns {null} Always returns null.\r\n\t\t */\r\n\t\tthis.getFillerOffset = getFillerOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'uiElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'uiElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides {@link module:engine/view/element~Element#_insertChild} method.\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-uielement-cannot-add` to prevent adding any child nodes\r\n\t * to UIElement.\r\n\t */\r\n\t_insertChild( index, nodes ) {\r\n\t\tif ( nodes && ( nodes instanceof Node || Array.from( nodes ).length > 0 ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot add children to {@link module:engine/view/uielement~UIElement}.\r\n\t\t\t *\r\n\t\t\t * @error view-uielement-cannot-add\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-uielement-cannot-add: Cannot add child nodes to UIElement instance.' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders this {@link module:engine/view/uielement~UIElement} to DOM. This method is called by\r\n\t * {@link module:engine/view/domconverter~DomConverter}.\r\n\t * Do not use inheritance to create custom rendering method, replace `render()` method instead:\r\n\t *\r\n\t *\t\tconst myUIElement = downcastWriter.createUIElement( 'span' );\r\n\t *\t\tmyUIElement.render = function( domDocument ) {\r\n\t *\t\t\tconst domElement = this.toDomElement( domDocument );\r\n\t *\t\t\tdomElement.innerHTML = '<b>this is ui element</b>';\r\n\t *\r\n\t *\t\t\treturn domElement;\r\n\t *\t\t};\r\n\t *\r\n\t * @param {Document} domDocument\r\n\t * @returns {HTMLElement}\r\n\t */\r\n\trender( domDocument ) {\r\n\t\treturn this.toDomElement( domDocument );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates DOM element based on this view UIElement.\r\n\t * Note that each time this method is called new DOM element is created.\r\n\t *\r\n\t * @param {Document} domDocument\r\n\t * @returns {HTMLElement}\r\n\t */\r\n\ttoDomElement( domDocument ) {\r\n\t\tconst domElement = domDocument.createElement( this.name );\r\n\r\n\t\tfor ( const key of this.getAttributeKeys() ) {\r\n\t\t\tdomElement.setAttribute( key, this.getAttribute( key ) );\r\n\t\t}\r\n\r\n\t\treturn domElement;\r\n\t}\r\n}\r\n\r\n/**\r\n * This function injects UI element handling to the given {@link module:engine/view/document~Document document}.\r\n *\r\n * A callback is added to {@link module:engine/view/document~Document#event:keydown document keydown event}.\r\n * The callback handles the situation when right arrow key is pressed and selection is collapsed before a UI element.\r\n * Without this handler, it would be impossible to \"jump over\" UI element using right arrow key.\r\n *\r\n * @param {module:engine/view/view~View} view View controller to which the quirks handling will be injected.\r\n */\r\nexport function injectUiElementHandling( view ) {\r\n\tview.document.on( 'keydown', ( evt, data ) => jumpOverUiElement( evt, data, view.domConverter ) );\r\n}\r\n\r\n// Returns `null` because block filler is not needed for UIElements.\r\n//\r\n// @returns {null}\r\nfunction getFillerOffset() {\r\n\treturn null;\r\n}\r\n\r\n// Selection cannot be placed in a `UIElement`. Whenever it is placed there, it is moved before it. This\r\n// causes a situation when it is impossible to jump over `UIElement` using right arrow key, because the selection\r\n// ends up in ui element (in DOM) and is moved back to the left. This handler fixes this situation.\r\nfunction jumpOverUiElement( evt, data, domConverter ) {\r\n\tif ( data.keyCode == keyCodes.arrowright ) {\r\n\t\tconst domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\r\n\t\tconst domSelectionCollapsed = domSelection.rangeCount == 1 && domSelection.getRangeAt( 0 ).collapsed;\r\n\r\n\t\t// Jump over UI element if selection is collapsed or shift key is pressed. These are the cases when selection would extend.\r\n\t\tif ( domSelectionCollapsed || data.shiftKey ) {\r\n\t\t\tconst domParent = domSelection.focusNode;\r\n\t\t\tconst domOffset = domSelection.focusOffset;\r\n\r\n\t\t\tconst viewPosition = domConverter.domPositionToView( domParent, domOffset );\r\n\r\n\t\t\t// In case if dom element is not converted to view or is not mapped or something. Happens for example in some tests.\r\n\t\t\tif ( viewPosition === null ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Skip all following ui elements.\r\n\t\t\tlet jumpedOverAnyUiElement = false;\r\n\r\n\t\t\tconst nextViewPosition = viewPosition.getLastMatchingPosition( value => {\r\n\t\t\t\tif ( value.item.is( 'uiElement' ) ) {\r\n\t\t\t\t\t// Remember that there was at least one ui element.\r\n\t\t\t\t\tjumpedOverAnyUiElement = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Jump over ui elements, jump over empty attribute elements, move up from inside of attribute element.\r\n\t\t\t\tif ( value.item.is( 'uiElement' ) || value.item.is( 'attributeElement' ) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Don't jump over text or don't get out of container element.\r\n\t\t\t\treturn false;\r\n\t\t\t} );\r\n\r\n\t\t\t// If anything has been skipped, fix position.\r\n\t\t\t// This `if` could be possibly omitted but maybe it is better not to mess with DOM selection if not needed.\r\n\t\t\tif ( jumpedOverAnyUiElement ) {\r\n\t\t\t\tconst newDomPosition = domConverter.viewPositionToDom( nextViewPosition );\r\n\r\n\t\t\t\tif ( domSelectionCollapsed ) {\r\n\t\t\t\t\t// Selection was collapsed, so collapse it at further position.\r\n\t\t\t\t\tdomSelection.collapse( newDomPosition.parent, newDomPosition.offset );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Selection was not collapse, so extend it instead of collapsing.\r\n\t\t\t\t\tdomSelection.extend( newDomPosition.parent, newDomPosition.offset );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/documentfragment\r\n */\r\n\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\n\r\n/**\r\n * Document fragment.\r\n *\r\n * To create a new document fragment instance use the\r\n * {@link module:engine/view/upcastwriter~UpcastWriter#createDocumentFragment `UpcastWriter#createDocumentFragment()`}\r\n * method.\r\n */\r\nexport default class DocumentFragment {\r\n\t/**\r\n\t * Creates new DocumentFragment instance.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/view/node~Node|Iterable.<module:engine/view/node~Node>} [children]\r\n\t * A list of nodes to be inserted into the created document fragment.\r\n\t */\r\n\tconstructor( children ) {\r\n\t\t/**\r\n\t\t * Array of child nodes.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Array.<module:engine/view/element~Element>} module:engine/view/documentfragment~DocumentFragment#_children\r\n\t\t */\r\n\t\tthis._children = [];\r\n\r\n\t\tif ( children ) {\r\n\t\t\tthis._insertChild( 0, children );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over nodes added to this document fragment.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/node~Node>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._children[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Number of child nodes in this document fragment.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget childCount() {\r\n\t\treturn this._children.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if there are no nodes inside this document fragment, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isEmpty() {\r\n\t\treturn this.childCount === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial root of `DocumentFragment`. Returns itself. Added for compatibility reasons.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial parent of `DocumentFragment`. Returns `null`. Added for compatibility reasons.\r\n\t *\r\n\t * @readonly\r\n\t * @type {null}\r\n\t */\r\n\tget parent() {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given view tree object is of given type.\r\n\t *\r\n\t * Read more in {@link module:engine/view/node~Node#is}.\r\n\t *\r\n\t * @param {String} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'documentFragment';\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment#_insertChild Insert} a child node or a list of child nodes at the end\r\n\t * and sets the parent of these nodes to this fragment.\r\n\t *\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @returns {Number} Number of appended nodes.\r\n\t */\r\n\t_appendChild( items ) {\r\n\t\treturn this._insertChild( this.childCount, items );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets child at the given index.\r\n\t *\r\n\t * @param {Number} index Index of child.\r\n\t * @returns {module:engine/view/node~Node} Child node.\r\n\t */\r\n\tgetChild( index ) {\r\n\t\treturn this._children[ index ];\r\n\t}\r\n\r\n\t/**\r\n\t * Gets index of the given child node. Returns `-1` if child node is not found.\r\n\t *\r\n\t * @param {module:engine/view/node~Node} node Child node.\r\n\t * @returns {Number} Index of the child node.\r\n\t */\r\n\tgetChildIndex( node ) {\r\n\t\treturn this._children.indexOf( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets child nodes iterator.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/view/node~Node>} Child nodes iterator.\r\n\t */\r\n\tgetChildren() {\r\n\t\treturn this._children[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a child node or a list of child nodes on the given index and sets the parent of these nodes to\r\n\t * this fragment.\r\n\t *\r\n\t * @param {Number} index Position where nodes should be inserted.\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @returns {Number} Number of inserted nodes.\r\n\t */\r\n\t_insertChild( index, items ) {\r\n\t\tthis._fireChange( 'children', this );\r\n\t\tlet count = 0;\r\n\r\n\t\tconst nodes = normalize( items );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\t// If node that is being added to this element is already inside another element, first remove it from the old parent.\r\n\t\t\tif ( node.parent !== null ) {\r\n\t\t\t\tnode._remove();\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = this;\r\n\r\n\t\t\tthis._children.splice( index, 0, node );\r\n\t\t\tindex++;\r\n\t\t\tcount++;\r\n\t\t}\r\n\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes number of child nodes starting at the given index and set the parent of these nodes to `null`.\r\n\t *\r\n\t * @param {Number} index Number of the first node to remove.\r\n\t * @param {Number} [howMany=1] Number of nodes to remove.\r\n\t * @returns {Array.<module:engine/view/node~Node>} The array of removed nodes.\r\n\t */\r\n\t_removeChildren( index, howMany = 1 ) {\r\n\t\tthis._fireChange( 'children', this );\r\n\r\n\t\tfor ( let i = index; i < index + howMany; i++ ) {\r\n\t\t\tthis._children[ i ].parent = null;\r\n\t\t}\r\n\r\n\t\treturn this._children.splice( index, howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Fires `change` event with given type of the change.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/document~ChangeType} type Type of the change.\r\n\t * @param {module:engine/view/node~Node} node Changed node.\r\n\t * @fires module:engine/view/node~Node#change\r\n\t */\r\n\t_fireChange( type, node ) {\r\n\t\tthis.fire( 'change:' + type, node );\r\n\t}\r\n}\r\n\r\nmix( DocumentFragment, EmitterMixin );\r\n\r\n// Converts strings to Text and non-iterables to arrays.\r\n//\r\n// @param {String|module:engine/view/item~Item|Iterable.<String|module:engine/view/item~Item>}\r\n// @returns {Iterable.<module:engine/view/node~Node>}\r\nfunction normalize( nodes ) {\r\n\t// Separate condition because string is iterable.\r\n\tif ( typeof nodes == 'string' ) {\r\n\t\treturn [ new Text( nodes ) ];\r\n\t}\r\n\r\n\tif ( !isIterable( nodes ) ) {\r\n\t\tnodes = [ nodes ];\r\n\t}\r\n\r\n\t// Array.from to enable .map() on non-arrays.\r\n\treturn Array.from( nodes )\r\n\t\t.map( node => {\r\n\t\t\tif ( typeof node == 'string' ) {\r\n\t\t\t\treturn new Text( node );\r\n\t\t\t}\r\n\r\n\t\t\tif ( node instanceof TextProxy ) {\r\n\t\t\t\treturn new Text( node.data );\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module module:engine/view/downcastwriter\r\n */\r\n\r\nimport Position from './position';\r\nimport Range from './range';\r\nimport Selection from './selection';\r\nimport ContainerElement from './containerelement';\r\nimport AttributeElement from './attributeelement';\r\nimport EmptyElement from './emptyelement';\r\nimport UIElement from './uielement';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport DocumentFragment from './documentfragment';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\nimport Text from './text';\r\nimport EditableElement from './editableelement';\r\nimport { isPlainObject } from 'lodash-es';\r\n\r\n/**\r\n * View downcast writer.\r\n *\r\n * It provides a set of methods used to manipulate view nodes.\r\n *\r\n * Do not create an instance of this writer manually. To modify a view structure, use\r\n * the {@link module:engine/view/view~View#change `View#change()`} block.\r\n *\r\n * The `DowncastWriter` is designed to work with semantic views which are the views that were/are being downcasted from the model.\r\n * To work with ordinary views (e.g. parsed from a pasted content) use the\r\n * {@link module:engine/view/upcastwriter~UpcastWriter upcast writer}.\r\n *\r\n * Read more about changing the view in the {@glink framework/guides/architecture/editing-engine#changing-the-view Changing the view}\r\n * section of the {@glink framework/guides/architecture/editing-engine Editing engine architecture} guide.\r\n */\r\nexport default class DowncastWriter {\r\n\tconstructor( document ) {\r\n\t\t/**\r\n\t\t * @readonly\r\n\t\t * @type {module:engine/view/document~Document}\r\n\t\t */\r\n\t\tthis.document = document;\r\n\r\n\t\t/**\r\n\t\t * Holds references to the attribute groups that share the same {@link module:engine/view/attributeelement~AttributeElement#id id}.\r\n\t\t * The keys are `id`s, the values are `Set`s holding {@link module:engine/view/attributeelement~AttributeElement}s.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Map.<String,Set>}\r\n\t\t */\r\n\t\tthis._cloneGroups = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets {@link module:engine/view/documentselection~DocumentSelection selection's} ranges and direction to the\r\n\t * specified location based on the given {@link module:engine/view/documentselection~DocumentSelection document selection},\r\n\t * {@link module:engine/view/selection~Selection selection}, {@link module:engine/view/position~Position position},\r\n\t * {@link module:engine/view/item~Item item}, {@link module:engine/view/range~Range range},\r\n\t * an iterable of {@link module:engine/view/range~Range ranges} or null.\r\n\t *\r\n\t * Usage:\r\n\t *\r\n\t *\t\t// Sets selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\twriter.setSelection( range );\r\n\t *\r\n\t *\t\t// Sets backward selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\twriter.setSelection( range );\r\n\t *\r\n\t *\t\t// Sets selection to given ranges.\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\twriter.setSelection( range );\r\n\t *\r\n\t *\t\t// Sets selection to the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\twriter.setSelection( otherSelection );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\twriter.setSelection( position );\r\n\t *\r\n\t * \t\t// Sets collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\r\n\t *\t\twriter.setSelection( paragraph, offset );\r\n\t *\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n \t * that element and ends after the last child of that element.\r\n\t *\r\n\t * \t\twriter.setSelection( paragraph, 'in' );\r\n\t *\r\n\t * Creates a range on the {@link module:engine/view/item~Item item} which starts before the item and ends just after the item.\r\n\t *\r\n\t *\t\twriter.setSelection( paragraph, 'on' );\r\n\t *\r\n\t * \t\t// Removes all ranges.\r\n\t *\t\twriter.setSelection( null );\r\n\t *\r\n\t * `DowncastWriter#setSelection()` allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Sets selection as backward.\r\n\t *\t\twriter.setSelection( range, { backward: true } );\r\n\t *\r\n\t *\t\t// Sets selection as fake.\r\n\t *\t\t// Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * \t\t// This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * \t\t// represented in other way, for example by applying proper CSS class.\r\n\t *\t\twriter.setSelection( range, { fake: true } );\r\n\t *\r\n\t * \t\t// Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * \t\t// (and be  properly handled by screen readers).\r\n\t *\t\twriter.setSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/position~Position|\r\n\t * Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|module:engine/view/item~Item|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t */\r\n\tsetSelection( selectable, placeOrOffset, options ) {\r\n\t\tthis.document.selection._setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link module:engine/view/documentselection~DocumentSelection#focus selection's focus} to the specified location.\r\n\t *\r\n\t * The location can be specified in the same form as {@link module:engine/view/view~View#createPositionAt view.createPositionAt()}\r\n\t * parameters.\r\n\t *\r\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tsetSelectionFocus( itemOrPosition, offset ) {\r\n\t\tthis.document.selection._setFocus( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/view/text~Text text node}.\r\n\t *\r\n\t *\t\twriter.createText( 'foo' );\r\n\t *\r\n\t * @param {String} data The text's data.\r\n\t * @returns {module:engine/view/text~Text} The created text node.\r\n\t */\r\n\tcreateText( data ) {\r\n\t\treturn new Text( data );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates new {@link module:engine/view/attributeelement~AttributeElement}.\r\n\t *\r\n\t *\t\twriter.createAttributeElement( 'strong' );\r\n\t *\t\twriter.createAttributeElement( 'strong', { alignment: 'center' } );\r\n\t *\r\n\t *\t\t// Make `<a>` element contain other attributes element so the `<a>` element is not broken.\r\n\t *\t\twriter.createAttributeElement( 'a', { href: 'foo.bar' }, { priority: 5 } );\r\n\t *\r\n\t *\t\t// Set `id` of a marker element so it is not joined or merged with \"normal\" elements.\r\n\t *\t\twriter.createAttributeElement( 'span', { class: 'myMarker' }, { id: 'marker:my' } );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Element's attributes.\r\n\t * @param {Object} [options] Element's options.\r\n\t * @param {Number} [options.priority] Element's {@link module:engine/view/attributeelement~AttributeElement#priority priority}.\r\n\t * @param {Number|String} [options.id] Element's {@link module:engine/view/attributeelement~AttributeElement#id id}.\r\n\t * @returns {module:engine/view/attributeelement~AttributeElement} Created element.\r\n\t */\r\n\tcreateAttributeElement( name, attributes, options = {} ) {\r\n\t\tconst attributeElement = new AttributeElement( name, attributes );\r\n\r\n\t\tif ( options.priority ) {\r\n\t\t\tattributeElement._priority = options.priority;\r\n\t\t}\r\n\r\n\t\tif ( options.id ) {\r\n\t\t\tattributeElement._id = options.id;\r\n\t\t}\r\n\r\n\t\treturn attributeElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates new {@link module:engine/view/containerelement~ContainerElement}.\r\n\t *\r\n\t *\t\twriter.createContainerElement( 'paragraph' );\r\n\t *\t\twriter.createContainerElement( 'paragraph', { alignment: 'center' } );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @returns {module:engine/view/containerelement~ContainerElement} Created element.\r\n\t */\r\n\tcreateContainerElement( name, attributes ) {\r\n\t\treturn new ContainerElement( name, attributes );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates new {@link module:engine/view/editableelement~EditableElement}.\r\n\t *\r\n\t *\t\twriter.createEditableElement( 'div' );\r\n\t *\t\twriter.createEditableElement( 'div', { alignment: 'center' } );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @returns {module:engine/view/editableelement~EditableElement} Created element.\r\n\t */\r\n\tcreateEditableElement( name, attributes ) {\r\n\t\tconst editableElement = new EditableElement( name, attributes );\r\n\t\teditableElement._document = this.document;\r\n\r\n\t\treturn editableElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates new {@link module:engine/view/emptyelement~EmptyElement}.\r\n\t *\r\n\t *\t\twriter.createEmptyElement( 'img' );\r\n\t *\t\twriter.createEmptyElement( 'img', { alignment: 'center' } );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @returns {module:engine/view/emptyelement~EmptyElement} Created element.\r\n\t */\r\n\tcreateEmptyElement( name, attributes ) {\r\n\t\treturn new EmptyElement( name, attributes );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates new {@link module:engine/view/uielement~UIElement}.\r\n\t *\r\n\t *\t\twriter.createUIElement( 'span' );\r\n\t *\t\twriter.createUIElement( 'span', { alignment: 'center' } );\r\n\t *\r\n\t * Custom render function can be provided as third parameter:\r\n\t *\r\n\t *\t\twriter.createUIElement( 'span', null, function( domDocument ) {\r\n\t *\t\t\tconst domElement = this.toDomElement( domDocument );\r\n\t *\t\t\tdomElement.innerHTML = '<b>this is ui element</b>';\r\n\t *\r\n\t *\t\t\treturn domElement;\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @param {Function} [renderFunction] Custom render function.\r\n\t * @returns {module:engine/view/uielement~UIElement} Created element.\r\n\t */\r\n\tcreateUIElement( name, attributes, renderFunction ) {\r\n\t\tconst uiElement = new UIElement( name, attributes );\r\n\r\n\t\tif ( renderFunction ) {\r\n\t\t\tuiElement.render = renderFunction;\r\n\t\t}\r\n\r\n\t\treturn uiElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds or overwrite element's attribute with a specified key and value.\r\n\t *\r\n\t *\t\twriter.setAttribute( 'href', 'http://ckeditor.com', linkElement );\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @param {String} value Attribute value.\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\tsetAttribute( key, value, element ) {\r\n\t\telement._setAttribute( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes attribute from the element.\r\n\t *\r\n\t *\t\twriter.removeAttribute( 'href', linkElement );\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\tremoveAttribute( key, element ) {\r\n\t\telement._removeAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds specified class to the element.\r\n\t *\r\n\t *\t\twriter.addClass( 'foo', linkElement );\r\n\t *\t\twriter.addClass( [ 'foo', 'bar' ], linkElement );\r\n\t *\r\n\t * @param {Array.<String>|String} className\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\taddClass( className, element ) {\r\n\t\telement._addClass( className );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified class from the element.\r\n\t *\r\n\t *\t\twriter.removeClass( 'foo', linkElement );\r\n\t *\t\twriter.removeClass( [ 'foo', 'bar' ], linkElement );\r\n\t *\r\n\t * @param {Array.<String>|String} className\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\tremoveClass( className, element ) {\r\n\t\telement._removeClass( className );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds style to the element.\r\n\t *\r\n\t *\t\twriter.setStyle( 'color', 'red', element );\r\n\t *\t\twriter.setStyle( {\r\n\t *\t\t\tcolor: 'red',\r\n\t *\t\t\tposition: 'fixed'\r\n\t *\t\t}, element );\r\n\t *\r\n\t * @param {String|Object} property Property name or object with key - value pairs.\r\n\t * @param {String} [value] Value to set. This parameter is ignored if object is provided as the first parameter.\r\n\t * @param {module:engine/view/element~Element} element Element to set styles on.\r\n\t */\r\n\tsetStyle( property, value, element ) {\r\n\t\tif ( isPlainObject( property ) && element === undefined ) {\r\n\t\t\telement = value;\r\n\t\t}\r\n\r\n\t\telement._setStyle( property, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified style from the element.\r\n\t *\r\n\t *\t\twriter.removeStyle( 'color', element );  // Removes 'color' style.\r\n\t *\t\twriter.removeStyle( [ 'color', 'border-top' ], element ); // Removes both 'color' and 'border-top' styles.\r\n\t *\r\n\t * @param {Array.<String>|String} property\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\tremoveStyle( property, element ) {\r\n\t\telement._removeStyle( property );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a custom property on element. Unlike attributes, custom properties are not rendered to the DOM,\r\n\t * so they can be used to add special data to elements.\r\n\t *\r\n\t * @param {String|Symbol} key\r\n\t * @param {*} value\r\n\t * @param {module:engine/view/element~Element} element\r\n\t */\r\n\tsetCustomProperty( key, value, element ) {\r\n\t\telement._setCustomProperty( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a custom property stored under the given key.\r\n\t *\r\n\t * @param {String|Symbol} key\r\n\t * @param {module:engine/view/element~Element} element\r\n\t * @returns {Boolean} Returns true if property was removed.\r\n\t */\r\n\tremoveCustomProperty( key, element ) {\r\n\t\treturn element._removeCustomProperty( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Breaks attribute nodes at provided position or at boundaries of provided range. It breaks attribute elements inside\r\n\t * up to a container element.\r\n\t *\r\n\t * In following examples `<p>` is a container, `<b>` and `<u>` are attribute nodes:\r\n\t *\r\n\t *        <p>foo<b><u>bar{}</u></b></p> -> <p>foo<b><u>bar</u></b>[]</p>\r\n\t *        <p>foo<b><u>{}bar</u></b></p> -> <p>foo{}<b><u>bar</u></b></p>\r\n\t *        <p>foo<b><u>b{}ar</u></b></p> -> <p>foo<b><u>b</u></b>[]<b><u>ar</u></b></p>\r\n\t *        <p><b>fo{o</b><u>ba}r</u></p> -> <p><b>fo</b><b>o</b><u>ba</u><u>r</u></b></p>\r\n\t *\r\n\t * **Note:** {@link module:engine/view/documentfragment~DocumentFragment DocumentFragment} is treated like a container.\r\n\t *\r\n\t * **Note:** Difference between {@link module:engine/view/downcastwriter~DowncastWriter#breakAttributes breakAttributes} and\r\n\t * {@link module:engine/view/downcastwriter~DowncastWriter#breakContainer breakContainer} is that `breakAttributes` breaks all\r\n\t * {@link module:engine/view/attributeelement~AttributeElement attribute elements} that are ancestors of given `position`,\r\n\t * up to the first encountered {@link module:engine/view/containerelement~ContainerElement container element}.\r\n\t * `breakContainer` assumes that given `position` is directly in container element and breaks that container element.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container`\r\n\t * when {@link module:engine/view/range~Range#start start}\r\n\t * and {@link module:engine/view/range~Range#end end} positions of a passed range are not placed inside same parent container.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-cannot-break-empty-element`\r\n\t * when trying to break attributes\r\n\t * inside {@link module:engine/view/emptyelement~EmptyElement EmptyElement}.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-cannot-break-ui-element`\r\n\t * when trying to break attributes\r\n\t * inside {@link module:engine/view/uielement~UIElement UIElement}.\r\n\t *\r\n\t * @see module:engine/view/attributeelement~AttributeElement\r\n\t * @see module:engine/view/containerelement~ContainerElement\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#breakContainer\r\n\t * @param {module:engine/view/position~Position|module:engine/view/range~Range} positionOrRange Position where\r\n\t * to break attribute elements.\r\n\t * @returns {module:engine/view/position~Position|module:engine/view/range~Range} New position or range, after breaking the attribute\r\n\t * elements.\r\n\t */\r\n\tbreakAttributes( positionOrRange ) {\r\n\t\tif ( positionOrRange instanceof Position ) {\r\n\t\t\treturn this._breakAttributes( positionOrRange );\r\n\t\t} else {\r\n\t\t\treturn this._breakAttributesRange( positionOrRange );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Breaks {@link module:engine/view/containerelement~ContainerElement container view element} into two, at the given position. Position\r\n\t * has to be directly inside container element and cannot be in root. Does not break if position is at the beginning\r\n\t * or at the end of it's parent element.\r\n\t *\r\n\t *        <p>foo^bar</p> -> <p>foo</p><p>bar</p>\r\n\t *        <div><p>foo</p>^<p>bar</p></div> -> <div><p>foo</p></div><div><p>bar</p></div>\r\n\t *        <p>^foobar</p> -> ^<p>foobar</p>\r\n\t *        <p>foobar^</p> -> <p>foobar</p>^\r\n\t *\r\n\t * **Note:** Difference between {@link module:engine/view/downcastwriter~DowncastWriter#breakAttributes breakAttributes} and\r\n\t * {@link module:engine/view/downcastwriter~DowncastWriter#breakContainer breakContainer} is that `breakAttributes` breaks all\r\n\t * {@link module:engine/view/attributeelement~AttributeElement attribute elements} that are ancestors of given `position`,\r\n\t * up to the first encountered {@link module:engine/view/containerelement~ContainerElement container element}.\r\n\t * `breakContainer` assumes that given `position` is directly in container element and breaks that container element.\r\n\t *\r\n\t * @see module:engine/view/attributeelement~AttributeElement\r\n\t * @see module:engine/view/containerelement~ContainerElement\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#breakAttributes\r\n\t * @param {module:engine/view/position~Position} position Position where to break element.\r\n\t * @returns {module:engine/view/position~Position} Position between broken elements. If element has not been broken,\r\n\t * the returned position is placed either before it or after it.\r\n\t */\r\n\tbreakContainer( position ) {\r\n\t\tconst element = position.parent;\r\n\r\n\t\tif ( !( element.is( 'containerElement' ) ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to break an element which is not a container element.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-break-non-container-element\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'view-writer-break-non-container-element: Trying to break an element which is not a container element.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( !element.parent ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to break root element.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-break-root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-break-root: Trying to break root element.' );\r\n\t\t}\r\n\r\n\t\tif ( position.isAtStart ) {\r\n\t\t\treturn Position._createBefore( element );\r\n\t\t} else if ( !position.isAtEnd ) {\r\n\t\t\tconst newElement = element._clone( false );\r\n\r\n\t\t\tthis.insert( Position._createAfter( element ), newElement );\r\n\r\n\t\t\tconst sourceRange = new Range( position, Position._createAt( element, 'end' ) );\r\n\t\t\tconst targetPosition = new Position( newElement, 0 );\r\n\r\n\t\t\tthis.move( sourceRange, targetPosition );\r\n\t\t}\r\n\r\n\t\treturn Position._createAfter( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Merges {@link module:engine/view/attributeelement~AttributeElement attribute elements}. It also merges text nodes if needed.\r\n\t * Only {@link module:engine/view/attributeelement~AttributeElement#isSimilar similar} attribute elements can be merged.\r\n\t *\r\n\t * In following examples `<p>` is a container and `<b>` is an attribute element:\r\n\t *\r\n\t *        <p>foo[]bar</p> -> <p>foo{}bar</p>\r\n\t *        <p><b>foo</b>[]<b>bar</b></p> -> <p><b>foo{}bar</b></p>\r\n\t *        <p><b foo=\"bar\">a</b>[]<b foo=\"baz\">b</b></p> -> <p><b foo=\"bar\">a</b>[]<b foo=\"baz\">b</b></p>\r\n\t *\r\n\t * It will also take care about empty attributes when merging:\r\n\t *\r\n\t *        <p><b>[]</b></p> -> <p>[]</p>\r\n\t *        <p><b>foo</b><i>[]</i><b>bar</b></p> -> <p><b>foo{}bar</b></p>\r\n\t *\r\n\t * **Note:** Difference between {@link module:engine/view/downcastwriter~DowncastWriter#mergeAttributes mergeAttributes} and\r\n\t * {@link module:engine/view/downcastwriter~DowncastWriter#mergeContainers mergeContainers} is that `mergeAttributes` merges two\r\n\t * {@link module:engine/view/attributeelement~AttributeElement attribute elements} or {@link module:engine/view/text~Text text nodes}\r\n\t * while `mergeContainer` merges two {@link module:engine/view/containerelement~ContainerElement container elements}.\r\n\t *\r\n\t * @see module:engine/view/attributeelement~AttributeElement\r\n\t * @see module:engine/view/containerelement~ContainerElement\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#mergeContainers\r\n\t * @param {module:engine/view/position~Position} position Merge position.\r\n\t * @returns {module:engine/view/position~Position} Position after merge.\r\n\t */\r\n\tmergeAttributes( position ) {\r\n\t\tconst positionOffset = position.offset;\r\n\t\tconst positionParent = position.parent;\r\n\r\n\t\t// When inside text node - nothing to merge.\r\n\t\tif ( positionParent.is( 'text' ) ) {\r\n\t\t\treturn position;\r\n\t\t}\r\n\r\n\t\t// When inside empty attribute - remove it.\r\n\t\tif ( positionParent.is( 'attributeElement' ) && positionParent.childCount === 0 ) {\r\n\t\t\tconst parent = positionParent.parent;\r\n\t\t\tconst offset = positionParent.index;\r\n\r\n\t\t\tpositionParent._remove();\r\n\t\t\tthis._removeFromClonedElementsGroup( positionParent );\r\n\r\n\t\t\treturn this.mergeAttributes( new Position( parent, offset ) );\r\n\t\t}\r\n\r\n\t\tconst nodeBefore = positionParent.getChild( positionOffset - 1 );\r\n\t\tconst nodeAfter = positionParent.getChild( positionOffset );\r\n\r\n\t\t// Position should be placed between two nodes.\r\n\t\tif ( !nodeBefore || !nodeAfter ) {\r\n\t\t\treturn position;\r\n\t\t}\r\n\r\n\t\t// When position is between two text nodes.\r\n\t\tif ( nodeBefore.is( 'text' ) && nodeAfter.is( 'text' ) ) {\r\n\t\t\treturn mergeTextNodes( nodeBefore, nodeAfter );\r\n\t\t}\r\n\t\t// When position is between two same attribute elements.\r\n\t\telse if ( nodeBefore.is( 'attributeElement' ) && nodeAfter.is( 'attributeElement' ) && nodeBefore.isSimilar( nodeAfter ) ) {\r\n\t\t\t// Move all children nodes from node placed after selection and remove that node.\r\n\t\t\tconst count = nodeBefore.childCount;\r\n\t\t\tnodeBefore._appendChild( nodeAfter.getChildren() );\r\n\r\n\t\t\tnodeAfter._remove();\r\n\t\t\tthis._removeFromClonedElementsGroup( nodeAfter );\r\n\r\n\t\t\t// New position is located inside the first node, before new nodes.\r\n\t\t\t// Call this method recursively to merge again if needed.\r\n\t\t\treturn this.mergeAttributes( new Position( nodeBefore, count ) );\r\n\t\t}\r\n\r\n\t\treturn position;\r\n\t}\r\n\r\n\t/**\r\n\t * Merges two {@link module:engine/view/containerelement~ContainerElement container elements} that are before and after given position.\r\n\t * Precisely, the element after the position is removed and it's contents are moved to element before the position.\r\n\t *\r\n\t *        <p>foo</p>^<p>bar</p> -> <p>foo^bar</p>\r\n\t *        <div>foo</div>^<p>bar</p> -> <div>foo^bar</div>\r\n\t *\r\n\t * **Note:** Difference between {@link module:engine/view/downcastwriter~DowncastWriter#mergeAttributes mergeAttributes} and\r\n\t * {@link module:engine/view/downcastwriter~DowncastWriter#mergeContainers mergeContainers} is that `mergeAttributes` merges two\r\n\t * {@link module:engine/view/attributeelement~AttributeElement attribute elements} or {@link module:engine/view/text~Text text nodes}\r\n\t * while `mergeContainer` merges two {@link module:engine/view/containerelement~ContainerElement container elements}.\r\n\t *\r\n\t * @see module:engine/view/attributeelement~AttributeElement\r\n\t * @see module:engine/view/containerelement~ContainerElement\r\n\t * @see module:engine/view/downcastwriter~DowncastWriter#mergeAttributes\r\n\t * @param {module:engine/view/position~Position} position Merge position.\r\n\t * @returns {module:engine/view/position~Position} Position after merge.\r\n\t */\r\n\tmergeContainers( position ) {\r\n\t\tconst prev = position.nodeBefore;\r\n\t\tconst next = position.nodeAfter;\r\n\r\n\t\tif ( !prev || !next || !prev.is( 'containerElement' ) || !next.is( 'containerElement' ) ) {\r\n\t\t\t/**\r\n\t\t\t * Element before and after given position cannot be merged.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-merge-containers-invalid-position\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-merge-containers-invalid-position: ' +\r\n\t\t\t\t'Element before and after given position cannot be merged.' );\r\n\t\t}\r\n\r\n\t\tconst lastChild = prev.getChild( prev.childCount - 1 );\r\n\t\tconst newPosition = lastChild instanceof Text ? Position._createAt( lastChild, 'end' ) : Position._createAt( prev, 'end' );\r\n\r\n\t\tthis.move( Range._createIn( next ), Position._createAt( prev, 'end' ) );\r\n\t\tthis.remove( Range._createOn( next ) );\r\n\r\n\t\treturn newPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Insert node or nodes at specified position. Takes care about breaking attributes before insertion\r\n\t * and merging them afterwards.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-insert-invalid-node` when nodes to insert\r\n\t * contains instances that are not {@link module:engine/view/text~Text Texts},\r\n\t * {@link module:engine/view/attributeelement~AttributeElement AttributeElements},\r\n\t * {@link module:engine/view/containerelement~ContainerElement ContainerElements},\r\n\t * {@link module:engine/view/emptyelement~EmptyElement EmptyElements} or\r\n\t * {@link module:engine/view/uielement~UIElement UIElements}.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} position Insertion position.\r\n\t * @param {module:engine/view/text~Text|module:engine/view/attributeelement~AttributeElement|\r\n\t * module:engine/view/containerelement~ContainerElement|module:engine/view/emptyelement~EmptyElement|\r\n\t * module:engine/view/uielement~UIElement|Iterable.<module:engine/view/text~Text|\r\n\t * module:engine/view/attributeelement~AttributeElement|module:engine/view/containerelement~ContainerElement|\r\n\t * module:engine/view/emptyelement~EmptyElement|module:engine/view/uielement~UIElement>} nodes Node or nodes to insert.\r\n\t * @returns {module:engine/view/range~Range} Range around inserted nodes.\r\n\t */\r\n\tinsert( position, nodes ) {\r\n\t\tnodes = isIterable( nodes ) ? [ ...nodes ] : [ nodes ];\r\n\r\n\t\t// Check if nodes to insert are instances of AttributeElements, ContainerElements, EmptyElements, UIElements or Text.\r\n\t\tvalidateNodesToInsert( nodes );\r\n\r\n\t\tconst container = getParentContainer( position );\r\n\r\n\t\tif ( !container ) {\r\n\t\t\t/**\r\n\t\t\t * Position's parent container cannot be found.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-invalid-position-container\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-invalid-position-container' );\r\n\t\t}\r\n\r\n\t\tconst insertionPosition = this._breakAttributes( position, true );\r\n\t\tconst length = container._insertChild( insertionPosition.offset, nodes );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\tthis._addToClonedElementsGroup( node );\r\n\t\t}\r\n\r\n\t\tconst endPosition = insertionPosition.getShiftedBy( length );\r\n\t\tconst start = this.mergeAttributes( insertionPosition );\r\n\r\n\t\t// When no nodes were inserted - return collapsed range.\r\n\t\tif ( length === 0 ) {\r\n\t\t\treturn new Range( start, start );\r\n\t\t} else {\r\n\t\t\t// If start position was merged - move end position.\r\n\t\t\tif ( !start.isEqual( insertionPosition ) ) {\r\n\t\t\t\tendPosition.offset--;\r\n\t\t\t}\r\n\r\n\t\t\tconst end = this.mergeAttributes( endPosition );\r\n\r\n\t\t\treturn new Range( start, end );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes provided range from the container.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container` when\r\n\t * {@link module:engine/view/range~Range#start start} and {@link module:engine/view/range~Range#end end} positions are not placed inside\r\n\t * same parent container.\r\n\t *\r\n\t * @param {module:engine/view/range~Range|module:engine/view/item~Item} rangeOrItem Range to remove from container\r\n\t * or an {@link module:engine/view/item~Item item} to remove. If range is provided, after removing, it will be updated\r\n\t * to a collapsed range showing the new position.\r\n\t * @returns {module:engine/view/documentfragment~DocumentFragment} Document fragment containing removed nodes.\r\n\t */\r\n\tremove( rangeOrItem ) {\r\n\t\tconst range = rangeOrItem instanceof Range ? rangeOrItem : Range._createOn( rangeOrItem );\r\n\r\n\t\tvalidateRangeContainer( range );\r\n\r\n\t\t// If range is collapsed - nothing to remove.\r\n\t\tif ( range.isCollapsed ) {\r\n\t\t\treturn new DocumentFragment();\r\n\t\t}\r\n\r\n\t\t// Break attributes at range start and end.\r\n\t\tconst { start: breakStart, end: breakEnd } = this._breakAttributesRange( range, true );\r\n\t\tconst parentContainer = breakStart.parent;\r\n\r\n\t\tconst count = breakEnd.offset - breakStart.offset;\r\n\r\n\t\t// Remove nodes in range.\r\n\t\tconst removed = parentContainer._removeChildren( breakStart.offset, count );\r\n\r\n\t\tfor ( const node of removed ) {\r\n\t\t\tthis._removeFromClonedElementsGroup( node );\r\n\t\t}\r\n\r\n\t\t// Merge after removing.\r\n\t\tconst mergePosition = this.mergeAttributes( breakStart );\r\n\t\trange.start = mergePosition;\r\n\t\trange.end = mergePosition.clone();\r\n\r\n\t\t// Return removed nodes.\r\n\t\treturn new DocumentFragment( removed );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes matching elements from given range.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container` when\r\n\t * {@link module:engine/view/range~Range#start start} and {@link module:engine/view/range~Range#end end} positions are not placed inside\r\n\t * same parent container.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} range Range to clear.\r\n\t * @param {module:engine/view/element~Element} element Element to remove.\r\n\t */\r\n\tclear( range, element ) {\r\n\t\tvalidateRangeContainer( range );\r\n\r\n\t\t// Create walker on given range.\r\n\t\t// We walk backward because when we remove element during walk it modifies range end position.\r\n\t\tconst walker = range.getWalker( {\r\n\t\t\tdirection: 'backward',\r\n\t\t\tignoreElementEnd: true\r\n\t\t} );\r\n\r\n\t\t// Let's walk.\r\n\t\tfor ( const current of walker ) {\r\n\t\t\tconst item = current.item;\r\n\t\t\tlet rangeToRemove;\r\n\r\n\t\t\t// When current item matches to the given element.\r\n\t\t\tif ( item.is( 'element' ) && element.isSimilar( item ) ) {\r\n\t\t\t\t// Create range on this element.\r\n\t\t\t\trangeToRemove = Range._createOn( item );\r\n\t\t\t\t// When range starts inside Text or TextProxy element.\r\n\t\t\t} else if ( !current.nextPosition.isAfter( range.start ) && item.is( 'textProxy' ) ) {\r\n\t\t\t\t// We need to check if parent of this text matches to given element.\r\n\t\t\t\tconst parentElement = item.getAncestors().find( ancestor => {\r\n\t\t\t\t\treturn ancestor.is( 'element' ) && element.isSimilar( ancestor );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t// If it is then create range inside this element.\r\n\t\t\t\tif ( parentElement ) {\r\n\t\t\t\t\trangeToRemove = Range._createIn( parentElement );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If we have found element to remove.\r\n\t\t\tif ( rangeToRemove ) {\r\n\t\t\t\t// We need to check if element range stick out of the given range and truncate if it is.\r\n\t\t\t\tif ( rangeToRemove.end.isAfter( range.end ) ) {\r\n\t\t\t\t\trangeToRemove.end = range.end;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( rangeToRemove.start.isBefore( range.start ) ) {\r\n\t\t\t\t\trangeToRemove.start = range.start;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// At the end we remove range with found element.\r\n\t\t\t\tthis.remove( rangeToRemove );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Moves nodes from provided range to target position.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container` when\r\n\t * {@link module:engine/view/range~Range#start start} and {@link module:engine/view/range~Range#end end} positions are not placed inside\r\n\t * same parent container.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} sourceRange Range containing nodes to move.\r\n\t * @param {module:engine/view/position~Position} targetPosition Position to insert.\r\n\t * @returns {module:engine/view/range~Range} Range in target container. Inserted nodes are placed between\r\n\t * {@link module:engine/view/range~Range#start start} and {@link module:engine/view/range~Range#end end} positions.\r\n\t */\r\n\tmove( sourceRange, targetPosition ) {\r\n\t\tlet nodes;\r\n\r\n\t\tif ( targetPosition.isAfter( sourceRange.end ) ) {\r\n\t\t\ttargetPosition = this._breakAttributes( targetPosition, true );\r\n\r\n\t\t\tconst parent = targetPosition.parent;\r\n\t\t\tconst countBefore = parent.childCount;\r\n\r\n\t\t\tsourceRange = this._breakAttributesRange( sourceRange, true );\r\n\r\n\t\t\tnodes = this.remove( sourceRange );\r\n\r\n\t\t\ttargetPosition.offset += ( parent.childCount - countBefore );\r\n\t\t} else {\r\n\t\t\tnodes = this.remove( sourceRange );\r\n\t\t}\r\n\r\n\t\treturn this.insert( targetPosition, nodes );\r\n\t}\r\n\r\n\t/**\r\n     * Wraps elements within range with provided {@link module:engine/view/attributeelement~AttributeElement AttributeElement}.\r\n     * If a collapsed range is provided, it will be wrapped only if it is equal to view selection.\r\n     *\r\n     * If a collapsed range was passed and is same as selection, the selection\r\n     * will be moved to the inside of the wrapped attribute element.\r\n     *\r\n     * Throws {@link module:utils/ckeditorerror~CKEditorError} `view-writer-invalid-range-container`\r\n     * when {@link module:engine/view/range~Range#start}\r\n     * and {@link module:engine/view/range~Range#end} positions are not placed inside same parent container.\r\n     *\r\n     * Throws {@link module:utils/ckeditorerror~CKEditorError} `view-writer-wrap-invalid-attribute` when passed attribute element is not\r\n     * an instance of {@link module:engine/view/attributeelement~AttributeElement AttributeElement}.\r\n     *\r\n     * Throws {@link module:utils/ckeditorerror~CKEditorError} `view-writer-wrap-nonselection-collapsed-range` when passed range\r\n     * is collapsed and different than view selection.\r\n     *\r\n     * @param {module:engine/view/range~Range} range Range to wrap.\r\n     * @param {module:engine/view/attributeelement~AttributeElement} attribute Attribute element to use as wrapper.\r\n     * @returns {module:engine/view/range~Range} range Range after wrapping, spanning over wrapping attribute element.\r\n    */\r\n\twrap( range, attribute ) {\r\n\t\tif ( !( attribute instanceof AttributeElement ) ) {\r\n\t\t\tthrow new CKEditorError( 'view-writer-wrap-invalid-attribute' );\r\n\t\t}\r\n\r\n\t\tvalidateRangeContainer( range );\r\n\r\n\t\tif ( !range.isCollapsed ) {\r\n\t\t\t// Non-collapsed range. Wrap it with the attribute element.\r\n\t\t\treturn this._wrapRange( range, attribute );\r\n\t\t} else {\r\n\t\t\t// Collapsed range. Wrap position.\r\n\t\t\tlet position = range.start;\r\n\r\n\t\t\tif ( position.parent.is( 'element' ) && !_hasNonUiChildren( position.parent ) ) {\r\n\t\t\t\tposition = position.getLastMatchingPosition( value => value.item.is( 'uiElement' ) );\r\n\t\t\t}\r\n\r\n\t\t\tposition = this._wrapPosition( position, attribute );\r\n\t\t\tconst viewSelection = this.document.selection;\r\n\r\n\t\t\t// If wrapping position is equal to view selection, move view selection inside wrapping attribute element.\r\n\t\t\tif ( viewSelection.isCollapsed && viewSelection.getFirstPosition().isEqual( range.start ) ) {\r\n\t\t\t\tthis.setSelection( position );\r\n\t\t\t}\r\n\r\n\t\t\treturn new Range( position );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unwraps nodes within provided range from attribute element.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container` when\r\n\t * {@link module:engine/view/range~Range#start start} and {@link module:engine/view/range~Range#end end} positions are not placed inside\r\n\t * same parent container.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} range\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} attribute\r\n\t */\r\n\tunwrap( range, attribute ) {\r\n\t\tif ( !( attribute instanceof AttributeElement ) ) {\r\n\t\t\t/**\r\n\t\t\t * Attribute element need to be instance of attribute element.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-unwrap-invalid-attribute\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-unwrap-invalid-attribute' );\r\n\t\t}\r\n\r\n\t\tvalidateRangeContainer( range );\r\n\r\n\t\t// If range is collapsed - nothing to unwrap.\r\n\t\tif ( range.isCollapsed ) {\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\t// Break attributes at range start and end.\r\n\t\tconst { start: breakStart, end: breakEnd } = this._breakAttributesRange( range, true );\r\n\r\n\t\t// Range around one element - check if AttributeElement can be unwrapped partially when it's not similar.\r\n\t\t// For example:\r\n\t\t// <b class=\"foo bar\" title=\"baz\"></b> unwrap with:\t<b class=\"foo\"></p> result: <b class\"bar\" title=\"baz\"></b>\r\n\t\tif ( breakEnd.isEqual( breakStart.getShiftedBy( 1 ) ) ) {\r\n\t\t\tconst node = breakStart.nodeAfter;\r\n\r\n\t\t\t// Unwrap single attribute element.\r\n\t\t\tif ( !attribute.isSimilar( node ) && node instanceof AttributeElement && this._unwrapAttributeElement( attribute, node ) ) {\r\n\t\t\t\tconst start = this.mergeAttributes( breakStart );\r\n\r\n\t\t\t\tif ( !start.isEqual( breakStart ) ) {\r\n\t\t\t\t\tbreakEnd.offset--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst end = this.mergeAttributes( breakEnd );\r\n\r\n\t\t\t\treturn new Range( start, end );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst parentContainer = breakStart.parent;\r\n\r\n\t\t// Unwrap children located between break points.\r\n\t\tconst newRange = this._unwrapChildren( parentContainer, breakStart.offset, breakEnd.offset, attribute );\r\n\r\n\t\t// Merge attributes at the both ends and return a new range.\r\n\t\tconst start = this.mergeAttributes( newRange.start );\r\n\r\n\t\t// If start position was merged - move end position back.\r\n\t\tif ( !start.isEqual( newRange.start ) ) {\r\n\t\t\tnewRange.end.offset--;\r\n\t\t}\r\n\r\n\t\tconst end = this.mergeAttributes( newRange.end );\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Renames element by creating a copy of renamed element but with changed name and then moving contents of the\r\n\t * old element to the new one. Keep in mind that this will invalidate all {@link module:engine/view/position~Position positions} which\r\n\t * has renamed element as {@link module:engine/view/position~Position#parent a parent}.\r\n\t *\r\n\t * New element has to be created because `Element#tagName` property in DOM is readonly.\r\n\t *\r\n\t * Since this function creates a new element and removes the given one, the new element is returned to keep reference.\r\n\t *\r\n\t * @param {String} newName New name for element.\r\n\t * @param {module:engine/view/containerelement~ContainerElement} viewElement Element to be renamed.\r\n\t */\r\n\trename( newName, viewElement ) {\r\n\t\tconst newElement = new ContainerElement( newName, viewElement.getAttributes() );\r\n\r\n\t\tthis.insert( Position._createAfter( viewElement ), newElement );\r\n\t\tthis.move( Range._createIn( viewElement ), Position._createAt( newElement, 0 ) );\r\n\t\tthis.remove( Range._createOn( viewElement ) );\r\n\r\n\t\treturn newElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up memory by removing obsolete cloned elements group from the writer.\r\n\t *\r\n\t * Should be used whenever all {@link module:engine/view/attributeelement~AttributeElement attribute elements}\r\n\t * with the same {@link module:engine/view/attributeelement~AttributeElement#id id} are going to be removed from the view and\r\n\t * the group will no longer be needed.\r\n\t *\r\n\t * Cloned elements group are not removed automatically in case if the group is still needed after all its elements\r\n\t * were removed from the view.\r\n\t *\r\n\t * Keep in mind that group names are equal to the `id` property of the attribute element.\r\n\t *\r\n\t * @param {String} groupName Name of the group to clear.\r\n\t */\r\n\tclearClonedElementsGroup( groupName ) {\r\n\t\tthis._cloneGroups.delete( groupName );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/view/position~Position position},\r\n\t * * parent element and offset (offset defaults to `0`),\r\n\t * * parent element and `'end'` (sets position at the end of that element),\r\n\t * * {@link module:engine/view/item~Item view item} and `'before'` or `'after'` (sets position before or after given view item).\r\n\t *\r\n\t * This method is a shortcut to other constructors such as:\r\n\t *\r\n\t * * {@link #createPositionBefore},\r\n\t * * {@link #createPositionAfter},\r\n\t *\r\n\t * @param {module:engine/view/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tcreatePositionAt( itemOrPosition, offset ) {\r\n\t\treturn Position._createAt( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position after given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item after which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionAfter( item ) {\r\n\t\treturn Position._createAfter( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position before given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item before which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionBefore( item ) {\r\n\t\treturn Position._createBefore( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range spanning from `start` position to `end` position.\r\n\t *\r\n\t * **Note:** This factory method creates it's own {@link module:engine/view/position~Position} instances basing on passed values.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} start Start position.\r\n\t * @param {module:engine/view/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRange( start, end ) {\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before given {@link module:engine/view/item~Item view item} and ends after it.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeOn( item ) {\r\n\t\treturn Range._createOn( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeIn( element ) {\r\n\t\treturn Range._createIn( element );\r\n\t}\r\n\r\n\t/**\r\n\t Creates new {@link module:engine/view/selection~Selection} instance.\r\n\t *\r\n\t * \t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = writer.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = writer.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = writer.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = writer.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the document selection.\r\n\t *\t\tconst selection = writer.createSelection( editor.editing.view.document.selection );\r\n\t *\r\n\t * \t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = writer.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\r\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\r\n\t *\r\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tconst selection = writer.createSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection|\r\n\t * module:engine/view/position~Position|Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} [selectable=null]\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t * @returns {module:engine/view/selection~Selection}\r\n\t */\r\n\tcreateSelection( selectable, placeOrOffset, options ) {\r\n\t\treturn new Selection( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Wraps children with provided `attribute`. Only children contained in `parent` element between\r\n\t * `startOffset` and `endOffset` will be wrapped.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} parent\r\n\t * @param {Number} startOffset\r\n\t * @param {Number} endOffset\r\n\t * @param {module:engine/view/element~Element} attribute\r\n\t */\r\n\t_wrapChildren( parent, startOffset, endOffset, attribute ) {\r\n\t\tlet i = startOffset;\r\n\t\tconst wrapPositions = [];\r\n\r\n\t\twhile ( i < endOffset ) {\r\n\t\t\tconst child = parent.getChild( i );\r\n\t\t\tconst isText = child.is( 'text' );\r\n\t\t\tconst isAttribute = child.is( 'attributeElement' );\r\n\t\t\tconst isEmpty = child.is( 'emptyElement' );\r\n\t\t\tconst isUI = child.is( 'uiElement' );\r\n\r\n\t\t\t// Wrap text, empty elements, ui elements or attributes with higher or equal priority.\r\n\t\t\tif ( isText || isEmpty || isUI || ( isAttribute && shouldABeOutsideB( attribute, child ) ) ) {\r\n\t\t\t\t// Clone attribute.\r\n\t\t\t\tconst newAttribute = attribute._clone();\r\n\r\n\t\t\t\t// Wrap current node with new attribute.\r\n\t\t\t\tchild._remove();\r\n\t\t\t\tnewAttribute._appendChild( child );\r\n\r\n\t\t\t\tparent._insertChild( i, newAttribute );\r\n\t\t\t\tthis._addToClonedElementsGroup( newAttribute );\r\n\r\n\t\t\t\twrapPositions.push(\tnew Position( parent, i ) );\r\n\t\t\t}\r\n\t\t\t// If other nested attribute is found start wrapping there.\r\n\t\t\telse if ( isAttribute ) {\r\n\t\t\t\tthis._wrapChildren( child, 0, child.childCount, attribute );\r\n\t\t\t}\r\n\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\t// Merge at each wrap.\r\n\t\tlet offsetChange = 0;\r\n\r\n\t\tfor ( const position of wrapPositions ) {\r\n\t\t\tposition.offset -= offsetChange;\r\n\r\n\t\t\t// Do not merge with elements outside selected children.\r\n\t\t\tif ( position.offset == startOffset ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst newPosition = this.mergeAttributes( position );\r\n\r\n\t\t\t// If nodes were merged - other merge offsets will change.\r\n\t\t\tif ( !newPosition.isEqual( position ) ) {\r\n\t\t\t\toffsetChange++;\r\n\t\t\t\tendOffset--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Range._createFromParentsAndOffsets( parent, startOffset, parent, endOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Unwraps children from provided `attribute`. Only children contained in `parent` element between\r\n\t * `startOffset` and `endOffset` will be unwrapped.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} parent\r\n\t * @param {Number} startOffset\r\n\t * @param {Number} endOffset\r\n\t * @param {module:engine/view/element~Element} attribute\r\n\t */\r\n\t_unwrapChildren( parent, startOffset, endOffset, attribute ) {\r\n\t\tlet i = startOffset;\r\n\t\tconst unwrapPositions = [];\r\n\r\n\t\t// Iterate over each element between provided offsets inside parent.\r\n\t\twhile ( i < endOffset ) {\r\n\t\t\tconst child = parent.getChild( i );\r\n\r\n\t\t\t// If attributes are the similar, then unwrap.\r\n\t\t\tif ( child.isSimilar( attribute ) ) {\r\n\t\t\t\tconst unwrapped = child.getChildren();\r\n\t\t\t\tconst count = child.childCount;\r\n\r\n\t\t\t\t// Replace wrapper element with its children\r\n\t\t\t\tchild._remove();\r\n\t\t\t\tparent._insertChild( i, unwrapped );\r\n\r\n\t\t\t\tthis._removeFromClonedElementsGroup( child );\r\n\r\n\t\t\t\t// Save start and end position of moved items.\r\n\t\t\t\tunwrapPositions.push(\r\n\t\t\t\t\tnew Position( parent, i ),\r\n\t\t\t\t\tnew Position( parent, i + count )\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Skip elements that were unwrapped. Assuming that there won't be another element to unwrap in child\r\n\t\t\t\t// elements.\r\n\t\t\t\ti += count;\r\n\t\t\t\tendOffset += count - 1;\r\n\t\t\t} else {\r\n\t\t\t\t// If other nested attribute is found start unwrapping there.\r\n\t\t\t\tif ( child.is( 'attributeElement' ) ) {\r\n\t\t\t\t\tthis._unwrapChildren( child, 0, child.childCount, attribute );\r\n\t\t\t\t}\r\n\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Merge at each unwrap.\r\n\t\tlet offsetChange = 0;\r\n\r\n\t\tfor ( const position of unwrapPositions ) {\r\n\t\t\tposition.offset -= offsetChange;\r\n\r\n\t\t\t// Do not merge with elements outside selected children.\r\n\t\t\tif ( position.offset == startOffset || position.offset == endOffset ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst newPosition = this.mergeAttributes( position );\r\n\r\n\t\t\t// If nodes were merged - other merge offsets will change.\r\n\t\t\tif ( !newPosition.isEqual( position ) ) {\r\n\t\t\t\toffsetChange++;\r\n\t\t\t\tendOffset--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Range._createFromParentsAndOffsets( parent, startOffset, parent, endOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function for `view.writer.wrap`. Wraps range with provided attribute element.\r\n\t * This method will also merge newly added attribute element with its siblings whenever possible.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError} `view-writer-wrap-invalid-attribute` when passed attribute element is not\r\n\t * an instance of {@link module:engine/view/attributeelement~AttributeElement AttributeElement}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/range~Range} range\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} attribute\r\n\t * @returns {module:engine/view/range~Range} New range after wrapping, spanning over wrapping attribute element.\r\n\t */\r\n\t_wrapRange( range, attribute ) {\r\n\t\t// Range is inside single attribute and spans on all children.\r\n\t\tif ( rangeSpansOnAllChildren( range ) && this._wrapAttributeElement( attribute, range.start.parent ) ) {\r\n\t\t\tconst parent = range.start.parent;\r\n\r\n\t\t\tconst end = this.mergeAttributes( Position._createAfter( parent ) );\r\n\t\t\tconst start = this.mergeAttributes( Position._createBefore( parent ) );\r\n\r\n\t\t\treturn new Range( start, end );\r\n\t\t}\r\n\r\n\t\t// Break attributes at range start and end.\r\n\t\tconst { start: breakStart, end: breakEnd } = this._breakAttributesRange( range, true );\r\n\r\n\t\t// Range around one element.\r\n\t\tif ( breakEnd.isEqual( breakStart.getShiftedBy( 1 ) ) ) {\r\n\t\t\tconst node = breakStart.nodeAfter;\r\n\r\n\t\t\tif ( node instanceof AttributeElement && this._wrapAttributeElement( attribute, node ) ) {\r\n\t\t\t\tconst start = this.mergeAttributes( breakStart );\r\n\r\n\t\t\t\tif ( !start.isEqual( breakStart ) ) {\r\n\t\t\t\t\tbreakEnd.offset--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst end = this.mergeAttributes( breakEnd );\r\n\r\n\t\t\t\treturn new Range( start, end );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst parentContainer = breakStart.parent;\r\n\r\n\t\t// Unwrap children located between break points.\r\n\t\tconst unwrappedRange = this._unwrapChildren( parentContainer, breakStart.offset, breakEnd.offset, attribute );\r\n\r\n\t\t// Wrap all children with attribute.\r\n\t\tconst newRange = this._wrapChildren( parentContainer, unwrappedRange.start.offset, unwrappedRange.end.offset, attribute );\r\n\r\n\t\t// Merge attributes at the both ends and return a new range.\r\n\t\tconst start = this.mergeAttributes( newRange.start );\r\n\r\n\t\t// If start position was merged - move end position back.\r\n\t\tif ( !start.isEqual( newRange.start ) ) {\r\n\t\t\tnewRange.end.offset--;\r\n\t\t}\r\n\t\tconst end = this.mergeAttributes( newRange.end );\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function for {@link #wrap}. Wraps position with provided attribute element.\r\n\t * This method will also merge newly added attribute element with its siblings whenever possible.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError} `view-writer-wrap-invalid-attribute` when passed attribute element is not\r\n\t * an instance of {@link module:engine/view/attributeelement~AttributeElement AttributeElement}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/position~Position} position\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} attribute\r\n\t * @returns {module:engine/view/position~Position} New position after wrapping.\r\n\t */\r\n\t_wrapPosition( position, attribute ) {\r\n\t\t// Return same position when trying to wrap with attribute similar to position parent.\r\n\t\tif ( attribute.isSimilar( position.parent ) ) {\r\n\t\t\treturn movePositionToTextNode( position.clone() );\r\n\t\t}\r\n\r\n\t\t// When position is inside text node - break it and place new position between two text nodes.\r\n\t\tif ( position.parent.is( 'text' ) ) {\r\n\t\t\tposition = breakTextNode( position );\r\n\t\t}\r\n\r\n\t\t// Create fake element that will represent position, and will not be merged with other attributes.\r\n\t\tconst fakePosition = this.createAttributeElement();\r\n\t\tfakePosition._priority = Number.POSITIVE_INFINITY;\r\n\t\tfakePosition.isSimilar = () => false;\r\n\r\n\t\t// Insert fake element in position location.\r\n\t\tposition.parent._insertChild( position.offset, fakePosition );\r\n\r\n\t\t// Range around inserted fake attribute element.\r\n\t\tconst wrapRange = new Range( position, position.getShiftedBy( 1 ) );\r\n\r\n\t\t// Wrap fake element with attribute (it will also merge if possible).\r\n\t\tthis.wrap( wrapRange, attribute );\r\n\r\n\t\t// Remove fake element and place new position there.\r\n\t\tconst newPosition = new Position( fakePosition.parent, fakePosition.index );\r\n\t\tfakePosition._remove();\r\n\r\n\t\t// If position is placed between text nodes - merge them and return position inside.\r\n\t\tconst nodeBefore = newPosition.nodeBefore;\r\n\t\tconst nodeAfter = newPosition.nodeAfter;\r\n\r\n\t\tif ( nodeBefore instanceof Text && nodeAfter instanceof Text ) {\r\n\t\t\treturn mergeTextNodes( nodeBefore, nodeAfter );\r\n\t\t}\r\n\r\n\t\t// If position is next to text node - move position inside.\r\n\t\treturn movePositionToTextNode( newPosition );\r\n\t}\r\n\r\n\t/**\r\n\t * \tWraps one {@link module:engine/view/attributeelement~AttributeElement AttributeElement} into another by\r\n\t * \tmerging them if possible. When merging is possible - all attributes, styles and classes are moved from wrapper\r\n\t * \telement to element being wrapped.\r\n\t *\r\n\t * \t@private\r\n\t * \t@param {module:engine/view/attributeelement~AttributeElement} wrapper Wrapper AttributeElement.\r\n\t * \t@param {module:engine/view/attributeelement~AttributeElement} toWrap AttributeElement to wrap using wrapper element.\r\n\t * \t@returns {Boolean} Returns `true` if elements are merged.\r\n\t */\r\n\t_wrapAttributeElement( wrapper, toWrap ) {\r\n\t\tif ( !canBeJoined( wrapper, toWrap ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Can't merge if name or priority differs.\r\n\t\tif ( wrapper.name !== toWrap.name || wrapper.priority !== toWrap.priority ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Check if attributes can be merged.\r\n\t\tfor ( const key of wrapper.getAttributeKeys() ) {\r\n\t\t\t// Classes and styles should be checked separately.\r\n\t\t\tif ( key === 'class' || key === 'style' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// If some attributes are different we cannot wrap.\r\n\t\t\tif ( toWrap.hasAttribute( key ) && toWrap.getAttribute( key ) !== wrapper.getAttribute( key ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if styles can be merged.\r\n\t\tfor ( const key of wrapper.getStyleNames() ) {\r\n\t\t\tif ( toWrap.hasStyle( key ) && toWrap.getStyle( key ) !== wrapper.getStyle( key ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Move all attributes/classes/styles from wrapper to wrapped AttributeElement.\r\n\t\tfor ( const key of wrapper.getAttributeKeys() ) {\r\n\t\t\t// Classes and styles should be checked separately.\r\n\t\t\tif ( key === 'class' || key === 'style' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Move only these attributes that are not present - other are similar.\r\n\t\t\tif ( !toWrap.hasAttribute( key ) ) {\r\n\t\t\t\tthis.setAttribute( key, wrapper.getAttribute( key ), toWrap );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( const key of wrapper.getStyleNames() ) {\r\n\t\t\tif ( !toWrap.hasStyle( key ) ) {\r\n\t\t\t\tthis.setStyle( key, wrapper.getStyle( key ), toWrap );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( const key of wrapper.getClassNames() ) {\r\n\t\t\tif ( !toWrap.hasClass( key ) ) {\r\n\t\t\t\tthis.addClass( key, toWrap );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Unwraps {@link module:engine/view/attributeelement~AttributeElement AttributeElement} from another by removing\r\n\t * corresponding attributes, classes and styles. All attributes, classes and styles from wrapper should be present\r\n\t * inside element being unwrapped.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} wrapper Wrapper AttributeElement.\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} toUnwrap AttributeElement to unwrap using wrapper element.\r\n\t * @returns {Boolean} Returns `true` if elements are unwrapped.\r\n\t **/\r\n\t_unwrapAttributeElement( wrapper, toUnwrap ) {\r\n\t\tif ( !canBeJoined( wrapper, toUnwrap ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Can't unwrap if name or priority differs.\r\n\t\tif ( wrapper.name !== toUnwrap.name || wrapper.priority !== toUnwrap.priority ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Check if AttributeElement has all wrapper attributes.\r\n\t\tfor ( const key of wrapper.getAttributeKeys() ) {\r\n\t\t\t// Classes and styles should be checked separately.\r\n\t\t\tif ( key === 'class' || key === 'style' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// If some attributes are missing or different we cannot unwrap.\r\n\t\t\tif ( !toUnwrap.hasAttribute( key ) || toUnwrap.getAttribute( key ) !== wrapper.getAttribute( key ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if AttributeElement has all wrapper classes.\r\n\t\tif ( !toUnwrap.hasClass( ...wrapper.getClassNames() ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Check if AttributeElement has all wrapper styles.\r\n\t\tfor ( const key of wrapper.getStyleNames() ) {\r\n\t\t\t// If some styles are missing or different we cannot unwrap.\r\n\t\t\tif ( !toUnwrap.hasStyle( key ) || toUnwrap.getStyle( key ) !== wrapper.getStyle( key ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove all wrapper's attributes from unwrapped element.\r\n\t\tfor ( const key of wrapper.getAttributeKeys() ) {\r\n\t\t\t// Classes and styles should be checked separately.\r\n\t\t\tif ( key === 'class' || key === 'style' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tthis.removeAttribute( key, toUnwrap );\r\n\t\t}\r\n\r\n\t\t// Remove all wrapper's classes from unwrapped element.\r\n\t\tthis.removeClass( Array.from( wrapper.getClassNames() ), toUnwrap );\r\n\r\n\t\t// Remove all wrapper's styles from unwrapped element.\r\n\t\tthis.removeStyle( Array.from( wrapper.getStyleNames() ), toUnwrap );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function used by other `DowncastWriter` methods. Breaks attribute elements at the boundaries of given range.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/range~Range} range Range which `start` and `end` positions will be used to break attributes.\r\n\t * @param {Boolean} [forceSplitText=false] If set to `true`, will break text nodes even if they are directly in container element.\r\n\t * This behavior will result in incorrect view state, but is needed by other view writing methods which then fixes view state.\r\n\t * @returns {module:engine/view/range~Range} New range with located at break positions.\r\n\t */\r\n\t_breakAttributesRange( range, forceSplitText = false ) {\r\n\t\tconst rangeStart = range.start;\r\n\t\tconst rangeEnd = range.end;\r\n\r\n\t\tvalidateRangeContainer( range );\r\n\r\n\t\t// Break at the collapsed position. Return new collapsed range.\r\n\t\tif ( range.isCollapsed ) {\r\n\t\t\tconst position = this._breakAttributes( range.start, forceSplitText );\r\n\r\n\t\t\treturn new Range( position, position );\r\n\t\t}\r\n\r\n\t\tconst breakEnd = this._breakAttributes( rangeEnd, forceSplitText );\r\n\t\tconst count = breakEnd.parent.childCount;\r\n\t\tconst breakStart = this._breakAttributes( rangeStart, forceSplitText );\r\n\r\n\t\t// Calculate new break end offset.\r\n\t\tbreakEnd.offset += breakEnd.parent.childCount - count;\r\n\r\n\t\treturn new Range( breakStart, breakEnd );\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function used by other `DowncastWriter` methods. Breaks attribute elements at given position.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-cannot-break-empty-element` when break position\r\n\t * is placed inside {@link module:engine/view/emptyelement~EmptyElement EmptyElement}.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-cannot-break-ui-element` when break position\r\n\t * is placed inside {@link module:engine/view/uielement~UIElement UIElement}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/position~Position} position Position where to break attributes.\r\n\t * @param {Boolean} [forceSplitText=false] If set to `true`, will break text nodes even if they are directly in container element.\r\n\t * This behavior will result in incorrect view state, but is needed by other view writing methods which then fixes view state.\r\n\t * @returns {module:engine/view/position~Position} New position after breaking the attributes.\r\n\t */\r\n\t_breakAttributes( position, forceSplitText = false ) {\r\n\t\tconst positionOffset = position.offset;\r\n\t\tconst positionParent = position.parent;\r\n\r\n\t\t// If position is placed inside EmptyElement - throw an exception as we cannot break inside.\r\n\t\tif ( position.parent.is( 'emptyElement' ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot break inside EmptyElement instance.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-cannot-break-empty-element\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-cannot-break-empty-element' );\r\n\t\t}\r\n\r\n\t\t// If position is placed inside UIElement - throw an exception as we cannot break inside.\r\n\t\tif ( position.parent.is( 'uiElement' ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot break inside UIElement instance.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-cannot-break-ui-element\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-cannot-break-ui-element' );\r\n\t\t}\r\n\r\n\t\t// There are no attributes to break and text nodes breaking is not forced.\r\n\t\tif ( !forceSplitText && positionParent.is( 'text' ) && isContainerOrFragment( positionParent.parent ) ) {\r\n\t\t\treturn position.clone();\r\n\t\t}\r\n\r\n\t\t// Position's parent is container, so no attributes to break.\r\n\t\tif ( isContainerOrFragment( positionParent ) ) {\r\n\t\t\treturn position.clone();\r\n\t\t}\r\n\r\n\t\t// Break text and start again in new position.\r\n\t\tif ( positionParent.is( 'text' ) ) {\r\n\t\t\treturn this._breakAttributes( breakTextNode( position ), forceSplitText );\r\n\t\t}\r\n\r\n\t\tconst length = positionParent.childCount;\r\n\r\n\t\t// <p>foo<b><u>bar{}</u></b></p>\r\n\t\t// <p>foo<b><u>bar</u>[]</b></p>\r\n\t\t// <p>foo<b><u>bar</u></b>[]</p>\r\n\t\tif ( positionOffset == length ) {\r\n\t\t\tconst newPosition = new Position( positionParent.parent, positionParent.index + 1 );\r\n\r\n\t\t\treturn this._breakAttributes( newPosition, forceSplitText );\r\n\t\t} else\r\n\t\t// <p>foo<b><u>{}bar</u></b></p>\r\n\t\t// <p>foo<b>[]<u>bar</u></b></p>\r\n\t\t// <p>foo{}<b><u>bar</u></b></p>\r\n\t\tif ( positionOffset === 0 ) {\r\n\t\t\tconst newPosition = new Position( positionParent.parent, positionParent.index );\r\n\r\n\t\t\treturn this._breakAttributes( newPosition, forceSplitText );\r\n\t\t}\r\n\t\t// <p>foo<b><u>b{}ar</u></b></p>\r\n\t\t// <p>foo<b><u>b[]ar</u></b></p>\r\n\t\t// <p>foo<b><u>b</u>[]<u>ar</u></b></p>\r\n\t\t// <p>foo<b><u>b</u></b>[]<b><u>ar</u></b></p>\r\n\t\telse {\r\n\t\t\tconst offsetAfter = positionParent.index + 1;\r\n\r\n\t\t\t// Break element.\r\n\t\t\tconst clonedNode = positionParent._clone();\r\n\r\n\t\t\t// Insert cloned node to position's parent node.\r\n\t\t\tpositionParent.parent._insertChild( offsetAfter, clonedNode );\r\n\t\t\tthis._addToClonedElementsGroup( clonedNode );\r\n\r\n\t\t\t// Get nodes to move.\r\n\t\t\tconst count = positionParent.childCount - positionOffset;\r\n\t\t\tconst nodesToMove = positionParent._removeChildren( positionOffset, count );\r\n\r\n\t\t\t// Move nodes to cloned node.\r\n\t\t\tclonedNode._appendChild( nodesToMove );\r\n\r\n\t\t\t// Create new position to work on.\r\n\t\t\tconst newPosition = new Position( positionParent.parent, offsetAfter );\r\n\r\n\t\t\treturn this._breakAttributes( newPosition, forceSplitText );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stores the information that an {@link module:engine/view/attributeelement~AttributeElement attribute element} was\r\n\t * added to the tree. Saves the reference to the group in the given element and updates the group, so other elements\r\n\t * from the group now keep a reference to the given attribute element.\r\n\t *\r\n\t * The clones group can be obtained using {@link module:engine/view/attributeelement~AttributeElement#getElementsWithSameId}.\r\n\t *\r\n\t * Does nothing if added element has no {@link module:engine/view/attributeelement~AttributeElement#id id}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} element Attribute element to save.\r\n\t */\r\n\t_addToClonedElementsGroup( element ) {\r\n\t\t// Add only if the element is in document tree.\r\n\t\tif ( !element.root.is( 'rootElement' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Traverse the element's children recursively to find other attribute elements that also might got inserted.\r\n\t\t// The loop is at the beginning so we can make fast returns later in the code.\r\n\t\tif ( element.is( 'element' ) ) {\r\n\t\t\tfor ( const child of element.getChildren() ) {\r\n\t\t\t\tthis._addToClonedElementsGroup( child );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst id = element.id;\r\n\r\n\t\tif ( !id ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet group = this._cloneGroups.get( id );\r\n\r\n\t\tif ( !group ) {\r\n\t\t\tgroup = new Set();\r\n\t\t\tthis._cloneGroups.set( id, group );\r\n\t\t}\r\n\r\n\t\tgroup.add( element );\r\n\t\telement._clonesGroup = group;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all the information about the given {@link module:engine/view/attributeelement~AttributeElement attribute element}\r\n\t * from its clones group.\r\n\t *\r\n\t * Keep in mind, that the element will still keep a reference to the group (but the group will not keep a reference to it).\r\n\t * This allows to reference the whole group even if the element was already removed from the tree.\r\n\t *\r\n\t * Does nothing if the element has no {@link module:engine/view/attributeelement~AttributeElement#id id}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/attributeelement~AttributeElement} element Attribute element to remove.\r\n\t */\r\n\t_removeFromClonedElementsGroup( element ) {\r\n\t\t// Traverse the element's children recursively to find other attribute elements that also got removed.\r\n\t\t// The loop is at the beginning so we can make fast returns later in the code.\r\n\t\tif ( element.is( 'element' ) ) {\r\n\t\t\tfor ( const child of element.getChildren() ) {\r\n\t\t\t\tthis._removeFromClonedElementsGroup( child );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst id = element.id;\r\n\r\n\t\tif ( !id ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst group = this._cloneGroups.get( id );\r\n\r\n\t\tif ( !group ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tgroup.delete( element );\r\n\t\t// Not removing group from element on purpose!\r\n\t\t// If other parts of code have reference to this element, they will be able to get references to other elements from the group.\r\n\t}\r\n}\r\n\r\n// Helper function for `view.writer.wrap`. Checks if given element has any children that are not ui elements.\r\nfunction _hasNonUiChildren( parent ) {\r\n\treturn Array.from( parent.getChildren() ).some( child => !child.is( 'uiElement' ) );\r\n}\r\n\r\n/**\r\n * Attribute element need to be instance of attribute element.\r\n *\r\n * @error view-writer-wrap-invalid-attribute\r\n */\r\n\r\n// Returns first parent container of specified {@link module:engine/view/position~Position Position}.\r\n// Position's parent node is checked as first, then next parents are checked.\r\n// Note that {@link module:engine/view/documentfragment~DocumentFragment DocumentFragment} is treated like a container.\r\n//\r\n// @param {module:engine/view/position~Position} position Position used as a start point to locate parent container.\r\n// @returns {module:engine/view/containerelement~ContainerElement|module:engine/view/documentfragment~DocumentFragment|undefined}\r\n// Parent container element or `undefined` if container is not found.\r\nfunction getParentContainer( position ) {\r\n\tlet parent = position.parent;\r\n\r\n\twhile ( !isContainerOrFragment( parent ) ) {\r\n\t\tif ( !parent ) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tparent = parent.parent;\r\n\t}\r\n\r\n\treturn parent;\r\n}\r\n\r\n// Checks if first {@link module:engine/view/attributeelement~AttributeElement AttributeElement} provided to the function\r\n// can be wrapped otuside second element. It is done by comparing elements'\r\n// {@link module:engine/view/attributeelement~AttributeElement#priority priorities}, if both have same priority\r\n// {@link module:engine/view/element~Element#getIdentity identities} are compared.\r\n//\r\n// @param {module:engine/view/attributeelement~AttributeElement} a\r\n// @param {module:engine/view/attributeelement~AttributeElement} b\r\n// @returns {Boolean}\r\nfunction shouldABeOutsideB( a, b ) {\r\n\tif ( a.priority < b.priority ) {\r\n\t\treturn true;\r\n\t} else if ( a.priority > b.priority ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// When priorities are equal and names are different - use identities.\r\n\treturn a.getIdentity() < b.getIdentity();\r\n}\r\n\r\n// Returns new position that is moved to near text node. Returns same position if there is no text node before of after\r\n// specified position.\r\n//\r\n//\t\t<p>foo[]</p>  ->  <p>foo{}</p>\r\n//\t\t<p>[]foo</p>  ->  <p>{}foo</p>\r\n//\r\n// @param {module:engine/view/position~Position} position\r\n// @returns {module:engine/view/position~Position} Position located inside text node or same position if there is no text nodes\r\n// before or after position location.\r\nfunction movePositionToTextNode( position ) {\r\n\tconst nodeBefore = position.nodeBefore;\r\n\r\n\tif ( nodeBefore && nodeBefore.is( 'text' ) ) {\r\n\t\treturn new Position( nodeBefore, nodeBefore.data.length );\r\n\t}\r\n\r\n\tconst nodeAfter = position.nodeAfter;\r\n\r\n\tif ( nodeAfter && nodeAfter.is( 'text' ) ) {\r\n\t\treturn new Position( nodeAfter, 0 );\r\n\t}\r\n\r\n\treturn position;\r\n}\r\n\r\n// Breaks text node into two text nodes when possible.\r\n//\r\n//\t\t<p>foo{}bar</p> -> <p>foo[]bar</p>\r\n//\t\t<p>{}foobar</p> -> <p>[]foobar</p>\r\n//\t\t<p>foobar{}</p> -> <p>foobar[]</p>\r\n//\r\n// @param {module:engine/view/position~Position} position Position that need to be placed inside text node.\r\n// @returns {module:engine/view/position~Position} New position after breaking text node.\r\nfunction breakTextNode( position ) {\r\n\tif ( position.offset == position.parent.data.length ) {\r\n\t\treturn new Position( position.parent.parent, position.parent.index + 1 );\r\n\t}\r\n\r\n\tif ( position.offset === 0 ) {\r\n\t\treturn new Position( position.parent.parent, position.parent.index );\r\n\t}\r\n\r\n\t// Get part of the text that need to be moved.\r\n\tconst textToMove = position.parent.data.slice( position.offset );\r\n\r\n\t// Leave rest of the text in position's parent.\r\n\tposition.parent._data = position.parent.data.slice( 0, position.offset );\r\n\r\n\t// Insert new text node after position's parent text node.\r\n\tposition.parent.parent._insertChild( position.parent.index + 1, new Text( textToMove ) );\r\n\r\n\t// Return new position between two newly created text nodes.\r\n\treturn new Position( position.parent.parent, position.parent.index + 1 );\r\n}\r\n\r\n// Merges two text nodes into first node. Removes second node and returns merge position.\r\n//\r\n// @param {module:engine/view/text~Text} t1 First text node to merge. Data from second text node will be moved at the end of\r\n// this text node.\r\n// @param {module:engine/view/text~Text} t2 Second text node to merge. This node will be removed after merging.\r\n// @returns {module:engine/view/position~Position} Position after merging text nodes.\r\nfunction mergeTextNodes( t1, t2 ) {\r\n\t// Merge text data into first text node and remove second one.\r\n\tconst nodeBeforeLength = t1.data.length;\r\n\tt1._data += t2.data;\r\n\tt2._remove();\r\n\r\n\treturn new Position( t1, nodeBeforeLength );\r\n}\r\n\r\n// Returns `true` if range is located in same {@link module:engine/view/attributeelement~AttributeElement AttributeElement}\r\n// (`start` and `end` positions are located inside same {@link module:engine/view/attributeelement~AttributeElement AttributeElement}),\r\n// starts on 0 offset and ends after last child node.\r\n//\r\n// @param {module:engine/view/range~Range} Range\r\n// @returns {Boolean}\r\nfunction rangeSpansOnAllChildren( range ) {\r\n\treturn range.start.parent == range.end.parent && range.start.parent.is( 'attributeElement' ) &&\r\n\t\trange.start.offset === 0 && range.end.offset === range.start.parent.childCount;\r\n}\r\n\r\n// Checks if provided nodes are valid to insert. Checks if each node is an instance of\r\n// {@link module:engine/view/text~Text Text} or {@link module:engine/view/attributeelement~AttributeElement AttributeElement},\r\n// {@link module:engine/view/containerelement~ContainerElement ContainerElement},\r\n// {@link module:engine/view/emptyelement~EmptyElement EmptyElement} or\r\n// {@link module:engine/view/uielement~UIElement UIElement}.\r\n//\r\n// Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-insert-invalid-node` when nodes to insert\r\n// contains instances that are not {@link module:engine/view/text~Text Texts},\r\n// {@link module:engine/view/emptyelement~EmptyElement EmptyElements},\r\n// {@link module:engine/view/uielement~UIElement UIElements},\r\n// {@link module:engine/view/attributeelement~AttributeElement AttributeElements} or\r\n// {@link module:engine/view/containerelement~ContainerElement ContainerElements}.\r\n//\r\n// @param Iterable.<module:engine/view/text~Text|module:engine/view/attributeelement~AttributeElement\r\n// |module:engine/view/containerelement~ContainerElement> nodes\r\nfunction validateNodesToInsert( nodes ) {\r\n\tfor ( const node of nodes ) {\r\n\t\tif ( !validNodesToInsert.some( ( validNode => node instanceof validNode ) ) ) { // eslint-disable-line no-use-before-define\r\n\t\t\t/**\r\n\t\t\t * Inserted nodes should be valid to insert. of {@link module:engine/view/attributeelement~AttributeElement AttributeElement},\r\n\t\t\t * {@link module:engine/view/containerelement~ContainerElement ContainerElement},\r\n\t\t\t * {@link module:engine/view/emptyelement~EmptyElement EmptyElement},\r\n\t\t\t * {@link module:engine/view/uielement~UIElement UIElement}, {@link module:engine/view/text~Text Text}.\r\n\t\t\t *\r\n\t\t\t * @error view-writer-insert-invalid-node\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-writer-insert-invalid-node' );\r\n\t\t}\r\n\r\n\t\tif ( !node.is( 'text' ) ) {\r\n\t\t\tvalidateNodesToInsert( node.getChildren() );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst validNodesToInsert = [ Text, AttributeElement, ContainerElement, EmptyElement, UIElement ];\r\n\r\n// Checks if node is ContainerElement or DocumentFragment, because in most cases they should be treated the same way.\r\n//\r\n// @param {module:engine/view/node~Node} node\r\n// @returns {Boolean} Returns `true` if node is instance of ContainerElement or DocumentFragment.\r\nfunction isContainerOrFragment( node ) {\r\n\treturn node && ( node.is( 'containerElement' ) || node.is( 'documentFragment' ) );\r\n}\r\n\r\n// Checks if {@link module:engine/view/range~Range#start range start} and {@link module:engine/view/range~Range#end range end} are placed\r\n// inside same {@link module:engine/view/containerelement~ContainerElement container element}.\r\n// Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-writer-invalid-range-container` when validation fails.\r\n//\r\n// @param {module:engine/view/range~Range} range\r\nfunction validateRangeContainer( range ) {\r\n\tconst startContainer = getParentContainer( range.start );\r\n\tconst endContainer = getParentContainer( range.end );\r\n\r\n\tif ( !startContainer || !endContainer || startContainer !== endContainer ) {\r\n\t\t/**\r\n\t\t * Range container is invalid. This can happen if {@link module:engine/view/range~Range#start range start} and\r\n\t\t * {@link module:engine/view/range~Range#end range end} positions are not placed inside same container or\r\n\t\t * parent container for these positions cannot be found.\r\n\t\t *\r\n\t\t * @error view-writer-invalid-range-container\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'view-writer-invalid-range-container' );\r\n\t}\r\n}\r\n\r\n// Checks if two attribute elements can be joined together. Elements can be joined together if, and only if\r\n// they do not have ids specified.\r\n//\r\n// @private\r\n// @param {module:engine/view/element~Element} a\r\n// @param {module:engine/view/element~Element} b\r\n// @returns {Boolean}\r\nfunction canBeJoined( a, b ) {\r\n\treturn a.id === null && b.id === null;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/istext\r\n */\r\n\r\n/**\r\n * Checks if the object is a native DOM Text node.\r\n *\r\n * @param {*} obj\r\n * @returns {Boolean}\r\n */\r\nexport default function isText( obj ) {\r\n\treturn Object.prototype.toString.call( obj ) == '[object Text]';\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals window */\r\n\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\nimport isText from '@ckeditor/ckeditor5-utils/src/dom/istext';\r\n\r\n/**\r\n * Set of utils related to block and inline fillers handling.\r\n *\r\n * Browsers do not allow to put caret in elements which does not have height. Because of it, we need to fill all\r\n * empty elements which should be selectable with elements or characters called \"fillers\". Unfortunately there is no one\r\n * universal filler, this is why two types are uses:\r\n *\r\n * * Block filler is an element which fill block elements, like `<p>`. CKEditor uses `<br>` as a block filler during the editing,\r\n * as browsers do natively. So instead of an empty `<p>` there will be `<p><br></p>`. The advantage of block filler is that\r\n * it is transparent for the selection, so when the caret is before the `<br>` and user presses right arrow he will be\r\n * moved to the next paragraph, not after the `<br>`. The disadvantage is that it breaks a block, so it can not be used\r\n * in the middle of a line of text. The {@link module:engine/view/filler~BR_FILLER `<br>` filler} can be replaced with any other\r\n * character in the data output, for instance {@link module:engine/view/filler~NBSP_FILLER non-breaking space}.\r\n *\r\n * * Inline filler is a filler which does not break a line of text, so it can be used inside the text, for instance in the empty\r\n * `<b>` surrendered by text: `foo<b></b>bar`, if we want to put the caret there. CKEditor uses a sequence of the zero-width\r\n * spaces as an {@link module:engine/view/filler~INLINE_FILLER inline filler} having the predetermined\r\n * {@link module:engine/view/filler~INLINE_FILLER_LENGTH length}. A sequence is used, instead of a single character to\r\n * avoid treating random zero-width spaces as the inline filler. Disadvantage of the inline filler is that it is not\r\n * transparent for the selection. The arrow key moves the caret between zero-width spaces characters, so the additional\r\n * code is needed to handle the caret.\r\n *\r\n * Both inline and block fillers are handled by the {@link module:engine/view/renderer~Renderer renderer} and are not present in the\r\n * view.\r\n *\r\n * @module engine/view/filler\r\n */\r\n\r\n/**\r\n * `<br>` filler creator. This is a function which creates `<br data-cke-filler=\"true\">` element.\r\n * It defines how the filler is created.\r\n *\r\n * @see module:engine/view/filler~NBSP_FILLER\r\n * @function\r\n */\r\nexport const BR_FILLER = domDocument => {\r\n\tconst fillerBr = domDocument.createElement( 'br' );\r\n\tfillerBr.dataset.ckeFiller = true;\r\n\r\n\treturn fillerBr;\r\n};\r\n\r\n/**\r\n * Non-breaking space filler creator. This is a function which creates `&nbsp;` text node.\r\n * It defines how the filler is created.\r\n *\r\n * @see module:engine/view/filler~BR_FILLER\r\n * @function\r\n */\r\nexport const NBSP_FILLER = domDocument => domDocument.createTextNode( '\\u00A0' );\r\n\r\n/**\r\n * Length of the {@link module:engine/view/filler~INLINE_FILLER INLINE_FILLER}.\r\n */\r\nexport const INLINE_FILLER_LENGTH = 7;\r\n\r\n/**\r\n * Inline filler which is sequence of the zero width spaces.\r\n */\r\nexport let INLINE_FILLER = '';\r\n\r\nfor ( let i = 0; i < INLINE_FILLER_LENGTH; i++ ) {\r\n\tINLINE_FILLER += '\\u200b';\r\n}\r\n\r\n/**\r\n * Checks if the node is a text node which starts with the {@link module:engine/view/filler~INLINE_FILLER inline filler}.\r\n *\r\n *\t\tstartsWithFiller( document.createTextNode( INLINE_FILLER ) ); // true\r\n *\t\tstartsWithFiller( document.createTextNode( INLINE_FILLER + 'foo' ) ); // true\r\n *\t\tstartsWithFiller( document.createTextNode( 'foo' ) ); // false\r\n *\t\tstartsWithFiller( document.createElement( 'p' ) ); // false\r\n *\r\n * @param {Node} domNode DOM node.\r\n * @returns {Boolean} True if the text node starts with the {@link module:engine/view/filler~INLINE_FILLER inline filler}.\r\n */\r\nexport function startsWithFiller( domNode ) {\r\n\treturn isText( domNode ) && ( domNode.data.substr( 0, INLINE_FILLER_LENGTH ) === INLINE_FILLER );\r\n}\r\n\r\n/**\r\n * Checks if the text node contains only the {@link module:engine/view/filler~INLINE_FILLER inline filler}.\r\n *\r\n *\t\tisInlineFiller( document.createTextNode( INLINE_FILLER ) ); // true\r\n *\t\tisInlineFiller( document.createTextNode( INLINE_FILLER + 'foo' ) ); // false\r\n *\r\n * @param {Text} domText DOM text node.\r\n * @returns {Boolean} True if the text node contains only the {@link module:engine/view/filler~INLINE_FILLER inline filler}.\r\n */\r\nexport function isInlineFiller( domText ) {\r\n\treturn domText.data.length == INLINE_FILLER_LENGTH && startsWithFiller( domText );\r\n}\r\n\r\n/**\r\n * Get string data from the text node, removing an {@link module:engine/view/filler~INLINE_FILLER inline filler} from it,\r\n * if text node contains it.\r\n *\r\n *\t\tgetDataWithoutFiller( document.createTextNode( INLINE_FILLER + 'foo' ) ) == 'foo' // true\r\n *\t\tgetDataWithoutFiller( document.createTextNode( 'foo' ) ) == 'foo' // true\r\n *\r\n * @param {Text} domText DOM text node, possible with inline filler.\r\n * @returns {String} Data without filler.\r\n */\r\nexport function getDataWithoutFiller( domText ) {\r\n\tif ( startsWithFiller( domText ) ) {\r\n\t\treturn domText.data.slice( INLINE_FILLER_LENGTH );\r\n\t} else {\r\n\t\treturn domText.data;\r\n\t}\r\n}\r\n\r\n// Cache block fillers templates to improve performance.\r\nconst templateBlockFillers = new WeakMap();\r\n\r\n/**\r\n * Checks if the node is an instance of the block filler of the given type.\r\n *\r\n *\t\tconst brFillerInstance = BR_FILLER( document );\r\n *\t\tisBlockFiller( brFillerInstance, BR_FILLER ); // true\r\n *\r\n * @param {Node} domNode DOM node to check.\r\n * @param {Function} blockFiller Block filler creator.\r\n * @returns {Boolean} True if text node contains only {@link module:engine/view/filler~INLINE_FILLER inline filler}.\r\n */\r\nexport function isBlockFiller( domNode, blockFiller ) {\r\n\tlet templateBlockFiller = templateBlockFillers.get( blockFiller );\r\n\r\n\tif ( !templateBlockFiller ) {\r\n\t\ttemplateBlockFiller = blockFiller( window.document );\r\n\t\ttemplateBlockFillers.set( blockFiller, templateBlockFiller );\r\n\t}\r\n\r\n\treturn domNode.isEqualNode( templateBlockFiller );\r\n}\r\n\r\n/**\r\n * Assign key observer which move cursor from the end of the inline filler to the beginning of it when\r\n * the left arrow is pressed, so the filler does not break navigation.\r\n *\r\n * @param {module:engine/view/view~View} view View controller instance we should inject quirks handling on.\r\n */\r\nexport function injectQuirksHandling( view ) {\r\n\tview.document.on( 'keydown', jumpOverInlineFiller );\r\n}\r\n\r\n// Move cursor from the end of the inline filler to the beginning of it when, so the filler does not break navigation.\r\nfunction jumpOverInlineFiller( evt, data ) {\r\n\tif ( data.keyCode == keyCodes.arrowleft ) {\r\n\t\tconst domSelection = data.domTarget.ownerDocument.defaultView.getSelection();\r\n\r\n\t\tif ( domSelection.rangeCount == 1 && domSelection.getRangeAt( 0 ).collapsed ) {\r\n\t\t\tconst domParent = domSelection.getRangeAt( 0 ).startContainer;\r\n\t\t\tconst domOffset = domSelection.getRangeAt( 0 ).startOffset;\r\n\r\n\t\t\tif ( startsWithFiller( domParent ) && domOffset <= INLINE_FILLER_LENGTH ) {\r\n\t\t\t\tdomSelection.collapse( domParent, 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/diff\r\n */\r\n\r\n// The following code is based on the \"O(NP) Sequence Comparison Algorithm\"\r\n// by Sun Wu, Udi Manber, Gene Myers, Webb Miller.\r\n\r\n/**\r\n * Calculates the difference between two arrays or strings producing an array containing a list of changes\r\n * necessary to transform input into output.\r\n *\r\n *\t\tdiff( 'aba', 'acca' ); // [ 'equal', 'insert', 'insert', 'delete', 'equal' ]\r\n *\r\n * @param {Array|String} a Input array or string.\r\n * @param {Array|String} b Output array or string.\r\n * @param {Function} [cmp] Optional function used to compare array values, by default === is used.\r\n * @returns {Array} Array of changes.\r\n */\r\nexport default function diff( a, b, cmp ) {\r\n\t// Set the comparator function.\r\n\tcmp = cmp || function( a, b ) {\r\n\t\treturn a === b;\r\n\t};\r\n\r\n\t// Temporary action type statics.\r\n\tlet _insert, _delete;\r\n\r\n\t// Swapped the arrays to use the shorter one as the first one.\r\n\tif ( b.length < a.length ) {\r\n\t\tconst tmp = a;\r\n\r\n\t\ta = b;\r\n\t\tb = tmp;\r\n\r\n\t\t// We swap the action types as well.\r\n\t\t_insert = 'delete';\r\n\t\t_delete = 'insert';\r\n\t} else {\r\n\t\t_insert = 'insert';\r\n\t\t_delete = 'delete';\r\n\t}\r\n\r\n\tconst m = a.length;\r\n\tconst n = b.length;\r\n\tconst delta = n - m;\r\n\r\n\t// Edit scripts, for each diagonal.\r\n\tconst es = {};\r\n\t// Furthest points, the furthest y we can get on each diagonal.\r\n\tconst fp = {};\r\n\r\n\tfunction snake( k ) {\r\n\t\t// We use -1 as an alternative below to handle initial values ( instead of filling the fp with -1 first ).\r\n\t\t// Furthest points (y) on the diagonal below k.\r\n\t\tconst y1 = ( fp[ k - 1 ] !== undefined ? fp[ k - 1 ] : -1 ) + 1;\r\n\t\t// Furthest points (y) on the diagonal above k.\r\n\t\tconst y2 = fp[ k + 1 ] !== undefined ? fp[ k + 1 ] : -1;\r\n\t\t// The way we should go to get further.\r\n\t\tconst dir = y1 > y2 ? -1 : 1;\r\n\r\n\t\t// Clone previous changes array (if any).\r\n\t\tif ( es[ k + dir ] ) {\r\n\t\t\tes[ k ] = es[ k + dir ].slice( 0 );\r\n\t\t}\r\n\r\n\t\t// Create changes array.\r\n\t\tif ( !es[ k ] ) {\r\n\t\t\tes[ k ] = [];\r\n\t\t}\r\n\r\n\t\t// Push the action.\r\n\t\tes[ k ].push( y1 > y2 ? _insert : _delete );\r\n\r\n\t\t// Set the beginning coordinates.\r\n\t\tlet y = Math.max( y1, y2 );\r\n\t\tlet x = y - k;\r\n\r\n\t\t// Traverse the diagonal as long as the values match.\r\n\t\twhile ( x < m && y < n && cmp( a[ x ], b[ y ] ) ) {\r\n\t\t\tx++;\r\n\t\t\ty++;\r\n\t\t\t// Push no change action.\r\n\t\t\tes[ k ].push( 'equal' );\r\n\t\t}\r\n\r\n\t\treturn y;\r\n\t}\r\n\r\n\tlet p = 0;\r\n\tlet k;\r\n\r\n\t// Traverse the graph until we reach the end of the longer string.\r\n\tdo {\r\n\t\t// Updates furthest points and edit scripts for diagonals below delta.\r\n\t\tfor ( k = -p; k < delta; k++ ) {\r\n\t\t\tfp[ k ] = snake( k );\r\n\t\t}\r\n\r\n\t\t// Updates furthest points and edit scripts for diagonals above delta.\r\n\t\tfor ( k = delta + p; k > delta; k-- ) {\r\n\t\t\tfp[ k ] = snake( k );\r\n\t\t}\r\n\r\n\t\t// Updates furthest point and edit script for the delta diagonal.\r\n\t\t// note that the delta diagonal is the one which goes through the sink (m, n).\r\n\t\tfp[ delta ] = snake( delta );\r\n\r\n\t\tp++;\r\n\t} while ( fp[ delta ] !== n );\r\n\r\n\t// Return the final list of edit changes.\r\n\t// We remove the first item that represents the action for the injected nulls.\r\n\treturn es[ delta ].slice( 1 );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/insertat\r\n */\r\n\r\n/**\r\n * Inserts node to the parent at given index.\r\n *\r\n * @param {Element} parentElement Parent element.\r\n * @param {Number} index Insertions index.\r\n * @param {Node} nodeToInsert Node to insert.\r\n */\r\nexport default function insertAt( parentElement, index, nodeToInsert ) {\r\n\tparentElement.insertBefore( nodeToInsert, parentElement.childNodes[ index ] || null );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/remove\r\n */\r\n\r\n/**\r\n * Removes given node from parent.\r\n *\r\n * @param {Node} node Node to remove.\r\n */\r\nexport default function remove( node ) {\r\n\tconst parent = node.parentNode;\r\n\r\n\tif ( parent ) {\r\n\t\tparent.removeChild( node );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/isnode\r\n */\r\n\r\n/**\r\n * Checks if the object is a native DOM Node.\r\n *\r\n * @param {*} obj\r\n * @returns {Boolean}\r\n */\r\nexport default function isNode( obj ) {\r\n\tif ( obj ) {\r\n\t\tif ( obj.defaultView ) {\r\n\t\t\treturn obj instanceof obj.defaultView.Document;\r\n\t\t} else if ( obj.ownerDocument && obj.ownerDocument.defaultView ) {\r\n\t\t\treturn obj instanceof obj.ownerDocument.defaultView.Node;\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/fastdiff\r\n */\r\n\r\n/**\r\n * Finds position of the first and last change in the given strings and generates set of changes. Set of changes\r\n * can be applied to the input text in order to transform it into the output text, for example:\r\n *\r\n *\t\tfastDiff( '12a', '12xyza' );\r\n *\t\t// [ { index: 2, type: 'insert', values: [ 'x', 'y', 'z' ] } ]\r\n *\r\n *\t\tfastDiff( '12a', '12aa' );\r\n *\t\t// [ { index: 3, type: 'insert', values: [ 'a' ] } ]\r\n *\r\n *\t\tfastDiff( '12xyza', '12a' );\r\n *\t\t// [ { index: 2, type: 'delete', howMany: 3 } ]\r\n *\r\n *\t\tfastDiff( '12aa', '12a' );\r\n *\t\t// [ { index: 3, type: 'delete', howMany: 1 } ]\r\n *\r\n *\t\tfastDiff( '12abc3', '2ab' );\r\n *\t\t// [ { index: 0, type: 'insert', values: [ '2', 'a', 'b' ] }, { index: 3, type: 'delete', howMany: 6 } ]\r\n *\r\n * Using returned results you can modify `oldText` to transform it into `newText`:\r\n *\r\n * \t\tlet input = '12abc3';\r\n * \t\tconst output = '2ab';\r\n * \t\tconst changes = fastDiff( input, output );\r\n *\r\n *\t\tchanges.forEach( change => {\r\n *\t\t\tif ( change.type == 'insert' ) {\r\n *\t\t\t\tinput = input.substring( 0, change.index ) + change.values.join( '' ) + input.substring( change.index );\r\n *\t\t\t} else if ( change.type == 'delete' ) {\r\n *\t\t\t\tinput = input.substring( 0, change.index ) + input.substring( change.index + change.howMany );\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\tinput === output; // -> true\r\n *\r\n * The output format of this function is compatible with {@link module:utils/difftochanges~diffToChanges} output format.\r\n *\r\n * @param {String} oldText Input string.\r\n * @param {String} newText Input string.\r\n * @returns {Array} Array of changes.\r\n */\r\nexport default function fastDiff( oldText, newText ) {\r\n\t// Check if both texts are equal.\r\n\tif ( oldText === newText ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst changeIndexes = findChangeBoundaryIndexes( oldText, newText );\r\n\r\n\treturn changeIndexesToChanges( newText, changeIndexes );\r\n}\r\n\r\n// Finds position of the first and last change in the given strings. For example:\r\n//\r\n//\t\tconst indexes = findChangeBoundaryIndexes( '1234', '13424' );\r\n//\t\tconsole.log( indexes ); // { firstIndex: 1, lastIndexOld: 3, lastIndexNew: 4 }\r\n//\r\n// The above indexes means that in `oldText` modified part is `1[23]4` and in the `newText` it is `1[342]4`.\r\n// Based on such indexes, array with `insert`/`delete` operations which allows transforming\r\n// old text to the new one can be generated.\r\n//\r\n// It is expected that `oldText` and `newText` are different.\r\n//\r\n// @param {String} oldText\r\n// @param {String} newText\r\n// @returns {Object}\r\n// @returns {Number} return.firstIndex Index of the first change in both strings (always the same for both).\r\n// @returns {Number} result.lastIndexOld Index of the last common character in `oldText` string.\r\n// @returns {Number} result.lastIndexNew Index of the last common character in `newText` string.\r\nfunction findChangeBoundaryIndexes( oldText, newText ) {\r\n\t// Find the first difference between texts.\r\n\tconst firstIndex = findFirstDifferenceIndex( oldText, newText );\r\n\r\n\t// Remove the common part of texts and reverse them to make it simpler to find the last difference between texts.\r\n\tconst oldTextReversed = cutAndReverse( oldText, firstIndex );\r\n\tconst newTextReversed = cutAndReverse( newText, firstIndex );\r\n\r\n\t// Find the first difference between reversed texts.\r\n\t// It should be treated as \"how many characters from the end the last difference occurred\".\r\n\t//\r\n\t// For example:\r\n\t//\r\n\t// \t\t\tinitial\t->\tafter cut\t-> reversed:\r\n\t// oldText:\t'321ba'\t->\t'21ba'\t\t-> 'ab12'\r\n\t// newText:\t'31xba'\t->\t'1xba'\t\t-> 'abx1'\r\n\t// lastIndex:\t\t\t\t\t\t->    2\r\n\t//\r\n\t// So the last change occurred two characters from the end of the texts.\r\n\tconst lastIndex = findFirstDifferenceIndex( oldTextReversed, newTextReversed );\r\n\r\n\t// Use `lastIndex` to calculate proper offset, starting from the beginning (`lastIndex` kind of starts from the end).\r\n\tconst lastIndexOld = oldText.length - lastIndex;\r\n\tconst lastIndexNew = newText.length - lastIndex;\r\n\r\n\treturn { firstIndex, lastIndexOld, lastIndexNew };\r\n}\r\n\r\n// Returns a first index on which `oldText` and `newText` differ.\r\n//\r\n// @param {String} oldText\r\n// @param {String} newText\r\n// @returns {Number}\r\nfunction findFirstDifferenceIndex( oldText, newText ) {\r\n\tfor ( let i = 0; i < Math.max( oldText.length, newText.length ); i++ ) {\r\n\t\tif ( oldText[ i ] !== newText[ i ] ) {\r\n\t\t\treturn i;\r\n\t\t}\r\n\t}\r\n\t// No \"backup\" return cause we assume that `oldText` and `newText` differ. This means that they either have a\r\n\t// difference or they have a different lengths. This means that the `if` condition will always be met eventually.\r\n}\r\n\r\n// Removes `howMany` characters from the given `text` string starting from the beginning, then reverses and returns it.\r\n//\r\n// @param {String} text Text to be processed.\r\n// @param {Number} howMany How many characters from text beginning to cut.\r\n// @returns {String} Shortened and reversed text.\r\nfunction cutAndReverse( text, howMany ) {\r\n\treturn text.substring( howMany ).split( '' ).reverse().join( '' );\r\n}\r\n\r\n// Generates changes array based on change indexes from `findChangeBoundaryIndexes` function. This function will\r\n// generate array with 0 (no changes), 1 (deletion or insertion) or 2 records (insertion and deletion).\r\n//\r\n// @param {String} newText New text for which change indexes were calculated.\r\n// @param {Object} changeIndexes Change indexes object from `findChangeBoundaryIndexes` function.\r\n// @returns {Array.<Object>} Array of changes compatible with {@link module:utils/difftochanges~diffToChanges} format.\r\nfunction changeIndexesToChanges( newText, changeIndexes ) {\r\n\tconst result = [];\r\n\tconst { firstIndex, lastIndexOld, lastIndexNew } = changeIndexes;\r\n\r\n\t// Order operations as 'insert', 'delete' array to keep compatibility with {@link module:utils/difftochanges~diffToChanges}\r\n\t// in most cases. However, 'diffToChanges' does not stick to any order so in some cases\r\n\t// (for example replacing '12345' with 'abcd') it will generate 'delete', 'insert' order.\r\n\tif ( lastIndexNew - firstIndex > 0 ) {\r\n\t\tresult.push( {\r\n\t\t\tindex: firstIndex,\r\n\t\t\ttype: 'insert',\r\n\t\t\tvalues: newText.substring( firstIndex, lastIndexNew ).split( '' )\r\n\t\t} );\r\n\t}\r\n\r\n\tif ( lastIndexOld - firstIndex > 0 ) {\r\n\t\tresult.push( {\r\n\t\t\tindex: firstIndex + ( lastIndexNew - firstIndex ), // Increase index of what was inserted.\r\n\t\t\ttype: 'delete',\r\n\t\t\thowMany: lastIndexOld - firstIndex\r\n\t\t} );\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals Node */\r\n\r\n/**\r\n * @module engine/view/renderer\r\n */\r\n\r\nimport ViewText from './text';\r\nimport ViewPosition from './position';\r\nimport { INLINE_FILLER, INLINE_FILLER_LENGTH, startsWithFiller, isInlineFiller, isBlockFiller } from './filler';\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\r\nimport insertAt from '@ckeditor/ckeditor5-utils/src/dom/insertat';\r\nimport remove from '@ckeditor/ckeditor5-utils/src/dom/remove';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport isText from '@ckeditor/ckeditor5-utils/src/dom/istext';\r\nimport isNode from '@ckeditor/ckeditor5-utils/src/dom/isnode';\r\nimport fastDiff from '@ckeditor/ckeditor5-utils/src/fastdiff';\r\nimport env from '@ckeditor/ckeditor5-utils/src/env';\r\n\r\n/**\r\n * Renderer is responsible for updating the DOM structure and the DOM selection based on\r\n * the {@link module:engine/view/renderer~Renderer#markToSync information about updated view nodes}.\r\n * In other words, it renders the view to the DOM.\r\n *\r\n * Its main responsibility is to make only the necessary, minimal changes to the DOM. However, unlike in many\r\n * virtual DOM implementations, the primary reason for doing minimal changes is not the performance but ensuring\r\n * that native editing features such as text composition, autocompletion, spell checking, selection's x-index are\r\n * affected as little as possible.\r\n *\r\n * Renderer uses {@link module:engine/view/domconverter~DomConverter} to transform view nodes and positions\r\n * to and from the DOM.\r\n */\r\nexport default class Renderer {\r\n\t/**\r\n\t * Creates a renderer instance.\r\n\t *\r\n\t * @param {module:engine/view/domconverter~DomConverter} domConverter Converter instance.\r\n\t * @param {module:engine/view/documentselection~DocumentSelection} selection View selection.\r\n\t */\r\n\tconstructor( domConverter, selection ) {\r\n\t\t/**\r\n\t\t * Set of DOM Documents instances.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Set.<Document>}\r\n\t\t */\r\n\t\tthis.domDocuments = new Set();\r\n\r\n\t\t/**\r\n\t\t * Converter instance.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/domconverter~DomConverter}\r\n\t\t */\r\n\t\tthis.domConverter = domConverter;\r\n\r\n\t\t/**\r\n\t\t * Set of nodes which attributes changed and may need to be rendered.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Set.<module:engine/view/node~Node>}\r\n\t\t */\r\n\t\tthis.markedAttributes = new Set();\r\n\r\n\t\t/**\r\n\t\t * Set of elements which child lists changed and may need to be rendered.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Set.<module:engine/view/node~Node>}\r\n\t\t */\r\n\t\tthis.markedChildren = new Set();\r\n\r\n\t\t/**\r\n\t\t * Set of text nodes which text data changed and may need to be rendered.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Set.<module:engine/view/node~Node>}\r\n\t\t */\r\n\t\tthis.markedTexts = new Set();\r\n\r\n\t\t/**\r\n\t\t * View selection. Renderer updates DOM selection based on the view selection.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/documentselection~DocumentSelection}\r\n\t\t */\r\n\t\tthis.selection = selection;\r\n\r\n\t\t/**\r\n\t\t * Indicates if the view document is focused and selection can be rendered. Selection will not be rendered if\r\n\t\t * this is set to `false`.\r\n\t\t *\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis.isFocused = false;\r\n\r\n\t\t/**\r\n\t\t * The text node in which the inline filler was rendered.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Text}\r\n\t\t */\r\n\t\tthis._inlineFiller = null;\r\n\r\n\t\t/**\r\n\t\t * DOM element containing fake selection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {null|HTMLElement}\r\n\t\t */\r\n\t\tthis._fakeSelectionContainer = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a view node to be updated in the DOM by {@link #render `render()`}.\r\n\t *\r\n\t * Note that only view nodes whose parents have corresponding DOM elements need to be marked to be synchronized.\r\n\t *\r\n\t * @see #markedAttributes\r\n\t * @see #markedChildren\r\n\t * @see #markedTexts\r\n\t *\r\n\t * @param {module:engine/view/document~ChangeType} type Type of the change.\r\n\t * @param {module:engine/view/node~Node} node Node to be marked.\r\n\t */\r\n\tmarkToSync( type, node ) {\r\n\t\tif ( type === 'text' ) {\r\n\t\t\tif ( this.domConverter.mapViewToDom( node.parent ) ) {\r\n\t\t\t\tthis.markedTexts.add( node );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// If the node has no DOM element it is not rendered yet,\r\n\t\t\t// its children/attributes do not need to be marked to be sync.\r\n\t\t\tif ( !this.domConverter.mapViewToDom( node ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( type === 'attributes' ) {\r\n\t\t\t\tthis.markedAttributes.add( node );\r\n\t\t\t} else if ( type === 'children' ) {\r\n\t\t\t\tthis.markedChildren.add( node );\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * Unknown type passed to Renderer.markToSync.\r\n\t\t\t\t *\r\n\t\t\t\t * @error renderer-unknown-type\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'view-renderer-unknown-type: Unknown type passed to Renderer.markToSync.' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders all buffered changes ({@link #markedAttributes}, {@link #markedChildren} and {@link #markedTexts}) and\r\n\t * the current view selection (if needed) to the DOM by applying a minimal set of changes to it.\r\n\t *\r\n\t * Renderer tries not to break the text composition (e.g. IME) and x-index of the selection,\r\n\t * so it does as little as it is needed to update the DOM.\r\n\t *\r\n\t * Renderer also handles {@link module:engine/view/filler fillers}. Especially, it checks if the inline filler is needed\r\n\t * at the selection position and adds or removes it. To prevent breaking text composition inline filler will not be\r\n\t * removed as long as the selection is in the text node which needed it at first.\r\n\t */\r\n\trender() {\r\n\t\tlet inlineFillerPosition;\r\n\r\n\t\t// Refresh mappings.\r\n\t\tfor ( const element of this.markedChildren ) {\r\n\t\t\tthis._updateChildrenMappings( element );\r\n\t\t}\r\n\r\n\t\t// There was inline filler rendered in the DOM but it's not\r\n\t\t// at the selection position any more, so we can remove it\r\n\t\t// (cause even if it's needed, it must be placed in another location).\r\n\t\tif ( this._inlineFiller && !this._isSelectionInInlineFiller() ) {\r\n\t\t\tthis._removeInlineFiller();\r\n\t\t}\r\n\r\n\t\t// If we've got the filler, let's try to guess its position in the view.\r\n\t\tif ( this._inlineFiller ) {\r\n\t\t\tinlineFillerPosition = this._getInlineFillerPosition();\r\n\t\t}\r\n\t\t// Otherwise, if it's needed, create it at the selection position.\r\n\t\telse if ( this._needsInlineFillerAtSelection() ) {\r\n\t\t\tinlineFillerPosition = this.selection.getFirstPosition();\r\n\r\n\t\t\t// Do not use `markToSync` so it will be added even if the parent is already added.\r\n\t\t\tthis.markedChildren.add( inlineFillerPosition.parent );\r\n\t\t}\r\n\r\n\t\tfor ( const element of this.markedAttributes ) {\r\n\t\t\tthis._updateAttrs( element );\r\n\t\t}\r\n\r\n\t\tfor ( const element of this.markedChildren ) {\r\n\t\t\tthis._updateChildren( element, { inlineFillerPosition } );\r\n\t\t}\r\n\r\n\t\tfor ( const node of this.markedTexts ) {\r\n\t\t\tif ( !this.markedChildren.has( node.parent ) && this.domConverter.mapViewToDom( node.parent ) ) {\r\n\t\t\t\tthis._updateText( node, { inlineFillerPosition } );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check whether the inline filler is required and where it really is in the DOM.\r\n\t\t// At this point in most cases it will be in the DOM, but there are exceptions.\r\n\t\t// For example, if the inline filler was deep in the created DOM structure, it will not be created.\r\n\t\t// Similarly, if it was removed at the beginning of this function and then neither text nor children were updated,\r\n\t\t// it will not be present.\r\n\t\t// Fix those and similar scenarios.\r\n\t\tif ( inlineFillerPosition ) {\r\n\t\t\tconst fillerDomPosition = this.domConverter.viewPositionToDom( inlineFillerPosition );\r\n\t\t\tconst domDocument = fillerDomPosition.parent.ownerDocument;\r\n\r\n\t\t\tif ( !startsWithFiller( fillerDomPosition.parent ) ) {\r\n\t\t\t\t// Filler has not been created at filler position. Create it now.\r\n\t\t\t\tthis._inlineFiller = addInlineFiller( domDocument, fillerDomPosition.parent, fillerDomPosition.offset );\r\n\t\t\t} else {\r\n\t\t\t\t// Filler has been found, save it.\r\n\t\t\t\tthis._inlineFiller = fillerDomPosition.parent;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// There is no filler needed.\r\n\t\t\tthis._inlineFiller = null;\r\n\t\t}\r\n\r\n\t\tthis._updateSelection();\r\n\t\tthis._updateFocus();\r\n\r\n\t\tthis.markedTexts.clear();\r\n\t\tthis.markedAttributes.clear();\r\n\t\tthis.markedChildren.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates mappings of view element's children.\r\n\t *\r\n\t * Children that were replaced in the view structure by similar elements (same tag name) are treated as 'replaced'.\r\n\t * This means that their mappings can be updated so the new view elements are mapped to the existing DOM elements.\r\n\t * Thanks to that these elements do not need to be re-rendered completely.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/node~Node} viewElement The view element whose children mappings will be updated.\r\n\t */\r\n\t_updateChildrenMappings( viewElement ) {\r\n\t\tconst domElement = this.domConverter.mapViewToDom( viewElement );\r\n\r\n\t\tif ( !domElement ) {\r\n\t\t\t// If there is no `domElement` it means that it was already removed from DOM and there is no need to process it.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst actualDomChildren = this.domConverter.mapViewToDom( viewElement ).childNodes;\r\n\t\tconst expectedDomChildren = Array.from(\r\n\t\t\tthis.domConverter.viewChildrenToDom( viewElement, domElement.ownerDocument, { withChildren: false } )\r\n\t\t);\r\n\t\tconst diff = this._diffNodeLists( actualDomChildren, expectedDomChildren );\r\n\t\tconst actions = this._findReplaceActions( diff, actualDomChildren, expectedDomChildren );\r\n\r\n\t\tif ( actions.indexOf( 'replace' ) !== -1 ) {\r\n\t\t\tconst counter = { equal: 0, insert: 0, delete: 0 };\r\n\r\n\t\t\tfor ( const action of actions ) {\r\n\t\t\t\tif ( action === 'replace' ) {\r\n\t\t\t\t\tconst insertIndex = counter.equal + counter.insert;\r\n\t\t\t\t\tconst deleteIndex = counter.equal + counter.delete;\r\n\t\t\t\t\tconst viewChild = viewElement.getChild( insertIndex );\r\n\r\n\t\t\t\t\t// The 'uiElement' is a special one and its children are not stored in a view (#799),\r\n\t\t\t\t\t// so we cannot use it with replacing flow (since it uses view children during rendering\r\n\t\t\t\t\t// which will always result in rendering empty element).\r\n\t\t\t\t\tif ( viewChild && !viewChild.is( 'uiElement' ) ) {\r\n\t\t\t\t\t\tthis._updateElementMappings( viewChild, actualDomChildren[ deleteIndex ] );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tremove( expectedDomChildren[ insertIndex ] );\r\n\t\t\t\t\tcounter.equal++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcounter[ action ]++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates mappings of a given view element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/node~Node} viewElement The view element whose mappings will be updated.\r\n\t * @param {Node} domElement The DOM element representing the given view element.\r\n\t */\r\n\t_updateElementMappings( viewElement, domElement ) {\r\n\t\t// Remap 'DomConverter' bindings.\r\n\t\tthis.domConverter.unbindDomElement( domElement );\r\n\t\tthis.domConverter.bindElements( domElement, viewElement );\r\n\r\n\t\t// View element may have children which needs to be updated, but are not marked, mark them to update.\r\n\t\tthis.markedChildren.add( viewElement );\r\n\r\n\t\t// Because we replace new view element mapping with the existing one, the corresponding DOM element\r\n\t\t// will not be rerendered. The new view element may have different attributes than the previous one.\r\n\t\t// Since its corresponding DOM element will not be rerendered, new attributes will not be added\r\n\t\t// to the DOM, so we need to mark it here to make sure its attributes gets updated. See #1427 for more\r\n\t\t// detailed case study.\r\n\t\t// Also there are cases where replaced element is removed from the view structure and then has\r\n\t\t// its attributes changed or removed. In such cases the element will not be present in `markedAttributes`\r\n\t\t// and also may be the same (`element.isSimilar()`) as the reused element not having its attributes updated.\r\n\t\t// To prevent such situations we always mark reused element to have its attributes rerenderd (#1560).\r\n\t\tthis.markedAttributes.add( viewElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the position of the inline filler based on the current selection.\r\n\t * Here, we assume that we know that the filler is needed and\r\n\t * {@link #_isSelectionInInlineFiller is at the selection position}, and, since it is needed,\r\n\t * it is somewhere at the selection position.\r\n\t *\r\n\t * Note: The filler position cannot be restored based on the filler's DOM text node, because\r\n\t * when this method is called (before rendering), the bindings will often be broken. View-to-DOM\r\n\t * bindings are only dependable after rendering.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\t_getInlineFillerPosition() {\r\n\t\tconst firstPos = this.selection.getFirstPosition();\r\n\r\n\t\tif ( firstPos.parent.is( 'text' ) ) {\r\n\t\t\treturn ViewPosition._createBefore( this.selection.getFirstPosition().parent );\r\n\t\t} else {\r\n\t\t\treturn firstPos;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the selection has not left the inline filler's text node.\r\n\t * If it is `true`, it means that the filler had been added for a reason and the selection did not\r\n\t * leave the filler's text node. For example, the user can be in the middle of a composition so it should not be touched.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} `true` if the inline filler and selection are in the same place.\r\n\t */\r\n\t_isSelectionInInlineFiller() {\r\n\t\tif ( this.selection.rangeCount != 1 || !this.selection.isCollapsed ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Note, we can't check if selection's position equals position of the\r\n\t\t// this._inlineFiller node, because of #663. We may not be able to calculate\r\n\t\t// the filler's position in the view at this stage.\r\n\t\t// Instead, we check it the other way – whether selection is anchored in\r\n\t\t// that text node or next to it.\r\n\r\n\t\t// Possible options are:\r\n\t\t// \"FILLER{}\"\r\n\t\t// \"FILLERadded-text{}\"\r\n\t\tconst selectionPosition = this.selection.getFirstPosition();\r\n\t\tconst position = this.domConverter.viewPositionToDom( selectionPosition );\r\n\r\n\t\tif ( position && isText( position.parent ) && startsWithFiller( position.parent ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the inline filler.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_removeInlineFiller() {\r\n\t\tconst domFillerNode = this._inlineFiller;\r\n\r\n\t\t// Something weird happened and the stored node doesn't contain the filler's text.\r\n\t\tif ( !startsWithFiller( domFillerNode ) ) {\r\n\t\t\t/**\r\n\t\t\t * The inline filler node was lost. Most likely, something overwrote the filler text node\r\n\t\t\t * in the DOM.\r\n\t\t\t *\r\n\t\t\t * @error view-renderer-filler-was-lost\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-renderer-filler-was-lost: The inline filler node was lost.' );\r\n\t\t}\r\n\r\n\t\tif ( isInlineFiller( domFillerNode ) ) {\r\n\t\t\tdomFillerNode.parentNode.removeChild( domFillerNode );\r\n\t\t} else {\r\n\t\t\tdomFillerNode.data = domFillerNode.data.substr( INLINE_FILLER_LENGTH );\r\n\t\t}\r\n\r\n\t\tthis._inlineFiller = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the inline {@link module:engine/view/filler filler} should be added.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} `true` if the inline filler should be added.\r\n\t */\r\n\t_needsInlineFillerAtSelection() {\r\n\t\tif ( this.selection.rangeCount != 1 || !this.selection.isCollapsed ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst selectionPosition = this.selection.getFirstPosition();\r\n\t\tconst selectionParent = selectionPosition.parent;\r\n\t\tconst selectionOffset = selectionPosition.offset;\r\n\r\n\t\t// If there is no DOM root we do not care about fillers.\r\n\t\tif ( !this.domConverter.mapViewToDom( selectionParent.root ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( !( selectionParent.is( 'element' ) ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Prevent adding inline filler inside elements with contenteditable=false.\r\n\t\t// https://github.com/ckeditor/ckeditor5-engine/issues/1170\r\n\t\tif ( !isEditable( selectionParent ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// We have block filler, we do not need inline one.\r\n\t\tif ( selectionOffset === selectionParent.getFillerOffset() ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst nodeBefore = selectionPosition.nodeBefore;\r\n\t\tconst nodeAfter = selectionPosition.nodeAfter;\r\n\r\n\t\tif ( nodeBefore instanceof ViewText || nodeAfter instanceof ViewText ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if text needs to be updated and possibly updates it.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/text~Text} viewText View text to update.\r\n\t * @param {Object} options\r\n\t * @param {module:engine/view/position~Position} options.inlineFillerPosition The position where the inline\r\n\t * filler should be rendered.\r\n\t */\r\n\t_updateText( viewText, options ) {\r\n\t\tconst domText = this.domConverter.findCorrespondingDomText( viewText );\r\n\t\tconst newDomText = this.domConverter.viewToDom( viewText, domText.ownerDocument );\r\n\r\n\t\tconst actualText = domText.data;\r\n\t\tlet expectedText = newDomText.data;\r\n\r\n\t\tconst filler = options.inlineFillerPosition;\r\n\r\n\t\tif ( filler && filler.parent == viewText.parent && filler.offset == viewText.index ) {\r\n\t\t\texpectedText = INLINE_FILLER + expectedText;\r\n\t\t}\r\n\r\n\t\tif ( actualText != expectedText ) {\r\n\t\t\tconst actions = fastDiff( actualText, expectedText );\r\n\r\n\t\t\tfor ( const action of actions ) {\r\n\t\t\t\tif ( action.type === 'insert' ) {\r\n\t\t\t\t\tdomText.insertData( action.index, action.values.join( '' ) );\r\n\t\t\t\t} else { // 'delete'\r\n\t\t\t\t\tdomText.deleteData( action.index, action.howMany );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if attribute list needs to be updated and possibly updates it.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} viewElement The view element to update.\r\n\t */\r\n\t_updateAttrs( viewElement ) {\r\n\t\tconst domElement = this.domConverter.mapViewToDom( viewElement );\r\n\r\n\t\tif ( !domElement ) {\r\n\t\t\t// If there is no `domElement` it means that 'viewElement' is outdated as its mapping was updated\r\n\t\t\t// in 'this._updateChildrenMappings()'. There is no need to process it as new view element which\r\n\t\t\t// replaced old 'viewElement' mapping was also added to 'this.markedAttributes'\r\n\t\t\t// in 'this._updateChildrenMappings()' so it will be processed separately.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domAttrKeys = Array.from( domElement.attributes ).map( attr => attr.name );\r\n\t\tconst viewAttrKeys = viewElement.getAttributeKeys();\r\n\r\n\t\t// Add or overwrite attributes.\r\n\t\tfor ( const key of viewAttrKeys ) {\r\n\t\t\tdomElement.setAttribute( key, viewElement.getAttribute( key ) );\r\n\t\t}\r\n\r\n\t\t// Remove from DOM attributes which do not exists in the view.\r\n\t\tfor ( const key of domAttrKeys ) {\r\n\t\t\tif ( !viewElement.hasAttribute( key ) ) {\r\n\t\t\t\tdomElement.removeAttribute( key );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if elements child list needs to be updated and possibly updates it.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} viewElement View element to update.\r\n\t * @param {Object} options\r\n\t * @param {module:engine/view/position~Position} options.inlineFillerPosition The position where the inline\r\n\t * filler should be rendered.\r\n\t */\r\n\t_updateChildren( viewElement, options ) {\r\n\t\tconst domElement = this.domConverter.mapViewToDom( viewElement );\r\n\r\n\t\tif ( !domElement ) {\r\n\t\t\t// If there is no `domElement` it means that it was already removed from DOM.\r\n\t\t\t// There is no need to process it. It will be processed when re-inserted.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst inlineFillerPosition = options.inlineFillerPosition;\r\n\t\tconst actualDomChildren = this.domConverter.mapViewToDom( viewElement ).childNodes;\r\n\t\tconst expectedDomChildren = Array.from(\r\n\t\t\tthis.domConverter.viewChildrenToDom( viewElement, domElement.ownerDocument, { bind: true, inlineFillerPosition } )\r\n\t\t);\r\n\r\n\t\t// Inline filler element has to be created as it is present in the DOM, but not in the view. It is required\r\n\t\t// during diffing so text nodes could be compared correctly and also during rendering to maintain\r\n\t\t// proper order and indexes while updating the DOM.\r\n\t\tif ( inlineFillerPosition && inlineFillerPosition.parent === viewElement ) {\r\n\t\t\taddInlineFiller( domElement.ownerDocument, expectedDomChildren, inlineFillerPosition.offset );\r\n\t\t}\r\n\r\n\t\tconst diff = this._diffNodeLists( actualDomChildren, expectedDomChildren );\r\n\r\n\t\tlet i = 0;\r\n\t\tconst nodesToUnbind = new Set();\r\n\r\n\t\tfor ( const action of diff ) {\r\n\t\t\tif ( action === 'insert' ) {\r\n\t\t\t\tinsertAt( domElement, i, expectedDomChildren[ i ] );\r\n\t\t\t\ti++;\r\n\t\t\t} else if ( action === 'delete' ) {\r\n\t\t\t\tnodesToUnbind.add( actualDomChildren[ i ] );\r\n\t\t\t\tremove( actualDomChildren[ i ] );\r\n\t\t\t} else { // 'equal'\r\n\t\t\t\t// Force updating text nodes inside elements which did not change and do not need to be re-rendered (#1125).\r\n\t\t\t\tthis._markDescendantTextToSync( this.domConverter.domToView( expectedDomChildren[ i ] ) );\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Unbind removed nodes. When node does not have a parent it means that it was removed from DOM tree during\r\n\t\t// comparision with the expected DOM. We don't need to check child nodes, because if child node was reinserted,\r\n\t\t// it was moved to DOM tree out of the removed node.\r\n\t\tfor ( const node of nodesToUnbind ) {\r\n\t\t\tif ( !node.parentNode ) {\r\n\t\t\t\tthis.domConverter.unbindDomElement( node );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Shorthand for diffing two arrays or node lists of DOM nodes.\r\n\t *\r\n\t * @private\r\n\t * @param {Array.<Node>|NodeList} actualDomChildren Actual DOM children\r\n\t * @param {Array.<Node>|NodeList} expectedDomChildren Expected DOM children.\r\n\t * @returns {Array.<String>} The list of actions based on the {@link module:utils/diff~diff} function.\r\n\t */\r\n\t_diffNodeLists( actualDomChildren, expectedDomChildren ) {\r\n\t\treturn diff( actualDomChildren, expectedDomChildren, sameNodes.bind( null, this.domConverter.blockFiller ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Finds DOM nodes that were replaced with the similar nodes (same tag name) in the view. All nodes are compared\r\n\t * within one `insert`/`delete` action group, for example:\r\n\t *\r\n\t * \t\tActual DOM:\t\t<p><b>Foo</b>Bar<i>Baz</i><b>Bax</b></p>\r\n\t * \t\tExpected DOM:\t<p>Bar<b>123</b><i>Baz</i><b>456</b></p>\r\n\t * \t\tInput actions:\t[ insert, insert, delete, delete, equal, insert, delete ]\r\n\t * \t\tOutput actions:\t[ insert, replace, delete, equal, replace ]\r\n\t *\r\n\t * @private\r\n\t * @param {Array.<String>} actions Actions array which is a result of the {@link module:utils/diff~diff} function.\r\n\t * @param {Array.<Node>|NodeList} actualDom Actual DOM children\r\n\t * @param {Array.<Node>} expectedDom Expected DOM children.\r\n\t * @returns {Array.<String>} Actions array modified with the `replace` actions.\r\n\t */\r\n\t_findReplaceActions( actions, actualDom, expectedDom ) {\r\n\t\t// If there is no both 'insert' and 'delete' actions, no need to check for replaced elements.\r\n\t\tif ( actions.indexOf( 'insert' ) === -1 || actions.indexOf( 'delete' ) === -1 ) {\r\n\t\t\treturn actions;\r\n\t\t}\r\n\r\n\t\tlet newActions = [];\r\n\t\tlet actualSlice = [];\r\n\t\tlet expectedSlice = [];\r\n\r\n\t\tconst counter = { equal: 0, insert: 0, delete: 0 };\r\n\r\n\t\tfor ( const action of actions ) {\r\n\t\t\tif ( action === 'insert' ) {\r\n\t\t\t\texpectedSlice.push( expectedDom[ counter.equal + counter.insert ] );\r\n\t\t\t} else if ( action === 'delete' ) {\r\n\t\t\t\tactualSlice.push( actualDom[ counter.equal + counter.delete ] );\r\n\t\t\t} else { // equal\r\n\t\t\t\tnewActions = newActions.concat( diff( actualSlice, expectedSlice, areSimilar ).map( x => x === 'equal' ? 'replace' : x ) );\r\n\t\t\t\tnewActions.push( 'equal' );\r\n\t\t\t\t// Reset stored elements on 'equal'.\r\n\t\t\t\tactualSlice = [];\r\n\t\t\t\texpectedSlice = [];\r\n\t\t\t}\r\n\t\t\tcounter[ action ]++;\r\n\t\t}\r\n\r\n\t\treturn newActions.concat( diff( actualSlice, expectedSlice, areSimilar ).map( x => x === 'equal' ? 'replace' : x ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Marks text nodes to be synchronized.\r\n\t *\r\n\t * If a text node is passed, it will be marked. If an element is passed, all descendant text nodes inside it will be marked.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/node~Node} viewNode View node to sync.\r\n\t */\r\n\t_markDescendantTextToSync( viewNode ) {\r\n\t\tif ( !viewNode ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( viewNode.is( 'text' ) ) {\r\n\t\t\tthis.markedTexts.add( viewNode );\r\n\t\t} else if ( viewNode.is( 'element' ) ) {\r\n\t\t\tfor ( const child of viewNode.getChildren() ) {\r\n\t\t\t\tthis._markDescendantTextToSync( child );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the selection needs to be updated and possibly updates it.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_updateSelection() {\r\n\t\t// If there is no selection - remove DOM and fake selections.\r\n\t\tif ( this.selection.rangeCount === 0 ) {\r\n\t\t\tthis._removeDomSelection();\r\n\t\t\tthis._removeFakeSelection();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domRoot = this.domConverter.mapViewToDom( this.selection.editableElement );\r\n\r\n\t\t// Do nothing if there is no focus, or there is no DOM element corresponding to selection's editable element.\r\n\t\tif ( !this.isFocused || !domRoot ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Render selection.\r\n\t\tif ( this.selection.isFake ) {\r\n\t\t\tthis._updateFakeSelection( domRoot );\r\n\t\t} else {\r\n\t\t\tthis._removeFakeSelection();\r\n\t\t\tthis._updateDomSelection( domRoot );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the fake selection.\r\n\t *\r\n\t * @private\r\n\t * @param {HTMLElement} domRoot A valid DOM root where the fake selection container should be added.\r\n\t */\r\n\t_updateFakeSelection( domRoot ) {\r\n\t\tconst domDocument = domRoot.ownerDocument;\r\n\t\tlet container = this._fakeSelectionContainer;\r\n\r\n\t\t// Create fake selection container if one does not exist.\r\n\t\tif ( !container ) {\r\n\t\t\tthis._fakeSelectionContainer = container = domDocument.createElement( 'div' );\r\n\r\n\t\t\tObject.assign( container.style, {\r\n\t\t\t\tposition: 'fixed',\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: '-9999px',\r\n\t\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/752.\r\n\t\t\t\twidth: '42px'\r\n\t\t\t} );\r\n\r\n\t\t\t// Fill it with a text node so we can update it later.\r\n\t\t\tcontainer.appendChild( domDocument.createTextNode( '\\u00A0' ) );\r\n\t\t}\r\n\r\n\t\t// Add fake container if not already added.\r\n\t\tif ( !container.parentElement ) {\r\n\t\t\tdomRoot.appendChild( container );\r\n\t\t}\r\n\r\n\t\t// Update contents.\r\n\t\tcontainer.firstChild.data = this.selection.fakeSelectionLabel || '\\u00A0';\r\n\r\n\t\t// Update selection.\r\n\t\tconst domSelection = domDocument.getSelection();\r\n\t\tconst domRange = domDocument.createRange();\r\n\r\n\t\tdomSelection.removeAllRanges();\r\n\t\tdomRange.selectNodeContents( container );\r\n\t\tdomSelection.addRange( domRange );\r\n\r\n\t\t// Bind fake selection container with current selection.\r\n\t\tthis.domConverter.bindFakeSelection( container, this.selection );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the DOM selection.\r\n\t *\r\n\t * @private\r\n\t * @param {HTMLElement} domRoot A valid DOM root where the DOM selection should be rendered.\r\n\t */\r\n\t_updateDomSelection( domRoot ) {\r\n\t\tconst domSelection = domRoot.ownerDocument.defaultView.getSelection();\r\n\r\n\t\t// Let's check whether DOM selection needs updating at all.\r\n\t\tif ( !this._domSelectionNeedsUpdate( domSelection ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Multi-range selection is not available in most browsers, and, at least in Chrome, trying to\r\n\t\t// set such selection, that is not continuous, throws an error. Because of that, we will just use anchor\r\n\t\t// and focus of view selection.\r\n\t\t// Since we are not supporting multi-range selection, we also do not need to check if proper editable is\r\n\t\t// selected. If there is any editable selected, it is okay (editable is taken from selection anchor).\r\n\t\tconst anchor = this.domConverter.viewPositionToDom( this.selection.anchor );\r\n\t\tconst focus = this.domConverter.viewPositionToDom( this.selection.focus );\r\n\r\n\t\t// Focus the new editing host.\r\n\t\t// Otherwise, FF may throw an error (https://github.com/ckeditor/ckeditor5/issues/721).\r\n\t\tdomRoot.focus();\r\n\r\n\t\tdomSelection.collapse( anchor.parent, anchor.offset );\r\n\t\tdomSelection.extend( focus.parent, focus.offset );\r\n\r\n\t\t// Firefox–specific hack (https://github.com/ckeditor/ckeditor5-engine/issues/1439).\r\n\t\tif ( env.isGecko ) {\r\n\t\t\tfixGeckoSelectionAfterBr( focus, domSelection );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether a given DOM selection needs to be updated.\r\n\t *\r\n\t * @private\r\n\t * @param {Selection} domSelection The DOM selection to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_domSelectionNeedsUpdate( domSelection ) {\r\n\t\tif ( !this.domConverter.isDomSelectionCorrect( domSelection ) ) {\r\n\t\t\t// Current DOM selection is in incorrect position. We need to update it.\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst oldViewSelection = domSelection && this.domConverter.domSelectionToView( domSelection );\r\n\r\n\t\tif ( oldViewSelection && this.selection.isEqual( oldViewSelection ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If selection is not collapsed, it does not need to be updated if it is similar.\r\n\t\tif ( !this.selection.isCollapsed && this.selection.isSimilar( oldViewSelection ) ) {\r\n\t\t\t// Selection did not changed and is correct, do not update.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Selections are not similar.\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the DOM selection.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_removeDomSelection() {\r\n\t\tfor ( const doc of this.domDocuments ) {\r\n\t\t\tconst domSelection = doc.getSelection();\r\n\r\n\t\t\tif ( domSelection.rangeCount ) {\r\n\t\t\t\tconst activeDomElement = doc.activeElement;\r\n\t\t\t\tconst viewElement = this.domConverter.mapDomToView( activeDomElement );\r\n\r\n\t\t\t\tif ( activeDomElement && viewElement ) {\r\n\t\t\t\t\tdoc.getSelection().removeAllRanges();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the fake selection.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_removeFakeSelection() {\r\n\t\tconst container = this._fakeSelectionContainer;\r\n\r\n\t\tif ( container ) {\r\n\t\t\tcontainer.remove();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if focus needs to be updated and possibly updates it.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_updateFocus() {\r\n\t\tif ( this.isFocused ) {\r\n\t\t\tconst editable = this.selection.editableElement;\r\n\r\n\t\t\tif ( editable ) {\r\n\t\t\t\tthis.domConverter.focus( editable );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmix( Renderer, ObservableMixin );\r\n\r\n// Checks if provided element is editable.\r\n//\r\n// @private\r\n// @param {module:engine/view/element~Element} element\r\n// @returns {Boolean}\r\nfunction isEditable( element ) {\r\n\tif ( element.getAttribute( 'contenteditable' ) == 'false' ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst parent = element.findAncestor( element => element.hasAttribute( 'contenteditable' ) );\r\n\r\n\treturn !parent || parent.getAttribute( 'contenteditable' ) == 'true';\r\n}\r\n\r\n// Adds inline filler at a given position.\r\n//\r\n// The position can be given as an array of DOM nodes and an offset in that array,\r\n// or a DOM parent element and an offset in that element.\r\n//\r\n// @private\r\n// @param {Document} domDocument\r\n// @param {Element|Array.<Node>} domParentOrArray\r\n// @param {Number} offset\r\n// @returns {Text} The DOM text node that contains an inline filler.\r\nfunction addInlineFiller( domDocument, domParentOrArray, offset ) {\r\n\tconst childNodes = domParentOrArray instanceof Array ? domParentOrArray : domParentOrArray.childNodes;\r\n\tconst nodeAfterFiller = childNodes[ offset ];\r\n\r\n\tif ( isText( nodeAfterFiller ) ) {\r\n\t\tnodeAfterFiller.data = INLINE_FILLER + nodeAfterFiller.data;\r\n\r\n\t\treturn nodeAfterFiller;\r\n\t} else {\r\n\t\tconst fillerNode = domDocument.createTextNode( INLINE_FILLER );\r\n\r\n\t\tif ( Array.isArray( domParentOrArray ) ) {\r\n\t\t\tchildNodes.splice( offset, 0, fillerNode );\r\n\t\t} else {\r\n\t\t\tinsertAt( domParentOrArray, offset, fillerNode );\r\n\t\t}\r\n\r\n\t\treturn fillerNode;\r\n\t}\r\n}\r\n\r\n// Whether two DOM nodes should be considered as similar.\r\n// Nodes are considered similar if they have the same tag name.\r\n//\r\n// @private\r\n// @param {Node} node1\r\n// @param {Node} node2\r\n// @returns {Boolean}\r\nfunction areSimilar( node1, node2 ) {\r\n\treturn isNode( node1 ) && isNode( node2 ) &&\r\n\t\t!isText( node1 ) && !isText( node2 ) &&\r\n\t\tnode1.tagName.toLowerCase() === node2.tagName.toLowerCase();\r\n}\r\n\r\n// Whether two dom nodes should be considered as the same.\r\n// Two nodes which are considered the same are:\r\n//\r\n//\t\t* Text nodes with the same text.\r\n//\t\t* Element nodes represented by the same object.\r\n//\t\t* Two block filler elements.\r\n//\r\n// @private\r\n// @param {Function} blockFiller Block filler creator function, see {@link module:engine/view/domconverter~DomConverter#blockFiller}.\r\n// @param {Node} node1\r\n// @param {Node} node2\r\n// @returns {Boolean}\r\nfunction sameNodes( blockFiller, actualDomChild, expectedDomChild ) {\r\n\t// Elements.\r\n\tif ( actualDomChild === expectedDomChild ) {\r\n\t\treturn true;\r\n\t}\r\n\t// Texts.\r\n\telse if ( isText( actualDomChild ) && isText( expectedDomChild ) ) {\r\n\t\treturn actualDomChild.data === expectedDomChild.data;\r\n\t}\r\n\t// Block fillers.\r\n\telse if ( isBlockFiller( actualDomChild, blockFiller ) &&\r\n\t\tisBlockFiller( expectedDomChild, blockFiller ) ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Not matching types.\r\n\treturn false;\r\n}\r\n\r\n// The following is a Firefox–specific hack (https://github.com/ckeditor/ckeditor5-engine/issues/1439).\r\n// When the native DOM selection is at the end of the block and preceded by <br /> e.g.\r\n//\r\n//\t\t<p>foo<br/>[]</p>\r\n//\r\n// which happens a lot when using the soft line break, the browser fails to (visually) move the\r\n// caret to the new line. A quick fix is as simple as force–refreshing the selection with the same range.\r\nfunction fixGeckoSelectionAfterBr( focus, domSelection ) {\r\n\tconst parent = focus.parent;\r\n\r\n\t// This fix works only when the focus point is at the very end of an element.\r\n\t// There is no point in running it in cases unrelated to the browser bug.\r\n\tif ( parent.nodeType != Node.ELEMENT_NODE || focus.offset != parent.childNodes.length - 1 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst childAtOffset = parent.childNodes[ focus.offset ];\r\n\r\n\t// To stay on the safe side, the fix being as specific as possible, it targets only the\r\n\t// selection which is at the very end of the element and preceded by <br />.\r\n\tif ( childAtOffset && childAtOffset.tagName == 'BR' ) {\r\n\t\tdomSelection.addRange( domSelection.getRangeAt( 0 ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals window, document */\r\n\r\n/**\r\n * @module utils/dom/global\r\n */\r\n\r\n/**\r\n * A helper (module) giving an access to the global DOM objects such as `window` and\r\n * `document`. Accessing these objects using this helper allows easy and bulletproof\r\n * testing, i.e. stubbing native properties:\r\n *\r\n *\t\timport global from 'ckeditor5/utils/dom/global.js';\r\n *\r\n *\t\t// This stub will work for any code using global module.\r\n *\t\ttestUtils.sinon.stub( global, 'window', {\r\n *\t\t\tinnerWidth: 10000\r\n *\t\t} );\r\n *\r\n *\t\tconsole.log( global.window.innerWidth );\r\n */\r\nexport default { window, document };\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/indexof\r\n */\r\n\r\n/**\r\n * Returns index of the node in the parent element.\r\n *\r\n * @param {Node} node Node which index is tested.\r\n * @returns {Number} Index of the node in the parent element. Returns 0 if node has no parent.\r\n */\r\nexport default function indexOf( node ) {\r\n\tlet index = 0;\r\n\r\n\twhile ( node.previousSibling ) {\r\n\t\tnode = node.previousSibling;\r\n\t\tindex++;\r\n\t}\r\n\r\n\treturn index;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals Node */\r\n\r\n/**\r\n * @module utils/dom/getancestors\r\n */\r\n\r\n/**\r\n * Returns all ancestors of given DOM node, starting from the top-most (root). Includes the given node itself. If the\r\n * node is a part of `DocumentFragment` that `DocumentFragment` will be returned. In contrary, if the node is\r\n * appended to a `Document`, that `Document` will not be returned (algorithms operating on DOM tree care for `Document#documentElement`\r\n * at most, which will be returned).\r\n *\r\n * @param {Node} node DOM node.\r\n * @returns {Array.<Node|DocumentFragment>} Array of given `node` parents.\r\n */\r\nexport default function getAncestors( node ) {\r\n\tconst nodes = [];\r\n\r\n\t// We are interested in `Node`s `DocumentFragment`s only.\r\n\twhile ( node && node.nodeType != Node.DOCUMENT_NODE ) {\r\n\t\tnodes.unshift( node );\r\n\t\tnode = node.parentNode;\r\n\t}\r\n\r\n\treturn nodes;\r\n}\r\n","import isObjectLike from './isObjectLike.js';\nimport isPlainObject from './isPlainObject.js';\n\n/**\n * Checks if `value` is likely a DOM element.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a DOM element, else `false`.\n * @example\n *\n * _.isElement(document.body);\n * // => true\n *\n * _.isElement('<body>');\n * // => false\n */\nfunction isElement(value) {\n  return isObjectLike(value) && value.nodeType === 1 && !isPlainObject(value);\n}\n\nexport default isElement;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/domconverter\r\n */\r\n\r\n/* globals document, Node, NodeFilter, Text */\r\n\r\nimport ViewText from './text';\r\nimport ViewElement from './element';\r\nimport ViewPosition from './position';\r\nimport ViewRange from './range';\r\nimport ViewSelection from './selection';\r\nimport ViewDocumentFragment from './documentfragment';\r\nimport ViewTreeWalker from './treewalker';\r\nimport { BR_FILLER, INLINE_FILLER_LENGTH, isBlockFiller, isInlineFiller, startsWithFiller, getDataWithoutFiller } from './filler';\r\n\r\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\r\nimport indexOf from '@ckeditor/ckeditor5-utils/src/dom/indexof';\r\nimport getAncestors from '@ckeditor/ckeditor5-utils/src/dom/getancestors';\r\nimport getCommonAncestor from '@ckeditor/ckeditor5-utils/src/dom/getcommonancestor';\r\nimport isText from '@ckeditor/ckeditor5-utils/src/dom/istext';\r\nimport { isElement } from 'lodash-es';\r\n\r\n/**\r\n * DomConverter is a set of tools to do transformations between DOM nodes and view nodes. It also handles\r\n * {@link module:engine/view/domconverter~DomConverter#bindElements binding} these nodes.\r\n *\r\n * DomConverter does not check which nodes should be rendered (use {@link module:engine/view/renderer~Renderer}), does not keep a\r\n * state of a tree nor keeps synchronization between tree view and DOM tree (use {@link module:engine/view/document~Document}).\r\n *\r\n * DomConverter keeps DOM elements to View element bindings, so when the converter will be destroyed, the binding will\r\n * be lost. Two converters will keep separate binding maps, so one tree view can be bound with two DOM trees.\r\n */\r\nexport default class DomConverter {\r\n\t/**\r\n\t * Creates DOM converter.\r\n\t *\r\n\t * @param {Object} options Object with configuration options.\r\n\t * @param {Function} [options.blockFiller=module:engine/view/filler~BR_FILLER] Block filler creator.\r\n\t */\r\n\tconstructor( options = {} ) {\r\n\t\t// Using WeakMap prevent memory leaks: when the converter will be destroyed all referenced between View and DOM\r\n\t\t// will be removed. Also because it is a *Weak*Map when both view and DOM elements will be removed referenced\r\n\t\t// will be also removed, isn't it brilliant?\r\n\t\t//\r\n\t\t// Yes, PJ. It is.\r\n\t\t//\r\n\t\t// You guys so smart.\r\n\t\t//\r\n\t\t// I've been here. Seen stuff. Afraid of code now.\r\n\r\n\t\t/**\r\n\t\t * Block {@link module:engine/view/filler filler} creator, which is used to create all block fillers during the\r\n\t\t * view to DOM conversion and to recognize block fillers during the DOM to view conversion.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Function} module:engine/view/domconverter~DomConverter#blockFiller\r\n\t\t */\r\n\t\tthis.blockFiller = options.blockFiller || BR_FILLER;\r\n\r\n\t\t/**\r\n\t\t * Tag names of DOM `Element`s which are considered pre-formatted elements.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<String>} module:engine/view/domconverter~DomConverter#preElements\r\n\t\t */\r\n\t\tthis.preElements = [ 'pre' ];\r\n\r\n\t\t/**\r\n\t\t * Tag names of DOM `Element`s which are considered block elements.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<String>} module:engine/view/domconverter~DomConverter#blockElements\r\n\t\t */\r\n\t\tthis.blockElements = [ 'p', 'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6' ];\r\n\r\n\t\t/**\r\n\t\t * DOM to View mapping.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakMap} module:engine/view/domconverter~DomConverter#_domToViewMapping\r\n\t\t */\r\n\t\tthis._domToViewMapping = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * View to DOM mapping.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakMap} module:engine/view/domconverter~DomConverter#_viewToDomMapping\r\n\t\t */\r\n\t\tthis._viewToDomMapping = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * Holds mapping between fake selection containers and corresponding view selections.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakMap} module:engine/view/domconverter~DomConverter#_fakeSelectionMapping\r\n\t\t */\r\n\t\tthis._fakeSelectionMapping = new WeakMap();\r\n\t}\r\n\r\n\t/**\r\n\t * Binds given DOM element that represents fake selection to {@link module:engine/view/documentselection~DocumentSelection\r\n\t * document selection}. Document selection copy is stored and can be retrieved by\r\n\t * {@link module:engine/view/domconverter~DomConverter#fakeSelectionToView} method.\r\n\t *\r\n\t * @param {HTMLElement} domElement\r\n\t * @param {module:engine/view/documentselection~DocumentSelection} viewDocumentSelection\r\n\t */\r\n\tbindFakeSelection( domElement, viewDocumentSelection ) {\r\n\t\tthis._fakeSelectionMapping.set( domElement, new ViewSelection( viewDocumentSelection ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns {@link module:engine/view/selection~Selection view selection} instance corresponding to\r\n\t * given DOM element that represents fake selection. Returns `undefined` if binding to given DOM element does not exists.\r\n\t *\r\n\t * @param {HTMLElement} domElement\r\n\t * @returns {module:engine/view/selection~Selection|undefined}\r\n\t */\r\n\tfakeSelectionToView( domElement ) {\r\n\t\treturn this._fakeSelectionMapping.get( domElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Binds DOM and View elements, so it will be possible to get corresponding elements using\r\n\t * {@link module:engine/view/domconverter~DomConverter#mapDomToView} and\r\n\t * {@link module:engine/view/domconverter~DomConverter#mapViewToDom}.\r\n\t *\r\n\t * @param {HTMLElement} domElement DOM element to bind.\r\n\t * @param {module:engine/view/element~Element} viewElement View element to bind.\r\n\t */\r\n\tbindElements( domElement, viewElement ) {\r\n\t\tthis._domToViewMapping.set( domElement, viewElement );\r\n\t\tthis._viewToDomMapping.set( viewElement, domElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds given `domElement` from the view element it was bound to. Unbinding is deep, meaning that all children of\r\n\t * `domElement` will be unbound too.\r\n\t *\r\n\t * @param {HTMLElement} domElement DOM element to unbind.\r\n\t */\r\n\tunbindDomElement( domElement ) {\r\n\t\tconst viewElement = this._domToViewMapping.get( domElement );\r\n\r\n\t\tif ( viewElement ) {\r\n\t\t\tthis._domToViewMapping.delete( domElement );\r\n\t\t\tthis._viewToDomMapping.delete( viewElement );\r\n\r\n\t\t\t// Use Array.from because of MS Edge (#923).\r\n\t\t\tfor ( const child of Array.from( domElement.childNodes ) ) {\r\n\t\t\t\tthis.unbindDomElement( child );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Binds DOM and View document fragments, so it will be possible to get corresponding document fragments using\r\n\t * {@link module:engine/view/domconverter~DomConverter#mapDomToView} and\r\n\t * {@link module:engine/view/domconverter~DomConverter#mapViewToDom}.\r\n\t *\r\n\t * @param {DocumentFragment} domFragment DOM document fragment to bind.\r\n\t * @param {module:engine/view/documentfragment~DocumentFragment} viewFragment View document fragment to bind.\r\n\t */\r\n\tbindDocumentFragments( domFragment, viewFragment ) {\r\n\t\tthis._domToViewMapping.set( domFragment, viewFragment );\r\n\t\tthis._viewToDomMapping.set( viewFragment, domFragment );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts view to DOM. For all text nodes, not bound elements and document fragments new items will\r\n\t * be created. For bound elements and document fragments function will return corresponding items.\r\n\t *\r\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} viewNode\r\n\t * View node or document fragment to transform.\r\n\t * @param {Document} domDocument Document which will be used to create DOM nodes.\r\n\t * @param {Object} [options] Conversion options.\r\n\t * @param {Boolean} [options.bind=false] Determines whether new elements will be bound.\r\n\t * @param {Boolean} [options.withChildren=true] If `true`, node's and document fragment's children will be converted too.\r\n\t * @returns {Node|DocumentFragment} Converted node or DocumentFragment.\r\n\t */\r\n\tviewToDom( viewNode, domDocument, options = {} ) {\r\n\t\tif ( viewNode.is( 'text' ) ) {\r\n\t\t\tconst textData = this._processDataFromViewText( viewNode );\r\n\r\n\t\t\treturn domDocument.createTextNode( textData );\r\n\t\t} else {\r\n\t\t\tif ( this.mapViewToDom( viewNode ) ) {\r\n\t\t\t\treturn this.mapViewToDom( viewNode );\r\n\t\t\t}\r\n\r\n\t\t\tlet domElement;\r\n\r\n\t\t\tif ( viewNode.is( 'documentFragment' ) ) {\r\n\t\t\t\t// Create DOM document fragment.\r\n\t\t\t\tdomElement = domDocument.createDocumentFragment();\r\n\r\n\t\t\t\tif ( options.bind ) {\r\n\t\t\t\t\tthis.bindDocumentFragments( domElement, viewNode );\r\n\t\t\t\t}\r\n\t\t\t} else if ( viewNode.is( 'uiElement' ) ) {\r\n\t\t\t\t// UIElement has its own render() method (see #799).\r\n\t\t\t\tdomElement = viewNode.render( domDocument );\r\n\r\n\t\t\t\tif ( options.bind ) {\r\n\t\t\t\t\tthis.bindElements( domElement, viewNode );\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn domElement;\r\n\t\t\t} else {\r\n\t\t\t\t// Create DOM element.\r\n\t\t\t\tdomElement = domDocument.createElement( viewNode.name );\r\n\r\n\t\t\t\tif ( options.bind ) {\r\n\t\t\t\t\tthis.bindElements( domElement, viewNode );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy element's attributes.\r\n\t\t\t\tfor ( const key of viewNode.getAttributeKeys() ) {\r\n\t\t\t\t\tdomElement.setAttribute( key, viewNode.getAttribute( key ) );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( options.withChildren || options.withChildren === undefined ) {\r\n\t\t\t\tfor ( const child of this.viewChildrenToDom( viewNode, domDocument, options ) ) {\r\n\t\t\t\t\tdomElement.appendChild( child );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn domElement;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts children of the view element to DOM using the\r\n\t * {@link module:engine/view/domconverter~DomConverter#viewToDom} method.\r\n\t * Additionally, this method adds block {@link module:engine/view/filler filler} to the list of children, if needed.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} viewElement Parent view element.\r\n\t * @param {Document} domDocument Document which will be used to create DOM nodes.\r\n\t * @param {Object} options See {@link module:engine/view/domconverter~DomConverter#viewToDom} options parameter.\r\n\t * @returns {Iterable.<Node>} DOM nodes.\r\n\t */\r\n\t* viewChildrenToDom( viewElement, domDocument, options = {} ) {\r\n\t\tconst fillerPositionOffset = viewElement.getFillerOffset && viewElement.getFillerOffset();\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor ( const childView of viewElement.getChildren() ) {\r\n\t\t\tif ( fillerPositionOffset === offset ) {\r\n\t\t\t\tyield this.blockFiller( domDocument );\r\n\t\t\t}\r\n\r\n\t\t\tyield this.viewToDom( childView, domDocument, options );\r\n\r\n\t\t\toffset++;\r\n\t\t}\r\n\r\n\t\tif ( fillerPositionOffset === offset ) {\r\n\t\t\tyield this.blockFiller( domDocument );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts view {@link module:engine/view/range~Range} to DOM range.\r\n\t * Inline and block {@link module:engine/view/filler fillers} are handled during the conversion.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} viewRange View range.\r\n\t * @returns {Range} DOM range.\r\n\t */\r\n\tviewRangeToDom( viewRange ) {\r\n\t\tconst domStart = this.viewPositionToDom( viewRange.start );\r\n\t\tconst domEnd = this.viewPositionToDom( viewRange.end );\r\n\r\n\t\tconst domRange = document.createRange();\r\n\t\tdomRange.setStart( domStart.parent, domStart.offset );\r\n\t\tdomRange.setEnd( domEnd.parent, domEnd.offset );\r\n\r\n\t\treturn domRange;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts view {@link module:engine/view/position~Position} to DOM parent and offset.\r\n\t *\r\n\t * Inline and block {@link module:engine/view/filler fillers} are handled during the conversion.\r\n\t * If the converted position is directly before inline filler it is moved inside the filler.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} viewPosition View position.\r\n\t * @returns {Object|null} position DOM position or `null` if view position could not be converted to DOM.\r\n\t * @returns {Node} position.parent DOM position parent.\r\n\t * @returns {Number} position.offset DOM position offset.\r\n\t */\r\n\tviewPositionToDom( viewPosition ) {\r\n\t\tconst viewParent = viewPosition.parent;\r\n\r\n\t\tif ( viewParent.is( 'text' ) ) {\r\n\t\t\tconst domParent = this.findCorrespondingDomText( viewParent );\r\n\r\n\t\t\tif ( !domParent ) {\r\n\t\t\t\t// Position is in a view text node that has not been rendered to DOM yet.\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tlet offset = viewPosition.offset;\r\n\r\n\t\t\tif ( startsWithFiller( domParent ) ) {\r\n\t\t\t\toffset += INLINE_FILLER_LENGTH;\r\n\t\t\t}\r\n\r\n\t\t\treturn { parent: domParent, offset };\r\n\t\t} else {\r\n\t\t\t// viewParent is instance of ViewElement.\r\n\t\t\tlet domParent, domBefore, domAfter;\r\n\r\n\t\t\tif ( viewPosition.offset === 0 ) {\r\n\t\t\t\tdomParent = this.mapViewToDom( viewParent );\r\n\r\n\t\t\t\tif ( !domParent ) {\r\n\t\t\t\t\t// Position is in a view element that has not been rendered to DOM yet.\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdomAfter = domParent.childNodes[ 0 ];\r\n\t\t\t} else {\r\n\t\t\t\tconst nodeBefore = viewPosition.nodeBefore;\r\n\r\n\t\t\t\tdomBefore = nodeBefore.is( 'text' ) ?\r\n\t\t\t\t\tthis.findCorrespondingDomText( nodeBefore ) :\r\n\t\t\t\t\tthis.mapViewToDom( viewPosition.nodeBefore );\r\n\r\n\t\t\t\tif ( !domBefore ) {\r\n\t\t\t\t\t// Position is after a view element that has not been rendered to DOM yet.\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdomParent = domBefore.parentNode;\r\n\t\t\t\tdomAfter = domBefore.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\t// If there is an inline filler at position return position inside the filler. We should never return\r\n\t\t\t// the position before the inline filler.\r\n\t\t\tif ( isText( domAfter ) && startsWithFiller( domAfter ) ) {\r\n\t\t\t\treturn { parent: domAfter, offset: INLINE_FILLER_LENGTH };\r\n\t\t\t}\r\n\r\n\t\t\tconst offset = domBefore ? indexOf( domBefore ) + 1 : 0;\r\n\r\n\t\t\treturn { parent: domParent, offset };\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts DOM to view. For all text nodes, not bound elements and document fragments new items will\r\n\t * be created. For bound elements and document fragments function will return corresponding items. For\r\n\t * {@link module:engine/view/filler fillers} `null` will be returned.\r\n\t * For all DOM elements rendered by {@link module:engine/view/uielement~UIElement} that UIElement will be returned.\r\n\t *\r\n\t * @param {Node|DocumentFragment} domNode DOM node or document fragment to transform.\r\n\t * @param {Object} [options] Conversion options.\r\n\t * @param {Boolean} [options.bind=false] Determines whether new elements will be bound.\r\n\t * @param {Boolean} [options.withChildren=true] If `true`, node's and document fragment's children will be converted too.\r\n\t * @param {Boolean} [options.keepOriginalCase=false] If `false`, node's tag name will be converter to lower case.\r\n\t * @returns {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment|null} Converted node or document fragment\r\n\t * or `null` if DOM node is a {@link module:engine/view/filler filler} or the given node is an empty text node.\r\n\t */\r\n\tdomToView( domNode, options = {} ) {\r\n\t\tif ( isBlockFiller( domNode, this.blockFiller ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// When node is inside UIElement return that UIElement as it's view representation.\r\n\t\tconst uiElement = this.getParentUIElement( domNode, this._domToViewMapping );\r\n\r\n\t\tif ( uiElement ) {\r\n\t\t\treturn uiElement;\r\n\t\t}\r\n\r\n\t\tif ( isText( domNode ) ) {\r\n\t\t\tif ( isInlineFiller( domNode ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\tconst textData = this._processDataFromDomText( domNode );\r\n\r\n\t\t\t\treturn textData === '' ? null : new ViewText( textData );\r\n\t\t\t}\r\n\t\t} else if ( this.isComment( domNode ) ) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tif ( this.mapDomToView( domNode ) ) {\r\n\t\t\t\treturn this.mapDomToView( domNode );\r\n\t\t\t}\r\n\r\n\t\t\tlet viewElement;\r\n\r\n\t\t\tif ( this.isDocumentFragment( domNode ) ) {\r\n\t\t\t\t// Create view document fragment.\r\n\t\t\t\tviewElement = new ViewDocumentFragment();\r\n\r\n\t\t\t\tif ( options.bind ) {\r\n\t\t\t\t\tthis.bindDocumentFragments( domNode, viewElement );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Create view element.\r\n\t\t\t\tconst viewName = options.keepOriginalCase ? domNode.tagName : domNode.tagName.toLowerCase();\r\n\t\t\t\tviewElement = new ViewElement( viewName );\r\n\r\n\t\t\t\tif ( options.bind ) {\r\n\t\t\t\t\tthis.bindElements( domNode, viewElement );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy element's attributes.\r\n\t\t\t\tconst attrs = domNode.attributes;\r\n\r\n\t\t\t\tfor ( let i = attrs.length - 1; i >= 0; i-- ) {\r\n\t\t\t\t\tviewElement._setAttribute( attrs[ i ].name, attrs[ i ].value );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( options.withChildren || options.withChildren === undefined ) {\r\n\t\t\t\tfor ( const child of this.domChildrenToView( domNode, options ) ) {\r\n\t\t\t\t\tviewElement._appendChild( child );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn viewElement;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts children of the DOM element to view nodes using\r\n\t * the {@link module:engine/view/domconverter~DomConverter#domToView} method.\r\n\t * Additionally this method omits block {@link module:engine/view/filler filler}, if it exists in the DOM parent.\r\n\t *\r\n\t * @param {HTMLElement} domElement Parent DOM element.\r\n\t * @param {Object} options See {@link module:engine/view/domconverter~DomConverter#domToView} options parameter.\r\n\t * @returns {Iterable.<module:engine/view/node~Node>} View nodes.\r\n\t */\r\n\t* domChildrenToView( domElement, options = {} ) {\r\n\t\tfor ( let i = 0; i < domElement.childNodes.length; i++ ) {\r\n\t\t\tconst domChild = domElement.childNodes[ i ];\r\n\t\t\tconst viewChild = this.domToView( domChild, options );\r\n\r\n\t\t\tif ( viewChild !== null ) {\r\n\t\t\t\tyield viewChild;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts DOM selection to view {@link module:engine/view/selection~Selection}.\r\n\t * Ranges which cannot be converted will be omitted.\r\n\t *\r\n\t * @param {Selection} domSelection DOM selection.\r\n\t * @returns {module:engine/view/selection~Selection} View selection.\r\n\t */\r\n\tdomSelectionToView( domSelection ) {\r\n\t\t// DOM selection might be placed in fake selection container.\r\n\t\t// If container contains fake selection - return corresponding view selection.\r\n\t\tif ( domSelection.rangeCount === 1 ) {\r\n\t\t\tlet container = domSelection.getRangeAt( 0 ).startContainer;\r\n\r\n\t\t\t// The DOM selection might be moved to the text node inside the fake selection container.\r\n\t\t\tif ( isText( container ) ) {\r\n\t\t\t\tcontainer = container.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tconst viewSelection = this.fakeSelectionToView( container );\r\n\r\n\t\t\tif ( viewSelection ) {\r\n\t\t\t\treturn viewSelection;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst isBackward = this.isDomSelectionBackward( domSelection );\r\n\r\n\t\tconst viewRanges = [];\r\n\r\n\t\tfor ( let i = 0; i < domSelection.rangeCount; i++ ) {\r\n\t\t\t// DOM Range have correct start and end, no matter what is the DOM Selection direction. So we don't have to fix anything.\r\n\t\t\tconst domRange = domSelection.getRangeAt( i );\r\n\t\t\tconst viewRange = this.domRangeToView( domRange );\r\n\r\n\t\t\tif ( viewRange ) {\r\n\t\t\t\tviewRanges.push( viewRange );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new ViewSelection( viewRanges, { backward: isBackward } );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts DOM Range to view {@link module:engine/view/range~Range}.\r\n\t * If the start or end position can not be converted `null` is returned.\r\n\t *\r\n\t * @param {Range} domRange DOM range.\r\n\t * @returns {module:engine/view/range~Range|null} View range.\r\n\t */\r\n\tdomRangeToView( domRange ) {\r\n\t\tconst viewStart = this.domPositionToView( domRange.startContainer, domRange.startOffset );\r\n\t\tconst viewEnd = this.domPositionToView( domRange.endContainer, domRange.endOffset );\r\n\r\n\t\tif ( viewStart && viewEnd ) {\r\n\t\t\treturn new ViewRange( viewStart, viewEnd );\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts DOM parent and offset to view {@link module:engine/view/position~Position}.\r\n\t *\r\n\t * If the position is inside a {@link module:engine/view/filler filler} which has no corresponding view node,\r\n\t * position of the filler will be converted and returned.\r\n\t *\r\n\t * If the position is inside DOM element rendered by {@link module:engine/view/uielement~UIElement}\r\n\t * that position will be converted to view position before that UIElement.\r\n\t *\r\n\t * If structures are too different and it is not possible to find corresponding position then `null` will be returned.\r\n\t *\r\n\t * @param {Node} domParent DOM position parent.\r\n\t * @param {Number} domOffset DOM position offset.\r\n\t * @returns {module:engine/view/position~Position} viewPosition View position.\r\n\t */\r\n\tdomPositionToView( domParent, domOffset ) {\r\n\t\tif ( isBlockFiller( domParent, this.blockFiller ) ) {\r\n\t\t\treturn this.domPositionToView( domParent.parentNode, indexOf( domParent ) );\r\n\t\t}\r\n\r\n\t\t// If position is somewhere inside UIElement - return position before that element.\r\n\t\tconst viewElement = this.mapDomToView( domParent );\r\n\r\n\t\tif ( viewElement && viewElement.is( 'uiElement' ) ) {\r\n\t\t\treturn ViewPosition._createBefore( viewElement );\r\n\t\t}\r\n\r\n\t\tif ( isText( domParent ) ) {\r\n\t\t\tif ( isInlineFiller( domParent ) ) {\r\n\t\t\t\treturn this.domPositionToView( domParent.parentNode, indexOf( domParent ) );\r\n\t\t\t}\r\n\r\n\t\t\tconst viewParent = this.findCorrespondingViewText( domParent );\r\n\t\t\tlet offset = domOffset;\r\n\r\n\t\t\tif ( !viewParent ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif ( startsWithFiller( domParent ) ) {\r\n\t\t\t\toffset -= INLINE_FILLER_LENGTH;\r\n\t\t\t\toffset = offset < 0 ? 0 : offset;\r\n\t\t\t}\r\n\r\n\t\t\treturn new ViewPosition( viewParent, offset );\r\n\t\t}\r\n\t\t// domParent instanceof HTMLElement.\r\n\t\telse {\r\n\t\t\tif ( domOffset === 0 ) {\r\n\t\t\t\tconst viewParent = this.mapDomToView( domParent );\r\n\r\n\t\t\t\tif ( viewParent ) {\r\n\t\t\t\t\treturn new ViewPosition( viewParent, 0 );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst domBefore = domParent.childNodes[ domOffset - 1 ];\r\n\t\t\t\tconst viewBefore = isText( domBefore ) ?\r\n\t\t\t\t\tthis.findCorrespondingViewText( domBefore ) :\r\n\t\t\t\t\tthis.mapDomToView( domBefore );\r\n\r\n\t\t\t\t// TODO #663\r\n\t\t\t\tif ( viewBefore && viewBefore.parent ) {\r\n\t\t\t\t\treturn new ViewPosition( viewBefore.parent, viewBefore.index + 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns corresponding view {@link module:engine/view/element~Element Element} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment} for provided DOM element or\r\n\t * document fragment. If there is no view item {@link module:engine/view/domconverter~DomConverter#bindElements bound}\r\n\t * to the given DOM - `undefined` is returned.\r\n\t * For all DOM elements rendered by {@link module:engine/view/uielement~UIElement} that UIElement will be returned.\r\n\t *\r\n\t * @param {DocumentFragment|Element} domElementOrDocumentFragment DOM element or document fragment.\r\n\t * @returns {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment|undefined}\r\n\t * Corresponding view element, document fragment or `undefined` if no element was bound.\r\n\t */\r\n\tmapDomToView( domElementOrDocumentFragment ) {\r\n\t\treturn this.getParentUIElement( domElementOrDocumentFragment ) || this._domToViewMapping.get( domElementOrDocumentFragment );\r\n\t}\r\n\r\n\t/**\r\n\t * Finds corresponding text node. Text nodes are not {@link module:engine/view/domconverter~DomConverter#bindElements bound},\r\n\t * corresponding text node is returned based on the sibling or parent.\r\n\t *\r\n\t * If the directly previous sibling is a {@link module:engine/view/domconverter~DomConverter#bindElements bound} element, it is used\r\n\t * to find the corresponding text node.\r\n\t *\r\n\t * If this is a first child in the parent and the parent is a {@link module:engine/view/domconverter~DomConverter#bindElements bound}\r\n\t * element, it is used to find the corresponding text node.\r\n\t *\r\n\t * For all text nodes rendered by {@link module:engine/view/uielement~UIElement} that UIElement will be returned.\r\n\t *\r\n\t * Otherwise `null` is returned.\r\n\t *\r\n\t * Note that for the block or inline {@link module:engine/view/filler filler} this method returns `null`.\r\n\t *\r\n\t * @param {Text} domText DOM text node.\r\n\t * @returns {module:engine/view/text~Text|null} Corresponding view text node or `null`, if it was not possible to find a\r\n\t * corresponding node.\r\n\t */\r\n\tfindCorrespondingViewText( domText ) {\r\n\t\tif ( isInlineFiller( domText ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// If DOM text was rendered by UIElement - return that element.\r\n\t\tconst uiElement = this.getParentUIElement( domText );\r\n\r\n\t\tif ( uiElement ) {\r\n\t\t\treturn uiElement;\r\n\t\t}\r\n\r\n\t\tconst previousSibling = domText.previousSibling;\r\n\r\n\t\t// Try to use previous sibling to find the corresponding text node.\r\n\t\tif ( previousSibling ) {\r\n\t\t\tif ( !( this.isElement( previousSibling ) ) ) {\r\n\t\t\t\t// The previous is text or comment.\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst viewElement = this.mapDomToView( previousSibling );\r\n\r\n\t\t\tif ( viewElement ) {\r\n\t\t\t\tconst nextSibling = viewElement.nextSibling;\r\n\r\n\t\t\t\t// It might be filler which has no corresponding view node.\r\n\t\t\t\tif ( nextSibling instanceof ViewText ) {\r\n\t\t\t\t\treturn viewElement.nextSibling;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Try to use parent to find the corresponding text node.\r\n\t\telse {\r\n\t\t\tconst viewElement = this.mapDomToView( domText.parentNode );\r\n\r\n\t\t\tif ( viewElement ) {\r\n\t\t\t\tconst firstChild = viewElement.getChild( 0 );\r\n\r\n\t\t\t\t// It might be filler which has no corresponding view node.\r\n\t\t\t\tif ( firstChild instanceof ViewText ) {\r\n\t\t\t\t\treturn firstChild;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns corresponding DOM item for provided {@link module:engine/view/element~Element Element} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment DocumentFragment}.\r\n\t * To find a corresponding text for {@link module:engine/view/text~Text view Text instance}\r\n\t * use {@link #findCorrespondingDomText}.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} viewNode\r\n\t * View element or document fragment.\r\n\t * @returns {Node|DocumentFragment|undefined} Corresponding DOM node or document fragment.\r\n\t */\r\n\tmapViewToDom( documentFragmentOrElement ) {\r\n\t\treturn this._viewToDomMapping.get( documentFragmentOrElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Finds corresponding text node. Text nodes are not {@link module:engine/view/domconverter~DomConverter#bindElements bound},\r\n\t * corresponding text node is returned based on the sibling or parent.\r\n\t *\r\n\t * If the directly previous sibling is a {@link module:engine/view/domconverter~DomConverter#bindElements bound} element, it is used\r\n\t * to find the corresponding text node.\r\n\t *\r\n\t * If this is a first child in the parent and the parent is a {@link module:engine/view/domconverter~DomConverter#bindElements bound}\r\n\t * element, it is used to find the corresponding text node.\r\n\t *\r\n\t * Otherwise `null` is returned.\r\n\t *\r\n\t * @param {module:engine/view/text~Text} viewText View text node.\r\n\t * @returns {Text|null} Corresponding DOM text node or `null`, if it was not possible to find a corresponding node.\r\n\t */\r\n\tfindCorrespondingDomText( viewText ) {\r\n\t\tconst previousSibling = viewText.previousSibling;\r\n\r\n\t\t// Try to use previous sibling to find the corresponding text node.\r\n\t\tif ( previousSibling && this.mapViewToDom( previousSibling ) ) {\r\n\t\t\treturn this.mapViewToDom( previousSibling ).nextSibling;\r\n\t\t}\r\n\r\n\t\t// If this is a first node, try to use parent to find the corresponding text node.\r\n\t\tif ( !previousSibling && viewText.parent && this.mapViewToDom( viewText.parent ) ) {\r\n\t\t\treturn this.mapViewToDom( viewText.parent ).childNodes[ 0 ];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses DOM editable that is corresponding to provided {@link module:engine/view/editableelement~EditableElement}.\r\n\t *\r\n\t * @param {module:engine/view/editableelement~EditableElement} viewEditable\r\n\t */\r\n\tfocus( viewEditable ) {\r\n\t\tconst domEditable = this.mapViewToDom( viewEditable );\r\n\r\n\t\tif ( domEditable && domEditable.ownerDocument.activeElement !== domEditable ) {\r\n\t\t\t// Save the scrollX and scrollY positions before the focus.\r\n\t\t\tconst { scrollX, scrollY } = global.window;\r\n\t\t\tconst scrollPositions = [];\r\n\r\n\t\t\t// Save all scrollLeft and scrollTop values starting from domEditable up to\r\n\t\t\t// document#documentElement.\r\n\t\t\tforEachDomNodeAncestor( domEditable, node => {\r\n\t\t\t\tconst { scrollLeft, scrollTop } = node;\r\n\r\n\t\t\t\tscrollPositions.push( [ scrollLeft, scrollTop ] );\r\n\t\t\t} );\r\n\r\n\t\t\tdomEditable.focus();\r\n\r\n\t\t\t// Restore scrollLeft and scrollTop values starting from domEditable up to\r\n\t\t\t// document#documentElement.\r\n\t\t\t// https://github.com/ckeditor/ckeditor5-engine/issues/951\r\n\t\t\t// https://github.com/ckeditor/ckeditor5-engine/issues/957\r\n\t\t\tforEachDomNodeAncestor( domEditable, node => {\r\n\t\t\t\tconst [ scrollLeft, scrollTop ] = scrollPositions.shift();\r\n\r\n\t\t\t\tnode.scrollLeft = scrollLeft;\r\n\t\t\t\tnode.scrollTop = scrollTop;\r\n\t\t\t} );\r\n\r\n\t\t\t// Restore the scrollX and scrollY positions after the focus.\r\n\t\t\t// https://github.com/ckeditor/ckeditor5-engine/issues/951\r\n\t\t\tglobal.window.scrollTo( scrollX, scrollY );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` when `node.nodeType` equals `Node.ELEMENT_NODE`.\r\n\t *\r\n\t * @param {Node} node Node to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisElement( node ) {\r\n\t\treturn node && node.nodeType == Node.ELEMENT_NODE;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` when `node.nodeType` equals `Node.DOCUMENT_FRAGMENT_NODE`.\r\n\t *\r\n\t * @param {Node} node Node to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisDocumentFragment( node ) {\r\n\t\treturn node && node.nodeType == Node.DOCUMENT_FRAGMENT_NODE;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` when `node.nodeType` equals `Node.COMMENT_NODE`.\r\n\t *\r\n\t * @param {Node} node Node to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisComment( node ) {\r\n\t\treturn node && node.nodeType == Node.COMMENT_NODE;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if given selection is a backward selection, that is, if it's `focus` is before `anchor`.\r\n\t *\r\n\t * @param {Selection} DOM Selection instance to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisDomSelectionBackward( selection ) {\r\n\t\tif ( selection.isCollapsed ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Since it takes multiple lines of code to check whether a \"DOM Position\" is before/after another \"DOM Position\",\r\n\t\t// we will use the fact that range will collapse if it's end is before it's start.\r\n\t\tconst range = document.createRange();\r\n\r\n\t\trange.setStart( selection.anchorNode, selection.anchorOffset );\r\n\t\trange.setEnd( selection.focusNode, selection.focusOffset );\r\n\r\n\t\tconst backward = range.collapsed;\r\n\r\n\t\trange.detach();\r\n\r\n\t\treturn backward;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns parent {@link module:engine/view/uielement~UIElement} for provided DOM node. Returns `null` if there is no\r\n\t * parent UIElement.\r\n\t *\r\n\t * @param {Node} domNode\r\n\t * @returns {module:engine/view/uielement~UIElement|null}\r\n\t */\r\n\tgetParentUIElement( domNode ) {\r\n\t\tconst ancestors = getAncestors( domNode );\r\n\r\n\t\t// Remove domNode from the list.\r\n\t\tancestors.pop();\r\n\r\n\t\twhile ( ancestors.length ) {\r\n\t\t\tconst domNode = ancestors.pop();\r\n\t\t\tconst viewNode = this._domToViewMapping.get( domNode );\r\n\r\n\t\t\tif ( viewNode && viewNode.is( 'uiElement' ) ) {\r\n\t\t\t\treturn viewNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if given selection's boundaries are at correct places.\r\n\t *\r\n\t * The following places are considered as incorrect for selection boundaries:\r\n\t * * before or in the middle of the inline filler sequence,\r\n\t * * inside the DOM element which represents {@link module:engine/view/uielement~UIElement a view ui element}.\r\n\t *\r\n\t * @param {Selection} domSelection DOM Selection object to be checked.\r\n\t * @returns {Boolean} `true` if the given selection is at a correct place, `false` otherwise.\r\n\t */\r\n\tisDomSelectionCorrect( domSelection ) {\r\n\t\treturn this._isDomSelectionPositionCorrect( domSelection.anchorNode, domSelection.anchorOffset ) &&\r\n\t\t\tthis._isDomSelectionPositionCorrect( domSelection.focusNode, domSelection.focusOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the given DOM position is a correct place for selection boundary. See {@link #isDomSelectionCorrect}.\r\n\t *\r\n\t * @private\r\n\t * @param {Element} domParent Position parent.\r\n\t * @param {Number} offset Position offset.\r\n\t * @returns {Boolean} `true` if given position is at a correct place for selection boundary, `false` otherwise.\r\n\t */\r\n\t_isDomSelectionPositionCorrect( domParent, offset ) {\r\n\t\t// If selection is before or in the middle of inline filler string, it is incorrect.\r\n\t\tif ( isText( domParent ) && startsWithFiller( domParent ) && offset < INLINE_FILLER_LENGTH ) {\r\n\t\t\t// Selection in a text node, at wrong position (before or in the middle of filler).\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( this.isElement( domParent ) && startsWithFiller( domParent.childNodes[ offset ] ) ) {\r\n\t\t\t// Selection in an element node, before filler text node.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst viewParent = this.mapDomToView( domParent );\r\n\r\n\t\t// If selection is in `view.UIElement`, it is incorrect. Note that `mapDomToView()` returns `view.UIElement`\r\n\t\t// also for any dom element that is inside the view ui element (so we don't need to perform any additional checks).\r\n\t\tif ( viewParent && viewParent.is( 'uiElement' ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Takes text data from a given {@link module:engine/view/text~Text#data} and processes it so\r\n\t * it is correctly displayed in the DOM.\r\n\t *\r\n\t * Following changes are done:\r\n\t *\r\n\t * * a space at the beginning is changed to `&nbsp;` if this is the first text node in its container\r\n\t * element or if a previous text node ends with a space character,\r\n\t * * space at the end of the text node is changed to `&nbsp;` if this is the last text node in its container,\r\n\t * * remaining spaces are replaced to a chain of spaces and `&nbsp;` (e.g. `'x   x'` becomes `'x &nbsp; x'`).\r\n\t *\r\n\t * Content of {@link #preElements} is not processed.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/text~Text} node View text node to process.\r\n\t * @returns {String} Processed text data.\r\n\t */\r\n\t_processDataFromViewText( node ) {\r\n\t\tlet data = node.data;\r\n\r\n\t\t// If any of node ancestors has a name which is in `preElements` array, then currently processed\r\n\t\t// view text node is (will be) in preformatted element. We should not change whitespaces then.\r\n\t\tif ( node.getAncestors().some( parent => this.preElements.includes( parent.name ) ) ) {\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\t// 1. Replace the first space with a nbsp if the previous node ends with a space or there is no previous node\r\n\t\t// (container element boundary).\r\n\t\tif ( data.charAt( 0 ) == ' ' ) {\r\n\t\t\tconst prevNode = this._getTouchingViewTextNode( node, false );\r\n\t\t\tconst prevEndsWithSpace = prevNode && this._nodeEndsWithSpace( prevNode );\r\n\r\n\t\t\tif ( prevEndsWithSpace || !prevNode ) {\r\n\t\t\t\tdata = '\\u00A0' + data.substr( 1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 2. Replace the last space with a nbsp if this is the last text node (container element boundary).\r\n\t\tif ( data.charAt( data.length - 1 ) == ' ' ) {\r\n\t\t\tconst nextNode = this._getTouchingViewTextNode( node, true );\r\n\r\n\t\t\tif ( !nextNode ) {\r\n\t\t\t\tdata = data.substr( 0, data.length - 1 ) + '\\u00A0';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data.replace( / {2}/g, ' \\u00A0' );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given node ends with a space character after changing appropriate space characters to `&nbsp;`s.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/text~Text} node Node to check.\r\n\t * @returns {Boolean} `true` if given `node` ends with space, `false` otherwise.\r\n\t */\r\n\t_nodeEndsWithSpace( node ) {\r\n\t\tif ( node.getAncestors().some( parent => this.preElements.includes( parent.name ) ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst data = this._processDataFromViewText( node );\r\n\r\n\t\treturn data.charAt( data.length - 1 ) == ' ';\r\n\t}\r\n\r\n\t/**\r\n\t * Takes text data from native `Text` node and processes it to a correct {@link module:engine/view/text~Text view text node} data.\r\n\t *\r\n\t * Following changes are done:\r\n\t *\r\n\t * * multiple whitespaces are replaced to a single space,\r\n\t * * space at the beginning of a text node is removed if it is the first text node in its container\r\n\t * element or if the previous text node ends with a space character,\r\n\t * * space at the end of the text node is removed, if it is the last text node in its container.\r\n\t *\r\n\t * @param {Node} node DOM text node to process.\r\n\t * @returns {String} Processed data.\r\n\t * @private\r\n\t */\r\n\t_processDataFromDomText( node ) {\r\n\t\tlet data = node.data;\r\n\r\n\t\tif ( _hasDomParentOfType( node, this.preElements ) ) {\r\n\t\t\treturn getDataWithoutFiller( node );\r\n\t\t}\r\n\r\n\t\t// Change all consecutive whitespace characters (from the [ \\n\\t\\r] set –\r\n\t\t// see https://github.com/ckeditor/ckeditor5-engine/issues/822#issuecomment-311670249) to a single space character.\r\n\t\t// That's how multiple whitespaces are treated when rendered, so we normalize those whitespaces.\r\n\t\t// We're replacing 1+ (and not 2+) to also normalize singular \\n\\t\\r characters (#822).\r\n\t\tdata = data.replace( /[ \\n\\t\\r]{1,}/g, ' ' );\r\n\r\n\t\tconst prevNode = this._getTouchingInlineDomNode( node, false );\r\n\t\tconst nextNode = this._getTouchingInlineDomNode( node, true );\r\n\r\n\t\tconst shouldLeftTrim = this._checkShouldLeftTrimDomText( prevNode );\r\n\t\tconst shouldRightTrim = this._checkShouldRightTrimDomText( node, nextNode );\r\n\r\n\t\t// If the previous dom text node does not exist or it ends by whitespace character, remove space character from the beginning\r\n\t\t// of this text node. Such space character is treated as a whitespace.\r\n\t\tif ( shouldLeftTrim ) {\r\n\t\t\tdata = data.replace( /^ /, '' );\r\n\t\t}\r\n\r\n\t\t// If the next text node does not exist remove space character from the end of this text node.\r\n\t\tif ( shouldRightTrim ) {\r\n\t\t\tdata = data.replace( / $/, '' );\r\n\t\t}\r\n\r\n\t\t// At the beginning and end of a block element, Firefox inserts normal space + <br> instead of non-breaking space.\r\n\t\t// This means that the text node starts/end with normal space instead of non-breaking space.\r\n\t\t// This causes a problem because the normal space would be removed in `.replace` calls above. To prevent that,\r\n\t\t// the inline filler is removed only after the data is initially processed (by the `.replace` above). See ckeditor5#692.\r\n\t\tdata = getDataWithoutFiller( new Text( data ) );\r\n\r\n\t\t// At this point we should have removed all whitespaces from DOM text data.\r\n\r\n\t\t// Now we have to change &nbsp; chars, that were in DOM text data because of rendering reasons, to spaces.\r\n\t\t// First, change all ` \\u00A0` pairs (space + &nbsp;) to two spaces. DOM converter changes two spaces from model/view as\r\n\t\t// ` \\u00A0` to ensure proper rendering. Since here we convert back, we recognize those pairs and change them\r\n\t\t// to `  ` which is what we expect to have in model/view.\r\n\t\tdata = data.replace( / \\u00A0/g, '  ' );\r\n\r\n\t\t// Then, change &nbsp; character that is at the beginning of the text node to space character.\r\n\t\t// As above, that &nbsp; was created for rendering reasons but it's real meaning is just a space character.\r\n\t\t// We do that replacement only if this is the first node or the previous node ends on whitespace character.\r\n\t\tif ( shouldLeftTrim ) {\r\n\t\t\tdata = data.replace( /^\\u00A0/, ' ' );\r\n\t\t}\r\n\r\n\t\t// Since input text data could be: `x_ _`, we would not replace the first &nbsp; after `x` character.\r\n\t\t// We have to fix it. Since we already change all ` &nbsp;`, we will have something like this at the end of text data:\r\n\t\t// `x_ _ _` -> `x_    `. Find &nbsp; at the end of string (can be followed only by spaces).\r\n\t\t// We do that replacement only if this is the last node or the next node starts with &nbsp; or is a <br>.\r\n\t\tif ( isText( nextNode ) ? nextNode.data.charAt( 0 ) == '\\u00A0' : true ) {\r\n\t\t\tdata = data.replace( /\\u00A0( *)$/, ' $1' );\r\n\t\t}\r\n\r\n\t\t// At this point, all whitespaces should be removed and all &nbsp; created for rendering reasons should be\r\n\t\t// changed to normal space. All left &nbsp; are &nbsp; inserted intentionally.\r\n\t\treturn data;\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function which checks if a DOM text node, preceded by the given `prevNode` should\r\n\t * be trimmed from the left side.\r\n\t *\r\n\t * @param {Node} prevNode\r\n\t */\r\n\t_checkShouldLeftTrimDomText( prevNode ) {\r\n\t\tif ( !prevNode ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif ( isElement( prevNode ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn /[^\\S\\u00A0]/.test( prevNode.data.charAt( prevNode.data.length - 1 ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function which checks if a DOM text node, succeeded by the given `nextNode` should\r\n\t * be trimmed from the right side.\r\n\t *\r\n\t * @param {Node} node\r\n\t * @param {Node} prevNode\r\n\t */\r\n\t_checkShouldRightTrimDomText( node, nextNode ) {\r\n\t\tif ( nextNode ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !startsWithFiller( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function. For given {@link module:engine/view/text~Text view text node}, it finds previous or next sibling\r\n\t * that is contained in the same container element. If there is no such sibling, `null` is returned.\r\n\t *\r\n\t * @param {module:engine/view/text~Text} node Reference node.\r\n\t * @param {Boolean} getNext\r\n\t * @returns {module:engine/view/text~Text|null} Touching text node or `null` if there is no next or previous touching text node.\r\n\t */\r\n\t_getTouchingViewTextNode( node, getNext ) {\r\n\t\tconst treeWalker = new ViewTreeWalker( {\r\n\t\t\tstartPosition: getNext ? ViewPosition._createAfter( node ) : ViewPosition._createBefore( node ),\r\n\t\t\tdirection: getNext ? 'forward' : 'backward'\r\n\t\t} );\r\n\r\n\t\tfor ( const value of treeWalker ) {\r\n\t\t\t// ViewContainerElement is found on a way to next ViewText node, so given `node` was first/last\r\n\t\t\t// text node in its container element.\r\n\t\t\tif ( value.item.is( 'containerElement' ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t// <br> found – it works like a block boundary, so do not scan further.\r\n\t\t\telse if ( value.item.is( 'br' ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t// Found a text node in the same container element.\r\n\t\t\telse if ( value.item.is( 'textProxy' ) ) {\r\n\t\t\t\treturn value.item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function. For the given text node, it finds the closest touching node which is either\r\n\t * a text node or a `<br>`. The search is terminated at block element boundaries and if a matching node\r\n\t * wasn't found so far, `null` is returned.\r\n\t *\r\n\t * In the following DOM structure:\r\n\t *\r\n\t *\t\t<p>foo<b>bar</b><br>bom</p>\r\n\t *\r\n\t * * `foo` doesn't have its previous touching inline node (`null` is returned),\r\n\t * * `foo`'s next touching inline node is `bar`\r\n\t * * `bar`'s next touching inline node is `<br>`\r\n\t *\r\n\t * This method returns text nodes and `<br>` elements because these types of nodes affect how\r\n\t * spaces in the given text node need to be converted.\r\n\t *\r\n\t * @private\r\n\t * @param {Text} node\r\n\t * @param {Boolean} getNext\r\n\t * @returns {Text|Element|null}\r\n\t */\r\n\t_getTouchingInlineDomNode( node, getNext ) {\r\n\t\tif ( !node.parentNode ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst direction = getNext ? 'nextNode' : 'previousNode';\r\n\t\tconst document = node.ownerDocument;\r\n\t\tconst topmostParent = getAncestors( node )[ 0 ];\r\n\r\n\t\tconst treeWalker = document.createTreeWalker( topmostParent, NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT, {\r\n\t\t\tacceptNode( node ) {\r\n\t\t\t\tif ( isText( node ) ) {\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( node.tagName == 'BR' ) {\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn NodeFilter.FILTER_SKIP;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\ttreeWalker.currentNode = node;\r\n\r\n\t\tconst touchingNode = treeWalker[ direction ]();\r\n\r\n\t\tif ( touchingNode !== null ) {\r\n\t\t\tconst lca = getCommonAncestor( node, touchingNode );\r\n\r\n\t\t\t// If there is common ancestor between the text node and next/prev text node,\r\n\t\t\t// and there are no block elements on a way from the text node to that ancestor,\r\n\t\t\t// and there are no block elements on a way from next/prev text node to that ancestor...\r\n\t\t\tif (\r\n\t\t\t\tlca &&\r\n\t\t\t\t!_hasDomParentOfType( node, this.blockElements, lca ) &&\r\n\t\t\t\t!_hasDomParentOfType( touchingNode, this.blockElements, lca )\r\n\t\t\t) {\r\n\t\t\t\t// Then they are in the same container element.\r\n\t\t\t\treturn touchingNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n// Helper function.\r\n// Used to check if given native `Element` or `Text` node has parent with tag name from `types` array.\r\n//\r\n// @param {Node} node\r\n// @param {Array.<String>} types\r\n// @param {Boolean} [boundaryParent] Can be given if parents should be checked up to a given element (excluding that element).\r\n// @returns {Boolean} `true` if such parent exists or `false` if it does not.\r\nfunction _hasDomParentOfType( node, types, boundaryParent ) {\r\n\tlet parents = getAncestors( node );\r\n\r\n\tif ( boundaryParent ) {\r\n\t\tparents = parents.slice( parents.indexOf( boundaryParent ) + 1 );\r\n\t}\r\n\r\n\treturn parents.some( parent => parent.tagName && types.includes( parent.tagName.toLowerCase() ) );\r\n}\r\n\r\n// A helper that executes given callback for each DOM node's ancestor, starting from the given node\r\n// and ending in document#documentElement.\r\n//\r\n// @param {Node} node\r\n// @param {Function} callback A callback to be executed for each ancestor.\r\nfunction forEachDomNodeAncestor( node, callback ) {\r\n\twhile ( node && node != global.document ) {\r\n\t\tcallback( node );\r\n\t\tnode = node.parentNode;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/getcommonancestor\r\n */\r\n\r\nimport getAncestors from './getancestors';\r\n\r\n/**\r\n * Searches and returns the lowest common ancestor of two given nodes.\r\n *\r\n * @param {Node} nodeA First node.\r\n * @param {Node} nodeB Second node.\r\n * @returns {Node|DocumentFragment|Document|null} Lowest common ancestor of both nodes or `null` if nodes do not have a common ancestor.\r\n */\r\nexport default function getCommonAncestor( nodeA, nodeB ) {\r\n\tconst ancestorsA = getAncestors( nodeA );\r\n\tconst ancestorsB = getAncestors( nodeB );\r\n\r\n\tlet i = 0;\r\n\r\n\t// It does not matter which array is shorter.\r\n\twhile ( ancestorsA[ i ] == ancestorsB[ i ] && ancestorsA[ i ] ) {\r\n\t\ti++;\r\n\t}\r\n\r\n\treturn i === 0 ? null : ancestorsA[ i - 1 ];\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/iswindow\r\n */\r\n\r\n/**\r\n * Checks if the object is a native DOM Window.\r\n *\r\n * @param {*} obj\r\n * @returns {Boolean}\r\n */\r\nexport default function isWindow( obj ) {\r\n\tconst stringifiedObject = Object.prototype.toString.apply( obj );\r\n\r\n\t// Returns `true` for the `window` object in browser environments.\r\n\tif ( stringifiedObject == '[object Window]' ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Returns `true` for the `window` object in the Electron environment.\r\n\tif ( stringifiedObject == '[object global]' ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/emittermixin\r\n */\r\n\r\nimport { default as EmitterMixin, _getEmitterListenedTo, _setEmitterId } from '../emittermixin';\r\nimport uid from '../uid';\r\nimport isNode from './isnode';\r\nimport isWindow from './iswindow';\r\nimport { extend } from 'lodash-es';\r\n\r\n/**\r\n * Mixin that injects the DOM events API into its host. It provides the API\r\n * compatible with {@link module:utils/emittermixin~EmitterMixin}.\r\n *\r\n * DOM emitter mixin is by default available in the {@link module:ui/view~View} class,\r\n * but it can also be mixed into any other class:\r\n *\r\n *\t\timport mix from '../utils/mix.js';\r\n *\t\timport DomEmitterMixin from '../utils/dom/emittermixin.js';\r\n *\r\n *\t\tclass SomeView {}\r\n *\t\tmix( SomeView, DomEmitterMixin );\r\n *\r\n *\t\tconst view = new SomeView();\r\n *\t\tview.listenTo( domElement, ( evt, domEvt ) => {\r\n *\t\t\tconsole.log( evt, domEvt );\r\n *\t\t} );\r\n *\r\n * @mixin EmitterMixin\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n * @implements module:utils/dom/emittermixin~Emitter\r\n */\r\nconst DomEmitterMixin = extend( {}, EmitterMixin, {\r\n\t/**\r\n\t * Registers a callback function to be executed when an event is fired in a specific Emitter or DOM Node.\r\n\t * It is backwards compatible with {@link module:utils/emittermixin~EmitterMixin#listenTo}.\r\n\t *\r\n\t * @param {module:utils/emittermixin~Emitter|Node} emitter The object that fires the event.\r\n\t * @param {String} event The name of the event.\r\n\t * @param {Function} callback The function to be called on event.\r\n\t * @param {Object} [options={}] Additional options.\r\n\t * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of this event callback. The higher\r\n\t * the priority value the sooner the callback will be fired. Events having the same priority are called in the\r\n\t * order they were added.\r\n\t * @param {Boolean} [options.useCapture=false] Indicates that events of this type will be dispatched to the registered\r\n\t * listener before being dispatched to any EventTarget beneath it in the DOM tree.\r\n\t */\r\n\tlistenTo( emitter, ...rest ) {\r\n\t\t// Check if emitter is an instance of DOM Node. If so, replace the argument with\r\n\t\t// corresponding ProxyEmitter (or create one if not existing).\r\n\t\tif ( isNode( emitter ) || isWindow( emitter ) ) {\r\n\t\t\tconst proxy = this._getProxyEmitter( emitter ) || new ProxyEmitter( emitter );\r\n\r\n\t\t\tproxy.attach( ...rest );\r\n\r\n\t\t\temitter = proxy;\r\n\t\t}\r\n\r\n\t\t// Execute parent class method with Emitter (or ProxyEmitter) instance.\r\n\t\tEmitterMixin.listenTo.call( this, emitter, ...rest );\r\n\t},\r\n\r\n\t/**\r\n\t * Stops listening for events. It can be used at different levels:\r\n\t * It is backwards compatible with {@link module:utils/emittermixin~EmitterMixin#listenTo}.\r\n\t *\r\n\t * * To stop listening to a specific callback.\r\n\t * * To stop listening to a specific event.\r\n\t * * To stop listening to all events fired by a specific object.\r\n\t * * To stop listening to all events fired by all object.\r\n\t *\r\n\t * @param {module:utils/emittermixin~Emitter|Node} [emitter] The object to stop listening to. If omitted, stops it for all objects.\r\n\t * @param {String} [event] (Requires the `emitter`) The name of the event to stop listening to. If omitted, stops it\r\n\t * for all events from `emitter`.\r\n\t * @param {Function} [callback] (Requires the `event`) The function to be removed from the call list for the given\r\n\t * `event`.\r\n\t */\r\n\tstopListening( emitter, event, callback ) {\r\n\t\t// Check if emitter is an instance of DOM Node. If so, replace the argument with corresponding ProxyEmitter.\r\n\t\tif ( isNode( emitter ) || isWindow( emitter ) ) {\r\n\t\t\tconst proxy = this._getProxyEmitter( emitter );\r\n\r\n\t\t\t// Element has no listeners.\r\n\t\t\tif ( !proxy ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\temitter = proxy;\r\n\t\t}\r\n\r\n\t\t// Execute parent class method with Emitter (or ProxyEmitter) instance.\r\n\t\tEmitterMixin.stopListening.call( this, emitter, event, callback );\r\n\r\n\t\tif ( emitter instanceof ProxyEmitter ) {\r\n\t\t\temitter.detach( event );\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Retrieves ProxyEmitter instance for given DOM Node residing in this Host.\r\n\t *\r\n\t * @pivate\r\n\t * @param {Node} node DOM Node of the ProxyEmitter.\r\n\t * @returns {module:utils/dom/emittermixin~ProxyEmitter} ProxyEmitter instance or null.\r\n\t */\r\n\t_getProxyEmitter( node ) {\r\n\t\treturn _getEmitterListenedTo( this, getNodeUID( node ) );\r\n\t}\r\n} );\r\n\r\nexport default DomEmitterMixin;\r\n\r\n/**\r\n * Creates a ProxyEmitter instance. Such an instance is a bridge between a DOM Node firing events\r\n * and any Host listening to them. It is backwards compatible with {@link module:utils/emittermixin~EmitterMixin#on}.\r\n *\r\n *                                  listenTo( click, ... )\r\n *                    +-----------------------------------------+\r\n *                    |              stopListening( ... )       |\r\n *     +----------------------------+                           |             addEventListener( click, ... )\r\n *     | Host                       |                           |   +---------------------------------------------+\r\n *     +----------------------------+                           |   |       removeEventListener( click, ... )     |\r\n *     | _listeningTo: {            |                +----------v-------------+                                   |\r\n *     |   UID: {                   |                | ProxyEmitter           |                                   |\r\n *     |     emitter: ProxyEmitter, |                +------------------------+                      +------------v----------+\r\n *     |     callbacks: {           |                | events: {              |                      | Node (HTMLElement)    |\r\n *     |       click: [ callbacks ] |                |   click: [ callbacks ] |                      +-----------------------+\r\n *     |     }                      |                | },                     |                      | data-ck-expando: UID  |\r\n *     |   }                        |                | _domNode: Node,        |                      +-----------------------+\r\n *     | }                          |                | _domListeners: {},     |                                   |\r\n *     | +------------------------+ |                | _emitterId: UID        |                                   |\r\n *     | | DomEmitterMixin        | |                +--------------^---------+                                   |\r\n *     | +------------------------+ |                           |   |                                             |\r\n *     +--------------^-------------+                           |   +---------------------------------------------+\r\n *                    |                                         |                  click (DOM Event)\r\n *                    +-----------------------------------------+\r\n *                                fire( click, DOM Event )\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n * @implements module:utils/dom/emittermixin~Emitter\r\n * @private\r\n */\r\nclass ProxyEmitter {\r\n\t/**\r\n\t * @param {Node} node DOM Node that fires events.\r\n\t * @returns {Object} ProxyEmitter instance bound to the DOM Node.\r\n\t */\r\n\tconstructor( node ) {\r\n\t\t// Set emitter ID to match DOM Node \"expando\" property.\r\n\t\t_setEmitterId( this, getNodeUID( node ) );\r\n\r\n\t\t// Remember the DOM Node this ProxyEmitter is bound to.\r\n\t\tthis._domNode = node;\r\n\t}\r\n}\r\n\r\nextend( ProxyEmitter.prototype, EmitterMixin, {\r\n\t/**\r\n\t * Collection of native DOM listeners.\r\n\t *\r\n\t * @private\r\n\t * @member {Object} module:utils/dom/emittermixin~ProxyEmitter#_domListeners\r\n\t */\r\n\r\n\t/**\r\n\t * Registers a callback function to be executed when an event is fired.\r\n\t *\r\n\t * It attaches a native DOM listener to the DOM Node. When fired,\r\n\t * a corresponding Emitter event will also fire with DOM Event object as an argument.\r\n\t *\r\n\t * @method module:utils/dom/emittermixin~ProxyEmitter#attach\r\n\t * @param {String} event The name of the event.\r\n\t * @param {Function} callback The function to be called on event.\r\n\t * @param {Object} [options={}] Additional options.\r\n\t * @param {Boolean} [options.useCapture=false] Indicates that events of this type will be dispatched to the registered\r\n\t * listener before being dispatched to any EventTarget beneath it in the DOM tree.\r\n\t */\r\n\tattach( event, callback, options = {} ) {\r\n\t\t// If the DOM Listener for given event already exist it is pointless\r\n\t\t// to attach another one.\r\n\t\tif ( this._domListeners && this._domListeners[ event ] ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domListener = this._createDomListener( event, !!options.useCapture );\r\n\r\n\t\t// Attach the native DOM listener to DOM Node.\r\n\t\tthis._domNode.addEventListener( event, domListener, !!options.useCapture );\r\n\r\n\t\tif ( !this._domListeners ) {\r\n\t\t\tthis._domListeners = {};\r\n\t\t}\r\n\r\n\t\t// Store the native DOM listener in this ProxyEmitter. It will be helpful\r\n\t\t// when stopping listening to the event.\r\n\t\tthis._domListeners[ event ] = domListener;\r\n\t},\r\n\r\n\t/**\r\n\t * Stops executing the callback on the given event.\r\n\t *\r\n\t * @method module:utils/dom/emittermixin~ProxyEmitter#detach\r\n\t * @param {String} event The name of the event.\r\n\t */\r\n\tdetach( event ) {\r\n\t\tlet events;\r\n\r\n\t\t// Remove native DOM listeners which are orphans. If no callbacks\r\n\t\t// are awaiting given event, detach native DOM listener from DOM Node.\r\n\t\t// See: {@link attach}.\r\n\r\n\t\tif ( this._domListeners[ event ] && ( !( events = this._events[ event ] ) || !events.callbacks.length ) ) {\r\n\t\t\tthis._domListeners[ event ].removeListener();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Creates a native DOM listener callback. When the native DOM event\r\n\t * is fired it will fire corresponding event on this ProxyEmitter.\r\n\t * Note: A native DOM Event is passed as an argument.\r\n\t *\r\n\t * @private\r\n\t * @method module:utils/dom/emittermixin~ProxyEmitter#_createDomListener\r\n\t * @param {String} event The name of the event.\r\n\t * @param {Boolean} useCapture Indicates whether the listener was created for capturing event.\r\n\t * @returns {Function} The DOM listener callback.\r\n\t */\r\n\t_createDomListener( event, useCapture ) {\r\n\t\tconst domListener = domEvt => {\r\n\t\t\tthis.fire( event, domEvt );\r\n\t\t};\r\n\r\n\t\t// Supply the DOM listener callback with a function that will help\r\n\t\t// detach it from the DOM Node, when it is no longer necessary.\r\n\t\t// See: {@link detach}.\r\n\t\tdomListener.removeListener = () => {\r\n\t\t\tthis._domNode.removeEventListener( event, domListener, useCapture );\r\n\t\t\tdelete this._domListeners[ event ];\r\n\t\t};\r\n\r\n\t\treturn domListener;\r\n\t}\r\n} );\r\n\r\n// Gets an unique DOM Node identifier. The identifier will be set if not defined.\r\n//\r\n// @private\r\n// @param {Node} node\r\n// @returns {String} UID for given DOM Node.\r\nfunction getNodeUID( node ) {\r\n\treturn node[ 'data-ck-expando' ] || ( node[ 'data-ck-expando' ] = uid() );\r\n}\r\n\r\n/**\r\n * Interface representing classes which mix in {@link module:utils/dom/emittermixin~EmitterMixin}.\r\n *\r\n * @interface Emitter\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/observer\r\n */\r\n\r\nimport DomEmitterMixin from '@ckeditor/ckeditor5-utils/src/dom/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Abstract base observer class. Observers are classes which listen to DOM events, do the preliminary\r\n * processing and fire events on the {@link module:engine/view/document~Document} objects.\r\n * Observers can also add features to the view, for instance by updating its status or marking elements\r\n * which need refresh on DOM events.\r\n *\r\n * @abstract\r\n */\r\nexport default class Observer {\r\n\t/**\r\n\t * Creates an instance of the observer.\r\n\t *\r\n\t * @param {module:engine/view/view~View} view\r\n\t */\r\n\tconstructor( view ) {\r\n\t\t/**\r\n\t\t * Instance of the view controller.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/view~View}\r\n\t\t */\r\n\t\tthis.view = view;\r\n\r\n\t\t/**\r\n\t\t * Reference to the {@link module:engine/view/document~Document} object.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/document~Document}\r\n\t\t */\r\n\t\tthis.document = view.document;\r\n\r\n\t\t/**\r\n\t\t * State of the observer. If it is disabled events will not be fired.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis.isEnabled = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Enables the observer. This method is called when the observer is registered to the\r\n\t * {@link module:engine/view/view~View} and after {@link module:engine/view/view~View#render rendering}\r\n\t * (all observers are {@link #disable disabled} before rendering).\r\n\t *\r\n\t * A typical use case for disabling observers is that mutation observers need to be disabled for the rendering.\r\n\t * However, a child class may not need to be disabled, so it can implement an empty method.\r\n\t *\r\n\t * @see module:engine/view/observer/observer~Observer#disable\r\n\t */\r\n\tenable() {\r\n\t\tthis.isEnabled = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Disables the observer. This method is called before\r\n\t * {@link module:engine/view/view~View#render rendering} to prevent firing events during rendering.\r\n\t *\r\n\t * @see module:engine/view/observer/observer~Observer#enable\r\n\t */\r\n\tdisable() {\r\n\t\tthis.isEnabled = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Disables and destroys the observer, among others removes event listeners created by the observer.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.disable();\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts observing the given root element.\r\n\t *\r\n\t * @method #observe\r\n\t * @param {HTMLElement} domElement\r\n\t * @param {String} name The name of the root element.\r\n\t */\r\n}\r\n\r\nmix( Observer, DomEmitterMixin );\r\n","/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\nexport default setCacheAdd;\n","/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\nexport default setCacheHas;\n","import MapCache from './_MapCache.js';\nimport setCacheAdd from './_setCacheAdd.js';\nimport setCacheHas from './_setCacheHas.js';\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\nexport default SetCache;\n","/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arraySome;\n","/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\nexport default cacheHas;\n","import SetCache from './_SetCache.js';\nimport arraySome from './_arraySome.js';\nimport cacheHas from './_cacheHas.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(array);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!cacheHas(seen, othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {\n              return seen.push(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, bitmask, customizer, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalArrays;\n","/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\nexport default mapToArray;\n","/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nexport default setToArray;\n","import Symbol from './_Symbol.js';\nimport Uint8Array from './_Uint8Array.js';\nimport eq from './eq.js';\nimport equalArrays from './_equalArrays.js';\nimport mapToArray from './_mapToArray.js';\nimport setToArray from './_setToArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= COMPARE_UNORDERED_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\nexport default equalByTag;\n","import getAllKeys from './_getAllKeys.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      objProps = getAllKeys(object),\n      objLength = objProps.length,\n      othProps = getAllKeys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(object);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalObjects;\n","import Stack from './_Stack.js';\nimport equalArrays from './_equalArrays.js';\nimport equalByTag from './_equalByTag.js';\nimport equalObjects from './_equalObjects.js';\nimport getTag from './_getTag.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = objIsArr ? arrayTag : getTag(object),\n      othTag = othIsArr ? arrayTag : getTag(other);\n\n  objTag = objTag == argsTag ? objectTag : objTag;\n  othTag = othTag == argsTag ? objectTag : othTag;\n\n  var objIsObj = objTag == objectTag,\n      othIsObj = othTag == objectTag,\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && isBuffer(object)) {\n    if (!isBuffer(other)) {\n      return false;\n    }\n    objIsArr = true;\n    objIsObj = false;\n  }\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)\n      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);\n  }\n  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);\n}\n\nexport default baseIsEqualDeep;\n","import baseIsEqualDeep from './_baseIsEqualDeep.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Unordered comparison\n *  2 - Partial comparison\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, bitmask, customizer, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);\n}\n\nexport default baseIsEqual;\n","import baseIsEqual from './_baseIsEqual.js';\n\n/**\n * This method is like `_.isEqual` except that it accepts `customizer` which\n * is invoked to compare values. If `customizer` returns `undefined`, comparisons\n * are handled by the method instead. The `customizer` is invoked with up to\n * six arguments: (objValue, othValue [, index|key, object, other, stack]).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * function isGreeting(value) {\n *   return /^h(?:i|ello)$/.test(value);\n * }\n *\n * function customizer(objValue, othValue) {\n *   if (isGreeting(objValue) && isGreeting(othValue)) {\n *     return true;\n *   }\n * }\n *\n * var array = ['hello', 'goodbye'];\n * var other = ['hi', 'goodbye'];\n *\n * _.isEqualWith(array, other, customizer);\n * // => true\n */\nfunction isEqualWith(value, other, customizer) {\n  customizer = typeof customizer == 'function' ? customizer : undefined;\n  var result = customizer ? customizer(value, other) : undefined;\n  return result === undefined ? baseIsEqual(value, other, undefined, customizer) : !!result;\n}\n\nexport default isEqualWith;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/mutationobserver\r\n */\r\n\r\n/* globals window */\r\n\r\nimport Observer from './observer';\r\nimport ViewSelection from '../selection';\r\nimport { startsWithFiller, getDataWithoutFiller } from '../filler';\r\nimport { isEqualWith } from 'lodash-es';\r\n\r\n/**\r\n * Mutation observer class observes changes in the DOM, fires {@link module:engine/view/document~Document#event:mutations} event, mark view\r\n * elements as changed and call {@link module:engine/view/renderer~Renderer#render}.\r\n * Because all mutated nodes are marked as \"to be rendered\" and the\r\n * {@link module:engine/view/renderer~Renderer#render} is called, all changes will be reverted, unless the mutation will be handled by the\r\n * {@link module:engine/view/document~Document#event:mutations} event listener. It means user will see only handled changes, and the editor\r\n * will block all changes which are not handled.\r\n *\r\n * Mutation Observer also take care of reducing number of mutations which are fired. It removes duplicates and\r\n * mutations on elements which do not have corresponding view elements. Also\r\n * {@link module:engine/view/observer/mutationobserver~MutatedText text mutation} is fired only if parent element do not change child list.\r\n *\r\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\r\n *\r\n * @extends module:engine/view/observer/observer~Observer\r\n */\r\nexport default class MutationObserver extends Observer {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\t/**\r\n\t\t * Native mutation observer config.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis._config = {\r\n\t\t\tchildList: true,\r\n\t\t\tcharacterData: true,\r\n\t\t\tcharacterDataOldValue: true,\r\n\t\t\tsubtree: true\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Reference to the {@link module:engine/view/view~View#domConverter}.\r\n\t\t *\r\n\t\t * @member {module:engine/view/domconverter~DomConverter}\r\n\t\t */\r\n\t\tthis.domConverter = view.domConverter;\r\n\r\n\t\t/**\r\n\t\t * Reference to the {@link module:engine/view/view~View#renderer}.\r\n\t\t *\r\n\t\t * @member {module:engine/view/renderer~Renderer}\r\n\t\t */\r\n\t\tthis.renderer = view._renderer;\r\n\r\n\t\t/**\r\n\t\t * Observed DOM elements.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Array.<HTMLElement>}\r\n\t\t */\r\n\t\tthis._domElements = [];\r\n\r\n\t\t/**\r\n\t\t * Native mutation observer.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {MutationObserver}\r\n\t\t */\r\n\t\tthis._mutationObserver = new window.MutationObserver( this._onMutations.bind( this ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Synchronously fires {@link module:engine/view/document~Document#event:mutations} event with all mutations in record queue.\r\n\t * At the same time empties the queue so mutations will not be fired twice.\r\n\t */\r\n\tflush() {\r\n\t\tthis._onMutations( this._mutationObserver.takeRecords() );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve( domElement ) {\r\n\t\tthis._domElements.push( domElement );\r\n\r\n\t\tif ( this.isEnabled ) {\r\n\t\t\tthis._mutationObserver.observe( domElement, this._config );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tenable() {\r\n\t\tsuper.enable();\r\n\r\n\t\tfor ( const domElement of this._domElements ) {\r\n\t\t\tthis._mutationObserver.observe( domElement, this._config );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdisable() {\r\n\t\tsuper.disable();\r\n\r\n\t\tthis._mutationObserver.disconnect();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tthis._mutationObserver.disconnect();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles mutations. Deduplicates, mark view elements to sync, fire event and call render.\r\n\t *\r\n\t * @private\r\n\t * @param {Array.<Object>} domMutations Array of native mutations.\r\n\t */\r\n\t_onMutations( domMutations ) {\r\n\t\t// As a result of this.flush() we can have an empty collection.\r\n\t\tif ( domMutations.length === 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domConverter = this.domConverter;\r\n\r\n\t\t// Use map and set for deduplication.\r\n\t\tconst mutatedTexts = new Map();\r\n\t\tconst mutatedElements = new Set();\r\n\r\n\t\t// Handle `childList` mutations first, so we will be able to check if the `characterData` mutation is in the\r\n\t\t// element with changed structure anyway.\r\n\t\tfor ( const mutation of domMutations ) {\r\n\t\t\tif ( mutation.type === 'childList' ) {\r\n\t\t\t\tconst element = domConverter.mapDomToView( mutation.target );\r\n\r\n\t\t\t\t// Do not collect mutations from UIElements.\r\n\t\t\t\tif ( element && element.is( 'uiElement' ) ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( element && !this._isBogusBrMutation( mutation ) ) {\r\n\t\t\t\t\tmutatedElements.add( element );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Handle `characterData` mutations later, when we have the full list of nodes which changed structure.\r\n\t\tfor ( const mutation of domMutations ) {\r\n\t\t\tconst element = domConverter.mapDomToView( mutation.target );\r\n\r\n\t\t\t// Do not collect mutations from UIElements.\r\n\t\t\tif ( element && element.is( 'uiElement' ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif ( mutation.type === 'characterData' ) {\r\n\t\t\t\tconst text = domConverter.findCorrespondingViewText( mutation.target );\r\n\r\n\t\t\t\tif ( text && !mutatedElements.has( text.parent ) ) {\r\n\t\t\t\t\t// Use text as a key, for deduplication. If there will be another mutation on the same text element\r\n\t\t\t\t\t// we will have only one in the map.\r\n\t\t\t\t\tmutatedTexts.set( text, {\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\toldText: text.data,\r\n\t\t\t\t\t\tnewText: getDataWithoutFiller( mutation.target ),\r\n\t\t\t\t\t\tnode: text\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\t// When we added first letter to the text node which had only inline filler, for the DOM it is mutation\r\n\t\t\t\t// on text, but for the view, where filler text node did not existed, new text node was created, so we\r\n\t\t\t\t// need to fire 'children' mutation instead of 'text'.\r\n\t\t\t\telse if ( !text && startsWithFiller( mutation.target ) ) {\r\n\t\t\t\t\tmutatedElements.add( domConverter.mapDomToView( mutation.target.parentNode ) );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Now we build the list of mutations to fire and mark elements. We did not do it earlier to avoid marking the\r\n\t\t// same node multiple times in case of duplication.\r\n\r\n\t\t// List of mutations we will fire.\r\n\t\tconst viewMutations = [];\r\n\r\n\t\tfor ( const mutatedText of mutatedTexts.values() ) {\r\n\t\t\tthis.renderer.markToSync( 'text', mutatedText.node );\r\n\t\t\tviewMutations.push( mutatedText );\r\n\t\t}\r\n\r\n\t\tfor ( const viewElement of mutatedElements ) {\r\n\t\t\tconst domElement = domConverter.mapViewToDom( viewElement );\r\n\t\t\tconst viewChildren = Array.from( viewElement.getChildren() );\r\n\t\t\tconst newViewChildren = Array.from( domConverter.domChildrenToView( domElement, { withChildren: false } ) );\r\n\r\n\t\t\t// It may happen that as a result of many changes (sth was inserted and then removed),\r\n\t\t\t// both elements haven't really changed. #1031\r\n\t\t\tif ( !isEqualWith( viewChildren, newViewChildren, sameNodes ) ) {\r\n\t\t\t\tthis.renderer.markToSync( 'children', viewElement );\r\n\r\n\t\t\t\tviewMutations.push( {\r\n\t\t\t\t\ttype: 'children',\r\n\t\t\t\t\toldChildren: viewChildren,\r\n\t\t\t\t\tnewChildren: newViewChildren,\r\n\t\t\t\t\tnode: viewElement\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Retrieve `domSelection` using `ownerDocument` of one of mutated nodes.\r\n\t\t// There should not be simultaneous mutation in multiple documents, so it's fine.\r\n\t\tconst domSelection = domMutations[ 0 ].target.ownerDocument.getSelection();\r\n\r\n\t\tlet viewSelection = null;\r\n\r\n\t\tif ( domSelection && domSelection.anchorNode ) {\r\n\t\t\t// If `domSelection` is inside a dom node that is already bound to a view node from view tree, get\r\n\t\t\t// corresponding selection in the view and pass it together with `viewMutations`. The `viewSelection` may\r\n\t\t\t// be used by features handling mutations.\r\n\t\t\t// Only one range is supported.\r\n\r\n\t\t\tconst viewSelectionAnchor = domConverter.domPositionToView( domSelection.anchorNode, domSelection.anchorOffset );\r\n\t\t\tconst viewSelectionFocus = domConverter.domPositionToView( domSelection.focusNode, domSelection.focusOffset );\r\n\r\n\t\t\t// Anchor and focus has to be properly mapped to view.\r\n\t\t\tif ( viewSelectionAnchor && viewSelectionFocus ) {\r\n\t\t\t\tviewSelection = new ViewSelection( viewSelectionAnchor );\r\n\t\t\t\tviewSelection.setFocus( viewSelectionFocus );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.document.fire( 'mutations', viewMutations, viewSelection );\r\n\r\n\t\t// If nothing changes on `mutations` event, at this point we have \"dirty DOM\" (changed) and de-synched\r\n\t\t// view (which has not been changed). In order to \"reset DOM\" we render the view again.\r\n\t\tthis.view.render();\r\n\r\n\t\tfunction sameNodes( child1, child2 ) {\r\n\t\t\t// First level of comparison (array of children vs array of children) – use the Lodash's default behavior.\r\n\t\t\tif ( Array.isArray( child1 ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Elements.\r\n\t\t\tif ( child1 === child2 ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t// Texts.\r\n\t\t\telse if ( child1.is( 'text' ) && child2.is( 'text' ) ) {\r\n\t\t\t\treturn child1.data === child2.data;\r\n\t\t\t}\r\n\r\n\t\t\t// Not matching types.\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if mutation was generated by the browser inserting bogus br on the end of the block element.\r\n\t * Such mutations are generated while pressing space or performing native spellchecker correction\r\n\t * on the end of the block element in Firefox browser.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} mutation Native mutation object.\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_isBogusBrMutation( mutation ) {\r\n\t\tlet addedNode = null;\r\n\r\n\t\t// Check if mutation added only one node on the end of its parent.\r\n\t\tif ( mutation.nextSibling === null && mutation.removedNodes.length === 0 && mutation.addedNodes.length == 1 ) {\r\n\t\t\taddedNode = this.domConverter.domToView( mutation.addedNodes[ 0 ], {\r\n\t\t\t\twithChildren: false\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn addedNode && addedNode.is( 'element', 'br' );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when mutation occurred. If tree view is not changed on this event, DOM will be reverted to the state before\r\n * mutation, so all changes which should be applied, should be handled on this event.\r\n *\r\n * Introduced by {@link module:engine/view/observer/mutationobserver~MutationObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/mutationobserver~MutationObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/mutationobserver~MutationObserver\r\n * @event module:engine/view/document~Document#event:mutations\r\n * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|module:engine/view/observer/mutationobserver~MutatedChildren>}\r\n * viewMutations Array of mutations.\r\n * For mutated texts it will be {@link module:engine/view/observer/mutationobserver~MutatedText} and for mutated elements it will be\r\n * {@link module:engine/view/observer/mutationobserver~MutatedChildren}. You can recognize the type based on the `type` property.\r\n * @param {module:engine/view/selection~Selection|null} viewSelection View selection that is a result of converting DOM selection to view.\r\n * Keep in\r\n * mind that the DOM selection is already \"updated\", meaning that it already acknowledges changes done in mutation.\r\n */\r\n\r\n/**\r\n * Mutation item for text.\r\n *\r\n * @see module:engine/view/document~Document#event:mutations\r\n * @see module:engine/view/observer/mutationobserver~MutatedChildren\r\n *\r\n * @typedef {Object} module:engine/view/observer/mutationobserver~MutatedText\r\n *\r\n * @property {String} type For text mutations it is always 'text'.\r\n * @property {module:engine/view/text~Text} node Mutated text node.\r\n * @property {String} oldText Old text.\r\n * @property {String} newText New text.\r\n */\r\n\r\n/**\r\n * Mutation item for child nodes.\r\n *\r\n * @see module:engine/view/document~Document#event:mutations\r\n * @see module:engine/view/observer/mutationobserver~MutatedText\r\n *\r\n * @typedef {Object} module:engine/view/observer/mutationobserver~MutatedChildren\r\n *\r\n * @property {String} type For child nodes mutations it is always 'children'.\r\n * @property {module:engine/view/element~Element} node Parent of the mutated children.\r\n * @property {Array.<module:engine/view/node~Node>} oldChildren Old child nodes.\r\n * @property {Array.<module:engine/view/node~Node>} newChildren New child nodes.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/domeventdata\r\n */\r\n\r\nimport { extend } from 'lodash-es';\r\n\r\n/**\r\n * Information about a DOM event in context of the {@link module:engine/view/document~Document}.\r\n * It wraps the native event, which usually should not be used as the wrapper contains\r\n * additional data (like key code for keyboard events).\r\n */\r\nexport default class DomEventData {\r\n\t/**\r\n\t * @param {module:engine/view/view~View} view The instance of the view controller.\r\n\t * @param {Event} domEvent The DOM event.\r\n\t * @param {Object} [additionalData] Additional properties that the instance should contain.\r\n\t */\r\n\tconstructor( view, domEvent, additionalData ) {\r\n\t\t/**\r\n\t\t * Instance of the view controller.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/view~View} module:engine/view/observer/observer~Observer.DomEvent#view\r\n\t\t */\r\n\t\tthis.view = view;\r\n\r\n\t\t/**\r\n\t\t * The instance of the document.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/document~Document} module:engine/view/observer/observer~Observer.DomEvent#document\r\n\t\t */\r\n\t\tthis.document = view.document;\r\n\r\n\t\t/**\r\n\t\t * The DOM event.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Event} module:engine/view/observer/observer~Observer.DomEvent#domEvent\r\n\t\t */\r\n\t\tthis.domEvent = domEvent;\r\n\r\n\t\t/**\r\n\t\t * The DOM target.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {HTMLElement} module:engine/view/observer/observer~Observer.DomEvent#target\r\n\t\t */\r\n\t\tthis.domTarget = domEvent.target;\r\n\r\n\t\textend( this, additionalData );\r\n\t}\r\n\r\n\t/**\r\n\t * The tree view element representing the target.\r\n\t *\r\n\t * @readonly\r\n\t * @type module:engine/view/element~Element\r\n\t */\r\n\tget target() {\r\n\t\treturn this.view.domConverter.mapDomToView( this.domTarget );\r\n\t}\r\n\r\n\t/**\r\n\t * Prevents the native's event default action.\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.domEvent.preventDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * Stops native event propagation.\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.domEvent.stopPropagation();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/domeventobserver\r\n */\r\n\r\nimport Observer from './observer';\r\nimport DomEventData from './domeventdata';\r\n\r\n/**\r\n * Base class for DOM event observers. This class handles\r\n * {@link module:engine/view/observer/observer~Observer#observe adding} listeners to DOM elements,\r\n * {@link module:engine/view/observer/observer~Observer#disable disabling} and\r\n * {@link module:engine/view/observer/observer~Observer#enable re-enabling} events.\r\n * Child class needs to define\r\n * {@link module:engine/view/observer/domeventobserver~DomEventObserver#domEventType DOM event type} and\r\n * {@link module:engine/view/observer/domeventobserver~DomEventObserver#onDomEvent callback}.\r\n *\r\n * For instance:\r\n *\r\n *\t\tclass ClickObserver extends DomEventObserver {\r\n *\t\t\t// It can also be defined as a normal property in the constructor.\r\n *\t\t\tget domEventType() {\r\n *\t\t\t\treturn 'click';\r\n *\t\t\t}\r\n *\r\n *\t\t\tonDomEvent( domEvent ) {\r\n *\t\t\t\tthis.fire( 'click', domEvent );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n * @extends module:engine/view/observer/observer~Observer\r\n */\r\nexport default class DomEventObserver extends Observer {\r\n\t/**\r\n\t * Type of the DOM event the observer should listen on. Array of types can be defined\r\n\t * if the obsever should listen to multiple DOM events.\r\n\t *\r\n\t * @readonly\r\n\t * @member {String|Array.<String>} #domEventType\r\n\t */\r\n\r\n\t/**\r\n\t * Callback which should be called when the DOM event occurred. Note that the callback will not be called if\r\n\t * observer {@link #isEnabled is not enabled}.\r\n\t *\r\n\t * @see #domEventType\r\n\t * @abstract\r\n\t * @method #onDomEvent\r\n\t */\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\t/**\r\n\t\t * If set to `true` DOM events will be listened on the capturing phase.\r\n\t\t * Default value is `false`.\r\n\t\t *\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis.useCapture = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve( domElement ) {\r\n\t\tconst types = typeof this.domEventType == 'string' ? [ this.domEventType ] : this.domEventType;\r\n\r\n\t\ttypes.forEach( type => {\r\n\t\t\tthis.listenTo( domElement, type, ( eventInfo, domEvent ) => {\r\n\t\t\t\tif ( this.isEnabled ) {\r\n\t\t\t\t\tthis.onDomEvent( domEvent );\r\n\t\t\t\t}\r\n\t\t\t}, { useCapture: this.useCapture } );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Calls `Document#fire()` if observer {@link #isEnabled is enabled}.\r\n\t *\r\n\t * @see module:utils/emittermixin~EmitterMixin#fire\r\n\t * @param {String} eventType The event type (name).\r\n\t * @param {Event} domEvent The DOM event.\r\n\t * @param {Object} [additionalData] The additional data which should extend the\r\n\t * {@link module:engine/view/observer/domeventdata~DomEventData event data} object.\r\n\t */\r\n\tfire( eventType, domEvent, additionalData ) {\r\n\t\tif ( this.isEnabled ) {\r\n\t\t\tthis.document.fire( eventType, new DomEventData( this.view, domEvent, additionalData ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/keyobserver\r\n */\r\n\r\nimport DomEventObserver from './domeventobserver';\r\nimport { getCode } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\n/**\r\n * {@link module:engine/view/document~Document#event:keydown Key down} event observer.\r\n *\r\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class KeyObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tthis.domEventType = [ 'keydown', 'keyup' ];\r\n\t}\r\n\r\n\tonDomEvent( domEvt ) {\r\n\t\tthis.fire( domEvt.type, domEvt, {\r\n\t\t\tkeyCode: domEvt.keyCode,\r\n\r\n\t\t\taltKey: domEvt.altKey,\r\n\t\t\tctrlKey: domEvt.ctrlKey || domEvt.metaKey,\r\n\t\t\tshiftKey: domEvt.shiftKey,\r\n\r\n\t\t\tget keystroke() {\r\n\t\t\t\treturn getCode( this );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when a key has been pressed.\r\n *\r\n * Introduced by {@link module:engine/view/observer/keyobserver~KeyObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/keyobserver~KeyObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/keyobserver~KeyObserver\r\n * @event module:engine/view/document~Document#event:keydown\r\n * @param {module:engine/view/observer/keyobserver~KeyEventData} keyEventData\r\n */\r\n\r\n/**\r\n * Fired when a key has been released.\r\n *\r\n * Introduced by {@link module:engine/view/observer/keyobserver~KeyObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/keyobserver~KeyObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/keyobserver~KeyObserver\r\n * @event module:engine/view/document~Document#event:keyup\r\n * @param {module:engine/view/observer/keyobserver~KeyEventData} keyEventData\r\n */\r\n\r\n/**\r\n * The value of both events - {@link module:engine/view/document~Document#event:keydown} and\r\n * {@link module:engine/view/document~Document#event:keyup}.\r\n *\r\n * @class module:engine/view/observer/keyobserver~KeyEventData\r\n * @extends module:engine/view/observer/domeventdata~DomEventData\r\n * @implements module:utils/keyboard~KeystrokeInfo\r\n */\r\n\r\n/**\r\n * Code of the whole keystroke. See {@link module:utils/keyboard~getCode}.\r\n *\r\n * @readonly\r\n * @member {Number} module:engine/view/observer/keyobserver~KeyEventData#keystroke\r\n */\r\n","import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/fakeselectionobserver\r\n */\r\n\r\nimport Observer from './observer';\r\nimport ViewSelection from '../selection';\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\nimport { debounce } from 'lodash-es';\r\n\r\n/**\r\n * Fake selection observer class. If view selection is fake it is placed in dummy DOM container. This observer listens\r\n * on {@link module:engine/view/document~Document#event:keydown keydown} events and handles moving fake view selection to the correct place\r\n * if arrow keys are pressed.\r\n * Fires {@link module:engine/view/document~Document#event:selectionChange selectionChange event} simulating natural behaviour of\r\n * {@link module:engine/view/observer/selectionobserver~SelectionObserver SelectionObserver}.\r\n *\r\n * @extends module:engine/view/observer/observer~Observer.Observer\r\n */\r\nexport default class FakeSelectionObserver extends Observer {\r\n\t/**\r\n\t * Creates new FakeSelectionObserver instance.\r\n\t *\r\n\t * @param {module:engine/view/view~View} view\r\n\t */\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\t/**\r\n\t\t * Fires debounced event `selectionChangeDone`. It uses `lodash#debounce` method to delay function call.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Object} data Selection change data.\r\n\t\t * @method #_fireSelectionChangeDoneDebounced\r\n\t\t */\r\n\t\tthis._fireSelectionChangeDoneDebounced = debounce( data => this.document.fire( 'selectionChangeDone', data ), 200 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve() {\r\n\t\tconst document = this.document;\r\n\r\n\t\tdocument.on( 'keydown', ( eventInfo, data ) => {\r\n\t\t\tconst selection = document.selection;\r\n\r\n\t\t\tif ( selection.isFake && _isArrowKeyCode( data.keyCode ) && this.isEnabled ) {\r\n\t\t\t\t// Prevents default key down handling - no selection change will occur.\r\n\t\t\t\tdata.preventDefault();\r\n\r\n\t\t\t\tthis._handleSelectionMove( data.keyCode );\r\n\t\t\t}\r\n\t\t}, { priority: 'lowest' } );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tthis._fireSelectionChangeDoneDebounced.cancel();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles collapsing view selection according to given key code. If left or up key is provided - new selection will be\r\n\t * collapsed to left. If right or down key is pressed - new selection will be collapsed to right.\r\n\t *\r\n\t * This method fires {@link module:engine/view/document~Document#event:selectionChange} and\r\n\t * {@link module:engine/view/document~Document#event:selectionChangeDone} events imitating behaviour of\r\n\t * {@link module:engine/view/observer/selectionobserver~SelectionObserver}.\r\n\t *\r\n\t * @private\r\n\t * @param {Number} keyCode\r\n\t * @fires module:engine/view/document~Document#event:selectionChange\r\n\t * @fires module:engine/view/document~Document#event:selectionChangeDone\r\n\t */\r\n\t_handleSelectionMove( keyCode ) {\r\n\t\tconst selection = this.document.selection;\r\n\t\tconst newSelection = new ViewSelection( selection.getRanges(), { backward: selection.isBackward, fake: false } );\r\n\r\n\t\t// Left or up arrow pressed - move selection to start.\r\n\t\tif ( keyCode == keyCodes.arrowleft || keyCode == keyCodes.arrowup ) {\r\n\t\t\tnewSelection.setTo( newSelection.getFirstPosition() );\r\n\t\t}\r\n\r\n\t\t// Right or down arrow pressed - move selection to end.\r\n\t\tif ( keyCode == keyCodes.arrowright || keyCode == keyCodes.arrowdown ) {\r\n\t\t\tnewSelection.setTo( newSelection.getLastPosition() );\r\n\t\t}\r\n\r\n\t\tconst data = {\r\n\t\t\toldSelection: selection,\r\n\t\t\tnewSelection,\r\n\t\t\tdomSelection: null\r\n\t\t};\r\n\r\n\t\t// Fire dummy selection change event.\r\n\t\tthis.document.fire( 'selectionChange', data );\r\n\r\n\t\t// Call` #_fireSelectionChangeDoneDebounced` every time when `selectionChange` event is fired.\r\n\t\t// This function is debounced what means that `selectionChangeDone` event will be fired only when\r\n\t\t// defined int the function time will elapse since the last time the function was called.\r\n\t\t// So `selectionChangeDone` will be fired when selection will stop changing.\r\n\t\tthis._fireSelectionChangeDoneDebounced( data );\r\n\t}\r\n}\r\n\r\n// Checks if one of the arrow keys is pressed.\r\n//\r\n// @private\r\n// @param {Number} keyCode\r\n// @returns {Boolean}\r\nfunction _isArrowKeyCode( keyCode ) {\r\n\treturn keyCode == keyCodes.arrowright ||\r\n\t\tkeyCode == keyCodes.arrowleft ||\r\n\t\tkeyCode == keyCodes.arrowup ||\r\n\t\tkeyCode == keyCodes.arrowdown;\r\n}\r\n\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/selectionobserver\r\n */\r\n\r\n/* global setInterval, clearInterval */\r\n\r\nimport Observer from './observer';\r\nimport MutationObserver from './mutationobserver';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport { debounce } from 'lodash-es';\r\n\r\n/**\r\n * Selection observer class observes selection changes in the document. If selection changes on the document this\r\n * observer checks if there are any mutations and if DOM selection is different than the\r\n * {@link module:engine/view/document~Document#selection view selection}. Selection observer fires\r\n * {@link module:engine/view/document~Document#event:selectionChange} event only if selection change was the only change in the document\r\n * and DOM selection is different then the view selection.\r\n *\r\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\r\n *\r\n * @see module:engine/view/observer/mutationobserver~MutationObserver\r\n * @extends module:engine/view/observer/observer~Observer\r\n */\r\nexport default class SelectionObserver extends Observer {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\t/**\r\n\t\t * Instance of the mutation observer. Selection observer calls\r\n\t\t * {@link module:engine/view/observer/mutationobserver~MutationObserver#flush} to ensure that the mutations will be handled\r\n\t\t * before the {@link module:engine/view/document~Document#event:selectionChange} event is fired.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/observer/mutationobserver~MutationObserver}\r\n\t\t * module:engine/view/observer/selectionobserver~SelectionObserver#mutationObserver\r\n\t\t */\r\n\t\tthis.mutationObserver = view.getObserver( MutationObserver );\r\n\r\n\t\t/**\r\n\t\t * Reference to the view {@link module:engine/view/documentselection~DocumentSelection} object used to compare\r\n\t\t * new selection with it.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/documentselection~DocumentSelection}\r\n\t\t * module:engine/view/observer/selectionobserver~SelectionObserver#selection\r\n\t\t */\r\n\t\tthis.selection = this.document.selection;\r\n\r\n\t\t/* eslint-disable max-len */\r\n\t\t/**\r\n\t\t * Reference to the {@link module:engine/view/view~View#domConverter}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/domconverter~DomConverter} module:engine/view/observer/selectionobserver~SelectionObserver#domConverter\r\n\t\t */\r\n\t\t/* eslint-enable max-len */\r\n\t\tthis.domConverter = view.domConverter;\r\n\r\n\t\t/**\r\n\t\t * Set of documents which have added \"selectionchange\" listener to avoid adding listener twice to the same\r\n\t\t * document.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakSet.<Document>} module:engine/view/observer/selectionobserver~SelectionObserver#_documents\r\n\t\t */\r\n\t\tthis._documents = new WeakSet();\r\n\r\n\t\t/**\r\n\t\t * Fires debounced event `selectionChangeDone`. It uses `lodash#debounce` method to delay function call.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @param {Object} data Selection change data.\r\n\t\t * @method #_fireSelectionChangeDoneDebounced\r\n\t\t */\r\n\t\tthis._fireSelectionChangeDoneDebounced = debounce( data => this.document.fire( 'selectionChangeDone', data ), 200 );\r\n\r\n\t\tthis._clearInfiniteLoopInterval = setInterval( () => this._clearInfiniteLoop(), 1000 );\r\n\r\n\t\t/**\r\n\t\t * Private property to check if the code does not enter infinite loop.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Number} module:engine/view/observer/selectionobserver~SelectionObserver#_loopbackCounter\r\n\t\t */\r\n\t\tthis._loopbackCounter = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve( domElement ) {\r\n\t\tconst domDocument = domElement.ownerDocument;\r\n\r\n\t\t// Add listener once per each document.\r\n\t\tif ( this._documents.has( domDocument ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.listenTo( domDocument, 'selectionchange', () => {\r\n\t\t\tthis._handleSelectionChange( domDocument );\r\n\t\t} );\r\n\r\n\t\tthis._documents.add( domDocument );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tclearInterval( this._clearInfiniteLoopInterval );\r\n\t\tthis._fireSelectionChangeDoneDebounced.cancel();\r\n\t}\r\n\r\n\t/**\r\n\t * Selection change listener. {@link module:engine/view/observer/mutationobserver~MutationObserver#flush Flush} mutations, check if\r\n\t * selection changes and fires {@link module:engine/view/document~Document#event:selectionChange} event on every change\r\n\t * and {@link module:engine/view/document~Document#event:selectionChangeDone} when selection stop changing.\r\n\t *\r\n\t * @private\r\n\t * @param {Document} domDocument DOM document.\r\n\t */\r\n\t_handleSelectionChange( domDocument ) {\r\n\t\t// Selection is handled when document is not focused but is read-only. This is because in read-only\r\n\t\t// mode contenteditable is set as false and editor won't receive focus but we still need to know\r\n\t\t// selection position.\r\n\t\tif ( !this.isEnabled || ( !this.document.isFocused && !this.document.isReadOnly ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Ensure the mutation event will be before selection event on all browsers.\r\n\t\tthis.mutationObserver.flush();\r\n\r\n\t\t// If there were mutations then the view will be re-rendered by the mutation observer and selection\r\n\t\t// will be updated, so selections will equal and event will not be fired, as expected.\r\n\t\tconst domSelection = domDocument.defaultView.getSelection();\r\n\t\tconst newViewSelection = this.domConverter.domSelectionToView( domSelection );\r\n\r\n\t\tif ( this.selection.isEqual( newViewSelection ) && this.domConverter.isDomSelectionCorrect( domSelection ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Ensure we are not in the infinite loop (#400).\r\n\t\t// This counter is reset each second. 60 selection changes in 1 second is enough high number\r\n\t\t// to be very difficult (impossible) to achieve using just keyboard keys (during normal editor use).\r\n\t\tif ( ++this._loopbackCounter > 60 ) {\r\n\t\t\t/**\r\n\t\t\t * Selection change observer detected an infinite rendering loop.\r\n\t\t\t * Most probably you try to put the selection in the position which is not allowed\r\n\t\t\t * by the browser and browser fixes it automatically what causes `selectionchange` event on\r\n\t\t\t * which a loopback through a model tries to re-render the wrong selection and again.\r\n\t\t\t *\r\n\t\t\t * @error selectionchange-infinite-loop\r\n\t\t\t */\r\n\t\t\tlog.warn( 'selectionchange-infinite-loop: Selection change observer detected an infinite rendering loop.' );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( this.selection.isSimilar( newViewSelection ) ) {\r\n\t\t\t// If selection was equal and we are at this point of algorithm, it means that it was incorrect.\r\n\t\t\t// Just re-render it, no need to fire any events, etc.\r\n\t\t\tthis.view.render();\r\n\t\t} else {\r\n\t\t\tconst data = {\r\n\t\t\t\toldSelection: this.selection,\r\n\t\t\t\tnewSelection: newViewSelection,\r\n\t\t\t\tdomSelection\r\n\t\t\t};\r\n\r\n\t\t\t// Prepare data for new selection and fire appropriate events.\r\n\t\t\tthis.document.fire( 'selectionChange', data );\r\n\r\n\t\t\t// Call` #_fireSelectionChangeDoneDebounced` every time when `selectionChange` event is fired.\r\n\t\t\t// This function is debounced what means that `selectionChangeDone` event will be fired only when\r\n\t\t\t// defined int the function time will elapse since the last time the function was called.\r\n\t\t\t// So `selectionChangeDone` will be fired when selection will stop changing.\r\n\t\t\tthis._fireSelectionChangeDoneDebounced( data );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clears `SelectionObserver` internal properties connected with preventing infinite loop.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_clearInfiniteLoop() {\r\n\t\tthis._loopbackCounter = 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when selection has changed. This event is fired only when the selection change was the only change that happened\r\n * in the document, and old selection is different then the new selection.\r\n *\r\n * Introduced by {@link module:engine/view/observer/selectionobserver~SelectionObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/selectionobserver~SelectionObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/selectionobserver~SelectionObserver\r\n * @event module:engine/view/document~Document#event:selectionChange\r\n * @param {Object} data\r\n * @param {module:engine/view/documentselection~DocumentSelection} data.oldSelection Old View selection which is\r\n * {@link module:engine/view/document~Document#selection}.\r\n * @param {module:engine/view/selection~Selection} data.newSelection New View selection which is converted DOM selection.\r\n * @param {Selection} data.domSelection Native DOM selection.\r\n */\r\n\r\n/**\r\n * Fired when selection stops changing.\r\n *\r\n * Introduced by {@link module:engine/view/observer/selectionobserver~SelectionObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/selectionobserver~SelectionObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/selectionobserver~SelectionObserver\r\n * @event module:engine/view/document~Document#event:selectionChangeDone\r\n * @param {Object} data\r\n * @param {module:engine/view/documentselection~DocumentSelection} data.oldSelection Old View selection which is\r\n * {@link module:engine/view/document~Document#selection}.\r\n * @param {module:engine/view/selection~Selection} data.newSelection New View selection which is converted DOM selection.\r\n * @param {Selection} data.domSelection Native DOM selection.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/focusobserver\r\n */\r\n\r\n/* globals setTimeout, clearTimeout */\r\n\r\nimport DomEventObserver from './domeventobserver';\r\n\r\n/**\r\n * {@link module:engine/view/document~Document#event:focus Focus}\r\n * and {@link module:engine/view/document~Document#event:blur blur} events observer.\r\n * Focus observer handle also {@link module:engine/view/rooteditableelement~RootEditableElement#isFocused isFocused} property of the\r\n * {@link module:engine/view/rooteditableelement~RootEditableElement root elements}.\r\n *\r\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class FocusObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tthis.domEventType = [ 'focus', 'blur' ];\r\n\t\tthis.useCapture = true;\r\n\t\tconst document = this.document;\r\n\r\n\t\tdocument.on( 'focus', () => {\r\n\t\t\tdocument.isFocused = true;\r\n\r\n\t\t\t// Unfortunately native `selectionchange` event is fired asynchronously.\r\n\t\t\t// We need to wait until `SelectionObserver` handle the event and then render. Otherwise rendering will\r\n\t\t\t// overwrite new DOM selection with selection from the view.\r\n\t\t\t// See https://github.com/ckeditor/ckeditor5-engine/issues/795 for more details.\r\n\t\t\t// Long timeout is needed to solve #676 and https://github.com/ckeditor/ckeditor5-engine/issues/1157 issues.\r\n\t\t\tthis._renderTimeoutId = setTimeout( () => view.render(), 50 );\r\n\t\t} );\r\n\r\n\t\tdocument.on( 'blur', ( evt, data ) => {\r\n\t\t\tconst selectedEditable = document.selection.editableElement;\r\n\r\n\t\t\tif ( selectedEditable === null || selectedEditable === data.target ) {\r\n\t\t\t\tdocument.isFocused = false;\r\n\r\n\t\t\t\t// Re-render the document to update view elements.\r\n\t\t\t\tview.render();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * Identifier of the timeout currently used by focus listener to delay rendering execution.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Number} #_renderTimeoutId\r\n\t\t */\r\n\t}\r\n\r\n\tonDomEvent( domEvent ) {\r\n\t\tthis.fire( domEvent.type, domEvent );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tif ( this._renderTimeoutId ) {\r\n\t\t\tclearTimeout( this._renderTimeoutId );\r\n\t\t}\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when one of the editables gets focus.\r\n *\r\n * Introduced by {@link module:engine/view/observer/focusobserver~FocusObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/focusobserver~FocusObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/focusobserver~FocusObserver\r\n * @event module:engine/view/document~Document#event:focus\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when one of the editables loses focus.\r\n *\r\n * Introduced by {@link module:engine/view/observer/focusobserver~FocusObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/focusobserver~FocusObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/focusobserver~FocusObserver\r\n * @event module:engine/view/document~Document#event:blur\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/compositionobserver\r\n */\r\n\r\nimport DomEventObserver from './domeventobserver';\r\n\r\n/**\r\n * {@link module:engine/view/document~Document#event:compositionstart Compositionstart},\r\n * {@link module:engine/view/document~Document#event:compositionupdate compositionupdate} and\r\n * {@link module:engine/view/document~Document#event:compositionend compositionend} events observer.\r\n *\r\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class CompositionObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tthis.domEventType = [ 'compositionstart', 'compositionupdate', 'compositionend' ];\r\n\t\tconst document = this.document;\r\n\r\n\t\tdocument.on( 'compositionstart', () => {\r\n\t\t\tdocument.isComposing = true;\r\n\t\t} );\r\n\r\n\t\tdocument.on( 'compositionend', () => {\r\n\t\t\tdocument.isComposing = false;\r\n\t\t} );\r\n\t}\r\n\r\n\tonDomEvent( domEvent ) {\r\n\t\tthis.fire( domEvent.type, domEvent );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when composition starts inside one of the editables.\r\n *\r\n * Introduced by {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/compositionobserver~CompositionObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/compositionobserver~CompositionObserver\r\n * @event module:engine/view/document~Document#event:compositionstart\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when composition is updated inside one of the editables.\r\n *\r\n * Introduced by {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/compositionobserver~CompositionObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/compositionobserver~CompositionObserver\r\n * @event module:engine/view/document~Document#event:compositionupdate\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when composition ends inside one of the editables.\r\n *\r\n * Introduced by {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\r\n *\r\n * Note that because {@link module:engine/view/observer/compositionobserver~CompositionObserver} is attached by the\r\n * {@link module:engine/view/view~View} this event is available by default.\r\n *\r\n * @see module:engine/view/observer/compositionobserver~CompositionObserver\r\n * @event module:engine/view/document~Document#event:compositionend\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/isrange\r\n */\r\n\r\n/**\r\n * Checks if the object is a native DOM Range.\r\n *\r\n * @param {*} obj\r\n * @returns {Boolean}\r\n */\r\nexport default function isRange( obj ) {\r\n\treturn Object.prototype.toString.apply( obj ) == '[object Range]';\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/getborderwidths\r\n */\r\n\r\n/**\r\n * Returns an object containing CSS border widths of a specified HTML element.\r\n *\r\n * @param {HTMLElement} element An element which has CSS borders.\r\n * @returns {Object} An object containing `top`, `left`, `right` and `bottom` properties\r\n * with numerical values of the `border-[top,left,right,bottom]-width` CSS styles.\r\n */\r\nexport default function getBorderWidths( element ) {\r\n\t// Call getComputedStyle on the window the element document belongs to.\r\n\tconst style = element.ownerDocument.defaultView.getComputedStyle( element );\r\n\r\n\treturn {\r\n\t\ttop: parseInt( style.borderTopWidth, 10 ),\r\n\t\tright: parseInt( style.borderRightWidth, 10 ),\r\n\t\tbottom: parseInt( style.borderBottomWidth, 10 ),\r\n\t\tleft: parseInt( style.borderLeftWidth, 10 )\r\n\t};\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/rect\r\n */\r\n\r\nimport isRange from './isrange';\r\nimport isWindow from './iswindow';\r\nimport getBorderWidths from './getborderwidths';\r\nimport log from '../log';\r\nimport isText from './istext';\r\nimport { isElement } from 'lodash-es';\r\n\r\nconst rectProperties = [ 'top', 'right', 'bottom', 'left', 'width', 'height' ];\r\n\r\n/**\r\n * A helper class representing a `ClientRect` object, e.g. value returned by\r\n * the native `object.getBoundingClientRect()` method. Provides a set of methods\r\n * to manipulate the rect and compare it against other rect instances.\r\n */\r\nexport default class Rect {\r\n\t/**\r\n\t * Creates an instance of rect.\r\n\t *\r\n\t *\t\t// Rect of an HTMLElement.\r\n\t *\t\tconst rectA = new Rect( document.body );\r\n\t *\r\n\t *\t\t// Rect of a DOM Range.\r\n\t *\t\tconst rectB = new Rect( document.getSelection().getRangeAt( 0 ) );\r\n\t *\r\n\t *\t\t// Rect of a window (web browser viewport).\r\n\t *\t\tconst rectC = new Rect( window );\r\n\t *\r\n\t *\t\t// Rect out of an object.\r\n\t *\t\tconst rectD = new Rect( { top: 0, right: 10, bottom: 10, left: 0, width: 10, height: 10 } );\r\n\t *\r\n\t *\t\t// Rect out of another Rect instance.\r\n\t *\t\tconst rectE = new Rect( rectD );\r\n\t *\r\n\t *\t\t// Rect out of a ClientRect.\r\n\t *\t\tconst rectF = new Rect( document.body.getClientRects().item( 0 ) );\r\n\t *\r\n\t * **Note**: By default a rect of an HTML element includes its CSS borders and scrollbars (if any)\r\n\t * ant the rect of a `window` includes scrollbars too. Use {@link #excludeScrollbarsAndBorders}\r\n\t * to get the inner part of the rect.\r\n\t *\r\n\t * @param {HTMLElement|Range|Window|ClientRect|module:utils/dom/rect~Rect|Object} source A source object to create the rect.\r\n\t */\r\n\tconstructor( source ) {\r\n\t\tconst isSourceRange = isRange( source );\r\n\r\n\t\t/**\r\n\t\t * The object this rect is for.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @readonly\r\n\t\t * @member {HTMLElement|Range|ClientRect|module:utils/dom/rect~Rect|Object} #_source\r\n\t\t */\r\n\t\tObject.defineProperty( this, '_source', {\r\n\t\t\t// If the source is a Rect instance, copy it's #_source.\r\n\t\t\tvalue: source._source || source,\r\n\t\t\twritable: true,\r\n\t\t\tenumerable: false\r\n\t\t} );\r\n\r\n\t\tif ( isElement( source ) || isSourceRange ) {\r\n\t\t\tconst sourceNode = isSourceRange ? source.startContainer : source;\r\n\r\n\t\t\tif ( !sourceNode.ownerDocument || !sourceNode.ownerDocument.body.contains( sourceNode ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * The `Rect` class depends on `getBoundingClientRect` and `getClientRects` DOM methods.\r\n\t\t\t\t * If the {@link #constructor source} of a rect in an HTML element or a DOM range but it does\r\n\t\t\t\t * not belong to any rendered DOM tree, these methods will fail to obtain the geometry and\r\n\t\t\t\t * the rect instance makes little sense to the features using it.\r\n\t\t\t\t *\r\n\t\t\t\t * To get rid of this warning make sure the source passed to the constructor\r\n\t\t\t\t * is a descendant of `window.document.body`.\r\n\t\t\t\t *\r\n\t\t\t\t * @error rect-source-not-in-dom\r\n\t\t\t\t * @param {String} source The source of the Rect instance.\r\n\t\t\t\t */\r\n\t\t\t\tlog.warn(\r\n\t\t\t\t\t'rect-source-not-in-dom: The source of this rect does not belong to any rendered DOM tree.',\r\n\t\t\t\t\t{ source }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif ( isSourceRange ) {\r\n\t\t\t\tcopyRectProperties( this, Rect.getDomRangeRects( source )[ 0 ] );\r\n\t\t\t} else {\r\n\t\t\t\tcopyRectProperties( this, source.getBoundingClientRect() );\r\n\t\t\t}\r\n\t\t} else if ( isWindow( source ) ) {\r\n\t\t\tconst { innerWidth, innerHeight } = source;\r\n\r\n\t\t\tcopyRectProperties( this, {\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tright: innerWidth,\r\n\t\t\t\tbottom: innerHeight,\r\n\t\t\t\tleft: 0,\r\n\t\t\t\twidth: innerWidth,\r\n\t\t\t\theight: innerHeight\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tcopyRectProperties( this, source );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * The \"top\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #top\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The \"right\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #right\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The \"bottom\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #bottom\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The \"left\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #left\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The \"width\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #width\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The \"height\" value of the rect.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #height\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a clone of the rect.\r\n\t *\r\n\t * @returns {module:utils/dom/rect~Rect} A cloned rect.\r\n\t */\r\n\tclone() {\r\n\t\treturn new Rect( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the rect so that its upper–left corner lands in desired `[ x, y ]` location.\r\n\t *\r\n\t * @param {Number} x Desired horizontal location.\r\n\t * @param {Number} y Desired vertical location.\r\n\t * @returns {module:utils/dom/rect~Rect} A rect which has been moved.\r\n\t */\r\n\tmoveTo( x, y ) {\r\n\t\tthis.top = y;\r\n\t\tthis.right = x + this.width;\r\n\t\tthis.bottom = y + this.height;\r\n\t\tthis.left = x;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the rect in–place by a dedicated offset.\r\n\t *\r\n\t * @param {Number} x A horizontal offset.\r\n\t * @param {Number} y A vertical offset\r\n\t * @returns {module:utils/dom/rect~Rect} A rect which has been moved.\r\n\t */\r\n\tmoveBy( x, y ) {\r\n\t\tthis.top += y;\r\n\t\tthis.right += x;\r\n\t\tthis.left += x;\r\n\t\tthis.bottom += y;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new rect a a result of intersection with another rect.\r\n\t *\r\n\t * @param {module:utils/dom/rect~Rect} anotherRect\r\n\t * @returns {module:utils/dom/rect~Rect}\r\n\t */\r\n\tgetIntersection( anotherRect ) {\r\n\t\tconst rect = {\r\n\t\t\ttop: Math.max( this.top, anotherRect.top ),\r\n\t\t\tright: Math.min( this.right, anotherRect.right ),\r\n\t\t\tbottom: Math.min( this.bottom, anotherRect.bottom ),\r\n\t\t\tleft: Math.max( this.left, anotherRect.left )\r\n\t\t};\r\n\r\n\t\trect.width = rect.right - rect.left;\r\n\t\trect.height = rect.bottom - rect.top;\r\n\r\n\t\tif ( rect.width < 0 || rect.height < 0 ) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn new Rect( rect );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the area of intersection with another rect.\r\n\t *\r\n\t * @param {module:utils/dom/rect~Rect} anotherRect [description]\r\n\t * @returns {Number} Area of intersection.\r\n\t */\r\n\tgetIntersectionArea( anotherRect ) {\r\n\t\tconst rect = this.getIntersection( anotherRect );\r\n\r\n\t\tif ( rect ) {\r\n\t\t\treturn rect.getArea();\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the area of the rect.\r\n\t *\r\n\t * @returns {Number}\r\n\t */\r\n\tgetArea() {\r\n\t\treturn this.width * this.height;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new rect, a part of the original rect, which is actually visible to the user,\r\n\t * e.g. an original rect cropped by parent element rects which have `overflow` set in CSS\r\n\t * other than `\"visible\"`.\r\n\t *\r\n\t * If there's no such visible rect, which is when the rect is limited by one or many of\r\n\t * the ancestors, `null` is returned.\r\n\t *\r\n\t * @returns {module:utils/dom/rect~Rect|null} A visible rect instance or `null`, if there's none.\r\n\t */\r\n\tgetVisible() {\r\n\t\tconst source = this._source;\r\n\t\tlet visibleRect = this.clone();\r\n\r\n\t\t// There's no ancestor to crop <body> with the overflow.\r\n\t\tif ( !isBody( source ) ) {\r\n\t\t\tlet parent = source.parentNode || source.commonAncestorContainer;\r\n\r\n\t\t\t// Check the ancestors all the way up to the <body>.\r\n\t\t\twhile ( parent && !isBody( parent ) ) {\r\n\t\t\t\tconst parentRect = new Rect( parent );\r\n\t\t\t\tconst intersectionRect = visibleRect.getIntersection( parentRect );\r\n\r\n\t\t\t\tif ( intersectionRect ) {\r\n\t\t\t\t\tif ( intersectionRect.getArea() < visibleRect.getArea() ) {\r\n\t\t\t\t\t\t// Reduce the visible rect to the intersection.\r\n\t\t\t\t\t\tvisibleRect = intersectionRect;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// There's no intersection, the rect is completely invisible.\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparent = parent.parentNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn visibleRect;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if all property values ({@link #top}, {@link #left}, {@link #right},\r\n\t * {@link #bottom}, {@link #width} and {@link #height}) are the equal in both rect\r\n\t * instances.\r\n\t *\r\n\t * @param {module:utils/dom/rect~Rect} rect A rect instance to compare with.\r\n\t * @returns {Boolean} `true` when Rects are equal. `false` otherwise.\r\n\t */\r\n\tisEqual( anotherRect ) {\r\n\t\tfor ( const prop of rectProperties ) {\r\n\t\t\tif ( this[ prop ] !== anotherRect[ prop ] ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether a rect fully contains another rect instance.\r\n\t *\r\n\t * @param {module:utils/dom/rect~Rect} anotherRect\r\n\t * @returns {Boolean} `true` if contains, `false` otherwise.\r\n\t */\r\n\tcontains( anotherRect ) {\r\n\t\tconst intersectRect = this.getIntersection( anotherRect );\r\n\r\n\t\treturn !!( intersectRect && intersectRect.isEqual( anotherRect ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Excludes scrollbars and CSS borders from the rect.\r\n\t *\r\n\t * * Borders are removed when {@link #_source} is an HTML element.\r\n\t * * Scrollbars are excluded from HTML elements and the `window`.\r\n\t *\r\n\t * @returns {module:utils/dom/rect~Rect} A rect which has been updated.\r\n\t */\r\n\texcludeScrollbarsAndBorders() {\r\n\t\tconst source = this._source;\r\n\t\tlet scrollBarWidth, scrollBarHeight;\r\n\r\n\t\tif ( isWindow( source ) ) {\r\n\t\t\tscrollBarWidth = source.innerWidth - source.document.documentElement.clientWidth;\r\n\t\t\tscrollBarHeight = source.innerHeight - source.document.documentElement.clientHeight;\r\n\t\t} else {\r\n\t\t\tconst borderWidths = getBorderWidths( this._source );\r\n\r\n\t\t\tscrollBarWidth = source.offsetWidth - source.clientWidth;\r\n\t\t\tscrollBarHeight = source.offsetHeight - source.clientHeight;\r\n\r\n\t\t\tthis.moveBy( borderWidths.left, borderWidths.top );\r\n\t\t}\r\n\r\n\t\t// Assuming LTR scrollbars. TODO: RTL.\r\n\t\tthis.width -= scrollBarWidth;\r\n\t\tthis.right -= scrollBarWidth;\r\n\r\n\t\tthis.height -= scrollBarHeight;\r\n\t\tthis.bottom -= scrollBarHeight;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array of rects of the given native DOM Range.\r\n\t *\r\n\t * @param {Range} range A native DOM range.\r\n\t * @returns {Array.<module:utils/dom/rect~Rect>} DOM Range rects.\r\n\t */\r\n\tstatic getDomRangeRects( range ) {\r\n\t\tconst rects = [];\r\n\t\t// Safari does not iterate over ClientRectList using for...of loop.\r\n\t\tconst clientRects = Array.from( range.getClientRects() );\r\n\r\n\t\tif ( clientRects.length ) {\r\n\t\t\tfor ( const rect of clientRects ) {\r\n\t\t\t\trects.push( new Rect( rect ) );\r\n\t\t\t}\r\n\t\t}\r\n\t\t// If there's no client rects for the Range, use parent container's bounding rect\r\n\t\t// instead and adjust rect's width to simulate the actual geometry of such range.\r\n\t\t// https://github.com/ckeditor/ckeditor5-utils/issues/153\r\n\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/317\r\n\t\telse {\r\n\t\t\tlet startContainer = range.startContainer;\r\n\r\n\t\t\tif ( isText( startContainer ) ) {\r\n\t\t\t\tstartContainer = startContainer.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\tconst rect = new Rect( startContainer.getBoundingClientRect() );\r\n\t\t\trect.right = rect.left;\r\n\t\t\trect.width = 0;\r\n\r\n\t\t\trects.push( rect );\r\n\t\t}\r\n\r\n\t\treturn rects;\r\n\t}\r\n}\r\n\r\n// Acquires all the rect properties from the passed source.\r\n//\r\n// @private\r\n// @param {module:utils/dom/rect~Rect} rect\r\n// @param {ClientRect|module:utils/dom/rect~Rect|Object} source\r\nfunction copyRectProperties( rect, source ) {\r\n\tfor ( const p of rectProperties ) {\r\n\t\trect[ p ] = source[ p ];\r\n\t}\r\n}\r\n\r\n// Checks if provided object is a <body> HTML element.\r\n//\r\n// @private\r\n// @param {HTMLElement|Range} elementOrRange\r\n// @returns {Boolean}\r\nfunction isBody( elementOrRange ) {\r\n\tif ( !isElement( elementOrRange ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn elementOrRange === elementOrRange.ownerDocument.body;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/scroll\r\n */\r\n\r\nimport isRange from './isrange';\r\nimport Rect from './rect';\r\nimport isText from './istext';\r\n\r\nconst utils = {};\r\n\r\n/**\r\n * Makes any page `HTMLElement` or `Range` (`target`) visible inside the browser viewport.\r\n * This helper will scroll all `target` ancestors and the web browser viewport to reveal the target to\r\n * the user. If the `target` is already visible, nothing will happen.\r\n *\r\n * @param {HTMLElement|Range} options.target A target, which supposed to become visible to the user.\r\n * @param {Number} [options.viewportOffset] An offset from the edge of the viewport (in pixels)\r\n * the `target` will be moved by when the viewport is scrolled. It enhances the user experience\r\n * by keeping the `target` some distance from the edge of the viewport and thus making it easier to\r\n * read or edit by the user.\r\n */\r\nexport function scrollViewportToShowTarget( { target, viewportOffset = 0 } ) {\r\n\tconst targetWindow = getWindow( target );\r\n\tlet currentWindow = targetWindow;\r\n\tlet currentFrame = null;\r\n\r\n\t// Iterate over all windows, starting from target's parent window up to window#top.\r\n\twhile ( currentWindow ) {\r\n\t\tlet firstAncestorToScroll;\r\n\r\n\t\t// Let's scroll target's ancestors first to reveal it. Then, once the ancestor scrolls\r\n\t\t// settled down, the algorithm can eventually scroll the viewport of the current window.\r\n\t\t//\r\n\t\t// Note: If the current window is target's **original** window (e.g. the first one),\r\n\t\t// start scrolling the closest parent of the target. If not, scroll the closest parent\r\n\t\t// of an iframe that resides in the current window.\r\n\t\tif ( currentWindow == targetWindow ) {\r\n\t\t\tfirstAncestorToScroll = getParentElement( target );\r\n\t\t} else {\r\n\t\t\tfirstAncestorToScroll = getParentElement( currentFrame );\r\n\t\t}\r\n\r\n\t\t// Scroll the target's ancestors first. Once done, scrolling the viewport is easy.\r\n\t\tscrollAncestorsToShowRect( firstAncestorToScroll, () => {\r\n\t\t\t// Note: If the target does not belong to the current window **directly**,\r\n\t\t\t// i.e. it resides in an iframe belonging to the window, obtain the target's rect\r\n\t\t\t// in the coordinates of the current window. By default, a Rect returns geometry\r\n\t\t\t// relative to the current window's viewport. To make it work in a parent window,\r\n\t\t\t// it must be shifted.\r\n\t\t\treturn getRectRelativeToWindow( target, currentWindow );\r\n\t\t} );\r\n\r\n\t\t// Obtain the rect of the target after it has been scrolled within its ancestors.\r\n\t\t// It's time to scroll the viewport.\r\n\t\tconst targetRect = getRectRelativeToWindow( target, currentWindow );\r\n\r\n\t\tscrollWindowToShowRect( currentWindow, targetRect, viewportOffset );\r\n\r\n\t\tif ( currentWindow.parent != currentWindow ) {\r\n\t\t\t// Keep the reference to the <iframe> element the \"previous current window\" was\r\n\t\t\t// rendered within. It will be useful to re–calculate the rect of the target\r\n\t\t\t// in the parent window's relative geometry. The target's rect must be shifted\r\n\t\t\t// by it's iframe's position.\r\n\t\t\tcurrentFrame = currentWindow.frameElement;\r\n\t\t\tcurrentWindow = currentWindow.parent;\r\n\r\n\t\t\t// If the current window has some parent but frameElement is inaccessible, then they have\r\n\t\t\t// different domains/ports and, due to security reasons, accessing and scrolling\r\n\t\t\t// the parent window won't be possible.\r\n\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/930.\r\n\t\t\tif ( !currentFrame ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurrentWindow = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Makes any page `HTMLElement` or `Range` (target) visible within its scrollable ancestors,\r\n * e.g. if they have `overflow: scroll` CSS style.\r\n *\r\n * @param {HTMLElement|Range} target A target, which supposed to become visible to the user.\r\n */\r\nexport function scrollAncestorsToShowTarget( target ) {\r\n\tconst targetParent = getParentElement( target );\r\n\r\n\tscrollAncestorsToShowRect( targetParent, () => {\r\n\t\treturn new Rect( target );\r\n\t} );\r\n}\r\n\r\n// TODO: Using a property value shorthand in the top of the file\r\n// causes JSDoc to throw errors. See https://github.com/cksource/docs-builder/issues/75.\r\nObject.assign( utils, {\r\n\tscrollViewportToShowTarget,\r\n\tscrollAncestorsToShowTarget\r\n} );\r\n\r\n// Makes a given rect visible within its parent window.\r\n//\r\n// Note: Avoid the situation where the caret is still in the viewport, but totally\r\n// at the edge of it. In such situation, if it moved beyond the viewport in the next\r\n// action e.g. after paste, the scrolling would move it to the viewportOffset level\r\n// and it all would look like the caret visually moved up/down:\r\n//\r\n// 1.\r\n//\t\t| foo[]\r\n//\t\t|                                    <--- N px of space below the caret\r\n//\t\t+---------------------------------...\r\n//\r\n// 2. *paste*\r\n// 3.\r\n//\t\t|\r\n//\t\t|\r\n//\t\t+-foo-----------------------------...\r\n//\t\t  bar[]                              <--- caret below viewport, scrolling...\r\n//\r\n// 4. *scrolling*\r\n// 5.\r\n//\t\t|\r\n//\t\t| foo\r\n//\t\t| bar[]                              <--- caret precisely at the edge\r\n//\t\t+---------------------------------...\r\n//\r\n// To prevent this, this method checks the rects moved by the viewportOffset to cover\r\n// the upper/lower edge of the viewport. It makes sure if the action repeats, there's\r\n// no twitching – it's a purely visual improvement:\r\n//\r\n// 5. (after fix)\r\n//\t\t|\r\n//\t\t| foo\r\n//\t\t| bar[]\r\n//\t\t|                                    <--- N px of space below the caret\r\n//\t\t+---------------------------------...\r\n//\r\n// @private\r\n// @param {Window} window A window which is scrolled to reveal the rect.\r\n// @param {module:utils/dom/rect~Rect} rect A rect which is to be revealed.\r\n// @param {Number} viewportOffset See scrollViewportToShowTarget.\r\nfunction scrollWindowToShowRect( window, rect, viewportOffset ) {\r\n\tconst targetShiftedDownRect = rect.clone().moveBy( 0, viewportOffset );\r\n\tconst targetShiftedUpRect = rect.clone().moveBy( 0, -viewportOffset );\r\n\tconst viewportRect = new Rect( window ).excludeScrollbarsAndBorders();\r\n\r\n\tconst rects = [ targetShiftedUpRect, targetShiftedDownRect ];\r\n\r\n\tif ( !rects.every( rect => viewportRect.contains( rect ) ) ) {\r\n\t\tlet { scrollX, scrollY } = window;\r\n\r\n\t\tif ( isAbove( targetShiftedUpRect, viewportRect ) ) {\r\n\t\t\tscrollY -= viewportRect.top - rect.top + viewportOffset;\r\n\t\t} else if ( isBelow( targetShiftedDownRect, viewportRect ) ) {\r\n\t\t\tscrollY += rect.bottom - viewportRect.bottom + viewportOffset;\r\n\t\t}\r\n\r\n\t\t// TODO: Web browsers scroll natively to place the target in the middle\r\n\t\t// of the viewport. It's not a very popular case, though.\r\n\t\tif ( isLeftOf( rect, viewportRect ) ) {\r\n\t\t\tscrollX -= viewportRect.left - rect.left + viewportOffset;\r\n\t\t} else if ( isRightOf( rect, viewportRect ) ) {\r\n\t\t\tscrollX += rect.right - viewportRect.right + viewportOffset;\r\n\t\t}\r\n\r\n\t\twindow.scrollTo( scrollX, scrollY );\r\n\t}\r\n}\r\n\r\n// Recursively scrolls element ancestors to visually reveal a rect.\r\n//\r\n// @private\r\n// @param {HTMLElement} A parent The first ancestors to start scrolling.\r\n// @param {Function} getRect A function which returns the Rect, which is to be revealed.\r\nfunction scrollAncestorsToShowRect( parent, getRect ) {\r\n\tconst parentWindow = getWindow( parent );\r\n\tlet parentRect, targetRect;\r\n\r\n\twhile ( parent != parentWindow.document.body ) {\r\n\t\ttargetRect = getRect();\r\n\t\tparentRect = new Rect( parent ).excludeScrollbarsAndBorders();\r\n\r\n\t\tif ( !parentRect.contains( targetRect ) ) {\r\n\t\t\tif ( isAbove( targetRect, parentRect ) ) {\r\n\t\t\t\tparent.scrollTop -= parentRect.top - targetRect.top;\r\n\t\t\t} else if ( isBelow( targetRect, parentRect ) ) {\r\n\t\t\t\tparent.scrollTop += targetRect.bottom - parentRect.bottom;\r\n\t\t\t}\r\n\r\n\t\t\tif ( isLeftOf( targetRect, parentRect ) ) {\r\n\t\t\t\tparent.scrollLeft -= parentRect.left - targetRect.left;\r\n\t\t\t} else if ( isRightOf( targetRect, parentRect ) ) {\r\n\t\t\t\tparent.scrollLeft += targetRect.right - parentRect.right;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tparent = parent.parentNode;\r\n\t}\r\n}\r\n\r\n// Determines if a given `Rect` extends beyond the bottom edge of the second `Rect`.\r\n//\r\n// @private\r\n// @param {module:utils/dom/rect~Rect} firstRect\r\n// @param {module:utils/dom/rect~Rect} secondRect\r\nfunction isBelow( firstRect, secondRect ) {\r\n\treturn firstRect.bottom > secondRect.bottom;\r\n}\r\n\r\n// Determines if a given `Rect` extends beyond the top edge of the second `Rect`.\r\n//\r\n// @private\r\n// @param {module:utils/dom/rect~Rect} firstRect\r\n// @param {module:utils/dom/rect~Rect} secondRect\r\nfunction isAbove( firstRect, secondRect ) {\r\n\treturn firstRect.top < secondRect.top;\r\n}\r\n\r\n// Determines if a given `Rect` extends beyond the left edge of the second `Rect`.\r\n//\r\n// @private\r\n// @param {module:utils/dom/rect~Rect} firstRect\r\n// @param {module:utils/dom/rect~Rect} secondRect\r\nfunction isLeftOf( firstRect, secondRect ) {\r\n\treturn firstRect.left < secondRect.left;\r\n}\r\n\r\n// Determines if a given `Rect` extends beyond the right edge of the second `Rect`.\r\n//\r\n// @private\r\n// @param {module:utils/dom/rect~Rect} firstRect\r\n// @param {module:utils/dom/rect~Rect} secondRect\r\nfunction isRightOf( firstRect, secondRect ) {\r\n\treturn firstRect.right > secondRect.right;\r\n}\r\n\r\n// Returns the closest window of an element or range.\r\n//\r\n// @private\r\n// @param {HTMLElement|Range} firstRect\r\n// @returns {Window}\r\nfunction getWindow( elementOrRange ) {\r\n\tif ( isRange( elementOrRange ) ) {\r\n\t\treturn elementOrRange.startContainer.ownerDocument.defaultView;\r\n\t} else {\r\n\t\treturn elementOrRange.ownerDocument.defaultView;\r\n\t}\r\n}\r\n\r\n// Returns the closest parent of an element or DOM range.\r\n//\r\n// @private\r\n// @param {HTMLElement|Range} firstRect\r\n// @returns {HTMLelement}\r\nfunction getParentElement( elementOrRange ) {\r\n\tif ( isRange( elementOrRange ) ) {\r\n\t\tlet parent = elementOrRange.commonAncestorContainer;\r\n\r\n\t\t// If a Range is attached to the Text, use the closest element ancestor.\r\n\t\tif ( isText( parent ) ) {\r\n\t\t\tparent = parent.parentNode;\r\n\t\t}\r\n\r\n\t\treturn parent;\r\n\t} else {\r\n\t\treturn elementOrRange.parentNode;\r\n\t}\r\n}\r\n\r\n// Returns the rect of an element or range residing in an iframe.\r\n// The result rect is relative to the geometry of the passed window instance.\r\n//\r\n// @private\r\n// @param {HTMLElement|Range} target Element or range which rect should be returned.\r\n// @param {Window} relativeWindow A window the rect should be relative to.\r\n// @returns {module:utils/dom/rect~Rect}\r\nfunction getRectRelativeToWindow( target, relativeWindow ) {\r\n\tconst targetWindow = getWindow( target );\r\n\tconst rect = new Rect( target );\r\n\r\n\tif ( targetWindow === relativeWindow ) {\r\n\t\treturn rect;\r\n\t} else {\r\n\t\tlet currentWindow = targetWindow;\r\n\r\n\t\twhile ( currentWindow != relativeWindow ) {\r\n\t\t\tconst frame = currentWindow.frameElement;\r\n\t\t\tconst frameRect = new Rect( frame ).excludeScrollbarsAndBorders();\r\n\r\n\t\t\trect.moveBy( frameRect.left, frameRect.top );\r\n\r\n\t\t\tcurrentWindow = currentWindow.parent;\r\n\t\t}\r\n\t}\r\n\r\n\treturn rect;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/view\r\n */\r\n\r\nimport Document from './document';\r\nimport DowncastWriter from './downcastwriter';\r\nimport Renderer from './renderer';\r\nimport DomConverter from './domconverter';\r\nimport Position from './position';\r\nimport Range from './range';\r\nimport Selection from './selection';\r\n\r\nimport MutationObserver from './observer/mutationobserver';\r\nimport KeyObserver from './observer/keyobserver';\r\nimport FakeSelectionObserver from './observer/fakeselectionobserver';\r\nimport SelectionObserver from './observer/selectionobserver';\r\nimport FocusObserver from './observer/focusobserver';\r\nimport CompositionObserver from './observer/compositionobserver';\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport { scrollViewportToShowTarget } from '@ckeditor/ckeditor5-utils/src/dom/scroll';\r\nimport { injectUiElementHandling } from './uielement';\r\nimport { injectQuirksHandling } from './filler';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Editor's view controller class. Its main responsibility is DOM - View management for editing purposes, to provide\r\n * abstraction over the DOM structure and events and hide all browsers quirks.\r\n *\r\n * View controller renders view document to DOM whenever view structure changes. To determine when view can be rendered,\r\n * all changes need to be done using the {@link module:engine/view/view~View#change} method, using\r\n * {@link module:engine/view/downcastwriter~DowncastWriter}:\r\n *\r\n *\t\tview.change( writer => {\r\n *\t\t\twriter.insert( position, writer.createText( 'foo' ) );\r\n *\t\t} );\r\n *\r\n * View controller also register {@link module:engine/view/observer/observer~Observer observers} which observes changes\r\n * on DOM and fire events on the {@link module:engine/view/document~Document Document}.\r\n * Note that the following observers are added by the class constructor and are always available:\r\n *\r\n * * {@link module:engine/view/observer/mutationobserver~MutationObserver},\r\n * * {@link module:engine/view/observer/selectionobserver~SelectionObserver},\r\n * * {@link module:engine/view/observer/focusobserver~FocusObserver},\r\n * * {@link module:engine/view/observer/keyobserver~KeyObserver},\r\n * * {@link module:engine/view/observer/fakeselectionobserver~FakeSelectionObserver}.\r\n * * {@link module:engine/view/observer/compositionobserver~CompositionObserver}.\r\n *\r\n * This class also {@link module:engine/view/view~View#attachDomRoot binds the DOM and the view elements}.\r\n *\r\n * If you do not need full a DOM - view management, and only want to transform a tree of view elements to a tree of DOM\r\n * elements you do not need this controller. You can use the {@link module:engine/view/domconverter~DomConverter DomConverter} instead.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class View {\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Instance of the {@link module:engine/view/document~Document} associated with this view controller.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/document~Document} module:engine/view/view~View#document\r\n\t\t */\r\n\t\tthis.document = new Document();\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:engine/view/domconverter~DomConverter domConverter} use by\r\n\t\t * {@link module:engine/view/view~View#renderer renderer}\r\n\t\t * and {@link module:engine/view/observer/observer~Observer observers}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/domconverter~DomConverter} module:engine/view/view~View#domConverter\r\n\t\t */\r\n\t\tthis.domConverter = new DomConverter();\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:engine/view/renderer~Renderer renderer}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:engine/view/renderer~Renderer} module:engine/view/view~View#renderer\r\n\t\t */\r\n\t\tthis._renderer = new Renderer( this.domConverter, this.document.selection );\r\n\t\tthis._renderer.bind( 'isFocused' ).to( this.document );\r\n\r\n\t\t/**\r\n\t\t * Roots of the DOM tree. Map on the `HTMLElement`s with roots names as keys.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Map} module:engine/view/view~View#domRoots\r\n\t\t */\r\n\t\tthis.domRoots = new Map();\r\n\r\n\t\t/**\r\n\t\t * Map of registered {@link module:engine/view/observer/observer~Observer observers}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map.<Function, module:engine/view/observer/observer~Observer>} module:engine/view/view~View#_observers\r\n\t\t */\r\n\t\tthis._observers = new Map();\r\n\r\n\t\t/**\r\n\t\t * Is set to `true` when {@link #change view changes} are currently in progress.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean} module:engine/view/view~View#_ongoingChange\r\n\t\t */\r\n\t\tthis._ongoingChange = false;\r\n\r\n\t\t/**\r\n\t\t * Used to prevent calling {@link #render} and {@link #change} during rendering view to the DOM.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean} module:engine/view/view~View#_renderingInProgress\r\n\t\t */\r\n\t\tthis._renderingInProgress = false;\r\n\r\n\t\t/**\r\n\t\t * Used to prevent calling {@link #render} and {@link #change} during rendering view to the DOM.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean} module:engine/view/view~View#_renderingInProgress\r\n\t\t */\r\n\t\tthis._postFixersInProgress = false;\r\n\r\n\t\t/**\r\n\t\t * Internal flag to temporary disable rendering. See usage in the editing controller.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Boolean} module:engine/view/view~View#_renderingDisabled\r\n\t\t */\r\n\t\tthis._renderingDisabled = false;\r\n\r\n\t\t/**\r\n\t\t * DowncastWriter instance used in {@link #change change method) callbacks.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/downcastwriter~DowncastWriter} module:engine/view/view~View#_writer\r\n\t\t */\r\n\t\tthis._writer = new DowncastWriter( this.document );\r\n\r\n\t\t// Add default observers.\r\n\t\tthis.addObserver( MutationObserver );\r\n\t\tthis.addObserver( SelectionObserver );\r\n\t\tthis.addObserver( FocusObserver );\r\n\t\tthis.addObserver( KeyObserver );\r\n\t\tthis.addObserver( FakeSelectionObserver );\r\n\t\tthis.addObserver( CompositionObserver );\r\n\r\n\t\t// Inject quirks handlers.\r\n\t\tinjectQuirksHandling( this );\r\n\t\tinjectUiElementHandling( this );\r\n\r\n\t\t// Use 'normal' priority so that rendering is performed as first when using that priority.\r\n\t\tthis.on( 'render', () => {\r\n\t\t\tthis._render();\r\n\r\n\t\t\t// Informs that layout has changed after render.\r\n\t\t\tthis.document.fire( 'layoutChanged' );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Attaches DOM root element to the view element and enable all observers on that element.\r\n\t * Also {@link module:engine/view/renderer~Renderer#markToSync mark element} to be synchronized with the view\r\n\t * what means that all child nodes will be removed and replaced with content of the view root.\r\n\t *\r\n\t * This method also will change view element name as the same as tag name of given dom root.\r\n\t * Name is always transformed to lower case.\r\n\t *\r\n\t * @param {Element} domRoot DOM root element.\r\n\t * @param {String} [name='main'] Name of the root.\r\n\t */\r\n\tattachDomRoot( domRoot, name = 'main' ) {\r\n\t\tconst viewRoot = this.document.getRoot( name );\r\n\r\n\t\t// Set view root name the same as DOM root tag name.\r\n\t\tviewRoot._name = domRoot.tagName.toLowerCase();\r\n\r\n\t\tthis.domRoots.set( name, domRoot );\r\n\t\tthis.domConverter.bindElements( domRoot, viewRoot );\r\n\t\tthis._renderer.markToSync( 'children', viewRoot );\r\n\t\tthis._renderer.domDocuments.add( domRoot.ownerDocument );\r\n\r\n\t\tviewRoot.on( 'change:children', ( evt, node ) => this._renderer.markToSync( 'children', node ) );\r\n\t\tviewRoot.on( 'change:attributes', ( evt, node ) => this._renderer.markToSync( 'attributes', node ) );\r\n\t\tviewRoot.on( 'change:text', ( evt, node ) => this._renderer.markToSync( 'text', node ) );\r\n\r\n\t\tfor ( const observer of this._observers.values() ) {\r\n\t\t\tobserver.observe( domRoot, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets DOM root element.\r\n\t *\r\n\t * @param {String} [name='main']  Name of the root.\r\n\t * @returns {Element} DOM root element instance.\r\n\t */\r\n\tgetDomRoot( name = 'main' ) {\r\n\t\treturn this.domRoots.get( name );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates observer of the given type if not yet created, {@link module:engine/view/observer/observer~Observer#enable enables} it\r\n\t * and {@link module:engine/view/observer/observer~Observer#observe attaches} to all existing and future\r\n\t * {@link #domRoots DOM roots}.\r\n\t *\r\n\t * Note: Observers are recognized by their constructor (classes). A single observer will be instantiated and used only\r\n\t * when registered for the first time. This means that features and other components can register a single observer\r\n\t * multiple times without caring whether it has been already added or not.\r\n\t *\r\n\t * @param {Function} Observer The constructor of an observer to add.\r\n\t * Should create an instance inheriting from {@link module:engine/view/observer/observer~Observer}.\r\n\t * @returns {module:engine/view/observer/observer~Observer} Added observer instance.\r\n\t */\r\n\taddObserver( Observer ) {\r\n\t\tlet observer = this._observers.get( Observer );\r\n\r\n\t\tif ( observer ) {\r\n\t\t\treturn observer;\r\n\t\t}\r\n\r\n\t\tobserver = new Observer( this );\r\n\r\n\t\tthis._observers.set( Observer, observer );\r\n\r\n\t\tfor ( const [ name, domElement ] of this.domRoots ) {\r\n\t\t\tobserver.observe( domElement, name );\r\n\t\t}\r\n\r\n\t\tobserver.enable();\r\n\r\n\t\treturn observer;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns observer of the given type or `undefined` if such observer has not been added yet.\r\n\t *\r\n\t * @param {Function} Observer The constructor of an observer to get.\r\n\t * @returns {module:engine/view/observer/observer~Observer|undefined} Observer instance or undefined.\r\n\t */\r\n\tgetObserver( Observer ) {\r\n\t\treturn this._observers.get( Observer );\r\n\t}\r\n\r\n\t/**\r\n\t * Disables all added observers.\r\n\t */\r\n\tdisableObservers() {\r\n\t\tfor ( const observer of this._observers.values() ) {\r\n\t\t\tobserver.disable();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Enables all added observers.\r\n\t */\r\n\tenableObservers() {\r\n\t\tfor ( const observer of this._observers.values() ) {\r\n\t\t\tobserver.enable();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Scrolls the page viewport and {@link #domRoots} with their ancestors to reveal the\r\n\t * caret, if not already visible to the user.\r\n\t */\r\n\tscrollToTheSelection() {\r\n\t\tconst range = this.document.selection.getFirstRange();\r\n\r\n\t\tif ( range ) {\r\n\t\t\tscrollViewportToShowTarget( {\r\n\t\t\t\ttarget: this.domConverter.viewRangeToDom( range ),\r\n\t\t\t\tviewportOffset: 20\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * It will focus DOM element representing {@link module:engine/view/editableelement~EditableElement EditableElement}\r\n\t * that is currently having selection inside.\r\n\t */\r\n\tfocus() {\r\n\t\tif ( !this.document.isFocused ) {\r\n\t\t\tconst editable = this.document.selection.editableElement;\r\n\r\n\t\t\tif ( editable ) {\r\n\t\t\t\tthis.domConverter.focus( editable );\r\n\t\t\t\tthis.render();\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * Before focusing view document, selection should be placed inside one of the view's editables.\r\n\t\t\t\t * Normally its selection will be converted from model document (which have default selection), but\r\n\t\t\t\t * when using view document on its own, we need to manually place selection before focusing it.\r\n\t\t\t\t *\r\n\t\t\t\t * @error view-focus-no-selection\r\n\t\t\t\t */\r\n\t\t\t\tlog.warn( 'view-focus-no-selection: There is no selection in any editable to focus.' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The `change()` method is the primary way of changing the view. You should use it to modify any node in the view tree.\r\n\t * It makes sure that after all changes are made the view is rendered to the DOM. It prevents situations when the DOM is updated\r\n\t * when the view state is not yet correct. It allows to nest calls one inside another and still performs a single rendering\r\n\t * after all those changes are made. It also returns the return value of its callback.\r\n\t *\r\n\t *\t\tconst text = view.change( writer => {\r\n\t *\t\t\tconst newText = writer.createText( 'foo' );\r\n\t *\t\t\twriter.insert( position1, newText );\r\n\t *\r\n\t *\t\t\tview.change( writer => {\r\n\t *\t\t\t\twriter.insert( position2, writer.createText( 'bar' ) );\r\n\t *\t\t\t} );\r\n\t *\r\n\t * \t\t\twriter.remove( range );\r\n\t *\r\n\t * \t\t\treturn newText;\r\n\t *\t\t} );\r\n\t *\r\n\t * When the outermost change block is done and rendering to the DOM is over the\r\n\t * {@link module:engine/view/view~View#event:render `View#render`} event is fired.\r\n\t *\r\n\t * This method throws a `applying-view-changes-on-rendering` error when\r\n\t * the change block is used after rendering to the DOM has started.\r\n\t *\r\n\t * @param {Function} callback Callback function which may modify the view.\r\n\t * @returns {*} Value returned by the callback.\r\n\t */\r\n\tchange( callback ) {\r\n\t\tif ( this._renderingInProgress || this._postFixersInProgress ) {\r\n\t\t\t/**\r\n\t\t\t * Thrown when there is an attempt to make changes to the view tree when it is in incorrect state. This may\r\n\t\t\t * cause some unexpected behaviour and inconsistency between the DOM and the view.\r\n\t\t\t * This may be caused by:\r\n\t\t\t *\r\n\t\t\t * * calling {@link #change} or {@link #render} during rendering process,\r\n\t\t\t * * calling {@link #change} or {@link #render} inside of\r\n\t\t\t *   {@link module:engine/view/document~Document#registerPostFixer post-fixer function}.\r\n\t\t\t *\r\n\t\t\t * @error cannot-change-view-tree\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'cannot-change-view-tree: ' +\r\n\t\t\t\t'Attempting to make changes to the view when it is in an incorrect state: rendering or post-fixers are in progress. ' +\r\n\t\t\t\t'This may cause some unexpected behavior and inconsistency between the DOM and the view.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Recursive call to view.change() method - execute listener immediately.\r\n\t\tif ( this._ongoingChange ) {\r\n\t\t\treturn callback( this._writer );\r\n\t\t}\r\n\r\n\t\t// This lock will assure that all recursive calls to view.change() will end up in same block - one \"render\"\r\n\t\t// event for all nested calls.\r\n\t\tthis._ongoingChange = true;\r\n\t\tconst callbackResult = callback( this._writer );\r\n\t\tthis._ongoingChange = false;\r\n\r\n\t\t// This lock is used by editing controller to render changes from outer most model.change() once. As plugins might call\r\n\t\t// view.change() inside model.change() block - this will ensures that postfixers and rendering are called once after all changes.\r\n\t\tif ( !this._renderingDisabled ) {\r\n\t\t\tthis._postFixersInProgress = true;\r\n\t\t\tthis.document._callPostFixers( this._writer );\r\n\t\t\tthis._postFixersInProgress = false;\r\n\r\n\t\t\tthis.fire( 'render' );\r\n\t\t}\r\n\r\n\t\treturn callbackResult;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders {@link module:engine/view/document~Document view document} to DOM. If any view changes are\r\n\t * currently in progress, rendering will start after all {@link #change change blocks} are processed.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `applying-view-changes-on-rendering` when\r\n\t * trying to re-render when rendering to DOM has already started.\r\n\t */\r\n\trender() {\r\n\t\tthis.change( () => {} );\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this instance. Makes sure that all observers are destroyed and listeners removed.\r\n\t */\r\n\tdestroy() {\r\n\t\tfor ( const observer of this._observers.values() ) {\r\n\t\t\tobserver.destroy();\r\n\t\t}\r\n\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/view/position~Position position},\r\n\t * * parent element and offset (offset defaults to `0`),\r\n\t * * parent element and `'end'` (sets position at the end of that element),\r\n\t * * {@link module:engine/view/item~Item view item} and `'before'` or `'after'` (sets position before or after given view item).\r\n\t *\r\n\t * This method is a shortcut to other constructors such as:\r\n\t *\r\n\t * * {@link #createPositionBefore},\r\n\t * * {@link #createPositionAfter},\r\n\t *\r\n\t * @param {module:engine/view/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tcreatePositionAt( itemOrPosition, offset ) {\r\n\t\treturn Position._createAt( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position after given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item after which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionAfter( item ) {\r\n\t\treturn Position._createAfter( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position before given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item before which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionBefore( item ) {\r\n\t\treturn Position._createBefore( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range spanning from `start` position to `end` position.\r\n\t *\r\n\t * **Note:** This factory method creates it's own {@link module:engine/view/position~Position} instances basing on passed values.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} start Start position.\r\n\t * @param {module:engine/view/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRange( start, end ) {\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before given {@link module:engine/view/item~Item view item} and ends after it.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeOn( item ) {\r\n\t\treturn Range._createOn( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeIn( element ) {\r\n\t\treturn Range._createIn( element );\r\n\t}\r\n\r\n\t/**\r\n\t Creates new {@link module:engine/view/selection~Selection} instance.\r\n\t *\r\n\t * \t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = view.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = view.createRange( start, end );\r\n\t *\t\tconst selection = view.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t * \t\tconst ranges = [ view.createRange( start1, end2 ), view.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = view.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\tconst otherSelection = view.createSelection();\r\n\t *\t\tconst selection = view.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the document selection.\r\n\t *\t\tconst selection = view.createSelection( editor.editing.view.document.selection );\r\n\t *\r\n\t * \t\t// Creates selection at the given position.\r\n\t *\t\tconst position = view.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = view.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = view.createContainerElement( 'paragraph' );\r\n\t *\t\tconst selection = view.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = view.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = view.createSelection( paragraph, 'on' );\r\n\t *\r\n\t * `Selection`'s factory method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = view.createSelection( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tconst selection = view.createSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection|\r\n\t * module:engine/view/position~Position|Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} [selectable=null]\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t * @returns {module:engine/view/selection~Selection}\r\n\t */\r\n\tcreateSelection( selectable, placeOrOffset, options ) {\r\n\t\treturn new Selection( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Renders all changes. In order to avoid triggering the observers (e.g. mutations) all observers are disabled\r\n\t * before rendering and re-enabled after that.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_render() {\r\n\t\tthis._renderingInProgress = true;\r\n\t\tthis.disableObservers();\r\n\t\tthis._renderer.render();\r\n\t\tthis.enableObservers();\r\n\t\tthis._renderingInProgress = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Fired after a topmost {@link module:engine/view/view~View#change change block} and all\r\n\t * {@link module:engine/view/document~Document#registerPostFixer post-fixers} are executed.\r\n\t *\r\n\t * Actual rendering is performed as a first listener on 'normal' priority.\r\n\t *\r\n\t *\t\tview.on( 'render', () => {\r\n\t *\t\t\t// Rendering to the DOM is complete.\r\n\t *\t\t} );\r\n\t *\r\n\t * This event is useful when you want to update interface elements after the rendering, e.g. position of the\r\n\t * balloon panel. If you wants to change view structure use\r\n\t * {@link module:engine/view/document~Document#registerPostFixer post-fixers}.\r\n\t *\r\n\t * @event module:engine/view/view~View#event:render\r\n\t */\r\n}\r\n\r\nmix( View, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/tomap\r\n */\r\n\r\nimport objectToMap from './objecttomap';\r\nimport { isPlainObject } from 'lodash-es';\r\n\r\n/**\r\n * Transforms object or iterable to map. Iterable needs to be in the format acceptable by the `Map` constructor.\r\n *\r\n *\t\tmap = toMap( { 'foo': 1, 'bar': 2 } );\r\n *\t\tmap = toMap( [ [ 'foo', 1 ], [ 'bar', 2 ] ] );\r\n *\t\tmap = toMap( anotherMap );\r\n *\r\n * @param {Object|Iterable} data Object or iterable to transform.\r\n * @returns {Map} Map created from data.\r\n */\r\nexport default function toMap( data ) {\r\n\tif ( isPlainObject( data ) ) {\r\n\t\treturn objectToMap( data );\r\n\t} else {\r\n\t\treturn new Map( data );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/node\r\n */\r\n\r\nimport toMap from '@ckeditor/ckeditor5-utils/src/tomap';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\n\r\n/**\r\n * Model node. Most basic structure of model tree.\r\n *\r\n * This is an abstract class that is a base for other classes representing different nodes in model.\r\n *\r\n * **Note:** If a node is detached from the model tree, you can manipulate it using it's API.\r\n * However, it is **very important** that nodes already attached to model tree should be only changed through\r\n * {@link module:engine/model/writer~Writer Writer API}.\r\n *\r\n * Changes done by `Node` methods, like {@link module:engine/model/element~Element#_insertChild _insertChild} or\r\n * {@link module:engine/model/node~Node#_setAttribute _setAttribute}\r\n * do not generate {@link module:engine/model/operation/operation~Operation operations}\r\n * which are essential for correct editor work if you modify nodes in {@link module:engine/model/document~Document document} root.\r\n *\r\n * The flow of working on `Node` (and classes that inherits from it) is as such:\r\n * 1. You can create a `Node` instance, modify it using it's API.\r\n * 2. Add `Node` to the model using `Batch` API.\r\n * 3. Change `Node` that was already added to the model using `Batch` API.\r\n *\r\n * Similarly, you cannot use `Batch` API on a node that has not been added to the model tree, with the exception\r\n * of {@link module:engine/model/writer~Writer#insert inserting} that node to the model tree.\r\n *\r\n * Be aware that using {@link module:engine/model/writer~Writer#remove remove from Batch API} does not allow to use `Node` API because\r\n * the information about `Node` is still kept in model document.\r\n *\r\n * In case of {@link module:engine/model/element~Element element node}, adding and removing children also counts as changing a node and\r\n * follows same rules.\r\n */\r\nexport default class Node {\r\n\t/**\r\n\t * Creates a model node.\r\n\t *\r\n\t * This is an abstract class, so this constructor should not be used directly.\r\n\t *\r\n\t * @abstract\r\n\t * @param {Object} [attrs] Node's attributes. See {@link module:utils/tomap~toMap} for a list of accepted values.\r\n\t */\r\n\tconstructor( attrs ) {\r\n\t\t/**\r\n\t\t * Parent of this node. It could be {@link module:engine/model/element~Element}\r\n\t\t * or {@link module:engine/model/documentfragment~DocumentFragment}.\r\n\t\t * Equals to `null` if the node has no parent.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment|null}\r\n\t\t */\r\n\t\tthis.parent = null;\r\n\r\n\t\t/**\r\n\t\t * Attributes set on this node.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} module:engine/model/node~Node#_attrs\r\n\t\t */\r\n\t\tthis._attrs = toMap( attrs );\r\n\t}\r\n\r\n\t/**\r\n\t * Index of this node in it's parent or `null` if the node has no parent.\r\n\t *\r\n\t * Accessing this property throws an error if this node's parent element does not contain it.\r\n\t * This means that model tree got broken.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number|null}\r\n\t */\r\n\tget index() {\r\n\t\tlet pos;\r\n\r\n\t\tif ( !this.parent ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif ( ( pos = this.parent.getChildIndex( this ) ) === null ) {\r\n\t\t\tthrow new CKEditorError( 'model-node-not-found-in-parent: The node\\'s parent does not contain this node.' );\r\n\t\t}\r\n\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset at which this node starts in it's parent. It is equal to the sum of {@link #offsetSize offsetSize}\r\n\t * of all it's previous siblings. Equals to `null` if node has no parent.\r\n\t *\r\n\t * Accessing this property throws an error if this node's parent element does not contain it.\r\n\t * This means that model tree got broken.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number|null}\r\n\t */\r\n\tget startOffset() {\r\n\t\tlet pos;\r\n\r\n\t\tif ( !this.parent ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif ( ( pos = this.parent.getChildStartOffset( this ) ) === null ) {\r\n\t\t\tthrow new CKEditorError( 'model-node-not-found-in-parent: The node\\'s parent does not contain this node.' );\r\n\t\t}\r\n\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset size of this node. Represents how much \"offset space\" is occupied by the node in it's parent.\r\n\t * It is important for {@link module:engine/model/position~Position position}. When node has `offsetSize` greater than `1`, position\r\n\t * can be placed between that node start and end. `offsetSize` greater than `1` is for nodes that represents more\r\n\t * than one entity, i.e. {@link module:engine/model/text~Text text node}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget offsetSize() {\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset at which this node ends in it's parent. It is equal to the sum of this node's\r\n\t * {@link module:engine/model/node~Node#startOffset start offset} and {@link #offsetSize offset size}.\r\n\t * Equals to `null` if the node has no parent.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number|null}\r\n\t */\r\n\tget endOffset() {\r\n\t\tif ( !this.parent ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.startOffset + this.offsetSize;\r\n\t}\r\n\r\n\t/**\r\n\t * Node's next sibling or `null` if the node is a last child of it's parent or if the node has no parent.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/node~Node|null}\r\n\t */\r\n\tget nextSibling() {\r\n\t\tconst index = this.index;\r\n\r\n\t\treturn ( index !== null && this.parent.getChild( index + 1 ) ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Node's previous sibling or `null` if the node is a first child of it's parent or if the node has no parent.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/node~Node|null}\r\n\t */\r\n\tget previousSibling() {\r\n\t\tconst index = this.index;\r\n\r\n\t\treturn ( index !== null && this.parent.getChild( index - 1 ) ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * The top-most ancestor of the node. If node has no parent it is the root itself. If the node is a part\r\n\t * of {@link module:engine/model/documentfragment~DocumentFragment}, it's `root` is equal to that `DocumentFragment`.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/node~Node|module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\tlet root = this; // eslint-disable-line consistent-this\r\n\r\n\t\twhile ( root.parent ) {\r\n\t\t\troot = root.parent;\r\n\t\t}\r\n\r\n\t\treturn root;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/model/document~Document Document} that owns this node or `null` if the node has no parent or is inside\r\n\t * a {@link module:engine/model/documentfragment~DocumentFragment DocumentFragment}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/document~Document|null}\r\n\t */\r\n\tget document() {\r\n\t\t// This is a top element of a sub-tree.\r\n\t\tif ( this.root == this ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Root may be `DocumentFragment` which does not have document property.\r\n\t\treturn this.root.document || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets path to the node. The path is an array containing starting offsets of consecutive ancestors of this node,\r\n\t * beginning from {@link module:engine/model/node~Node#root root}, down to this node's starting offset. The path can be used to\r\n\t * create {@link module:engine/model/position~Position Position} instance.\r\n\t *\r\n\t *\t\tconst abc = new Text( 'abc' );\r\n\t *\t\tconst foo = new Text( 'foo' );\r\n\t *\t\tconst h1 = new Element( 'h1', null, new Text( 'header' ) );\r\n\t *\t\tconst p = new Element( 'p', null, [ abc, foo ] );\r\n\t *\t\tconst div = new Element( 'div', null, [ h1, p ] );\r\n\t *\t\tfoo.getPath(); // Returns [ 1, 3 ]. `foo` is in `p` which is in `div`. `p` starts at offset 1, while `foo` at 3.\r\n\t *\t\th1.getPath(); // Returns [ 0 ].\r\n\t *\t\tdiv.getPath(); // Returns [].\r\n\t *\r\n\t * @returns {Array.<Number>} The path.\r\n\t */\r\n\tgetPath() {\r\n\t\tconst path = [];\r\n\t\tlet node = this; // eslint-disable-line consistent-this\r\n\r\n\t\twhile ( node.parent ) {\r\n\t\t\tpath.unshift( node.startOffset );\r\n\t\t\tnode = node.parent;\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this node.\r\n\t *\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` this node will be also included in parent's array.\r\n\t * @param {Boolean} [options.parentFirst=false] When set to `true`, array will be sorted from node's parent to root element,\r\n\t * otherwise root element will be the first item in the array.\r\n\t * @returns {Array} Array with ancestors.\r\n\t */\r\n\tgetAncestors( options = { includeSelf: false, parentFirst: false } ) {\r\n\t\tconst ancestors = [];\r\n\t\tlet parent = options.includeSelf ? this : this.parent;\r\n\r\n\t\twhile ( parent ) {\r\n\t\t\tancestors[ options.parentFirst ? 'push' : 'unshift' ]( parent );\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn ancestors;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a {@link module:engine/model/element~Element} or {@link module:engine/model/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of both nodes.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node The second node.\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` both nodes will be considered \"ancestors\" too.\r\n\t * Which means that if e.g. node A is inside B, then their common ancestor will be B.\r\n\t * @returns {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor( node, options = {} ) {\r\n\t\tconst ancestorsA = this.getAncestors( options );\r\n\t\tconst ancestorsB = node.getAncestors( options );\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\twhile ( ancestorsA[ i ] == ancestorsB[ i ] && ancestorsA[ i ] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i === 0 ? null : ancestorsA[ i - 1 ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this node is before given node. `false` is returned if nodes are in different trees (for example,\r\n\t * in different {@link module:engine/model/documentfragment~DocumentFragment}s).\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Node to compare with.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisBefore( node ) {\r\n\t\t// Given node is not before this node if they are same.\r\n\t\tif ( this == node ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Return `false` if it is impossible to compare nodes.\r\n\t\tif ( this.root !== node.root ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst thisPath = this.getPath();\r\n\t\tconst nodePath = node.getPath();\r\n\r\n\t\tconst result = compareArrays( thisPath, nodePath );\r\n\r\n\t\tswitch ( result ) {\r\n\t\t\tcase 'prefix':\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tcase 'extension':\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn thisPath[ result ] < nodePath[ result ];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this node is after given node. `false` is returned if nodes are in different trees (for example,\r\n\t * in different {@link module:engine/model/documentfragment~DocumentFragment}s).\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Node to compare with.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tisAfter( node ) {\r\n\t\t// Given node is not before this node if they are same.\r\n\t\tif ( this == node ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Return `false` if it is impossible to compare nodes.\r\n\t\tif ( this.root !== node.root ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// In other cases, just check if the `node` is before, and return the opposite.\r\n\t\treturn !this.isBefore( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the node has an attribute with given key.\r\n\t *\r\n\t * @param {String} key Key of attribute to check.\r\n\t * @returns {Boolean} `true` if attribute with given key is set on node, `false` otherwise.\r\n\t */\r\n\thasAttribute( key ) {\r\n\t\treturn this._attrs.has( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an attribute value for given key or `undefined` if that attribute is not set on node.\r\n\t *\r\n\t * @param {String} key Key of attribute to look for.\r\n\t * @returns {*} Attribute value or `undefined`.\r\n\t */\r\n\tgetAttribute( key ) {\r\n\t\treturn this._attrs.get( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over this node's attributes.\r\n\t *\r\n\t * Attributes are returned as arrays containing two items. First one is attribute key and second is attribute value.\r\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\tgetAttributes() {\r\n\t\treturn this._attrs.entries();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over this node's attribute keys.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetAttributeKeys() {\r\n\t\treturn this._attrs.keys();\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `Node` to plain object and returns it.\r\n\t *\r\n\t * @returns {Object} `Node` converted to plain object.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = {};\r\n\r\n\t\t// Serializes attributes to the object.\r\n\t\t// attributes = { a: 'foo', b: 1, c: true }.\r\n\t\tif ( this._attrs.size ) {\r\n\t\t\tjson.attributes = Array.from( this._attrs ).reduce( ( result, attr ) => {\r\n\t\t\t\tresult[ attr[ 0 ] ] = attr[ 1 ];\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}, {} );\r\n\t\t}\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a copy of this node, that is a node with exactly same attributes, and returns it.\r\n\t *\r\n\t * @protected\r\n\t * @returns {module:engine/model/node~Node} Node with same attributes as this node.\r\n\t */\r\n\t_clone() {\r\n\t\treturn new Node( this._attrs );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes this node from it's parent.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#remove\r\n\t * @protected\r\n\t */\r\n\t_remove() {\r\n\t\tthis.parent._removeChildren( this.index );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets attribute on the node. If attribute with the same key already is set, it's value is overwritten.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#setAttribute\r\n\t * @protected\r\n\t * @param {String} key Key of attribute to set.\r\n\t * @param {*} value Attribute value.\r\n\t */\r\n\t_setAttribute( key, value ) {\r\n\t\tthis._attrs.set( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all attributes from the node and sets given attributes.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#setAttributes\r\n\t * @protected\r\n\t * @param {Object} [attrs] Attributes to set. See {@link module:utils/tomap~toMap} for a list of accepted values.\r\n\t */\r\n\t_setAttributesTo( attrs ) {\r\n\t\tthis._attrs = toMap( attrs );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute with given key from the node.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#removeAttribute\r\n\t * @protected\r\n\t * @param {String} key Key of attribute to remove.\r\n\t * @returns {Boolean} `true` if the attribute was set on the element, `false` otherwise.\r\n\t */\r\n\t_removeAttribute( key ) {\r\n\t\treturn this._attrs.delete( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all attributes from the node.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#clearAttributes\r\n\t * @protected\r\n\t */\r\n\t_clearAttributes() {\r\n\t\tthis._attrs.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given model tree object is of given type.\r\n\t *\r\n\t * This method is useful when processing model tree objects that are of unknown type. For example, a function\r\n\t * may return {@link module:engine/model/documentfragment~DocumentFragment} or {@link module:engine/model/node~Node}\r\n\t * that can be either text node or element. This method can be used to check what kind of object is returned.\r\n\t *\r\n\t *\t\tobj.is( 'node' ); // true for any node, false for document fragment and text fragment\r\n\t *\t\tobj.is( 'documentFragment' ); // true for document fragment, false for any node\r\n\t *\t\tobj.is( 'element' ); // true for any element, false for text node or document fragment\r\n\t *\t\tobj.is( 'element', 'paragraph' ); // true only for element which name is 'paragraph'\r\n\t *\t\tobj.is( 'paragraph' ); // shortcut for obj.is( 'element', 'paragraph' )\r\n\t *\t\tobj.is( 'text' ); // true for text node, false for element and document fragment\r\n\t *\t\tobj.is( 'textProxy' ); // true for text proxy object\r\n\t *\r\n\t * @method #is\r\n\t * @param {'element'|'rootElement'|'text'|'textProxy'|'documentFragment'} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'node';\r\n\t}\r\n}\r\n\r\n/**\r\n * The node's parent does not contain this node.\r\n *\r\n * This error may be thrown from corrupted trees.\r\n *\r\n * @error model-node-not-found-in-parent\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/text\r\n */\r\n\r\nimport Node from './node';\r\n\r\n/**\r\n * Model text node. Type of {@link module:engine/model/node~Node node} that contains {@link module:engine/model/text~Text#data text data}.\r\n *\r\n * **Important:** see {@link module:engine/model/node~Node} to read about restrictions using `Text` and `Node` API.\r\n *\r\n * **Note:** keep in mind that `Text` instances might indirectly got removed from model tree when model is changed.\r\n * This happens when {@link module:engine/model/writer~Writer model writer} is used to change model and the text node is merged with\r\n * another text node. Then, both text nodes are removed and a new text node is inserted into the model. Because of\r\n * this behavior, keeping references to `Text` is not recommended. Instead, consider creating\r\n * {@link module:engine/model/liveposition~LivePosition live position} placed before the text node.\r\n *\r\n * @extends {module:engine/model/node~Node}\r\n */\r\nexport default class Text extends Node {\r\n\t/**\r\n\t * Creates a text node.\r\n\t *\r\n\t * **Note:** Constructor of this class shouldn't be used directly in the code.\r\n\t * Use the {@link module:engine/model/writer~Writer#createText} method instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} data Node's text.\r\n\t * @param {Object} [attrs] Node's attributes. See {@link module:utils/tomap~toMap} for a list of accepted values.\r\n\t */\r\n\tconstructor( data, attrs ) {\r\n\t\tsuper( attrs );\r\n\r\n\t\t/**\r\n\t\t * Text data contained in this text node.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis._data = data || '';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget offsetSize() {\r\n\t\treturn this.data.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a text data contained in the node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {String}\r\n\t */\r\n\tget data() {\r\n\t\treturn this._data;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'text' || super.is( type );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `Text` instance to plain object and returns it.\r\n\t *\r\n\t * @returns {Object} `Text` instance converted to plain object.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.data = this.data;\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a copy of this text node and returns it. Created text node has same text data and attributes as original text node.\r\n\t *\r\n\t * @protected\r\n\t * @returns {module:engine/model/text~Text} `Text` instance created using given plain object.\r\n\t */\r\n\t_clone() {\r\n\t\treturn new Text( this.data, this.getAttributes() );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `Text` instance from given plain object (i.e. parsed JSON string).\r\n\t *\r\n\t * @param {Object} json Plain object to be converted to `Text`.\r\n\t * @returns {module:engine/model/text~Text} `Text` instance created using given plain object.\r\n\t */\r\n\tstatic fromJSON( json ) {\r\n\t\treturn new Text( json.data, json.attributes );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/textproxy\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * `TextProxy` represents a part of {@link module:engine/model/text~Text text node}.\r\n *\r\n * Since {@link module:engine/model/position~Position positions} can be placed between characters of a text node,\r\n * {@link module:engine/model/range~Range ranges} may contain only parts of text nodes. When {@link module:engine/model/range~Range#getItems\r\n * getting items}\r\n * contained in such range, we need to represent a part of that text node, since returning the whole text node would be incorrect.\r\n * `TextProxy` solves this issue.\r\n *\r\n * `TextProxy` has an API similar to {@link module:engine/model/text~Text Text} and allows to do most of the common tasks performed\r\n * on model nodes.\r\n *\r\n * **Note:** Some `TextProxy` instances may represent whole text node, not just a part of it.\r\n * See {@link module:engine/model/textproxy~TextProxy#isPartial}.\r\n *\r\n * **Note:** `TextProxy` is not an instance of {@link module:engine/model/node~Node node}. Keep this in mind when using it as a\r\n * parameter of methods.\r\n *\r\n * **Note:** `TextProxy` is a readonly interface. If you want to perform changes on model data represented by a `TextProxy`\r\n * use {@link module:engine/model/writer~Writer model writer API}.\r\n *\r\n * **Note:** `TextProxy` instances are created on the fly, basing on the current state of model. Because of this, it is\r\n * highly unrecommended to store references to `TextProxy` instances. `TextProxy` instances are not refreshed when\r\n * model changes, so they might get invalidated. Instead, consider creating {@link module:engine/model/liveposition~LivePosition live\r\n * position}.\r\n *\r\n * `TextProxy` instances are created by {@link module:engine/model/treewalker~TreeWalker model tree walker}. You should not need to create\r\n * an instance of this class by your own.\r\n */\r\nexport default class TextProxy {\r\n\t/**\r\n\t * Creates a text proxy.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/text~Text} textNode Text node which part is represented by this text proxy.\r\n\t * @param {Number} offsetInText Offset in {@link module:engine/model/textproxy~TextProxy#textNode text node} from which the text proxy\r\n\t * starts.\r\n\t * @param {Number} length Text proxy length, that is how many text node's characters, starting from `offsetInText` it represents.\r\n\t * @constructor\r\n\t */\r\n\tconstructor( textNode, offsetInText, length ) {\r\n\t\t/**\r\n\t\t * Text node which part is represented by this text proxy.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/text~Text}\r\n\t\t */\r\n\t\tthis.textNode = textNode;\r\n\r\n\t\tif ( offsetInText < 0 || offsetInText > textNode.offsetSize ) {\r\n\t\t\t/**\r\n\t\t\t * Given `offsetInText` value is incorrect.\r\n\t\t\t *\r\n\t\t\t * @error model-textproxy-wrong-offsetintext\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-textproxy-wrong-offsetintext: Given offsetInText value is incorrect.' );\r\n\t\t}\r\n\r\n\t\tif ( length < 0 || offsetInText + length > textNode.offsetSize ) {\r\n\t\t\t/**\r\n\t\t\t * Given `length` value is incorrect.\r\n\t\t\t *\r\n\t\t\t * @error model-textproxy-wrong-length\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-textproxy-wrong-length: Given length value is incorrect.' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Text data represented by this text proxy.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.data = textNode.data.substring( offsetInText, offsetInText + length );\r\n\r\n\t\t/**\r\n\t\t * Offset in {@link module:engine/model/textproxy~TextProxy#textNode text node} from which the text proxy starts.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.offsetInText = offsetInText;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset at which this text proxy starts in it's parent.\r\n\t *\r\n\t * @see module:engine/model/node~Node#startOffset\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget startOffset() {\r\n\t\treturn this.textNode.startOffset !== null ? this.textNode.startOffset + this.offsetInText : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset size of this text proxy. Equal to the number of characters represented by the text proxy.\r\n\t *\r\n\t * @see module:engine/model/node~Node#offsetSize\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget offsetSize() {\r\n\t\treturn this.data.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset at which this text proxy ends in it's parent.\r\n\t *\r\n\t * @see module:engine/model/node~Node#endOffset\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget endOffset() {\r\n\t\treturn this.startOffset !== null ? this.startOffset + this.offsetSize : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Flag indicating whether `TextProxy` instance covers only part of the original {@link module:engine/model/text~Text text node}\r\n\t * (`true`) or the whole text node (`false`).\r\n\t *\r\n\t * This is `false` when text proxy starts at the very beginning of {@link module:engine/model/textproxy~TextProxy#textNode textNode}\r\n\t * ({@link module:engine/model/textproxy~TextProxy#offsetInText offsetInText} equals `0`) and text proxy sizes is equal to\r\n\t * text node size.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isPartial() {\r\n\t\treturn this.offsetSize !== this.textNode.offsetSize;\r\n\t}\r\n\r\n\t/**\r\n\t * Parent of this text proxy, which is same as parent of text node represented by this text proxy.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tget parent() {\r\n\t\treturn this.textNode.parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Root of this text proxy, which is same as root of text node represented by this text proxy.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/node~Node|module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this.textNode.root;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/model/document~Document Document} that owns text node represented by this text proxy or `null` if the text node\r\n\t * has no parent or is inside a {@link module:engine/model/documentfragment~DocumentFragment DocumentFragment}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/document~Document|null}\r\n\t */\r\n\tget document() {\r\n\t\treturn this.textNode.document;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given model tree object is of given type.\r\n\t *\r\n\t * Read more in {@link module:engine/model/node~Node#is}.\r\n\t *\r\n\t * @param {String} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'textProxy';\r\n\t}\r\n\r\n\t/**\r\n\t * Gets path to this text proxy.\r\n\t *\r\n\t * @see module:engine/model/node~Node#getPath\r\n\t * @returns {Array.<Number>}\r\n\t */\r\n\tgetPath() {\r\n\t\tconst path = this.textNode.getPath();\r\n\r\n\t\tif ( path.length > 0 ) {\r\n\t\t\tpath[ path.length - 1 ] += this.offsetInText;\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this text proxy.\r\n\t *\r\n\t * @param {Object} options Options object.\r\n\t * @param {Boolean} [options.includeSelf=false] When set to `true` this text proxy will be also included in parent's array.\r\n\t * @param {Boolean} [options.parentFirst=false] When set to `true`, array will be sorted from text proxy parent to root element,\r\n\t * otherwise root element will be the first item in the array.\r\n\t * @returns {Array} Array with ancestors.\r\n\t */\r\n\tgetAncestors( options = { includeSelf: false, parentFirst: false } ) {\r\n\t\tconst ancestors = [];\r\n\t\tlet parent = options.includeSelf ? this : this.parent;\r\n\r\n\t\twhile ( parent ) {\r\n\t\t\tancestors[ options.parentFirst ? 'push' : 'unshift' ]( parent );\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn ancestors;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this text proxy has an attribute for given key.\r\n\t *\r\n\t * @param {String} key Key of attribute to check.\r\n\t * @returns {Boolean} `true` if attribute with given key is set on text proxy, `false` otherwise.\r\n\t */\r\n\thasAttribute( key ) {\r\n\t\treturn this.textNode.hasAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an attribute value for given key or `undefined` if that attribute is not set on text proxy.\r\n\t *\r\n\t * @param {String} key Key of attribute to look for.\r\n\t * @returns {*} Attribute value or `undefined`.\r\n\t */\r\n\tgetAttribute( key ) {\r\n\t\treturn this.textNode.getAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over this node's attributes. Attributes are returned as arrays containing two\r\n\t * items. First one is attribute key and second is attribute value.\r\n\t *\r\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\tgetAttributes() {\r\n\t\treturn this.textNode.getAttributes();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over this node's attribute keys.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetAttributeKeys() {\r\n\t\treturn this.textNode.getAttributeKeys();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/nodelist\r\n */\r\n\r\nimport Node from './node';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Provides an interface to operate on a list of {@link module:engine/model/node~Node nodes}. `NodeList` is used internally\r\n * in classes like {@link module:engine/model/element~Element Element}\r\n * or {@link module:engine/model/documentfragment~DocumentFragment DocumentFragment}.\r\n */\r\nexport default class NodeList {\r\n\t/**\r\n\t * Creates an empty node list.\r\n\t *\r\n\t * @protected\r\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes contained in this node list.\r\n\t */\r\n\tconstructor( nodes ) {\r\n\t\t/**\r\n\t\t * Nodes contained in this node list.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Array.<module:engine/model/node~Node>}\r\n\t\t */\r\n\t\tthis._nodes = [];\r\n\r\n\t\tif ( nodes ) {\r\n\t\t\tthis._insertNodes( 0, nodes );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over all nodes contained inside this node list.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/node~Node>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._nodes[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Number of nodes contained inside this node list.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget length() {\r\n\t\treturn this._nodes.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Sum of {@link module:engine/model/node~Node#offsetSize offset sizes} of all nodes contained inside this node list.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget maxOffset() {\r\n\t\treturn this._nodes.reduce( ( sum, node ) => sum + node.offsetSize, 0 );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the node at the given index. Returns `null` if incorrect index was passed.\r\n\t *\r\n\t * @param {Number} index Index of node.\r\n\t * @returns {module:engine/model/node~Node|null} Node at given index.\r\n\t */\r\n\tgetNode( index ) {\r\n\t\treturn this._nodes[ index ] || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an index of the given node. Returns `null` if given node is not inside this node list.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Child node to look for.\r\n\t * @returns {Number|null} Child node's index.\r\n\t */\r\n\tgetNodeIndex( node ) {\r\n\t\tconst index = this._nodes.indexOf( node );\r\n\r\n\t\treturn index == -1 ? null : index;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the starting offset of given node. Starting offset is equal to the sum of\r\n\t * {@link module:engine/model/node~Node#offsetSize offset sizes} of all nodes that are before this node in this node list.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Node to look for.\r\n\t * @returns {Number|null} Node's starting offset.\r\n\t */\r\n\tgetNodeStartOffset( node ) {\r\n\t\tconst index = this.getNodeIndex( node );\r\n\r\n\t\treturn index === null ? null : this._nodes.slice( 0, index ).reduce( ( sum, node ) => sum + node.offsetSize, 0 );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts index to offset in node list.\r\n\t *\r\n\t * Returns starting offset of a node that is at given index. Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError}\r\n\t * `model-nodelist-index-out-of-bounds` if given index is less than `0` or more than {@link #length}.\r\n\t *\r\n\t * @param {Number} index Node's index.\r\n\t * @returns {Number} Node's starting offset.\r\n\t */\r\n\tindexToOffset( index ) {\r\n\t\tif ( index == this._nodes.length ) {\r\n\t\t\treturn this.maxOffset;\r\n\t\t}\r\n\r\n\t\tconst node = this._nodes[ index ];\r\n\r\n\t\tif ( !node ) {\r\n\t\t\t/**\r\n\t\t\t * Given index cannot be found in the node list.\r\n\t\t\t *\r\n\t\t\t * @error nodelist-index-out-of-bounds\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-nodelist-index-out-of-bounds: Given index cannot be found in the node list.' );\r\n\t\t}\r\n\r\n\t\treturn this.getNodeStartOffset( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts offset in node list to index.\r\n\t *\r\n\t * Returns index of a node that occupies given offset. Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError}\r\n\t * `model-nodelist-offset-out-of-bounds` if given offset is less than `0` or more than {@link #maxOffset}.\r\n\t *\r\n\t * @param {Number} offset Offset to look for.\r\n\t * @returns {Number} Index of a node that occupies given offset.\r\n\t */\r\n\toffsetToIndex( offset ) {\r\n\t\tlet totalOffset = 0;\r\n\r\n\t\tfor ( const node of this._nodes ) {\r\n\t\t\tif ( offset >= totalOffset && offset < totalOffset + node.offsetSize ) {\r\n\t\t\t\treturn this.getNodeIndex( node );\r\n\t\t\t}\r\n\r\n\t\t\ttotalOffset += node.offsetSize;\r\n\t\t}\r\n\r\n\t\tif ( totalOffset != offset ) {\r\n\t\t\t/**\r\n\t\t\t * Given offset cannot be found in the node list.\r\n\t\t\t *\r\n\t\t\t * @error model-nodelist-offset-out-of-bounds\r\n\t\t\t * @param {Number} offset\r\n\t\t\t * @param {module:engine/model/nodelist~NodeList} nodeList Stringified node list.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-nodelist-offset-out-of-bounds: Given offset cannot be found in the node list.', {\r\n\t\t\t\toffset,\r\n\t\t\t\tnodeList: this\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn this.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts given nodes at given index.\r\n\t *\r\n\t * @protected\r\n\t * @param {Number} index Index at which nodes should be inserted.\r\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes to be inserted.\r\n\t */\r\n\t_insertNodes( index, nodes ) {\r\n\t\t// Validation.\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\tif ( !( node instanceof Node ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Trying to insert an object which is not a Node instance.\r\n\t\t\t\t *\r\n\t\t\t\t * @error nodelist-insertNodes-not-node\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'model-nodelist-insertNodes-not-node: Trying to insert an object which is not a Node instance.' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._nodes.splice( index, 0, ...nodes );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes one or more nodes starting at the given index.\r\n\t *\r\n\t * @protected\r\n\t * @param {Number} indexStart Index of the first node to remove.\r\n\t * @param {Number} [howMany=1] Number of nodes to remove.\r\n\t * @returns {Array.<module:engine/model/node~Node>} Array containing removed nodes.\r\n\t */\r\n\t_removeNodes( indexStart, howMany = 1 ) {\r\n\t\treturn this._nodes.splice( indexStart, howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `NodeList` instance to an array containing nodes that were inserted in the node list. Nodes\r\n\t * are also converted to their plain object representation.\r\n\t *\r\n\t * @returns {Array.<module:engine/model/node~Node>} `NodeList` instance converted to `Array`.\r\n\t */\r\n\ttoJSON() {\r\n\t\treturn this._nodes.map( node => node.toJSON() );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/element\r\n */\r\n\r\nimport Node from './node';\r\nimport NodeList from './nodelist';\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\n\r\n/**\r\n * Model element. Type of {@link module:engine/model/node~Node node} that has a {@link module:engine/model/element~Element#name name} and\r\n * {@link module:engine/model/element~Element#getChildren child nodes}.\r\n *\r\n * **Important**: see {@link module:engine/model/node~Node} to read about restrictions using `Element` and `Node` API.\r\n *\r\n * @extends {module:engine/model/node~Node}\r\n */\r\nexport default class Element extends Node {\r\n\t/**\r\n\t * Creates a model element.\r\n\t *\r\n\t * **Note:** Constructor of this class shouldn't be used directly in the code.\r\n\t * Use the {@link module:engine/model/writer~Writer#createElement} method instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} name Element's name.\r\n\t * @param {Object} [attrs] Element's attributes. See {@link module:utils/tomap~toMap} for a list of accepted values.\r\n\t * @param {module:engine/model/node~Node|Iterable.<module:engine/model/node~Node>} [children]\r\n\t * One or more nodes to be inserted as children of created element.\r\n\t */\r\n\tconstructor( name, attrs, children ) {\r\n\t\tsuper( attrs );\r\n\r\n\t\t/**\r\n\t\t * Element name.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} module:engine/model/element~Element#name\r\n\t\t */\r\n\t\tthis.name = name;\r\n\r\n\t\t/**\r\n\t\t * List of children nodes.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/nodelist~NodeList} module:engine/model/element~Element#_children\r\n\t\t */\r\n\t\tthis._children = new NodeList();\r\n\r\n\t\tif ( children ) {\r\n\t\t\tthis._insertChild( 0, children );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Number of this element's children.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget childCount() {\r\n\t\treturn this._children.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Sum of {@link module:engine/model/node~Node#offsetSize offset sizes} of all of this element's children.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget maxOffset() {\r\n\t\treturn this._children.maxOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if there are no nodes inside this element, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isEmpty() {\r\n\t\treturn this.childCount === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given model tree object is of given type.\r\n\t *\r\n\t *\t\tobj.name; // 'listItem'\r\n\t *\t\tobj instanceof Element; // true\r\n\t *\r\n\t *\t\tobj.is( 'element' ); // true\r\n\t *\t\tobj.is( 'listItem' ); // true\r\n\t *\t\tobj.is( 'element', 'listItem' ); // true\r\n\t *\t\tobj.is( 'text' ); // false\r\n\t *\t\tobj.is( 'element', 'image' ); // false\r\n\t *\r\n\t * Read more in {@link module:engine/model/node~Node#is}.\r\n\t *\r\n\t * @param {String} type Type to check when `name` parameter is present.\r\n\t * Otherwise, it acts like the `name` parameter.\r\n\t * @param {String} [name] Element name.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type, name = null ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'element' || type == this.name || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn type == 'element' && name == this.name;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the child at the given index.\r\n\t *\r\n\t * @param {Number} index Index of child.\r\n\t * @returns {module:engine/model/node~Node} Child node.\r\n\t */\r\n\tgetChild( index ) {\r\n\t\treturn this._children.getNode( index );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all of this element's children.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/node~Node>}\r\n\t */\r\n\tgetChildren() {\r\n\t\treturn this._children[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an index of the given child node. Returns `null` if given node is not a child of this element.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Child node to look for.\r\n\t * @returns {Number} Child node's index in this element.\r\n\t */\r\n\tgetChildIndex( node ) {\r\n\t\treturn this._children.getNodeIndex( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the starting offset of given child. Starting offset is equal to the sum of\r\n\t * {@link module:engine/model/node~Node#offsetSize offset sizes} of all node's siblings that are before it. Returns `null` if\r\n\t * given node is not a child of this element.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Child node to look for.\r\n\t * @returns {Number} Child node's starting offset.\r\n\t */\r\n\tgetChildStartOffset( node ) {\r\n\t\treturn this._children.getNodeStartOffset( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns index of a node that occupies given offset. If given offset is too low, returns `0`. If given offset is\r\n\t * too high, returns {@link module:engine/model/element~Element#getChildIndex index after last child}.\r\n\t *\r\n\t *\t\tconst textNode = new Text( 'foo' );\r\n\t *\t\tconst pElement = new Element( 'p' );\r\n\t *\t\tconst divElement = new Element( [ textNode, pElement ] );\r\n\t *\t\tdivElement.offsetToIndex( -1 ); // Returns 0, because offset is too low.\r\n\t *\t\tdivElement.offsetToIndex( 0 ); // Returns 0, because offset 0 is taken by `textNode` which is at index 0.\r\n\t *\t\tdivElement.offsetToIndex( 1 ); // Returns 0, because `textNode` has `offsetSize` equal to 3, so it occupies offset 1 too.\r\n\t *\t\tdivElement.offsetToIndex( 2 ); // Returns 0.\r\n\t *\t\tdivElement.offsetToIndex( 3 ); // Returns 1.\r\n\t *\t\tdivElement.offsetToIndex( 4 ); // Returns 2. There are no nodes at offset 4, so last available index is returned.\r\n\t *\r\n\t * @param {Number} offset Offset to look for.\r\n\t * @returns {Number}\r\n\t */\r\n\toffsetToIndex( offset ) {\r\n\t\treturn this._children.offsetToIndex( offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a descendant node by its path relative to this element.\r\n\t *\r\n\t *\t\t// <this>a<b>c</b></this>\r\n\t *\t\tthis.getNodeByPath( [ 0 ] );     // -> \"a\"\r\n\t *\t\tthis.getNodeByPath( [ 1 ] );     // -> <b>\r\n\t *\t\tthis.getNodeByPath( [ 1, 0 ] );  // -> \"c\"\r\n\t *\r\n\t * @param {Array.<Number>} relativePath Path of the node to find, relative to this element.\r\n\t * @returns {module:engine/model/node~Node}\r\n\t */\r\n\tgetNodeByPath( relativePath ) {\r\n\t\tlet node = this; // eslint-disable-line consistent-this\r\n\r\n\t\tfor ( const index of relativePath ) {\r\n\t\t\tnode = node.getChild( node.offsetToIndex( index ) );\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `Element` instance to plain object and returns it. Takes care of converting all of this element's children.\r\n\t *\r\n\t * @returns {Object} `Element` instance converted to plain object.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.name = this.name;\r\n\r\n\t\tif ( this._children.length > 0 ) {\r\n\t\t\tjson.children = [];\r\n\r\n\t\t\tfor ( const node of this._children ) {\r\n\t\t\t\tjson.children.push( node.toJSON() );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a copy of this element and returns it. Created element has the same name and attributes as the original element.\r\n\t * If clone is deep, the original element's children are also cloned. If not, then empty element is removed.\r\n\t *\r\n\t * @protected\r\n\t * @param {Boolean} [deep=false] If set to `true` clones element and all its children recursively. When set to `false`,\r\n\t * element will be cloned without any child.\r\n\t */\r\n\t_clone( deep = false ) {\r\n\t\tconst children = deep ? Array.from( this._children ).map( node => node._clone( true ) ) : null;\r\n\r\n\t\treturn new Element( this.name, this.getAttributes(), children );\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/model/element~Element#_insertChild Inserts} one or more nodes at the end of this element.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#append\r\n\t * @protected\r\n\t * @param {module:engine/model/item~Item|Iterable.<module:engine/model/item~Item>} nodes Nodes to be inserted.\r\n\t */\r\n\t_appendChild( nodes ) {\r\n\t\tthis._insertChild( this.childCount, nodes );\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts one or more nodes at the given index and sets {@link module:engine/model/node~Node#parent parent} of these nodes\r\n\t * to this element.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#insert\r\n\t * @protected\r\n\t * @param {Number} index Index at which nodes should be inserted.\r\n\t * @param {module:engine/model/item~Item|Iterable.<module:engine/model/item~Item>} items Items to be inserted.\r\n\t */\r\n\t_insertChild( index, items ) {\r\n\t\tconst nodes = normalize( items );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\t// If node that is being added to this element is already inside another element, first remove it from the old parent.\r\n\t\t\tif ( node.parent !== null ) {\r\n\t\t\t\tnode._remove();\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = this;\r\n\t\t}\r\n\r\n\t\tthis._children._insertNodes( index, nodes );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes one or more nodes starting at the given index and sets\r\n\t * {@link module:engine/model/node~Node#parent parent} of these nodes to `null`.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#remove\r\n\t * @protected\r\n\t * @param {Number} index Index of the first node to remove.\r\n\t * @param {Number} [howMany=1] Number of nodes to remove.\r\n\t * @returns {Array.<module:engine/model/node~Node>} Array containing removed nodes.\r\n\t */\r\n\t_removeChildren( index, howMany = 1 ) {\r\n\t\tconst nodes = this._children._removeNodes( index, howMany );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\tnode.parent = null;\r\n\t\t}\r\n\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an `Element` instance from given plain object (i.e. parsed JSON string).\r\n\t * Converts `Element` children to proper nodes.\r\n\t *\r\n\t * @param {Object} json Plain object to be converted to `Element`.\r\n\t * @returns {module:engine/model/element~Element} `Element` instance created using given plain object.\r\n\t */\r\n\tstatic fromJSON( json ) {\r\n\t\tlet children = null;\r\n\r\n\t\tif ( json.children ) {\r\n\t\t\tchildren = [];\r\n\r\n\t\t\tfor ( const child of json.children ) {\r\n\t\t\t\tif ( child.name ) {\r\n\t\t\t\t\t// If child has name property, it is an Element.\r\n\t\t\t\t\tchildren.push( Element.fromJSON( child ) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Otherwise, it is a Text node.\r\n\t\t\t\t\tchildren.push( Text.fromJSON( child ) );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new Element( json.name, json.attributes, children );\r\n\t}\r\n}\r\n\r\n// Converts strings to Text and non-iterables to arrays.\r\n//\r\n// @param {String|module:engine/model/item~Item|Iterable.<String|module:engine/model/item~Item>}\r\n// @returns {Iterable.<module:engine/model/node~Node>}\r\nfunction normalize( nodes ) {\r\n\t// Separate condition because string is iterable.\r\n\tif ( typeof nodes == 'string' ) {\r\n\t\treturn [ new Text( nodes ) ];\r\n\t}\r\n\r\n\tif ( !isIterable( nodes ) ) {\r\n\t\tnodes = [ nodes ];\r\n\t}\r\n\r\n\t// Array.from to enable .map() on non-arrays.\r\n\treturn Array.from( nodes )\r\n\t\t.map( node => {\r\n\t\t\tif ( typeof node == 'string' ) {\r\n\t\t\t\treturn new Text( node );\r\n\t\t\t}\r\n\r\n\t\t\tif ( node instanceof TextProxy ) {\r\n\t\t\t\treturn new Text( node.data, node.getAttributes() );\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/treewalker\r\n */\r\n\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport Element from './element';\r\nimport Position from './position';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Position iterator class. It allows to iterate forward and backward over the document.\r\n */\r\nexport default class TreeWalker {\r\n\t/**\r\n\t * Creates a range iterator. All parameters are optional, but you have to specify either `boundaries` or `startPosition`.\r\n\t *\r\n\t * @constructor\r\n\t * @param {Object} [options={}] Object with configuration.\r\n\t * @param {'forward'|'backward'} [options.direction='forward'] Walking direction.\r\n\t * @param {module:engine/model/range~Range} [options.boundaries=null] Range to define boundaries of the iterator.\r\n\t * @param {module:engine/model/position~Position} [options.startPosition] Starting position.\r\n\t * @param {Boolean} [options.singleCharacters=false] Flag indicating whether all consecutive characters with the same attributes\r\n\t * should be returned one by one as multiple {@link module:engine/model/textproxy~TextProxy} (`true`) objects or as one\r\n\t * {@link module:engine/model/textproxy~TextProxy} (`false`).\r\n\t * @param {Boolean} [options.shallow=false] Flag indicating whether iterator should enter elements or not. If the\r\n\t * iterator is shallow child nodes of any iterated node will not be returned along with `elementEnd` tag.\r\n\t * @param {Boolean} [options.ignoreElementEnd=false] Flag indicating whether iterator should ignore `elementEnd`\r\n\t * tags. If the option is true walker will not return a parent node of start position. If this option is `true`\r\n\t * each {@link module:engine/model/element~Element} will be returned once, while if the option is `false` they might be returned\r\n\t * twice: for `'elementStart'` and `'elementEnd'`.\r\n\t */\r\n\tconstructor( options = {} ) {\r\n\t\tif ( !options.boundaries && !options.startPosition ) {\r\n\t\t\t/**\r\n\t\t\t * Neither boundaries nor starting position of a `TreeWalker` have been defined.\r\n\t\t\t *\r\n\t\t\t * @error model-tree-walker-no-start-position\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-tree-walker-no-start-position: Neither boundaries nor starting position have been defined.' );\r\n\t\t}\r\n\r\n\t\tconst direction = options.direction || 'forward';\r\n\r\n\t\tif ( direction != 'forward' && direction != 'backward' ) {\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'model-tree-walker-unknown-direction: Only `backward` and `forward` direction allowed.',\r\n\t\t\t\t{ direction }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Walking direction. Defaults `'forward'`.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {'backward'|'forward'} module:engine/model/treewalker~TreeWalker#direction\r\n\t\t */\r\n\t\tthis.direction = direction;\r\n\r\n\t\t/**\r\n\t\t * Iterator boundaries.\r\n\t\t *\r\n\t\t * When the iterator is walking `'forward'` on the end of boundary or is walking `'backward'`\r\n\t\t * on the start of boundary, then `{ done: true }` is returned.\r\n\t\t *\r\n\t\t * If boundaries are not defined they are set before first and after last child of the root node.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/range~Range} module:engine/model/treewalker~TreeWalker#boundaries\r\n\t\t */\r\n\t\tthis.boundaries = options.boundaries || null;\r\n\r\n\t\t/**\r\n\t\t * Iterator position. This is always static position, even if the initial position was a\r\n\t\t * {@link module:engine/model/liveposition~LivePosition live position}. If start position is not defined then position depends\r\n\t\t * on {@link #direction}. If direction is `'forward'` position starts form the beginning, when direction\r\n\t\t * is `'backward'` position starts from the end.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/treewalker~TreeWalker#position\r\n\t\t */\r\n\t\tif ( options.startPosition ) {\r\n\t\t\tthis.position = options.startPosition.clone();\r\n\t\t} else {\r\n\t\t\tthis.position = Position._createAt( this.boundaries[ this.direction == 'backward' ? 'end' : 'start' ] );\r\n\t\t}\r\n\r\n\t\t// Reset position stickiness in case it was set to other value, as the stickiness is kept after cloning.\r\n\t\tthis.position.stickiness = 'toNone';\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether all consecutive characters with the same attributes should be\r\n\t\t * returned as one {@link module:engine/model/textproxy~TextProxy} (`true`) or one by one (`false`).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/model/treewalker~TreeWalker#singleCharacters\r\n\t\t */\r\n\t\tthis.singleCharacters = !!options.singleCharacters;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether iterator should enter elements or not. If the iterator is shallow child nodes of any\r\n\t\t * iterated node will not be returned along with `elementEnd` tag.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/model/treewalker~TreeWalker#shallow\r\n\t\t */\r\n\t\tthis.shallow = !!options.shallow;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether iterator should ignore `elementEnd` tags. If the option is true walker will not\r\n\t\t * return a parent node of the start position. If this option is `true` each {@link module:engine/model/element~Element} will\r\n\t\t * be returned once, while if the option is `false` they might be returned twice:\r\n\t\t * for `'elementStart'` and `'elementEnd'`.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} module:engine/model/treewalker~TreeWalker#ignoreElementEnd\r\n\t\t */\r\n\t\tthis.ignoreElementEnd = !!options.ignoreElementEnd;\r\n\r\n\t\t/**\r\n\t\t * Start boundary cached for optimization purposes.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/element~Element} module:engine/model/treewalker~TreeWalker#_boundaryStartParent\r\n\t\t */\r\n\t\tthis._boundaryStartParent = this.boundaries ? this.boundaries.start.parent : null;\r\n\r\n\t\t/**\r\n\t\t * End boundary cached for optimization purposes.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/element~Element} module:engine/model/treewalker~TreeWalker#_boundaryEndParent\r\n\t\t */\r\n\t\tthis._boundaryEndParent = this.boundaries ? this.boundaries.end.parent : null;\r\n\r\n\t\t/**\r\n\t\t * Parent of the most recently visited node. Cached for optimization purposes.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment}\r\n\t\t * module:engine/model/treewalker~TreeWalker#_visitedParent\r\n\t\t */\r\n\t\tthis._visitedParent = this.position.parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/treewalker~TreeWalkerValue>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link #position} in the {@link #direction} skipping values as long as the callback function returns `true`.\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t * \t\twalker.skip( value => value.type == 'text' ); // <paragraph>[]foo</paragraph> -> <paragraph>foo[]</paragraph>\r\n\t * \t\twalker.skip( () => true ); // Move the position to the end: <paragraph>[]foo</paragraph> -> <paragraph>foo</paragraph>[]\r\n\t * \t\twalker.skip( () => false ); // Do not move the position.\r\n\t *\r\n\t * @param {Function} skip Callback function. Gets {@link module:engine/model/treewalker~TreeWalkerValue} and should\r\n\t * return `true` if the value should be skipped or `false` if not.\r\n\t */\r\n\tskip( skip ) {\r\n\t\tlet done, value, prevPosition, prevVisitedParent;\r\n\r\n\t\tdo {\r\n\t\t\tprevPosition = this.position;\r\n\t\t\tprevVisitedParent = this._visitedParent;\r\n\r\n\t\t\t( { done, value } = this.next() );\r\n\t\t} while ( !done && skip( value ) );\r\n\r\n\t\tif ( !done ) {\r\n\t\t\tthis.position = prevPosition;\r\n\t\t\tthis._visitedParent = prevVisitedParent;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next tree walker's value.\r\n\t *\r\n\t * @returns {module:engine/model/treewalker~TreeWalkerValue} Next tree walker's value.\r\n\t */\r\n\tnext() {\r\n\t\tif ( this.direction == 'forward' ) {\r\n\t\t\treturn this._next();\r\n\t\t} else {\r\n\t\t\treturn this._previous();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a step forward in model. Moves the {@link #position} to the next position and returns the encountered value.\r\n\t *\r\n\t * @private\r\n\t * @returns {Object}\r\n\t * @returns {Boolean} return.done True if iterator is done.\r\n\t * @returns {module:engine/model/treewalker~TreeWalkerValue} return.value Information about taken step.\r\n\t */\r\n\t_next() {\r\n\t\tconst previousPosition = this.position;\r\n\t\tconst position = this.position.clone();\r\n\t\tconst parent = this._visitedParent;\r\n\r\n\t\t// We are at the end of the root.\r\n\t\tif ( parent.parent === null && position.offset === parent.maxOffset ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// We reached the walker boundary.\r\n\t\tif ( parent === this._boundaryEndParent && position.offset == this.boundaries.end.offset ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\tconst node = position.textNode ? position.textNode : position.nodeAfter;\r\n\r\n\t\tif ( node instanceof Element ) {\r\n\t\t\tif ( !this.shallow ) {\r\n\t\t\t\t// Manual operations on path internals for optimization purposes. Here and in the rest of the method.\r\n\t\t\t\tposition.path.push( 0 );\r\n\t\t\t\tthis._visitedParent = node;\r\n\t\t\t} else {\r\n\t\t\t\tposition.offset++;\r\n\t\t\t}\r\n\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn formatReturnValue( 'elementStart', node, previousPosition, position, 1 );\r\n\t\t} else if ( node instanceof Text ) {\r\n\t\t\tlet charactersCount;\r\n\r\n\t\t\tif ( this.singleCharacters ) {\r\n\t\t\t\tcharactersCount = 1;\r\n\t\t\t} else {\r\n\t\t\t\tlet offset = node.endOffset;\r\n\r\n\t\t\t\tif ( this._boundaryEndParent == parent && this.boundaries.end.offset < offset ) {\r\n\t\t\t\t\toffset = this.boundaries.end.offset;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcharactersCount = offset - position.offset;\r\n\t\t\t}\r\n\r\n\t\t\tconst offsetInTextNode = position.offset - node.startOffset;\r\n\t\t\tconst item = new TextProxy( node, offsetInTextNode, charactersCount );\r\n\r\n\t\t\tposition.offset += charactersCount;\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn formatReturnValue( 'text', item, previousPosition, position, charactersCount );\r\n\t\t} else {\r\n\t\t\t// `node` is not set, we reached the end of current `parent`.\r\n\t\t\tposition.path.pop();\r\n\t\t\tposition.offset++;\r\n\t\t\tthis.position = position;\r\n\t\t\tthis._visitedParent = parent.parent;\r\n\r\n\t\t\tif ( this.ignoreElementEnd ) {\r\n\t\t\t\treturn this._next();\r\n\t\t\t} else {\r\n\t\t\t\treturn formatReturnValue( 'elementEnd', parent, previousPosition, position );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a step backward in model. Moves the {@link #position} to the previous position and returns the encountered value.\r\n\t *\r\n\t * @private\r\n\t * @returns {Object}\r\n\t * @returns {Boolean} return.done True if iterator is done.\r\n\t * @returns {module:engine/model/treewalker~TreeWalkerValue} return.value Information about taken step.\r\n\t */\r\n\t_previous() {\r\n\t\tconst previousPosition = this.position;\r\n\t\tconst position = this.position.clone();\r\n\t\tconst parent = this._visitedParent;\r\n\r\n\t\t// We are at the beginning of the root.\r\n\t\tif ( parent.parent === null && position.offset === 0 ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// We reached the walker boundary.\r\n\t\tif ( parent == this._boundaryStartParent && position.offset == this.boundaries.start.offset ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// Get node just before current position\r\n\t\tconst node = position.textNode ? position.textNode : position.nodeBefore;\r\n\r\n\t\tif ( node instanceof Element ) {\r\n\t\t\tposition.offset--;\r\n\r\n\t\t\tif ( !this.shallow ) {\r\n\t\t\t\tposition.path.push( node.maxOffset );\r\n\t\t\t\tthis.position = position;\r\n\t\t\t\tthis._visitedParent = node;\r\n\r\n\t\t\t\tif ( this.ignoreElementEnd ) {\r\n\t\t\t\t\treturn this._previous();\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn formatReturnValue( 'elementEnd', node, previousPosition, position );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.position = position;\r\n\r\n\t\t\t\treturn formatReturnValue( 'elementStart', node, previousPosition, position, 1 );\r\n\t\t\t}\r\n\t\t} else if ( node instanceof Text ) {\r\n\t\t\tlet charactersCount;\r\n\r\n\t\t\tif ( this.singleCharacters ) {\r\n\t\t\t\tcharactersCount = 1;\r\n\t\t\t} else {\r\n\t\t\t\tlet offset = node.startOffset;\r\n\r\n\t\t\t\tif ( this._boundaryStartParent == parent && this.boundaries.start.offset > offset ) {\r\n\t\t\t\t\toffset = this.boundaries.start.offset;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcharactersCount = position.offset - offset;\r\n\t\t\t}\r\n\r\n\t\t\tconst offsetInTextNode = position.offset - node.startOffset;\r\n\t\t\tconst item = new TextProxy( node, offsetInTextNode - charactersCount, charactersCount );\r\n\r\n\t\t\tposition.offset -= charactersCount;\r\n\t\t\tthis.position = position;\r\n\r\n\t\t\treturn formatReturnValue( 'text', item, previousPosition, position, charactersCount );\r\n\t\t} else {\r\n\t\t\t// `node` is not set, we reached the beginning of current `parent`.\r\n\t\t\tposition.path.pop();\r\n\t\t\tthis.position = position;\r\n\t\t\tthis._visitedParent = parent.parent;\r\n\r\n\t\t\treturn formatReturnValue( 'elementStart', parent, previousPosition, position, 1 );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction formatReturnValue( type, item, previousPosition, nextPosition, length ) {\r\n\treturn {\r\n\t\tdone: false,\r\n\t\tvalue: {\r\n\t\t\ttype,\r\n\t\t\titem,\r\n\t\t\tpreviousPosition,\r\n\t\t\tnextPosition,\r\n\t\t\tlength\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Type of the step made by {@link module:engine/model/treewalker~TreeWalker}.\r\n * Possible values: `'elementStart'` if walker is at the beginning of a node, `'elementEnd'` if walker is at the end of node,\r\n * `'character'` if walker traversed over a character, or `'text'` if walker traversed over multiple characters (available in\r\n * character merging mode, see {@link module:engine/model/treewalker~TreeWalker#constructor}).\r\n *\r\n * @typedef {'elementStart'|'elementEnd'|'character'|'text'} module:engine/model/treewalker~TreeWalkerValueType\r\n */\r\n\r\n/**\r\n * Object returned by {@link module:engine/model/treewalker~TreeWalker} when traversing tree model.\r\n *\r\n * @typedef {Object} module:engine/model/treewalker~TreeWalkerValue\r\n * @property {module:engine/model/treewalker~TreeWalkerValueType} type\r\n * @property {module:engine/model/item~Item} item Item between old and new positions of {@link module:engine/model/treewalker~TreeWalker}.\r\n * @property {module:engine/model/position~Position} previousPosition Previous position of the iterator.\r\n * * Forward iteration: For `'elementEnd'` it is the last position inside the element. For all other types it is the\r\n * position before the item.\r\n * * Backward iteration: For `'elementStart'` it is the first position inside the element. For all other types it is\r\n * the position after item.\r\n * @property {module:engine/model/position~Position} nextPosition Next position of the iterator.\r\n * * Forward iteration: For `'elementStart'` it is the first position inside the element. For all other types it is\r\n * the position after the item.\r\n * * Backward iteration: For `'elementEnd'` it is last position inside element. For all other types it is the position\r\n * before the item.\r\n * @property {Number} [length] Length of the item. For `'elementStart'` and `'character'` it is 1. For `'text'` it is\r\n * the length of the text. For `'elementEnd'` it is `undefined`.\r\n */\r\n\r\n/**\r\n * Tree walking directions.\r\n *\r\n * @typedef {'forward'|'backward'} module:engine/view/treewalker~TreeWalkerDirection\r\n */\r\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nexport default last;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/position\r\n */\r\n\r\nimport TreeWalker from './treewalker';\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport Text from './text';\r\nimport { last } from 'lodash-es';\r\n\r\n/**\r\n * Represents a position in the model tree.\r\n *\r\n * A position is represented by its {@link module:engine/model/position~Position#root} and\r\n * a {@link module:engine/model/position~Position#path} in that root.\r\n *\r\n * You can create position instances via its constructor or the `createPosition*()` factory methods of\r\n * {@link module:engine/model/model~Model} and {@link module:engine/model/writer~Writer}.\r\n *\r\n * **Note:** Position is based on offsets, not indexes. This means that a position between two text nodes\r\n * `foo` and `bar` has offset `3`, not `1`. See {@link module:engine/model/position~Position#path} for more information.\r\n *\r\n * Since a position in the model is represented by a {@link module:engine/model/position~Position#root position root} and\r\n * {@link module:engine/model/position~Position#path position path} it is possible to create positions placed in non-existing places.\r\n * This requirement is important for operational transformation algorithms.\r\n *\r\n * Also, {@link module:engine/model/operation/operation~Operation operations}\r\n * kept in the {@link module:engine/model/document~Document#history document history}\r\n * are storing positions (and ranges) which were correct when those operations were applied, but may not be correct\r\n * after the document has changed.\r\n *\r\n * When changes are applied to the model, it may also happen that {@link module:engine/model/position~Position#parent position parent}\r\n * will change even if position path has not changed. Keep in mind, that if a position leads to non-existing element,\r\n * {@link module:engine/model/position~Position#parent} and some other properties and methods will throw errors.\r\n *\r\n * In most cases, position with wrong path is caused by an error in code, but it is sometimes needed, as described above.\r\n */\r\nexport default class Position {\r\n\t/**\r\n\t * Creates a position.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} root Root of the position.\r\n\t * @param {Array.<Number>} path Position path. See {@link module:engine/model/position~Position#path}.\r\n\t * @param {module:engine/model/position~PositionStickiness} [stickiness='toNone'] Position stickiness.\r\n\t * See {@link module:engine/model/position~PositionStickiness}.\r\n\t */\r\n\tconstructor( root, path, stickiness = 'toNone' ) {\r\n\t\tif ( !root.is( 'element' ) && !root.is( 'documentFragment' ) ) {\r\n\t\t\t/**\r\n\t\t\t * Position root is invalid.\r\n\t\t\t *\r\n\t\t\t * Positions can only be anchored in elements or document fragments.\r\n\t\t\t *\r\n\t\t\t * @error model-position-root-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-position-root-invalid: Position root invalid.' );\r\n\t\t}\r\n\r\n\t\tif ( !( path instanceof Array ) || path.length === 0 ) {\r\n\t\t\t/**\r\n\t\t\t * Position path must be an array with at least one item.\r\n\t\t\t *\r\n\t\t\t * @error model-position-path-incorrect\r\n\t\t\t * @param path\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-position-path-incorrect: Position path must be an array with at least one item.', { path } );\r\n\t\t}\r\n\r\n\t\t// Normalize the root and path (if element was passed).\r\n\t\tpath = root.getPath().concat( path );\r\n\t\troot = root.root;\r\n\r\n\t\t/**\r\n\t\t * Root of the position path.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment}\r\n\t\t * module:engine/model/position~Position#root\r\n\t\t */\r\n\t\tthis.root = root;\r\n\r\n\t\t/**\r\n\t\t * Position of the node in the tree. **Path contains offsets, not indexes.**\r\n\t\t *\r\n\t\t * Position can be placed before, after or in a {@link module:engine/model/node~Node node} if that node has\r\n\t\t * {@link module:engine/model/node~Node#offsetSize} greater than `1`. Items in position path are\r\n\t\t * {@link module:engine/model/node~Node#startOffset starting offsets} of position ancestors, starting from direct root children,\r\n\t\t * down to the position offset in it's parent.\r\n\t\t *\r\n\t\t *\t\t ROOT\r\n\t\t *\t\t  |- P            before: [ 0 ]         after: [ 1 ]\r\n\t\t *\t\t  |- UL           before: [ 1 ]         after: [ 2 ]\r\n\t\t *\t\t     |- LI        before: [ 1, 0 ]      after: [ 1, 1 ]\r\n\t\t *\t\t     |  |- foo    before: [ 1, 0, 0 ]   after: [ 1, 0, 3 ]\r\n\t\t *\t\t     |- LI        before: [ 1, 1 ]      after: [ 1, 2 ]\r\n\t\t *\t\t        |- bar    before: [ 1, 1, 0 ]   after: [ 1, 1, 3 ]\r\n\t\t *\r\n\t\t * `foo` and `bar` are representing {@link module:engine/model/text~Text text nodes}. Since text nodes has offset size\r\n\t\t * greater than `1` you can place position offset between their start and end:\r\n\t\t *\r\n\t\t *\t\t ROOT\r\n\t\t *\t\t  |- P\r\n\t\t *\t\t  |- UL\r\n\t\t *\t\t     |- LI\r\n\t\t *\t\t     |  |- f^o|o  ^ has path: [ 1, 0, 1 ]   | has path: [ 1, 0, 2 ]\r\n\t\t *\t\t     |- LI\r\n\t\t *\t\t        |- b^a|r  ^ has path: [ 1, 1, 1 ]   | has path: [ 1, 1, 2 ]\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<Number>} module:engine/model/position~Position#path\r\n\t\t */\r\n\t\tthis.path = path;\r\n\r\n\t\t/**\r\n\t\t * Position stickiness. See {@link module:engine/model/position~PositionStickiness}.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~PositionStickiness} module:engine/model/position~Position#stickiness\r\n\t\t */\r\n\t\tthis.stickiness = stickiness;\r\n\t}\r\n\r\n\t/**\r\n\t * Offset at which this position is located in its {@link module:engine/model/position~Position#parent parent}. It is equal\r\n\t * to the last item in position {@link module:engine/model/position~Position#path path}.\r\n\t *\r\n\t * @type {Number}\r\n\t */\r\n\tget offset() {\r\n\t\treturn last( this.path );\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Number} newOffset\r\n\t */\r\n\tset offset( newOffset ) {\r\n\t\tthis.path[ this.path.length - 1 ] = newOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Parent element of this position.\r\n\t *\r\n\t * Keep in mind that `parent` value is calculated when the property is accessed.\r\n\t * If {@link module:engine/model/position~Position#path position path}\r\n\t * leads to a non-existing element, `parent` property will throw error.\r\n\t *\r\n\t * Also it is a good idea to cache `parent` property if it is used frequently in an algorithm (i.e. in a long loop).\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/element~Element}\r\n\t */\r\n\tget parent() {\r\n\t\tlet parent = this.root;\r\n\r\n\t\tfor ( let i = 0; i < this.path.length - 1; i++ ) {\r\n\t\t\tparent = parent.getChild( parent.offsetToIndex( this.path[ i ] ) );\r\n\t\t}\r\n\r\n\t\treturn parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Position {@link module:engine/model/position~Position#offset offset} converted to an index in position's parent node. It is\r\n\t * equal to the {@link module:engine/model/node~Node#index index} of a node after this position. If position is placed\r\n\t * in text node, position index is equal to the index of that text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget index() {\r\n\t\treturn this.parent.offsetToIndex( this.offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns {@link module:engine/model/text~Text text node} instance in which this position is placed or `null` if this\r\n\t * position is not in a text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/text~Text|null}\r\n\t */\r\n\tget textNode() {\r\n\t\tconst node = this.parent.getChild( this.index );\r\n\r\n\t\treturn ( node instanceof Text && node.startOffset < this.offset ) ? node : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Node directly after this position or `null` if this position is in text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/node~Node|null}\r\n\t */\r\n\tget nodeAfter() {\r\n\t\treturn this.textNode === null ? this.parent.getChild( this.index ) : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Node directly before this position or `null` if this position is in text node.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Node}\r\n\t */\r\n\tget nodeBefore() {\r\n\t\treturn this.textNode === null ? this.parent.getChild( this.index - 1 ) : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if position is at the beginning of its {@link module:engine/model/position~Position#parent parent}, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isAtStart() {\r\n\t\treturn this.offset === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if position is at the end of its {@link module:engine/model/position~Position#parent parent}, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isAtEnd() {\r\n\t\treturn this.offset == this.parent.maxOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is before or after given position.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/position~Position} otherPosition Position to compare with.\r\n\t * @returns {module:engine/model/position~PositionRelation}\r\n\t */\r\n\tcompareWith( otherPosition ) {\r\n\t\tif ( this.root != otherPosition.root ) {\r\n\t\t\treturn 'different';\r\n\t\t}\r\n\r\n\t\tconst result = compareArrays( this.path, otherPosition.path );\r\n\r\n\t\tswitch ( result ) {\r\n\t\t\tcase 'same':\r\n\t\t\t\treturn 'same';\r\n\r\n\t\t\tcase 'prefix':\r\n\t\t\t\treturn 'before';\r\n\r\n\t\t\tcase 'extension':\r\n\t\t\t\treturn 'after';\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.path[ result ] < otherPosition.path[ result ] ? 'before' : 'after';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the farthest position which matches the callback using\r\n\t * {@link module:engine/model/treewalker~TreeWalker TreeWalker}.\r\n\t *\r\n\t * For example:\r\n\t *\r\n\t * \t\tgetLastMatchingPosition( value => value.type == 'text' );\r\n\t * \t\t// <paragraph>[]foo</paragraph> -> <paragraph>foo[]</paragraph>\r\n\t *\r\n\t * \t\tgetLastMatchingPosition( value => value.type == 'text', { direction: 'backward' } );\r\n\t * \t\t// <paragraph>foo[]</paragraph> -> <paragraph>[]foo</paragraph>\r\n\t *\r\n\t * \t\tgetLastMatchingPosition( value => false );\r\n\t * \t\t// Do not move the position.\r\n\t *\r\n\t * @param {Function} skip Callback function. Gets {@link module:engine/model/treewalker~TreeWalkerValue} and should\r\n\t * return `true` if the value should be skipped or `false` if not.\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/model/treewalker~TreeWalker}.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position} The position after the last item which matches the `skip` callback test.\r\n\t */\r\n\tgetLastMatchingPosition( skip, options = {} ) {\r\n\t\toptions.startPosition = this;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\t\ttreeWalker.skip( skip );\r\n\r\n\t\treturn treeWalker.position;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a path to this position's parent. Parent path is equal to position {@link module:engine/model/position~Position#path path}\r\n\t * but without the last item.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @returns {Array.<Number>} Path to the parent.\r\n\t */\r\n\tgetParentPath() {\r\n\t\treturn this.path.slice( 0, -1 );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns ancestors array of this position, that is this position's parent and its ancestors.\r\n\t *\r\n\t * @returns {Array.<module:engine/model/item~Item>} Array with ancestors.\r\n\t */\r\n\tgetAncestors() {\r\n\t\tif ( this.parent.is( 'documentFragment' ) ) {\r\n\t\t\treturn [ this.parent ];\r\n\t\t} else {\r\n\t\t\treturn this.parent.getAncestors( { includeSelf: true } );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the slice of two position {@link #path paths} which is identical. The {@link #root roots}\r\n\t * of these two paths must be identical.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position The second position.\r\n\t * @returns {Array.<Number>} The common path.\r\n\t */\r\n\tgetCommonPath( position ) {\r\n\t\tif ( this.root != position.root ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\t// We find on which tree-level start and end have the lowest common ancestor\r\n\t\tconst cmp = compareArrays( this.path, position.path );\r\n\t\t// If comparison returned string it means that arrays are same.\r\n\t\tconst diffAt = ( typeof cmp == 'string' ) ? Math.min( this.path.length, position.path.length ) : cmp;\r\n\r\n\t\treturn this.path.slice( 0, diffAt );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an {@link module:engine/model/element~Element} or {@link module:engine/model/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of both positions. The {@link #root roots} of these two positions must be identical.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position The second position.\r\n\t * @returns {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor( position ) {\r\n\t\tconst ancestorsA = this.getAncestors();\r\n\t\tconst ancestorsB = position.getAncestors();\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\twhile ( ancestorsA[ i ] == ancestorsB[ i ] && ancestorsA[ i ] ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\treturn i === 0 ? null : ancestorsA[ i - 1 ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new instance of `Position`, that has same {@link #parent parent} but it's offset\r\n\t * is shifted by `shift` value (can be a negative value).\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {Number} shift Offset shift. Can be a negative value.\r\n\t * @returns {module:engine/model/position~Position} Shifted position.\r\n\t */\r\n\tgetShiftedBy( shift ) {\r\n\t\tconst shifted = this.clone();\r\n\r\n\t\tconst offset = shifted.offset + shift;\r\n\t\tshifted.offset = offset < 0 ? 0 : offset;\r\n\r\n\t\treturn shifted;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is after given position.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @see module:engine/model/position~Position#isBefore\r\n\t * @param {module:engine/model/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} True if this position is after given position.\r\n\t */\r\n\tisAfter( otherPosition ) {\r\n\t\treturn this.compareWith( otherPosition ) == 'after';\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is before given position.\r\n\t *\r\n\t * **Note:** watch out when using negation of the value returned by this method, because the negation will also\r\n\t * be `true` if positions are in different roots and you might not expect this. You should probably use\r\n\t * `a.isAfter( b ) || a.isEqual( b )` or `!a.isBefore( p ) && a.root == b.root` in most scenarios. If your\r\n\t * condition uses multiple `isAfter` and `isBefore` checks, build them so they do not use negated values, i.e.:\r\n\t *\r\n\t *\t\tif ( a.isBefore( b ) && c.isAfter( d ) ) {\r\n\t *\t\t\t// do A.\r\n\t *\t\t} else {\r\n\t *\t\t\t// do B.\r\n\t *\t\t}\r\n\t *\r\n\t * or, if you have only one if-branch:\r\n\t *\r\n\t *\t\tif ( !( a.isBefore( b ) && c.isAfter( d ) ) {\r\n\t *\t\t\t// do B.\r\n\t *\t\t}\r\n\t *\r\n\t * rather than:\r\n\t *\r\n\t *\t\tif ( !a.isBefore( b ) || && !c.isAfter( d ) ) {\r\n\t *\t\t\t// do B.\r\n\t *\t\t} else {\r\n\t *\t\t\t// do A.\r\n\t *\t\t}\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} True if this position is before given position.\r\n\t */\r\n\tisBefore( otherPosition ) {\r\n\t\treturn this.compareWith( otherPosition ) == 'before';\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is equal to given position.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} True if positions are same.\r\n\t */\r\n\tisEqual( otherPosition ) {\r\n\t\treturn this.compareWith( otherPosition ) == 'same';\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this position is touching given position. Positions touch when there are no text nodes\r\n\t * or empty nodes in a range between them. Technically, those positions are not equal but in many cases\r\n\t * they are very similar or even indistinguishable.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} otherPosition Position to compare with.\r\n\t * @returns {Boolean} True if positions touch.\r\n\t */\r\n\tisTouching( otherPosition ) {\r\n\t\tlet left = null;\r\n\t\tlet right = null;\r\n\t\tconst compare = this.compareWith( otherPosition );\r\n\r\n\t\tswitch ( compare ) {\r\n\t\t\tcase 'same':\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tcase 'before':\r\n\t\t\t\tleft = Position._createAt( this );\r\n\t\t\t\tright = Position._createAt( otherPosition );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'after':\r\n\t\t\t\tleft = Position._createAt( otherPosition );\r\n\t\t\t\tright = Position._createAt( this );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Cached for optimization purposes.\r\n\t\tlet leftParent = left.parent;\r\n\r\n\t\twhile ( left.path.length + right.path.length ) {\r\n\t\t\tif ( left.isEqual( right ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( left.path.length > right.path.length ) {\r\n\t\t\t\tif ( left.offset !== leftParent.maxOffset ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tleft.path = left.path.slice( 0, -1 );\r\n\t\t\t\tleftParent = leftParent.parent;\r\n\t\t\t\tleft.offset++;\r\n\t\t\t} else {\r\n\t\t\t\tif ( right.offset !== 0 ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tright.path = right.path.slice( 0, -1 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if two positions are in the same parent.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position to compare with.\r\n\t * @returns {Boolean} `true` if positions have the same parent, `false` otherwise.\r\n\t */\r\n\thasSameParentAs( position ) {\r\n\t\tif ( this.root !== position.root ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst thisParentPath = this.getParentPath();\r\n\t\tconst posParentPath = position.getParentPath();\r\n\r\n\t\treturn compareArrays( thisParentPath, posParentPath ) == 'same';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position that is transformed by given `operation`.\r\n\t *\r\n\t * The new position's parameters are updated accordingly to the effect of the `operation`.\r\n\t *\r\n\t * For example, if `n` nodes are inserted before the position, the returned position {@link ~Position#offset} will be\r\n\t * increased by `n`. If the position was in a merged element, it will be accordingly moved to the new element, etc.\r\n\t *\r\n\t * This method is safe to use it on non-existing positions (for example during operational transformation).\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation Operation to transform by.\r\n\t * @returns {module:engine/model/position~Position} Transformed position.\r\n\t */\r\n\tgetTransformedByOperation( operation ) {\r\n\t\tlet result;\r\n\r\n\t\tswitch ( operation.type ) {\r\n\t\t\tcase 'insert':\r\n\t\t\t\tresult = this._getTransformedByInsertOperation( operation );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'move':\r\n\t\t\tcase 'remove':\r\n\t\t\tcase 'reinsert':\r\n\t\t\t\tresult = this._getTransformedByMoveOperation( operation );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'split':\r\n\t\t\t\tresult = this._getTransformedBySplitOperation( operation );\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'merge':\r\n\t\t\t\tresult = this._getTransformedByMergeOperation( operation );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tresult = Position._createAt( this );\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position transformed by an insert operation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/insertoperation~InsertOperation} operation\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\t_getTransformedByInsertOperation( operation ) {\r\n\t\treturn this._getTransformedByInsertion( operation.position, operation.howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position transformed by a move operation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/moveoperation~MoveOperation} operation\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\t_getTransformedByMoveOperation( operation ) {\r\n\t\treturn this._getTransformedByMove( operation.sourcePosition, operation.targetPosition, operation.howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position transformed by a split operation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/splitoperation~SplitOperation} operation\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\t_getTransformedBySplitOperation( operation ) {\r\n\t\tconst movedRange = operation.movedRange;\r\n\r\n\t\tconst isContained = movedRange.containsPosition( this ) ||\r\n\t\t\t( movedRange.start.isEqual( this ) && this.stickiness == 'toNext' );\r\n\r\n\t\tif ( isContained ) {\r\n\t\t\treturn this._getCombined( operation.splitPosition, operation.moveTargetPosition );\r\n\t\t} else {\r\n\t\t\tif ( operation.graveyardPosition ) {\r\n\t\t\t\treturn this._getTransformedByMove( operation.graveyardPosition, operation.insertionPosition, 1 );\r\n\t\t\t} else {\r\n\t\t\t\treturn this._getTransformedByInsertion( operation.insertionPosition, 1 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position transformed by merge operation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/mergeoperation~MergeOperation} operation\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\t_getTransformedByMergeOperation( operation ) {\r\n\t\tconst movedRange = operation.movedRange;\r\n\t\tconst isContained = movedRange.containsPosition( this ) || movedRange.start.isEqual( this );\r\n\r\n\t\tlet pos;\r\n\r\n\t\tif ( isContained ) {\r\n\t\t\tpos = this._getCombined( operation.sourcePosition, operation.targetPosition );\r\n\r\n\t\t\tif ( operation.sourcePosition.isBefore( operation.targetPosition ) ) {\r\n\t\t\t\t// Above happens during OT when the merged element is moved before the merged-to element.\r\n\t\t\t\tpos = pos._getTransformedByDeletion( operation.deletionPosition, 1 );\r\n\t\t\t}\r\n\t\t} else if ( this.isEqual( operation.deletionPosition ) ) {\r\n\t\t\tpos = Position._createAt( operation.deletionPosition );\r\n\t\t} else {\r\n\t\t\tpos = this._getTransformedByMove( operation.deletionPosition, operation.graveyardPosition, 1 );\r\n\t\t}\r\n\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position that is updated by removing `howMany` nodes starting from `deletePosition`.\r\n\t * It may happen that this position is in a removed node. If that is the case, `null` is returned instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} deletePosition Position before the first removed node.\r\n\t * @param {Number} howMany How many nodes are removed.\r\n\t * @returns {module:engine/model/position~Position|null} Transformed position or `null`.\r\n\t */\r\n\t_getTransformedByDeletion( deletePosition, howMany ) {\r\n\t\tconst transformed = Position._createAt( this );\r\n\r\n\t\t// This position can't be affected if deletion was in a different root.\r\n\t\tif ( this.root != deletePosition.root ) {\r\n\t\t\treturn transformed;\r\n\t\t}\r\n\r\n\t\tif ( compareArrays( deletePosition.getParentPath(), this.getParentPath() ) == 'same' ) {\r\n\t\t\t// If nodes are removed from the node that is pointed by this position...\r\n\t\t\tif ( deletePosition.offset < this.offset ) {\r\n\t\t\t\t// And are removed from before an offset of that position...\r\n\t\t\t\tif ( deletePosition.offset + howMany > this.offset ) {\r\n\t\t\t\t\t// Position is in removed range, it's no longer in the tree.\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Decrement the offset accordingly.\r\n\t\t\t\t\ttransformed.offset -= howMany;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ( compareArrays( deletePosition.getParentPath(), this.getParentPath() ) == 'prefix' ) {\r\n\t\t\t// If nodes are removed from a node that is on a path to this position...\r\n\t\t\tconst i = deletePosition.path.length - 1;\r\n\r\n\t\t\tif ( deletePosition.offset <= this.path[ i ] ) {\r\n\t\t\t\t// And are removed from before next node of that path...\r\n\t\t\t\tif ( deletePosition.offset + howMany > this.path[ i ] ) {\r\n\t\t\t\t\t// If the next node of that path is removed return null\r\n\t\t\t\t\t// because the node containing this position got removed.\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Otherwise, decrement index on that path.\r\n\t\t\t\t\ttransformed.path[ i ] -= howMany;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn transformed;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position that is updated by inserting `howMany` nodes at `insertPosition`.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} insertPosition Position where nodes are inserted.\r\n\t * @param {Number} howMany How many nodes are inserted.\r\n\t * @returns {module:engine/model/position~Position} Transformed position.\r\n\t */\r\n\t_getTransformedByInsertion( insertPosition, howMany ) {\r\n\t\tconst transformed = Position._createAt( this );\r\n\r\n\t\t// This position can't be affected if insertion was in a different root.\r\n\t\tif ( this.root != insertPosition.root ) {\r\n\t\t\treturn transformed;\r\n\t\t}\r\n\r\n\t\tif ( compareArrays( insertPosition.getParentPath(), this.getParentPath() ) == 'same' ) {\r\n\t\t\t// If nodes are inserted in the node that is pointed by this position...\r\n\t\t\tif ( insertPosition.offset < this.offset || ( insertPosition.offset == this.offset && this.stickiness != 'toPrevious' ) ) {\r\n\t\t\t\t// And are inserted before an offset of that position...\r\n\t\t\t\t// \"Push\" this positions offset.\r\n\t\t\t\ttransformed.offset += howMany;\r\n\t\t\t}\r\n\t\t} else if ( compareArrays( insertPosition.getParentPath(), this.getParentPath() ) == 'prefix' ) {\r\n\t\t\t// If nodes are inserted in a node that is on a path to this position...\r\n\t\t\tconst i = insertPosition.path.length - 1;\r\n\r\n\t\t\tif ( insertPosition.offset <= this.path[ i ] ) {\r\n\t\t\t\t// And are inserted before next node of that path...\r\n\t\t\t\t// \"Push\" the index on that path.\r\n\t\t\t\ttransformed.path[ i ] += howMany;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn transformed;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this position that is updated by moving `howMany` nodes from `sourcePosition` to `targetPosition`.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} sourcePosition Position before the first element to move.\r\n\t * @param {module:engine/model/position~Position} targetPosition Position where moved elements will be inserted.\r\n\t * @param {Number} howMany How many consecutive nodes to move, starting from `sourcePosition`.\r\n\t * @returns {module:engine/model/position~Position} Transformed position.\r\n\t */\r\n\t_getTransformedByMove( sourcePosition, targetPosition, howMany ) {\r\n\t\t// Update target position, as it could be affected by nodes removal.\r\n\t\ttargetPosition = targetPosition._getTransformedByDeletion( sourcePosition, howMany );\r\n\r\n\t\tif ( sourcePosition.isEqual( targetPosition ) ) {\r\n\t\t\t// If `targetPosition` is equal to `sourcePosition` this isn't really any move. Just return position as it is.\r\n\t\t\treturn Position._createAt( this );\r\n\t\t}\r\n\r\n\t\t// Moving a range removes nodes from their original position. We acknowledge this by proper transformation.\r\n\t\tconst transformed = this._getTransformedByDeletion( sourcePosition, howMany );\r\n\r\n\t\tconst isMoved = transformed === null ||\r\n\t\t\t( sourcePosition.isEqual( this ) && this.stickiness == 'toNext' ) ||\r\n\t\t\t( sourcePosition.getShiftedBy( howMany ).isEqual( this ) && this.stickiness == 'toPrevious' );\r\n\r\n\t\tif ( isMoved ) {\r\n\t\t\t// This position is inside moved range (or sticks to it).\r\n\t\t\t// In this case, we calculate a combination of this position, move source position and target position.\r\n\t\t\treturn this._getCombined( sourcePosition, targetPosition );\r\n\t\t} else {\r\n\t\t\t// This position is not inside a removed range.\r\n\t\t\t//\r\n\t\t\t// In next step, we simply reflect inserting `howMany` nodes, which might further affect the position.\r\n\t\t\treturn transformed._getTransformedByInsertion( targetPosition, howMany );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new position that is a combination of this position and given positions.\r\n\t *\r\n\t * The combined position is a copy of this position transformed by moving a range starting at `source` position\r\n\t * to the `target` position. It is expected that this position is inside the moved range.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t *\t\tlet original = model.createPositionFromPath( root, [ 2, 3, 1 ] );\r\n\t *\t\tlet source = model.createPositionFromPath( root, [ 2, 2 ] );\r\n\t *\t\tlet target = model.createPositionFromPath( otherRoot, [ 1, 1, 3 ] );\r\n\t *\t\toriginal._getCombined( source, target ); // path is [ 1, 1, 4, 1 ], root is `otherRoot`\r\n\t *\r\n\t * Explanation:\r\n\t *\r\n\t * We have a position `[ 2, 3, 1 ]` and move some nodes from `[ 2, 2 ]` to `[ 1, 1, 3 ]`. The original position\r\n\t * was inside moved nodes and now should point to the new place. The moved nodes will be after\r\n\t * positions `[ 1, 1, 3 ]`, `[ 1, 1, 4 ]`, `[ 1, 1, 5 ]`. Since our position was in the second moved node,\r\n\t * the transformed position will be in a sub-tree of a node at `[ 1, 1, 4 ]`. Looking at original path, we\r\n\t * took care of `[ 2, 3 ]` part of it. Now we have to add the rest of the original path to the transformed path.\r\n\t * Finally, the transformed position will point to `[ 1, 1, 4, 1 ]`.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} source Beginning of the moved range.\r\n\t * @param {module:engine/model/position~Position} target Position where the range is moved.\r\n\t * @returns {module:engine/model/position~Position} Combined position.\r\n\t */\r\n\t_getCombined( source, target ) {\r\n\t\tconst i = source.path.length - 1;\r\n\r\n\t\t// The first part of a path to combined position is a path to the place where nodes were moved.\r\n\t\tconst combined = Position._createAt( target );\r\n\t\tcombined.stickiness = this.stickiness;\r\n\r\n\t\t// Then we have to update the rest of the path.\r\n\r\n\t\t// Fix the offset because this position might be after `from` position and we have to reflect that.\r\n\t\tcombined.offset = combined.offset + this.path[ i ] - source.offset;\r\n\r\n\t\t// Then, add the rest of the path.\r\n\t\t// If this position is at the same level as `from` position nothing will get added.\r\n\t\tcombined.path = combined.path.concat( this.path.slice( i + 1 ) );\r\n\r\n\t\treturn combined;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\troot: this.root.toJSON(),\r\n\t\t\tpath: Array.from( this.path ),\r\n\t\t\tstickiness: this.stickiness\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new position that is equal to current position.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tclone() {\r\n\t\treturn new this.constructor( this.root, this.path, this.stickiness );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/model/position~Position position},\r\n\t * * parent element and offset (offset defaults to `0`),\r\n\t * * parent element and `'end'` (sets position at the end of that element),\r\n\t * * {@link module:engine/model/item~Item model item} and `'before'` or `'after'` (sets position before or after given model item).\r\n\t *\r\n\t * This method is a shortcut to other factory methods such as:\r\n\t *\r\n\t * * {@link module:engine/model/position~Position._createBefore},\r\n\t * * {@link module:engine/model/position~Position._createAfter}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t * @protected\r\n\t */\r\n\tstatic _createAt( itemOrPosition, offset ) {\r\n\t\tif ( itemOrPosition instanceof Position ) {\r\n\t\t\treturn new Position( itemOrPosition.root, itemOrPosition.path, itemOrPosition.stickiness );\r\n\t\t} else {\r\n\t\t\tconst node = itemOrPosition;\r\n\r\n\t\t\tif ( offset == 'end' ) {\r\n\t\t\t\toffset = node.maxOffset;\r\n\t\t\t} else if ( offset == 'before' ) {\r\n\t\t\t\treturn this._createBefore( node );\r\n\t\t\t} else if ( offset == 'after' ) {\r\n\t\t\t\treturn this._createAfter( node );\r\n\t\t\t} else if ( offset !== 0 && !offset ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * {@link module:engine/model/model~Model#createPositionAt `Model#createPositionAt()`}\r\n\t\t\t\t * requires the offset to be specified when the first parameter is a model item.\r\n\t\t\t\t *\r\n\t\t\t\t * @error model-createPositionAt-offset-required\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'model-createPositionAt-offset-required: ' +\r\n\t\t\t\t\t'Model#createPositionAt() requires the offset when the first parameter is a model item.' );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !node.is( 'element' ) && !node.is( 'documentFragment' ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Position parent have to be a model element or model document fragment.\r\n\t\t\t\t *\r\n\t\t\t\t * @error model-position-parent-incorrect\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'model-position-parent-incorrect: Position parent have to be a element or document fragment.' );\r\n\t\t\t}\r\n\r\n\t\t\tconst path = node.getPath();\r\n\r\n\t\t\tpath.push( offset );\r\n\r\n\t\t\treturn new this( node.root, path );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position, after given {@link module:engine/model/item~Item model item}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item after which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t * @protected\r\n\t */\r\n\tstatic _createAfter( item ) {\r\n\t\tif ( !item.parent ) {\r\n\t\t\t/**\r\n\t\t\t * You can not make a position after a root element.\r\n\t\t\t *\r\n\t\t\t * @error model-position-after-root\r\n\t\t\t * @param {module:engine/model/item~Item} root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-position-after-root: You cannot make a position after root.', { root: item } );\r\n\t\t}\r\n\r\n\t\treturn this._createAt( item.parent, item.endOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position, before the given {@link module:engine/model/item~Item model item}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item before which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t * @protected\r\n\t */\r\n\tstatic _createBefore( item ) {\r\n\t\tif ( !item.parent ) {\r\n\t\t\t/**\r\n\t\t\t * You can not make a position before a root element.\r\n\t\t\t *\r\n\t\t\t * @error model-position-before-root\r\n\t\t\t * @param {module:engine/model/item~Item} root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-position-before-root: You cannot make a position before root.', { root: item } );\r\n\t\t}\r\n\r\n\t\treturn this._createAt( item.parent, item.startOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `Position` instance from given plain object (i.e. parsed JSON string).\r\n\t *\r\n\t * @param {Object} json Plain object to be converted to `Position`.\r\n\t * @param {module:engine/model/document~Document} doc Document object that will be position owner.\r\n\t * @returns {module:engine/model/position~Position} `Position` instance created using given plain object.\r\n\t */\r\n\tstatic fromJSON( json, doc ) {\r\n\t\tif ( json.root === '$graveyard' ) {\r\n\t\t\tconst pos = new Position( doc.graveyard, json.path );\r\n\t\t\tpos.stickiness = json.stickiness;\r\n\r\n\t\t\treturn pos;\r\n\t\t}\r\n\r\n\t\tif ( !doc.getRoot( json.root ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot create position for document. Root with specified name does not exist.\r\n\t\t\t *\r\n\t\t\t * @error model-position-fromjson-no-root\r\n\t\t\t * @param {String} rootName\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'model-position-fromjson-no-root: Cannot create position for document. Root with specified name does not exist.',\r\n\t\t\t\t{ rootName: json.root }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst pos = new Position( doc.getRoot( json.root ), json.path );\r\n\t\tpos.stickiness = json.stickiness;\r\n\r\n\t\treturn pos;\r\n\t}\r\n}\r\n\r\n/**\r\n * A flag indicating whether this position is `'before'` or `'after'` or `'same'` as given position.\r\n * If positions are in different roots `'different'` flag is returned.\r\n *\r\n * @typedef {String} module:engine/model/position~PositionRelation\r\n */\r\n\r\n/**\r\n * Represents how position is \"sticking\" with neighbour nodes. Used to define how position should be transformed (moved)\r\n * in edge cases. Possible values: `'toNone'`, `'toNext'`, `'toPrevious'`.\r\n *\r\n * Examples:\r\n *\r\n *\t\tInsert. Position is at | and nodes are inserted at the same position, marked as ^:\r\n *\r\n *\t\t- sticks to none:           <p>f^|oo</p>  ->  <p>fbar|oo</p>\r\n *\t\t- sticks to next node:      <p>f^|oo</p>  ->  <p>fbar|oo</p>\r\n *\t\t- sticks to previous node:  <p>f|^oo</p>  ->  <p>f|baroo</p>\r\n *\r\n *\r\n *\t\tMove. Position is at | and range [oo] is moved to position ^:\r\n *\r\n *\t\t- sticks to none:           <p>f|[oo]</p><p>b^ar</p>  ->  <p>f|</p><p>booar</p>\r\n *\t\t- sticks to none:           <p>f[oo]|</p><p>b^ar</p>  ->  <p>f|</p><p>booar</p>\r\n *\r\n *\t\t- sticks to next node:      <p>f|[oo]</p><p>b^ar</p>  ->  <p>f</p><p>b|ooar</p>\r\n *\t\t- sticks to next node:      <p>f[oo]|</p><p>b^ar</p>  ->  <p>f|</p><p>booar</p>\r\n *\r\n *\t\t- sticks to previous node:  <p>f|[oo]</p><p>b^ar</p>  ->  <p>f|</p><p>booar</p>\r\n *\t\t- sticks to previous node:  <p>f[oo]|</p><p>b^ar</p>  ->  <p>f</p><p>boo|ar</p>\r\n *\r\n * @typedef {String} module:engine/model/position~PositionStickiness\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/range\r\n */\r\n\r\nimport Position from './position';\r\nimport TreeWalker from './treewalker';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\n\r\n/**\r\n * Represents a range in the model tree.\r\n *\r\n * A range is defined by its {@link module:engine/model/range~Range#start} and {@link module:engine/model/range~Range#end}\r\n * positions.\r\n *\r\n * You can create range instances via its constructor or the `createRange*()` factory methods of\r\n * {@link module:engine/model/model~Model} and {@link module:engine/model/writer~Writer}.\r\n */\r\nexport default class Range {\r\n\t/**\r\n\t * Creates a range spanning from `start` position to `end` position.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} start Start position.\r\n\t * @param {module:engine/model/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\r\n\t */\r\n\tconstructor( start, end = null ) {\r\n\t\t/**\r\n\t\t * Start position.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/position~Position}\r\n\t\t */\r\n\t\tthis.start = Position._createAt( start );\r\n\r\n\t\t/**\r\n\t\t * End position.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/position~Position}\r\n\t\t */\r\n\t\tthis.end = end ? Position._createAt( end ) : Position._createAt( start );\r\n\r\n\t\t// If the range is collapsed, treat in a similar way as a position and set its boundaries stickiness to 'toNone'.\r\n\t\t// In other case, make the boundaries stick to the \"inside\" of the range.\r\n\t\tthis.start.stickiness = this.isCollapsed ? 'toNone' : 'toNext';\r\n\t\tthis.end.stickiness = this.isCollapsed ? 'toNone' : 'toPrevious';\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over all {@link module:engine/model/item~Item items} that are in this range and returns\r\n\t * them together with additional information like length or {@link module:engine/model/position~Position positions},\r\n\t * grouped as {@link module:engine/model/treewalker~TreeWalkerValue}.\r\n\t * It iterates over all {@link module:engine/model/textproxy~TextProxy text contents} that are inside the range\r\n\t * and all the {@link module:engine/model/element~Element}s that are entered into when iterating over this range.\r\n\t *\r\n\t * This iterator uses {@link module:engine/model/treewalker~TreeWalker} with `boundaries` set to this range\r\n\t * and `ignoreElementEnd` option set to `true`.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/treewalker~TreeWalkerValue>}\r\n\t */\r\n\t* [ Symbol.iterator ]() {\r\n\t\tyield* new TreeWalker( { boundaries: this, ignoreElementEnd: true } );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the range is collapsed, that is if {@link #start} and\r\n\t * {@link #end} positions are equal.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\treturn this.start.isEqual( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether this range is flat, that is if {@link #start} position and\r\n\t * {@link #end} position are in the same {@link module:engine/model/position~Position#parent}.\r\n\t *\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isFlat() {\r\n\t\tconst startParentPath = this.start.getParentPath();\r\n\t\tconst endParentPath = this.end.getParentPath();\r\n\r\n\t\treturn compareArrays( startParentPath, endParentPath ) == 'same';\r\n\t}\r\n\r\n\t/**\r\n\t * Range root element.\r\n\t *\r\n\t * @type {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this.start.root;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this range contains given {@link module:engine/model/position~Position position}.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position to check.\r\n\t * @returns {Boolean} `true` if given {@link module:engine/model/position~Position position} is contained\r\n\t * in this range,`false` otherwise.\r\n\t */\r\n\tcontainsPosition( position ) {\r\n\t\treturn position.isAfter( this.start ) && position.isBefore( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this range contains given {@link ~Range range}.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} otherRange Range to check.\r\n\t * @param {Boolean} [loose=false] Whether the check is loose or strict. If the check is strict (`false`), compared range cannot\r\n\t * start or end at the same position as this range boundaries. If the check is loose (`true`), compared range can start, end or\r\n\t * even be equal to this range. Note that collapsed ranges are always compared in strict mode.\r\n\t * @returns {Boolean} `true` if given {@link ~Range range} boundaries are contained by this range, `false` otherwise.\r\n\t */\r\n\tcontainsRange( otherRange, loose = false ) {\r\n\t\tif ( otherRange.isCollapsed ) {\r\n\t\t\tloose = false;\r\n\t\t}\r\n\r\n\t\tconst containsStart = this.containsPosition( otherRange.start ) || ( loose && this.start.isEqual( otherRange.start ) );\r\n\t\tconst containsEnd = this.containsPosition( otherRange.end ) || ( loose && this.end.isEqual( otherRange.end ) );\r\n\r\n\t\treturn containsStart && containsEnd;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given {@link module:engine/model/item~Item} is inside this range.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Model item to check.\r\n\t */\r\n\tcontainsItem( item ) {\r\n\t\tconst pos = Position._createBefore( item );\r\n\r\n\t\treturn this.containsPosition( pos ) || this.start.isEqual( pos );\r\n\t}\r\n\r\n\t/**\r\n\t * Two ranges are equal if their {@link #start} and {@link #end} positions are equal.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} otherRange Range to compare with.\r\n\t * @returns {Boolean} `true` if ranges are equal, `false` otherwise.\r\n\t */\r\n\tisEqual( otherRange ) {\r\n\t\treturn this.start.isEqual( otherRange.start ) && this.end.isEqual( otherRange.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks and returns whether this range intersects with given range.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} otherRange Range to compare with.\r\n\t * @returns {Boolean} `true` if ranges intersect, `false` otherwise.\r\n\t */\r\n\tisIntersecting( otherRange ) {\r\n\t\treturn this.start.isBefore( otherRange.end ) && this.end.isAfter( otherRange.start );\r\n\t}\r\n\r\n\t/**\r\n\t * Computes which part(s) of this {@link ~Range range} is not a part of given {@link ~Range range}.\r\n\t * Returned array contains zero, one or two {@link ~Range ranges}.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tlet range = model.createRange(\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 2, 7 ] ),\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 4, 0, 1 ] )\r\n\t *\t\t);\r\n\t *\t\tlet otherRange = model.createRange( model.createPositionFromPath( root, [ 1 ] ), model.createPositionFromPath( root, [ 5 ] ) );\r\n\t *\t\tlet transformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has no ranges because `otherRange` contains `range`\r\n\t *\r\n\t *\t\totherRange = model.createRange( model.createPositionFromPath( root, [ 1 ] ), model.createPositionFromPath( root, [ 3 ] ) );\r\n\t *\t\ttransformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has one range: from [ 3 ] to [ 4, 0, 1 ]\r\n\t *\r\n\t *\t\totherRange = model.createRange( model.createPositionFromPath( root, [ 3 ] ), model.createPositionFromPath( root, [ 4 ] ) );\r\n\t *\t\ttransformed = range.getDifference( otherRange );\r\n\t *\t\t// transformed array has two ranges: from [ 2, 7 ] to [ 3 ] and from [ 4 ] to [ 4, 0, 1 ]\r\n\t *\r\n\t * @param {module:engine/model/range~Range} otherRange Range to differentiate against.\r\n\t * @returns {Array.<module:engine/model/range~Range>} The difference between ranges.\r\n\t */\r\n\tgetDifference( otherRange ) {\r\n\t\tconst ranges = [];\r\n\r\n\t\tif ( this.isIntersecting( otherRange ) ) {\r\n\t\t\t// Ranges intersect.\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.start ) ) {\r\n\t\t\t\t// Given range start is inside this range. This means that we have to\r\n\t\t\t\t// add shrunken range - from the start to the middle of this range.\r\n\t\t\t\tranges.push( new Range( this.start, otherRange.start ) );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.end ) ) {\r\n\t\t\t\t// Given range end is inside this range. This means that we have to\r\n\t\t\t\t// add shrunken range - from the middle of this range to the end.\r\n\t\t\t\tranges.push( new Range( otherRange.end, this.end ) );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Ranges do not intersect, return the original range.\r\n\t\t\tranges.push( new Range( this.start, this.end ) );\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an intersection of this {@link ~Range range} and given {@link ~Range range}.\r\n\t * Intersection is a common part of both of those ranges. If ranges has no common part, returns `null`.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tlet range = model.createRange(\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 2, 7 ] ),\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 4, 0, 1 ] )\r\n\t *\t\t);\r\n\t *\t\tlet otherRange = model.createRange( model.createPositionFromPath( root, [ 1 ] ), model.createPositionFromPath( root, [ 2 ] ) );\r\n\t *\t\tlet transformed = range.getIntersection( otherRange ); // null - ranges have no common part\r\n\t *\r\n\t *\t\totherRange = model.createRange( model.createPositionFromPath( root, [ 3 ] ), model.createPositionFromPath( root, [ 5 ] ) );\r\n\t *\t\ttransformed = range.getIntersection( otherRange ); // range from [ 3 ] to [ 4, 0, 1 ]\r\n\t *\r\n\t * @param {module:engine/model/range~Range} otherRange Range to check for intersection.\r\n\t * @returns {module:engine/model/range~Range|null} A common part of given ranges or `null` if ranges have no common part.\r\n\t */\r\n\tgetIntersection( otherRange ) {\r\n\t\tif ( this.isIntersecting( otherRange ) ) {\r\n\t\t\t// Ranges intersect, so a common range will be returned.\r\n\t\t\t// At most, it will be same as this range.\r\n\t\t\tlet commonRangeStart = this.start;\r\n\t\t\tlet commonRangeEnd = this.end;\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.start ) ) {\r\n\t\t\t\t// Given range start is inside this range. This means thaNt we have to\r\n\t\t\t\t// shrink common range to the given range start.\r\n\t\t\t\tcommonRangeStart = otherRange.start;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.containsPosition( otherRange.end ) ) {\r\n\t\t\t\t// Given range end is inside this range. This means that we have to\r\n\t\t\t\t// shrink common range to the given range end.\r\n\t\t\t\tcommonRangeEnd = otherRange.end;\r\n\t\t\t}\r\n\r\n\t\t\treturn new Range( commonRangeStart, commonRangeEnd );\r\n\t\t}\r\n\r\n\t\t// Ranges do not intersect, so they do not have common part.\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Computes and returns the smallest set of {@link #isFlat flat} ranges, that covers this range in whole.\r\n\t *\r\n\t * See an example of a model structure (`[` and `]` are range boundaries):\r\n\t *\r\n\t *\t\troot                                                            root\r\n\t *\t\t |- element DIV                         DIV             P2              P3             DIV\r\n\t *\t\t |   |- element H                   H        P1        f o o           b a r       H         P4\r\n\t *\t\t |   |   |- \"fir[st\"             fir[st     lorem                               se]cond     ipsum\r\n\t *\t\t |   |- element P1\r\n\t *\t\t |   |   |- \"lorem\"                                              ||\r\n\t *\t\t |- element P2                                                   ||\r\n\t *\t\t |   |- \"foo\"                                                    VV\r\n\t *\t\t |- element P3\r\n\t *\t\t |   |- \"bar\"                                                   root\r\n\t *\t\t |- element DIV                         DIV             [P2             P3]             DIV\r\n\t *\t\t |   |- element H                   H       [P1]       f o o           b a r        H         P4\r\n\t *\t\t |   |   |- \"se]cond\"            fir[st]    lorem                               [se]cond     ipsum\r\n\t *\t\t |   |- element P4\r\n\t *\t\t |   |   |- \"ipsum\"\r\n\t *\r\n\t * As it can be seen, letters contained in the range are: `stloremfoobarse`, spread across different parents.\r\n\t * We are looking for minimal set of flat ranges that contains the same nodes.\r\n\t *\r\n\t * Minimal flat ranges for above range `( [ 0, 0, 3 ], [ 3, 0, 2 ] )` will be:\r\n\t *\r\n\t *\t\t( [ 0, 0, 3 ], [ 0, 0, 5 ] ) = \"st\"\r\n\t *\t\t( [ 0, 1 ], [ 0, 2 ] ) = element P1 (\"lorem\")\r\n\t *\t\t( [ 1 ], [ 3 ] ) = element P2, element P3 (\"foobar\")\r\n\t *\t\t( [ 3, 0, 0 ], [ 3, 0, 2 ] ) = \"se\"\r\n\t *\r\n\t * **Note:** if an {@link module:engine/model/element~Element element} is not wholly contained in this range, it won't be returned\r\n\t * in any of the returned flat ranges. See in the example how `H` elements at the beginning and at the end of the range\r\n\t * were omitted. Only their parts that were wholly in the range were returned.\r\n\t *\r\n\t * **Note:** this method is not returning flat ranges that contain no nodes.\r\n\t *\r\n\t * @returns {Array.<module:engine/model/range~Range>} Array of flat ranges covering this range.\r\n\t */\r\n\tgetMinimalFlatRanges() {\r\n\t\tconst ranges = [];\r\n\t\tconst diffAt = this.start.getCommonPath( this.end ).length;\r\n\r\n\t\tconst pos = Position._createAt( this.start );\r\n\t\tlet posParent = pos.parent;\r\n\r\n\t\t// Go up.\r\n\t\twhile ( pos.path.length > diffAt + 1 ) {\r\n\t\t\tconst howMany = posParent.maxOffset - pos.offset;\r\n\r\n\t\t\tif ( howMany !== 0 ) {\r\n\t\t\t\tranges.push( new Range( pos, pos.getShiftedBy( howMany ) ) );\r\n\t\t\t}\r\n\r\n\t\t\tpos.path = pos.path.slice( 0, -1 );\r\n\t\t\tpos.offset++;\r\n\t\t\tposParent = posParent.parent;\r\n\t\t}\r\n\r\n\t\t// Go down.\r\n\t\twhile ( pos.path.length <= this.end.path.length ) {\r\n\t\t\tconst offset = this.end.path[ pos.path.length - 1 ];\r\n\t\t\tconst howMany = offset - pos.offset;\r\n\r\n\t\t\tif ( howMany !== 0 ) {\r\n\t\t\t\tranges.push( new Range( pos, pos.getShiftedBy( howMany ) ) );\r\n\t\t\t}\r\n\r\n\t\t\tpos.offset = offset;\r\n\t\t\tpos.path.push( 0 );\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/model/treewalker~TreeWalker TreeWalker} instance with this range as a boundary.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/model/treewalker~TreeWalker}.\r\n\t * @param {module:engine/model/position~Position} [options.startPosition]\r\n\t * @param {Boolean} [options.singleCharacters=false]\r\n\t * @param {Boolean} [options.shallow=false]\r\n\t * @param {Boolean} [options.ignoreElementEnd=false]\r\n\t */\r\n\tgetWalker( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\r\n\t\treturn new TreeWalker( options );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all {@link module:engine/model/item~Item items} that are in this range and returns\r\n\t * them.\r\n\t *\r\n\t * This method uses {@link module:engine/model/treewalker~TreeWalker} with `boundaries` set to this range and `ignoreElementEnd` option\r\n\t * set to `true`. However it returns only {@link module:engine/model/item~Item model items},\r\n\t * not {@link module:engine/model/treewalker~TreeWalkerValue}.\r\n\t *\r\n\t * You may specify additional options for the tree walker. See {@link module:engine/model/treewalker~TreeWalker} for\r\n\t * a full list of available options.\r\n\t *\r\n\t * @method getItems\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/model/treewalker~TreeWalker}.\r\n\t * @returns {Iterable.<module:engine/model/item~Item>}\r\n\t */\r\n\t* getItems( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\t\toptions.ignoreElementEnd = true;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\r\n\t\tfor ( const value of treeWalker ) {\r\n\t\t\tyield value.item;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all {@link module:engine/model/position~Position positions} that are boundaries or\r\n\t * contained in this range.\r\n\t *\r\n\t * This method uses {@link module:engine/model/treewalker~TreeWalker} with `boundaries` set to this range. However it returns only\r\n\t * {@link module:engine/model/position~Position positions}, not {@link module:engine/model/treewalker~TreeWalkerValue}.\r\n\t *\r\n\t * You may specify additional options for the tree walker. See {@link module:engine/model/treewalker~TreeWalker} for\r\n\t * a full list of available options.\r\n\t *\r\n\t * @param {Object} options Object with configuration options. See {@link module:engine/model/treewalker~TreeWalker}.\r\n\t * @returns {Iterable.<module:engine/model/position~Position>}\r\n\t */\r\n\t* getPositions( options = {} ) {\r\n\t\toptions.boundaries = this;\r\n\r\n\t\tconst treeWalker = new TreeWalker( options );\r\n\r\n\t\tyield treeWalker.position;\r\n\r\n\t\tfor ( const value of treeWalker ) {\r\n\t\t\tyield value.nextPosition;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a range that is a result of transforming this range by given `operation`.\r\n\t *\r\n\t * **Note:** transformation may break one range into multiple ranges (for example, when a part of the range is\r\n\t * moved to a different part of document tree). For this reason, an array is returned by this method and it\r\n\t * may contain one or more `Range` instances.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation Operation to transform range by.\r\n\t * @returns {Array.<module:engine/model/range~Range>} Range which is the result of transformation.\r\n\t */\r\n\tgetTransformedByOperation( operation ) {\r\n\t\tswitch ( operation.type ) {\r\n\t\t\tcase 'insert':\r\n\t\t\t\treturn this._getTransformedByInsertOperation( operation );\r\n\t\t\tcase 'move':\r\n\t\t\tcase 'remove':\r\n\t\t\tcase 'reinsert':\r\n\t\t\t\treturn this._getTransformedByMoveOperation( operation );\r\n\t\t\tcase 'split':\r\n\t\t\t\treturn [ this._getTransformedBySplitOperation( operation ) ];\r\n\t\t\tcase 'merge':\r\n\t\t\t\treturn [ this._getTransformedByMergeOperation( operation ) ];\r\n\t\t}\r\n\r\n\t\treturn [ new Range( this.start, this.end ) ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a range that is a result of transforming this range by multiple `operations`.\r\n\t *\r\n\t * @see ~Range#getTransformedByOperation\r\n\t * @param {Iterable.<module:engine/model/operation/operation~Operation>} operations Operations to transform the range by.\r\n\t * @returns {Array.<module:engine/model/range~Range>} Range which is the result of transformation.\r\n\t */\r\n\tgetTransformedByOperations( operations ) {\r\n\t\tconst ranges = [ new Range( this.start, this.end ) ];\r\n\r\n\t\tfor ( const operation of operations ) {\r\n\t\t\tfor ( let i = 0; i < ranges.length; i++ ) {\r\n\t\t\t\tconst result = ranges[ i ].getTransformedByOperation( operation );\r\n\r\n\t\t\t\tranges.splice( i, 1, ...result );\r\n\t\t\t\ti += result.length - 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// It may happen that a range is split into two, and then the part of second \"piece\" is moved into first\r\n\t\t// \"piece\". In this case we will have incorrect third range, which should not be included in the result --\r\n\t\t// because it is already included in the first \"piece\". In this loop we are looking for all such ranges that\r\n\t\t// are inside other ranges and we simply remove them.\r\n\t\tfor ( let i = 0; i < ranges.length; i++ ) {\r\n\t\t\tconst range = ranges[ i ];\r\n\r\n\t\t\tfor ( let j = i + 1; j < ranges.length; j++ ) {\r\n\t\t\t\tconst next = ranges[ j ];\r\n\r\n\t\t\t\tif ( range.containsRange( next ) || next.containsRange( range ) || range.isEqual( next ) ) {\r\n\t\t\t\t\tranges.splice( j, 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an {@link module:engine/model/element~Element} or {@link module:engine/model/documentfragment~DocumentFragment}\r\n\t * which is a common ancestor of the range's both ends (in which the entire range is contained).\r\n\t *\r\n\t * @returns {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment|null}\r\n\t */\r\n\tgetCommonAncestor() {\r\n\t\treturn this.start.getCommonAncestor( this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `Range` to plain object and returns it.\r\n\t *\r\n\t * @returns {Object} `Node` converted to plain object.\r\n\t */\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tstart: this.start.toJSON(),\r\n\t\t\tend: this.end.toJSON()\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new range that is equal to current range.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tclone() {\r\n\t\treturn new this.constructor( this.start, this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a result of transforming a copy of this range by insert operation.\r\n\t *\r\n\t * One or more ranges may be returned as a result of this transformation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/insertoperation~InsertOperation} operation\r\n\t * @returns {Array.<module:engine/model/range~Range>}\r\n\t */\r\n\t_getTransformedByInsertOperation( operation, spread = false ) {\r\n\t\treturn this._getTransformedByInsertion( operation.position, operation.howMany, spread );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a result of transforming a copy of this range by move operation.\r\n\t *\r\n\t * One or more ranges may be returned as a result of this transformation.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/moveoperation~MoveOperation} operation\r\n\t * @returns {Array.<module:engine/model/range~Range>}\r\n\t */\r\n\t_getTransformedByMoveOperation( operation, spread = false ) {\r\n\t\tconst sourcePosition = operation.sourcePosition;\r\n\t\tconst howMany = operation.howMany;\r\n\t\tconst targetPosition = operation.targetPosition;\r\n\r\n\t\treturn this._getTransformedByMove( sourcePosition, targetPosition, howMany, spread );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a result of transforming a copy of this range by split operation.\r\n\t *\r\n\t * Always one range is returned. The transformation is done in a way to not break the range.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/splitoperation~SplitOperation} operation\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\t_getTransformedBySplitOperation( operation ) {\r\n\t\tconst start = this.start._getTransformedBySplitOperation( operation );\r\n\t\tlet end = this.end._getTransformedBySplitOperation( operation );\r\n\r\n\t\tif ( this.end.isEqual( operation.insertionPosition ) ) {\r\n\t\t\tend = this.end.getShiftedBy( 1 );\r\n\t\t}\r\n\r\n\t\t// Below may happen when range contains graveyard element used by split operation.\r\n\t\tif ( start.root != end.root ) {\r\n\t\t\t// End position was next to the moved graveyard element and was moved with it.\r\n\t\t\t// Fix it by using old `end` which has proper `root`.\r\n\t\t\tend = this.end.getShiftedBy( -1 );\r\n\t\t}\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a result of transforming a copy of this range by merge operation.\r\n\t *\r\n\t * Always one range is returned. The transformation is done in a way to not break the range.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/operation/mergeoperation~MergeOperation} operation\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\t_getTransformedByMergeOperation( operation ) {\r\n\t\tlet start = this.start._getTransformedByMergeOperation( operation );\r\n\t\tlet end = this.end._getTransformedByMergeOperation( operation );\r\n\r\n\t\tif ( start.root != end.root ) {\r\n\t\t\t// This happens when the end position was next to the merged (deleted) element.\r\n\t\t\t// Then, the end position was moved to the graveyard root. In this case we need to fix\r\n\t\t\t// the range cause its boundaries would be in different roots.\r\n\t\t\tend = this.end.getShiftedBy( -1 );\r\n\t\t}\r\n\r\n\t\tif ( start.isAfter( end ) ) {\r\n\t\t\t// This happens in three following cases:\r\n\t\t\t//\r\n\t\t\t// Case 1: Merge operation source position is before the target position (due to some transformations, OT, etc.)\r\n\t\t\t//         This means that start can be moved before the end of the range.\r\n\t\t\t//\r\n\t\t\t// Before: <p>a{a</p><p>b}b</p><p>cc</p>\r\n\t\t\t// Merge:  <p>b}b</p><p>cca{a</p>\r\n\t\t\t// Fix:    <p>{b}b</p><p>ccaa</p>\r\n\t\t\t//\r\n\t\t\t// Case 2: Range start is before merged node but not directly.\r\n\t\t\t//         Result should include all nodes that were in the original range.\r\n\t\t\t//\r\n\t\t\t// Before: <p>aa</p>{<p>cc</p><p>b}b</p>\r\n\t\t\t// Merge:  <p>aab}b</p>{<p>cc</p>\r\n\t\t\t// Fix:    <p>aa{bb</p><p>cc</p>}\r\n\t\t\t//\r\n\t\t\t//         The range is expanded by an additional `b` letter but it is better than dropping the whole `cc` paragraph.\r\n\t\t\t//\r\n\t\t\t// Case 3: Range start is directly before merged node.\r\n\t\t\t//         Resulting range should include only nodes from the merged element:\r\n\t\t\t//\r\n\t\t\t// Before: <p>aa</p>{<p>b}b</p><p>cc</p>\r\n\t\t\t// Merge:  <p>aab}b</p>{<p>cc</p>\r\n\t\t\t// Fix:    <p>aa{b}b</p><p>cc</p>\r\n\t\t\t//\r\n\r\n\t\t\tif ( operation.sourcePosition.isBefore( operation.targetPosition ) ) {\r\n\t\t\t\t// Case 1.\r\n\t\t\t\tstart = Position._createAt( end );\r\n\t\t\t\tstart.offset = 0;\r\n\t\t\t} else {\r\n\t\t\t\tif ( !operation.deletionPosition.isEqual( start ) ) {\r\n\t\t\t\t\t// Case 2.\r\n\t\t\t\t\tend = operation.deletionPosition;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// In both case 2 and 3 start is at the end of the merge-to element.\r\n\t\t\t\tstart = operation.targetPosition;\r\n\t\t\t}\r\n\r\n\t\t\treturn new Range( start, end );\r\n\t\t}\r\n\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array containing one or two {@link ~Range ranges} that are a result of transforming this\r\n\t * {@link ~Range range} by inserting `howMany` nodes at `insertPosition`. Two {@link ~Range ranges} are\r\n\t * returned if the insertion was inside this {@link ~Range range} and `spread` is set to `true`.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tlet range = model.createRange(\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 2, 7 ] ),\r\n\t *\t\t\tmodel.createPositionFromPath( root, [ 4, 0, 1 ] )\r\n\t *\t\t);\r\n\t *\t\tlet transformed = range._getTransformedByInsertion( model.createPositionFromPath( root, [ 1 ] ), 2 );\r\n\t *\t\t// transformed array has one range from [ 4, 7 ] to [ 6, 0, 1 ]\r\n\t *\r\n\t *\t\ttransformed = range._getTransformedByInsertion( model.createPositionFromPath( root, [ 4, 0, 0 ] ), 4 );\r\n\t *\t\t// transformed array has one range from [ 2, 7 ] to [ 4, 0, 5 ]\r\n\t *\r\n\t *\t\ttransformed = range._getTransformedByInsertion( model.createPositionFromPath( root, [ 3, 2 ] ), 4 );\r\n\t *\t\t// transformed array has one range, which is equal to original range\r\n\t *\r\n\t *\t\ttransformed = range._getTransformedByInsertion( model.createPositionFromPath( root, [ 3, 2 ] ), 4, true );\r\n\t *\t\t// transformed array has two ranges: from [ 2, 7 ] to [ 3, 2 ] and from [ 3, 6 ] to [ 4, 0, 1 ]\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} insertPosition Position where nodes are inserted.\r\n\t * @param {Number} howMany How many nodes are inserted.\r\n\t * @param {Boolean} [spread] Flag indicating whether this {~Range range} should be spread if insertion\r\n\t * was inside the range. Defaults to `false`.\r\n\t * @returns {Array.<module:engine/model/range~Range>} Result of the transformation.\r\n\t */\r\n\t_getTransformedByInsertion( insertPosition, howMany, spread = false ) {\r\n\t\tif ( spread && this.containsPosition( insertPosition ) ) {\r\n\t\t\t// Range has to be spread. The first part is from original start to the spread point.\r\n\t\t\t// The other part is from spread point to the original end, but transformed by\r\n\t\t\t// insertion to reflect insertion changes.\r\n\r\n\t\t\treturn [\r\n\t\t\t\tnew Range( this.start, insertPosition ),\r\n\t\t\t\tnew Range(\r\n\t\t\t\t\tinsertPosition.getShiftedBy( howMany ),\r\n\t\t\t\t\tthis.end._getTransformedByInsertion( insertPosition, howMany )\r\n\t\t\t\t)\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\tconst range = new Range( this.start, this.end );\r\n\r\n\t\t\trange.start = range.start._getTransformedByInsertion( insertPosition, howMany );\r\n\t\t\trange.end = range.end._getTransformedByInsertion( insertPosition, howMany );\r\n\r\n\t\t\treturn [ range ];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array containing {@link ~Range ranges} that are a result of transforming this\r\n\t * {@link ~Range range} by moving `howMany` nodes from `sourcePosition` to `targetPosition`.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} sourcePosition Position from which nodes are moved.\r\n\t * @param {module:engine/model/position~Position} targetPosition Position to where nodes are moved.\r\n\t * @param {Number} howMany How many nodes are moved.\r\n\t * @param {Boolean} [spread=false] Whether the range should be spread if the move points inside the range.\r\n\t * @returns {Array.<module:engine/model/range~Range>} Result of the transformation.\r\n\t */\r\n\t_getTransformedByMove( sourcePosition, targetPosition, howMany, spread = false ) {\r\n\t\t// Special case for transforming a collapsed range. Just transform it like a position.\r\n\t\tif ( this.isCollapsed ) {\r\n\t\t\tconst newPos = this.start._getTransformedByMove( sourcePosition, targetPosition, howMany );\r\n\r\n\t\t\treturn [ new Range( newPos ) ];\r\n\t\t}\r\n\r\n\t\t// Special case for transformation when a part of the range is moved towards the range.\r\n\t\t//\r\n\t\t// Examples:\r\n\t\t//\r\n\t\t// <div><p>ab</p><p>c[d</p></div><p>e]f</p> --> <div><p>ab</p></div><p>c[d</p><p>e]f</p>\r\n\t\t// <p>e[f</p><div><p>a]b</p><p>cd</p></div> --> <p>e[f</p><p>a]b</p><div><p>cd</p></div>\r\n\t\t//\r\n\t\t// Without this special condition, the default algorithm leaves an \"artifact\" range from one of `differenceSet` parts:\r\n\t\t//\r\n\t\t// <div><p>ab</p><p>c[d</p></div><p>e]f</p> --> <div><p>ab</p>{</div>}<p>c[d</p><p>e]f</p>\r\n\t\t//\r\n\t\t// This special case is applied only if the range is to be kept together (not spread).\r\n\t\tconst moveRange = Range._createFromPositionAndShift( sourcePosition, howMany );\r\n\t\tconst insertPosition = targetPosition._getTransformedByDeletion( sourcePosition, howMany );\r\n\r\n\t\tif ( this.containsPosition( targetPosition ) && !spread ) {\r\n\t\t\tif ( moveRange.containsPosition( this.start ) || moveRange.containsPosition( this.end ) ) {\r\n\t\t\t\tconst start = this.start._getTransformedByMove( sourcePosition, targetPosition, howMany );\r\n\t\t\t\tconst end = this.end._getTransformedByMove( sourcePosition, targetPosition, howMany );\r\n\r\n\t\t\t\treturn [ new Range( start, end ) ];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Default algorithm.\r\n\t\tlet result;\r\n\r\n\t\tconst differenceSet = this.getDifference( moveRange );\r\n\t\tlet difference = null;\r\n\r\n\t\tconst common = this.getIntersection( moveRange );\r\n\r\n\t\tif ( differenceSet.length == 1 ) {\r\n\t\t\t// `moveRange` and this range may intersect but may be separate.\r\n\t\t\tdifference = new Range(\r\n\t\t\t\tdifferenceSet[ 0 ].start._getTransformedByDeletion( sourcePosition, howMany ),\r\n\t\t\t\tdifferenceSet[ 0 ].end._getTransformedByDeletion( sourcePosition, howMany )\r\n\t\t\t);\r\n\t\t} else if ( differenceSet.length == 2 ) {\r\n\t\t\t// `moveRange` is inside this range.\r\n\t\t\tdifference = new Range(\r\n\t\t\t\tthis.start,\r\n\t\t\t\tthis.end._getTransformedByDeletion( sourcePosition, howMany )\r\n\t\t\t);\r\n\t\t} // else, `moveRange` contains this range.\r\n\r\n\t\tif ( difference ) {\r\n\t\t\tresult = difference._getTransformedByInsertion( insertPosition, howMany, common !== null || spread );\r\n\t\t} else {\r\n\t\t\tresult = [];\r\n\t\t}\r\n\r\n\t\tif ( common ) {\r\n\t\t\tconst transformedCommon = new Range(\r\n\t\t\t\tcommon.start._getCombined( moveRange.start, insertPosition ),\r\n\t\t\t\tcommon.end._getCombined( moveRange.start, insertPosition )\r\n\t\t\t);\r\n\r\n\t\t\tif ( result.length == 2 ) {\r\n\t\t\t\tresult.splice( 1, 0, transformedCommon );\r\n\t\t\t} else {\r\n\t\t\t\tresult.push( transformedCommon );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of this range that is transformed by deletion of `howMany` nodes from `deletePosition`.\r\n\t *\r\n\t * If the deleted range is intersecting with the transformed range, the transformed range will be shrank.\r\n\t *\r\n\t * If the deleted range contains transformed range, `null` will be returned.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} deletionPosition Position from which nodes are removed.\r\n\t * @param {Number} howMany How many nodes are removed.\r\n\t * @returns {module:engine/model/range~Range|null} Result of the transformation.\r\n\t */\r\n\t_getTransformedByDeletion( deletePosition, howMany ) {\r\n\t\tlet newStart = this.start._getTransformedByDeletion( deletePosition, howMany );\r\n\t\tlet newEnd = this.end._getTransformedByDeletion( deletePosition, howMany );\r\n\r\n\t\tif ( newStart == null && newEnd == null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif ( newStart == null ) {\r\n\t\t\tnewStart = deletePosition;\r\n\t\t}\r\n\r\n\t\tif ( newEnd == null ) {\r\n\t\t\tnewEnd = deletePosition;\r\n\t\t}\r\n\r\n\t\treturn new Range( newStart, newEnd );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new range, spreading from specified {@link module:engine/model/position~Position position} to a position moved by\r\n\t * given `shift`. If `shift` is a negative value, shifted position is treated as the beginning of the range.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/position~Position} position Beginning of the range.\r\n\t * @param {Number} shift How long the range should be.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tstatic _createFromPositionAndShift( position, shift ) {\r\n\t\tconst start = position;\r\n\t\tconst end = position.getShiftedBy( shift );\r\n\r\n\t\treturn shift > 0 ? new this( start, end ) : new this( end, start );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside an {@link module:engine/model/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tstatic _createIn( element ) {\r\n\t\treturn new this( Position._createAt( element, 0 ), Position._createAt( element, element.maxOffset ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before given {@link module:engine/model/item~Item model item} and ends after it.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/item~Item} item\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tstatic _createOn( item ) {\r\n\t\treturn this._createFromPositionAndShift( Position._createBefore( item ), item.offsetSize );\r\n\t}\r\n\r\n\t/**\r\n\t * Combines all ranges from the passed array into a one range. At least one range has to be passed.\r\n\t * Passed ranges must not have common parts.\r\n\t *\r\n\t * The first range from the array is a reference range. If other ranges start or end on the exactly same position where\r\n\t * the reference range, they get combined into one range.\r\n\t *\r\n\t *\t\t[  ][]  [    ][ ][             ][ ][]  [  ]  // Passed ranges, shown sorted\r\n\t *\t\t[    ]                                       // The result of the function if the first range was a reference range.\r\n\t *\t            [                           ]        // The result of the function if the third-to-seventh range was a reference range.\r\n\t *\t                                           [  ]  // The result of the function if the last range was a reference range.\r\n\t *\r\n\t * @param {Array.<module:engine/model/range~Range>} ranges Ranges to combine.\r\n\t * @returns {module:engine/model/range~Range} Combined range.\r\n\t */\r\n\tstatic _createFromRanges( ranges ) {\r\n\t\tif ( ranges.length === 0 ) {\r\n\t\t\t/**\r\n\t\t\t * At least one range has to be passed to\r\n\t\t\t * {@link module:engine/model/range~Range._createFromRanges `Range._createFromRanges()`}.\r\n\t\t\t *\r\n\t\t\t * @error range-create-from-ranges-empty-array\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'range-create-from-ranges-empty-array: At least one range has to be passed.' );\r\n\t\t} else if ( ranges.length == 1 ) {\r\n\t\t\treturn ranges[ 0 ].clone();\r\n\t\t}\r\n\r\n\t\t// 1. Set the first range in `ranges` array as a reference range.\r\n\t\t// If we are going to return just a one range, one of the ranges need to be the reference one.\r\n\t\t// Other ranges will be stuck to that range, if possible.\r\n\t\tconst ref = ranges[ 0 ];\r\n\r\n\t\t// 2. Sort all the ranges so it's easier to process them.\r\n\t\tranges.sort( ( a, b ) => {\r\n\t\t\treturn a.start.isAfter( b.start ) ? 1 : -1;\r\n\t\t} );\r\n\r\n\t\t// 3. Check at which index the reference range is now.\r\n\t\tconst refIndex = ranges.indexOf( ref );\r\n\r\n\t\t// 4. At this moment we don't need the original range.\r\n\t\t// We are going to modify the result and we need to return a new instance of Range.\r\n\t\t// We have to create a copy of the reference range.\r\n\t\tconst result = new this( ref.start, ref.end );\r\n\r\n\t\t// 5. Ranges should be checked and glued starting from the range that is closest to the reference range.\r\n\t\t// Since ranges are sorted, start with the range with index that is closest to reference range index.\r\n\t\tif ( refIndex > 0 ) {\r\n\t\t\tfor ( let i = refIndex - 1; true; i++ ) {\r\n\t\t\t\tif ( ranges[ i ].end.isEqual( result.start ) ) {\r\n\t\t\t\t\tresult.start = Position._createAt( ranges[ i ].start );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If ranges are not starting/ending at the same position there is no point in looking further.\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 6. Ranges should be checked and glued starting from the range that is closest to the reference range.\r\n\t\t// Since ranges are sorted, start with the range with index that is closest to reference range index.\r\n\t\tfor ( let i = refIndex + 1; i < ranges.length; i++ ) {\r\n\t\t\tif ( ranges[ i ].start.isEqual( result.end ) ) {\r\n\t\t\t\tresult.end = Position._createAt( ranges[ i ].end );\r\n\t\t\t} else {\r\n\t\t\t\t// If ranges are not starting/ending at the same position there is no point in looking further.\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `Range` instance from given plain object (i.e. parsed JSON string).\r\n\t *\r\n\t * @param {Object} json Plain object to be converted to `Range`.\r\n\t * @param {module:engine/model/document~Document} doc Document object that will be range owner.\r\n\t * @returns {module:engine/model/element~Element} `Range` instance created using given plain object.\r\n\t */\r\n\tstatic fromJSON( json, doc ) {\r\n\t\treturn new this( Position.fromJSON( json.start, doc ), Position.fromJSON( json.end, doc ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/mapper\r\n */\r\n\r\nimport ModelPosition from '../model/position';\r\nimport ModelRange from '../model/range';\r\n\r\nimport ViewPosition from '../view/position';\r\nimport ViewRange from '../view/range';\r\nimport ViewText from '../view/text';\r\n\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Maps elements, positions and markers between {@link module:engine/view/document~Document the view} and\r\n * {@link module:engine/model/model the model}.\r\n *\r\n * Mapper use bound elements to find corresponding elements and positions, so, to get proper results,\r\n * all model elements should be {@link module:engine/conversion/mapper~Mapper#bindElements bound}.\r\n *\r\n * To map complex model to/from view relations, you may provide custom callbacks for\r\n * {@link module:engine/conversion/mapper~Mapper#event:modelToViewPosition modelToViewPosition event} and\r\n * {@link module:engine/conversion/mapper~Mapper#event:viewToModelPosition viewToModelPosition event} that are fired whenever\r\n * a position mapping request occurs.\r\n * Those events are fired by {@link module:engine/conversion/mapper~Mapper#toViewPosition toViewPosition}\r\n * and {@link module:engine/conversion/mapper~Mapper#toModelPosition toModelPosition} methods. `Mapper` adds it's own default callbacks\r\n * with `'lowest'` priority. To override default `Mapper` mapping, add custom callback with higher priority and\r\n * stop the event.\r\n */\r\nexport default class Mapper {\r\n\t/**\r\n\t * Creates an instance of the mapper.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Model element to view element mapping.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakMap}\r\n\t\t */\r\n\t\tthis._modelToViewMapping = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * View element to model element mapping.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakMap}\r\n\t\t */\r\n\t\tthis._viewToModelMapping = new WeakMap();\r\n\r\n\t\t/**\r\n\t\t * A map containing callbacks between view element names and functions evaluating length of view elements\r\n\t\t * in model.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._viewToModelLengthCallbacks = new Map();\r\n\r\n\t\t/**\r\n\t\t * Model marker name to view elements mapping.\r\n\t\t *\r\n\t\t * Keys are `String`s while values are `Set`s with {@link module:engine/view/element~Element view elements}.\r\n\t\t * One marker (name) can be mapped to multiple elements.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._markerNameToElements = new Map();\r\n\r\n\t\t// Default mapper algorithm for mapping model position to view position.\r\n\t\tthis.on( 'modelToViewPosition', ( evt, data ) => {\r\n\t\t\tif ( data.viewPosition ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst viewContainer = this._modelToViewMapping.get( data.modelPosition.parent );\r\n\r\n\t\t\tdata.viewPosition = this._findPositionIn( viewContainer, data.modelPosition.offset );\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// Default mapper algorithm for mapping view position to model position.\r\n\t\tthis.on( 'viewToModelPosition', ( evt, data ) => {\r\n\t\t\tif ( data.modelPosition ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet viewBlock = data.viewPosition.parent;\r\n\t\t\tlet modelParent = this._viewToModelMapping.get( viewBlock );\r\n\r\n\t\t\twhile ( !modelParent ) {\r\n\t\t\t\tviewBlock = viewBlock.parent;\r\n\t\t\t\tmodelParent = this._viewToModelMapping.get( viewBlock );\r\n\t\t\t}\r\n\r\n\t\t\tconst modelOffset = this._toModelOffset( data.viewPosition.parent, data.viewPosition.offset, viewBlock );\r\n\r\n\t\t\tdata.modelPosition = ModelPosition._createAt( modelParent, modelOffset );\r\n\t\t}, { priority: 'low' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Marks model and view elements as corresponding. Corresponding elements can be retrieved by using\r\n\t * the {@link module:engine/conversion/mapper~Mapper#toModelElement toModelElement} and\r\n\t * {@link module:engine/conversion/mapper~Mapper#toViewElement toViewElement} methods.\r\n\t * The information that elements are bound is also used to translate positions.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} modelElement Model element.\r\n\t * @param {module:engine/view/element~Element} viewElement View element.\r\n\t */\r\n\tbindElements( modelElement, viewElement ) {\r\n\t\tthis._modelToViewMapping.set( modelElement, viewElement );\r\n\t\tthis._viewToModelMapping.set( viewElement, modelElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds given {@link module:engine/view/element~Element view element} from the map.\r\n\t *\r\n\t * **Note:** view-to-model binding will be removed, if it existed. However, corresponding model-to-view binding\r\n\t * will be removed only if model element is still bound to passed `viewElement`.\r\n\t *\r\n\t * This behavior lets for re-binding model element to another view element without fear of losing the new binding\r\n\t * when the previously bound view element is unbound.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} viewElement View element to unbind.\r\n\t */\r\n\tunbindViewElement( viewElement ) {\r\n\t\tconst modelElement = this.toModelElement( viewElement );\r\n\r\n\t\tthis._viewToModelMapping.delete( viewElement );\r\n\r\n\t\tif ( this._modelToViewMapping.get( modelElement ) == viewElement ) {\r\n\t\t\tthis._modelToViewMapping.delete( modelElement );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds given {@link module:engine/model/element~Element model element} from the map.\r\n\t *\r\n\t * **Note:** model-to-view binding will be removed, if it existed. However, corresponding view-to-model binding\r\n\t * will be removed only if view element is still bound to passed `modelElement`.\r\n\t *\r\n\t * This behavior lets for re-binding view element to another model element without fear of losing the new binding\r\n\t * when the previously bound model element is unbound.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} modelElement Model element to unbind.\r\n\t */\r\n\tunbindModelElement( modelElement ) {\r\n\t\tconst viewElement = this.toViewElement( modelElement );\r\n\r\n\t\tthis._modelToViewMapping.delete( modelElement );\r\n\r\n\t\tif ( this._viewToModelMapping.get( viewElement ) == modelElement ) {\r\n\t\t\tthis._viewToModelMapping.delete( viewElement );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Binds given marker name with given {@link module:engine/view/element~Element view element}. The element\r\n\t * will be added to the current set of elements bound with given marker name.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} element Element to bind.\r\n\t * @param {String} name Marker name.\r\n\t */\r\n\tbindElementToMarker( element, name ) {\r\n\t\tconst elements = this._markerNameToElements.get( name ) || new Set();\r\n\r\n\t\telements.add( element );\r\n\r\n\t\tthis._markerNameToElements.set( name, elements );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds all elements from given marker name.\r\n\t *\r\n\t * @param {String} name Marker name.\r\n\t */\r\n\tunbindElementsFromMarkerName( name ) {\r\n\t\tthis._markerNameToElements.delete( name );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all model to view and view to model bindings.\r\n\t */\r\n\tclearBindings() {\r\n\t\tthis._modelToViewMapping = new WeakMap();\r\n\t\tthis._viewToModelMapping = new WeakMap();\r\n\t\tthis._markerNameToElements = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding model element.\r\n\t *\r\n\t * **Note:** {@link module:engine/view/uielement~UIElement} does not have corresponding element in model.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} viewElement View element.\r\n\t * @returns {module:engine/model/element~Element|undefined} Corresponding model element or `undefined` if not found.\r\n\t */\r\n\ttoModelElement( viewElement ) {\r\n\t\treturn this._viewToModelMapping.get( viewElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding view element.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} modelElement Model element.\r\n\t * @returns {module:engine/view/element~Element|undefined} Corresponding view element or `undefined` if not found.\r\n\t */\r\n\ttoViewElement( modelElement ) {\r\n\t\treturn this._modelToViewMapping.get( modelElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding model range.\r\n\t *\r\n\t * @param {module:engine/view/range~Range} viewRange View range.\r\n\t * @returns {module:engine/model/range~Range} Corresponding model range.\r\n\t */\r\n\ttoModelRange( viewRange ) {\r\n\t\treturn new ModelRange( this.toModelPosition( viewRange.start ), this.toModelPosition( viewRange.end ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding view range.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} modelRange Model range.\r\n\t * @returns {module:engine/view/range~Range} Corresponding view range.\r\n\t */\r\n\ttoViewRange( modelRange ) {\r\n\t\treturn new ViewRange( this.toViewPosition( modelRange.start ), this.toViewPosition( modelRange.end ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding model position.\r\n\t *\r\n\t * @fires viewToModelPosition\r\n\t * @param {module:engine/view/position~Position} viewPosition View position.\r\n\t * @returns {module:engine/model/position~Position} Corresponding model position.\r\n\t */\r\n\ttoModelPosition( viewPosition ) {\r\n\t\tconst data = {\r\n\t\t\tviewPosition,\r\n\t\t\tmapper: this\r\n\t\t};\r\n\r\n\t\tthis.fire( 'viewToModelPosition', data );\r\n\r\n\t\treturn data.modelPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the corresponding view position.\r\n\t *\r\n\t * @fires modelToViewPosition\r\n\t * @param {module:engine/model/position~Position} modelPosition Model position.\r\n\t * @param {Object} [options] Additional options for position mapping process.\r\n\t * @param {Boolean} [options.isPhantom=false] Should be set to `true` if the model position to map is pointing to a place\r\n\t * in model tree which no longer exists. For example, it could be an end of a removed model range.\r\n\t * @returns {module:engine/view/position~Position} Corresponding view position.\r\n\t */\r\n\ttoViewPosition( modelPosition, options = { isPhantom: false } ) {\r\n\t\tconst data = {\r\n\t\t\tmodelPosition,\r\n\t\t\tmapper: this,\r\n\t\t\tisPhantom: options.isPhantom\r\n\t\t};\r\n\r\n\t\tthis.fire( 'modelToViewPosition', data );\r\n\r\n\t\treturn data.viewPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets all view elements bound to the given marker name.\r\n\t *\r\n\t * @param {String} name Marker name.\r\n\t * @returns {Set.<module:engine/view/element~Element>|null} View elements bound with given marker name or `null`\r\n\t * if no elements are bound to given marker name.\r\n\t */\r\n\tmarkerNameToElements( name ) {\r\n\t\tconst boundElements = this._markerNameToElements.get( name );\r\n\r\n\t\tif ( !boundElements ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst elements = new Set();\r\n\r\n\t\tfor ( const element of boundElements ) {\r\n\t\t\tif ( element.is( 'attributeElement' ) ) {\r\n\t\t\t\tfor ( const clone of element.getElementsWithSameId() ) {\r\n\t\t\t\t\telements.add( clone );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telements.add( element );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn elements;\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a callback that evaluates the length in the model of a view element with given name.\r\n\t *\r\n\t * The callback is fired with one argument, which is a view element instance. The callback is expected to return\r\n\t * a number representing the length of view element in model.\r\n\t *\r\n\t *\t\t// List item in view may contain nested list, which have other list items. In model though,\r\n\t *\t\t// the lists are represented by flat structure. Because of those differences, length of list view element\r\n\t *\t\t// may be greater than one. In the callback it's checked how many nested list items are in evaluated list item.\r\n\t *\r\n\t *\t\tfunction getViewListItemLength( element ) {\r\n\t *\t\t\tlet length = 1;\r\n\t *\r\n\t *\t\t\tfor ( let child of element.getChildren() ) {\r\n\t *\t\t\t\tif ( child.name == 'ul' || child.name == 'ol' ) {\r\n\t *\t\t\t\t\tfor ( let item of child.getChildren() ) {\r\n\t *\t\t\t\t\t\tlength += getViewListItemLength( item );\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\treturn length;\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tmapper.registerViewToModelLength( 'li', getViewListItemLength );\r\n\t *\r\n\t * @param {String} viewElementName Name of view element for which callback is registered.\r\n\t * @param {Function} lengthCallback Function return a length of view element instance in model.\r\n\t */\r\n\tregisterViewToModelLength( viewElementName, lengthCallback ) {\r\n\t\tthis._viewToModelLengthCallbacks.set( viewElementName, lengthCallback );\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates model offset based on the view position and the block element.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t *\t\t<p>foo<b>ba|r</b></p> // _toModelOffset( b, 2, p ) -> 5\r\n\t *\r\n\t * Is a sum of:\r\n\t *\r\n\t *\t\t<p>foo|<b>bar</b></p> // _toModelOffset( p, 3, p ) -> 3\r\n\t *\t\t<p>foo<b>ba|r</b></p> // _toModelOffset( b, 2, b ) -> 2\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} viewParent Position parent.\r\n\t * @param {Number} viewOffset Position offset.\r\n\t * @param {module:engine/view/element~Element} viewBlock Block used as a base to calculate offset.\r\n\t * @returns {Number} Offset in the model.\r\n\t */\r\n\t_toModelOffset( viewParent, viewOffset, viewBlock ) {\r\n\t\tif ( viewBlock != viewParent ) {\r\n\t\t\t// See example.\r\n\t\t\tconst offsetToParentStart = this._toModelOffset( viewParent.parent, viewParent.index, viewBlock );\r\n\t\t\tconst offsetInParent = this._toModelOffset( viewParent, viewOffset, viewParent );\r\n\r\n\t\t\treturn offsetToParentStart + offsetInParent;\r\n\t\t}\r\n\r\n\t\t// viewBlock == viewParent, so we need to calculate the offset in the parent element.\r\n\r\n\t\t// If the position is a text it is simple (\"ba|r\" -> 2).\r\n\t\tif ( viewParent.is( 'text' ) ) {\r\n\t\t\treturn viewOffset;\r\n\t\t}\r\n\r\n\t\t// If the position is in an element we need to sum lengths of siblings ( <b> bar </b> foo | -> 3 + 3 = 6 ).\r\n\t\tlet modelOffset = 0;\r\n\r\n\t\tfor ( let i = 0; i < viewOffset; i++ ) {\r\n\t\t\tmodelOffset += this.getModelLength( viewParent.getChild( i ) );\r\n\t\t}\r\n\r\n\t\treturn modelOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the length of the view element in the model.\r\n\t *\r\n\t * The length is calculated as follows:\r\n\t * * if {@link #registerViewToModelLength length mapping callback} is provided for given `viewNode` it is used to\r\n\t * evaluate model length (`viewNode` is used as first and only parameter passed to the callback),\r\n\t * * length of a {@link module:engine/view/text~Text text node} is equal to the length of it's\r\n\t * {@link module:engine/view/text~Text#data data},\r\n\t * * length of a {@link module:engine/view/uielement~UIElement ui element} is equal to 0,\r\n\t * * length of a mapped {@link module:engine/view/element~Element element} is equal to 1,\r\n\t * * length of a not-mapped {@link module:engine/view/element~Element element} is equal to the length of it's children.\r\n\t *\r\n\t * Examples:\r\n\t *\r\n\t *\t\tfoo                          -> 3 // Text length is equal to it's data length.\r\n\t *\t\t<p>foo</p>                   -> 1 // Length of an element which is mapped is by default equal to 1.\r\n\t *\t\t<b>foo</b>                   -> 3 // Length of an element which is not mapped is a length of its children.\r\n\t *\t\t<div><p>x</p><p>y</p></div>  -> 2 // Assuming that <div> is not mapped and <p> are mapped.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} viewNode View node.\r\n\t * @returns {Number} Length of the node in the tree model.\r\n\t */\r\n\tgetModelLength( viewNode ) {\r\n\t\tif ( this._viewToModelLengthCallbacks.get( viewNode.name ) ) {\r\n\t\t\tconst callback = this._viewToModelLengthCallbacks.get( viewNode.name );\r\n\r\n\t\t\treturn callback( viewNode );\r\n\t\t} else if ( this._viewToModelMapping.has( viewNode ) ) {\r\n\t\t\treturn 1;\r\n\t\t} else if ( viewNode.is( 'text' ) ) {\r\n\t\t\treturn viewNode.data.length;\r\n\t\t} else if ( viewNode.is( 'uiElement' ) ) {\r\n\t\t\treturn 0;\r\n\t\t} else {\r\n\t\t\tlet len = 0;\r\n\r\n\t\t\tfor ( const child of viewNode.getChildren() ) {\r\n\t\t\t\tlen += this.getModelLength( child );\r\n\t\t\t}\r\n\r\n\t\t\treturn len;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the position in the view node (or its children) with the expected model offset.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t *\t\t<p>fo<b>bar</b>bom</p> -> expected offset: 4\r\n\t *\r\n\t *\t\t_findPositionIn( p, 4 ):\r\n\t *\t\t<p>|fo<b>bar</b>bom</p> -> expected offset: 4, actual offset: 0\r\n\t *\t\t<p>fo|<b>bar</b>bom</p> -> expected offset: 4, actual offset: 2\r\n\t *\t\t<p>fo<b>bar</b>|bom</p> -> expected offset: 4, actual offset: 5 -> we are too far\r\n\t *\r\n\t *\t\t_findPositionIn( b, 4 - ( 5 - 3 ) ):\r\n\t *\t\t<p>fo<b>|bar</b>bom</p> -> expected offset: 2, actual offset: 0\r\n\t *\t\t<p>fo<b>bar|</b>bom</p> -> expected offset: 2, actual offset: 3 -> we are too far\r\n\t *\r\n\t *\t\t_findPositionIn( bar, 2 - ( 3 - 3 ) ):\r\n\t *\t\tWe are in the text node so we can simple find the offset.\r\n\t *\t\t<p>fo<b>ba|r</b>bom</p> -> expected offset: 2, actual offset: 2 -> position found\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/element~Element} viewParent Tree view element in which we are looking for the position.\r\n\t * @param {Number} expectedOffset Expected offset.\r\n\t * @returns {module:engine/view/position~Position} Found position.\r\n\t */\r\n\t_findPositionIn( viewParent, expectedOffset ) {\r\n\t\t// Last scanned view node.\r\n\t\tlet viewNode;\r\n\t\t// Length of the last scanned view node.\r\n\t\tlet lastLength = 0;\r\n\r\n\t\tlet modelOffset = 0;\r\n\t\tlet viewOffset = 0;\r\n\r\n\t\t// In the text node it is simple: offset in the model equals offset in the text.\r\n\t\tif ( viewParent.is( 'text' ) ) {\r\n\t\t\treturn new ViewPosition( viewParent, expectedOffset );\r\n\t\t}\r\n\r\n\t\t// In other cases we add lengths of child nodes to find the proper offset.\r\n\r\n\t\t// If it is smaller we add the length.\r\n\t\twhile ( modelOffset < expectedOffset ) {\r\n\t\t\tviewNode = viewParent.getChild( viewOffset );\r\n\t\t\tlastLength = this.getModelLength( viewNode );\r\n\t\t\tmodelOffset += lastLength;\r\n\t\t\tviewOffset++;\r\n\t\t}\r\n\r\n\t\t// If it equals we found the position.\r\n\t\tif ( modelOffset == expectedOffset ) {\r\n\t\t\treturn this._moveViewPositionToTextNode( new ViewPosition( viewParent, viewOffset ) );\r\n\t\t}\r\n\t\t// If it is higher we need to enter last child.\r\n\t\telse {\r\n\t\t\t// ( modelOffset - lastLength ) is the offset to the child we enter,\r\n\t\t\t// so we subtract it from the expected offset to fine the offset in the child.\r\n\t\t\treturn this._findPositionIn( viewNode, expectedOffset - ( modelOffset - lastLength ) );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Because we prefer positions in text nodes over positions next to text node moves view position to the text node\r\n\t * if it was next to it.\r\n\t *\r\n\t *\t\t<p>[]<b>foo</b></p> -> <p>[]<b>foo</b></p> // do not touch if position is not directly next to text\r\n\t *\t\t<p>foo[]<b>foo</b></p> -> <p>foo{}<b>foo</b></p> // move to text node\r\n\t *\t\t<p><b>[]foo</b></p> -> <p><b>{}foo</b></p> // move to text node\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/position~Position} viewPosition Position potentially next to text node.\r\n\t * @returns {module:engine/view/position~Position} Position in text node if possible.\r\n\t */\r\n\t_moveViewPositionToTextNode( viewPosition ) {\r\n\t\t// If the position is just after text node, put it at the end of that text node.\r\n\t\t// If the position is just before text node, put it at the beginning of that text node.\r\n\t\tconst nodeBefore = viewPosition.nodeBefore;\r\n\t\tconst nodeAfter = viewPosition.nodeAfter;\r\n\r\n\t\tif ( nodeBefore instanceof ViewText ) {\r\n\t\t\treturn new ViewPosition( nodeBefore, nodeBefore.data.length );\r\n\t\t} else if ( nodeAfter instanceof ViewText ) {\r\n\t\t\treturn new ViewPosition( nodeAfter, 0 );\r\n\t\t}\r\n\r\n\t\t// Otherwise, just return the given position.\r\n\t\treturn viewPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Fired for each model-to-view position mapping request. The purpose of this event is to enable custom model-to-view position\r\n\t * mapping. Callbacks added to this event take {@link module:engine/model/position~Position model position} and are expected to\r\n\t * calculate {@link module:engine/view/position~Position view position}. Calculated view position should be added as `viewPosition`\r\n\t * value in `data` object that is passed as one of parameters to the event callback.\r\n\t *\r\n\t * \t\t// Assume that \"captionedImage\" model element is converted to <img> and following <span> elements in view,\r\n\t * \t\t// and the model element is bound to <img> element. Force mapping model positions inside \"captionedImage\" to that\r\n\t * \t\t// <span> element.\r\n\t *\t\tmapper.on( 'modelToViewPosition', ( evt, data ) => {\r\n\t *\t\t\tconst positionParent = modelPosition.parent;\r\n\t *\r\n\t *\t\t\tif ( positionParent.name == 'captionedImage' ) {\r\n\t *\t\t\t\tconst viewImg = data.mapper.toViewElement( positionParent );\r\n\t *\t\t\t\tconst viewCaption = viewImg.nextSibling; // The <span> element.\r\n\t *\r\n\t *\t\t\t\tdata.viewPosition = new ViewPosition( viewCaption, modelPosition.offset );\r\n\t *\r\n\t *\t\t\t\t// Stop the event if other callbacks should not modify calculated value.\r\n\t *\t\t\t\tevt.stop();\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * **Note:** keep in mind that sometimes a \"phantom\" model position is being converted. \"Phantom\" model position is\r\n\t * a position that points to a non-existing place in model. Such position might still be valid for conversion, though\r\n\t * (it would point to a correct place in view when converted). One example of such situation is when a range is\r\n\t * removed from model, there may be a need to map the range's end (which is no longer valid model position). To\r\n\t * handle such situation, check `data.isPhantom` flag:\r\n\t *\r\n\t * \t\t// Assume that there is \"customElement\" model element and whenever position is before it, we want to move it\r\n\t * \t\t// to the inside of the view element bound to \"customElement\".\r\n\t *\t\tmapper.on( 'modelToViewPosition', ( evt, data ) => {\r\n\t *\t\t\tif ( data.isPhantom ) {\r\n\t *\t\t\t\treturn;\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\t// Below line might crash for phantom position that does not exist in model.\r\n\t *\t\t\tconst sibling = data.modelPosition.nodeBefore;\r\n\t *\r\n\t *\t\t\t// Check if this is the element we are interested in.\r\n\t *\t\t\tif ( !sibling.is( 'customElement' ) ) {\r\n\t *\t\t\t\treturn;\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\tconst viewElement = data.mapper.toViewElement( sibling );\r\n\t *\r\n\t *\t\t\tdata.viewPosition = new ViewPosition( sibling, 0 );\r\n\t *\r\n\t *\t\t\tevt.stop();\r\n\t *\t\t} );\r\n\t *\r\n\t * **Note:** default mapping callback is provided with `low` priority setting and does not cancel the event, so it is possible to\r\n\t * attach a custom callback after default callback and also use `data.viewPosition` calculated by default callback\r\n\t * (for example to fix it).\r\n\t *\r\n\t * **Note:** default mapping callback will not fire if `data.viewPosition` is already set.\r\n\t *\r\n\t * **Note:** these callbacks are called **very often**. For efficiency reasons, it is advised to use them only when position\r\n\t * mapping between given model and view elements is unsolvable using just elements mapping and default algorithm. Also,\r\n\t * the condition that checks if special case scenario happened should be as simple as possible.\r\n\t *\r\n\t * @event modelToViewPosition\r\n\t * @param {Object} data Data pipeline object that can store and pass data between callbacks. The callback should add\r\n\t * `viewPosition` value to that object with calculated {@link module:engine/view/position~Position view position}.\r\n\t * @param {module:engine/conversion/mapper~Mapper} data.mapper Mapper instance that fired the event.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired for each view-to-model position mapping request. See {@link module:engine/conversion/mapper~Mapper#event:modelToViewPosition}.\r\n\t *\r\n\t * \t\t// See example in `modelToViewPosition` event description.\r\n\t * \t\t// This custom mapping will map positions from <span> element next to <img> to the \"captionedImage\" element.\r\n\t *\t\tmapper.on( 'viewToModelPosition', ( evt, data ) => {\r\n\t *\t\t\tconst positionParent = viewPosition.parent;\r\n\t *\r\n\t *\t\t\tif ( positionParent.hasClass( 'image-caption' ) ) {\r\n\t *\t\t\t\tconst viewImg = positionParent.previousSibling;\r\n\t *\t\t\t\tconst modelImg = data.mapper.toModelElement( viewImg );\r\n\t *\r\n\t *\t\t\t\tdata.modelPosition = new ModelPosition( modelImg, viewPosition.offset );\r\n\t *\t\t\t\tevt.stop();\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * **Note:** default mapping callback is provided with `low` priority setting and does not cancel the event, so it is possible to\r\n\t * attach a custom callback after default callback and also use `data.modelPosition` calculated by default callback\r\n\t * (for example to fix it).\r\n\t *\r\n\t * **Note:** default mapping callback will not fire if `data.modelPosition` is already set.\r\n\t *\r\n\t * **Note:** these callbacks are called **very often**. For efficiency reasons, it is advised to use them only when position\r\n\t * mapping between given model and view elements is unsolvable using just elements mapping and default algorithm. Also,\r\n\t * the condition that checks if special case scenario happened should be as simple as possible.\r\n\t *\r\n\t * @event viewToModelPosition\r\n\t * @param {Object} data Data pipeline object that can store and pass data between callbacks. The callback should add\r\n\t * `modelPosition` value to that object with calculated {@link module:engine/model/position~Position model position}.\r\n\t * @param {module:engine/conversion/mapper~Mapper} data.mapper Mapper instance that fired the event.\r\n\t */\r\n}\r\n\r\nmix( Mapper, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/modelconsumable\r\n */\r\n\r\nimport TextProxy from '../model/textproxy';\r\n\r\n/**\r\n * Manages a list of consumable values for {@link module:engine/model/item~Item model items}.\r\n *\r\n * Consumables are various aspects of the model. A model item can be broken down into singular properties that might be\r\n * taken into consideration when converting that item.\r\n *\r\n * `ModelConsumable` is used by {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher} while analyzing changed\r\n * parts of {@link module:engine/model/document~Document the document}. The added / changed / removed model items are broken down\r\n * into singular properties (the item itself and it's attributes). All those parts are saved in `ModelConsumable`. Then,\r\n * during conversion, when given part of model item is converted (i.e. the view element has been inserted into the view,\r\n * but without attributes), consumable value is removed from `ModelConsumable`.\r\n *\r\n * For model items, `ModelConsumable` stores consumable values of one of following types: `insert`, `addattribute:<attributeKey>`,\r\n * `changeattributes:<attributeKey>`, `removeattributes:<attributeKey>`.\r\n *\r\n * In most cases, it is enough to let {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}\r\n * gather consumable values, so there is no need to use\r\n * {@link module:engine/conversion/modelconsumable~ModelConsumable#add add method} directly.\r\n * However, it is important to understand how consumable values can be\r\n * {@link module:engine/conversion/modelconsumable~ModelConsumable#consume consumed}.\r\n * See {@link module:engine/conversion/downcast-selection-converters default downcast converters} for more information.\r\n *\r\n * Keep in mind, that one conversion event may have multiple callbacks (converters) attached to it. Each of those is\r\n * able to convert one or more parts of the model. However, when one of those callbacks actually converts\r\n * something, other should not, because they would duplicate the results. Using `ModelConsumable` helps avoiding\r\n * this situation, because callbacks should only convert those values, which were not yet consumed from `ModelConsumable`.\r\n *\r\n * Consuming multiple values in a single callback:\r\n *\r\n *\t\t// Converter for custom `image` element that might have a `caption` element inside which changes\r\n *\t\t// how the image is displayed in the view:\r\n *\t\t//\r\n *\t\t// Model:\r\n *\t\t//\r\n *\t\t// [image]\r\n *\t\t//   └─ [caption]\r\n *\t\t//       └─ foo\r\n *\t\t//\r\n *\t\t// View:\r\n *\t\t//\r\n *\t\t// <figure>\r\n *\t\t//   ├─ <img />\r\n *\t\t//   └─ <caption>\r\n *\t\t//       └─ foo\r\n *\t\tmodelConversionDispatcher.on( 'insert:image', ( evt, data, conversionApi ) => {\r\n *\t\t\t// First, consume the `image` element.\r\n *\t\t\tconversionApi.consumable.consume( data.item, 'insert' );\r\n *\r\n *\t\t\t// Just create normal image element for the view.\r\n *\t\t\t// Maybe it will be \"decorated\" later.\r\n *\t\t\tconst viewImage = new ViewElement( 'img' );\r\n *\t\t\tconst insertPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n *\t\t\tconst viewWriter = conversionApi.writer;\r\n *\r\n *\t\t\t// Check if the `image` element has children.\r\n *\t\t\tif ( data.item.childCount > 0 ) {\r\n *\t\t\t\tconst modelCaption = data.item.getChild( 0 );\r\n *\r\n *\t\t\t\t// `modelCaption` insertion change is consumed from consumable values.\r\n *\t\t\t\t// It will not be converted by other converters, but it's children (probably some text) will be.\r\n *\t\t\t\t// Through mapping, converters for text will know where to insert contents of `modelCaption`.\r\n *\t\t\t\tif ( conversionApi.consumable.consume( modelCaption, 'insert' ) ) {\r\n *\t\t\t\t\tconst viewCaption = new ViewElement( 'figcaption' );\r\n *\r\n *\t\t\t\t\tconst viewImageHolder = new ViewElement( 'figure', null, [ viewImage, viewCaption ] );\r\n *\r\n *\t\t\t\t\tconversionApi.mapper.bindElements( modelCaption, viewCaption );\r\n *\t\t\t\t\tconversionApi.mapper.bindElements( data.item, viewImageHolder );\r\n *\t\t\t\t\tviewWriter.insert( insertPosition, viewImageHolder );\r\n *\t\t\t\t}\r\n *\t\t\t} else {\r\n *\t\t\t\tconversionApi.mapper.bindElements( data.item, viewImage );\r\n *\t\t\t\tviewWriter.insert( insertPosition, viewImage );\r\n *\t\t\t}\r\n *\r\n *\t\t\tevt.stop();\r\n *\t\t} );\r\n */\r\nexport default class ModelConsumable {\r\n\t/**\r\n\t * Creates an empty consumables list.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Contains list of consumable values.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} module:engine/conversion/modelconsumable~ModelConsumable#_consumable\r\n\t\t */\r\n\t\tthis._consumable = new Map();\r\n\r\n\t\t/**\r\n\t\t * For each {@link module:engine/model/textproxy~TextProxy} added to `ModelConsumable`, this registry holds parent\r\n\t\t * of that `TextProxy` and start and end indices of that `TextProxy`. This allows identification of `TextProxy`\r\n\t\t * instances that points to the same part of the model but are different instances. Each distinct `TextProxy`\r\n\t\t * is given unique `Symbol` which is then registered as consumable. This process is transparent for `ModelConsumable`\r\n\t\t * API user because whenever `TextProxy` is added, tested, consumed or reverted, internal mechanisms of\r\n\t\t * `ModelConsumable` translates `TextProxy` to that unique `Symbol`.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} module:engine/conversion/modelconsumable~ModelConsumable#_textProxyRegistry\r\n\t\t */\r\n\t\tthis._textProxyRegistry = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a consumable value to the consumables list and links it with given model item.\r\n\t *\r\n\t *\t\tmodelConsumable.add( modelElement, 'insert' ); // Add `modelElement` insertion change to consumable values.\r\n\t *\t\tmodelConsumable.add( modelElement, 'addAttribute:bold' ); // Add `bold` attribute insertion on `modelElement` change.\r\n\t *\t\tmodelConsumable.add( modelElement, 'removeAttribute:bold' ); // Add `bold` attribute removal on `modelElement` change.\r\n\t *\t\tmodelConsumable.add( modelSelection, 'selection' ); // Add `modelSelection` to consumable values.\r\n\t *\t\tmodelConsumable.add( modelRange, 'range' ); // Add `modelRange` to consumable values.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/selection~Selection|module:engine/model/range~Range} item\r\n\t * Model item, range or selection that has the consumable.\r\n\t * @param {String} type Consumable type. Will be normalized to a proper form, that is either `<word>` or `<part>:<part>`.\r\n\t * Second colon and everything after will be cut. Passing event name is a safe and good practice.\r\n\t */\r\n\tadd( item, type ) {\r\n\t\ttype = _normalizeConsumableType( type );\r\n\r\n\t\tif ( item instanceof TextProxy ) {\r\n\t\t\titem = this._getSymbolForTextProxy( item );\r\n\t\t}\r\n\r\n\t\tif ( !this._consumable.has( item ) ) {\r\n\t\t\tthis._consumable.set( item, new Map() );\r\n\t\t}\r\n\r\n\t\tthis._consumable.get( item ).set( type, true );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes given consumable value from given model item.\r\n\t *\r\n\t *\t\tmodelConsumable.consume( modelElement, 'insert' ); // Remove `modelElement` insertion change from consumable values.\r\n\t *\t\tmodelConsumable.consume( modelElement, 'addAttribute:bold' ); // Remove `bold` attribute insertion on `modelElement` change.\r\n\t *\t\tmodelConsumable.consume( modelElement, 'removeAttribute:bold' ); // Remove `bold` attribute removal on `modelElement` change.\r\n\t *\t\tmodelConsumable.consume( modelSelection, 'selection' ); // Remove `modelSelection` from consumable values.\r\n\t *\t\tmodelConsumable.consume( modelRange, 'range' ); // Remove 'modelRange' from consumable values.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/selection~Selection|module:engine/model/range~Range} item\r\n\t * Model item, range or selection from which consumable will be consumed.\r\n\t * @param {String} type Consumable type. Will be normalized to a proper form, that is either `<word>` or `<part>:<part>`.\r\n\t * Second colon and everything after will be cut. Passing event name is a safe and good practice.\r\n\t * @returns {Boolean} `true` if consumable value was available and was consumed, `false` otherwise.\r\n\t */\r\n\tconsume( item, type ) {\r\n\t\ttype = _normalizeConsumableType( type );\r\n\r\n\t\tif ( item instanceof TextProxy ) {\r\n\t\t\titem = this._getSymbolForTextProxy( item );\r\n\t\t}\r\n\r\n\t\tif ( this.test( item, type ) ) {\r\n\t\t\tthis._consumable.get( item ).set( type, false );\r\n\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether there is a consumable value of given type connected with given model item.\r\n\t *\r\n\t *\t\tmodelConsumable.test( modelElement, 'insert' ); // Check for `modelElement` insertion change.\r\n\t *\t\tmodelConsumable.test( modelElement, 'addAttribute:bold' ); // Check for `bold` attribute insertion on `modelElement` change.\r\n\t *\t\tmodelConsumable.test( modelElement, 'removeAttribute:bold' ); // Check for `bold` attribute removal on `modelElement` change.\r\n\t *\t\tmodelConsumable.test( modelSelection, 'selection' ); // Check if `modelSelection` is consumable.\r\n\t *\t\tmodelConsumable.test( modelRange, 'range' ); // Check if `modelRange` is consumable.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/selection~Selection|module:engine/model/range~Range} item\r\n\t * Model item, range or selection to be tested.\r\n\t * @param {String} type Consumable type. Will be normalized to a proper form, that is either `<word>` or `<part>:<part>`.\r\n\t * Second colon and everything after will be cut. Passing event name is a safe and good practice.\r\n\t * @returns {null|Boolean} `null` if such consumable was never added, `false` if the consumable values was\r\n\t * already consumed or `true` if it was added and not consumed yet.\r\n\t */\r\n\ttest( item, type ) {\r\n\t\ttype = _normalizeConsumableType( type );\r\n\r\n\t\tif ( item instanceof TextProxy ) {\r\n\t\t\titem = this._getSymbolForTextProxy( item );\r\n\t\t}\r\n\r\n\t\tconst itemConsumables = this._consumable.get( item );\r\n\r\n\t\tif ( itemConsumables === undefined ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst value = itemConsumables.get( type );\r\n\r\n\t\tif ( value === undefined ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Reverts consuming of consumable value.\r\n\t *\r\n\t *\t\tmodelConsumable.revert( modelElement, 'insert' ); // Revert consuming `modelElement` insertion change.\r\n\t *\t\tmodelConsumable.revert( modelElement, 'addAttribute:bold' ); // Revert consuming `bold` attribute insert from `modelElement`.\r\n\t *\t\tmodelConsumable.revert( modelElement, 'removeAttribute:bold' ); // Revert consuming `bold` attribute remove from `modelElement`.\r\n\t *\t\tmodelConsumable.revert( modelSelection, 'selection' ); // Revert consuming `modelSelection`.\r\n\t *\t\tmodelConsumable.revert( modelRange, 'range' ); // Revert consuming `modelRange`.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/selection~Selection|module:engine/model/range~Range} item\r\n\t * Model item, range or selection to be reverted.\r\n\t * @param {String} type Consumable type.\r\n\t * @returns {null|Boolean} `true` if consumable has been reversed, `false` otherwise. `null` if the consumable has\r\n\t * never been added.\r\n\t */\r\n\trevert( item, type ) {\r\n\t\ttype = _normalizeConsumableType( type );\r\n\r\n\t\tif ( item instanceof TextProxy ) {\r\n\t\t\titem = this._getSymbolForTextProxy( item );\r\n\t\t}\r\n\r\n\t\tconst test = this.test( item, type );\r\n\r\n\t\tif ( test === false ) {\r\n\t\t\tthis._consumable.get( item ).set( type, true );\r\n\r\n\t\t\treturn true;\r\n\t\t} else if ( test === true ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a unique symbol for passed {@link module:engine/model/textproxy~TextProxy} instance. All `TextProxy` instances that\r\n\t * have same parent, same start index and same end index will get the same symbol.\r\n\t *\r\n\t * Used internally to correctly consume `TextProxy` instances.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/textproxy~TextProxy} textProxy `TextProxy` instance to get a symbol for.\r\n\t * @returns {Symbol} Symbol representing all equal instances of `TextProxy`.\r\n\t */\r\n\t_getSymbolForTextProxy( textProxy ) {\r\n\t\tlet symbol = null;\r\n\r\n\t\tconst startMap = this._textProxyRegistry.get( textProxy.startOffset );\r\n\r\n\t\tif ( startMap ) {\r\n\t\t\tconst endMap = startMap.get( textProxy.endOffset );\r\n\r\n\t\t\tif ( endMap ) {\r\n\t\t\t\tsymbol = endMap.get( textProxy.parent );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( !symbol ) {\r\n\t\t\tsymbol = this._addSymbolForTextProxy( textProxy.startOffset, textProxy.endOffset, textProxy.parent );\r\n\t\t}\r\n\r\n\t\treturn symbol;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a symbol for given properties that characterizes a {@link module:engine/model/textproxy~TextProxy} instance.\r\n\t *\r\n\t * Used internally to correctly consume `TextProxy` instances.\r\n\t *\r\n\t * @private\r\n\t * @param {Number} startIndex Text proxy start index in it's parent.\r\n\t * @param {Number} endIndex Text proxy end index in it's parent.\r\n\t * @param {module:engine/model/element~Element} parent Text proxy parent.\r\n\t * @returns {Symbol} Symbol generated for given properties.\r\n\t */\r\n\t_addSymbolForTextProxy( start, end, parent ) {\r\n\t\tconst symbol = Symbol( 'textProxySymbol' );\r\n\t\tlet startMap, endMap;\r\n\r\n\t\tstartMap = this._textProxyRegistry.get( start );\r\n\r\n\t\tif ( !startMap ) {\r\n\t\t\tstartMap = new Map();\r\n\t\t\tthis._textProxyRegistry.set( start, startMap );\r\n\t\t}\r\n\r\n\t\tendMap = startMap.get( end );\r\n\r\n\t\tif ( !endMap ) {\r\n\t\t\tendMap = new Map();\r\n\t\t\tstartMap.set( end, endMap );\r\n\t\t}\r\n\r\n\t\tendMap.set( parent, symbol );\r\n\r\n\t\treturn symbol;\r\n\t}\r\n}\r\n\r\n// Returns a normalized consumable type name from given string. A normalized consumable type name is a string that has\r\n// at most one colon, for example: `insert` or `addMarker:highlight`. If string to normalize has more \"parts\" (more colons),\r\n// the other parts are dropped, for example: `addattribute:bold:$text` -> `addattributes:bold`.\r\n//\r\n// @param {String} type Consumable type.\r\n// @returns {String} Normalized consumable type.\r\nfunction _normalizeConsumableType( type ) {\r\n\tconst parts = type.split( ':' );\r\n\r\n\treturn parts.length > 1 ? parts[ 0 ] + ':' + parts[ 1 ] : parts[ 0 ];\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/downcastdispatcher\r\n */\r\n\r\nimport Consumable from './modelconsumable';\r\nimport Range from '../model/range';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport { extend } from 'lodash-es';\r\n\r\n/**\r\n * `DowncastDispatcher` is a central point of downcasting (conversion from model to view), which is a process of reacting to changes\r\n * in the model and firing a set of events. Callbacks listening to those events are called converters. Those\r\n * converters role is to convert the model changes to changes in view (for example, adding view nodes or\r\n * changing attributes on view elements).\r\n *\r\n * During conversion process, `DowncastDispatcher` fires events, basing on state of the model and prepares\r\n * data for those events. It is important to understand that those events are connected with changes done on model,\r\n * for example: \"node has been inserted\" or \"attribute has changed\". This is in a contrary to upcasting (view to model conversion),\r\n * where we convert view state (view nodes) to a model tree.\r\n *\r\n * The events are prepared basing on a diff created by {@link module:engine/model/differ~Differ Differ}, which buffers them\r\n * and then passes to `DowncastDispatcher` as a diff between old model state and new model state.\r\n *\r\n * Note, that because changes are converted there is a need to have a mapping between model structure and view structure.\r\n * To map positions and elements during downcast (model to view conversion) use {@link module:engine/conversion/mapper~Mapper}.\r\n *\r\n * `DowncastDispatcher` fires following events for model tree changes:\r\n *\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:insert insert}\r\n * if a range of nodes has been inserted to the model tree,\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:remove remove}\r\n * if a range of nodes has been removed from the model tree,\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute attribute}\r\n * if attribute has been added, changed or removed from a model node.\r\n *\r\n * For {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:insert insert}\r\n * and {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute attribute},\r\n * `DowncastDispatcher` generates {@link module:engine/conversion/modelconsumable~ModelConsumable consumables}.\r\n * These are used to have a control over which changes has been already consumed. It is useful when some converters\r\n * overwrite other or converts multiple changes (for example converts insertion of an element and also converts that\r\n * element's attributes during insertion).\r\n *\r\n * Additionally, `DowncastDispatcher` fires events for {@link module:engine/model/markercollection~Marker marker} changes:\r\n *\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:addMarker} if a marker has been added,\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:removeMarker} if a marker has been removed.\r\n *\r\n * Note, that changing a marker is done through removing the marker from the old range, and adding on the new range,\r\n * so both those events are fired.\r\n *\r\n * Finally, `DowncastDispatcher` also handles firing events for {@link module:engine/model/selection model selection}\r\n * conversion:\r\n *\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:selection}\r\n * which converts selection from model to view,\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute}\r\n * which is fired for every selection attribute,\r\n * * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:addMarker}\r\n * which is fired for every marker which contains selection.\r\n *\r\n * Unlike model tree and markers, events for selection are not fired for changes but for selection state.\r\n *\r\n * When providing custom listeners for `DowncastDispatcher` remember to check whether given change has not been\r\n * {@link module:engine/conversion/modelconsumable~ModelConsumable#consume consumed} yet.\r\n *\r\n * When providing custom listeners for `DowncastDispatcher` keep in mind that any callback that had\r\n * {@link module:engine/conversion/modelconsumable~ModelConsumable#consume consumed} a value from a consumable and\r\n * converted the change should also stop the event (for efficiency purposes).\r\n *\r\n * When providing custom listeners for `DowncastDispatcher` remember to use provided\r\n * {@link module:engine/view/downcastwriter~DowncastWriter view downcast writer} to apply changes to the view document.\r\n *\r\n * Example of a custom converter for `DowncastDispatcher`:\r\n *\r\n *\t\t// We will convert inserting \"paragraph\" model element into the model.\r\n *\t\tdowncastDispatcher.on( 'insert:paragraph', ( evt, data, conversionApi ) => {\r\n *\t\t\t// Remember to check whether the change has not been consumed yet and consume it.\r\n *\t\t\tif ( conversionApi.consumable.consume( data.item, 'insert' ) ) {\r\n *\t\t\t\treturn;\r\n *\t\t\t}\r\n *\r\n *\t\t\t// Translate position in model to position in view.\r\n *\t\t\tconst viewPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n *\r\n *\t\t\t// Create <p> element that will be inserted in view at `viewPosition`.\r\n *\t\t\tconst viewElement = conversionApi.writer.createContainerElement( 'p' );\r\n *\r\n *\t\t\t// Bind the newly created view element to model element so positions will map accordingly in future.\r\n *\t\t\tconversionApi.mapper.bindElements( data.item, viewElement );\r\n *\r\n *\t\t\t// Add the newly created view element to the view.\r\n *\t\t\tconversionApi.writer.insert( viewPosition, viewElement );\r\n *\r\n *\t\t\t// Remember to stop the event propagation.\r\n *\t\t\tevt.stop();\r\n *\t\t} );\r\n */\r\nexport default class DowncastDispatcher {\r\n\t/**\r\n\t * Creates a `DowncastDispatcher` instance.\r\n\t *\r\n\t * @param {Object} [conversionApi] Interface passed by dispatcher to the events calls.\r\n\t */\r\n\tconstructor( conversionApi = {} ) {\r\n\t\t/**\r\n\t\t * Interface passed by dispatcher to the events callbacks.\r\n\t\t *\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis.conversionApi = extend( { dispatcher: this }, conversionApi );\r\n\t}\r\n\r\n\t/**\r\n\t * Takes {@link module:engine/model/differ~Differ model differ} object with buffered changes and fires conversion basing on it.\r\n\t *\r\n\t * @param {module:engine/model/differ~Differ} differ Differ object with buffered changes.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertChanges( differ, writer ) {\r\n\t\t// Before the view is updated, remove markers which have changed.\r\n\t\tfor ( const change of differ.getMarkersToRemove() ) {\r\n\t\t\tthis.convertMarkerRemove( change.name, change.range, writer );\r\n\t\t}\r\n\r\n\t\t// Convert changes that happened on model tree.\r\n\t\tfor ( const entry of differ.getChanges() ) {\r\n\t\t\tif ( entry.type == 'insert' ) {\r\n\t\t\t\tthis.convertInsert( Range._createFromPositionAndShift( entry.position, entry.length ), writer );\r\n\t\t\t} else if ( entry.type == 'remove' ) {\r\n\t\t\t\tthis.convertRemove( entry.position, entry.length, entry.name, writer );\r\n\t\t\t} else {\r\n\t\t\t\t// entry.type == 'attribute'.\r\n\t\t\t\tthis.convertAttribute( entry.range, entry.attributeKey, entry.attributeOldValue, entry.attributeNewValue, writer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// After the view is updated, convert markers which have changed.\r\n\t\tfor ( const change of differ.getMarkersToAdd() ) {\r\n\t\t\tthis.convertMarkerAdd( change.name, change.range, writer );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Starts conversion of a range insertion.\r\n\t *\r\n\t * For each node in the range, {@link #event:insert insert event is fired}. For each attribute on each node,\r\n\t * {@link #event:attribute attribute event is fired}.\r\n\t *\r\n\t * @fires insert\r\n\t * @fires attribute\r\n\t * @param {module:engine/model/range~Range} range Inserted range.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertInsert( range, writer ) {\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\t// Create a list of things that can be consumed, consisting of nodes and their attributes.\r\n\t\tthis.conversionApi.consumable = this._createInsertConsumable( range );\r\n\r\n\t\t// Fire a separate insert event for each node and text fragment contained in the range.\r\n\t\tfor ( const value of range ) {\r\n\t\t\tconst item = value.item;\r\n\t\t\tconst itemRange = Range._createFromPositionAndShift( value.previousPosition, value.length );\r\n\t\t\tconst data = {\r\n\t\t\t\titem,\r\n\t\t\t\trange: itemRange\r\n\t\t\t};\r\n\r\n\t\t\tthis._testAndFire( 'insert', data );\r\n\r\n\t\t\t// Fire a separate addAttribute event for each attribute that was set on inserted items.\r\n\t\t\t// This is important because most attributes converters will listen only to add/change/removeAttribute events.\r\n\t\t\t// If we would not add this part, attributes on inserted nodes would not be converted.\r\n\t\t\tfor ( const key of item.getAttributeKeys() ) {\r\n\t\t\t\tdata.attributeKey = key;\r\n\t\t\t\tdata.attributeOldValue = null;\r\n\t\t\t\tdata.attributeNewValue = item.getAttribute( key );\r\n\r\n\t\t\t\tthis._testAndFire( `attribute:${ key }`, data );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Fires conversion of a single node removal. Fires {@link #event:remove remove event} with provided data.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position from which node was removed.\r\n\t * @param {Number} length Offset size of removed node.\r\n\t * @param {String} name Name of removed node.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertRemove( position, length, name, writer ) {\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\tthis.fire( 'remove:' + name, { position, length }, this.conversionApi );\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts conversion of attribute change on given `range`.\r\n\t *\r\n\t * For each node in the given `range`, {@link #event:attribute attribute event} is fired with the passed data.\r\n\t *\r\n\t * @fires attribute\r\n\t * @param {module:engine/model/range~Range} range Changed range.\r\n\t * @param {String} key Key of the attribute that has changed.\r\n\t * @param {*} oldValue Attribute value before the change or `null` if the attribute has not been set before.\r\n\t * @param {*} newValue New attribute value or `null` if the attribute has been removed.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertAttribute( range, key, oldValue, newValue, writer ) {\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\t// Create a list with attributes to consume.\r\n\t\tthis.conversionApi.consumable = this._createConsumableForRange( range, `attribute:${ key }` );\r\n\r\n\t\t// Create a separate attribute event for each node in the range.\r\n\t\tfor ( const value of range ) {\r\n\t\t\tconst item = value.item;\r\n\t\t\tconst itemRange = Range._createFromPositionAndShift( value.previousPosition, value.length );\r\n\t\t\tconst data = {\r\n\t\t\t\titem,\r\n\t\t\t\trange: itemRange,\r\n\t\t\t\tattributeKey: key,\r\n\t\t\t\tattributeOldValue: oldValue,\r\n\t\t\t\tattributeNewValue: newValue\r\n\t\t\t};\r\n\r\n\t\t\tthis._testAndFire( `attribute:${ key }`, data );\r\n\t\t}\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts model selection conversion.\r\n\t *\r\n\t * Fires events for given {@link module:engine/model/selection~Selection selection} to start selection conversion.\r\n\t *\r\n\t * @fires selection\r\n\t * @fires addMarker\r\n\t * @fires attribute\r\n\t * @param {module:engine/model/selection~Selection} selection Selection to convert.\r\n\t * @param {Array.<module:engine/model/markercollection~Marker>} markers Array of markers containing model markers.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertSelection( selection, markers, writer ) {\r\n\t\tconst markersAtSelection = Array.from( markers.getMarkersAtPosition( selection.getFirstPosition() ) );\r\n\r\n\t\tthis.conversionApi.writer = writer;\r\n\t\tthis.conversionApi.consumable = this._createSelectionConsumable( selection, markersAtSelection );\r\n\r\n\t\tthis.fire( 'selection', { selection }, this.conversionApi );\r\n\r\n\t\tif ( !selection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor ( const marker of markersAtSelection ) {\r\n\t\t\tconst markerRange = marker.getRange();\r\n\r\n\t\t\tif ( !shouldMarkerChangeBeConverted( selection.getFirstPosition(), marker, this.conversionApi.mapper ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\titem: selection,\r\n\t\t\t\tmarkerName: marker.name,\r\n\t\t\t\tmarkerRange\r\n\t\t\t};\r\n\r\n\t\t\tif ( this.conversionApi.consumable.test( selection, 'addMarker:' + marker.name ) ) {\r\n\t\t\t\tthis.fire( 'addMarker:' + marker.name, data, this.conversionApi );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( const key of selection.getAttributeKeys() ) {\r\n\t\t\tconst data = {\r\n\t\t\t\titem: selection,\r\n\t\t\t\trange: selection.getFirstRange(),\r\n\t\t\t\tattributeKey: key,\r\n\t\t\t\tattributeOldValue: null,\r\n\t\t\t\tattributeNewValue: selection.getAttribute( key )\r\n\t\t\t};\r\n\r\n\t\t\t// Do not fire event if the attribute has been consumed.\r\n\t\t\tif ( this.conversionApi.consumable.test( selection, 'attribute:' + data.attributeKey ) ) {\r\n\t\t\t\tthis.fire( 'attribute:' + data.attributeKey, data, this.conversionApi );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Converts added marker. Fires {@link #event:addMarker addMarker} event for each item\r\n\t * in marker's range. If range is collapsed single event is dispatched. See event description for more details.\r\n\t *\r\n\t * @fires addMarker\r\n\t * @param {String} markerName Marker name.\r\n\t * @param {module:engine/model/range~Range} markerRange Marker range.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertMarkerAdd( markerName, markerRange, writer ) {\r\n\t\t// Do not convert if range is in graveyard or not in the document (e.g. in DocumentFragment).\r\n\t\tif ( !markerRange.root.document || markerRange.root.rootName == '$graveyard' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\t// In markers' case, event name == consumable name.\r\n\t\tconst eventName = 'addMarker:' + markerName;\r\n\r\n\t\t// When range is collapsed - fire single event with collapsed range in consumable.\r\n\t\tif ( markerRange.isCollapsed ) {\r\n\t\t\tconst consumable = new Consumable();\r\n\t\t\tconsumable.add( markerRange, eventName );\r\n\r\n\t\t\tthis.conversionApi.consumable = consumable;\r\n\r\n\t\t\tthis.fire( eventName, { markerName, markerRange }, this.conversionApi );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Create consumable for each item in range.\r\n\t\tthis.conversionApi.consumable = this._createConsumableForRange( markerRange, eventName );\r\n\r\n\t\t// Create separate event for each node in the range.\r\n\t\tfor ( const item of markerRange.getItems() ) {\r\n\t\t\t// Do not fire event for already consumed items.\r\n\t\t\tif ( !this.conversionApi.consumable.test( item, eventName ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst data = { item, range: Range._createOn( item ), markerName, markerRange };\r\n\r\n\t\t\tthis.fire( eventName, data, this.conversionApi );\r\n\t\t}\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Fires conversion of marker removal. Fires {@link #event:removeMarker removeMarker} event with provided data.\r\n\t *\r\n\t * @fires removeMarker\r\n\t * @param {String} markerName Marker name.\r\n\t * @param {module:engine/model/range~Range} markerRange Marker range.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that should be used to modify view document.\r\n\t */\r\n\tconvertMarkerRemove( markerName, markerRange, writer ) {\r\n\t\t// Do not convert if range is in graveyard or not in the document (e.g. in DocumentFragment).\r\n\t\tif ( !markerRange.root.document || markerRange.root.rootName == '$graveyard' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\tthis.fire( 'removeMarker:' + markerName, { markerName, markerRange }, this.conversionApi );\r\n\r\n\t\tthis._clearConversionApi();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates {@link module:engine/conversion/modelconsumable~ModelConsumable} with values to consume from given range,\r\n\t * assuming that the range has just been inserted to the model.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/range~Range} range Inserted range.\r\n\t * @returns {module:engine/conversion/modelconsumable~ModelConsumable} Values to consume.\r\n\t */\r\n\t_createInsertConsumable( range ) {\r\n\t\tconst consumable = new Consumable();\r\n\r\n\t\tfor ( const value of range ) {\r\n\t\t\tconst item = value.item;\r\n\r\n\t\t\tconsumable.add( item, 'insert' );\r\n\r\n\t\t\tfor ( const key of item.getAttributeKeys() ) {\r\n\t\t\t\tconsumable.add( item, 'attribute:' + key );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn consumable;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates {@link module:engine/conversion/modelconsumable~ModelConsumable} with values to consume for given range.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/range~Range} range Affected range.\r\n\t * @param {String} type Consumable type.\r\n\t * @returns {module:engine/conversion/modelconsumable~ModelConsumable} Values to consume.\r\n\t */\r\n\t_createConsumableForRange( range, type ) {\r\n\t\tconst consumable = new Consumable();\r\n\r\n\t\tfor ( const item of range.getItems() ) {\r\n\t\t\tconsumable.add( item, type );\r\n\t\t}\r\n\r\n\t\treturn consumable;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates {@link module:engine/conversion/modelconsumable~ModelConsumable} with selection consumable values.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/selection~Selection} selection Selection to create consumable from.\r\n\t * @param {Iterable.<module:engine/model/markercollection~Marker>} markers Markers which contains selection.\r\n\t * @returns {module:engine/conversion/modelconsumable~ModelConsumable} Values to consume.\r\n\t */\r\n\t_createSelectionConsumable( selection, markers ) {\r\n\t\tconst consumable = new Consumable();\r\n\r\n\t\tconsumable.add( selection, 'selection' );\r\n\r\n\t\tfor ( const marker of markers ) {\r\n\t\t\tconsumable.add( selection, 'addMarker:' + marker.name );\r\n\t\t}\r\n\r\n\t\tfor ( const key of selection.getAttributeKeys() ) {\r\n\t\t\tconsumable.add( selection, 'attribute:' + key );\r\n\t\t}\r\n\r\n\t\treturn consumable;\r\n\t}\r\n\r\n\t/**\r\n\t * Tests passed `consumable` to check whether given event can be fired and if so, fires it.\r\n\t *\r\n\t * @private\r\n\t * @fires insert\r\n\t * @fires attribute\r\n\t * @param {String} type Event type.\r\n\t * @param {Object} data Event data.\r\n\t */\r\n\t_testAndFire( type, data ) {\r\n\t\tif ( !this.conversionApi.consumable.test( data.item, type ) ) {\r\n\t\t\t// Do not fire event if the item was consumed.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst name = data.item.name || '$text';\r\n\r\n\t\tthis.fire( type + ':' + name, data, this.conversionApi );\r\n\t}\r\n\r\n\t/**\r\n\t * Clears conversion API object.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_clearConversionApi() {\r\n\t\tdelete this.conversionApi.writer;\r\n\t\tdelete this.conversionApi.consumable;\r\n\t}\r\n\r\n\t/**\r\n\t * Fired for inserted nodes.\r\n\t *\r\n\t * `insert` is a namespace for a class of events. Names of actually called events follow this pattern:\r\n\t * `insert:name`. `name` is either `'$text'`, when {@link module:engine/model/text~Text a text node} has been inserted,\r\n\t * or {@link module:engine/model/element~Element#name name} of inserted element.\r\n\t *\r\n\t * This way listeners can either listen to a general `insert` event or specific event (for example `insert:paragraph`).\r\n\t *\r\n\t * @event insert\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/model/item~Item} data.item Inserted item.\r\n\t * @param {module:engine/model/range~Range} data.range Range spanning over inserted item.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired for removed nodes.\r\n\t *\r\n\t * `remove` is a namespace for a class of events. Names of actually called events follow this pattern:\r\n\t * `remove:name`. `name` is either `'$text'`, when {@link module:engine/model/text~Text a text node} has been removed,\r\n\t * or the {@link module:engine/model/element~Element#name name} of removed element.\r\n\t *\r\n\t * This way listeners can either listen to a general `remove` event or specific event (for example `remove:paragraph`).\r\n\t *\r\n\t * @event remove\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/model/position~Position} data.position Position from which the node has been removed.\r\n\t * @param {Number} data.length Offset size of the removed node.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired in the following cases:\r\n\t *\r\n\t * * when an attribute has been added, changed, or removed from a node,\r\n\t * * when a node with an attribute is inserted,\r\n\t * * when collapsed model selection attribute is converted.\r\n\t *\r\n\t * `attribute` is a namespace for a class of events. Names of actually called events follow this pattern:\r\n\t * `attribute:attributeKey:name`. `attributeKey` is the key of added/changed/removed attribute.\r\n\t * `name` is either `'$text'` if change was on {@link module:engine/model/text~Text a text node},\r\n\t * or the {@link module:engine/model/element~Element#name name} of element which attribute has changed.\r\n\t *\r\n\t * This way listeners can either listen to a general `attribute:bold` event or specific event (for example `attribute:src:image`).\r\n\t *\r\n\t * @event attribute\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/documentselection~DocumentSelection} data.item Changed item\r\n\t * or converted selection.\r\n\t * @param {module:engine/model/range~Range} data.range Range spanning over changed item or selection range.\r\n\t * @param {String} data.attributeKey Attribute key.\r\n\t * @param {*} data.attributeOldValue Attribute value before the change. This is `null` when selection attribute is converted.\r\n\t * @param {*} data.attributeNewValue New attribute value.\r\n\t * @param {module:engine/conversion/modelconsumable~ModelConsumable} consumable Values to consume.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired for {@link module:engine/model/selection~Selection selection} changes.\r\n\t *\r\n\t * @event selection\r\n\t * @param {module:engine/model/selection~Selection} selection Selection that is converted.\r\n\t * @param {module:engine/conversion/modelconsumable~ModelConsumable} consumable Values to consume.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when a new marker is added to the model. Also fired when collapsed model selection that is inside marker is converted.\r\n\t *\r\n\t * `addMarker` is a namespace for a class of events. Names of actually called events follow this pattern:\r\n\t * `addMarker:markerName`. By specifying certain marker names, you can make the events even more gradual. For example,\r\n\t * if markers are named `foo:abc`, `foo:bar`, then it is possible to listen to `addMarker:foo` or `addMarker:foo:abc` and\r\n\t * `addMarker:foo:bar` events.\r\n\t *\r\n\t * If the marker range is not collapsed:\r\n\t *\r\n\t * * the event is fired for each item in the marker range one by one,\r\n\t * * consumables object includes each item of the marker range and the consumable value is same as event name.\r\n\t *\r\n\t * If the marker range is collapsed:\r\n\t *\r\n\t * * there is only one event,\r\n\t * * consumables object includes marker range with event name.\r\n\t *\r\n\t * If selection inside a marker is converted:\r\n\t *\r\n\t * * there is only one event,\r\n\t * * consumables object includes selection instance with event name.\r\n\t *\r\n\t * @event addMarker\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/selection~Selection} data.item Item inside the new marker or\r\n\t * the selection that is being converted.\r\n\t * @param {module:engine/model/range~Range} [data.range] Range spanning over converted item. Available only in marker conversion, if\r\n\t * the marker range was not collapsed.\r\n\t * @param {module:engine/model/range~Range} data.markerRange Marker range.\r\n\t * @param {String} data.markerName Marker name.\r\n\t * @param {module:engine/conversion/modelconsumable~ModelConsumable} consumable Values to consume.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when marker is removed from the model.\r\n\t *\r\n\t * `removeMarker` is a namespace for a class of events. Names of actually called events follow this pattern:\r\n\t * `removeMarker:markerName`. By specifying certain marker names, you can make the events even more gradual. For example,\r\n\t * if markers are named `foo:abc`, `foo:bar`, then it is possible to listen to `removeMarker:foo` or `removeMarker:foo:abc` and\r\n\t * `removeMarker:foo:bar` events.\r\n\t *\r\n\t * @event removeMarker\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/model/range~Range} data.markerRange Marker range.\r\n\t * @param {String} data.markerName Marker name.\r\n\t * @param {Object} conversionApi Conversion interface to be used by callback, passed in `DowncastDispatcher` constructor.\r\n\t */\r\n}\r\n\r\nmix( DowncastDispatcher, EmitterMixin );\r\n\r\n// Helper function, checks whether change of `marker` at `modelPosition` should be converted. Marker changes are not\r\n// converted if they happen inside an element with custom conversion method.\r\n//\r\n// @param {module:engine/model/position~Position} modelPosition\r\n// @param {module:engine/model/markercollection~Marker} marker\r\n// @param {module:engine/conversion/mapper~Mapper} mapper\r\n// @returns {Boolean}\r\nfunction shouldMarkerChangeBeConverted( modelPosition, marker, mapper ) {\r\n\tconst range = marker.getRange();\r\n\tconst ancestors = Array.from( modelPosition.getAncestors() );\r\n\tancestors.shift(); // Remove root element. It cannot be passed to `model.Range#containsItem`.\r\n\tancestors.reverse();\r\n\r\n\tconst hasCustomHandling = ancestors.some( element => {\r\n\t\tif ( range.containsItem( element ) ) {\r\n\t\t\tconst viewElement = mapper.toViewElement( element );\r\n\r\n\t\t\treturn !!viewElement.getCustomProperty( 'addHighlight' );\r\n\t\t}\r\n\t} );\r\n\r\n\treturn !hasCustomHandling;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/selection\r\n */\r\n\r\nimport Position from './position';\r\nimport Element from './element';\r\nimport Node from './node';\r\nimport Range from './range';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\n\r\n/**\r\n * Selection is a set of {@link module:engine/model/range~Range ranges}. It has a direction specified by its\r\n * {@link module:engine/model/selection~Selection#anchor anchor} and {@link module:engine/model/selection~Selection#focus focus}\r\n * (it can be {@link module:engine/model/selection~Selection#isBackward forward or backward}).\r\n * Additionally, selection may have its own attributes (think – whether text typed in in this selection\r\n * should have those attributes – e.g. whether you type a bolded text).\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class Selection {\r\n\t/**\r\n\t * Creates a new selection instance\r\n\t * based on the given {@link module:engine/model/selection~Selection selection},\r\n\t * or based on the given {@link module:engine/model/range~Range range},\r\n\t * or based on an iterable collection of {@link module:engine/model/range~Range ranges}\r\n\t * or at the given {@link module:engine/model/position~Position position},\r\n\t * or on the given {@link module:engine/model/element~Element element},\r\n\t * or creates an empty selection if no arguments were passed.\r\n\t *\r\n\t *\t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = writer.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = writer.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t *\t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = writer.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = writer.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the given document selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst documentSelection = model.document.selection;\r\n\t *\t\tconst selection = writer.createSelection( documentSelection );\r\n\t *\r\n\t *\t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = writer.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates selection at the given offset in the given element.\r\n\t *\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/model/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/model/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\r\n\t *\r\n\t * Selection's constructor allow passing additional options (`'backward'`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/element~Element|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t */\r\n\tconstructor( selectable, placeOrOffset, options ) {\r\n\t\t/**\r\n\t\t * Specifies whether the last added range was added as a backward or forward range.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Boolean}\r\n\t\t */\r\n\t\tthis._lastRangeBackward = false;\r\n\r\n\t\t/**\r\n\t\t * Stores selection ranges.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @type {Array.<module:engine/model/range~Range>}\r\n\t\t */\r\n\t\tthis._ranges = [];\r\n\r\n\t\t/**\r\n\t\t * List of attributes set on current selection.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @type {Map.<String,*>}\r\n\t\t */\r\n\t\tthis._attrs = new Map();\r\n\r\n\t\tif ( selectable ) {\r\n\t\t\tthis.setTo( selectable, placeOrOffset, options );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Selection anchor. Anchor is the position from which the selection was started. If a user is making a selection\r\n\t * by dragging the mouse, the anchor is where the user pressed the mouse button (the beggining of the selection).\r\n\t *\r\n\t * Anchor and {@link #focus} define the direction of the selection, which is important\r\n\t * when expanding/shrinking selection. The focus moves, while the anchor should remain in the same place.\r\n\t *\r\n\t * Anchor is always set to the {@link module:engine/model/range~Range#start start} or\r\n\t * {@link module:engine/model/range~Range#end end} position of the last of selection's ranges. Whether it is\r\n\t * the `start` or `end` depends on the specified `options.backward`. See the {@link #setTo `setTo()`} method.\r\n\t *\r\n\t * May be set to `null` if there are no ranges in the selection.\r\n\t *\r\n\t * @see #focus\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position|null}\r\n\t */\r\n\tget anchor() {\r\n\t\tif ( this._ranges.length > 0 ) {\r\n\t\t\tconst range = this._ranges[ this._ranges.length - 1 ];\r\n\r\n\t\t\treturn this._lastRangeBackward ? range.end : range.start;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection focus. Focus is the position where the selection ends. If a user is making a selection\r\n\t * by dragging the mouse, the focus is where the mouse cursor is.\r\n\t *\r\n\t * May be set to `null` if there are no ranges in the selection.\r\n\t *\r\n\t * @see #anchor\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position|null}\r\n\t */\r\n\tget focus() {\r\n\t\tif ( this._ranges.length > 0 ) {\r\n\t\t\tconst range = this._ranges[ this._ranges.length - 1 ];\r\n\r\n\t\t\treturn this._lastRangeBackward ? range.start : range.end;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether the selection is collapsed. Selection is collapsed when there is exactly one range in it\r\n\t * and it is collapsed.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\tconst length = this._ranges.length;\r\n\r\n\t\tif ( length === 1 ) {\r\n\t\t\treturn this._ranges[ 0 ].isCollapsed;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of ranges in the selection.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget rangeCount() {\r\n\t\treturn this._ranges.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies whether the selection's {@link #focus} precedes the selection's {@link #anchor}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isBackward() {\r\n\t\treturn !this.isCollapsed && this._lastRangeBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether this selection is equal to the given selection. Selections are equal if they have the same directions,\r\n\t * the same number of ranges and all ranges from one selection equal to ranges from the another selection.\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} otherSelection\r\n\t * Selection to compare with.\r\n\t * @returns {Boolean} `true` if selections are equal, `false` otherwise.\r\n\t */\r\n\tisEqual( otherSelection ) {\r\n\t\tif ( this.rangeCount != otherSelection.rangeCount ) {\r\n\t\t\treturn false;\r\n\t\t} else if ( this.rangeCount === 0 ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif ( !this.anchor.isEqual( otherSelection.anchor ) || !this.focus.isEqual( otherSelection.focus ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor ( const thisRange of this._ranges ) {\r\n\t\t\tlet found = false;\r\n\r\n\t\t\tfor ( const otherRange of otherSelection._ranges ) {\r\n\t\t\t\tif ( thisRange.isEqual( otherRange ) ) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( !found ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterable object that iterates over copies of selection ranges.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/range~Range>}\r\n\t */\r\n\t* getRanges() {\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tyield new Range( range.start, range.end );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of the first range in the selection.\r\n\t * First range is the one which {@link module:engine/model/range~Range#start start} position\r\n\t * {@link module:engine/model/position~Position#isBefore is before} start position of all other ranges\r\n\t * (not to confuse with the first range added to the selection).\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range|null}\r\n\t */\r\n\tgetFirstRange() {\r\n\t\tlet first = null;\r\n\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tif ( !first || range.start.isBefore( first.start ) ) {\r\n\t\t\t\tfirst = range;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn first ? new Range( first.start, first.end ) : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of the last range in the selection.\r\n\t * Last range is the one which {@link module:engine/model/range~Range#end end} position\r\n\t * {@link module:engine/model/position~Position#isAfter is after} end position of all other ranges (not to confuse with the range most\r\n\t * recently added to the selection).\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range|null}\r\n\t */\r\n\tgetLastRange() {\r\n\t\tlet last = null;\r\n\r\n\t\tfor ( const range of this._ranges ) {\r\n\t\t\tif ( !last || range.end.isAfter( last.end ) ) {\r\n\t\t\t\tlast = range;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn last ? new Range( last.start, last.end ) : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first position in the selection.\r\n\t * First position is the position that {@link module:engine/model/position~Position#isBefore is before}\r\n\t * any other position in the selection.\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position|null}\r\n\t */\r\n\tgetFirstPosition() {\r\n\t\tconst first = this.getFirstRange();\r\n\r\n\t\treturn first ? first.start.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the last position in the selection.\r\n\t * Last position is the position that {@link module:engine/model/position~Position#isAfter is after}\r\n\t * any other position in the selection.\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position|null}\r\n\t */\r\n\tgetLastPosition() {\r\n\t\tconst lastRange = this.getLastRange();\r\n\r\n\t\treturn lastRange ? lastRange.end.clone() : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets this selection's ranges and direction to the specified location based on the given\r\n\t * {@link module:engine/model/selection~Selection selection}, {@link module:engine/model/position~Position position},\r\n\t * {@link module:engine/model/element~Element element}, {@link module:engine/model/position~Position position},\r\n\t * {@link module:engine/model/range~Range range}, an iterable of {@link module:engine/model/range~Range ranges} or null.\r\n\t *\r\n\t *\t\t// Removes all selection's ranges.\r\n\t *\t\tselection.setTo( null );\r\n\t *\r\n\t *\t\t// Sets selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tselection.setTo( range );\r\n\t *\r\n\t *\t\t// Sets selection to given ranges.\r\n\t *\t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tselection.setTo( ranges );\r\n\t *\r\n\t *\t\t// Sets selection to other selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tselection.setTo( otherSelection );\r\n\t *\r\n\t *\t\t// Sets selection to the given document selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst documentSelection = new DocumentSelection( doc );\r\n\t *\t\tselection.setTo( documentSelection );\r\n\t *\r\n\t *\t\t// Sets collapsed selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tselection.setTo( position );\r\n\t *\r\n\t *\t\t// Sets collapsed selection at the position of the given node and an offset.\r\n\t *\t\tselection.setTo( paragraph, offset );\r\n\t *\r\n\t * Creates a range inside an {@link module:engine/model/element~Element element} which starts before the first child of\r\n \t * that element and ends after the last child of that element.\r\n\t *\r\n\t *\t\tselection.setTo( paragraph, 'in' );\r\n\t *\r\n\t * Creates a range on an {@link module:engine/model/item~Item item} which starts before the item and ends just after the item.\r\n\t *\r\n\t *\t\tselection.setTo( paragraph, 'on' );\r\n\t *\r\n\t * `Selection#setTo()`' method allow passing additional options (`backward`) as the last argument.\r\n\t *\r\n\t *\t\t// Sets backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/node~Node|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t */\r\n\tsetTo( selectable, placeOrOffset, options ) {\r\n\t\tif ( selectable === null ) {\r\n\t\t\tthis._setRanges( [] );\r\n\t\t} else if ( selectable instanceof Selection ) {\r\n\t\t\tthis._setRanges( selectable.getRanges(), selectable.isBackward );\r\n\t\t} else if ( selectable && typeof selectable.getRanges == 'function' ) {\r\n\t\t\t// We assume that the selectable is a DocumentSelection.\r\n\t\t\t// It can't be imported here, because it would lead to circular imports.\r\n\t\t\tthis._setRanges( selectable.getRanges(), selectable.isBackward );\r\n\t\t} else if ( selectable instanceof Range ) {\r\n\t\t\tthis._setRanges( [ selectable ], !!placeOrOffset && !!placeOrOffset.backward );\r\n\t\t} else if ( selectable instanceof Position ) {\r\n\t\t\tthis._setRanges( [ new Range( selectable ) ] );\r\n\t\t} else if ( selectable instanceof Node ) {\r\n\t\t\tconst backward = !!options && !!options.backward;\r\n\t\t\tlet range;\r\n\r\n\t\t\tif ( placeOrOffset == 'in' ) {\r\n\t\t\t\trange = Range._createIn( selectable );\r\n\t\t\t} else if ( placeOrOffset == 'on' ) {\r\n\t\t\t\trange = Range._createOn( selectable );\r\n\t\t\t} else if ( placeOrOffset !== undefined ) {\r\n\t\t\t\trange = new Range( Position._createAt( selectable, placeOrOffset ) );\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * selection.setTo requires the second parameter when the first parameter is a node.\r\n\t\t\t\t *\r\n\t\t\t\t * @error model-selection-setTo-required-second-parameter\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'model-selection-setTo-required-second-parameter: ' +\r\n\t\t\t\t\t'selection.setTo requires the second parameter when the first parameter is a node.' );\r\n\t\t\t}\r\n\r\n\t\t\tthis._setRanges( [ range ], backward );\r\n\t\t} else if ( isIterable( selectable ) ) {\r\n\t\t\t// We assume that the selectable is an iterable of ranges.\r\n\t\t\tthis._setRanges( selectable, placeOrOffset && !!placeOrOffset.backward );\r\n\t\t} else {\r\n\t\t\t/**\r\n\t\t\t * Cannot set selection to given place.\r\n\t\t\t *\r\n\t\t\t * @error model-selection-setTo-not-selectable\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'model-selection-setTo-not-selectable: Cannot set selection to given place.' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces all ranges that were added to the selection with given array of ranges. Last range of the array\r\n\t * is treated like the last added range and is used to set {@link module:engine/model/selection~Selection#anchor} and\r\n\t * {@link module:engine/model/selection~Selection#focus}. Accepts a flag describing in which direction the selection is made.\r\n\t *\r\n\t * @protected\r\n\t * @fires change:range\r\n\t * @param {Iterable.<module:engine/model/range~Range>} newRanges Ranges to set.\r\n\t * @param {Boolean} [isLastBackward=false] Flag describing if last added range was selected forward - from start to end (`false`)\r\n\t * or backward - from end to start (`true`).\r\n\t */\r\n\t_setRanges( newRanges, isLastBackward = false ) {\r\n\t\tnewRanges = Array.from( newRanges );\r\n\r\n\t\t// Check whether there is any range in new ranges set that is different than all already added ranges.\r\n\t\tconst anyNewRange = newRanges.some( newRange => {\r\n\t\t\tif ( !( newRange instanceof Range ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Selection range set to an object that is not an instance of {@link module:engine/model/range~Range}.\r\n\t\t\t\t *\r\n\t\t\t\t * Only {@link module:engine/model/range~Range} instances can be used to set a selection.\r\n\t\t\t\t * Common mistakes leading to this error are:\r\n\t\t\t\t *\r\n\t\t\t\t * * using DOM `Range` object,\r\n\t\t\t\t * * incorrect CKEditor 5 installation with multiple `ckeditor5-engine` packages having different versions.\r\n\t\t\t\t *\r\n\t\t\t\t * @error model-selection-set-ranges-not-range\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'model-selection-set-ranges-not-range: ' +\r\n\t\t\t\t\t'Selection range set to an object that is not an instance of model.Range.'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn this._ranges.every( oldRange => {\r\n\t\t\t\treturn !oldRange.isEqual( newRange );\r\n\t\t\t} );\r\n\t\t} );\r\n\r\n\t\t// Don't do anything if nothing changed.\r\n\t\tif ( newRanges.length === this._ranges.length && !anyNewRange ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._removeAllRanges();\r\n\r\n\t\tfor ( const range of newRanges ) {\r\n\t\t\tthis._pushRange( range );\r\n\t\t}\r\n\r\n\t\tthis._lastRangeBackward = !!isLastBackward;\r\n\r\n\t\tthis.fire( 'change:range', { directChange: true } );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link module:engine/model/selection~Selection#focus} to the specified location.\r\n\t *\r\n\t * The location can be specified in the same form as\r\n\t * {@link module:engine/model/writer~Writer#createPositionAt writer.createPositionAt()} parameters.\r\n\t *\r\n\t * @fires change:range\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tsetFocus( itemOrPosition, offset ) {\r\n\t\tif ( this.anchor === null ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot set selection focus if there are no ranges in selection.\r\n\t\t\t *\r\n\t\t\t * @error model-selection-setFocus-no-ranges\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'model-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst newFocus = Position._createAt( itemOrPosition, offset );\r\n\r\n\t\tif ( newFocus.compareWith( this.focus ) == 'same' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst anchor = this.anchor;\r\n\r\n\t\tif ( this._ranges.length ) {\r\n\t\t\tthis._popRange();\r\n\t\t}\r\n\r\n\t\tif ( newFocus.compareWith( anchor ) == 'before' ) {\r\n\t\t\tthis._pushRange( new Range( newFocus, anchor ) );\r\n\t\t\tthis._lastRangeBackward = true;\r\n\t\t} else {\r\n\t\t\tthis._pushRange( new Range( anchor, newFocus ) );\r\n\t\t\tthis._lastRangeBackward = false;\r\n\t\t}\r\n\r\n\t\tthis.fire( 'change:range', { directChange: true } );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an attribute value for given key or `undefined` if that attribute is not set on the selection.\r\n\t *\r\n\t * @param {String} key Key of attribute to look for.\r\n\t * @returns {*} Attribute value or `undefined`.\r\n\t */\r\n\tgetAttribute( key ) {\r\n\t\treturn this._attrs.get( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterable that iterates over this selection's attributes.\r\n\t *\r\n\t * Attributes are returned as arrays containing two items. First one is attribute key and second is attribute value.\r\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\tgetAttributes() {\r\n\t\treturn this._attrs.entries();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterable that iterates over this selection's attribute keys.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetAttributeKeys() {\r\n\t\treturn this._attrs.keys();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the selection has an attribute for given key.\r\n\t *\r\n\t * @param {String} key Key of attribute to check.\r\n\t * @returns {Boolean} `true` if attribute with given key is set on selection, `false` otherwise.\r\n\t */\r\n\thasAttribute( key ) {\r\n\t\treturn this._attrs.has( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute with given key from the selection.\r\n\t *\r\n\t * If given attribute was set on the selection, fires the {@link #event:change:range} event with\r\n\t * removed attribute key.\r\n\t *\r\n\t * @fires change:attribute\r\n\t * @param {String} key Key of attribute to remove.\r\n\t */\r\n\tremoveAttribute( key ) {\r\n\t\tif ( this.hasAttribute( key ) ) {\r\n\t\t\tthis._attrs.delete( key );\r\n\r\n\t\t\tthis.fire( 'change:attribute', { attributeKeys: [ key ], directChange: true } );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets attribute on the selection. If attribute with the same key already is set, it's value is overwritten.\r\n\t *\r\n\t * If the attribute value has changed, fires the {@link #event:change:range} event with\r\n\t * the attribute key.\r\n\t *\r\n\t * @fires change:attribute\r\n\t * @param {String} key Key of attribute to set.\r\n\t * @param {*} value Attribute value.\r\n\t */\r\n\tsetAttribute( key, value ) {\r\n\t\tif ( this.getAttribute( key ) !== value ) {\r\n\t\t\tthis._attrs.set( key, value );\r\n\r\n\t\t\tthis.fire( 'change:attribute', { attributeKeys: [ key ], directChange: true } );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the selected element. {@link module:engine/model/element~Element Element} is considered as selected if there is only\r\n\t * one range in the selection, and that range contains exactly one element.\r\n\t * Returns `null` if there is no selected element.\r\n\t *\r\n\t * @returns {module:engine/model/element~Element|null}\r\n\t */\r\n\tgetSelectedElement() {\r\n\t\tif ( this.rangeCount !== 1 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst range = this.getFirstRange();\r\n\t\tconst nodeAfterStart = range.start.nodeAfter;\r\n\t\tconst nodeBeforeEnd = range.end.nodeBefore;\r\n\r\n\t\treturn ( nodeAfterStart instanceof Element && nodeAfterStart == nodeBeforeEnd ) ? nodeAfterStart : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets elements of type \"block\" touched by the selection.\r\n\t *\r\n\t * This method's result can be used for example to apply block styling to all blocks covered by this selection.\r\n\t *\r\n\t * **Note:** `getSelectedBlocks()` always returns the deepest block.\r\n\t *\r\n\t * In this case the function will return exactly all 3 paragraphs:\r\n\t *\r\n\t *\t\t<paragraph>[a</paragraph>\r\n\t *\t\t<quote>\r\n\t *\t\t\t<paragraph>b</paragraph>\r\n\t *\t\t</quote>\r\n\t *\t\t<paragraph>c]d</paragraph>\r\n\t *\r\n\t * In this case the paragraph will also be returned, despite the collapsed selection:\r\n\t *\r\n\t *\t\t<paragraph>[]a</paragraph>\r\n\t *\r\n\t * **Special case**: If a selection ends at the beginning of a block, that block is not returned as from user perspective\r\n\t * this block wasn't selected. See [#984](https://github.com/ckeditor/ckeditor5-engine/issues/984) for more details.\r\n\t *\r\n\t *\t\t<paragraph>[a</paragraph>\r\n\t *\t\t<paragraph>b</paragraph>\r\n\t *\t\t<paragraph>]c</paragraph> // this block will not be returned\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/element~Element>}\r\n\t */\r\n\t* getSelectedBlocks() {\r\n\t\tconst visited = new WeakSet();\r\n\r\n\t\tfor ( const range of this.getRanges() ) {\r\n\t\t\tconst startBlock = getParentBlock( range.start, visited );\r\n\r\n\t\t\tif ( startBlock ) {\r\n\t\t\t\tyield startBlock;\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const value of range.getWalker() ) {\r\n\t\t\t\tif ( value.type == 'elementEnd' && isUnvisitedBlockContainer( value.item, visited ) ) {\r\n\t\t\t\t\tyield value.item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst endBlock = getParentBlock( range.end, visited );\r\n\r\n\t\t\t// #984. Don't return the end block if the range ends right at its beginning.\r\n\t\t\tif ( endBlock && !range.end.isTouching( Position._createAt( endBlock, 0 ) ) ) {\r\n\t\t\t\tyield endBlock;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the selection contains the entire content of the given element. This means that selection must start\r\n\t * at a position {@link module:engine/model/position~Position#isTouching touching} the element's start and ends at position\r\n\t * touching the element's end.\r\n\t *\r\n\t * By default, this method will check whether the entire content of the selection's current root is selected.\r\n\t * Useful to check if e.g. the user has just pressed <kbd>Ctrl</kbd> + <kbd>A</kbd>.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} [element=this.anchor.root]\r\n\t * @returns {Boolean}\r\n\t */\r\n\tcontainsEntireContent( element = this.anchor.root ) {\r\n\t\tconst limitStartPosition = Position._createAt( element, 0 );\r\n\t\tconst limitEndPosition = Position._createAt( element, 'end' );\r\n\r\n\t\treturn limitStartPosition.isTouching( this.getFirstPosition() ) &&\r\n\t\t\tlimitEndPosition.isTouching( this.getLastPosition() );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds given range to internal {@link #_ranges ranges array}. Throws an error\r\n\t * if given range is intersecting with any range that is already stored in this selection.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/range~Range} range Range to add.\r\n\t */\r\n\t_pushRange( range ) {\r\n\t\tthis._checkRange( range );\r\n\t\tthis._ranges.push( new Range( range.start, range.end ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if given range intersects with ranges that are already in the selection. Throws an error if it does.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/range~Range} range Range to check.\r\n\t */\r\n\t_checkRange( range ) {\r\n\t\tfor ( let i = 0; i < this._ranges.length; i++ ) {\r\n\t\t\tif ( range.isIntersecting( this._ranges[ i ] ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Trying to add a range that intersects with another range in the selection.\r\n\t\t\t\t *\r\n\t\t\t\t * @error model-selection-range-intersects\r\n\t\t\t\t * @param {module:engine/model/range~Range} addedRange Range that was added to the selection.\r\n\t\t\t\t * @param {module:engine/model/range~Range} intersectingRange Range in the selection that intersects with `addedRange`.\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'model-selection-range-intersects: Trying to add a range that intersects with another range in the selection.',\r\n\t\t\t\t\t{ addedRange: range, intersectingRange: this._ranges[ i ] }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes ranges from internal range array. Uses {@link #_popRange _popRange} to\r\n\t * ensure proper ranges removal.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_removeAllRanges() {\r\n\t\twhile ( this._ranges.length > 0 ) {\r\n\t\t\tthis._popRange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes most recently added range from the selection.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_popRange() {\r\n\t\tthis._ranges.pop();\r\n\t}\r\n\r\n\t/**\r\n\t * Fired when selection range(s) changed.\r\n\t *\r\n\t * @event change:range\r\n\t * @param {Boolean} directChange In case of {@link module:engine/model/selection~Selection} class it is always set\r\n\t * to `true` which indicates that the selection change was caused by a direct use of selection's API.\r\n\t * The {@link module:engine/model/documentselection~DocumentSelection}, however, may change because its position\r\n\t * was directly changed through the {@link module:engine/model/writer~Writer writer} or because its position was\r\n\t * changed because the structure of the model has been changed (which means an indirect change).\r\n\t * The indirect change does not occur in case of normal (detached) selections because they are \"static\" (as \"not live\")\r\n\t * which mean that they are not updated once the document changes.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when selection attribute changed.\r\n\t *\r\n\t * @event change:attribute\r\n\t * @param {Boolean} directChange In case of {@link module:engine/model/selection~Selection} class it is always set\r\n\t * to `true` which indicates that the selection change was caused by a direct use of selection's API.\r\n\t * The {@link module:engine/model/documentselection~DocumentSelection}, however, may change because its attributes\r\n\t * were directly changed through the {@link module:engine/model/writer~Writer writer} or because its position was\r\n\t * changed in the model and its attributes were refreshed (which means an indirect change).\r\n\t * The indirect change does not occur in case of normal (detached) selections because they are \"static\" (as \"not live\")\r\n\t * which mean that they are not updated once the document changes.\r\n\t * @param {Array.<String>} attributeKeys Array containing keys of attributes that changed.\r\n\t */\r\n}\r\n\r\nmix( Selection, EmitterMixin );\r\n\r\n// Checks whether the given element extends $block in the schema and has a parent (is not a root).\r\n// Marks it as already visited.\r\nfunction isUnvisitedBlockContainer( element, visited ) {\r\n\tif ( visited.has( element ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvisited.add( element );\r\n\r\n\treturn element.document.model.schema.isBlock( element ) && element.parent;\r\n}\r\n\r\n// Finds the lowest element in position's ancestors which is a block.\r\n// Marks all ancestors as already visited to not include any of them later on.\r\nfunction getParentBlock( position, visited ) {\r\n\tconst ancestors = position.parent.getAncestors( { parentFirst: true, includeSelf: true } );\r\n\tconst block = ancestors.find( element => isUnvisitedBlockContainer( element, visited ) );\r\n\r\n\t// Mark all ancestors of this position's parent, because find() might've stopped early and\r\n\t// the found block may be a child of another block.\r\n\tancestors.forEach( element => visited.add( element ) );\r\n\r\n\treturn block;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/liverange\r\n */\r\n\r\nimport Range from './range';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * `LiveRange` is a type of {@link module:engine/model/range~Range Range}\r\n * that updates itself as {@link module:engine/model/document~Document document}\r\n * is changed through operations. It may be used as a bookmark.\r\n *\r\n * **Note:** Be very careful when dealing with `LiveRange`. Each `LiveRange` instance bind events that might\r\n * have to be unbound. Use {@link module:engine/model/liverange~LiveRange#detach detach} whenever you don't need `LiveRange` anymore.\r\n */\r\nexport default class LiveRange extends Range {\r\n\t/**\r\n\t * Creates a live range.\r\n\t *\r\n\t * @see module:engine/model/range~Range\r\n\t */\r\n\tconstructor( start, end ) {\r\n\t\tsuper( start, end );\r\n\r\n\t\tbindWithDocument.call( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds all events previously bound by `LiveRange`. Use it whenever you don't need `LiveRange` instance\r\n\t * anymore (i.e. when leaving scope in which it was declared or before re-assigning variable that was\r\n\t * referring to it).\r\n\t */\r\n\tdetach() {\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/model/range~Range range instance} that is equal to this live range.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\ttoRange() {\r\n\t\treturn new Range( this.start, this.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `LiveRange` instance that is equal to the given range.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} range\r\n\t * @returns {module:engine/model/liverange~LiveRange}\r\n\t */\r\n\tstatic fromRange( range ) {\r\n\t\treturn new LiveRange( range.start, range.end );\r\n\t}\r\n\r\n\t/**\r\n\t * @see module:engine/model/range~Range._createIn\r\n\t * @static\r\n\t * @protected\r\n\t * @method module:engine/model/liverange~LiveRange._createIn\r\n\t * @param {module:engine/model/element~Element} element\r\n\t * @returns {module:engine/model/liverange~LiveRange}\r\n\t */\r\n\r\n\t/**\r\n\t * @see module:engine/model/range~Range._createOn\r\n\t * @static\r\n\t * @protected\r\n\t * @method module:engine/model/liverange~LiveRange._createOn\r\n\t * @param {module:engine/model/element~Element} element\r\n\t * @returns {module:engine/model/liverange~LiveRange}\r\n\t */\r\n\r\n\t/**\r\n\t * @see module:engine/model/range~Range._createFromPositionAndShift\r\n\t * @static\r\n\t * @protected\r\n\t * @method module:engine/model/liverange~LiveRange._createFromPositionAndShift\r\n\t * @param {module:engine/model/position~Position} position\r\n\t * @param {Number} shift\r\n\t * @returns {module:engine/model/liverange~LiveRange}\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `LiveRange` instance boundaries have changed due to changes in the\r\n\t * {@link module:engine/model/document~Document document}.\r\n\t *\r\n\t * @event change:range\r\n\t * @param {module:engine/model/range~Range} oldRange Range with start and end position equal to start and end position of this live\r\n\t * range before it got changed.\r\n\t * @param {Object} data Object with additional information about the change.\r\n\t * @param {module:engine/model/position~Position|null} data.deletionPosition Source position for remove and merge changes.\r\n\t * Available if the range was moved to the graveyard root, `null` otherwise.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `LiveRange` instance boundaries have not changed after a change in {@link module:engine/model/document~Document document}\r\n\t * but the change took place inside the range, effectively changing its content.\r\n\t *\r\n\t * @event change:content\r\n\t * @param {module:engine/model/range~Range} range Range with start and end position equal to start and end position of\r\n\t * change range.\r\n\t * @param {Object} data Object with additional information about the change.\r\n\t * @param {null} data.deletionPosition Due to the nature of this event, this property is always set to `null`. It is passed\r\n\t * for compatibility with the {@link module:engine/model/liverange~LiveRange#event:change:range} event.\r\n\t */\r\n}\r\n\r\n// Binds this `LiveRange` to the {@link module:engine/model/document~Document document}\r\n// that owns this range's {@link module:engine/model/range~Range#root root}.\r\n//\r\n// @private\r\nfunction bindWithDocument() {\r\n\tthis.listenTo(\r\n\t\tthis.root.document.model,\r\n\t\t'applyOperation',\r\n\t\t( event, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\tif ( !operation.isDocumentOperation ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttransform.call( this, operation );\r\n\t\t},\r\n\t\t{ priority: 'low' }\r\n\t);\r\n}\r\n\r\n// Updates this range accordingly to the updates applied to the model. Bases on change events.\r\n//\r\n// @private\r\n// @param {module:engine/model/operation/operation~Operation} operation Executed operation.\r\nfunction transform( operation ) {\r\n\t// Transform the range by the operation. Join the result ranges if needed.\r\n\tconst ranges = this.getTransformedByOperation( operation );\r\n\tconst result = Range._createFromRanges( ranges );\r\n\r\n\tconst boundariesChanged = !result.isEqual( this );\r\n\tconst contentChanged = doesOperationChangeRangeContent( this, operation );\r\n\r\n\tlet deletionPosition = null;\r\n\r\n\tif ( boundariesChanged ) {\r\n\t\t// If range boundaries have changed, fire `change:range` event.\r\n\t\t//\r\n\t\tif ( result.root.rootName == '$graveyard' ) {\r\n\t\t\t// If the range was moved to the graveyard root, set `deletionPosition`.\r\n\t\t\tif ( operation.type == 'remove' ) {\r\n\t\t\t\tdeletionPosition = operation.sourcePosition;\r\n\t\t\t} else {\r\n\t\t\t\t// Merge operation.\r\n\t\t\t\tdeletionPosition = operation.deletionPosition;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst oldRange = this.toRange();\r\n\r\n\t\tthis.start = result.start;\r\n\t\tthis.end = result.end;\r\n\r\n\t\tthis.fire( 'change:range', oldRange, { deletionPosition } );\r\n\t} else if ( contentChanged ) {\r\n\t\t// If range boundaries have not changed, but there was change inside the range, fire `change:content` event.\r\n\t\tthis.fire( 'change:content', this.toRange(), { deletionPosition } );\r\n\t}\r\n}\r\n\r\n// Checks whether given operation changes something inside the range (even if it does not change boundaries).\r\n//\r\n// @private\r\n// @param {module:engine/model/range~Range} range Range to check.\r\n// @param {module:engine/model/operation/operation~Operation} operation Executed operation.\r\n// @returns {Boolean}\r\nfunction doesOperationChangeRangeContent( range, operation ) {\r\n\tswitch ( operation.type ) {\r\n\t\tcase 'insert':\r\n\t\t\treturn range.containsPosition( operation.position );\r\n\t\tcase 'move':\r\n\t\tcase 'remove':\r\n\t\tcase 'reinsert':\r\n\t\tcase 'merge':\r\n\t\t\treturn range.containsPosition( operation.sourcePosition ) ||\r\n\t\t\t\trange.start.isEqual( operation.sourcePosition ) ||\r\n\t\t\t\trange.containsPosition( operation.targetPosition );\r\n\t\tcase 'split':\r\n\t\t\treturn range.containsPosition( operation.splitPosition ) || range.containsPosition( operation.insertionPosition );\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nmix( LiveRange, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/documentselection\r\n */\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\n\r\nimport Selection from './selection';\r\nimport LiveRange from './liverange';\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport toMap from '@ckeditor/ckeditor5-utils/src/tomap';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport uid from '@ckeditor/ckeditor5-utils/src/uid';\r\n\r\nconst storePrefix = 'selection:';\r\n\r\n/**\r\n * `DocumentSelection` is a special selection which is used as the\r\n * {@link module:engine/model/document~Document#selection document's selection}.\r\n * There can be only one instance of `DocumentSelection` per document.\r\n *\r\n * Document selection can only be changed by using the {@link module:engine/model/writer~Writer} instance\r\n * inside the {@link module:engine/model/model~Model#change `change()`} block, as it provides a secure way to modify model.\r\n *\r\n * `DocumentSelection` is automatically updated upon changes in the {@link module:engine/model/document~Document document}\r\n * to always contain valid ranges. Its attributes are inherited from the text unless set explicitly.\r\n *\r\n * Differences between {@link module:engine/model/selection~Selection} and `DocumentSelection` are:\r\n * * there is always a range in `DocumentSelection` - even if no ranges were added there is a \"default range\"\r\n * present in the selection,\r\n * * ranges added to this selection updates automatically when the document changes,\r\n * * attributes of `DocumentSelection` are updated automatically according to selection ranges.\r\n *\r\n * Since `DocumentSelection` uses {@link module:engine/model/liverange~LiveRange live ranges}\r\n * and is updated when {@link module:engine/model/document~Document document}\r\n * changes, it cannot be set on {@link module:engine/model/node~Node nodes}\r\n * that are inside {@link module:engine/model/documentfragment~DocumentFragment document fragment}.\r\n * If you need to represent a selection in document fragment,\r\n * use {@link module:engine/model/selection~Selection Selection class} instead.\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class DocumentSelection {\r\n\t/**\r\n\t * Creates an empty live selection for given {@link module:engine/model/document~Document}.\r\n\t *\r\n\t * @param {module:engine/model/document~Document} doc Document which owns this selection.\r\n\t */\r\n\tconstructor( doc ) {\r\n\t\t/**\r\n\t\t * Selection used internally by that class (`DocumentSelection` is a proxy to that selection).\r\n\t\t *\r\n\t\t * @protected\r\n\t\t */\r\n\t\tthis._selection = new LiveSelection( doc );\r\n\r\n\t\tthis._selection.delegate( 'change:range' ).to( this );\r\n\t\tthis._selection.delegate( 'change:attribute' ).to( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether the selection is collapsed. Selection is collapsed when there is exactly one range which is\r\n\t * collapsed.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isCollapsed() {\r\n\t\treturn this._selection.isCollapsed;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection anchor. Anchor may be described as a position where the most recent part of the selection starts.\r\n\t * Together with {@link #focus} they define the direction of selection, which is important\r\n\t * when expanding/shrinking selection. Anchor is always {@link module:engine/model/range~Range#start start} or\r\n\t * {@link module:engine/model/range~Range#end end} position of the most recently added range.\r\n\t *\r\n\t * Is set to `null` if there are no ranges in selection.\r\n\t *\r\n\t * @see #focus\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position|null}\r\n\t */\r\n\tget anchor() {\r\n\t\treturn this._selection.anchor;\r\n\t}\r\n\r\n\t/**\r\n\t * Selection focus. Focus is a position where the selection ends.\r\n\t *\r\n\t * Is set to `null` if there are no ranges in selection.\r\n\t *\r\n\t * @see #anchor\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position|null}\r\n\t */\r\n\tget focus() {\r\n\t\treturn this._selection.focus;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns number of ranges in selection.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget rangeCount() {\r\n\t\treturn this._selection.rangeCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Describes whether `Documentselection` has own range(s) set, or if it is defaulted to\r\n\t * {@link module:engine/model/document~Document#_getDefaultRange document's default range}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget hasOwnRange() {\r\n\t\treturn this._selection.hasOwnRange;\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies whether the {@link #focus}\r\n\t * precedes {@link #anchor}.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isBackward() {\r\n\t\treturn this._selection.isBackward;\r\n\t}\r\n\r\n\t/**\r\n\t * Describes whether the gravity is overridden (using {@link module:engine/model/writer~Writer#overrideSelectionGravity}) or not.\r\n\t *\r\n\t * Note that the gravity remains overridden as long as will not be restored the same number of times as it was overridden.\r\n\t *\r\n\t * @readonly\r\n\t * @returns {Boolean}\r\n\t */\r\n\tget isGravityOverridden() {\r\n\t\treturn this._selection.isGravityOverridden;\r\n\t}\r\n\r\n\t/**\r\n\t * Used for the compatibility with the {@link module:engine/model/selection~Selection#isEqual} method.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tget _ranges() {\r\n\t\treturn this._selection._ranges;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterable that iterates over copies of selection ranges.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/range~Range>}\r\n\t */\r\n\tgetRanges() {\r\n\t\treturn this._selection.getRanges();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first position in the selection.\r\n\t * First position is the position that {@link module:engine/model/position~Position#isBefore is before}\r\n\t * any other position in the selection.\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position|null}\r\n\t */\r\n\tgetFirstPosition() {\r\n\t\treturn this._selection.getFirstPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the last position in the selection.\r\n\t * Last position is the position that {@link module:engine/model/position~Position#isAfter is after}\r\n\t * any other position in the selection.\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position|null}\r\n\t */\r\n\tgetLastPosition() {\r\n\t\treturn this._selection.getLastPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of the first range in the selection.\r\n\t * First range is the one which {@link module:engine/model/range~Range#start start} position\r\n\t * {@link module:engine/model/position~Position#isBefore is before} start position of all other ranges\r\n\t * (not to confuse with the first range added to the selection).\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range|null}\r\n\t */\r\n\tgetFirstRange() {\r\n\t\treturn this._selection.getFirstRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of the last range in the selection.\r\n\t * Last range is the one which {@link module:engine/model/range~Range#end end} position\r\n\t * {@link module:engine/model/position~Position#isAfter is after} end position of all other ranges (not to confuse with the range most\r\n\t * recently added to the selection).\r\n\t *\r\n\t * Returns `null` if there are no ranges in selection.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range|null}\r\n\t */\r\n\tgetLastRange() {\r\n\t\treturn this._selection.getLastRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets elements of type \"block\" touched by the selection.\r\n\t *\r\n\t * This method's result can be used for example to apply block styling to all blocks covered by this selection.\r\n\t *\r\n\t * **Note:** `getSelectedBlocks()` always returns the deepest block.\r\n\t *\r\n\t * In this case the function will return exactly all 3 paragraphs:\r\n\t *\r\n\t *\t\t<paragraph>[a</paragraph>\r\n\t *\t\t<quote>\r\n\t *\t\t\t<paragraph>b</paragraph>\r\n\t *\t\t</quote>\r\n\t *\t\t<paragraph>c]d</paragraph>\r\n\t *\r\n\t * In this case the paragraph will also be returned, despite the collapsed selection:\r\n\t *\r\n\t *\t\t<paragraph>[]a</paragraph>\r\n\t *\r\n\t * **Special case**: If a selection ends at the beginning of a block, that block is not returned as from user perspective\r\n\t * this block wasn't selected. See [#984](https://github.com/ckeditor/ckeditor5-engine/issues/984) for more details.\r\n\t *\r\n\t *\t\t<paragraph>[a</paragraph>\r\n\t *\t\t<paragraph>b</paragraph>\r\n\t *\t\t<paragraph>]c</paragraph> // this block will not be returned\r\n\t *\r\n\t * @returns {Iterator.<module:engine/model/element~Element>}\r\n\t */\r\n\tgetSelectedBlocks() {\r\n\t\treturn this._selection.getSelectedBlocks();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the selected element. {@link module:engine/model/element~Element Element} is considered as selected if there is only\r\n\t * one range in the selection, and that range contains exactly one element.\r\n\t * Returns `null` if there is no selected element.\r\n\t *\r\n\t * @returns {module:engine/model/element~Element|null}\r\n\t */\r\n\tgetSelectedElement() {\r\n\t\treturn this._selection.getSelectedElement();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the selection contains the entire content of the given element. This means that selection must start\r\n\t * at a position {@link module:engine/model/position~Position#isTouching touching} the element's start and ends at position\r\n\t * touching the element's end.\r\n\t *\r\n\t * By default, this method will check whether the entire content of the selection's current root is selected.\r\n\t * Useful to check if e.g. the user has just pressed <kbd>Ctrl</kbd> + <kbd>A</kbd>.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} [element=this.anchor.root]\r\n\t * @returns {Boolean}\r\n\t */\r\n\tcontainsEntireContent( element ) {\r\n\t\treturn this._selection.containsEntireContent( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds all events previously bound by document selection.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._selection.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterable that iterates over this selection's attribute keys.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\tgetAttributeKeys() {\r\n\t\treturn this._selection.getAttributeKeys();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterable that iterates over this selection's attributes.\r\n\t *\r\n\t * Attributes are returned as arrays containing two items. First one is attribute key and second is attribute value.\r\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\tgetAttributes() {\r\n\t\treturn this._selection.getAttributes();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an attribute value for given key or `undefined` if that attribute is not set on the selection.\r\n\t *\r\n\t * @param {String} key Key of attribute to look for.\r\n\t * @returns {*} Attribute value or `undefined`.\r\n\t */\r\n\tgetAttribute( key ) {\r\n\t\treturn this._selection.getAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the selection has an attribute for given key.\r\n\t *\r\n\t * @param {String} key Key of attribute to check.\r\n\t * @returns {Boolean} `true` if attribute with given key is set on selection, `false` otherwise.\r\n\t */\r\n\thasAttribute( key ) {\r\n\t\treturn this._selection.hasAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link module:engine/model/documentselection~DocumentSelection#focus} to the specified location.\r\n\t * Should be used only within the {@link module:engine/model/writer~Writer#setSelectionFocus} method.\r\n\t *\r\n\t * The location can be specified in the same form as\r\n\t * {@link module:engine/model/writer~Writer#createPositionAt writer.createPositionAt()} parameters.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#setSelectionFocus\r\n\t * @protected\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\t_setFocus( itemOrPosition, offset ) {\r\n\t\tthis._selection.setFocus( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets this selection's ranges and direction to the specified location based on the given\r\n\t * {@link module:engine/model/selection~Selection selection}, {@link module:engine/model/position~Position position},\r\n\t * {@link module:engine/model/node~Node node}, {@link module:engine/model/position~Position position},\r\n\t * {@link module:engine/model/range~Range range}, an iterable of {@link module:engine/model/range~Range ranges} or null.\r\n\t * Should be used only within the {@link module:engine/model/writer~Writer#setSelection} method.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#setSelection\r\n\t * @protected\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/node~Node|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t */\r\n\t_setTo( selectable, placeOrOffset, options ) {\r\n\t\tthis._selection.setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets attribute on the selection. If attribute with the same key already is set, it's value is overwritten.\r\n\t * Should be used only within the {@link module:engine/model/writer~Writer#setSelectionAttribute} method.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#setSelectionAttribute\r\n\t * @protected\r\n\t * @param {String} key Key of the attribute to set.\r\n\t * @param {*} value Attribute value.\r\n\t */\r\n\t_setAttribute( key, value ) {\r\n\t\tthis._selection.setAttribute( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute with given key from the selection.\r\n\t * If the given attribute was set on the selection, fires the {@link module:engine/model/selection~Selection#event:change:range}\r\n\t * event with removed attribute key.\r\n\t * Should be used only within the {@link module:engine/model/writer~Writer#removeSelectionAttribute} method.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#removeSelectionAttribute\r\n\t * @protected\r\n\t * @param {String} key Key of the attribute to remove.\r\n\t */\r\n\t_removeAttribute( key ) {\r\n\t\tthis._selection.removeAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterable that iterates through all selection attributes stored in current selection's parent.\r\n\t *\r\n\t * @protected\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\t_getStoredAttributes() {\r\n\t\treturn this._selection._getStoredAttributes();\r\n\t}\r\n\r\n\t/**\r\n\t * Temporarily changes the gravity of the selection from the left to the right.\r\n\t *\r\n\t * The gravity defines from which direction the selection inherits its attributes. If it's the default left\r\n\t * gravity, the selection (after being moved by the the user) inherits attributes from its left hand side.\r\n\t * This method allows to temporarily override this behavior by forcing the gravity to the right.\r\n\t *\r\n\t * It returns an unique identifier which is required to restore the gravity. It guarantees the symmetry\r\n\t * of the process.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#overrideSelectionGravity\r\n\t * @protected\r\n\t * @returns {String} The unique id which allows restoring the gravity.\r\n\t */\r\n\t_overrideGravity() {\r\n\t\treturn this._selection.overrideGravity();\r\n\t}\r\n\r\n\t/**\r\n\t * Restores the {@link ~DocumentSelection#_overrideGravity overridden gravity}.\r\n\t *\r\n\t * Restoring the gravity is only possible using the unique identifier returned by\r\n\t * {@link ~DocumentSelection#_overrideGravity}. Note that the gravity remains overridden as long as won't be restored\r\n\t * the same number of times it was overridden.\r\n\t *\r\n\t * @see module:engine/model/writer~Writer#restoreSelectionGravity\r\n\t * @protected\r\n\t * @param {String} uid The unique id returned by {@link #_overrideGravity}.\r\n\t */\r\n\t_restoreGravity( uid ) {\r\n\t\tthis._selection.restoreGravity( uid );\r\n\t}\r\n\r\n\t/**\r\n\t * Generates and returns an attribute key for selection attributes store, basing on original attribute key.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} key Attribute key to convert.\r\n\t * @returns {String} Converted attribute key, applicable for selection store.\r\n\t */\r\n\tstatic _getStoreAttributeKey( key ) {\r\n\t\treturn storePrefix + key;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given attribute key is an attribute stored on an element.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} key\r\n\t * @returns {Boolean}\r\n\t */\r\n\tstatic _isStoreAttributeKey( key ) {\r\n\t\treturn key.startsWith( storePrefix );\r\n\t}\r\n}\r\n\r\nmix( DocumentSelection, EmitterMixin );\r\n\r\n/**\r\n * Fired when selection range(s) changed.\r\n *\r\n * @event change:range\r\n * @param {Boolean} directChange In case of {@link module:engine/model/selection~Selection} class it is always set\r\n * to `true` which indicates that the selection change was caused by a direct use of selection's API.\r\n * The {@link module:engine/model/documentselection~DocumentSelection}, however, may change because its position\r\n * was directly changed through the {@link module:engine/model/writer~Writer writer} or because its position was\r\n * changed because the structure of the model has been changed (which means an indirect change).\r\n * The indirect change does not occur in case of normal (detached) selections because they are \"static\" (as \"not live\")\r\n * which mean that they are not updated once the document changes.\r\n */\r\n\r\n/**\r\n * Fired when selection attribute changed.\r\n *\r\n * @event change:attribute\r\n * @param {Boolean} directChange In case of {@link module:engine/model/selection~Selection} class it is always set\r\n * to `true` which indicates that the selection change was caused by a direct use of selection's API.\r\n * The {@link module:engine/model/documentselection~DocumentSelection}, however, may change because its attributes\r\n * were directly changed through the {@link module:engine/model/writer~Writer writer} or because its position was\r\n * changed in the model and its attributes were refreshed (which means an indirect change).\r\n * The indirect change does not occur in case of normal (detached) selections because they are \"static\" (as \"not live\")\r\n * which mean that they are not updated once the document changes.\r\n * @param {Array.<String>} attributeKeys Array containing keys of attributes that changed.\r\n */\r\n\r\n// `LiveSelection` is used internally by {@link module:engine/model/documentselection~DocumentSelection} and shouldn't be used directly.\r\n//\r\n// LiveSelection` is automatically updated upon changes in the {@link module:engine/model/document~Document document}\r\n// to always contain valid ranges. Its attributes are inherited from the text unless set explicitly.\r\n//\r\n// Differences between {@link module:engine/model/selection~Selection} and `LiveSelection` are:\r\n// * there is always a range in `LiveSelection` - even if no ranges were added there is a \"default range\"\r\n// present in the selection,\r\n// * ranges added to this selection updates automatically when the document changes,\r\n// * attributes of `LiveSelection` are updated automatically according to selection ranges.\r\n//\r\n// @extends module:engine/model/selection~Selection\r\n//\r\n\r\nclass LiveSelection extends Selection {\r\n\t// Creates an empty live selection for given {@link module:engine/model/document~Document}.\r\n\t// @param {module:engine/model/document~Document} doc Document which owns this selection.\r\n\tconstructor( doc ) {\r\n\t\tsuper();\r\n\r\n\t\t// Document which owns this selection.\r\n\t\t//\r\n\t\t// @protected\r\n\t\t// @member {module:engine/model/model~Model}\r\n\t\tthis._model = doc.model;\r\n\r\n\t\t// Document which owns this selection.\r\n\t\t//\r\n\t\t// @protected\r\n\t\t// @member {module:engine/model/document~Document}\r\n\t\tthis._document = doc;\r\n\r\n\t\t// Keeps mapping of attribute name to priority with which the attribute got modified (added/changed/removed)\r\n\t\t// last time. Possible values of priority are: `'low'` and `'normal'`.\r\n\t\t//\r\n\t\t// Priorities are used by internal `LiveSelection` mechanisms. All attributes set using `LiveSelection`\r\n\t\t// attributes API are set with `'normal'` priority.\r\n\t\t//\r\n\t\t// @private\r\n\t\t// @member {Map} module:engine/model/liveselection~LiveSelection#_attributePriority\r\n\t\tthis._attributePriority = new Map();\r\n\r\n\t\t// Contains data required to fix ranges which have been moved to the graveyard.\r\n\t\t// @private\r\n\t\t// @member {Array} module:engine/model/liveselection~LiveSelection#_fixGraveyardRangesData\r\n\t\tthis._fixGraveyardRangesData = [];\r\n\r\n\t\t// Flag that informs whether the selection ranges have changed. It is changed on true when `LiveRange#change:range` event is fired.\r\n\t\t// @private\r\n\t\t// @member {Array} module:engine/model/liveselection~LiveSelection#_hasChangedRange\r\n\t\tthis._hasChangedRange = false;\r\n\r\n\t\t// Each overriding gravity adds an UID to the set and each removal removes it.\r\n\t\t// Gravity is overridden when there's at least one UID in the set.\r\n\t\t// Gravity is restored when the set is empty.\r\n\t\t// This is to prevent conflicts when gravity is overridden by more than one feature at the same time.\r\n\t\t// @private\r\n\t\t// @type {Set}\r\n\t\tthis._overriddenGravityRegister = new Set();\r\n\r\n\t\t// Add events that will ensure selection correctness.\r\n\t\tthis.on( 'change:range', () => {\r\n\t\t\tfor ( const range of this.getRanges() ) {\r\n\t\t\t\tif ( !this._document._validateSelectionRange( range ) ) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Range from {@link module:engine/model/documentselection~DocumentSelection document selection}\r\n\t\t\t\t\t * starts or ends at incorrect position.\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * @error document-selection-wrong-position\r\n\t\t\t\t\t * @param {module:engine/model/range~Range} range\r\n\t\t\t\t\t */\r\n\t\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t\t'document-selection-wrong-position: Range from document selection starts or ends at incorrect position.',\r\n\t\t\t\t\t\t{ range }\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis.listenTo( this._document, 'change', ( evt, batch ) => {\r\n\t\t\t// Update selection's attributes.\r\n\t\t\tthis._updateAttributes( false );\r\n\r\n\t\t\t// Clear selection attributes from element if no longer empty.\r\n\t\t\tclearAttributesStoredInElement( this._model, batch );\r\n\t\t} );\r\n\r\n\t\tthis.listenTo( this._model, 'applyOperation', () => {\r\n\t\t\twhile ( this._fixGraveyardRangesData.length ) {\r\n\t\t\t\tconst { liveRange, sourcePosition } = this._fixGraveyardRangesData.shift();\r\n\r\n\t\t\t\tthis._fixGraveyardSelection( liveRange, sourcePosition );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._hasChangedRange ) {\r\n\t\t\t\tthis._hasChangedRange = false;\r\n\r\n\t\t\t\tthis.fire( 'change:range', { directChange: false } );\r\n\t\t\t}\r\n\t\t}, { priority: 'lowest' } );\r\n\t}\r\n\r\n\tget isCollapsed() {\r\n\t\tconst length = this._ranges.length;\r\n\r\n\t\treturn length === 0 ? this._document._getDefaultRange().isCollapsed : super.isCollapsed;\r\n\t}\r\n\r\n\tget anchor() {\r\n\t\treturn super.anchor || this._document._getDefaultRange().start;\r\n\t}\r\n\r\n\tget focus() {\r\n\t\treturn super.focus || this._document._getDefaultRange().end;\r\n\t}\r\n\r\n\tget rangeCount() {\r\n\t\treturn this._ranges.length ? this._ranges.length : 1;\r\n\t}\r\n\r\n\t// Describes whether `LiveSelection` has own range(s) set, or if it is defaulted to\r\n\t// {@link module:engine/model/document~Document#_getDefaultRange document's default range}.\r\n\t//\r\n\t// @readonly\r\n\t// @type {Boolean}\r\n\tget hasOwnRange() {\r\n\t\treturn this._ranges.length > 0;\r\n\t}\r\n\r\n\t// When set to `true` then selection attributes on node before the caret won't be taken\r\n\t// into consideration while updating selection attributes.\r\n\t//\r\n\t// @protected\r\n\t// @type {Boolean}\r\n\tget isGravityOverridden() {\r\n\t\treturn !!this._overriddenGravityRegister.size;\r\n\t}\r\n\r\n\t// Unbinds all events previously bound by live selection.\r\n\tdestroy() {\r\n\t\tfor ( let i = 0; i < this._ranges.length; i++ ) {\r\n\t\t\tthis._ranges[ i ].detach();\r\n\t\t}\r\n\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t* getRanges() {\r\n\t\tif ( this._ranges.length ) {\r\n\t\t\tyield* super.getRanges();\r\n\t\t} else {\r\n\t\t\tyield this._document._getDefaultRange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetFirstRange() {\r\n\t\treturn super.getFirstRange() || this._document._getDefaultRange();\r\n\t}\r\n\r\n\tgetLastRange() {\r\n\t\treturn super.getLastRange() || this._document._getDefaultRange();\r\n\t}\r\n\r\n\tsetTo( selectable, optionsOrPlaceOrOffset, options ) {\r\n\t\tsuper.setTo( selectable, optionsOrPlaceOrOffset, options );\r\n\t\tthis._refreshAttributes();\r\n\t}\r\n\r\n\tsetFocus( itemOrPosition, offset ) {\r\n\t\tsuper.setFocus( itemOrPosition, offset );\r\n\t\tthis._refreshAttributes();\r\n\t}\r\n\r\n\tsetAttribute( key, value ) {\r\n\t\tif ( this._setAttribute( key, value ) ) {\r\n\t\t\t// Fire event with exact data.\r\n\t\t\tconst attributeKeys = [ key ];\r\n\t\t\tthis.fire( 'change:attribute', { attributeKeys, directChange: true } );\r\n\t\t}\r\n\t}\r\n\r\n\tremoveAttribute( key ) {\r\n\t\tif ( this._removeAttribute( key ) ) {\r\n\t\t\t// Fire event with exact data.\r\n\t\t\tconst attributeKeys = [ key ];\r\n\t\t\tthis.fire( 'change:attribute', { attributeKeys, directChange: true } );\r\n\t\t}\r\n\t}\r\n\r\n\toverrideGravity() {\r\n\t\tconst overrideUid = uid();\r\n\r\n\t\t// Remember that another overriding has been requested. It will need to be removed\r\n\t\t// before the gravity is to be restored.\r\n\t\tthis._overriddenGravityRegister.add( overrideUid );\r\n\r\n\t\tif ( this._overriddenGravityRegister.size === 1 ) {\r\n\t\t\tthis._refreshAttributes();\r\n\t\t}\r\n\r\n\t\treturn overrideUid;\r\n\t}\r\n\r\n\trestoreGravity( uid ) {\r\n\t\tif ( !this._overriddenGravityRegister.has( uid ) ) {\r\n\t\t\t/**\r\n\t\t\t * Restoring gravity for an unknown UID is not possible. Make sure you are using a correct\r\n\t\t\t * UID obtained from the {@link module:engine/model/writer~Writer#overrideSelectionGravity} to restore.\r\n\t\t\t *\r\n\t\t\t * @error document-selection-gravity-wrong-restore\r\n\t\t\t * @param {String} uid The unique identifier returned by {@link #overrideGravity}.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'document-selection-gravity-wrong-restore: Attempting to restore the selection gravity for an unknown UID.',\r\n\t\t\t\t{ uid }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis._overriddenGravityRegister.delete( uid );\r\n\r\n\t\t// Restore gravity only when all overriding have been restored.\r\n\t\tif ( !this.isGravityOverridden ) {\r\n\t\t\tthis._refreshAttributes();\r\n\t\t}\r\n\t}\r\n\r\n\t// Removes all attributes from the selection and sets attributes according to the surrounding nodes.\r\n\t_refreshAttributes() {\r\n\t\tthis._updateAttributes( true );\r\n\t}\r\n\r\n\t_popRange() {\r\n\t\tthis._ranges.pop().detach();\r\n\t}\r\n\r\n\t_pushRange( range ) {\r\n\t\tconst liveRange = this._prepareRange( range );\r\n\r\n\t\t// `undefined` is returned when given `range` is in graveyard root.\r\n\t\tif ( liveRange ) {\r\n\t\t\tthis._ranges.push( liveRange );\r\n\t\t}\r\n\t}\r\n\r\n\t// Prepares given range to be added to selection. Checks if it is correct,\r\n\t// converts it to {@link module:engine/model/liverange~LiveRange LiveRange}\r\n\t// and sets listeners listening to the range's change event.\r\n\t//\r\n\t// @private\r\n\t// @param {module:engine/model/range~Range} range\r\n\t_prepareRange( range ) {\r\n\t\tthis._checkRange( range );\r\n\r\n\t\tif ( range.root == this._document.graveyard ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to add a Range that is in the graveyard root. Range rejected.\r\n\t\t\t *\r\n\t\t\t * @warning model-selection-range-in-graveyard\r\n\t\t\t */\r\n\t\t\tlog.warn( 'model-selection-range-in-graveyard: Trying to add a Range that is in the graveyard root. Range rejected.' );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst liveRange = LiveRange.fromRange( range );\r\n\r\n\t\tliveRange.on( 'change:range', ( evt, oldRange, data ) => {\r\n\t\t\tthis._hasChangedRange = true;\r\n\r\n\t\t\t// If `LiveRange` is in whole moved to the graveyard, save necessary data. It will be fixed on `Model#applyOperation` event.\r\n\t\t\tif ( liveRange.root == this._document.graveyard ) {\r\n\t\t\t\tthis._fixGraveyardRangesData.push( {\r\n\t\t\t\t\tliveRange,\r\n\t\t\t\t\tsourcePosition: data.deletionPosition\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn liveRange;\r\n\t}\r\n\r\n\t// Updates this selection attributes according to its ranges and the {@link module:engine/model/document~Document model document}.\r\n\t//\r\n\t// @protected\r\n\t// @param {Boolean} clearAll\r\n\t// @fires change:attribute\r\n\t_updateAttributes( clearAll ) {\r\n\t\tconst newAttributes = toMap( this._getSurroundingAttributes() );\r\n\t\tconst oldAttributes = toMap( this.getAttributes() );\r\n\r\n\t\tif ( clearAll ) {\r\n\t\t\t// If `clearAll` remove all attributes and reset priorities.\r\n\t\t\tthis._attributePriority = new Map();\r\n\t\t\tthis._attrs = new Map();\r\n\t\t} else {\r\n\t\t\t// If not, remove only attributes added with `low` priority.\r\n\t\t\tfor ( const [ key, priority ] of this._attributePriority ) {\r\n\t\t\t\tif ( priority == 'low' ) {\r\n\t\t\t\t\tthis._attrs.delete( key );\r\n\t\t\t\t\tthis._attributePriority.delete( key );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._setAttributesTo( newAttributes );\r\n\r\n\t\t// Let's evaluate which attributes really changed.\r\n\t\tconst changed = [];\r\n\r\n\t\t// First, loop through all attributes that are set on selection right now.\r\n\t\t// Check which of them are different than old attributes.\r\n\t\tfor ( const [ newKey, newValue ] of this.getAttributes() ) {\r\n\t\t\tif ( !oldAttributes.has( newKey ) || oldAttributes.get( newKey ) !== newValue ) {\r\n\t\t\t\tchanged.push( newKey );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Then, check which of old attributes got removed.\r\n\t\tfor ( const [ oldKey ] of oldAttributes ) {\r\n\t\t\tif ( !this.hasAttribute( oldKey ) ) {\r\n\t\t\t\tchanged.push( oldKey );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Fire event with exact data (fire only if anything changed).\r\n\t\tif ( changed.length > 0 ) {\r\n\t\t\tthis.fire( 'change:attribute', { attributeKeys: changed, directChange: false } );\r\n\t\t}\r\n\t}\r\n\r\n\t// Internal method for setting `LiveSelection` attribute. Supports attribute priorities (through `directChange`\r\n\t// parameter).\r\n\t//\r\n\t// @private\r\n\t// @param {String} key Attribute key.\r\n\t// @param {*} value Attribute value.\r\n\t// @param {Boolean} [directChange=true] `true` if the change is caused by `Selection` API, `false` if change\r\n\t// is caused by `Batch` API.\r\n\t// @returns {Boolean} Whether value has changed.\r\n\t_setAttribute( key, value, directChange = true ) {\r\n\t\tconst priority = directChange ? 'normal' : 'low';\r\n\r\n\t\tif ( priority == 'low' && this._attributePriority.get( key ) == 'normal' ) {\r\n\t\t\t// Priority too low.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst oldValue = super.getAttribute( key );\r\n\r\n\t\t// Don't do anything if value has not changed.\r\n\t\tif ( oldValue === value ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis._attrs.set( key, value );\r\n\r\n\t\t// Update priorities map.\r\n\t\tthis._attributePriority.set( key, priority );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Internal method for removing `LiveSelection` attribute. Supports attribute priorities (through `directChange`\r\n\t// parameter).\r\n\t//\r\n\t// NOTE: Even if attribute is not present in the selection but is provided to this method, it's priority will\r\n\t// be changed according to `directChange` parameter.\r\n\t//\r\n\t// @private\r\n\t// @param {String} key Attribute key.\r\n\t// @param {Boolean} [directChange=true] `true` if the change is caused by `Selection` API, `false` if change\r\n\t// is caused by `Batch` API.\r\n\t// @returns {Boolean} Whether attribute was removed. May not be true if such attributes didn't exist or the\r\n\t// existing attribute had higher priority.\r\n\t_removeAttribute( key, directChange = true ) {\r\n\t\tconst priority = directChange ? 'normal' : 'low';\r\n\r\n\t\tif ( priority == 'low' && this._attributePriority.get( key ) == 'normal' ) {\r\n\t\t\t// Priority too low.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Update priorities map.\r\n\t\tthis._attributePriority.set( key, priority );\r\n\r\n\t\t// Don't do anything if value has not changed.\r\n\t\tif ( !super.hasAttribute( key ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis._attrs.delete( key );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Internal method for setting multiple `LiveSelection` attributes. Supports attribute priorities (through\r\n\t// `directChange` parameter).\r\n\t//\r\n\t// @private\r\n\t// @param {Map.<String,*>} attrs Iterable object containing attributes to be set.\r\n\t// @returns {Set.<String>} Changed attribute keys.\r\n\t_setAttributesTo( attrs ) {\r\n\t\tconst changed = new Set();\r\n\r\n\t\tfor ( const [ oldKey, oldValue ] of this.getAttributes() ) {\r\n\t\t\t// Do not remove attribute if attribute with same key and value is about to be set.\r\n\t\t\tif ( attrs.get( oldKey ) === oldValue ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// All rest attributes will be removed so changed attributes won't change .\r\n\t\t\tthis._removeAttribute( oldKey, false );\r\n\t\t}\r\n\r\n\t\tfor ( const [ key, value ] of attrs ) {\r\n\t\t\t// Attribute may not be set because of attributes or because same key/value is already added.\r\n\t\t\tconst gotAdded = this._setAttribute( key, value, false );\r\n\r\n\t\t\tif ( gotAdded ) {\r\n\t\t\t\tchanged.add( key );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t// Returns an iterable that iterates through all selection attributes stored in current selection's parent.\r\n\t//\r\n\t// @protected\r\n\t// @returns {Iterable.<*>}\r\n\t* _getStoredAttributes() {\r\n\t\tconst selectionParent = this.getFirstPosition().parent;\r\n\r\n\t\tif ( this.isCollapsed && selectionParent.isEmpty ) {\r\n\t\t\tfor ( const key of selectionParent.getAttributeKeys() ) {\r\n\t\t\t\tif ( key.startsWith( storePrefix ) ) {\r\n\t\t\t\t\tconst realKey = key.substr( storePrefix.length );\r\n\r\n\t\t\t\t\tyield [ realKey, selectionParent.getAttribute( key ) ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Checks model text nodes that are closest to the selection's first position and returns attributes of first\r\n\t// found element. If there are no text nodes in selection's first position parent, it returns selection\r\n\t// attributes stored in that parent.\r\n\t//\r\n\t// @private\r\n\t// @returns {Iterable.<*>} Collection of attributes.\r\n\t_getSurroundingAttributes() {\r\n\t\tconst position = this.getFirstPosition();\r\n\t\tconst schema = this._model.schema;\r\n\r\n\t\tlet attrs = null;\r\n\r\n\t\tif ( !this.isCollapsed ) {\r\n\t\t\t// 1. If selection is a range...\r\n\t\t\tconst range = this.getFirstRange();\r\n\r\n\t\t\t// ...look for a first character node in that range and take attributes from it.\r\n\t\t\tfor ( const value of range ) {\r\n\t\t\t\t// If the item is an object, we don't want to get attributes from its children.\r\n\t\t\t\tif ( value.item.is( 'element' ) && schema.isObject( value.item ) ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// This is not an optimal solution because of https://github.com/ckeditor/ckeditor5-engine/issues/454.\r\n\t\t\t\t// It can be done better by using `break;` instead of checking `attrs === null`.\r\n\t\t\t\tif ( value.type == 'text' && attrs === null ) {\r\n\t\t\t\t\tattrs = value.item.getAttributes();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 2. If the selection is a caret or the range does not contain a character node...\r\n\r\n\t\t\tconst nodeBefore = position.textNode ? position.textNode : position.nodeBefore;\r\n\t\t\tconst nodeAfter = position.textNode ? position.textNode : position.nodeAfter;\r\n\r\n\t\t\t// When gravity is overridden then don't take node before into consideration.\r\n\t\t\tif ( !this.isGravityOverridden ) {\r\n\t\t\t\t// ...look at the node before caret and take attributes from it if it is a character node.\r\n\t\t\t\tattrs = getAttrsIfCharacter( nodeBefore );\r\n\t\t\t}\r\n\r\n\t\t\t// 3. If not, look at the node after caret...\r\n\t\t\tif ( !attrs ) {\r\n\t\t\t\tattrs = getAttrsIfCharacter( nodeAfter );\r\n\t\t\t}\r\n\r\n\t\t\t// 4. If not, try to find the first character on the left, that is in the same node.\r\n\t\t\t// When gravity is overridden then don't take node before into consideration.\r\n\t\t\tif ( !this.isGravityOverridden && !attrs ) {\r\n\t\t\t\tlet node = nodeBefore;\r\n\r\n\t\t\t\twhile ( node && !attrs ) {\r\n\t\t\t\t\tnode = node.previousSibling;\r\n\t\t\t\t\tattrs = getAttrsIfCharacter( node );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// 5. If not found, try to find the first character on the right, that is in the same node.\r\n\t\t\tif ( !attrs ) {\r\n\t\t\t\tlet node = nodeAfter;\r\n\r\n\t\t\t\twhile ( node && !attrs ) {\r\n\t\t\t\t\tnode = node.nextSibling;\r\n\t\t\t\t\tattrs = getAttrsIfCharacter( node );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// 6. If not found, selection should retrieve attributes from parent.\r\n\t\t\tif ( !attrs ) {\r\n\t\t\t\tattrs = this._getStoredAttributes();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attrs;\r\n\t}\r\n\r\n\t// Fixes a selection range after it ends up in graveyard root.\r\n\t//\r\n\t// @private\r\n\t// @param {module:engine/model/liverange~LiveRange} liveRange The range from selection, that ended up in the graveyard root.\r\n\t// @param {module:engine/model/position~Position} removedRangeStart Start position of a range which was removed.\r\n\t_fixGraveyardSelection( liveRange, removedRangeStart ) {\r\n\t\t// The start of the removed range is the closest position to the `liveRange` - the original selection range.\r\n\t\t// This is a good candidate for a fixed selection range.\r\n\t\tconst positionCandidate = removedRangeStart.clone();\r\n\r\n\t\t// Find a range that is a correct selection range and is closest to the start of removed range.\r\n\t\tconst selectionRange = this._model.schema.getNearestSelectionRange( positionCandidate );\r\n\r\n\t\t// Remove the old selection range before preparing and adding new selection range. This order is important,\r\n\t\t// because new range, in some cases, may intersect with old range (it depends on `getNearestSelectionRange()` result).\r\n\t\tconst index = this._ranges.indexOf( liveRange );\r\n\t\tthis._ranges.splice( index, 1 );\r\n\t\tliveRange.detach();\r\n\r\n\t\t// If nearest valid selection range has been found - add it in the place of old range.\r\n\t\tif ( selectionRange ) {\r\n\t\t\t// Check the range, convert it to live range, bind events, etc.\r\n\t\t\tconst newRange = this._prepareRange( selectionRange );\r\n\r\n\t\t\t// Add new range in the place of old range.\r\n\t\t\tthis._ranges.splice( index, 0, newRange );\r\n\t\t}\r\n\t\t// If nearest valid selection range cannot be found - just removing the old range is fine.\r\n\t}\r\n}\r\n\r\n// Helper function for {@link module:engine/model/liveselection~LiveSelection#_updateAttributes}.\r\n//\r\n// It takes model item, checks whether it is a text node (or text proxy) and, if so, returns it's attributes. If not, returns `null`.\r\n//\r\n// @param {module:engine/model/item~Item|null}  node\r\n// @returns {Boolean}\r\nfunction getAttrsIfCharacter( node ) {\r\n\tif ( node instanceof TextProxy || node instanceof Text ) {\r\n\t\treturn node.getAttributes();\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n// Removes selection attributes from element which is not empty anymore.\r\n//\r\n// @private\r\n// @param {module:engine/model/model~Model} model\r\n// @param {module:engine/model/batch~Batch} batch\r\nfunction clearAttributesStoredInElement( model, batch ) {\r\n\tconst differ = model.document.differ;\r\n\r\n\tfor ( const entry of differ.getChanges() ) {\r\n\t\tif ( entry.type != 'insert' ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst changeParent = entry.position.parent;\r\n\t\tconst isNoLongerEmpty = entry.length === changeParent.maxOffset;\r\n\r\n\t\tif ( isNoLongerEmpty ) {\r\n\t\t\tmodel.enqueueChange( batch, writer => {\r\n\t\t\t\tconst storedAttributes = Array.from( changeParent.getAttributeKeys() )\r\n\t\t\t\t\t.filter( key => key.startsWith( storePrefix ) );\r\n\r\n\t\t\t\tfor ( const key of storedAttributes ) {\r\n\t\t\t\t\twriter.removeAttribute( key, changeParent );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n}\r\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);\n}\n\nexport default cloneDeep;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport ModelRange from '../model/range';\r\nimport ModelSelection from '../model/selection';\r\nimport ModelElement from '../model/element';\r\n\r\nimport ViewAttributeElement from '../view/attributeelement';\r\nimport DocumentSelection from '../model/documentselection';\r\n\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport { cloneDeep } from 'lodash-es';\r\n\r\n/**\r\n * Contains downcast (model-to-view) converters for {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}.\r\n *\r\n * @module engine/conversion/downcast-converters\r\n */\r\n\r\n/**\r\n * Model element to view element conversion helper.\r\n *\r\n * This conversion results in creating a view element. For example, model `<paragraph>Foo</paragraph>` becomes `<p>Foo</p>` in the view.\r\n *\r\n *\t\tdowncastElementToElement( { model: 'paragraph', view: 'p' } );\r\n *\r\n *\t\tdowncastElementToElement( { model: 'paragraph', view: 'div', converterPriority: 'high' } );\r\n *\r\n *\t\tdowncastElementToElement( {\r\n *\t\t\tmodel: 'fancyParagraph',\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'p',\r\n *\t\t\t\tclasses: 'fancy'\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * \t\tdowncastElementToElement( {\r\n * \t\t\tmodel: 'heading',\r\n * \t\t\tview: ( modelElement, viewWriter ) => viewWriter.createContainerElement( 'h' + modelElement.getAttribute( 'level' ) )\r\n * \t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for `conversion.for()`} to learn how to add a converter\r\n * to the conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String} config.model The name of the model element to convert.\r\n * @param {module:engine/view/elementdefinition~ElementDefinition|Function} config.view A view element definition or a function\r\n * that takes the model element and {@link module:engine/view/downcastwriter~DowncastWriter view downcast writer}\r\n * as parameters and returns a view container element.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastElementToElement( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tconfig.view = _normalizeToElementConfig( config.view, 'container' );\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'insert:' + config.model, insertElement( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Model attribute to view element conversion helper.\r\n *\r\n * This conversion results in wrapping view nodes with a view attribute element. For example, a model text node with\r\n * `\"Foo\"` as data and the `bold` attribute becomes `<strong>Foo</strong>` in the view.\r\n *\r\n *\t\tdowncastAttributeToElement( { model: 'bold', view: 'strong' } );\r\n *\r\n *\t\tdowncastAttributeToElement( { model: 'bold', view: 'b', converterPriority: 'high' } );\r\n *\r\n *\t\tdowncastAttributeToElement( {\r\n *\t\t\tmodel: 'invert',\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tclasses: [ 'font-light', 'bg-dark' ]\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\tdowncastAttributeToElement( {\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'fontSize',\r\n *\t\t\t\tvalues: [ 'big', 'small' ]\r\n *\t\t\t},\r\n *\t\t\tview: {\r\n *\t\t\t\tbig: {\r\n *\t\t\t\t\tname: 'span',\r\n *\t\t\t\t\tstyles: {\r\n *\t\t\t\t\t\t'font-size': '1.2em'\r\n *\t\t\t\t\t}\r\n *\t\t\t\t},\r\n *\t\t\t\tsmall: {\r\n *\t\t\t\t\tname: 'span',\r\n *\t\t\t\t\tstyles: {\r\n *\t\t\t\t\t\t'font-size': '0.8em'\r\n *\t\t\t\t\t}\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * \t\tdowncastAttributeToElement( {\r\n * \t\t\tmodel: 'bold',\r\n * \t\t\tview: ( modelAttributeValue, viewWriter ) => {\r\n * \t\t\t\treturn viewWriter.createAttributeElement( 'span', { style: 'font-weight:' + modelAttributeValue } );\r\n * \t\t\t}\r\n * \t\t} );\r\n *\r\n *\t\tdowncastAttributeToElement( {\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'color',\r\n *\t\t\t\tname: '$text'\r\n *\t\t\t},\r\n *\t\t\tview: ( modelAttributeValue, viewWriter ) => {\r\n *\t\t\t\treturn viewWriter.createAttributeElement( 'span', { style: 'color:' + modelAttributeValue } );\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for `conversion.for()`} to learn how to add a converter\r\n * to the conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String|Object} config.model The key of the attribute to convert from or a `{ key, values }` object. `values` is an array\r\n * of `String`s with possible values if the model attribute is an enumerable.\r\n * @param {module:engine/view/elementdefinition~ElementDefinition|Function|Object} config.view A view element definition or a function\r\n * that takes the model attribute value and {@link module:engine/view/downcastwriter~DowncastWriter view downcast writer}\r\n * as parameters and returns a view attribute element. If `config.model.values` is\r\n * given, `config.view` should be an object assigning values from `config.model.values` to view element definitions or functions.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastAttributeToElement( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tconst modelKey = config.model.key ? config.model.key : config.model;\r\n\tlet eventName = 'attribute:' + modelKey;\r\n\r\n\tif ( config.model.name ) {\r\n\t\teventName += ':' + config.model.name;\r\n\t}\r\n\r\n\tif ( config.model.values ) {\r\n\t\tfor ( const modelValue of config.model.values ) {\r\n\t\t\tconfig.view[ modelValue ] = _normalizeToElementConfig( config.view[ modelValue ], 'attribute' );\r\n\t\t}\r\n\t} else {\r\n\t\tconfig.view = _normalizeToElementConfig( config.view, 'attribute' );\r\n\t}\r\n\r\n\tconst elementCreator = _getFromAttributeCreator( config );\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( eventName, wrap( elementCreator ), { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Model attribute to view attribute conversion helper.\r\n *\r\n * This conversion results in adding an attribute to a view node, basing on an attribute from a model node. For example,\r\n * `<image src='foo.jpg'></image>` is converted to `<img src='foo.jpg'></img>`.\r\n *\r\n *\t\tdowncastAttributeToAttribute( { model: 'source', view: 'src' } );\r\n *\r\n *\t\tdowncastAttributeToAttribute( { model: 'source', view: 'href', converterPriority: 'high' } );\r\n *\r\n *\t\tdowncastAttributeToAttribute( {\r\n *\t\t\tmodel: {\r\n *\t\t\t\tname: 'image',\r\n *\t\t\t\tkey: 'source'\r\n *\t\t\t},\r\n *\t\t\tview: 'src'\r\n *\t\t} );\r\n *\r\n *\t\tdowncastAttributeToAttribute( {\r\n *\t\t\tmodel: {\r\n *\t\t\t\tname: 'styled',\r\n *\t\t\t\tvalues: [ 'dark', 'light' ]\r\n *\t\t\t},\r\n *\t\t\tview: {\r\n *\t\t\t\tdark: {\r\n *\t\t\t\t\tkey: 'class',\r\n *\t\t\t\t\tvalue: [ 'styled', 'styled-dark' ]\r\n *\t\t\t\t},\r\n *\t\t\t\tlight: {\r\n *\t\t\t\t\tkey: 'class',\r\n *\t\t\t\t\tvalue: [ 'styled', 'styled-light' ]\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\tdowncastAttributeToAttribute( {\r\n *\t\t\tmodel: 'styled',\r\n *\t\t\tview: modelAttributeValue => ( { key: 'class', value: 'styled-' + modelAttributeValue } )\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for `conversion.for()`} to learn how to add a converter\r\n * to the conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String|Object} config.model The key of the attribute to convert from or a `{ key, values, [ name ] }` object describing\r\n * the attribute key, possible values and, optionally, an element name to convert from.\r\n * @param {String|Object|Function} config.view A view attribute key, or a `{ key, value }` object or a function that takes\r\n * the model attribute value and returns a `{ key, value }` object. If `key` is `'class'`, `value` can be a `String` or an\r\n * array of `String`s. If `key` is `'style'`, `value` is an object with key-value pairs. In other cases, `value` is a `String`.\r\n * If `config.model.values` is set, `config.view` should be an object assigning values from `config.model.values` to\r\n * `{ key, value }` objects or a functions.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastAttributeToAttribute( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tconst modelKey = config.model.key ? config.model.key : config.model;\r\n\tlet eventName = 'attribute:' + modelKey;\r\n\r\n\tif ( config.model.name ) {\r\n\t\teventName += ':' + config.model.name;\r\n\t}\r\n\r\n\tif ( config.model.values ) {\r\n\t\tfor ( const modelValue of config.model.values ) {\r\n\t\t\tconfig.view[ modelValue ] = _normalizeToAttributeConfig( config.view[ modelValue ] );\r\n\t\t}\r\n\t} else {\r\n\t\tconfig.view = _normalizeToAttributeConfig( config.view );\r\n\t}\r\n\r\n\tconst elementCreator = _getFromAttributeCreator( config );\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( eventName, changeAttribute( elementCreator ), { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Model marker to view element conversion helper.\r\n *\r\n * This conversion results in creating a view element on the boundaries of the converted marker. If the converted marker\r\n * is collapsed, only one element is created. For example, model marker set like this: `<paragraph>F[oo b]ar</paragraph>`\r\n * becomes `<p>F<span data-marker=\"search\"></span>oo b<span data-marker=\"search\"></span>ar</p>` in the view.\r\n *\r\n *\t\tdowncastMarkerToElement( { model: 'search', view: 'marker-search' } );\r\n *\r\n *\t\tdowncastMarkerToElement( { model: 'search', view: 'search-result', converterPriority: 'high' } );\r\n *\r\n *\t\tdowncastMarkerToElement( {\r\n *\t\t\tmodel: 'search',\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tattributes: {\r\n *\t\t\t\t\t'data-marker': 'search'\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * \t\tdowncastMarkerToElement( {\r\n * \t\t\tmodel: 'search',\r\n * \t\t\tview: ( markerData, viewWriter ) => {\r\n *\t \t\t\treturn viewWriter.createUIElement( 'span', { 'data-marker': 'search', 'data-start': markerData.isOpening } );\r\n * \t\t\t}\r\n * \t\t} );\r\n *\r\n * If a function is passed as the `config.view` parameter, it will be used to generate both boundary elements. The function\r\n * receives the `data` object as a parameter and should return an instance of the\r\n * {@link module:engine/view/uielement~UIElement view UI element}. The `data` and `conversionApi` objects are passed from\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:addMarker}. Additionally,\r\n * the `data.isOpening` parameter is passed, which is set to `true` for the marker start boundary element, and `false` to\r\n * the marker end boundary element.\r\n *\r\n * This kind of conversion is useful for saving data into the database, so it should be used in the data conversion pipeline.\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add a converter to the conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String} config.model The name of the model marker (or model marker group) to convert.\r\n * @param {module:engine/view/elementdefinition~ElementDefinition|Function} config.view A view element definition or a function\r\n * that takes the model marker data as a parameter and returns a view UI element.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastMarkerToElement( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tconfig.view = _normalizeToElementConfig( config.view, 'ui' );\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'addMarker:' + config.model, insertUIElement( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t\tdispatcher.on( 'removeMarker:' + config.model, removeUIElement( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Model marker to highlight conversion helper.\r\n *\r\n * This conversion results in creating a highlight on view nodes. For this kind of conversion,\r\n * {@link module:engine/conversion/downcast-converters~HighlightDescriptor} should be provided.\r\n *\r\n * For text nodes, a `<span>` {@link module:engine/view/attributeelement~AttributeElement} is created and it wraps all text nodes\r\n * in the converted marker range. For example, a model marker set like this: `<paragraph>F[oo b]ar</paragraph>` becomes\r\n * `<p>F<span class=\"comment\">oo b</span>ar</p>` in the view.\r\n *\r\n * {@link module:engine/view/containerelement~ContainerElement} may provide a custom way of handling highlight. Most often,\r\n * the element itself is given classes and attributes described in the highlight descriptor (instead of being wrapped in `<span>`).\r\n * For example, a model marker set like this: `[<image src=\"foo.jpg\"></image>]` becomes `<img src=\"foo.jpg\" class=\"comment\"></img>`\r\n * in the view.\r\n *\r\n * For container elements, the conversion is two-step. While the converter processes the highlight descriptor and passes it\r\n * to a container element, it is the container element instance itself that applies values from the highlight descriptor.\r\n * So, in a sense, the converter takes care of stating what should be applied on what, while the element decides how to apply that.\r\n *\r\n *\t\tdowncastMarkerToHighlight( { model: 'comment', view: { classes: 'comment' } } );\r\n *\r\n *\t\tdowncastMarkerToHighlight( { model: 'comment', view: { classes: 'new-comment' }, converterPriority: 'high' } );\r\n *\r\n * \t\tdowncastMarkerToHighlight( {\r\n * \t\t\tmodel: 'comment',\r\n * \t\t\tview: data => {\r\n * \t\t\t\t// Assuming that the marker name is in a form of comment:commentType.\r\n *\t \t\t\tconst commentType = data.markerName.split( ':' )[ 1 ];\r\n *\r\n *\t \t\t\treturn {\r\n *\t \t\t\t\tclasses: [ 'comment', 'comment-' + commentType ]\r\n *\t \t\t\t};\r\n * \t\t\t}\r\n * \t\t} );\r\n *\r\n * If a function is passed as the `config.view` parameter, it will be used to generate the highlight descriptor. The function\r\n * receives the `data` object as a parameter and should return a\r\n * {@link module:engine/conversion/downcast-converters~HighlightDescriptor highlight descriptor}.\r\n * The `data` object properties are passed from {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:addMarker}.\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add a converter to the conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String} config.model The name of the model marker (or model marker group) to convert.\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor|Function} config.view A highlight descriptor\r\n * that will be used for highlighting or a function that takes the model marker data as a parameter and returns a highlight descriptor.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastMarkerToHighlight( config ) {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'addMarker:' + config.model, highlightText( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t\tdispatcher.on( 'addMarker:' + config.model, highlightElement( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t\tdispatcher.on( 'removeMarker:' + config.model, removeHighlight( config.view ), { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n// Takes `config.view`, and if it is an {@link module:engine/view/elementdefinition~ElementDefinition}, converts it\r\n// to a function (because lower level converters accept only element creator functions).\r\n//\r\n// @param {module:engine/view/elementdefinition~ElementDefinition|Function} view View configuration.\r\n// @param {'container'|'attribute'|'ui'} viewElementType View element type to create.\r\n// @returns {Function} Element creator function to use in lower level converters.\r\nfunction _normalizeToElementConfig( view, viewElementType ) {\r\n\tif ( typeof view == 'function' ) {\r\n\t\t// If `view` is already a function, don't do anything.\r\n\t\treturn view;\r\n\t}\r\n\r\n\treturn ( modelData, viewWriter ) => _createViewElementFromDefinition( view, viewWriter, viewElementType );\r\n}\r\n\r\n// Creates a view element instance from the provided {@link module:engine/view/elementdefinition~ElementDefinition} and class.\r\n//\r\n// @param {module:engine/view/elementdefinition~ElementDefinition} viewElementDefinition\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\r\n// @param {'container'|'attribute'|'ui'} viewElementType\r\n// @returns {module:engine/view/element~Element}\r\nfunction _createViewElementFromDefinition( viewElementDefinition, viewWriter, viewElementType ) {\r\n\tif ( typeof viewElementDefinition == 'string' ) {\r\n\t\t// If `viewElementDefinition` is given as a `String`, normalize it to an object with `name` property.\r\n\t\tviewElementDefinition = { name: viewElementDefinition };\r\n\t}\r\n\r\n\tlet element;\r\n\tconst attributes = Object.assign( {}, viewElementDefinition.attributes );\r\n\r\n\tif ( viewElementType == 'container' ) {\r\n\t\telement = viewWriter.createContainerElement( viewElementDefinition.name, attributes );\r\n\t} else if ( viewElementType == 'attribute' ) {\r\n\t\tconst options = {\r\n\t\t\tpriority: viewElementDefinition.priority || ViewAttributeElement.DEFAULT_PRIORITY\r\n\t\t};\r\n\r\n\t\telement = viewWriter.createAttributeElement( viewElementDefinition.name, attributes, options );\r\n\t} else {\r\n\t\t// 'ui'.\r\n\t\telement = viewWriter.createUIElement( viewElementDefinition.name, attributes );\r\n\t}\r\n\r\n\tif ( viewElementDefinition.styles ) {\r\n\t\tconst keys = Object.keys( viewElementDefinition.styles );\r\n\r\n\t\tfor ( const key of keys ) {\r\n\t\t\tviewWriter.setStyle( key, viewElementDefinition.styles[ key ], element );\r\n\t\t}\r\n\t}\r\n\r\n\tif ( viewElementDefinition.classes ) {\r\n\t\tconst classes = viewElementDefinition.classes;\r\n\r\n\t\tif ( typeof classes == 'string' ) {\r\n\t\t\tviewWriter.addClass( classes, element );\r\n\t\t} else {\r\n\t\t\tfor ( const className of classes ) {\r\n\t\t\t\tviewWriter.addClass( className, element );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn element;\r\n}\r\n\r\nfunction _getFromAttributeCreator( config ) {\r\n\tif ( config.model.values ) {\r\n\t\treturn ( modelAttributeValue, viewWriter ) => {\r\n\t\t\tconst view = config.view[ modelAttributeValue ];\r\n\r\n\t\t\tif ( view ) {\r\n\t\t\t\treturn view( modelAttributeValue, viewWriter );\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t};\r\n\t} else {\r\n\t\treturn config.view;\r\n\t}\r\n}\r\n\r\n// Takes the configuration, adds default parameters if they do not exist and normalizes other parameters to be used in downcast converters\r\n// for generating a view attribute.\r\n//\r\n// @param {Object} view View configuration.\r\nfunction _normalizeToAttributeConfig( view ) {\r\n\tif ( typeof view == 'string' ) {\r\n\t\treturn modelAttributeValue => ( { key: view, value: modelAttributeValue } );\r\n\t} else if ( typeof view == 'object' ) {\r\n\t\t// { key, value, ... }\r\n\t\tif ( view.value ) {\r\n\t\t\treturn () => view;\r\n\t\t}\r\n\t\t// { key, ... }\r\n\t\telse {\r\n\t\t\treturn modelAttributeValue => ( { key: view.key, value: modelAttributeValue } );\r\n\t\t}\r\n\t} else {\r\n\t\t// function.\r\n\t\treturn view;\r\n\t}\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts node insertion changes from the model to the view.\r\n * The function passed will be provided with all the parameters of the dispatcher's\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:insert `insert` event}.\r\n * It is expected that the function returns an {@link module:engine/view/element~Element}.\r\n * The result of the function will be inserted into the view.\r\n *\r\n * The converter automatically consumes the corresponding value from the consumables list, stops the event (see\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}) and binds the model and view elements.\r\n *\r\n *\t\tdowncastDispatcher.on(\r\n *\t\t\t'insert:myElem',\r\n *\t\t\tinsertElement( ( modelItem, viewWriter ) => {\r\n *\t\t\t\tconst text = viewWriter.createText( 'myText' );\r\n *\t\t\t\tconst myElem = viewWriter.createElement( 'myElem', { myAttr: 'my-' + modelItem.getAttribute( 'myAttr' ) }, text );\r\n *\r\n *\t\t\t\t// Do something fancy with `myElem` using `modelItem` or other parameters.\r\n *\r\n *\t\t\t\treturn myElem;\r\n *\t\t\t}\r\n *\t\t) );\r\n *\r\n * @param {Function} elementCreator Function returning a view element, which will be inserted.\r\n * @returns {Function} Insert element event converter.\r\n */\r\nexport function insertElement( elementCreator ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst viewElement = elementCreator( data.item, conversionApi.writer );\r\n\r\n\t\tif ( !viewElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, 'insert' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n\r\n\t\tconversionApi.mapper.bindElements( data.item, viewElement );\r\n\t\tconversionApi.writer.insert( viewPosition, viewElement );\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a default downcast converter for text insertion changes.\r\n *\r\n * The converter automatically consumes the corresponding value from the consumables list and stops the event (see\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}).\r\n *\r\n *\t\tmodelDispatcher.on( 'insert:$text', insertText() );\r\n *\r\n * @returns {Function} Insert text event converter.\r\n */\r\nexport function insertText() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, 'insert' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst viewPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n\t\tconst viewText = viewWriter.createText( data.item.data );\r\n\r\n\t\tviewWriter.insert( viewPosition, viewText );\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a default downcast converter for node remove changes.\r\n *\r\n *\t\tmodelDispatcher.on( 'remove', remove() );\r\n *\r\n * @returns {Function} Remove event converter.\r\n */\r\nexport function remove() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// Find view range start position by mapping model position at which the remove happened.\r\n\t\tconst viewStart = conversionApi.mapper.toViewPosition( data.position );\r\n\r\n\t\tconst modelEnd = data.position.getShiftedBy( data.length );\r\n\t\tconst viewEnd = conversionApi.mapper.toViewPosition( modelEnd, { isPhantom: true } );\r\n\r\n\t\tconst viewRange = conversionApi.writer.createRange( viewStart, viewEnd );\r\n\r\n\t\t// Trim the range to remove in case some UI elements are on the view range boundaries.\r\n\t\tconst removed = conversionApi.writer.remove( viewRange.getTrimmed() );\r\n\r\n\t\t// After the range is removed, unbind all view elements from the model.\r\n\t\t// Range inside view document fragment is used to unbind deeply.\r\n\t\tfor ( const child of conversionApi.writer.createRangeIn( removed ).getItems() ) {\r\n\t\t\tconversionApi.mapper.unbindViewElement( child );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts marker adding change to the\r\n * {@link module:engine/view/uielement~UIElement view UI element}.\r\n *\r\n * The view UI element that will be added to the view depends on the passed parameter. See {@link ~insertElement}.\r\n * In case of a non-collapsed range, the UI element will not wrap nodes but separate elements will be placed at the beginning\r\n * and at the end of the range.\r\n *\r\n * This converter binds created UI elements with the marker name using {@link module:engine/conversion/mapper~Mapper#bindElementToMarker}.\r\n *\r\n * @param {module:engine/view/uielement~UIElement|Function} elementCreator A view UI element or a function returning the view element\r\n * that will be inserted.\r\n * @returns {Function} Insert element event converter.\r\n */\r\nexport function insertUIElement( elementCreator ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// Create two view elements. One will be inserted at the beginning of marker, one at the end.\r\n\t\t// If marker is collapsed, only \"opening\" element will be inserted.\r\n\t\tdata.isOpening = true;\r\n\t\tconst viewStartElement = elementCreator( data, conversionApi.writer );\r\n\r\n\t\tdata.isOpening = false;\r\n\t\tconst viewEndElement = elementCreator( data, conversionApi.writer );\r\n\r\n\t\tif ( !viewStartElement || !viewEndElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst markerRange = data.markerRange;\r\n\r\n\t\t// Marker that is collapsed has consumable build differently that non-collapsed one.\r\n\t\t// For more information see `addMarker` event description.\r\n\t\t// If marker's range is collapsed - check if it can be consumed.\r\n\t\tif ( markerRange.isCollapsed && !conversionApi.consumable.consume( markerRange, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If marker's range is not collapsed - consume all items inside.\r\n\t\tfor ( const value of markerRange ) {\r\n\t\t\tif ( !conversionApi.consumable.consume( value.item, evt.name ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst mapper = conversionApi.mapper;\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\t// Add \"opening\" element.\r\n\t\tviewWriter.insert( mapper.toViewPosition( markerRange.start ), viewStartElement );\r\n\t\tconversionApi.mapper.bindElementToMarker( viewStartElement, data.markerName );\r\n\r\n\t\t// Add \"closing\" element only if range is not collapsed.\r\n\t\tif ( !markerRange.isCollapsed ) {\r\n\t\t\tviewWriter.insert( mapper.toViewPosition( markerRange.end ), viewEndElement );\r\n\t\t\tconversionApi.mapper.bindElementToMarker( viewEndElement, data.markerName );\r\n\t\t}\r\n\r\n\t\tevt.stop();\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that returns a default downcast converter for removing a {@link module:engine/view/uielement~UIElement UI element}\r\n * basing on marker remove change.\r\n *\r\n * This converter unbinds elements from the marker name.\r\n *\r\n * @returns {Function} Removed UI element converter.\r\n */\r\nexport function removeUIElement() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst elements = conversionApi.mapper.markerNameToElements( data.markerName );\r\n\r\n\t\tif ( !elements ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconversionApi.mapper.unbindElementsFromMarkerName( data.markerName );\r\n\r\n\t\tfor ( const element of elements ) {\r\n\t\t\tconversionApi.writer.clear( conversionApi.writer.createRangeOn( element ), element );\r\n\t\t}\r\n\r\n\t\tconversionApi.writer.clearClonedElementsGroup( data.markerName );\r\n\r\n\t\tevt.stop();\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts set/change/remove attribute changes from the model to the view.\r\n *\r\n * Attributes from the model are converted to the view element attributes in the view. You may provide a custom function to generate\r\n * a key-value attribute pair to add/change/remove. If not provided, model attributes will be converted to view element\r\n * attributes on a one-to-one basis.\r\n *\r\n * **Note:** The provided attribute creator should always return the same `key` for a given attribute from the model.\r\n *\r\n * The converter automatically consumes the corresponding value from the consumables list and stops the event (see\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}).\r\n *\r\n *\t\tmodelDispatcher.on( 'attribute:customAttr:myElem', changeAttribute( ( value, data ) => {\r\n *\t\t\t// Change attribute key from `customAttr` to `class` in the view.\r\n *\t\t\tconst key = 'class';\r\n *\t\t\tlet value = data.attributeNewValue;\r\n *\r\n *\t\t\t// Force attribute value to 'empty' if the model element is empty.\r\n *\t\t\tif ( data.item.childCount === 0 ) {\r\n *\t\t\t\tvalue = 'empty';\r\n *\t\t\t}\r\n *\r\n *\t\t\t// Return the key-value pair.\r\n *\t\t\treturn { key, value };\r\n *\t\t} ) );\r\n *\r\n * @param {Function} [attributeCreator] Function returning an object with two properties: `key` and `value`, which\r\n * represent the attribute key and attribute value to be set on a {@link module:engine/view/element~Element view element}.\r\n * The function is passed the model attribute value as the first parameter and additional data about the change as the second parameter.\r\n * @returns {Function} Set/change attribute converter.\r\n */\r\nexport function changeAttribute( attributeCreator ) {\r\n\tattributeCreator = attributeCreator || ( ( value, data ) => ( { value, key: data.attributeKey } ) );\r\n\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst oldAttribute = attributeCreator( data.attributeOldValue, data );\r\n\t\tconst newAttribute = attributeCreator( data.attributeNewValue, data );\r\n\r\n\t\tif ( !oldAttribute && !newAttribute ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item );\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\t// If model item cannot be mapped to a view element, it means item is not an `Element` instance but a `TextProxy` node.\r\n\t\t// Only elements can have attributes in a view so do not proceed for anything else (#1587).\r\n\t\tif ( !viewElement ) {\r\n\t\t\t/**\r\n\t\t\t * This error occurs when a {@link module:engine/model/textproxy~TextProxy text node's} attribute is to be downcasted\r\n\t\t\t * by {@link module:engine/conversion/conversion~Conversion#attributeToAttribute `Attribute to Attribute converter`}.\r\n\t\t\t * In most cases it is caused by converters misconfiguration when only \"generic\" converter is defined:\r\n\t\t\t *\r\n\t\t\t *\t\teditor.conversion.for( 'downcast' ).add( downcastAttributeToAttribute( {\r\n\t\t\t *\t\t\tmodel: 'attribute-name',\r\n\t\t\t *\t\t\tview: 'attribute-name'\r\n\t\t\t *\t\t} ) );\r\n\t\t\t *\r\n\t\t\t * and given attribute is used on text node, for example:\r\n\t\t\t *\r\n\t\t\t *\t\tmodel.change( writer => {\r\n\t\t\t *\t\t\twriter.insertText( 'Foo', { 'attribute-name': 'bar' }, parent, 0 );\r\n\t\t\t *\t\t} );\r\n\t\t\t *\r\n\t\t\t * In such cases, to convert the same attribute for both {@link module:engine/model/element~Element}\r\n\t\t\t * and {@link module:engine/model/textproxy~TextProxy `Text`} nodes, text specific\r\n\t\t\t * {@link module:engine/conversion/conversion~Conversion#attributeToElement `Attribute to Element converter`}\r\n\t\t\t * with higher {@link module:utils/priorities~PriorityString priority} must also be defined:\r\n\t\t\t *\r\n\t\t\t *\t\tconversion.for( 'downcast' ).add( downcastAttributeToElement( {\r\n\t\t\t *\t\t\tmodel: {\r\n\t\t\t *\t\t\t\tkey: 'attribute-name',\r\n\t\t\t *\t\t\t\tname: '$text'\r\n\t\t\t *\t\t\t},\r\n\t\t\t *\t\t\tview: ( value, writer ) => {\r\n\t\t\t *\t\t\t\treturn writer.createAttributeElement( 'span', { 'attribute-name': value } );\r\n\t\t\t *\t\t\t},\r\n\t\t\t *\t\t\tconverterPriority: 'high'\r\n\t\t\t *\t\t} ) );\r\n\t\t\t *\r\n\t\t\t * @error conversion-attribute-to-attribute-on-text\r\n\t\t\t */\r\n\t\t\tlog.warn( 'conversion-attribute-to-attribute-on-text: ' +\r\n\t\t\t\t'Trying to convert text node\\'s attribute with attribute-to-attribute converter.' );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// First remove the old attribute if there was one.\r\n\t\tif ( data.attributeOldValue !== null && oldAttribute ) {\r\n\t\t\tif ( oldAttribute.key == 'class' ) {\r\n\t\t\t\tconst classes = Array.isArray( oldAttribute.value ) ? oldAttribute.value : [ oldAttribute.value ];\r\n\r\n\t\t\t\tfor ( const className of classes ) {\r\n\t\t\t\t\tviewWriter.removeClass( className, viewElement );\r\n\t\t\t\t}\r\n\t\t\t} else if ( oldAttribute.key == 'style' ) {\r\n\t\t\t\tconst keys = Object.keys( oldAttribute.value );\r\n\r\n\t\t\t\tfor ( const key of keys ) {\r\n\t\t\t\t\tviewWriter.removeStyle( key, viewElement );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tviewWriter.removeAttribute( oldAttribute.key, viewElement );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Then set the new attribute.\r\n\t\tif ( data.attributeNewValue !== null && newAttribute ) {\r\n\t\t\tif ( newAttribute.key == 'class' ) {\r\n\t\t\t\tconst classes = Array.isArray( newAttribute.value ) ? newAttribute.value : [ newAttribute.value ];\r\n\r\n\t\t\t\tfor ( const className of classes ) {\r\n\t\t\t\t\tviewWriter.addClass( className, viewElement );\r\n\t\t\t\t}\r\n\t\t\t} else if ( newAttribute.key == 'style' ) {\r\n\t\t\t\tconst keys = Object.keys( newAttribute.value );\r\n\r\n\t\t\t\tfor ( const key of keys ) {\r\n\t\t\t\t\tviewWriter.setStyle( key, newAttribute.value[ key ], viewElement );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tviewWriter.setAttribute( newAttribute.key, newAttribute.value, viewElement );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts set/change/remove attribute changes from the model to the view.\r\n * It can also be used to convert selection attributes. In that case, an empty attribute element will be created and the\r\n * selection will be put inside it.\r\n *\r\n * Attributes from the model are converted to a view element that will be wrapping these view nodes that are bound to\r\n * model elements having the given attribute. This is useful for attributes like `bold` that may be set on text nodes in the model\r\n * but are represented as an element in the view:\r\n *\r\n *\t\t[paragraph]              MODEL ====> VIEW        <p>\r\n *\t\t\t|- a {bold: true}                             |- <b>\r\n *\t\t\t|- b {bold: true}                             |   |- ab\r\n *\t\t\t|- c                                          |- c\r\n *\r\n * Passed `Function` will be provided with the attribute value and then all the parameters of the\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute `attribute` event}.\r\n * It is expected that the function returns an {@link module:engine/view/element~Element}.\r\n * The result of the function will be the wrapping element.\r\n * When the provided `Function` does not return any element, no conversion will take place.\r\n *\r\n * The converter automatically consumes the corresponding value from the consumables list and stops the event (see\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher}).\r\n *\r\n *\t\tmodelDispatcher.on( 'attribute:bold', wrapItem( ( modelAttributeValue, viewWriter ) => {\r\n *\t\t\treturn viewWriter.createAttributeElement( 'strong' );\r\n *\t\t} );\r\n *\r\n * @param {Function} elementCreator Function returning a view element that will be used for wrapping.\r\n * @returns {Function} Set/change attribute converter.\r\n */\r\nexport function wrap( elementCreator ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// Recreate current wrapping node. It will be used to unwrap view range if the attribute value has changed\r\n\t\t// or the attribute was removed.\r\n\t\tconst oldViewElement = elementCreator( data.attributeOldValue, conversionApi.writer );\r\n\r\n\t\t// Create node to wrap with.\r\n\t\tconst newViewElement = elementCreator( data.attributeNewValue, conversionApi.writer );\r\n\r\n\t\tif ( !oldViewElement && !newViewElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst viewSelection = viewWriter.document.selection;\r\n\r\n\t\tif ( data.item instanceof ModelSelection || data.item instanceof DocumentSelection ) {\r\n\t\t\t// Selection attribute conversion.\r\n\t\t\tviewWriter.wrap( viewSelection.getFirstRange(), newViewElement );\r\n\t\t} else {\r\n\t\t\t// Node attribute conversion.\r\n\t\t\tlet viewRange = conversionApi.mapper.toViewRange( data.range );\r\n\r\n\t\t\t// First, unwrap the range from current wrapper.\r\n\t\t\tif ( data.attributeOldValue !== null && oldViewElement ) {\r\n\t\t\t\tviewRange = viewWriter.unwrap( viewRange, oldViewElement );\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.attributeNewValue !== null && newViewElement ) {\r\n\t\t\t\tviewWriter.wrap( viewRange, newViewElement );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts the text inside marker's range. The converter wraps the text with\r\n * {@link module:engine/view/attributeelement~AttributeElement} created from the provided descriptor.\r\n * See {link module:engine/conversion/downcast-converters~createViewElementFromHighlightDescriptor}.\r\n *\r\n * It can also be used to convert the selection that is inside a marker. In that case, an empty attribute element will be\r\n * created and the selection will be put inside it.\r\n *\r\n * If the highlight descriptor does not provide the `priority` property, `10` will be used.\r\n *\r\n * If the highlight descriptor does not provide the `id` property, the name of the marker will be used.\r\n *\r\n * This converter binds the created {@link module:engine/view/attributeelement~AttributeElement attribute elemens} with the marker name\r\n * using the {@link module:engine/conversion/mapper~Mapper#bindElementToMarker} method.\r\n *\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor|Function} highlightDescriptor\r\n * @returns {Function}\r\n */\r\nexport function highlightText( highlightDescriptor ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( data.markerRange.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !( data.item instanceof ModelSelection || data.item instanceof DocumentSelection ) && !data.item.is( 'textProxy' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst descriptor = _prepareDescriptor( highlightDescriptor, data, conversionApi );\r\n\r\n\t\tif ( !descriptor ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewElement = createViewElementFromHighlightDescriptor( descriptor );\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst viewSelection = viewWriter.document.selection;\r\n\r\n\t\tif ( data.item instanceof ModelSelection || data.item instanceof DocumentSelection ) {\r\n\t\t\tviewWriter.wrap( viewSelection.getFirstRange(), viewElement, viewSelection );\r\n\t\t} else {\r\n\t\t\tconst viewRange = conversionApi.mapper.toViewRange( data.range );\r\n\t\t\tconst rangeAfterWrap = viewWriter.wrap( viewRange, viewElement );\r\n\r\n\t\t\tfor ( const element of rangeAfterWrap.getItems() ) {\r\n\t\t\t\tif ( element.is( 'attributeElement' ) && element.isSimilar( viewElement ) ) {\r\n\t\t\t\t\tconversionApi.mapper.bindElementToMarker( element, data.markerName );\r\n\r\n\t\t\t\t\t// One attribute element is enough, because all of them are bound together by the view writer.\r\n\t\t\t\t\t// Mapper uses this binding to get all the elements no matter how many of them are registered in the mapper.\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Converter function factory. It creates a function which applies the marker's highlight to an element inside the marker's range.\r\n *\r\n * The converter checks if an element has the `addHighlight` function stored as a\r\n * {@link module:engine/view/element~Element#_setCustomProperty custom property} and, if so, uses it to apply the highlight.\r\n * In such case the converter will consume all element's children, assuming that they were handled by the element itself.\r\n *\r\n * When the `addHighlight` custom property is not present, the element is not converted in any special way.\r\n * This means that converters will proceed to convert the element's child nodes.\r\n *\r\n * If the highlight descriptor does not provide the `priority` property, `10` will be used.\r\n *\r\n * If the highlight descriptor does not provide the `id` property, the name of the marker will be used.\r\n *\r\n * This converter binds altered {@link module:engine/view/containerelement~ContainerElement container elements} with the marker name using\r\n * the {@link module:engine/conversion/mapper~Mapper#bindElementToMarker} method.\r\n *\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor|Function} highlightDescriptor\r\n * @returns {Function}\r\n */\r\nexport function highlightElement( highlightDescriptor ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( data.markerRange.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !( data.item instanceof ModelElement ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst descriptor = _prepareDescriptor( highlightDescriptor, data, conversionApi );\r\n\r\n\t\tif ( !descriptor ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.test( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item );\r\n\r\n\t\tif ( viewElement && viewElement.getCustomProperty( 'addHighlight' ) ) {\r\n\t\t\t// Consume element itself.\r\n\t\t\tconversionApi.consumable.consume( data.item, evt.name );\r\n\r\n\t\t\t// Consume all children nodes.\r\n\t\t\tfor ( const value of ModelRange._createIn( data.item ) ) {\r\n\t\t\t\tconversionApi.consumable.consume( value.item, evt.name );\r\n\t\t\t}\r\n\r\n\t\t\tviewElement.getCustomProperty( 'addHighlight' )( viewElement, descriptor, conversionApi.writer );\r\n\r\n\t\t\tconversionApi.mapper.bindElementToMarker( viewElement, data.markerName );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts the removing model marker to the view.\r\n *\r\n * Both text nodes and elements are handled by this converter but they are handled a bit differently.\r\n *\r\n * Text nodes are unwrapped using the {@link module:engine/view/attributeelement~AttributeElement attribute element} created from the\r\n * provided highlight descriptor. See {link module:engine/conversion/downcast-converters~HighlightDescriptor}.\r\n *\r\n * For elements, the converter checks if an element has the `removeHighlight` function stored as a\r\n * {@link module:engine/view/element~Element#_setCustomProperty custom property}. If so, it uses it to remove the highlight.\r\n * In such case, the children of that element will not be converted.\r\n *\r\n * When `removeHighlight` is not present, the element is not converted in any special way.\r\n * The converter will proceed to convert the element's child nodes instead.\r\n *\r\n * If the highlight descriptor does not provide the `priority` property, `10` will be used.\r\n *\r\n * If the highlight descriptor does not provide the `id` property, the name of the marker will be used.\r\n *\r\n * This converter unbinds elements from the marker name.\r\n *\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor|Function} highlightDescriptor\r\n * @returns {Function}\r\n */\r\nexport function removeHighlight( highlightDescriptor ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// This conversion makes sense only for non-collapsed range.\r\n\t\tif ( data.markerRange.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst descriptor = _prepareDescriptor( highlightDescriptor, data, conversionApi );\r\n\r\n\t\tif ( !descriptor ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// View element that will be used to unwrap `AttributeElement`s.\r\n\t\tconst viewHighlightElement = createViewElementFromHighlightDescriptor( descriptor );\r\n\r\n\t\t// Get all elements bound with given marker name.\r\n\t\tconst elements = conversionApi.mapper.markerNameToElements( data.markerName );\r\n\r\n\t\tif ( !elements ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconversionApi.mapper.unbindElementsFromMarkerName( data.markerName );\r\n\r\n\t\tfor ( const element of elements ) {\r\n\t\t\tif ( element.is( 'attributeElement' ) ) {\r\n\t\t\t\tconversionApi.writer.unwrap( conversionApi.writer.createRangeOn( element ), viewHighlightElement );\r\n\t\t\t} else {\r\n\t\t\t\t// if element.is( 'containerElement' ).\r\n\t\t\t\telement.getCustomProperty( 'removeHighlight' )( element, descriptor.id, conversionApi.writer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconversionApi.writer.clearClonedElementsGroup( data.markerName );\r\n\r\n\t\tevt.stop();\r\n\t};\r\n}\r\n\r\n// Helper function for `highlight`. Prepares the actual descriptor object using value passed to the converter.\r\nfunction _prepareDescriptor( highlightDescriptor, data, conversionApi ) {\r\n\t// If passed descriptor is a creator function, call it. If not, just use passed value.\r\n\tconst descriptor = typeof highlightDescriptor == 'function' ?\r\n\t\thighlightDescriptor( data, conversionApi ) :\r\n\t\thighlightDescriptor;\r\n\r\n\tif ( !descriptor ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Apply default descriptor priority.\r\n\tif ( !descriptor.priority ) {\r\n\t\tdescriptor.priority = 10;\r\n\t}\r\n\r\n\t// Default descriptor id is marker name.\r\n\tif ( !descriptor.id ) {\r\n\t\tdescriptor.id = data.markerName;\r\n\t}\r\n\r\n\treturn descriptor;\r\n}\r\n\r\n/**\r\n * Creates a `<span>` {@link module:engine/view/attributeelement~AttributeElement view attribute element} from the information\r\n * provided by the {@link module:engine/conversion/downcast-converters~HighlightDescriptor highlight descriptor} object. If a priority\r\n * is not provided in the descriptor, the default priority will be used.\r\n *\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor} descriptor\r\n * @returns {module:engine/view/attributeelement~AttributeElement}\r\n */\r\nexport function createViewElementFromHighlightDescriptor( descriptor ) {\r\n\tconst viewElement = new ViewAttributeElement( 'span', descriptor.attributes );\r\n\r\n\tif ( descriptor.classes ) {\r\n\t\tviewElement._addClass( descriptor.classes );\r\n\t}\r\n\r\n\tif ( descriptor.priority ) {\r\n\t\tviewElement._priority = descriptor.priority;\r\n\t}\r\n\r\n\tviewElement._id = descriptor.id;\r\n\r\n\treturn viewElement;\r\n}\r\n\r\n/**\r\n * An object describing how the marker highlight should be represented in the view.\r\n *\r\n * Each text node contained in a highlighted range will be wrapped in a `<span>`\r\n * {@link module:engine/view/attributeelement~AttributeElement view attribute element} with CSS class(es), attributes and a priority\r\n * described by this object.\r\n *\r\n * Additionally, each {@link module:engine/view/containerelement~ContainerElement container element} can handle displaying the highlight\r\n * separately by providing the `addHighlight` and `removeHighlight` custom properties. In this case:\r\n *\r\n *  * The `HighlightDescriptor` object is passed to the `addHighlight` function upon conversion and should be used to apply the highlight to\r\n *  the element.\r\n *  * The descriptor `id` is passed to the `removeHighlight` function upon conversion and should be used to remove the highlight with the\r\n *  given ID from the element.\r\n *\r\n * @typedef {Object} module:engine/conversion/downcast-converters~HighlightDescriptor\r\n *\r\n * @property {String|Array.<String>} classes A CSS class or an array of classes to set. If the descriptor is used to\r\n * create an {@link module:engine/view/attributeelement~AttributeElement attribute element} over text nodes, these classes will be set\r\n * on that attribute element. If the descriptor is applied to an element, usually these classes will be set on that element, however,\r\n * this depends on how the element converts the descriptor.\r\n *\r\n * @property {String} [id] Descriptor identifier. If not provided, it defaults to the converted marker's name.\r\n *\r\n * @property {Number} [priority] Descriptor priority. If not provided, it defaults to `10`. If the descriptor is used to create\r\n * an {@link module:engine/view/attributeelement~AttributeElement attribute element}, it will be that element's\r\n * {@link module:engine/view/attributeelement~AttributeElement#priority priority}. If the descriptor is applied to an element,\r\n * the priority will be used to determine which descriptor is more important.\r\n *\r\n * @property {Object} [attributes] Attributes to set. If the descriptor is used to create\r\n * an {@link module:engine/view/attributeelement~AttributeElement attribute element} over text nodes, these attributes will be set on that\r\n * attribute element. If the descriptor is applied to an element, usually these attributes will be set on that element, however,\r\n * this depends on how the element converts the descriptor.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/controller/editingcontroller\r\n */\r\n\r\nimport RootEditableElement from '../view/rooteditableelement';\r\nimport View from '../view/view';\r\nimport Mapper from '../conversion/mapper';\r\nimport DowncastDispatcher from '../conversion/downcastdispatcher';\r\nimport { insertText, remove } from '../conversion/downcast-converters';\r\nimport { convertSelectionChange } from '../conversion/upcast-selection-converters';\r\nimport { clearAttributes, convertCollapsedSelection, convertRangeSelection } from '../conversion/downcast-selection-converters';\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Controller for the editing pipeline. The editing pipeline controls {@link ~EditingController#model model} rendering,\r\n * including selection handling. It also creates the {@link ~EditingController#view view} which builds a\r\n * browser-independent virtualization over the DOM elements. The editing controller also attaches default converters.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class EditingController {\r\n\t/**\r\n\t * Creates an editing controller instance.\r\n\t *\r\n\t * @param {module:engine/model/model~Model} model Editing model.\r\n\t */\r\n\tconstructor( model ) {\r\n\t\t/**\r\n\t\t * Editor model.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model}\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * Editing view controller.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/view/view~View}\r\n\t\t */\r\n\t\tthis.view = new View();\r\n\r\n\t\t/**\r\n\t\t * Mapper which describes the model-view binding.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/mapper~Mapper}\r\n\t\t */\r\n\t\tthis.mapper = new Mapper();\r\n\r\n\t\t/**\r\n\t\t * Downcast dispatcher that converts changes from the model to {@link #view the editing view}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/downcastdispatcher~DowncastDispatcher} #downcastDispatcher\r\n\t\t */\r\n\t\tthis.downcastDispatcher = new DowncastDispatcher( {\r\n\t\t\tmapper: this.mapper\r\n\t\t} );\r\n\r\n\t\tconst doc = this.model.document;\r\n\t\tconst selection = doc.selection;\r\n\t\tconst markers = this.model.markers;\r\n\r\n\t\t// When plugins listen on model changes (on selection change, post fixers, etc) and change the view as a result of\r\n\t\t// model's change, they might trigger view rendering before the conversion is completed (e.g. before the selection\r\n\t\t// is converted). We disable rendering for the length of the outermost model change() block to prevent that.\r\n\t\t//\r\n\t\t// See  https://github.com/ckeditor/ckeditor5-engine/issues/1528\r\n\t\tthis.listenTo( this.model, '_beforeChanges', () => {\r\n\t\t\tthis.view._renderingDisabled = true;\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\tthis.listenTo( this.model, '_afterChanges', () => {\r\n\t\t\tthis.view._renderingDisabled = false;\r\n\t\t\tthis.view.render();\r\n\t\t}, { priority: 'lowest' } );\r\n\r\n\t\t// Whenever model document is changed, convert those changes to the view (using model.Document#differ).\r\n\t\t// Do it on 'low' priority, so changes are converted after other listeners did their job.\r\n\t\t// Also convert model selection.\r\n\t\tthis.listenTo( doc, 'change', () => {\r\n\t\t\tthis.view.change( writer => {\r\n\t\t\t\tthis.downcastDispatcher.convertChanges( doc.differ, writer );\r\n\t\t\t\tthis.downcastDispatcher.convertSelection( selection, markers, writer );\r\n\t\t\t} );\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// Convert selection from the view to the model when it changes in the view.\r\n\t\tthis.listenTo( this.view.document, 'selectionChange', convertSelectionChange( this.model, this.mapper ) );\r\n\r\n\t\t// Attach default model converters.\r\n\t\tthis.downcastDispatcher.on( 'insert:$text', insertText(), { priority: 'lowest' } );\r\n\t\tthis.downcastDispatcher.on( 'remove', remove(), { priority: 'low' } );\r\n\r\n\t\t// Attach default model selection converters.\r\n\t\tthis.downcastDispatcher.on( 'selection', clearAttributes(), { priority: 'low' } );\r\n\t\tthis.downcastDispatcher.on( 'selection', convertRangeSelection(), { priority: 'low' } );\r\n\t\tthis.downcastDispatcher.on( 'selection', convertCollapsedSelection(), { priority: 'low' } );\r\n\r\n\t\t// Binds {@link module:engine/view/document~Document#roots view roots collection} to\r\n\t\t// {@link module:engine/model/document~Document#roots model roots collection} so creating\r\n\t\t// model root automatically creates corresponding view root.\r\n\t\tthis.view.document.roots.bindTo( this.model.document.roots ).using( root => {\r\n\t\t\t// $graveyard is a special root that has no reflection in the view.\r\n\t\t\tif ( root.rootName == '$graveyard' ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst viewRoot = new RootEditableElement( root.name );\r\n\r\n\t\t\tviewRoot.rootName = root.rootName;\r\n\t\t\tviewRoot._document = this.view.document;\r\n\t\t\tthis.mapper.bindElements( root, viewRoot );\r\n\r\n\t\t\treturn viewRoot;\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all event listeners attached to the `EditingController`. Destroys all objects created\r\n\t * by `EditingController` that need to be destroyed.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.view.destroy();\r\n\t\tthis.stopListening();\r\n\t}\r\n}\r\n\r\nmix( EditingController, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * Contains {@link module:engine/view/documentselection~DocumentSelection view selection}\r\n * to {@link module:engine/model/selection~Selection model selection} conversion helpers.\r\n *\r\n * @module engine/conversion/upcast-selection-converters\r\n */\r\n\r\nimport ModelSelection from '../model/selection';\r\n\r\n/**\r\n * Function factory, creates a callback function which converts a {@link module:engine/view/selection~Selection\r\n * view selection} taken from the {@link module:engine/view/document~Document#event:selectionChange} event\r\n * and sets in on the {@link module:engine/model/document~Document#selection model}.\r\n *\r\n * **Note**: because there is no view selection change dispatcher nor any other advanced view selection to model\r\n * conversion mechanism, the callback should be set directly on view document.\r\n *\r\n *\t\tview.document.on( 'selectionChange', convertSelectionChange( modelDocument, mapper ) );\r\n *\r\n * @param {module:engine/model/model~Model} model Data model.\r\n * @param {module:engine/conversion/mapper~Mapper} mapper Conversion mapper.\r\n * @returns {Function} {@link module:engine/view/document~Document#event:selectionChange} callback function.\r\n */\r\nexport function convertSelectionChange( model, mapper ) {\r\n\treturn ( evt, data ) => {\r\n\t\tconst viewSelection = data.newSelection;\r\n\t\tconst modelSelection = new ModelSelection();\r\n\r\n\t\tconst ranges = [];\r\n\r\n\t\tfor ( const viewRange of viewSelection.getRanges() ) {\r\n\t\t\tranges.push( mapper.toModelRange( viewRange ) );\r\n\t\t}\r\n\r\n\t\tmodelSelection.setTo( ranges, { backward: viewSelection.isBackward } );\r\n\r\n\t\tif ( !modelSelection.isEqual( model.document.selection ) ) {\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\twriter.setSelection( modelSelection );\r\n\t\t\t} );\r\n\t\t}\r\n\t};\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * Contains {@link module:engine/model/selection~Selection model selection} to\r\n * {@link module:engine/view/documentselection~DocumentSelection view selection} converters for\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher downcast dispatcher}.\r\n *\r\n * @module engine/conversion/downcast-selection-converters\r\n */\r\n\r\n/**\r\n * Function factory that creates a converter which converts a non-collapsed {@link module:engine/model/selection~Selection model selection}\r\n * to a {@link module:engine/view/documentselection~DocumentSelection view selection}. The converter consumes appropriate\r\n * value from the `consumable` object and maps model positions from the selection to view positions.\r\n *\r\n *\t\tmodelDispatcher.on( 'selection', convertRangeSelection() );\r\n *\r\n * @returns {Function} Selection converter.\r\n */\r\nexport function convertRangeSelection() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst selection = data.selection;\r\n\r\n\t\tif ( selection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( selection, 'selection' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewRanges = [];\r\n\r\n\t\tfor ( const range of selection.getRanges() ) {\r\n\t\t\tconst viewRange = conversionApi.mapper.toViewRange( range );\r\n\t\t\tviewRanges.push( viewRange );\r\n\t\t}\r\n\r\n\t\tconversionApi.writer.setSelection( viewRanges, { backward: selection.isBackward } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which converts a collapsed {@link module:engine/model/selection~Selection model selection} to\r\n * a {@link module:engine/view/documentselection~DocumentSelection view selection}. The converter consumes appropriate\r\n * value from the `consumable` object, maps the model selection position to the view position and breaks\r\n * {@link module:engine/view/attributeelement~AttributeElement attribute elements} at the selection position.\r\n *\r\n *\t\tmodelDispatcher.on( 'selection', convertCollapsedSelection() );\r\n *\r\n * An example of the view state before and after converting the collapsed selection:\r\n *\r\n *\t\t   <p><strong>f^oo<strong>bar</p>\r\n *\t\t-> <p><strong>f</strong>^<strong>oo</strong>bar</p>\r\n *\r\n * By breaking attribute elements like `<strong>`, the selection is in a correct element. Then, when the selection attribute is\r\n * converted, broken attributes might be merged again, or the position where the selection is may be wrapped\r\n * with different, appropriate attribute elements.\r\n *\r\n * See also {@link module:engine/conversion/downcast-selection-converters~clearAttributes} which does a clean-up\r\n * by merging attributes.\r\n *\r\n * @returns {Function} Selection converter.\r\n */\r\nexport function convertCollapsedSelection() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst selection = data.selection;\r\n\r\n\t\tif ( !selection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( !conversionApi.consumable.consume( selection, 'selection' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst modelPosition = selection.getFirstPosition();\r\n\t\tconst viewPosition = conversionApi.mapper.toViewPosition( modelPosition );\r\n\t\tconst brokenPosition = viewWriter.breakAttributes( viewPosition );\r\n\r\n\t\tviewWriter.setSelection( brokenPosition );\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory that creates a converter which clears artifacts after the previous\r\n * {@link module:engine/model/selection~Selection model selection} conversion. It removes all empty\r\n * {@link module:engine/view/attributeelement~AttributeElement view attribute elements} and merges sibling attributes at all start and end\r\n * positions of all ranges.\r\n *\r\n *\t\t   <p><strong>^</strong></p>\r\n *\t\t-> <p>^</p>\r\n *\r\n *\t\t   <p><strong>foo</strong>^<strong>bar</strong>bar</p>\r\n *\t\t-> <p><strong>foo^bar<strong>bar</p>\r\n *\r\n *\t\t   <p><strong>foo</strong><em>^</em><strong>bar</strong>bar</p>\r\n *\t\t-> <p><strong>foo^bar<strong>bar</p>\r\n *\r\n * This listener should be assigned before any converter for the new selection:\r\n *\r\n *\t\tmodelDispatcher.on( 'selection', clearAttributes() );\r\n *\r\n * See {@link module:engine/conversion/downcast-selection-converters~convertCollapsedSelection}\r\n * which does the opposite by breaking attributes in the selection position.\r\n *\r\n * @returns {Function} Selection converter.\r\n */\r\nexport function clearAttributes() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst viewSelection = viewWriter.document.selection;\r\n\r\n\t\tfor ( const range of viewSelection.getRanges() ) {\r\n\t\t\t// Not collapsed selection should not have artifacts.\r\n\t\t\tif ( range.isCollapsed ) {\r\n\t\t\t\t// Position might be in the node removed by the view writer.\r\n\t\t\t\tif ( range.end.parent.document ) {\r\n\t\t\t\t\tconversionApi.writer.mergeAttributes( range.start );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tviewWriter.setSelection( null );\r\n\t};\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/plugincollection\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\n\r\n/**\r\n * Manages a list of CKEditor plugins, including loading, resolving dependencies and initialization.\r\n */\r\nexport default class PluginCollection {\r\n\t/**\r\n\t * Creates an instance of the PluginCollection class.\r\n\t * Allows loading and initializing plugins and their dependencies.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t * @param {Array.<Function>} [availablePlugins] Plugins (constructors) which the collection will be able to use\r\n\t * when {@link module:core/plugincollection~PluginCollection#load} is used with plugin names (strings, instead of constructors).\r\n\t * Usually, the editor will pass its built-in plugins to the collection so they can later be\r\n\t * used in `config.plugins` or `config.removePlugins` by names.\r\n\t */\r\n\tconstructor( editor, availablePlugins = [] ) {\r\n\t\t/**\r\n\t\t * @protected\r\n\t\t * @member {module:core/editor/editor~Editor} module:core/plugin~PluginCollection#_editor\r\n\t\t */\r\n\t\tthis._editor = editor;\r\n\r\n\t\t/**\r\n\t\t * Map of plugin constructors which can be retrieved by their names.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map.<String|Function,Function>} module:core/plugin~PluginCollection#_availablePlugins\r\n\t\t */\r\n\t\tthis._availablePlugins = new Map();\r\n\r\n\t\t/**\r\n\t\t * @protected\r\n\t\t * @member {Map} module:core/plugin~PluginCollection#_plugins\r\n\t\t */\r\n\t\tthis._plugins = new Map();\r\n\r\n\t\tfor ( const PluginConstructor of availablePlugins ) {\r\n\t\t\tthis._availablePlugins.set( PluginConstructor, PluginConstructor );\r\n\r\n\t\t\tif ( PluginConstructor.pluginName ) {\r\n\t\t\t\tthis._availablePlugins.set( PluginConstructor.pluginName, PluginConstructor );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Returns `[ PluginConstructor, pluginInstance ]` pairs.\r\n\t *\r\n\t * @returns {Iterable.<Array>}\r\n\t */\r\n\t* [ Symbol.iterator ]() {\r\n\t\tfor ( const entry of this._plugins ) {\r\n\t\t\tif ( typeof entry[ 0 ] == 'function' ) {\r\n\t\t\t\tyield entry;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the plugin instance by its constructor or name.\r\n\t *\r\n\t * @param {Function|String} key The plugin constructor or {@link module:core/plugin~PluginInterface.pluginName name}.\r\n\t * @returns {module:core/plugin~PluginInterface}\r\n\t */\r\n\tget( key ) {\r\n\t\treturn this._plugins.get( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Loads a set of plugins and adds them to the collection.\r\n\t *\r\n\t * @param {Array.<Function|String>} plugins An array of {@link module:core/plugin~PluginInterface plugin constructors}\r\n\t * or {@link module:core/plugin~PluginInterface.pluginName plugin names}. The second option (names) works only if\r\n\t * `availablePlugins` were passed to the {@link #constructor}.\r\n\t * @param {Array.<String|Function>} [removePlugins] Names of plugins or plugin constructors\r\n\t * that should not be loaded (despite being specified in the `plugins` array).\r\n\t * @returns {Promise} A promise which gets resolved once all plugins are loaded and available in the\r\n\t * collection.\r\n\t * @returns {Promise.<Array.<module:core/plugin~PluginInterface>>} returns.loadedPlugins The array of loaded plugins.\r\n\t */\r\n\tload( plugins, removePlugins = [] ) {\r\n\t\tconst that = this;\r\n\t\tconst editor = this._editor;\r\n\t\tconst loading = new Set();\r\n\t\tconst loaded = [];\r\n\r\n\t\tconst pluginConstructors = mapToAvailableConstructors( plugins );\r\n\t\tconst removePluginConstructors = mapToAvailableConstructors( removePlugins );\r\n\t\tconst missingPlugins = getMissingPluginNames( plugins );\r\n\r\n\t\tif ( missingPlugins ) {\r\n\t\t\t/**\r\n\t\t\t * Some plugins are not available and could not be loaded.\r\n\t\t\t *\r\n\t\t\t * Plugin classes (constructors) need to be provided to the editor before they can be loaded by name.\r\n\t\t\t * This is usually done in CKEditor 5 builds by setting the {@link module:core/editor/editor~Editor.builtinPlugins}\r\n\t\t\t * property.\r\n\t\t\t *\r\n\t\t\t * **If you see this warning when using one of the {@glink builds/index CKEditor 5 Builds}**, it means\r\n\t\t\t * that you try to enable a plugin which was not included in that build. This may be due to a typo\r\n\t\t\t * in the plugin name or simply because that plugin is not a part of this build. In the latter scenario,\r\n\t\t\t * read more about {@glink builds/guides/development/custom-builds custom builds}.\r\n\t\t\t *\r\n\t\t\t * **If you see this warning when using one of the editor creators directly** (not a build), then it means\r\n\t\t\t * that you tried loading plugins by name. However, unlike CKEditor 4, CKEditor 5 does not implement a \"plugin loader\".\r\n\t\t\t * This means that CKEditor 5 does not know where to load the plugin modules from. Therefore, you need to\r\n\t\t\t * provide each plugin through reference (as a constructor function). Check out the examples in\r\n\t\t\t * {@glink builds/guides/integration/advanced-setup#scenario-2-building-from-source \"Building from source\"}.\r\n\t\t\t *\r\n\t\t\t * @error plugincollection-plugin-not-found\r\n\t\t\t * @param {Array.<String>} plugins The name of the plugins which could not be loaded.\r\n\t\t\t */\r\n\t\t\tconst errorMsg = 'plugincollection-plugin-not-found: Some plugins are not available and could not be loaded.';\r\n\r\n\t\t\t// Log the error so it's more visible on the console. Hopefully, for better DX.\r\n\t\t\tlog.error( errorMsg, { plugins: missingPlugins } );\r\n\r\n\t\t\treturn Promise.reject( new CKEditorError( errorMsg, { plugins: missingPlugins } ) );\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pluginConstructors.map( loadPlugin ) )\r\n\t\t\t.then( () => loaded );\r\n\r\n\t\tfunction loadPlugin( PluginConstructor ) {\r\n\t\t\tif ( removePluginConstructors.includes( PluginConstructor ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// The plugin is already loaded or being loaded - do nothing.\r\n\t\t\tif ( that.get( PluginConstructor ) || loading.has( PluginConstructor ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\treturn instantiatePlugin( PluginConstructor )\r\n\t\t\t\t.catch( err => {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * It was not possible to load the plugin.\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * This is a generic error logged to the console when a JavaSript error is thrown during the initialization\r\n\t\t\t\t\t * of one of the plugins.\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * If you correctly handled the promise returned by the editor's `create()` method (like shown below)\r\n\t\t\t\t\t * you will find the original error logged to the console, too:\r\n\t\t\t\t\t *\r\n\t\t\t\t\t *\t\tClassicEditor.create( document.getElementById( 'editor' ) )\r\n\t\t\t\t\t *\t\t\t.then( editor => {\r\n\t\t\t\t\t *\t\t\t\t// ...\r\n\t\t\t\t\t * \t\t\t} )\r\n\t\t\t\t\t *\t\t\t.catch( error => {\r\n\t\t\t\t\t *\t\t\t\tconsole.error( error );\r\n\t\t\t\t\t *\t\t\t} );\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * @error plugincollection-load\r\n\t\t\t\t\t * @param {String} plugin The name of the plugin that could not be loaded.\r\n\t\t\t\t\t */\r\n\t\t\t\t\tlog.error( 'plugincollection-load: It was not possible to load the plugin.', { plugin: PluginConstructor } );\r\n\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t} );\r\n\t\t}\r\n\r\n\t\tfunction instantiatePlugin( PluginConstructor ) {\r\n\t\t\treturn new Promise( resolve => {\r\n\t\t\t\tloading.add( PluginConstructor );\r\n\r\n\t\t\t\tif ( PluginConstructor.requires ) {\r\n\t\t\t\t\tPluginConstructor.requires.forEach( RequiredPluginConstructorOrName => {\r\n\t\t\t\t\t\tconst RequiredPluginConstructor = getPluginConstructor( RequiredPluginConstructorOrName );\r\n\r\n\t\t\t\t\t\tif ( removePlugins.includes( RequiredPluginConstructor ) ) {\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * Cannot load a plugin because one of its dependencies is listed in the `removePlugins` option.\r\n\t\t\t\t\t\t\t *\r\n\t\t\t\t\t\t\t * @error plugincollection-required\r\n\t\t\t\t\t\t\t * @param {Function} plugin The required plugin.\r\n\t\t\t\t\t\t\t * @param {Function} requiredBy The parent plugin.\r\n\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t\t\t\t'plugincollection-required: Cannot load a plugin because one of its dependencies is listed in' +\r\n\t\t\t\t\t\t\t\t'the `removePlugins` option.',\r\n\t\t\t\t\t\t\t\t{ plugin: RequiredPluginConstructor, requiredBy: PluginConstructor }\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tloadPlugin( RequiredPluginConstructor );\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst plugin = new PluginConstructor( editor );\r\n\t\t\t\tthat._add( PluginConstructor, plugin );\r\n\t\t\t\tloaded.push( plugin );\r\n\r\n\t\t\t\tresolve();\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tfunction getPluginConstructor( PluginConstructorOrName ) {\r\n\t\t\tif ( typeof PluginConstructorOrName == 'function' ) {\r\n\t\t\t\treturn PluginConstructorOrName;\r\n\t\t\t}\r\n\r\n\t\t\treturn that._availablePlugins.get( PluginConstructorOrName );\r\n\t\t}\r\n\r\n\t\tfunction getMissingPluginNames( plugins ) {\r\n\t\t\tconst missingPlugins = [];\r\n\r\n\t\t\tfor ( const pluginNameOrConstructor of plugins ) {\r\n\t\t\t\tif ( !getPluginConstructor( pluginNameOrConstructor ) ) {\r\n\t\t\t\t\tmissingPlugins.push( pluginNameOrConstructor );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn missingPlugins.length ? missingPlugins : null;\r\n\t\t}\r\n\r\n\t\tfunction mapToAvailableConstructors( plugins ) {\r\n\t\t\treturn plugins\r\n\t\t\t\t.map( pluginNameOrConstructor => getPluginConstructor( pluginNameOrConstructor ) )\r\n\t\t\t\t.filter( PluginConstructor => !!PluginConstructor );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys all loaded plugins.\r\n\t *\r\n\t * @returns {Promise}\r\n\t */\r\n\tdestroy() {\r\n\t\tconst promises = Array.from( this )\r\n\t\t\t.map( ( [ , pluginInstance ] ) => pluginInstance )\r\n\t\t\t.filter( pluginInstance => typeof pluginInstance.destroy == 'function' )\r\n\t\t\t.map( pluginInstance => pluginInstance.destroy() );\r\n\r\n\t\treturn Promise.all( promises );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds the plugin to the collection. Exposed mainly for testing purposes.\r\n\t *\r\n\t * @protected\r\n\t * @param {Function} PluginConstructor The plugin constructor.\r\n\t * @param {module:core/plugin~PluginInterface} plugin The instance of the plugin.\r\n\t */\r\n\t_add( PluginConstructor, plugin ) {\r\n\t\tthis._plugins.set( PluginConstructor, plugin );\r\n\r\n\t\tconst pluginName = PluginConstructor.pluginName;\r\n\r\n\t\tif ( !pluginName ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( this._plugins.has( pluginName ) ) {\r\n\t\t\t/**\r\n\t\t\t * Two plugins with the same {@link module:core/plugin~PluginInterface.pluginName} were loaded.\r\n\t\t\t * This will lead to runtime conflicts between these plugins.\r\n\t\t\t *\r\n\t\t\t * In practice, this warning usually means that new plugins were added to an existing CKEditor 5 build.\r\n\t\t\t * Plugins should always be added to a source version of the editor (`@ckeditor/ckeditor5-editor-*`),\r\n\t\t\t * not to an editor imported from one of the `@ckeditor/ckeditor5-build-*` packages.\r\n\t\t\t *\r\n\t\t\t * Check your import paths and the list of plugins passed to\r\n\t\t\t * {@link module:core/editor/editor~Editor.create `Editor.create()`}\r\n\t\t\t * or specified in {@link module:core/editor/editor~Editor.builtinPlugins `Editor.builtinPlugins`}.\r\n\t\t\t *\r\n\t\t\t * The second option is that your `node_modules/` directory contains duplicated versions of the same\r\n\t\t\t * CKEditor 5 packages. Normally, on clean installations, npm deduplicates packages in `node_modules/`, so\r\n\t\t\t * it may be enough to call `rm -rf node_modules && npm i`. However, if you installed conflicting versions\r\n\t\t\t * of packages, their dependencies may need to be installed in more than one version which may lead to this\r\n\t\t\t * warning.\r\n\t\t\t *\r\n\t\t\t * Technically speaking, this error occurs because after adding a plugin to an existing editor build\r\n\t\t\t * dependencies of this plugin are being duplicated.\r\n\t\t\t * They are already built into that editor build and now get added for the second time as dependencies\r\n\t\t\t * of the plugin you are installing.\r\n\t\t\t *\r\n\t\t\t * Read more about {@glink builds/guides/integration/installing-plugins installing plugins}.\r\n\t\t\t *\r\n\t\t\t * @error plugincollection-plugin-name-conflict\r\n\t\t\t * @param {String} pluginName The duplicated plugin name.\r\n\t\t\t * @param {Function} plugin1 The first plugin constructor.\r\n\t\t\t * @param {Function} plugin2 The second plugin constructor.\r\n\t\t\t */\r\n\t\t\tlog.warn(\r\n\t\t\t\t'plugincollection-plugin-name-conflict: Two plugins with the same name were loaded.',\r\n\t\t\t\t{ pluginName, plugin1: this._plugins.get( pluginName ).constructor, plugin2: PluginConstructor }\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis._plugins.set( pluginName, plugin );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/commandcollection\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Collection of commands. Its instance is available in {@link module:core/editor/editor~Editor#commands `editor.commands`}.\r\n */\r\nexport default class CommandCollection {\r\n\t/**\r\n\t * Creates collection instance.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Command map.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._commands = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a new command.\r\n\t *\r\n\t * @param {String} commandName The name of the command.\r\n\t * @param {module:core/command~Command} command\r\n\t */\r\n\tadd( commandName, command ) {\r\n\t\tthis._commands.set( commandName, command );\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves a command from the collection.\r\n\t *\r\n\t * @param {String} commandName The name of the command.\r\n\t * @returns {module:core/command~Command}\r\n\t */\r\n\tget( commandName ) {\r\n\t\treturn this._commands.get( commandName );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes a command.\r\n\t *\r\n\t * @param {String} commandName The name of the command.\r\n\t * @param {*} [...commandParams] Command parameters.\r\n\t */\r\n\texecute( commandName, ...args ) {\r\n\t\tconst command = this.get( commandName );\r\n\r\n\t\tif ( !command ) {\r\n\t\t\t/**\r\n\t\t\t * Command does not exist.\r\n\t\t\t *\r\n\t\t\t * @error commandcollection-command-not-found\r\n\t\t\t * @param {String} commandName Name of the command.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'commandcollection-command-not-found: Command does not exist.', { commandName } );\r\n\t\t}\r\n\r\n\t\tcommand.execute( ...args );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator of command names.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\t* names() {\r\n\t\tyield* this._commands.keys();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator of command instances.\r\n\t *\r\n\t * @returns {Iterable.<module:core/command~Command>}\r\n\t */\r\n\t* commands() {\r\n\t\tyield* this._commands.values();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Returns `[ commandName, commandInstance ]` pairs.\r\n\t *\r\n\t * @returns {Iterable.<Array>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._commands[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys all collection commands.\r\n\t */\r\n\tdestroy() {\r\n\t\tfor ( const command of this.commands() ) {\r\n\t\t\tcommand.destroy();\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals window */\r\n\r\n/**\r\n * @module utils/translation-service\r\n */\r\n\r\n/* istanbul ignore else */\r\nif ( !window.CKEDITOR_TRANSLATIONS ) {\r\n\twindow.CKEDITOR_TRANSLATIONS = {};\r\n}\r\n\r\n/**\r\n * Adds translations to existing ones.\r\n * These translations will later be available for the {@link module:utils/translation-service~translate `translate()`} function.\r\n *\r\n *\t\tadd( 'pl', {\r\n *\t\t\t'OK': 'OK',\r\n *\t\t\t'Cancel [context: reject]': 'Anuluj'\r\n *\t\t} );\r\n *\r\n * If you cannot import this function from this module (e.g. because you use a CKEditor 5 build), then you can\r\n * still add translations by extending the global `window.CKEDITOR_TRANSLATIONS` object by using a function like\r\n * the one below:\r\n *\r\n *\t\tfunction addTranslations( language, translations ) {\r\n *\t\t\tif ( !window.CKEDITOR_TRANSLATIONS ) {\r\n *\t\t\t\twindow.CKEDITOR_TRANSLATIONS = {};\r\n *\t\t\t}\r\n *\r\n *\t\t\tconst dictionary = window.CKEDITOR_TRANSLATIONS[ language ] || ( window.CKEDITOR_TRANSLATIONS[ language ] = {} );\r\n *\r\n *\t\t\t// Extend the dictionary for the given language.\r\n *\t\t\tObject.assign( dictionary, translations );\r\n *\t\t}\r\n *\r\n * @param {String} language Target language.\r\n * @param {Object.<String, String>} translations Translations which will be added to the dictionary.\r\n */\r\nexport function add( language, translations ) {\r\n\tconst dictionary = window.CKEDITOR_TRANSLATIONS[ language ] || ( window.CKEDITOR_TRANSLATIONS[ language ] = {} );\r\n\r\n\tObject.assign( dictionary, translations );\r\n}\r\n\r\n/**\r\n * Translates string if the translation of the string was previously added to the dictionary.\r\n * See {@link module:utils/translation-service Translation Service}.\r\n * This happens in a multi-language mode were translation modules are created by the bundler.\r\n *\r\n * When no translation is defined in the dictionary or the dictionary doesn't exist this function returns\r\n * the original string without the `'[context: ]'` (happens in development and single-language modes).\r\n *\r\n * In a single-language mode (when values passed to `t()` were replaced with target language strings) the dictionary\r\n * is left empty, so this function will return the original strings always.\r\n *\r\n *\t\ttranslate( 'pl', 'Cancel [context: reject]' );\r\n *\r\n * @param {String} language Target language.\r\n * @param {String} translationKey String that will be translated.\r\n * @returns {String} Translated sentence.\r\n */\r\nexport function translate( language, translationKey ) {\r\n\tconst numberOfLanguages = getNumberOfLanguages();\r\n\r\n\tif ( numberOfLanguages === 1 ) {\r\n\t\t// Override the language to the only supported one.\r\n\t\t// This can't be done in the `Locale` class, because the translations comes after the `Locale` class initialization.\r\n\t\tlanguage = Object.keys( window.CKEDITOR_TRANSLATIONS )[ 0 ];\r\n\t}\r\n\r\n\tif ( numberOfLanguages === 0 || !hasTranslation( language, translationKey ) ) {\r\n\t\treturn translationKey.replace( / \\[context: [^\\]]+\\]$/, '' );\r\n\t}\r\n\r\n\tconst dictionary = window.CKEDITOR_TRANSLATIONS[ language ];\r\n\r\n\t// In case of missing translations we still need to cut off the `[context: ]` parts.\r\n\treturn dictionary[ translationKey ].replace( / \\[context: [^\\]]+\\]$/, '' );\r\n}\r\n\r\n/**\r\n * Clears dictionaries for test purposes.\r\n *\r\n * @protected\r\n */\r\nexport function _clear() {\r\n\twindow.CKEDITOR_TRANSLATIONS = {};\r\n}\r\n\r\n// Checks whether the dictionary exists and translation in that dictionary exists.\r\nfunction hasTranslation( language, translationKey ) {\r\n\treturn (\r\n\t\t( language in window.CKEDITOR_TRANSLATIONS ) &&\r\n\t\t( translationKey in window.CKEDITOR_TRANSLATIONS[ language ] )\r\n\t);\r\n}\r\n\r\nfunction getNumberOfLanguages() {\r\n\treturn Object.keys( window.CKEDITOR_TRANSLATIONS ).length;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/locale\r\n */\r\n\r\nimport { translate } from './translation-service';\r\n\r\n/**\r\n * Represents the localization services.\r\n */\r\nexport default class Locale {\r\n\t/**\r\n\t * Creates a new instance of the Locale class.\r\n\t *\r\n\t * @param {String} [language='en'] The language code in [ISO 639-1](https://en.wikipedia.org/wiki/ISO_639-1) format.\r\n\t */\r\n\tconstructor( language ) {\r\n\t\t/**\r\n\t\t * The language code in [ISO 639-1](https://en.wikipedia.org/wiki/ISO_639-1) format.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.language = language || 'en';\r\n\r\n\t\t/**\r\n\t\t * Translates the given string to the {@link #language}. This method is also available in {@link module:core/editor/editor~Editor#t}\r\n\t\t * and {@link module:ui/view~View#t}.\r\n\t\t *\r\n\t\t * The strings may contain placeholders (`%<index>`) for values which are passed as the second argument.\r\n\t\t * `<index>` is the index in the `values` array.\r\n\t\t *\r\n\t\t *\t\teditor.t( 'Created file \"%0\" in %1ms.', [ fileName, timeTaken ] );\r\n\t\t *\r\n\t\t * This method's context is statically bound to Locale instance,\r\n\t\t * so it can be called as a function:\r\n\t\t *\r\n\t\t *\t\tconst t = this.t;\r\n\t\t *\t\tt( 'Label' );\r\n\t\t *\r\n\t\t * @method #t\r\n\t\t * @param {String} str The string to translate.\r\n\t\t * @param {String[]} [values] Values that should be used to interpolate the string.\r\n\t\t */\r\n\t\tthis.t = ( ...args ) => this._t( ...args );\r\n\t}\r\n\r\n\t/**\r\n\t * Base for the {@link #t} method.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_t( str, values ) {\r\n\t\tlet translatedString = translate( this.language, str );\r\n\r\n\t\tif ( values ) {\r\n\t\t\ttranslatedString = translatedString.replace( /%(\\d+)/g, ( match, index ) => {\r\n\t\t\t\treturn ( index < values.length ) ? values[ index ] : match;\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn translatedString;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/viewconsumable\r\n */\r\n\r\nimport { isArray } from 'lodash-es';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Class used for handling consumption of view {@link module:engine/view/element~Element elements},\r\n * {@link module:engine/view/text~Text text nodes} and {@link module:engine/view/documentfragment~DocumentFragment document fragments}.\r\n * Element's name and its parts (attributes, classes and styles) can be consumed separately. Consuming an element's name\r\n * does not consume its attributes, classes and styles.\r\n * To add items for consumption use {@link module:engine/conversion/viewconsumable~ViewConsumable#add add method}.\r\n * To test items use {@link module:engine/conversion/viewconsumable~ViewConsumable#test test method}.\r\n * To consume items use {@link module:engine/conversion/viewconsumable~ViewConsumable#consume consume method}.\r\n * To revert already consumed items use {@link module:engine/conversion/viewconsumable~ViewConsumable#revert revert method}.\r\n *\r\n *\t\tviewConsumable.add( element, { name: true } ); // Adds element's name as ready to be consumed.\r\n *\t\tviewConsumable.add( textNode ); // Adds text node for consumption.\r\n *\t\tviewConsumable.add( docFragment ); // Adds document fragment for consumption.\r\n *\t\tviewConsumable.test( element, { name: true }  ); // Tests if element's name can be consumed.\r\n *\t\tviewConsumable.test( textNode ); // Tests if text node can be consumed.\r\n *\t\tviewConsumable.test( docFragment ); // Tests if document fragment can be consumed.\r\n *\t\tviewConsumable.consume( element, { name: true }  ); // Consume element's name.\r\n *\t\tviewConsumable.consume( textNode ); // Consume text node.\r\n *\t\tviewConsumable.consume( docFragment ); // Consume document fragment.\r\n *\t\tviewConsumable.revert( element, { name: true }  ); // Revert already consumed element's name.\r\n *\t\tviewConsumable.revert( textNode ); // Revert already consumed text node.\r\n *\t\tviewConsumable.revert( docFragment ); // Revert already consumed document fragment.\r\n */\r\nexport default class ViewConsumable {\r\n\t/**\r\n\t * Creates new ViewConsumable.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Map of consumable elements. If {@link module:engine/view/element~Element element} is used as a key,\r\n\t\t * {@link module:engine/conversion/viewconsumable~ViewElementConsumables ViewElementConsumables} instance is stored as value.\r\n\t\t * For {@link module:engine/view/text~Text text nodes} and\r\n\t\t * {@link module:engine/view/documentfragment~DocumentFragment document fragments} boolean value is stored as value.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map.<module:engine/conversion/viewconsumable~ViewElementConsumables|Boolean>}\r\n\t\t*/\r\n\t\tthis._consumables = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} as ready to be consumed.\r\n\t *\r\n\t *\t\tviewConsumable.add( p, { name: true } ); // Adds element's name to consume.\r\n\t *\t\tviewConsumable.add( p, { attributes: 'name' } ); // Adds element's attribute.\r\n\t *\t\tviewConsumable.add( p, { classes: 'foobar' } ); // Adds element's class.\r\n\t *\t\tviewConsumable.add( p, { styles: 'color' } ); // Adds element's style\r\n\t *\t\tviewConsumable.add( p, { attributes: 'name', styles: 'color' } ); // Adds attribute and style.\r\n\t *\t\tviewConsumable.add( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be provided.\r\n\t *\t\tviewConsumable.add( textNode ); // Adds text node to consume.\r\n\t *\t\tviewConsumable.add( docFragment ); // Adds document fragment to consume.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\r\n\t * attribute is provided - it should be handled separately by providing actual style/class.\r\n\t *\r\n\t *\t\tviewConsumable.add( p, { attributes: 'style' } ); // This call will throw an exception.\r\n\t *\t\tviewConsumable.add( p, { styles: 'color' } ); // This is properly handled style.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\r\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\r\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\r\n\t */\r\n\tadd( element, consumables ) {\r\n\t\tlet elementConsumables;\r\n\r\n\t\t// For text nodes and document fragments just mark them as consumable.\r\n\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\r\n\t\t\tthis._consumables.set( element, true );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// For elements create new ViewElementConsumables or update already existing one.\r\n\t\tif ( !this._consumables.has( element ) ) {\r\n\t\t\telementConsumables = new ViewElementConsumables();\r\n\t\t\tthis._consumables.set( element, elementConsumables );\r\n\t\t} else {\r\n\t\t\telementConsumables = this._consumables.get( element );\r\n\t\t}\r\n\r\n\t\telementConsumables.add( consumables );\r\n\t}\r\n\r\n\t/**\r\n\t * Tests if {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} can be consumed.\r\n\t * It returns `true` when all items included in method's call can be consumed. Returns `false` when\r\n\t * first already consumed item is found and `null` when first non-consumable item is found.\r\n\t *\r\n\t *\t\tviewConsumable.test( p, { name: true } ); // Tests element's name.\r\n\t *\t\tviewConsumable.test( p, { attributes: 'name' } ); // Tests attribute.\r\n\t *\t\tviewConsumable.test( p, { classes: 'foobar' } ); // Tests class.\r\n\t *\t\tviewConsumable.test( p, { styles: 'color' } ); // Tests style.\r\n\t *\t\tviewConsumable.test( p, { attributes: 'name', styles: 'color' } ); // Tests attribute and style.\r\n\t *\t\tviewConsumable.test( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be tested.\r\n\t *\t\tviewConsumable.test( textNode ); // Tests text node.\r\n\t *\t\tviewConsumable.test( docFragment ); // Tests document fragment.\r\n\t *\r\n\t * Testing classes and styles as attribute will test if all added classes/styles can be consumed.\r\n\t *\r\n\t *\t\tviewConsumable.test( p, { attributes: 'class' } ); // Tests if all added classes can be consumed.\r\n\t *\t\tviewConsumable.test( p, { attributes: 'style' } ); // Tests if all added styles can be consumed.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\r\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\r\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\r\n\t * @returns {Boolean|null} Returns `true` when all items included in method's call can be consumed. Returns `false`\r\n\t * when first already consumed item is found and `null` when first non-consumable item is found.\r\n\t */\r\n\ttest( element, consumables ) {\r\n\t\tconst elementConsumables = this._consumables.get( element );\r\n\r\n\t\tif ( elementConsumables === undefined ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// For text nodes and document fragments return stored boolean value.\r\n\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\r\n\t\t\treturn elementConsumables;\r\n\t\t}\r\n\r\n\t\t// For elements test consumables object.\r\n\t\treturn elementConsumables.test( consumables );\r\n\t}\r\n\r\n\t/**\r\n\t * Consumes {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\r\n\t * It returns `true` when all items included in method's call can be consumed, otherwise returns `false`.\r\n\t *\r\n\t *\t\tviewConsumable.consume( p, { name: true } ); // Consumes element's name.\r\n\t *\t\tviewConsumable.consume( p, { attributes: 'name' } ); // Consumes element's attribute.\r\n\t *\t\tviewConsumable.consume( p, { classes: 'foobar' } ); // Consumes element's class.\r\n\t *\t\tviewConsumable.consume( p, { styles: 'color' } ); // Consumes element's style.\r\n\t *\t\tviewConsumable.consume( p, { attributes: 'name', styles: 'color' } ); // Consumes attribute and style.\r\n\t *\t\tviewConsumable.consume( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be consumed.\r\n\t *\t\tviewConsumable.consume( textNode ); // Consumes text node.\r\n\t *\t\tviewConsumable.consume( docFragment ); // Consumes document fragment.\r\n\t *\r\n\t * Consuming classes and styles as attribute will test if all added classes/styles can be consumed.\r\n\t *\r\n\t *\t\tviewConsumable.consume( p, { attributes: 'class' } ); // Consume only if all added classes can be consumed.\r\n\t *\t\tviewConsumable.consume( p, { attributes: 'style' } ); // Consume only if all added styles can be consumed.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\r\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\r\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\r\n\t * @returns {Boolean} Returns `true` when all items included in method's call can be consumed,\r\n\t * otherwise returns `false`.\r\n\t */\r\n\tconsume( element, consumables ) {\r\n\t\tif ( this.test( element, consumables ) ) {\r\n\t\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\r\n\t\t\t\t// For text nodes and document fragments set value to false.\r\n\t\t\t\tthis._consumables.set( element, false );\r\n\t\t\t} else {\r\n\t\t\t\t// For elements - consume consumables object.\r\n\t\t\t\tthis._consumables.get( element ).consume( consumables );\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Reverts {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} so they can be consumed once again.\r\n\t * Method does not revert items that were never previously added for consumption, even if they are included in\r\n\t * method's call.\r\n\t *\r\n\t *\t\tviewConsumable.revert( p, { name: true } ); // Reverts element's name.\r\n\t *\t\tviewConsumable.revert( p, { attributes: 'name' } ); // Reverts element's attribute.\r\n\t *\t\tviewConsumable.revert( p, { classes: 'foobar' } ); // Reverts element's class.\r\n\t *\t\tviewConsumable.revert( p, { styles: 'color' } ); // Reverts element's style.\r\n\t *\t\tviewConsumable.revert( p, { attributes: 'name', styles: 'color' } ); // Reverts attribute and style.\r\n\t *\t\tviewConsumable.revert( p, { classes: [ 'baz', 'bar' ] } ); // Multiple names can be reverted.\r\n\t *\t\tviewConsumable.revert( textNode ); // Reverts text node.\r\n\t *\t\tviewConsumable.revert( docFragment ); // Reverts document fragment.\r\n\t *\r\n\t * Reverting classes and styles as attribute will revert all classes/styles that were previously added for\r\n\t * consumption.\r\n\t *\r\n\t *\t\tviewConsumable.revert( p, { attributes: 'class' } ); // Reverts all classes added for consumption.\r\n\t *\t\tviewConsumable.revert( p, { attributes: 'style' } ); // Reverts all styles added for consumption.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\r\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\r\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\r\n\t */\r\n\trevert( element, consumables ) {\r\n\t\tconst elementConsumables = this._consumables.get( element );\r\n\r\n\t\tif ( elementConsumables !== undefined ) {\r\n\t\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\r\n\t\t\t\t// For text nodes and document fragments - set consumable to true.\r\n\t\t\t\tthis._consumables.set( element, true );\r\n\t\t\t} else {\r\n\t\t\t\t// For elements - revert items from consumables object.\r\n\t\t\t\telementConsumables.revert( consumables );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates consumable object from {@link module:engine/view/element~Element view element}. Consumable object will include\r\n\t * element's name and all its attributes, classes and styles.\r\n\t *\r\n\t * @static\r\n\t * @param {module:engine/view/element~Element} element\r\n\t * @returns {Object} consumables\r\n\t */\r\n\tstatic consumablesFromElement( element ) {\r\n\t\tconst consumables = {\r\n\t\t\tname: true,\r\n\t\t\tattributes: [],\r\n\t\t\tclasses: [],\r\n\t\t\tstyles: []\r\n\t\t};\r\n\r\n\t\tconst attributes = element.getAttributeKeys();\r\n\r\n\t\tfor ( const attribute of attributes ) {\r\n\t\t\t// Skip classes and styles - will be added separately.\r\n\t\t\tif ( attribute == 'style' || attribute == 'class' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconsumables.attributes.push( attribute );\r\n\t\t}\r\n\r\n\t\tconst classes = element.getClassNames();\r\n\r\n\t\tfor ( const className of classes ) {\r\n\t\t\tconsumables.classes.push( className );\r\n\t\t}\r\n\r\n\t\tconst styles = element.getStyleNames();\r\n\r\n\t\tfor ( const style of styles ) {\r\n\t\t\tconsumables.styles.push( style );\r\n\t\t}\r\n\r\n\t\treturn consumables;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates {@link module:engine/conversion/viewconsumable~ViewConsumable ViewConsumable} instance from\r\n\t * {@link module:engine/view/node~Node node} or {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\r\n\t * Instance will contain all elements, child nodes, attributes, styles and classes added for consumption.\r\n\t *\r\n\t * @static\r\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} from View node or document fragment\r\n\t * from which `ViewConsumable` will be created.\r\n\t * @param {module:engine/conversion/viewconsumable~ViewConsumable} [instance] If provided, given `ViewConsumable` instance will be used\r\n\t * to add all consumables. It will be returned instead of a new instance.\r\n\t */\r\n\tstatic createFrom( from, instance ) {\r\n\t\tif ( !instance ) {\r\n\t\t\tinstance = new ViewConsumable();\r\n\t\t}\r\n\r\n\t\tif ( from.is( 'text' ) ) {\r\n\t\t\tinstance.add( from );\r\n\r\n\t\t\treturn instance;\r\n\t\t}\r\n\r\n\t\t// Add `from` itself, if it is an element.\r\n\t\tif ( from.is( 'element' ) ) {\r\n\t\t\tinstance.add( from, ViewConsumable.consumablesFromElement( from ) );\r\n\t\t}\r\n\r\n\t\tif ( from.is( 'documentFragment' ) ) {\r\n\t\t\tinstance.add( from );\r\n\t\t}\r\n\r\n\t\tfor ( const child of from.getChildren() ) {\r\n\t\t\tinstance = ViewConsumable.createFrom( child, instance );\r\n\t\t}\r\n\r\n\t\treturn instance;\r\n\t}\r\n}\r\n\r\n/**\r\n * This is a private helper-class for {@link module:engine/conversion/viewconsumable~ViewConsumable}.\r\n * It represents and manipulates consumable parts of a single {@link module:engine/view/element~Element}.\r\n *\r\n * @private\r\n */\r\nclass ViewElementConsumables {\r\n\t/**\r\n\t * Creates ViewElementConsumables instance.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Flag indicating if name of the element can be consumed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._canConsumeName = null;\r\n\r\n\t\t/**\r\n\t\t * Contains maps of element's consumables: attributes, classes and styles.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis._consumables = {\r\n\t\t\tattributes: new Map(),\r\n\t\t\tstyles: new Map(),\r\n\t\t\tclasses: new Map()\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Adds consumable parts of the {@link module:engine/view/element~Element view element}.\r\n\t * Element's name itself can be marked to be consumed (when element's name is consumed its attributes, classes and\r\n\t * styles still could be consumed):\r\n\t *\r\n\t *\t\tconsumables.add( { name: true } );\r\n\t *\r\n\t * Attributes classes and styles:\r\n\t *\r\n\t *\t\tconsumables.add( { attributes: 'title', classes: 'foo', styles: 'color' } );\r\n\t *\t\tconsumables.add( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\r\n\t * attribute is provided - it should be handled separately by providing `style` and `class` in consumables object.\r\n\t *\r\n\t * @param {Object} consumables Object describing which parts of the element can be consumed.\r\n\t * @param {Boolean} consumables.name If set to `true` element's name will be added as consumable.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to add as consumable.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to add as consumable.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to add as consumable.\r\n\t */\r\n\tadd( consumables ) {\r\n\t\tif ( consumables.name ) {\r\n\t\t\tthis._canConsumeName = true;\r\n\t\t}\r\n\r\n\t\tfor ( const type in this._consumables ) {\r\n\t\t\tif ( type in consumables ) {\r\n\t\t\t\tthis._add( type, consumables[ type ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Tests if parts of the {@link module:engine/view/node~Node view node} can be consumed.\r\n\t *\r\n\t * Element's name can be tested:\r\n\t *\r\n\t *\t\tconsumables.test( { name: true } );\r\n\t *\r\n\t * Attributes classes and styles:\r\n\t *\r\n\t *\t\tconsumables.test( { attributes: 'title', classes: 'foo', styles: 'color' } );\r\n\t *\t\tconsumables.test( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\r\n\t *\r\n\t * @param {Object} consumables Object describing which parts of the element should be tested.\r\n\t * @param {Boolean} consumables.name If set to `true` element's name will be tested.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to test.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to test.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to test.\r\n\t * @returns {Boolean|null} `true` when all tested items can be consumed, `null` when even one of the items\r\n\t * was never marked for consumption and `false` when even one of the items was already consumed.\r\n\t */\r\n\ttest( consumables ) {\r\n\t\t// Check if name can be consumed.\r\n\t\tif ( consumables.name && !this._canConsumeName ) {\r\n\t\t\treturn this._canConsumeName;\r\n\t\t}\r\n\r\n\t\tfor ( const type in this._consumables ) {\r\n\t\t\tif ( type in consumables ) {\r\n\t\t\t\tconst value = this._test( type, consumables[ type ] );\r\n\r\n\t\t\t\tif ( value !== true ) {\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Return true only if all can be consumed.\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Consumes parts of {@link module:engine/view/element~Element view element}. This function does not check if consumable item\r\n\t * is already consumed - it consumes all consumable items provided.\r\n\t * Element's name can be consumed:\r\n\t *\r\n\t *\t\tconsumables.consume( { name: true } );\r\n\t *\r\n\t * Attributes classes and styles:\r\n\t *\r\n\t *\t\tconsumables.consume( { attributes: 'title', classes: 'foo', styles: 'color' } );\r\n\t *\t\tconsumables.consume( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\r\n\t *\r\n\t * @param {Object} consumables Object describing which parts of the element should be consumed.\r\n\t * @param {Boolean} consumables.name If set to `true` element's name will be consumed.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to consume.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to consume.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to consume.\r\n\t */\r\n\tconsume( consumables ) {\r\n\t\tif ( consumables.name ) {\r\n\t\t\tthis._canConsumeName = false;\r\n\t\t}\r\n\r\n\t\tfor ( const type in this._consumables ) {\r\n\t\t\tif ( type in consumables ) {\r\n\t\t\t\tthis._consume( type, consumables[ type ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Revert already consumed parts of {@link module:engine/view/element~Element view Element}, so they can be consumed once again.\r\n\t * Element's name can be reverted:\r\n\t *\r\n\t *\t\tconsumables.revert( { name: true } );\r\n\t *\r\n\t * Attributes classes and styles:\r\n\t *\r\n\t *\t\tconsumables.revert( { attributes: 'title', classes: 'foo', styles: 'color' } );\r\n\t *\t\tconsumables.revert( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\r\n\t *\r\n\t * @param {Object} consumables Object describing which parts of the element should be reverted.\r\n\t * @param {Boolean} consumables.name If set to `true` element's name will be reverted.\r\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to revert.\r\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to revert.\r\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to revert.\r\n\t */\r\n\trevert( consumables ) {\r\n\t\tif ( consumables.name ) {\r\n\t\t\tthis._canConsumeName = true;\r\n\t\t}\r\n\r\n\t\tfor ( const type in this._consumables ) {\r\n\t\t\tif ( type in consumables ) {\r\n\t\t\t\tthis._revert( type, consumables[ type ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method that adds consumables of a given type: attribute, class or style.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\r\n\t * type is provided - it should be handled separately by providing actual style/class type.\r\n\t *\r\n\t * @private\r\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\r\n\t * @param {String|Array.<String>} item Consumable item or array of items.\r\n\t */\r\n\t_add( type, item ) {\r\n\t\tconst items = isArray( item ) ? item : [ item ];\r\n\t\tconst consumables = this._consumables[ type ];\r\n\r\n\t\tfor ( const name of items ) {\r\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Class and style attributes should be handled separately in\r\n\t\t\t\t * {@link module:engine/conversion/viewconsumable~ViewConsumable#add `ViewConsumable#add()`}.\r\n\t\t\t\t *\r\n\t\t\t\t * What you have done is trying to use:\r\n\t\t\t\t *\r\n\t\t\t\t *\t\tconsumables.add( { attributes: [ 'class', 'style' ] } );\r\n\t\t\t\t *\r\n\t\t\t\t * While each class and style should be registered separately:\r\n\t\t\t\t *\r\n\t\t\t\t *\t\tconsumables.add( { classes: 'some-class', styles: 'font-weight' } );\r\n\t\t\t\t *\r\n\t\t\t\t * @error viewconsumable-invalid-attribute\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'viewconsumable-invalid-attribute: Classes and styles should be handled separately.' );\r\n\t\t\t}\r\n\r\n\t\t\tconsumables.set( name, true );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method that tests consumables of a given type: attribute, class or style.\r\n\t *\r\n\t * @private\r\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\r\n\t * @param {String|Array.<String>} item Consumable item or array of items.\r\n\t * @returns {Boolean|null} Returns `true` if all items can be consumed, `null` when one of the items cannot be\r\n\t * consumed and `false` when one of the items is already consumed.\r\n\t */\r\n\t_test( type, item ) {\r\n\t\tconst items = isArray( item ) ? item : [ item ];\r\n\t\tconst consumables = this._consumables[ type ];\r\n\r\n\t\tfor ( const name of items ) {\r\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\r\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\r\n\r\n\t\t\t\t// Check all classes/styles if class/style attribute is tested.\r\n\t\t\t\tconst value = this._test( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\r\n\r\n\t\t\t\tif ( value !== true ) {\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst value = consumables.get( name );\r\n\t\t\t\t// Return null if attribute is not found.\r\n\t\t\t\tif ( value === undefined ) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( !value ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method that consumes items of a given type: attribute, class or style.\r\n\t *\r\n\t * @private\r\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\r\n\t * @param {String|Array.<String>} item Consumable item or array of items.\r\n\t */\r\n\t_consume( type, item ) {\r\n\t\tconst items = isArray( item ) ? item : [ item ];\r\n\t\tconst consumables = this._consumables[ type ];\r\n\r\n\t\tfor ( const name of items ) {\r\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\r\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\r\n\r\n\t\t\t\t// If class or style is provided for consumption - consume them all.\r\n\t\t\t\tthis._consume( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\r\n\t\t\t} else {\r\n\t\t\t\tconsumables.set( name, false );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method that reverts items of a given type: attribute, class or style.\r\n\t *\r\n\t * @private\r\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or , `styles`.\r\n\t * @param {String|Array.<String>} item Consumable item or array of items.\r\n\t */\r\n\t_revert( type, item ) {\r\n\t\tconst items = isArray( item ) ? item : [ item ];\r\n\t\tconst consumables = this._consumables[ type ];\r\n\r\n\t\tfor ( const name of items ) {\r\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\r\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\r\n\r\n\t\t\t\t// If class or style is provided for reverting - revert them all.\r\n\t\t\t\tthis._revert( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\r\n\t\t\t} else {\r\n\t\t\t\tconst value = consumables.get( name );\r\n\r\n\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\tconsumables.set( name, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/schema\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\nimport Range from './range';\r\nimport Position from './position';\r\nimport Element from './element';\r\nimport Text from './text';\r\nimport TreeWalker from './treewalker';\r\n\r\n/**\r\n * The model's schema. It defines allowed and disallowed structures of nodes as well as nodes' attributes.\r\n * The schema is usually defined by features and based on them the editing framework and features\r\n * make decisions how to change and process the model.\r\n *\r\n * The instance of schema is available in {@link module:engine/model/model~Model#schema `editor.model.schema`}.\r\n *\r\n * Read more about the schema in:\r\n *\r\n * * {@glink framework/guides/architecture/editing-engine#schema \"Schema\"} section of the\r\n * {@glink framework/guides/architecture/editing-engine Introduction to the \"Editing engine architecture\"}.\r\n * * {@glink framework/guides/deep-dive/schema \"Schema\" deep dive} guide.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Schema {\r\n\t/**\r\n\t * Creates schema instance.\r\n\t */\r\n\tconstructor() {\r\n\t\tthis._sourceDefinitions = {};\r\n\r\n\t\tthis.decorate( 'checkChild' );\r\n\t\tthis.decorate( 'checkAttribute' );\r\n\r\n\t\tthis.on( 'checkAttribute', ( evt, args ) => {\r\n\t\t\targs[ 0 ] = new SchemaContext( args[ 0 ] );\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\tthis.on( 'checkChild', ( evt, args ) => {\r\n\t\t\targs[ 0 ] = new SchemaContext( args[ 0 ] );\r\n\t\t\targs[ 1 ] = this.getDefinition( args[ 1 ] );\r\n\t\t}, { priority: 'highest' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Registers schema item. Can only be called once for every item name.\r\n\t *\r\n\t *\t\tschema.register( 'paragraph', {\r\n\t *\t\t\tinheritAllFrom: '$block'\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {String} itemName\r\n\t * @param {module:engine/model/schema~SchemaItemDefinition} definition\r\n\t */\r\n\tregister( itemName, definition ) {\r\n\t\tif ( this._sourceDefinitions[ itemName ] ) {\r\n\t\t\t// TODO docs\r\n\t\t\tthrow new CKEditorError( 'schema-cannot-register-item-twice: A single item cannot be registered twice in the schema.', {\r\n\t\t\t\titemName\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tthis._sourceDefinitions[ itemName ] = [\r\n\t\t\tObject.assign( {}, definition )\r\n\t\t];\r\n\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t * Extends a {@link #register registered} item's definition.\r\n\t *\r\n\t * Extending properties such as `allowIn` will add more items to the existing properties,\r\n\t * while redefining properties such as `isBlock` will override the previously defined ones.\r\n\t *\r\n\t *\t\tschema.register( 'foo', {\r\n\t *\t\t\tallowIn: '$root',\r\n\t *\t\t\tisBlock: true;\r\n\t *\t\t} );\r\n\t *\t\tschema.extend( 'foo', {\r\n\t *\t\t\tallowIn: 'blockQuote',\r\n\t *\t\t\tisBlock: false\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\tschema.getDefinition( 'foo' );\r\n\t *\t\t//\t{\r\n\t *\t\t//\t\tallowIn: [ '$root', 'blockQuote' ],\r\n\t *\t\t// \t\tisBlock: false\r\n\t *\t\t//\t}\r\n\t *\r\n\t * @param {String} itemName\r\n\t * @param {module:engine/model/schema~SchemaItemDefinition} definition\r\n\t */\r\n\textend( itemName, definition ) {\r\n\t\tif ( !this._sourceDefinitions[ itemName ] ) {\r\n\t\t\t// TODO docs\r\n\t\t\tthrow new CKEditorError( 'schema-cannot-extend-missing-item: Cannot extend an item which was not registered yet.', {\r\n\t\t\t\titemName\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tthis._sourceDefinitions[ itemName ].push( Object.assign( {}, definition ) );\r\n\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all registered items.\r\n\t *\r\n\t * @returns {Object.<String,module:engine/model/schema~SchemaCompiledItemDefinition>}\r\n\t */\r\n\tgetDefinitions() {\r\n\t\tif ( !this._compiledDefinitions ) {\r\n\t\t\tthis._compile();\r\n\t\t}\r\n\r\n\t\treturn this._compiledDefinitions;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a definition of the given item or `undefined` if item is not registered.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/schema~SchemaContextItem|String} item\r\n\t * @returns {module:engine/model/schema~SchemaCompiledItemDefinition}\r\n\t */\r\n\tgetDefinition( item ) {\r\n\t\tlet itemName;\r\n\r\n\t\tif ( typeof item == 'string' ) {\r\n\t\t\titemName = item;\r\n\t\t} else if ( item.is && ( item.is( 'text' ) || item.is( 'textProxy' ) ) ) {\r\n\t\t\titemName = '$text';\r\n\t\t}\r\n\t\t// Element or module:engine/model/schema~SchemaContextItem.\r\n\t\telse {\r\n\t\t\titemName = item.name;\r\n\t\t}\r\n\r\n\t\treturn this.getDefinitions()[ itemName ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the given item is registered in the schema.\r\n\t *\r\n\t *\t\tschema.isRegistered( 'paragraph' ); // -> true\r\n\t *\t\tschema.isRegistered( editor.model.document.getRoot() ); // -> true\r\n\t *\t\tschema.isRegistered( 'foo' ); // -> false\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/schema~SchemaContextItem|String} item\r\n\t */\r\n\tisRegistered( item ) {\r\n\t\treturn !!this.getDefinition( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the given item is defined to be\r\n\t * a block by {@link module:engine/model/schema~SchemaItemDefinition}'s `isBlock` property.\r\n\t *\r\n\t *\t\tschema.isBlock( 'paragraph' ); // -> true\r\n\t *\t\tschema.isBlock( '$root' ); // -> false\r\n\t *\r\n\t *\t\tconst paragraphElement = writer.createElement( 'paragraph' );\r\n\t *\t\tschema.isBlock( paragraphElement ); // -> true\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/schema~SchemaContextItem|String} item\r\n\t */\r\n\tisBlock( item ) {\r\n\t\tconst def = this.getDefinition( item );\r\n\r\n\t\treturn !!( def && def.isBlock );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the given item is defined to be\r\n\t * a limit element by {@link module:engine/model/schema~SchemaItemDefinition}'s `isLimit` or `isObject` property\r\n\t * (all objects are also limits).\r\n\t *\r\n\t *\t\tschema.isLimit( 'paragraph' ); // -> false\r\n\t *\t\tschema.isLimit( '$root' ); // -> true\r\n\t *\t\tschema.isLimit( editor.model.document.getRoot() ); // -> true\r\n\t *\t\tschema.isLimit( 'image' ); // -> true\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/schema~SchemaContextItem|String} item\r\n\t */\r\n\tisLimit( item ) {\r\n\t\tconst def = this.getDefinition( item );\r\n\r\n\t\tif ( !def ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !!( def.isLimit || def.isObject );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the given item is defined to be\r\n\t * a object element by {@link module:engine/model/schema~SchemaItemDefinition}'s `isObject` property.\r\n\t *\r\n\t *\t\tschema.isObject( 'paragraph' ); // -> false\r\n\t *\t\tschema.isObject( 'image' ); // -> true\r\n\t *\r\n\t *\t\tconst imageElement = writer.createElement( 'image' );\r\n\t *\t\tschema.isObject( imageElement ); // -> true\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/schema~SchemaContextItem|String} item\r\n\t */\r\n\tisObject( item ) {\r\n\t\tconst def = this.getDefinition( item );\r\n\r\n\t\treturn !!( def && def.isObject );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given node (`child`) can be a child of the given context.\r\n\t *\r\n\t *\t\tschema.checkChild( model.document.getRoot(), paragraph ); // -> false\r\n\t *\r\n\t *\t\tschema.register( 'paragraph', {\r\n\t *\t\t\tallowIn: '$root'\r\n\t *\t\t} );\r\n\t *\t\tschema.checkChild( model.document.getRoot(), paragraph ); // -> true\r\n\t *\r\n\t * Note: When verifying whether the given node can be a child of the given context, the\r\n\t * schema also verifies the entire context &mdash; from its root to its last element. Therefore, it is possible\r\n\t * for `checkChild()` to return `false` even though the context's last element can contain the checked child.\r\n\t * It happens if one of the context's elements does not allow its child.\r\n\t *\r\n\t * @fires checkChild\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} context The context in which the child will be checked.\r\n\t * @param {module:engine/model/node~Node|String} def The child to check.\r\n\t */\r\n\tcheckChild( context, def ) {\r\n\t\t// Note: context and child are already normalized here to a SchemaContext and SchemaCompiledItemDefinition.\r\n\t\tif ( !def ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this._checkContextMatch( def, context );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given attribute can be applied in the given context (on the last\r\n\t * item of the context).\r\n\t *\r\n\t *\t\tschema.checkAttribute( textNode, 'bold' ); // -> false\r\n\t *\r\n\t *\t\tschema.extend( '$text', {\r\n\t *\t\t\tallowAttributes: 'bold'\r\n\t *\t\t} );\r\n\t *\t\tschema.checkAttribute( textNode, 'bold' ); // -> true\r\n\t *\r\n\t * @fires checkAttribute\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} context The context in which the attribute will be checked.\r\n\t * @param {String} attributeName\r\n\t */\r\n\tcheckAttribute( context, attributeName ) {\r\n\t\tconst def = this.getDefinition( context.last );\r\n\r\n\t\tif ( !def ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn def.allowAttributes.includes( attributeName );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given element (`elementToMerge`) can be merged with the specified base element (`positionOrBaseElement`).\r\n\t *\r\n\t * In other words &mdash; whether `elementToMerge`'s children {@link #checkChild are allowed} in the `positionOrBaseElement`.\r\n\t *\r\n\t * This check ensures that elements merged with {@link module:engine/model/writer~Writer#merge `Writer#merge()`}\r\n\t * will be valid.\r\n\t *\r\n\t * Instead of elements, you can pass the instance of the {@link module:engine/model/position~Position} class as the\r\n\t * `positionOrBaseElement`. It means that the elements before and after the position will be checked whether they can be merged.\r\n\t *\r\n\t * @param {module:engine/model/position~Position|module:engine/model/element~Element} positionOrBaseElement The position or base\r\n\t * element to which the `elementToMerge` will be merged.\r\n\t * @param {module:engine/model/element~Element} elementToMerge The element to merge. Required if `positionOrBaseElement` is an element.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tcheckMerge( positionOrBaseElement, elementToMerge = null ) {\r\n\t\tif ( positionOrBaseElement instanceof Position ) {\r\n\t\t\tconst nodeBefore = positionOrBaseElement.nodeBefore;\r\n\t\t\tconst nodeAfter = positionOrBaseElement.nodeAfter;\r\n\r\n\t\t\tif ( !( nodeBefore instanceof Element ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * The node before the merge position must be an element.\r\n\t\t\t\t *\r\n\t\t\t\t * @error schema-check-merge-no-element-before\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'schema-check-merge-no-element-before: The node before the merge position must be an element.' );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !( nodeAfter instanceof Element ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * The node after the merge position must be an element.\r\n\t\t\t\t *\r\n\t\t\t\t * @error schema-check-merge-no-element-after\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError( 'schema-check-merge-no-element-after: The node after the merge position must be an element.' );\r\n\t\t\t}\r\n\r\n\t\t\treturn this.checkMerge( nodeBefore, nodeAfter );\r\n\t\t}\r\n\r\n\t\tfor ( const child of elementToMerge.getChildren() ) {\r\n\t\t\tif ( !this.checkChild( positionOrBaseElement, child ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Allows registering a callback to the {@link #checkChild} method calls.\r\n\t *\r\n\t * Callbacks allow you to implement rules which are not otherwise possible to achieve\r\n\t * by using the declarative API of {@link module:engine/model/schema~SchemaItemDefinition}.\r\n\t * For example, by using this method you can disallow elements in specific contexts.\r\n\t *\r\n\t * This method is a shorthand for using the {@link #event:checkChild} event. For even better control,\r\n\t * you can use that event instead.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t *\t\t// Disallow heading1 directly inside a blockQuote.\r\n\t *\t\tschema.addChildCheck( ( context, childDefinition ) => {\r\n\t *\t\t\tif ( context.endsWith( 'blockQuote' ) && childDefinition.name == 'heading1' ) {\r\n\t *\t\t\t\treturn false;\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * Which translates to:\r\n\t *\r\n\t *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n\t *\t\t\tconst context = args[ 0 ];\r\n\t *\t\t\tconst childDefinition = args[ 1 ];\r\n\t *\r\n\t *\t\t\tif ( context.endsWith( 'blockQuote' ) && childDefinition && childDefinition.name == 'heading1' ) {\r\n\t *\t\t\t\t// Prevent next listeners from being called.\r\n\t *\t\t\t\tevt.stop();\r\n\t *\t\t\t\t// Set the checkChild()'s return value.\r\n\t *\t\t\t\tevt.return = false;\r\n\t *\t\t\t}\r\n\t *\t\t}, { priority: 'high' } );\r\n\t *\r\n\t * @param {Function} callback The callback to be called. It is called with two parameters:\r\n\t * {@link module:engine/model/schema~SchemaContext} (context) instance and\r\n\t * {@link module:engine/model/schema~SchemaCompiledItemDefinition} (child-to-check definition).\r\n\t * The callback may return `true/false` to override `checkChild()`'s return value. If it does not return\r\n\t * a boolean value, the default algorithm (or other callbacks) will define `checkChild()`'s return value.\r\n\t */\r\n\taddChildCheck( callback ) {\r\n\t\tthis.on( 'checkChild', ( evt, [ ctx, childDef ] ) => {\r\n\t\t\t// checkChild() was called with a non-registered child.\r\n\t\t\t// In 99% cases such check should return false, so not to overcomplicate all callbacks\r\n\t\t\t// don't even execute them.\r\n\t\t\tif ( !childDef ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst retValue = callback( ctx, childDef );\r\n\r\n\t\t\tif ( typeof retValue == 'boolean' ) {\r\n\t\t\t\tevt.stop();\r\n\t\t\t\tevt.return = retValue;\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Allows registering a callback to the {@link #checkAttribute} method calls.\r\n\t *\r\n\t * Callbacks allow you to implement rules which are not otherwise possible to achieve\r\n\t * by using the declarative API of {@link module:engine/model/schema~SchemaItemDefinition}.\r\n\t * For example, by using this method you can disallow attribute if node to which it is applied\r\n\t * is contained within some other element (e.g. you want to disallow `bold` on `$text` within `heading1`).\r\n\t *\r\n\t * This method is a shorthand for using the {@link #event:checkAttribute} event. For even better control,\r\n\t * you can use that event instead.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t *\t\t// Disallow bold on $text inside heading1.\r\n\t *\t\tschema.addChildCheck( ( context, attributeName ) => {\r\n\t *\t\t\tif ( context.endsWith( 'heading1 $text' ) && attributeName == 'bold' ) {\r\n\t *\t\t\t\treturn false;\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * Which translates to:\r\n\t *\r\n\t *\t\tschema.on( 'checkAttribute', ( evt, args ) => {\r\n\t *\t\t\tconst context = args[ 0 ];\r\n\t *\t\t\tconst attributeName = args[ 1 ];\r\n\t *\r\n\t *\t\t\tif ( context.endsWith( 'heading1 $text' ) && attributeName == 'bold' ) {\r\n\t *\t\t\t\t// Prevent next listeners from being called.\r\n\t *\t\t\t\tevt.stop();\r\n\t *\t\t\t\t// Set the checkAttribute()'s return value.\r\n\t *\t\t\t\tevt.return = false;\r\n\t *\t\t\t}\r\n\t *\t\t}, { priority: 'high' } );\r\n\t *\r\n\t * @param {Function} callback The callback to be called. It is called with two parameters:\r\n\t * {@link module:engine/model/schema~SchemaContext} (context) instance and attribute name.\r\n\t * The callback may return `true/false` to override `checkAttribute()`'s return value. If it does not return\r\n\t * a boolean value, the default algorithm (or other callbacks) will define `checkAttribute()`'s return value.\r\n\t */\r\n\taddAttributeCheck( callback ) {\r\n\t\tthis.on( 'checkAttribute', ( evt, [ ctx, attributeName ] ) => {\r\n\t\t\tconst retValue = callback( ctx, attributeName );\r\n\r\n\t\t\tif ( typeof retValue == 'boolean' ) {\r\n\t\t\t\tevt.stop();\r\n\t\t\t\tevt.return = retValue;\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the lowest {@link module:engine/model/schema~Schema#isLimit limit element} containing the entire\r\n\t * selection/range/position or the root otherwise.\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/range~Range|module:engine/model/position~Position} selectionOrRangeOrPosition\r\n\t * The selection/range/position to check.\r\n\t * @returns {module:engine/model/element~Element} The lowest limit element containing\r\n\t * the entire `selectionOrRangeOrPosition`.\r\n\t */\r\n\tgetLimitElement( selectionOrRangeOrPosition ) {\r\n\t\tlet element;\r\n\r\n\t\tif ( selectionOrRangeOrPosition instanceof Position ) {\r\n\t\t\telement = selectionOrRangeOrPosition.parent;\r\n\t\t} else {\r\n\t\t\tconst ranges = selectionOrRangeOrPosition instanceof Range ?\r\n\t\t\t\t[ selectionOrRangeOrPosition ] :\r\n\t\t\t\tArray.from( selectionOrRangeOrPosition.getRanges() );\r\n\r\n\t\t\t// Find the common ancestor for all selection's ranges.\r\n\t\t\telement = ranges\r\n\t\t\t\t.reduce( ( element, range ) => {\r\n\t\t\t\t\tconst rangeCommonAncestor = range.getCommonAncestor();\r\n\r\n\t\t\t\t\tif ( !element ) {\r\n\t\t\t\t\t\treturn rangeCommonAncestor;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn element.getCommonAncestor( rangeCommonAncestor, { includeSelf: true } );\r\n\t\t\t\t}, null );\r\n\t\t}\r\n\r\n\t\twhile ( !this.isLimit( element ) ) {\r\n\t\t\tif ( element.parent ) {\r\n\t\t\t\telement = element.parent;\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the attribute is allowed in selection:\r\n\t *\r\n\t * * if the selection is not collapsed, then checks if the attribute is allowed on any of nodes in that range,\r\n\t * * if the selection is collapsed, then checks if on the selection position there's a text with the\r\n\t * specified attribute allowed.\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n\t * Selection which will be checked.\r\n\t * @param {String} attribute The name of the attribute to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\tcheckAttributeInSelection( selection, attribute ) {\r\n\t\tif ( selection.isCollapsed ) {\r\n\t\t\tconst firstPosition = selection.getFirstPosition();\r\n\t\t\tconst context = [\r\n\t\t\t\t...firstPosition.getAncestors(),\r\n\t\t\t\tnew Text( '', selection.getAttributes() )\r\n\t\t\t];\r\n\r\n\t\t\t// Check whether schema allows for a text with the attribute in the selection.\r\n\t\t\treturn this.checkAttribute( context, attribute );\r\n\t\t} else {\r\n\t\t\tconst ranges = selection.getRanges();\r\n\r\n\t\t\t// For all ranges, check nodes in them until you find a node that is allowed to have the attribute.\r\n\t\t\tfor ( const range of ranges ) {\r\n\t\t\t\tfor ( const value of range ) {\r\n\t\t\t\t\tif ( this.checkAttribute( value.item, attribute ) ) {\r\n\t\t\t\t\t\t// If we found a node that is allowed to have the attribute, return true.\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If we haven't found such node, return false.\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Transforms the given set of ranges into a set of ranges where the given attribute is allowed (and can be applied).\r\n\t *\r\n\t * @param {Array.<module:engine/model/range~Range>} ranges Ranges to be validated.\r\n\t * @param {String} attribute The name of the attribute to check.\r\n\t * @returns {Iterator.<module:engine/model/range~Range>} Ranges in which the attribute is allowed.\r\n\t */\r\n\t* getValidRanges( ranges, attribute ) {\r\n\t\tranges = convertToMinimalFlatRanges( ranges );\r\n\r\n\t\tfor ( const range of ranges ) {\r\n\t\t\tyield* this._getValidRangesForRange( range, attribute );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Takes a flat range and an attribute name. Traverses the range recursively and deeply to find and return all ranges\r\n\t * inside the given range on which the attribute can be applied.\r\n\t *\r\n\t * This is a helper function for {@link ~Schema#getValidRanges}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/range~Range} range Range to process.\r\n\t * @param {String} attribute The name of the attribute to check.\r\n\t * @returns {Iterator.<module:engine/model/range~Range>} Ranges in which the attribute is allowed.\r\n\t */\r\n\t* _getValidRangesForRange( range, attribute ) {\r\n\t\tlet start = range.start;\r\n\t\tlet end = range.start;\r\n\r\n\t\tfor ( const item of range.getItems( { shallow: true } ) ) {\r\n\t\t\tif ( item.is( 'element' ) ) {\r\n\t\t\t\tyield* this._getValidRangesForRange( Range._createIn( item ), attribute );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !this.checkAttribute( item, attribute ) ) {\r\n\t\t\t\tif ( !start.isEqual( end ) ) {\r\n\t\t\t\t\tyield new Range( start, end );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstart = Position._createAfter( item );\r\n\t\t\t}\r\n\r\n\t\t\tend = Position._createAfter( item );\r\n\t\t}\r\n\r\n\t\tif ( !start.isEqual( end ) ) {\r\n\t\t\tyield new Range( start, end );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Basing on given `position`, finds and returns a {@link module:engine/model/range~Range range} which is\r\n\t * nearest to that `position` and is a correct range for selection.\r\n\t *\r\n\t * The correct selection range might be collapsed when it is located in a position where the text node can be placed.\r\n\t * Non-collapsed range is returned when selection can be placed around element marked as an \"object\" in\r\n\t * the {@link module:engine/model/schema~Schema schema}.\r\n\t *\r\n\t * Direction of searching for the nearest correct selection range can be specified as:\r\n\t *\r\n\t * * `both` - searching will be performed in both ways,\r\n\t * * `forward` - searching will be performed only forward,\r\n\t * * `backward` - searching will be performed only backward.\r\n\t *\r\n\t * When valid selection range cannot be found, `null` is returned.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Reference position where new selection range should be looked for.\r\n\t * @param {'both'|'forward'|'backward'} [direction='both'] Search direction.\r\n\t * @returns {module:engine/model/range~Range|null} Nearest selection range or `null` if one cannot be found.\r\n\t */\r\n\tgetNearestSelectionRange( position, direction = 'both' ) {\r\n\t\t// Return collapsed range if provided position is valid.\r\n\t\tif ( this.checkChild( position, '$text' ) ) {\r\n\t\t\treturn new Range( position );\r\n\t\t}\r\n\r\n\t\tlet backwardWalker, forwardWalker;\r\n\r\n\t\tif ( direction == 'both' || direction == 'backward' ) {\r\n\t\t\tbackwardWalker = new TreeWalker( { startPosition: position, direction: 'backward' } );\r\n\t\t}\r\n\r\n\t\tif ( direction == 'both' || direction == 'forward' ) {\r\n\t\t\tforwardWalker = new TreeWalker( { startPosition: position } );\r\n\t\t}\r\n\r\n\t\tfor ( const data of combineWalkers( backwardWalker, forwardWalker ) ) {\r\n\t\t\tconst type = ( data.walker == backwardWalker ? 'elementEnd' : 'elementStart' );\r\n\t\t\tconst value = data.value;\r\n\r\n\t\t\tif ( value.type == type && this.isObject( value.item ) ) {\r\n\t\t\t\treturn Range._createOn( value.item );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.checkChild( value.nextPosition, '$text' ) ) {\r\n\t\t\t\treturn new Range( value.nextPosition );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to find position ancestors that allows to insert given node.\r\n\t * It starts searching from the given position and goes node by node to the top of the model tree\r\n\t * as long as {@link module:engine/model/schema~Schema#isLimit limit element},\r\n\t * {@link module:engine/model/schema~Schema#isObject object element} or top-most ancestor won't be reached.\r\n\t *\r\n\t * @params {module:engine/model/node~Node} node Node for which allowed parent should be found.\r\n\t * @params {module:engine/model/position~Position} position Position from searching will start.\r\n\t * @returns {module:engine/model/element~Element|null} element Allowed parent or null if nothing was found.\r\n\t */\r\n\tfindAllowedParent( node, position ) {\r\n\t\tlet parent = position.parent;\r\n\r\n\t\twhile ( parent ) {\r\n\t\t\tif ( this.checkChild( parent, node ) ) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\r\n\t\t\t// Do not split limit elements.\r\n\t\t\tif ( this.isLimit( parent ) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes attributes disallowed by the schema.\r\n\t *\r\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes that will be filtered.\r\n\t * @param {module:engine/model/writer~Writer} writer\r\n\t */\r\n\tremoveDisallowedAttributes( nodes, writer ) {\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\tfor ( const attribute of node.getAttributeKeys() ) {\r\n\t\t\t\tif ( !this.checkAttribute( node, attribute ) ) {\r\n\t\t\t\t\twriter.removeAttribute( attribute, node );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( node.is( 'element' ) ) {\r\n\t\t\t\tthis.removeDisallowedAttributes( node.getChildren(), writer );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an instance of the schema context.\r\n\t *\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} context\r\n\t * @returns {module:engine/model/schema~SchemaContext}\r\n\t */\r\n\tcreateContext( context ) {\r\n\t\treturn new SchemaContext( context );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_clearCache() {\r\n\t\tthis._compiledDefinitions = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_compile() {\r\n\t\tconst compiledDefinitions = {};\r\n\t\tconst sourceRules = this._sourceDefinitions;\r\n\t\tconst itemNames = Object.keys( sourceRules );\r\n\r\n\t\tfor ( const itemName of itemNames ) {\r\n\t\t\tcompiledDefinitions[ itemName ] = compileBaseItemRule( sourceRules[ itemName ], itemName );\r\n\t\t}\r\n\r\n\t\tfor ( const itemName of itemNames ) {\r\n\t\t\tcompileAllowContentOf( compiledDefinitions, itemName );\r\n\t\t}\r\n\r\n\t\tfor ( const itemName of itemNames ) {\r\n\t\t\tcompileAllowWhere( compiledDefinitions, itemName );\r\n\t\t}\r\n\r\n\t\tfor ( const itemName of itemNames ) {\r\n\t\t\tcompileAllowAttributesOf( compiledDefinitions, itemName );\r\n\t\t\tcompileInheritPropertiesFrom( compiledDefinitions, itemName );\r\n\t\t}\r\n\r\n\t\tfor ( const itemName of itemNames ) {\r\n\t\t\tcleanUpAllowIn( compiledDefinitions, itemName );\r\n\t\t\tcleanUpAllowAttributes( compiledDefinitions, itemName );\r\n\t\t}\r\n\r\n\t\tthis._compiledDefinitions = compiledDefinitions;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/schema~SchemaCompiledItemDefinition} def\r\n\t * @param {module:engine/model/schema~SchemaContext} context\r\n\t * @param {Number} contextItemIndex\r\n\t */\r\n\t_checkContextMatch( def, context, contextItemIndex = context.length - 1 ) {\r\n\t\tconst contextItem = context.getItem( contextItemIndex );\r\n\r\n\t\tif ( def.allowIn.includes( contextItem.name ) ) {\r\n\t\t\tif ( contextItemIndex == 0 ) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tconst parentRule = this.getDefinition( contextItem );\r\n\r\n\t\t\t\treturn this._checkContextMatch( parentRule, context, contextItemIndex - 1 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmix( Schema, ObservableMixin );\r\n\r\n/**\r\n * Event fired when the {@link #checkChild} method is called. It allows plugging in\r\n * additional behavior – e.g. implementing rules which cannot be defined using the declarative\r\n * {@link module:engine/model/schema~SchemaItemDefinition} interface.\r\n *\r\n * **Note:** The {@link #addChildCheck} method is a more handy way to register callbacks. Internally,\r\n * it registers a listener to this event but comes with a simpler API and it is the recommended choice\r\n * in most of the cases.\r\n *\r\n * The {@link #checkChild} method fires an event because it is\r\n * {@link module:utils/observablemixin~ObservableMixin#decorate decorated} with it. Thanks to that you can\r\n * use this event in a various way, but the most important use case is overriding standard behaviour of the\r\n * `checkChild()` method. Let's see a typical listener template:\r\n *\r\n *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst childDefinition = args[ 1 ];\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * The listener is added with a `high` priority to be executed before the default method is really called. The `args` callback\r\n * parameter contains arguments passed to `checkChild( context, child )`. However, the `context` parameter is already\r\n * normalized to a {@link module:engine/model/schema~SchemaContext} instance and `child` to a\r\n * {@link module:engine/model/schema~SchemaCompiledItemDefinition} instance, so you don't have to worry about\r\n * the various ways how `context` and `child` may be passed to `checkChild()`.\r\n *\r\n * **Note:** `childDefinition` may be `undefined` if `checkChild()` was called with a non-registered element.\r\n *\r\n * So, in order to implement a rule \"disallow `heading1` in `blockQuote`\" you can add such a listener:\r\n *\r\n *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst childDefinition = args[ 1 ];\r\n *\r\n *\t\t\tif ( context.endsWith( 'blockQuote' ) && childDefinition && childDefinition.name == 'heading1' ) {\r\n *\t\t\t\t// Prevent next listeners from being called.\r\n *\t\t\t\tevt.stop();\r\n *\t\t\t\t// Set the checkChild()'s return value.\r\n *\t\t\t\tevt.return = false;\r\n *\t\t\t}\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * Allowing elements in specific contexts will be a far less common use case, because it's normally handled by\r\n * `allowIn` rule from {@link module:engine/model/schema~SchemaItemDefinition} but if you have a complex scenario\r\n * where `listItem` should be allowed only in element `foo` which must be in element `bar`, then this would be the way:\r\n *\r\n *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst childDefinition = args[ 1 ];\r\n *\r\n *\t\t\tif ( context.endsWith( 'bar foo' ) && childDefinition.name == 'listItem' ) {\r\n *\t\t\t\t// Prevent next listeners from being called.\r\n *\t\t\t\tevt.stop();\r\n *\t\t\t\t// Set the checkChild()'s return value.\r\n *\t\t\t\tevt.return = true;\r\n *\t\t\t}\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * @event checkChild\r\n * @param {Array} args The `checkChild()`'s arguments.\r\n */\r\n\r\n/**\r\n * Event fired when the {@link #checkAttribute} method is called. It allows plugging in\r\n * additional behavior – e.g. implementing rules which cannot be defined using the declarative\r\n * {@link module:engine/model/schema~SchemaItemDefinition} interface.\r\n *\r\n * **Note:** The {@link #addAttributeCheck} method is a more handy way to register callbacks. Internally,\r\n * it registers a listener to this event but comes with a simpler API and it is the recommended choice\r\n * in most of the cases.\r\n *\r\n * The {@link #checkAttribute} method fires an event because it's\r\n * {@link module:utils/observablemixin~ObservableMixin#decorate decorated} with it. Thanks to that you can\r\n * use this event in a various way, but the most important use case is overriding standard behaviour of the\r\n * `checkAttribute()` method. Let's see a typical listener template:\r\n *\r\n *\t\tschema.on( 'checkAttribute', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst attributeName = args[ 1 ];\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * The listener is added with a `high` priority to be executed before the default method is really called. The `args` callback\r\n * parameter contains arguments passed to `checkAttribute( context, attributeName )`. However, the `context` parameter is already\r\n * normalized to a {@link module:engine/model/schema~SchemaContext} instance, so you don't have to worry about\r\n * the various ways how `context` may be passed to `checkAttribute()`.\r\n *\r\n * So, in order to implement a rule \"disallow `bold` in a text which is in a `heading1` you can add such a listener:\r\n *\r\n *\t\tschema.on( 'checkAttribute', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst atributeName = args[ 1 ];\r\n *\r\n *\t\t\tif ( context.endsWith( 'heading1 $text' ) && attributeName == 'bold' ) {\r\n *\t\t\t\t// Prevent next listeners from being called.\r\n *\t\t\t\tevt.stop();\r\n *\t\t\t\t// Set the checkAttribute()'s return value.\r\n *\t\t\t\tevt.return = false;\r\n *\t\t\t}\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * Allowing attributes in specific contexts will be a far less common use case, because it's normally handled by\r\n * `allowAttributes` rule from {@link module:engine/model/schema~SchemaItemDefinition} but if you have a complex scenario\r\n * where `bold` should be allowed only in element `foo` which must be in element `bar`, then this would be the way:\r\n *\r\n *\t\tschema.on( 'checkAttribute', ( evt, args ) => {\r\n *\t\t\tconst context = args[ 0 ];\r\n *\t\t\tconst atributeName = args[ 1 ];\r\n *\r\n *\t\t\tif ( context.endsWith( 'bar foo $text' ) && attributeName == 'bold' ) {\r\n *\t\t\t\t// Prevent next listeners from being called.\r\n *\t\t\t\tevt.stop();\r\n *\t\t\t\t// Set the checkAttribute()'s return value.\r\n *\t\t\t\tevt.return = true;\r\n *\t\t\t}\r\n *\t\t}, { priority: 'high' } );\r\n *\r\n * @event checkAttribute\r\n * @param {Array} args The `checkAttribute()`'s arguments.\r\n */\r\n\r\n/**\r\n * A definition of a {@link module:engine/model/schema~Schema schema} item.\r\n *\r\n * You can define the following rules:\r\n *\r\n * * `allowIn` &ndash; A string or an array of strings. Defines in which other items this item will be allowed.\r\n * * `allowAttributes` &ndash; A string or an array of strings. Defines allowed attributes of the given item.\r\n * * `allowContentOf` &ndash; A string or an array of strings. Inherits \"allowed children\" from other items.\r\n * * `allowWhere` &ndash; A string or an array of strings. Inherits \"allowed in\" from other items.\r\n * * `allowAttributesOf` &ndash; A string or an array of strings. Inherits attributes from other items.\r\n * * `inheritTypesFrom` &ndash; A string or an array of strings. Inherits `is*` properties of other items.\r\n * * `inheritAllFrom` &ndash; A string. A shorthand for `allowContentOf`, `allowWhere`, `allowAttributesOf`, `inheritTypesFrom`.\r\n * * Additionally, you can define the following `is*` properties: `isBlock`, `isLimit`, `isObject`. Read about them below.\r\n *\r\n * # The is* properties\r\n *\r\n * There are 3 commonly used `is*` properties. Their role is to assign additional semantics to schema items.\r\n * You can define more properties but you will also need to implement support for them in the existing editor features.\r\n *\r\n * * `isBlock` &ndash; Whether this item is paragraph-like. Generally speaking, content is usually made out of blocks\r\n * like paragraphs, list items, images, headings, etc. All these elements are marked as blocks. A block\r\n * should not allow another block inside. Note: There is also the `$block` generic item which has `isBlock` set to `true`.\r\n * Most block type items will inherit from `$block` (through `inheritAllFrom`).\r\n * * `isLimit` &ndash; It can be understood as whether this element should not be split by <kbd>Enter</kbd>.\r\n * Examples of limit elements: `$root`, table cell, image caption, etc. In other words, all actions that happen inside\r\n * a limit element are limited to its content. **Note:** All objects (`isObject`) are treated as limit elements, too.\r\n * * `isObject` &ndash; Whether an item is \"self-contained\" and should be treated as a whole. Examples of object elements:\r\n * `image`, `table`, `video`, etc. **Note:** An object is also a limit, so\r\n * {@link module:engine/model/schema~Schema#isLimit `isLimit()`}\r\n * returns `true` for object elements automatically.\r\n *\r\n * # Generic items\r\n *\r\n * There are three basic generic items: `$root`, `$block` and `$text`.\r\n * They are defined as follows:\r\n *\r\n *\t\tthis.schema.register( '$root', {\r\n *\t\t\tisLimit: true\r\n *\t\t} );\r\n *\t\tthis.schema.register( '$block', {\r\n *\t\t\tallowIn: '$root',\r\n *\t\t\tisBlock: true\r\n *\t\t} );\r\n *\t\tthis.schema.register( '$text', {\r\n *\t\t\tallowIn: '$block'\r\n *\t\t} );\r\n *\r\n * They reflect typical editor content that is contained within one root, consists of several blocks\r\n * (paragraphs, lists items, headings, images) which, in turn, may contain text inside.\r\n *\r\n * By inheriting from the generic items you can define new items which will get extended by other editor features.\r\n * Read more about generic types in the {@linkTODO Defining schema} guide.\r\n *\r\n * # Example definitions\r\n *\r\n * Allow `paragraph` in roots and block quotes:\r\n *\r\n *\t\tschema.register( 'paragraph', {\r\n *\t\t\tallowIn: [ '$root', 'blockQuote' ],\r\n *\t\t\tisBlock: true\r\n *\t\t} );\r\n *\r\n * Allow `paragraph` everywhere where `$block` is allowed (i.e. in `$root`):\r\n *\r\n *\t\tschema.register( 'paragraph', {\r\n *\t\t\tallowWhere: '$block',\r\n *\t\t\tisBlock: true\r\n *\t\t} );\r\n *\r\n * Make `image` a block object, which is allowed everywhere where `$block` is.\r\n * Also, allow `src` and `alt` attributes in it:\r\n *\r\n *\t\tschema.register( 'image', {\r\n *\t\t\tallowWhere: '$block',\r\n *\t\t\tallowAttributes: [ 'src', 'alt' ],\r\n *\t\t\tisBlock: true,\r\n *\t\t\tisObject: true\r\n *\t\t} );\r\n *\r\n * Make `caption` allowed in `image` and make it allow all the content of `$block`s (usually, `$text`).\r\n * Also, mark it as a limit element so it cannot be split:\r\n *\r\n *\t\tschema.register( 'caption', {\r\n *\t\t\tallowIn: 'image',\r\n *\t\t\tallowContentOf: '$block',\r\n *\t\t\tisLimit: true\r\n *\t\t} );\r\n *\r\n * Make `listItem` inherit all from `$block` but also allow additional attributes:\r\n *\r\n *\t\tschema.register( 'listItem', {\r\n *\t\t\tinheritAllFrom: '$block',\r\n *\t\t\tallowAttributes: [ 'listType', 'listIndent' ]\r\n *\t\t} );\r\n *\r\n * Which translates to:\r\n *\r\n *\t\tschema.register( 'listItem', {\r\n *\t\t\tallowWhere: '$block',\r\n *\t\t\tallowContentOf: '$block',\r\n *\t\t\tallowAttributesOf: '$block',\r\n *\t\t\tinheritTypesFrom: '$block',\r\n *\t\t\tallowAttributes: [ 'listType', 'listIndent' ]\r\n *\t\t} );\r\n *\r\n * # Tips\r\n *\r\n * * Check schema definitions of existing features to see how they are defined.\r\n * * If you want to publish your feature so other developers can use it, try to use\r\n * generic items as much as possible.\r\n * * Keep your model clean. Limit it to the actual data and store information in a normalized way.\r\n * * Remember about definining the `is*` properties. They do not affect the allowed structures, but they can\r\n * affect how the editor features treat your elements.\r\n *\r\n * @typedef {Object} module:engine/model/schema~SchemaItemDefinition\r\n */\r\n\r\n/**\r\n * A simplified version of {@link module:engine/model/schema~SchemaItemDefinition} after\r\n * compilation by the {@link module:engine/model/schema~Schema schema}.\r\n * Rules fed to the schema by {@link module:engine/model/schema~Schema#register}\r\n * and {@link module:engine/model/schema~Schema#extend} methods are defined in the\r\n * {@link module:engine/model/schema~SchemaItemDefinition} format.\r\n * Later on, they are compiled to `SchemaCompiledItemDefition` so when you use e.g.\r\n * the {@link module:engine/model/schema~Schema#getDefinition} method you get the compiled version.\r\n *\r\n * The compiled version contains only the following properties:\r\n *\r\n * * The `name` property,\r\n * * The `is*` properties,\r\n * * The `allowIn` array,\r\n * * The `allowAttributes` array.\r\n *\r\n * @typedef {Object} module:engine/model/schema~SchemaCompiledItemDefinition\r\n */\r\n\r\n/**\r\n * A schema context &mdash; a list of ancestors of a given position in the document.\r\n *\r\n * Considering such position:\r\n *\r\n *\t\t<$root>\r\n *\t\t\t<blockQuote>\r\n *\t\t\t\t<paragraph>\r\n *\t\t\t\t\t^\r\n *\t\t\t\t</paragraph>\r\n *\t\t\t</blockQuote>\r\n *\t\t</$root>\r\n *\r\n * The context of this position is its {@link module:engine/model/position~Position#getAncestors lists of ancestors}:\r\n *\r\n *\t\t[ rootElement, blockQuoteElement, paragraphElement ]\r\n *\r\n * Contexts are used in the {@link module:engine/model/schema~Schema#event:checkChild `Schema#checkChild`} and\r\n * {@link module:engine/model/schema~Schema#event:checkAttribute `Schema#checkAttribute`} events as a definition\r\n * of a place in the document where the check occurs. The context instances are created based on the first arguments\r\n * of the {@link module:engine/model/schema~Schema#checkChild `Schema#checkChild()`} and\r\n * {@link module:engine/model/schema~Schema#checkAttribute `Schema#checkAttribute()`} methods so when\r\n * using these methods you need to use {@link module:engine/model/schema~SchemaContextDefinition}s.\r\n */\r\nexport class SchemaContext {\r\n\t/**\r\n\t * Creates an instance of the context.\r\n\t *\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} context\r\n\t */\r\n\tconstructor( context ) {\r\n\t\tif ( context instanceof SchemaContext ) {\r\n\t\t\treturn context;\r\n\t\t}\r\n\r\n\t\tif ( typeof context == 'string' ) {\r\n\t\t\tcontext = [ context ];\r\n\t\t} else if ( !Array.isArray( context ) ) {\r\n\t\t\t// `context` is item or position.\r\n\t\t\t// Position#getAncestors() doesn't accept any parameters but it works just fine here.\r\n\t\t\tcontext = context.getAncestors( { includeSelf: true } );\r\n\t\t}\r\n\r\n\t\tif ( context[ 0 ] && typeof context[ 0 ] != 'string' && context[ 0 ].is( 'documentFragment' ) ) {\r\n\t\t\tcontext.shift();\r\n\t\t}\r\n\r\n\t\tthis._items = context.map( mapContextItem );\r\n\t}\r\n\r\n\t/**\r\n\t * The number of items.\r\n\t *\r\n\t * @type {Number}\r\n\t */\r\n\tget length() {\r\n\t\treturn this._items.length;\r\n\t}\r\n\r\n\t/**\r\n\t * The last item (the lowest node).\r\n\t *\r\n\t * @type {module:engine/model/schema~SchemaContextItem}\r\n\t */\r\n\tget last() {\r\n\t\treturn this._items[ this._items.length - 1 ];\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over all context items.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/schema~SchemaContextItem>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._items[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new schema context instance with an additional item.\r\n\t *\r\n\t * Item can be added as:\r\n\t *\r\n\t * \t\tconst context = new SchemaContext( [ '$root' ] );\r\n\t *\r\n\t * \t\t// An element.\r\n\t * \t\tconst fooElement = writer.createElement( 'fooElement' );\r\n\t * \t\tconst newContext = context.push( fooElement ); // [ '$root', 'fooElement' ]\r\n\t *\r\n\t * \t\t// A text node.\r\n\t * \t\tconst text = writer.createText( 'foobar' );\r\n\t * \t\tconst newContext = context.push( text ); // [ '$root', '$text' ]\r\n\t *\r\n\t * \t\t// A string (element name).\r\n\t * \t\tconst newContext = context.push( 'barElement' ); // [ '$root', 'barElement' ]\r\n\t *\r\n\t * **Note** {@link module:engine/model/node~Node} that is already in the model tree will be added as the only item\r\n\t * (without ancestors).\r\n\t *\r\n\t * @param {String|module:engine/model/node~Node|Array<String|module:engine/model/node~Node>} item An item that will be added\r\n\t * to the current context.\r\n\t * @returns {module:engine/model/schema~SchemaContext} A new schema context instance with an additional item.\r\n\t */\r\n\tpush( item ) {\r\n\t\tconst ctx = new SchemaContext( [ item ] );\r\n\r\n\t\tctx._items = [ ...this._items, ...ctx._items ];\r\n\r\n\t\treturn ctx;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an item on the given index.\r\n\t *\r\n\t * @returns {module:engine/model/schema~SchemaContextItem}\r\n\t */\r\n\tgetItem( index ) {\r\n\t\treturn this._items[ index ];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the names of items.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\t* getNames() {\r\n\t\tyield* this._items.map( item => item.name );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the context ends with the given nodes.\r\n\t *\r\n\t *\t\tconst ctx = new SchemaContext( [ rootElement, paragraphElement, textNode ] );\r\n\t *\r\n\t *\t\tctx.endsWith( '$text' ); // -> true\r\n\t *\t\tctx.endsWith( 'paragraph $text' ); // -> true\r\n\t *\t\tctx.endsWith( '$root' ); // -> false\r\n\t *\t\tctx.endsWith( 'paragraph' ); // -> false\r\n\t *\r\n\t * @param {String} query\r\n\t * @returns {Boolean}\r\n\t */\r\n\tendsWith( query ) {\r\n\t\treturn Array.from( this.getNames() ).join( ' ' ).endsWith( query );\r\n\t}\r\n}\r\n\r\n/**\r\n * The definition of a {@link module:engine/model/schema~SchemaContext schema context}.\r\n *\r\n * Contexts can be created in multiple ways:\r\n *\r\n * * By defining a **node** – in this cases this node and all its ancestors will be used.\r\n * * By defining a **position** in the document – in this case all its ancestors will be used.\r\n * * By defining an **array of nodes** – in this case this array defines the entire context.\r\n * * By defining a **name of node** - in this case node will be \"mocked\". It is not recommended because context\r\n * will be unrealistic (e.g. attributes of these nodes are not specified). However, at times this may be the only\r\n * way to define the context (e.g. when checking some hypothetical situation).\r\n * * By defining an **array of node names** (potentially, mixed with real nodes) – The same as **name of node**\r\n * but it is possible to create a path.\r\n * * By defining a {@link module:engine/model/schema~SchemaContext} instance - in this case the same instance as provided\r\n * will be return.\r\n *\r\n * Examples of context definitions passed to the {@link module:engine/model/schema~Schema#checkChild `Schema#checkChild()`}\r\n * method:\r\n *\r\n *\t\t// Assuming that we have a $root > blockQuote > paragraph structure, the following code\r\n *\t\t// will check node 'foo' in the following context:\r\n *\t\t// [ rootElement, blockQuoteElement, paragraphElement ]\r\n *\t\tconst contextDefinition = paragraphElement;\r\n * \t\tconst childToCheck = 'foo';\r\n *\t\tschema.checkChild( contextDefinition, childToCheck );\r\n *\r\n *\t\t// Also check in [ rootElement, blockQuoteElement, paragraphElement ].\r\n *\t\tschema.checkChild( model.createPositionAt( paragraphElement, 0 ), 'foo' );\r\n *\r\n *\t\t// Check in [ rootElement, paragraphElement ].\r\n *\t\tschema.checkChild( [ rootElement, paragraphElement ], 'foo' );\r\n *\r\n *\t\t// Check only fakeParagraphElement.\r\n *\t\tschema.checkChild( 'paragraph', 'foo' );\r\n *\r\n *\t\t// Check in [ fakeRootElement, fakeBarElement, paragraphElement ].\r\n *\t\tschema.checkChild( [ '$root', 'bar', paragraphElement ], 'foo' );\r\n *\r\n * All these `checkChild()` calls will fire {@link module:engine/model/schema~Schema#event:checkChild `Schema#checkChild`}\r\n * events in which `args[ 0 ]` is an instance of the context. Therefore, you can write a listener like this:\r\n *\r\n *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n *\t\t\tconst ctx = args[ 0 ];\r\n *\r\n *\t\t\tconsole.log( Array.from( ctx.getNames() ) );\r\n *\t\t} );\r\n *\r\n * Which will log the following:\r\n *\r\n *\t\t[ '$root', 'blockQuote', 'paragraph' ]\r\n *\t\t[ '$root', 'paragraph' ]\r\n *\t\t[ '$root', 'bar', 'paragraph' ]\r\n *\r\n * Note: When using the {@link module:engine/model/schema~Schema#checkAttribute `Schema#checkAttribute()`} method\r\n * you may want to check whether a text node may have an attribute. A {@link module:engine/model/text~Text} is a\r\n * correct way to define a context so you can do this:\r\n *\r\n *\t\tschema.checkAttribute( textNode, 'bold' );\r\n *\r\n * But sometimes you want to check whether a text at a given position might've had some attribute,\r\n * in which case you can create a context by mising an array of elements with a `'$text'` string:\r\n *\r\n *\t\t// Check in [ rootElement, paragraphElement, textNode ].\r\n *\t\tschema.checkChild( [ ...positionInParagraph.getAncestors(), '$text' ], 'bold' );\r\n *\r\n * @typedef {module:engine/model/node~Node|module:engine/model/position~Position|module:engine/model/schema~SchemaContext|\r\n * String|Array.<String|module:engine/model/node~Node>} module:engine/model/schema~SchemaContextDefinition\r\n */\r\n\r\n/**\r\n * An item of the {@link module:engine/model/schema~SchemaContext schema context}.\r\n *\r\n * It contains 3 properties:\r\n *\r\n * * `name` – the name of this item,\r\n * * `* getAttributeKeys()` – a generator of keys of item attributes,\r\n * * `getAttribute( keyName )` – a method to get attribute values.\r\n *\r\n * The context item interface is a highly simplified version of {@link module:engine/model/node~Node} and its role\r\n * is to expose only the information which schema checks are able to provide (which is the name of the node and\r\n * node's attributes).\r\n *\r\n *\t\tschema.on( 'checkChild', ( evt, args ) => {\r\n *\t\t\tconst ctx = args[ 0 ];\r\n *\t\t\tconst firstItem = ctx.getItem( 0 );\r\n *\r\n *\t\t\tconsole.log( firstItem.name ); // -> '$root'\r\n *\t\t\tconsole.log( firstItem.getAttribute( 'foo' ) ); // -> 'bar'\r\n *\t\t\tconsole.log( Array.from( firstItem.getAttributeKeys() ) ); // -> [ 'foo', 'faa' ]\r\n *\t\t} );\r\n *\r\n * @typedef {Object} module:engine/model/schema~SchemaContextItem\r\n */\r\n\r\nfunction compileBaseItemRule( sourceItemRules, itemName ) {\r\n\tconst itemRule = {\r\n\t\tname: itemName,\r\n\r\n\t\tallowIn: [],\r\n\t\tallowContentOf: [],\r\n\t\tallowWhere: [],\r\n\r\n\t\tallowAttributes: [],\r\n\t\tallowAttributesOf: [],\r\n\r\n\t\tinheritTypesFrom: []\r\n\t};\r\n\r\n\tcopyTypes( sourceItemRules, itemRule );\r\n\r\n\tcopyProperty( sourceItemRules, itemRule, 'allowIn' );\r\n\tcopyProperty( sourceItemRules, itemRule, 'allowContentOf' );\r\n\tcopyProperty( sourceItemRules, itemRule, 'allowWhere' );\r\n\r\n\tcopyProperty( sourceItemRules, itemRule, 'allowAttributes' );\r\n\tcopyProperty( sourceItemRules, itemRule, 'allowAttributesOf' );\r\n\r\n\tcopyProperty( sourceItemRules, itemRule, 'inheritTypesFrom' );\r\n\r\n\tmakeInheritAllWork( sourceItemRules, itemRule );\r\n\r\n\treturn itemRule;\r\n}\r\n\r\nfunction compileAllowContentOf( compiledDefinitions, itemName ) {\r\n\tfor ( const allowContentOfItemName of compiledDefinitions[ itemName ].allowContentOf ) {\r\n\t\t// The allowContentOf property may point to an unregistered element.\r\n\t\tif ( compiledDefinitions[ allowContentOfItemName ] ) {\r\n\t\t\tconst allowedChildren = getAllowedChildren( compiledDefinitions, allowContentOfItemName );\r\n\r\n\t\t\tallowedChildren.forEach( allowedItem => {\r\n\t\t\t\tallowedItem.allowIn.push( itemName );\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\tdelete compiledDefinitions[ itemName ].allowContentOf;\r\n}\r\n\r\nfunction compileAllowWhere( compiledDefinitions, itemName ) {\r\n\tfor ( const allowWhereItemName of compiledDefinitions[ itemName ].allowWhere ) {\r\n\t\tconst inheritFrom = compiledDefinitions[ allowWhereItemName ];\r\n\r\n\t\t// The allowWhere property may point to an unregistered element.\r\n\t\tif ( inheritFrom ) {\r\n\t\t\tconst allowedIn = inheritFrom.allowIn;\r\n\r\n\t\t\tcompiledDefinitions[ itemName ].allowIn.push( ...allowedIn );\r\n\t\t}\r\n\t}\r\n\r\n\tdelete compiledDefinitions[ itemName ].allowWhere;\r\n}\r\n\r\nfunction compileAllowAttributesOf( compiledDefinitions, itemName ) {\r\n\tfor ( const allowAttributeOfItem of compiledDefinitions[ itemName ].allowAttributesOf ) {\r\n\t\tconst inheritFrom = compiledDefinitions[ allowAttributeOfItem ];\r\n\r\n\t\tif ( inheritFrom ) {\r\n\t\t\tconst inheritAttributes = inheritFrom.allowAttributes;\r\n\r\n\t\t\tcompiledDefinitions[ itemName ].allowAttributes.push( ...inheritAttributes );\r\n\t\t}\r\n\t}\r\n\r\n\tdelete compiledDefinitions[ itemName ].allowAttributesOf;\r\n}\r\n\r\nfunction compileInheritPropertiesFrom( compiledDefinitions, itemName ) {\r\n\tconst item = compiledDefinitions[ itemName ];\r\n\r\n\tfor ( const inheritPropertiesOfItem of item.inheritTypesFrom ) {\r\n\t\tconst inheritFrom = compiledDefinitions[ inheritPropertiesOfItem ];\r\n\r\n\t\tif ( inheritFrom ) {\r\n\t\t\tconst typeNames = Object.keys( inheritFrom ).filter( name => name.startsWith( 'is' ) );\r\n\r\n\t\t\tfor ( const name of typeNames ) {\r\n\t\t\t\tif ( !( name in item ) ) {\r\n\t\t\t\t\titem[ name ] = inheritFrom[ name ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdelete item.inheritTypesFrom;\r\n}\r\n\r\n// Remove items which weren't registered (because it may break some checks or we'd need to complicate them).\r\n// Make sure allowIn doesn't contain repeated values.\r\nfunction cleanUpAllowIn( compiledDefinitions, itemName ) {\r\n\tconst itemRule = compiledDefinitions[ itemName ];\r\n\tconst existingItems = itemRule.allowIn.filter( itemToCheck => compiledDefinitions[ itemToCheck ] );\r\n\r\n\titemRule.allowIn = Array.from( new Set( existingItems ) );\r\n}\r\n\r\nfunction cleanUpAllowAttributes( compiledDefinitions, itemName ) {\r\n\tconst itemRule = compiledDefinitions[ itemName ];\r\n\r\n\titemRule.allowAttributes = Array.from( new Set( itemRule.allowAttributes ) );\r\n}\r\n\r\nfunction copyTypes( sourceItemRules, itemRule ) {\r\n\tfor ( const sourceItemRule of sourceItemRules ) {\r\n\t\tconst typeNames = Object.keys( sourceItemRule ).filter( name => name.startsWith( 'is' ) );\r\n\r\n\t\tfor ( const name of typeNames ) {\r\n\t\t\titemRule[ name ] = sourceItemRule[ name ];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction copyProperty( sourceItemRules, itemRule, propertyName ) {\r\n\tfor ( const sourceItemRule of sourceItemRules ) {\r\n\t\tif ( typeof sourceItemRule[ propertyName ] == 'string' ) {\r\n\t\t\titemRule[ propertyName ].push( sourceItemRule[ propertyName ] );\r\n\t\t} else if ( Array.isArray( sourceItemRule[ propertyName ] ) ) {\r\n\t\t\titemRule[ propertyName ].push( ...sourceItemRule[ propertyName ] );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction makeInheritAllWork( sourceItemRules, itemRule ) {\r\n\tfor ( const sourceItemRule of sourceItemRules ) {\r\n\t\tconst inheritFrom = sourceItemRule.inheritAllFrom;\r\n\r\n\t\tif ( inheritFrom ) {\r\n\t\t\titemRule.allowContentOf.push( inheritFrom );\r\n\t\t\titemRule.allowWhere.push( inheritFrom );\r\n\t\t\titemRule.allowAttributesOf.push( inheritFrom );\r\n\t\t\titemRule.inheritTypesFrom.push( inheritFrom );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getAllowedChildren( compiledDefinitions, itemName ) {\r\n\tconst itemRule = compiledDefinitions[ itemName ];\r\n\r\n\treturn getValues( compiledDefinitions ).filter( def => def.allowIn.includes( itemRule.name ) );\r\n}\r\n\r\nfunction getValues( obj ) {\r\n\treturn Object.keys( obj ).map( key => obj[ key ] );\r\n}\r\n\r\nfunction mapContextItem( ctxItem ) {\r\n\tif ( typeof ctxItem == 'string' ) {\r\n\t\treturn {\r\n\t\t\tname: ctxItem,\r\n\r\n\t\t\t* getAttributeKeys() {},\r\n\r\n\t\t\tgetAttribute() {}\r\n\t\t};\r\n\t} else {\r\n\t\treturn {\r\n\t\t\t// '$text' means text nodes and text proxies.\r\n\t\t\tname: ctxItem.is( 'element' ) ? ctxItem.name : '$text',\r\n\r\n\t\t\t* getAttributeKeys() {\r\n\t\t\t\tyield* ctxItem.getAttributeKeys();\r\n\t\t\t},\r\n\r\n\t\t\tgetAttribute( key ) {\r\n\t\t\t\treturn ctxItem.getAttribute( key );\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\n// Generator function returning values from provided walkers, switching between them at each iteration. If only one walker\r\n// is provided it will return data only from that walker.\r\n//\r\n// @param {module:engine/module/treewalker~TreeWalker} [backward] Walker iterating in backward direction.\r\n// @param {module:engine/module/treewalker~TreeWalker} [forward] Walker iterating in forward direction.\r\n// @returns {Iterable.<Object>} Object returned at each iteration contains `value` and `walker` (informing which walker returned\r\n// given value) fields.\r\nfunction* combineWalkers( backward, forward ) {\r\n\tlet done = false;\r\n\r\n\twhile ( !done ) {\r\n\t\tdone = true;\r\n\r\n\t\tif ( backward ) {\r\n\t\t\tconst step = backward.next();\r\n\r\n\t\t\tif ( !step.done ) {\r\n\t\t\t\tdone = false;\r\n\t\t\t\tyield {\r\n\t\t\t\t\twalker: backward,\r\n\t\t\t\t\tvalue: step.value\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( forward ) {\r\n\t\t\tconst step = forward.next();\r\n\r\n\t\t\tif ( !step.done ) {\r\n\t\t\t\tdone = false;\r\n\t\t\t\tyield {\r\n\t\t\t\t\twalker: forward,\r\n\t\t\t\t\tvalue: step.value\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Takes an array of non-intersecting ranges. For each of them gets minimal flat ranges covering that range and returns\r\n// all those minimal flat ranges.\r\n//\r\n// @param {Array.<module:engine/model/range~Range>} ranges Ranges to process.\r\n// @returns {Iterator.<module:engine/model/range~Range>} Minimal flat ranges of given `ranges`.\r\nfunction* convertToMinimalFlatRanges( ranges ) {\r\n\tfor ( const range of ranges ) {\r\n\t\tyield* range.getMinimalFlatRanges();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/upcastdispatcher\r\n */\r\n\r\nimport ViewConsumable from './viewconsumable';\r\nimport ModelRange from '../model/range';\r\nimport ModelPosition from '../model/position';\r\nimport { SchemaContext } from '../model/schema';\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * `UpcastDispatcher` is a central point of {@link module:engine/view/view view} conversion, which is a process of\r\n * converting given {@link module:engine/view/documentfragment~DocumentFragment view document fragment} or\r\n * {@link module:engine/view/element~Element} into another structure.\r\n * In default application, {@link module:engine/view/view view} is converted to {@link module:engine/model/model}.\r\n *\r\n * During conversion process, for all {@link module:engine/view/node~Node view nodes} from the converted view document fragment,\r\n * `UpcastDispatcher` fires corresponding events. Special callbacks called \"converters\" should listen to\r\n * `UpcastDispatcher` for those events.\r\n *\r\n * Each callback, as the second argument, is passed a special object `data` that has `viewItem`, `modelCursor` and\r\n * `modelRange` properties. `viewItem` property contains {@link module:engine/view/node~Node view node} or\r\n * {@link module:engine/view/documentfragment~DocumentFragment view document fragment}\r\n * that is converted at the moment and might be handled by the callback. `modelRange` property should be used to save the result\r\n * of conversion and is always a {@link module:engine/model/range~Range} when conversion result is correct.\r\n * `modelCursor` property is a {@link module:engine/model/position~Position position} on which conversion result will be inserted\r\n * and is a context according to {@link module:engine/model/schema~Schema schema} will be checked before the conversion.\r\n * See also {@link ~UpcastDispatcher#convert}. It is also shared by reference by all callbacks listening to given event.\r\n *\r\n * The third parameter passed to a callback is an instance of {@link ~UpcastDispatcher}\r\n * which provides additional tools for converters.\r\n *\r\n * Examples of providing callbacks for `UpcastDispatcher`:\r\n *\r\n *\t\t// Converter for links (<a>).\r\n *\t\tupcastDispatcher.on( 'element:a', ( evt, data, conversionApi ) => {\r\n *\t\t\tif ( conversionApi.consumable.consume( data.viewItem, { name: true, attributes: [ 'href' ] } ) ) {\r\n *\t\t\t\t// <a> element is inline and is represented by an attribute in the model.\r\n *\t\t\t\t// This is why we need to convert only children.\r\n *\t\t\t\tconst { modelRange } = conversionApi.convertChildren( data.viewItem, data.modelCursor );\r\n *\r\n *\t\t\t\tfor ( let item of modelRange.getItems() ) {\r\n *\t\t\t\t\tif ( conversionApi.schema.checkAttribute( item, 'linkHref' ) ) {\r\n *\t\t\t\t\t\tconversionApi.writer.setAttribute( 'linkHref', data.viewItem.getAttribute( 'href' ), item );\r\n *\t\t\t\t\t}\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\t// Convert all elements which have no custom converter into paragraph (autoparagraphing).\r\n *  \tdata.viewToModel.on( 'element', ( evt, data, conversionApi ) => {\r\n *  \t \t// When element is already consumed by higher priority converters then do nothing.\r\n *  \t \tif ( conversionApi.consumable.test( data.viewItem, { name: data.viewItem.name } ) ) {\r\n *  \t \t\t\tconst paragraph = conversionApi.writer.createElement( 'paragraph' );\r\n *\r\n *  \t \t\t\t// Find allowed parent for paragraph that we are going to insert. If current parent does not allow\r\n *  \t \t\t\t// to insert paragraph but one of the ancestors does then split nodes to allowed parent.\r\n *  \t \t\t\tconst splitResult = conversionApi.splitToAllowedParent( paragraph, data.modelCursor );\r\n *\r\n *  \t \t\t\t// When there is no split result it means that we can't insert paragraph in this position.\r\n *  \t \t\t\tif ( splitResult ) {\r\n *  \t \t\t\t\t// Insert paragraph in allowed position.\r\n *  \t \t\t\t\tconversionApi.writer.insert( paragraph, splitResult.position );\r\n *\r\n *  \t \t\t\t\t// Convert children to paragraph.\r\n *  \t \t\t\t\tconst { modelRange } = conversionApi.convertChildren(\r\n *  \t \t\t\t\t\tdata.viewItem,\r\n *  \t \t\t\t\t\tconversionApi.writer.createPositionAt( paragraph, 0 )\r\n *  \t \t\t\t\t);\r\n *\r\n * \t\t\t\t\t\t// Set as conversion result, attribute converters may use this property.\r\n *  \t \t\t\t\tdata.modelRange = conversionApi.writer.createRange(\r\n *  \t \t\t\t\t\tconversionApi.writer.createPositionBefore( paragraph ),\r\n *  \t \t\t\t\t\tmodelRange.end\r\n *  \t \t\t\t\t);\r\n *\r\n *  \t \t\t\t\t// Continue conversion inside paragraph.\r\n *  \t \t\t\t\tdata.modelCursor = data.modelRange.end;\r\n *  \t \t\t\t}\r\n *  \t \t\t}\r\n *  \t \t}\r\n *  \t }, { priority: 'low' } );\r\n *\r\n * Before each conversion process, `UpcastDispatcher` fires {@link ~UpcastDispatcher#event:viewCleanup}\r\n * event which can be used to prepare tree view for conversion.\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n * @fires viewCleanup\r\n * @fires element\r\n * @fires text\r\n * @fires documentFragment\r\n */\r\nexport default class UpcastDispatcher {\r\n\t/**\r\n\t * Creates a `UpcastDispatcher` that operates using passed API.\r\n\t *\r\n\t * @see module:engine/conversion/upcastdispatcher~ViewConversionApi\r\n\t * @param {Object} [conversionApi] Additional properties for interface that will be passed to events fired\r\n\t * by `UpcastDispatcher`.\r\n\t */\r\n\tconstructor( conversionApi = {} ) {\r\n\t\t/**\r\n\t\t * List of elements that will be checked after conversion process and if element in the list will be empty it\r\n\t\t * will be removed from conversion result.\r\n\t\t *\r\n\t\t * After conversion process list is cleared.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @type {Set<module:engine/model/element~Element>}\r\n\t\t */\r\n\t\tthis._removeIfEmpty = new Set();\r\n\r\n\t\t/**\r\n\t\t * Position in the temporary structure where the converted content is inserted. The structure reflect the context of\r\n\t\t * the target position where the content will be inserted. This property is build based on the context parameter of the\r\n\t\t * convert method.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {module:engine/model/position~Position|null}\r\n\t\t */\r\n\t\tthis._modelCursor = null;\r\n\r\n\t\t/**\r\n\t\t * Interface passed by dispatcher to the events callbacks.\r\n\t\t *\r\n\t\t * @member {module:engine/conversion/upcastdispatcher~ViewConversionApi}\r\n\t\t */\r\n\t\tthis.conversionApi = Object.assign( {}, conversionApi );\r\n\r\n\t\t// `convertItem`, `convertChildren` and `splitToAllowedParent` are bound to this `UpcastDispatcher`\r\n\t\t// instance and set on `conversionApi`. This way only a part of `UpcastDispatcher` API is exposed.\r\n\t\tthis.conversionApi.convertItem = this._convertItem.bind( this );\r\n\t\tthis.conversionApi.convertChildren = this._convertChildren.bind( this );\r\n\t\tthis.conversionApi.splitToAllowedParent = this._splitToAllowedParent.bind( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Starts the conversion process. The entry point for the conversion.\r\n\t *\r\n\t * @fires element\r\n\t * @fires text\r\n\t * @fires documentFragment\r\n\t * @param {module:engine/view/documentfragment~DocumentFragment|module:engine/view/element~Element} viewItem\r\n\t * Part of the view to be converted.\r\n\t * @param {module:engine/model/writer~Writer} writer Instance of model writer.\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} [context=['$root']] Elements will be converted according to this context.\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment} Model data that is a result of the conversion process\r\n\t * wrapped in `DocumentFragment`. Converted marker elements will be set as that document fragment's\r\n\t * {@link module:engine/model/documentfragment~DocumentFragment#markers static markers map}.\r\n\t */\r\n\tconvert( viewItem, writer, context = [ '$root' ] ) {\r\n\t\tthis.fire( 'viewCleanup', viewItem );\r\n\r\n\t\t// Create context tree and set position in the top element.\r\n\t\t// Items will be converted according to this position.\r\n\t\tthis._modelCursor = createContextTree( context, writer );\r\n\r\n\t\t// Store writer in conversion as a conversion API\r\n\t\t// to be sure that conversion process will use the same batch.\r\n\t\tthis.conversionApi.writer = writer;\r\n\r\n\t\t// Create consumable values list for conversion process.\r\n\t\tthis.conversionApi.consumable = ViewConsumable.createFrom( viewItem );\r\n\r\n\t\t// Custom data stored by converter for conversion process.\r\n\t\tthis.conversionApi.store = {};\r\n\r\n\t\t// Do the conversion.\r\n\t\tconst { modelRange } = this._convertItem( viewItem, this._modelCursor );\r\n\r\n\t\t// Conversion result is always a document fragment so let's create this fragment.\r\n\t\tconst documentFragment = writer.createDocumentFragment();\r\n\r\n\t\t// When there is a conversion result.\r\n\t\tif ( modelRange ) {\r\n\t\t\t// Remove all empty elements that was added to #_removeIfEmpty list.\r\n\t\t\tthis._removeEmptyElements();\r\n\r\n\t\t\t// Move all items that was converted to context tree to document fragment.\r\n\t\t\tfor ( const item of Array.from( this._modelCursor.parent.getChildren() ) ) {\r\n\t\t\t\twriter.append( item, documentFragment );\r\n\t\t\t}\r\n\r\n\t\t\t// Extract temporary markers elements from model and set as static markers collection.\r\n\t\t\tdocumentFragment.markers = extractMarkersFromModelFragment( documentFragment, writer );\r\n\t\t}\r\n\r\n\t\t// Clear context position.\r\n\t\tthis._modelCursor = null;\r\n\r\n\t\t// Clear split elements.\r\n\t\tthis._removeIfEmpty.clear();\r\n\r\n\t\t// Clear conversion API.\r\n\t\tthis.conversionApi.writer = null;\r\n\t\tthis.conversionApi.store = null;\r\n\r\n\t\t// Return fragment as conversion result.\r\n\t\treturn documentFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @see module:engine/conversion/upcastdispatcher~ViewConversionApi#convertItem\r\n\t */\r\n\t_convertItem( viewItem, modelCursor ) {\r\n\t\tconst data = Object.assign( { viewItem, modelCursor, modelRange: null } );\r\n\r\n\t\tif ( viewItem.is( 'element' ) ) {\r\n\t\t\tthis.fire( 'element:' + viewItem.name, data, this.conversionApi );\r\n\t\t} else if ( viewItem.is( 'text' ) ) {\r\n\t\t\tthis.fire( 'text', data, this.conversionApi );\r\n\t\t} else {\r\n\t\t\tthis.fire( 'documentFragment', data, this.conversionApi );\r\n\t\t}\r\n\r\n\t\t// Handle incorrect conversion result.\r\n\t\tif ( data.modelRange && !( data.modelRange instanceof ModelRange ) ) {\r\n\t\t\t/**\r\n\t\t\t * Incorrect conversion result was dropped.\r\n\t\t\t *\r\n\t\t\t * {@link module:engine/model/range~Range Model range} should be a conversion result.\r\n\t\t\t *\r\n\t\t\t * @error view-conversion-dispatcher-incorrect-result\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'view-conversion-dispatcher-incorrect-result: Incorrect conversion result was dropped.' );\r\n\t\t}\r\n\r\n\t\treturn { modelRange: data.modelRange, modelCursor: data.modelCursor };\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @see module:engine/conversion/upcastdispatcher~ViewConversionApi#convertChildren\r\n\t */\r\n\t_convertChildren( viewItem, modelCursor ) {\r\n\t\tconst modelRange = new ModelRange( modelCursor );\r\n\t\tlet nextModelCursor = modelCursor;\r\n\r\n\t\tfor ( const viewChild of Array.from( viewItem.getChildren() ) ) {\r\n\t\t\tconst result = this._convertItem( viewChild, nextModelCursor );\r\n\r\n\t\t\tif ( result.modelRange instanceof ModelRange ) {\r\n\t\t\t\tmodelRange.end = result.modelRange.end;\r\n\t\t\t\tnextModelCursor = result.modelCursor;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn { modelRange, modelCursor: nextModelCursor };\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @see module:engine/conversion/upcastdispatcher~ViewConversionApi#splitToAllowedParent\r\n\t */\r\n\t_splitToAllowedParent( node, modelCursor ) {\r\n\t\t// Try to find allowed parent.\r\n\t\tconst allowedParent = this.conversionApi.schema.findAllowedParent( node, modelCursor );\r\n\r\n\t\t// When there is no parent that allows to insert node then return `null`.\r\n\t\tif ( !allowedParent ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// When current position parent allows to insert node then return this position.\r\n\t\tif ( allowedParent === modelCursor.parent ) {\r\n\t\t\treturn { position: modelCursor };\r\n\t\t}\r\n\r\n\t\t// When allowed parent is in context tree.\r\n\t\tif ( this._modelCursor.parent.getAncestors().includes( allowedParent ) ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Split element to allowed parent.\r\n\t\tconst splitResult = this.conversionApi.writer.split( modelCursor, allowedParent );\r\n\r\n\t\t// Remember all elements that are created as a result of split.\r\n\t\t// This is important because at the end of conversion we want to remove all empty split elements.\r\n\t\t//\r\n\t\t// Loop through positions between elements in range (except split result position) and collect parents.\r\n\t\t// <notSplit><split1><split2>[pos]</split2>[pos]</split1>[omit]<split1>[pos]<split2>[pos]</split2></split1></notSplit>\r\n\t\tfor ( const position of splitResult.range.getPositions() ) {\r\n\t\t\tif ( !position.isEqual( splitResult.position ) ) {\r\n\t\t\t\tthis._removeIfEmpty.add( position.parent );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tposition: splitResult.position,\r\n\t\t\tcursorParent: splitResult.range.end.parent\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if {@link #_removeIfEmpty} contains empty elements and remove them.\r\n\t * We need to do it smart because there could be elements that are not empty because contains\r\n\t * other empty elements and after removing its children they become available to remove.\r\n\t * We need to continue iterating over split elements as long as any element will be removed.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_removeEmptyElements() {\r\n\t\tlet removed = false;\r\n\r\n\t\tfor ( const element of this._removeIfEmpty ) {\r\n\t\t\tif ( element.isEmpty ) {\r\n\t\t\t\tthis.conversionApi.writer.remove( element );\r\n\t\t\t\tthis._removeIfEmpty.delete( element );\r\n\t\t\t\tremoved = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( removed ) {\r\n\t\t\tthis._removeEmptyElements();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Fired before the first conversion event, at the beginning of upcast (view to model conversion) process.\r\n\t *\r\n\t * @event viewCleanup\r\n\t * @param {module:engine/view/documentfragment~DocumentFragment|module:engine/view/element~Element}\r\n\t * viewItem Part of the view to be converted.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when {@link module:engine/view/element~Element} is converted.\r\n\t *\r\n\t * `element` is a namespace event for a class of events. Names of actually called events follow this pattern:\r\n\t * `element:<elementName>` where `elementName` is the name of converted element. This way listeners may listen to\r\n\t * all elements conversion or to conversion of specific elements.\r\n\t *\r\n\t * @event element\r\n\t * @param {Object} data Conversion data. Keep in mind that this object is shared by reference between all\r\n\t * callbacks that will be called. This means that callbacks can override values if needed, and those values will\r\n\t * be available in other callbacks.\r\n\t * @param {module:engine/view/item~Item} data.viewItem Converted item.\r\n\t * @param {module:engine/model/position~Position} data.modelCursor Position where a converter should start changes.\r\n\t * Change this value for the next converter to tell where the conversion should continue.\r\n\t * @param {module:engine/model/range~Range} data.modelRange The current state of conversion result. Every change to\r\n\t * converted element should be reflected by setting or modifying this property.\r\n\t * @param {ViewConversionApi} conversionApi Conversion utilities to be used by callback.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when {@link module:engine/view/text~Text} is converted.\r\n\t *\r\n\t * @event text\r\n\t * @see #event:element\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when {@link module:engine/view/documentfragment~DocumentFragment} is converted.\r\n\t *\r\n\t * @event documentFragment\r\n\t * @see #event:element\r\n\t */\r\n}\r\n\r\nmix( UpcastDispatcher, EmitterMixin );\r\n\r\n// Traverses given model item and searches elements which marks marker range. Found element is removed from\r\n// DocumentFragment but path of this element is stored in a Map which is then returned.\r\n//\r\n// @param {module:engine/view/documentfragment~DocumentFragment|module:engine/view/node~Node} modelItem Fragment of model.\r\n// @returns {Map<String, module:engine/model/range~Range>} List of static markers.\r\nfunction extractMarkersFromModelFragment( modelItem, writer ) {\r\n\tconst markerElements = new Set();\r\n\tconst markers = new Map();\r\n\r\n\t// Create ModelTreeWalker.\r\n\tconst range = ModelRange._createIn( modelItem ).getItems();\r\n\r\n\t// Walk through DocumentFragment and collect marker elements.\r\n\tfor ( const item of range ) {\r\n\t\t// Check if current element is a marker.\r\n\t\tif ( item.name == '$marker' ) {\r\n\t\t\tmarkerElements.add( item );\r\n\t\t}\r\n\t}\r\n\r\n\t// Walk through collected marker elements store its path and remove its from the DocumentFragment.\r\n\tfor ( const markerElement of markerElements ) {\r\n\t\tconst markerName = markerElement.getAttribute( 'data-name' );\r\n\t\tconst currentPosition = writer.createPositionBefore( markerElement );\r\n\r\n\t\t// When marker of given name is not stored it means that we have found the beginning of the range.\r\n\t\tif ( !markers.has( markerName ) ) {\r\n\t\t\tmarkers.set( markerName, new ModelRange( currentPosition.clone() ) );\r\n\t\t// Otherwise is means that we have found end of the marker range.\r\n\t\t} else {\r\n\t\t\tmarkers.get( markerName ).end = currentPosition.clone();\r\n\t\t}\r\n\r\n\t\t// Remove marker element from DocumentFragment.\r\n\t\twriter.remove( markerElement );\r\n\t}\r\n\r\n\treturn markers;\r\n}\r\n\r\n// Creates model fragment according to given context and returns position in top element.\r\nfunction createContextTree( contextDefinition, writer ) {\r\n\tlet position;\r\n\r\n\tfor ( const item of new SchemaContext( contextDefinition ) ) {\r\n\t\tconst attributes = {};\r\n\r\n\t\tfor ( const key of item.getAttributeKeys() ) {\r\n\t\t\tattributes[ key ] = item.getAttribute( key );\r\n\t\t}\r\n\r\n\t\tconst current = writer.createElement( item.name, attributes );\r\n\r\n\t\tif ( position ) {\r\n\t\t\twriter.append( current, position );\r\n\t\t}\r\n\r\n\t\tposition = ModelPosition._createAt( current, 0 );\r\n\t}\r\n\r\n\treturn position;\r\n}\r\n\r\n/**\r\n * Conversion interface that is registered for given {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher}\r\n * and is passed as one of parameters when {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher dispatcher}\r\n * fires it's events.\r\n *\r\n * @interface ViewConversionApi\r\n */\r\n\r\n/**\r\n * Starts conversion of given item by firing an appropriate event.\r\n *\r\n * Every fired event is passed (as first parameter) an object with `modelRange` property. Every event may set and/or\r\n * modify that property. When all callbacks are done, the final value of `modelRange` property is returned by this method.\r\n * The `modelRange` must be {@link module:engine/model/range~Range model range} or `null` (as set by default).\r\n *\r\n * @method #convertItem\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:text\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:documentFragment\r\n * @param {module:engine/view/item~Item} viewItem Item to convert.\r\n * @param {module:engine/model/position~Position} modelCursor Position of conversion.\r\n * @returns {Object} result Conversion result.\r\n * @returns {module:engine/model/range~Range|null} result.modelRange Model range containing result of item conversion,\r\n * created and modified by callbacks attached to fired event, or `null` if the conversion result was incorrect.\r\n * @returns {module:engine/model/position~Position} result.modelCursor Position where conversion should be continued.\r\n */\r\n\r\n/**\r\n * Starts conversion of all children of given item by firing appropriate events for all those children.\r\n *\r\n * @method #convertChildren\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:text\r\n * @fires module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:documentFragment\r\n * @param {module:engine/view/item~Item} viewItem Item to convert.\r\n * @param {module:engine/model/position~Position} modelCursor Position of conversion.\r\n * @returns {Object} result Conversion result.\r\n * @returns {module:engine/model/range~Range} result.modelRange Model range containing results of conversion of all children of given item.\r\n * When no children was converted then range is collapsed.\r\n * @returns {module:engine/model/position~Position} result.modelCursor Position where conversion should be continued.\r\n */\r\n\r\n/**\r\n * Checks {@link module:engine/model/schema~Schema schema} to find allowed parent for element that we are going to insert\r\n * starting from given position. If current parent does not allow to insert element but one of the ancestors does then\r\n * split nodes to allowed parent.\r\n *\r\n * If schema allows to insert node in given position, nothing is split and object with that position is returned.\r\n *\r\n * If it was not possible to find allowed parent, `null` is returned, nothing is split.\r\n *\r\n * Otherwise, ancestors are split and object with position and the copy of the split element is returned.\r\n *\r\n * For instance, if `<image>` is not allowed in `<paragraph>` but is allowed in `$root`:\r\n *\r\n *\t\t<paragraph>foo[]bar</paragraph>\r\n *\r\n *  \t-> split for `<image>` ->\r\n *\r\n *  \t<paragraph>foo</paragraph>[]<paragraph>bar</paragraph>\r\n *\r\n * In the sample above position between `<paragraph>` elements will be returned as `position` and the second `paragraph`\r\n * as `cursorParent`.\r\n *\r\n * @method #splitToAllowedParent\r\n * @param {module:engine/model/position~Position} position Position on which element is going to be inserted.\r\n * @param {module:engine/model/node~Node} node Node to insert.\r\n * @returns {Object|null} Split result. If it was not possible to find allowed position `null` is returned.\r\n * @returns {module:engine/model/position~Position} position between split elements.\r\n * @returns {module:engine/model/element~Element} [cursorParent] Element inside which cursor should be placed to\r\n * continue conversion. When element is not defined it means that there was no split.\r\n */\r\n\r\n/**\r\n * Instance of {@link module:engine/conversion/viewconsumable~ViewConsumable}. It stores\r\n * information about what parts of processed view item are still waiting to be handled. After a piece of view item\r\n * was converted, appropriate consumable value should be {@link module:engine/conversion/viewconsumable~ViewConsumable#consume consumed}.\r\n *\r\n * @param {Object} #consumable\r\n */\r\n\r\n/**\r\n * Custom data stored by converters for conversion process. Custom properties of this object can be defined and use to\r\n * pass parameters between converters.\r\n *\r\n * The difference between this property and `data` parameter of\r\n * {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element} is that `data` parameters allows you\r\n * to pass parameters within a single event and `store` within the whole conversion.\r\n *\r\n * @param {Object} #store\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport Matcher from '../view/matcher';\r\n\r\nimport ModelRange from '../model/range';\r\n\r\nimport { cloneDeep } from 'lodash-es';\r\n\r\n/**\r\n * Contains {@link module:engine/view/view view} to {@link module:engine/model/model model} converters for\r\n * {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher}.\r\n *\r\n * @module engine/conversion/upcast-converters\r\n */\r\n\r\n/**\r\n * View element to model element conversion helper.\r\n *\r\n * This conversion results in creating a model element. For example, view `<p>Foo</p>` becomes `<paragraph>Foo</paragraph>` in the model.\r\n *\r\n * Keep in mind that the element will be inserted only if it is allowed by {@link module:engine/model/schema~Schema schema} configuration.\r\n *\r\n *\t\tupcastElementToElement( { view: 'p', model: 'paragraph' } );\r\n *\r\n *\t\tupcastElementToElement( { view: 'p', model: 'paragraph', converterPriority: 'high' } );\r\n *\r\n *\t\tupcastElementToElement( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'p',\r\n *\t\t\t\tclasses: 'fancy'\r\n *\t\t\t},\r\n *\t\t\tmodel: 'fancyParagraph'\r\n *\t\t} );\r\n *\r\n *\t\tupcastElementToElement( {\r\n * \t\t\tview: {\r\n *\t\t\t\tname: 'p',\r\n *\t\t\t\tclasses: 'heading'\r\n * \t\t\t},\r\n * \t\t\tmodel: ( viewElement, modelWriter ) => {\r\n * \t\t\t\treturn modelWriter.createElement( 'heading', { level: viewElement.getAttribute( 'data-level' ) } );\r\n * \t\t\t}\r\n * \t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add converter to conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {module:engine/view/matcher~MatcherPattern} config.view Pattern matching all view elements which should be converted.\r\n * @param {String|module:engine/model/element~Element|Function} config.model Name of the model element, a model element\r\n * instance or a function that takes a view element and returns a model element. The model element will be inserted in the model.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function upcastElementToElement( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tconst converter = _prepareToElementConverter( config );\r\n\r\n\tconst elementName = _getViewElementNameFromConfig( config );\r\n\tconst eventName = elementName ? 'element:' + elementName : 'element';\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( eventName, converter, { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * View element to model attribute conversion helper.\r\n *\r\n * This conversion results in setting an attribute on a model node. For example, view `<strong>Foo</strong>` becomes\r\n * `Foo` {@link module:engine/model/text~Text model text node} with `bold` attribute set to `true`.\r\n *\r\n * This helper is meant to set a model attribute on all the elements that are inside the converted element:\r\n *\r\n *\t\t<strong>Foo</strong>   -->   <strong><p>Foo</p></strong>   -->   <paragraph><$text bold=\"true\">Foo</$text></paragraph>\r\n *\r\n * Above is a sample of HTML code, that goes through autoparagraphing (first step) and then is converted (second step).\r\n * Even though `<strong>` is over `<p>` element, `bold=\"true\"` was added to the text. See\r\n * {@link module:engine/conversion/upcast-converters~upcastAttributeToAttribute} for comparison.\r\n *\r\n * Keep in mind that the attribute will be set only if it is allowed by {@link module:engine/model/schema~Schema schema} configuration.\r\n *\r\n *\t\tupcastElementToAttribute( { view: 'strong', model: 'bold' } );\r\n *\r\n *\t\tupcastElementToAttribute( { view: 'strong', model: 'bold', converterPriority: 'high' } );\r\n *\r\n *\t\tupcastElementToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tclasses: 'bold'\r\n *\t\t\t},\r\n *\t\t\tmodel: 'bold'\r\n *\t\t} );\r\n *\r\n *\t\tupcastElementToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tclasses: [ 'styled', 'styled-dark' ]\r\n *\t\t\t},\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'styled',\r\n *\t\t\t\tvalue: 'dark'\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * \t\tupcastElementToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tstyles: {\r\n *\t\t\t\t\t'font-size': /[\\s\\S]+/\r\n *\t\t\t\t}\r\n *\t\t\t},\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'fontSize',\r\n *\t\t\t\tvalue: viewElement => {\r\n *\t\t\t\t\tconst fontSize = viewElement.getStyle( 'font-size' );\r\n *\t\t\t\t\tconst value = fontSize.substr( 0, fontSize.length - 2 );\r\n *\r\n *\t\t\t\t\tif ( value <= 10 ) {\r\n *\t\t\t\t\t\treturn 'small';\r\n *\t\t\t\t\t} else if ( value > 12 ) {\r\n *\t\t\t\t\t\treturn 'big';\r\n *\t\t\t\t\t}\r\n *\r\n *\t\t\t\t\treturn null;\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add converter to conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {module:engine/view/matcher~MatcherPattern} config.view Pattern matching all view elements which should be converted.\r\n * @param {String|Object} config.model Model attribute key or an object with `key` and `value` properties, describing\r\n * the model attribute. `value` property may be set as a function that takes a view element and returns the value.\r\n * If `String` is given, the model attribute value will be set to `true`.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function upcastElementToAttribute( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\t_normalizeModelAttributeConfig( config );\r\n\r\n\tconst converter = _prepareToAttributeConverter( config, false );\r\n\r\n\tconst elementName = _getViewElementNameFromConfig( config );\r\n\tconst eventName = elementName ? 'element:' + elementName : 'element';\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( eventName, converter, { priority: config.converterPriority || 'normal' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * View attribute to model attribute conversion helper.\r\n *\r\n * This conversion results in setting an attribute on a model node. For example, view `<img src=\"foo.jpg\"></img>` becomes\r\n * `<image source=\"foo.jpg\"></image>` in the model.\r\n *\r\n * This helper is meant to convert view attributes from view elements which got converted to the model, so the view attribute\r\n * is set only on the corresponding model node:\r\n *\r\n *\t\t<div class=\"dark\"><div>foo</div></div>    -->    <div dark=\"true\"><div>foo</div></div>\r\n *\r\n * Above, `class=\"dark\"` attribute is added only to the `<div>` elements that has it. This is in contrary to\r\n * {@link module:engine/conversion/upcast-converters~upcastElementToAttribute} which sets attributes for all the children in the model:\r\n *\r\n *\t\t<strong>Foo</strong>   -->   <strong><p>Foo</p></strong>   -->   <paragraph><$text bold=\"true\">Foo</$text></paragraph>\r\n *\r\n * Above is a sample of HTML code, that goes through autoparagraphing (first step) and then is converted (second step).\r\n * Even though `<strong>` is over `<p>` element, `bold=\"true\"` was added to the text.\r\n *\r\n * Keep in mind that the attribute will be set only if it is allowed by {@link module:engine/model/schema~Schema schema} configuration.\r\n *\r\n *\t\tupcastAttributeToAttribute( { view: 'src', model: 'source' } );\r\n *\r\n *\t\tupcastAttributeToAttribute( { view: { key: 'src' }, model: 'source' } );\r\n *\r\n *\t\tupcastAttributeToAttribute( { view: { key: 'src' }, model: 'source', converterPriority: 'normal' } );\r\n *\r\n *\t\tupcastAttributeToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tkey: 'data-style',\r\n *\t\t\t\tvalue: /[\\s\\S]+/\r\n *\t\t\t},\r\n *\t\t\tmodel: 'styled'\r\n *\t\t} );\r\n *\r\n *\t\tupcastAttributeToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'img',\r\n *\t\t\t\tkey: 'class',\r\n *\t\t\t\tvalue: 'styled-dark'\r\n *\t\t\t},\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'styled',\r\n *\t\t\t\tvalue: 'dark'\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\tupcastAttributeToAttribute( {\r\n *\t\t\tview: {\r\n *\t\t\t\tkey: 'class',\r\n *\t\t\t\tvalue: /styled-[\\S]+/\r\n *\t\t\t},\r\n *\t\t\tmodel: {\r\n *\t\t\t\tkey: 'styled'\r\n *\t\t\t\tvalue: viewElement => {\r\n *\t\t\t\t\tconst regexp = /styled-([\\S]+)/;\r\n *\t\t\t\t\tconst match = viewElement.getAttribute( 'class' ).match( regexp );\r\n *\r\n *\t\t\t\t\treturn match[ 1 ];\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add converter to conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {String|Object} config.view Specifies which view attribute will be converted. If a `String` is passed,\r\n * attributes with given key will be converted. If an `Object` is passed, it must have a required `key` property,\r\n * specifying view attribute key, and may have an optional `value` property, specifying view attribute value and optional `name`\r\n * property specifying a view element name from/on which the attribute should be converted. `value` can be given as a `String`,\r\n * a `RegExp` or a function callback, that takes view attribute value as the only parameter and returns `Boolean`.\r\n * @param {String|Object} config.model Model attribute key or an object with `key` and `value` properties, describing\r\n * the model attribute. `value` property may be set as a function that takes a view element and returns the value.\r\n * If `String` is given, the model attribute value will be same as view attribute value.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='low'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function upcastAttributeToAttribute( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\tlet viewKey = null;\r\n\r\n\tif ( typeof config.view == 'string' || config.view.key ) {\r\n\t\tviewKey = _normalizeViewAttributeKeyValueConfig( config );\r\n\t}\r\n\r\n\t_normalizeModelAttributeConfig( config, viewKey );\r\n\r\n\tconst converter = _prepareToAttributeConverter( config, true );\r\n\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'element', converter, { priority: config.converterPriority || 'low' } );\r\n\t};\r\n}\r\n\r\n/**\r\n * View element to model marker conversion helper.\r\n *\r\n * This conversion results in creating a model marker. For example, if the marker was stored in a view as an element:\r\n * `<p>Fo<span data-marker=\"comment\" data-comment-id=\"7\"></span>o</p><p>B<span data-marker=\"comment\" data-comment-id=\"7\"></span>ar</p>`,\r\n * after the conversion is done, the marker will be available in\r\n * {@link module:engine/model/model~Model#markers model document markers}.\r\n *\r\n *\t\tupcastElementToMarker( { view: 'marker-search', model: 'search' } );\r\n *\r\n *\t\tupcastElementToMarker( { view: 'marker-search', model: 'search', converterPriority: 'high' } );\r\n *\r\n *\t\tupcastElementToMarker( {\r\n *\t\t\tview: 'marker-search',\r\n *\t\t\tmodel: viewElement => 'comment:' + viewElement.getAttribute( 'data-comment-id' )\r\n *\t\t} );\r\n *\r\n *\t\tupcastElementToMarker( {\r\n *\t\t\tview: {\r\n *\t\t\t\tname: 'span',\r\n *\t\t\t\tattributes: {\r\n *\t\t\t\t\t'data-marker': 'search'\r\n *\t\t\t\t}\r\n *\t\t\t},\r\n *\t\t\tmodel: 'search'\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/conversion/conversion~Conversion#for} to learn how to add converter to conversion process.\r\n *\r\n * @param {Object} config Conversion configuration.\r\n * @param {module:engine/view/matcher~MatcherPattern} config.view Pattern matching all view elements which should be converted.\r\n * @param {String|Function} config.model Name of the model marker, or a function that takes a view element and returns\r\n * a model marker name.\r\n * @param {module:utils/priorities~PriorityString} [config.converterPriority='normal'] Converter priority.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function upcastElementToMarker( config ) {\r\n\tconfig = cloneDeep( config );\r\n\r\n\t_normalizeToMarkerConfig( config );\r\n\r\n\treturn upcastElementToElement( config );\r\n}\r\n\r\n// Helper function for from-view-element conversion. Checks if `config.view` directly specifies converted view element's name\r\n// and if so, returns it.\r\n//\r\n// @param {Object} config Conversion config.\r\n// @returns {String|null} View element name or `null` if name is not directly set.\r\nfunction _getViewElementNameFromConfig( config ) {\r\n\tif ( typeof config.view == 'string' ) {\r\n\t\treturn config.view;\r\n\t}\r\n\r\n\tif ( typeof config.view == 'object' && typeof config.view.name == 'string' ) {\r\n\t\treturn config.view.name;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n// Helper for to-model-element conversion. Takes a config object and returns a proper converter function.\r\n//\r\n// @param {Object} config Conversion configuration.\r\n// @returns {Function} View to model converter.\r\nfunction _prepareToElementConverter( config ) {\r\n\tconst matcher = new Matcher( config.view );\r\n\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// This will be usually just one pattern but we support matchers with many patterns too.\r\n\t\tconst match = matcher.match( data.viewItem );\r\n\r\n\t\t// If there is no match, this callback should not do anything.\r\n\t\tif ( !match ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Force consuming element's name.\r\n\t\tmatch.match.name = true;\r\n\r\n\t\t// Create model element basing on config.\r\n\t\tconst modelElement = _getModelElement( config.model, data.viewItem, conversionApi.writer );\r\n\r\n\t\t// Do not convert if element building function returned falsy value.\r\n\t\tif ( !modelElement ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// When element was already consumed then skip it.\r\n\t\tif ( !conversionApi.consumable.test( data.viewItem, match.match ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Find allowed parent for element that we are going to insert.\r\n\t\t// If current parent does not allow to insert element but one of the ancestors does\r\n\t\t// then split nodes to allowed parent.\r\n\t\tconst splitResult = conversionApi.splitToAllowedParent( modelElement, data.modelCursor );\r\n\r\n\t\t// When there is no split result it means that we can't insert element to model tree, so let's skip it.\r\n\t\tif ( !splitResult ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Insert element on allowed position.\r\n\t\tconversionApi.writer.insert( modelElement, splitResult.position );\r\n\r\n\t\t// Convert children and insert to element.\r\n\t\tconst childrenResult = conversionApi.convertChildren( data.viewItem, conversionApi.writer.createPositionAt( modelElement, 0 ) );\r\n\r\n\t\t// Consume appropriate value from consumable values list.\r\n\t\tconversionApi.consumable.consume( data.viewItem, match.match );\r\n\r\n\t\t// Set conversion result range.\r\n\t\tdata.modelRange = new ModelRange(\r\n\t\t\t// Range should start before inserted element\r\n\t\t\tconversionApi.writer.createPositionBefore( modelElement ),\r\n\t\t\t// Should end after but we need to take into consideration that children could split our\r\n\t\t\t// element, so we need to move range after parent of the last converted child.\r\n\t\t\t// before: <allowed>[]</allowed>\r\n\t\t\t// after: <allowed>[<converted><child></child></converted><child></child><converted>]</converted></allowed>\r\n\t\t\tconversionApi.writer.createPositionAfter( childrenResult.modelCursor.parent )\r\n\t\t);\r\n\r\n\t\t// Now we need to check where the modelCursor should be.\r\n\t\t// If we had to split parent to insert our element then we want to continue conversion inside split parent.\r\n\t\t//\r\n\t\t// before: <allowed><notAllowed>[]</notAllowed></allowed>\r\n\t\t// after:  <allowed><notAllowed></notAllowed><converted></converted><notAllowed>[]</notAllowed></allowed>\r\n\t\tif ( splitResult.cursorParent ) {\r\n\t\t\tdata.modelCursor = conversionApi.writer.createPositionAt( splitResult.cursorParent, 0 );\r\n\r\n\t\t\t// Otherwise just continue after inserted element.\r\n\t\t} else {\r\n\t\t\tdata.modelCursor = data.modelRange.end;\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Helper function for upcasting-to-element converter. Takes the model configuration, the converted view element\r\n// and a writer instance and returns a model element instance to be inserted in the model.\r\n//\r\n// @param {String|Function|module:engine/model/element~Element} model Model conversion configuration.\r\n// @param {module:engine/view/node~Node} input The converted view node.\r\n// @param {module:engine/model/writer~Writer} writer A writer instance to use to create the model element.\r\nfunction _getModelElement( model, input, writer ) {\r\n\tif ( model instanceof Function ) {\r\n\t\treturn model( input, writer );\r\n\t} else {\r\n\t\treturn writer.createElement( model );\r\n\t}\r\n}\r\n\r\n// Helper function view-attribute-to-model-attribute helper. Normalizes `config.view` which was set as `String` or\r\n// as an `Object` with `key`, `value` and `name` properties. Normalized `config.view` has is compatible with\r\n// {@link module:engine/view/matcher~MatcherPattern}.\r\n//\r\n// @param {Object} config Conversion config.\r\n// @returns {String} Key of the converted view attribute.\r\nfunction _normalizeViewAttributeKeyValueConfig( config ) {\r\n\tif ( typeof config.view == 'string' ) {\r\n\t\tconfig.view = { key: config.view };\r\n\t}\r\n\r\n\tconst key = config.view.key;\r\n\tlet normalized;\r\n\r\n\tif ( key == 'class' || key == 'style' ) {\r\n\t\tconst keyName = key == 'class' ? 'classes' : 'styles';\r\n\r\n\t\tnormalized = {\r\n\t\t\t[ keyName ]: config.view.value\r\n\t\t};\r\n\t} else {\r\n\t\tconst value = typeof config.view.value == 'undefined' ? /[\\s\\S]*/ : config.view.value;\r\n\r\n\t\tnormalized = {\r\n\t\t\tattributes: {\r\n\t\t\t\t[ key ]: value\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tif ( config.view.name ) {\r\n\t\tnormalized.name = config.view.name;\r\n\t}\r\n\r\n\tconfig.view = normalized;\r\n\r\n\treturn key;\r\n}\r\n\r\n// Helper function that normalizes `config.model` in from-model-attribute conversion. `config.model` can be set\r\n// as a `String`, an `Object` with only `key` property or an `Object` with `key` and `value` properties. Normalized\r\n// `config.model` is an `Object` with `key` and `value` properties.\r\n//\r\n// @param {Object} config Conversion config.\r\n// @param {String} viewAttributeKeyToCopy Key of the converted view attribute. If it is set, model attribute value\r\n// will be equal to view attribute value.\r\nfunction _normalizeModelAttributeConfig( config, viewAttributeKeyToCopy = null ) {\r\n\tconst defaultModelValue = viewAttributeKeyToCopy === null ? true : viewElement => viewElement.getAttribute( viewAttributeKeyToCopy );\r\n\r\n\tconst key = typeof config.model != 'object' ? config.model : config.model.key;\r\n\tconst value = typeof config.model != 'object' || typeof config.model.value == 'undefined' ? defaultModelValue : config.model.value;\r\n\r\n\tconfig.model = { key, value };\r\n}\r\n\r\n// Helper for to-model-attribute conversion. Takes the model attribute name and conversion configuration and returns\r\n// a proper converter function.\r\n//\r\n// @param {String} modelAttributeKey The key of the model attribute to set on a model node.\r\n// @param {Object|Array.<Object>} config Conversion configuration. It is possible to provide multiple configurations in an array.\r\n// @param {Boolean} shallow If set to `true` the attribute will be set only on top-level nodes. Otherwise, it will be set\r\n// on all elements in the range.\r\nfunction _prepareToAttributeConverter( config, shallow ) {\r\n\tconst matcher = new Matcher( config.view );\r\n\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst match = matcher.match( data.viewItem );\r\n\r\n\t\t// If there is no match, this callback should not do anything.\r\n\t\tif ( !match ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modelKey = config.model.key;\r\n\t\tconst modelValue = typeof config.model.value == 'function' ? config.model.value( data.viewItem ) : config.model.value;\r\n\r\n\t\t// Do not convert if attribute building function returned falsy value.\r\n\t\tif ( modelValue === null ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( _onlyViewNameIsDefined( config ) ) {\r\n\t\t\tmatch.match.name = true;\r\n\t\t} else {\r\n\t\t\t// Do not test or consume `name` consumable.\r\n\t\t\tdelete match.match.name;\r\n\t\t}\r\n\r\n\t\t// Try to consume appropriate values from consumable values list.\r\n\t\tif ( !conversionApi.consumable.test( data.viewItem, match.match ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Since we are converting to attribute we need an range on which we will set the attribute.\r\n\t\t// If the range is not created yet, we will create it.\r\n\t\tif ( !data.modelRange ) {\r\n\t\t\t// Convert children and set conversion result as a current data.\r\n\t\t\tdata = Object.assign( data, conversionApi.convertChildren( data.viewItem, data.modelCursor ) );\r\n\t\t}\r\n\r\n\t\t// Set attribute on current `output`. `Schema` is checked inside this helper function.\r\n\t\tconst attributeWasSet = _setAttributeOn( data.modelRange, { key: modelKey, value: modelValue }, shallow, conversionApi );\r\n\r\n\t\tif ( attributeWasSet ) {\r\n\t\t\tconversionApi.consumable.consume( data.viewItem, match.match );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Helper function that checks if element name should be consumed in attribute converters.\r\n//\r\n// @param {Object} config Conversion config.\r\n// @returns {Boolean}\r\nfunction _onlyViewNameIsDefined( config ) {\r\n\tif ( typeof config.view == 'object' && !_getViewElementNameFromConfig( config ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn !config.view.classes && !config.view.attributes && !config.view.styles;\r\n}\r\n\r\n// Helper function for to-model-attribute converter. Sets model attribute on given range. Checks {@link module:engine/model/schema~Schema}\r\n// to ensure proper model structure.\r\n//\r\n// @param {module:engine/model/range~Range} modelRange Model range on which attribute should be set.\r\n// @param {Object} modelAttribute Model attribute to set.\r\n// @param {Object} conversionApi Conversion API.\r\n// @param {Boolean} shallow If set to `true` the attribute will be set only on top-level nodes. Otherwise, it will be set\r\n// on all elements in the range.\r\n// @returns {Boolean} `true` if attribute was set on at least one node from given `modelRange`.\r\nfunction _setAttributeOn( modelRange, modelAttribute, shallow, conversionApi ) {\r\n\tlet result = false;\r\n\r\n\t// Set attribute on each item in range according to Schema.\r\n\tfor ( const node of Array.from( modelRange.getItems( { shallow } ) ) ) {\r\n\t\tif ( conversionApi.schema.checkAttribute( node, modelAttribute.key ) ) {\r\n\t\t\tconversionApi.writer.setAttribute( modelAttribute.key, modelAttribute.value, node );\r\n\r\n\t\t\tresult = true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\n// Helper function for upcasting-to-marker conversion. Takes the config in a format requested by `upcastElementToMarker()`\r\n// function and converts it to a format that is supported by `upcastElementToElement()` function.\r\n//\r\n// @param {Object} config Conversion configuration.\r\nfunction _normalizeToMarkerConfig( config ) {\r\n\tconst oldModel = config.model;\r\n\r\n\tconfig.model = ( viewElement, modelWriter ) => {\r\n\t\tconst markerName = typeof oldModel == 'string' ? oldModel : oldModel( viewElement );\r\n\r\n\t\treturn modelWriter.createElement( '$marker', { 'data-name': markerName } );\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory, creates a converter that converts {@link module:engine/view/documentfragment~DocumentFragment view document fragment}\r\n * or all children of {@link module:engine/view/element~Element} into\r\n * {@link module:engine/model/documentfragment~DocumentFragment model document fragment}.\r\n * This is the \"entry-point\" converter for upcast (view to model conversion). This converter starts the conversion of all children\r\n * of passed view document fragment. Those children {@link module:engine/view/node~Node view nodes} are then handled by other converters.\r\n *\r\n * This also a \"default\", last resort converter for all view elements that has not been converted by other converters.\r\n * When a view element is being converted to the model but it does not have converter specified, that view element\r\n * will be converted to {@link module:engine/model/documentfragment~DocumentFragment model document fragment} and returned.\r\n *\r\n * @returns {Function} Universal converter for view {@link module:engine/view/documentfragment~DocumentFragment fragments} and\r\n * {@link module:engine/view/element~Element elements} that returns\r\n * {@link module:engine/model/documentfragment~DocumentFragment model fragment} with children of converted view item.\r\n */\r\nexport function convertToModelFragment() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\t// Second argument in `consumable.consume` is discarded for ViewDocumentFragment but is needed for ViewElement.\r\n\t\tif ( !data.modelRange && conversionApi.consumable.consume( data.viewItem, { name: true } ) ) {\r\n\t\t\tconst { modelRange, modelCursor } = conversionApi.convertChildren( data.viewItem, data.modelCursor );\r\n\r\n\t\t\tdata.modelRange = modelRange;\r\n\t\t\tdata.modelCursor = modelCursor;\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Function factory, creates a converter that converts {@link module:engine/view/text~Text} to {@link module:engine/model/text~Text}.\r\n *\r\n * @returns {Function} {@link module:engine/view/text~Text View text} converter.\r\n */\r\nexport function convertText() {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( conversionApi.schema.checkChild( data.modelCursor, '$text' ) ) {\r\n\t\t\tif ( conversionApi.consumable.consume( data.viewItem ) ) {\r\n\t\t\t\tconst text = conversionApi.writer.createText( data.viewItem.data );\r\n\r\n\t\t\t\tconversionApi.writer.insert( text, data.modelCursor );\r\n\r\n\t\t\t\tdata.modelRange = ModelRange._createFromPositionAndShift( data.modelCursor, text.offsetSize );\r\n\t\t\t\tdata.modelCursor = data.modelRange.end;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/controller/datacontroller\r\n */\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\nimport Mapper from '../conversion/mapper';\r\n\r\nimport DowncastDispatcher from '../conversion/downcastdispatcher';\r\nimport { insertText } from '../conversion/downcast-converters';\r\n\r\nimport UpcastDispatcher from '../conversion/upcastdispatcher';\r\nimport { convertText, convertToModelFragment } from '../conversion/upcast-converters';\r\n\r\nimport ViewDocumentFragment from '../view/documentfragment';\r\nimport ViewDocument from '../view/document';\r\nimport ViewDowncastWriter from '../view/downcastwriter';\r\n\r\nimport ModelRange from '../model/range';\r\n\r\n/**\r\n * Controller for the data pipeline. The data pipeline controls how data is retrieved from the document\r\n * and set inside it. Hence, the controller features two methods which allow to {@link ~DataController#get get}\r\n * and {@link ~DataController#set set} data of the {@link ~DataController#model model}\r\n * using given:\r\n *\r\n * * {@link module:engine/dataprocessor/dataprocessor~DataProcessor data processor},\r\n * * downcast converters,\r\n * * upcast converters.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class DataController {\r\n\t/**\r\n\t * Creates a data controller instance.\r\n\t *\r\n\t * @param {module:engine/model/model~Model} model Data model.\r\n\t * @param {module:engine/dataprocessor/dataprocessor~DataProcessor} [dataProcessor] Data processor that should be used\r\n\t * by the controller.\r\n\t */\r\n\tconstructor( model, dataProcessor ) {\r\n\t\t/**\r\n\t\t * Data model.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model}\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * Data processor used during the conversion.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/dataProcessor~DataProcessor}\r\n\t\t */\r\n\t\tthis.processor = dataProcessor;\r\n\r\n\t\t/**\r\n\t\t * Mapper used for the conversion. It has no permanent bindings, because they are created when getting data and\r\n\t\t * cleared directly after the data are converted. However, the mapper is defined as a class property, because\r\n\t\t * it needs to be passed to the `DowncastDispatcher` as a conversion API.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/mapper~Mapper}\r\n\t\t */\r\n\t\tthis.mapper = new Mapper();\r\n\r\n\t\t/**\r\n\t\t * Downcast dispatcher used by the {@link #get get method}. Downcast converters should be attached to it.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/downcastdispatcher~DowncastDispatcher}\r\n\t\t */\r\n\t\tthis.downcastDispatcher = new DowncastDispatcher( {\r\n\t\t\tmapper: this.mapper\r\n\t\t} );\r\n\t\tthis.downcastDispatcher.on( 'insert:$text', insertText(), { priority: 'lowest' } );\r\n\r\n\t\t/**\r\n\t\t * Upcast dispatcher used by the {@link #set set method}. Upcast converters should be attached to it.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/upcastdispatcher~UpcastDispatcher}\r\n\t\t */\r\n\t\tthis.upcastDispatcher = new UpcastDispatcher( {\r\n\t\t\tschema: model.schema\r\n\t\t} );\r\n\r\n\t\t// Define default converters for text and elements.\r\n\t\t//\r\n\t\t// Note that if there is no default converter for the element it will be skipped, for instance `<b>foo</b>` will be\r\n\t\t// converted to nothing. We add `convertToModelFragment` as a last converter so it converts children of that\r\n\t\t// element to the document fragment so `<b>foo</b>` will be converted to `foo` if there is no converter for `<b>`.\r\n\t\tthis.upcastDispatcher.on( 'text', convertText(), { priority: 'lowest' } );\r\n\t\tthis.upcastDispatcher.on( 'element', convertToModelFragment(), { priority: 'lowest' } );\r\n\t\tthis.upcastDispatcher.on( 'documentFragment', convertToModelFragment(), { priority: 'lowest' } );\r\n\r\n\t\tthis.decorate( 'init' );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the model's data converted by downcast dispatchers attached to {@link #downcastDispatcher} and\r\n\t * formatted by the {@link #processor data processor}.\r\n\t *\r\n\t * @param {String} [rootName='main'] Root name.\r\n\t * @returns {String} Output data.\r\n\t */\r\n\tget( rootName = 'main' ) {\r\n\t\t// Get model range.\r\n\t\treturn this.stringify( this.model.document.getRoot( rootName ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the content of the given {@link module:engine/model/element~Element model's element} or\r\n\t * {@link module:engine/model/documentfragment~DocumentFragment model document fragment} converted by the downcast converters\r\n\t * attached to {@link #downcastDispatcher} and formatted by the {@link #processor data processor}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} modelElementOrFragment\r\n\t * Element whose content will be stringified.\r\n\t * @returns {String} Output data.\r\n\t */\r\n\tstringify( modelElementOrFragment ) {\r\n\t\t// Model -> view.\r\n\t\tconst viewDocumentFragment = this.toView( modelElementOrFragment );\r\n\r\n\t\t// View -> data.\r\n\t\treturn this.processor.toData( viewDocumentFragment );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the content of the given {@link module:engine/model/element~Element model element} or\r\n\t * {@link module:engine/model/documentfragment~DocumentFragment model document fragment} converted by the downcast\r\n\t * converters attached to {@link #downcastDispatcher} to a\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment view document fragment}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} modelElementOrFragment\r\n\t * Element or document fragment whose content will be converted.\r\n\t * @returns {module:engine/view/documentfragment~DocumentFragment} Output view DocumentFragment.\r\n\t */\r\n\ttoView( modelElementOrFragment ) {\r\n\t\t// Clear bindings so the call to this method gives correct results.\r\n\t\tthis.mapper.clearBindings();\r\n\r\n\t\t// First, convert elements.\r\n\t\tconst modelRange = ModelRange._createIn( modelElementOrFragment );\r\n\r\n\t\tconst viewDocumentFragment = new ViewDocumentFragment();\r\n\r\n\t\t// Create separate ViewDowncastWriter just for data conversion purposes.\r\n\t\t// We have no view controller and rendering do DOM in DataController so view.change() block is not used here.\r\n\t\tconst viewWriter = new ViewDowncastWriter( new ViewDocument() );\r\n\t\tthis.mapper.bindElements( modelElementOrFragment, viewDocumentFragment );\r\n\r\n\t\tthis.downcastDispatcher.convertInsert( modelRange, viewWriter );\r\n\r\n\t\tif ( !modelElementOrFragment.is( 'documentFragment' ) ) {\r\n\t\t\t// Then, if a document element is converted, convert markers.\r\n\t\t\t// From all document markers, get those, which \"intersect\" with the converter element.\r\n\t\t\tconst markers = _getMarkersRelativeToElement( modelElementOrFragment );\r\n\r\n\t\t\tfor ( const [ name, range ] of markers ) {\r\n\t\t\t\tthis.downcastDispatcher.convertMarkerAdd( name, range, viewWriter );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn viewDocumentFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets initial input data parsed by the {@link #processor data processor} and\r\n\t * converted by the {@link #upcastDispatcher view-to-model converters}.\r\n\t * Initial data can be set only to document that {@link module:engine/model/document~Document#version} is equal 0.\r\n\t *\r\n\t * **Note** This method is {@link module:utils/observablemixin~ObservableMixin#decorate decorated} which is\r\n\t * used by e.g. collaborative editing plugin that syncs remote data on init.\r\n\t *\r\n\t * @fires init\r\n\t * @param {String} data Input data.\r\n\t * @param {String} [rootName='main'] Root name.\r\n\t * @returns {Promise} Promise that is resolved after the data is set on the editor.\r\n\t */\r\n\tinit( data, rootName = 'main' ) {\r\n\t\tif ( this.model.document.version ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot set initial data to not empty {@link module:engine/model/document~Document}.\r\n\t\t\t * Initial data should be set once, during {@link module:core/editor/editor~Editor} initialization,\r\n\t\t\t * when the {@link module:engine/model/document~Document#version} is equal 0.\r\n\t\t\t *\r\n\t\t\t * @error datacontroller-init-document-not-empty\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'datacontroller-init-document-not-empty: Trying to set initial data to not empty document.' );\r\n\t\t}\r\n\r\n\t\tconst modelRoot = this.model.document.getRoot( rootName );\r\n\r\n\t\tthis.model.enqueueChange( 'transparent', writer => {\r\n\t\t\twriter.insert( this.parse( data, modelRoot ), modelRoot, 0 );\r\n\t\t} );\r\n\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets input data parsed by the {@link #processor data processor} and\r\n\t * converted by the {@link #upcastDispatcher view-to-model converters}.\r\n\t * This method can be used any time to replace existing editor data by the new one without clearing the\r\n\t * {@link module:engine/model/document~Document#history document history}.\r\n\t *\r\n\t * This method also creates a batch with all the changes applied. If all you need is to parse data, use\r\n\t * the {@link #parse} method.\r\n\t *\r\n\t * @param {String} data Input data.\r\n\t * @param {String} [rootName='main'] Root name.\r\n\t */\r\n\tset( data, rootName = 'main' ) {\r\n\t\t// Save to model.\r\n\t\tconst modelRoot = this.model.document.getRoot( rootName );\r\n\r\n\t\tthis.model.enqueueChange( 'transparent', writer => {\r\n\t\t\twriter.setSelection( null );\r\n\t\t\twriter.removeSelectionAttribute( this.model.document.selection.getAttributeKeys() );\r\n\r\n\t\t\twriter.remove( writer.createRangeIn( modelRoot ) );\r\n\t\t\twriter.insert( this.parse( data, modelRoot ), modelRoot, 0 );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the data parsed by the {@link #processor data processor} and then converted by upcast converters\r\n\t * attached to the {@link #upcastDispatcher}.\r\n\t *\r\n\t * @see #set\r\n\t * @param {String} data Data to parse.\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} [context='$root'] Base context in which the view will\r\n\t * be converted to the model. See: {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher#convert}.\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment} Parsed data.\r\n\t */\r\n\tparse( data, context = '$root' ) {\r\n\t\t// data -> view\r\n\t\tconst viewDocumentFragment = this.processor.toView( data );\r\n\r\n\t\t// view -> model\r\n\t\treturn this.toModel( viewDocumentFragment, context );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the result of the given {@link module:engine/view/element~Element view element} or\r\n\t * {@link module:engine/view/documentfragment~DocumentFragment view document fragment} converted by the\r\n\t * {@link #upcastDispatcher view-to-model converters}, wrapped by {@link module:engine/model/documentfragment~DocumentFragment}.\r\n\t *\r\n\t * When marker elements were converted during the conversion process, it will be set as a document fragment's\r\n\t * {@link module:engine/model/documentfragment~DocumentFragment#markers static markers map}.\r\n\t *\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} viewElementOrFragment\r\n\t * Element or document fragment whose content will be converted.\r\n\t * @param {module:engine/model/schema~SchemaContextDefinition} [context='$root'] Base context in which the view will\r\n\t * be converted to the model. See: {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher#convert}.\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment} Output document fragment.\r\n\t */\r\n\ttoModel( viewElementOrFragment, context = '$root' ) {\r\n\t\treturn this.model.change( writer => {\r\n\t\t\treturn this.upcastDispatcher.convert( viewElementOrFragment, writer, context );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all event listeners set by the DataController.\r\n\t */\r\n\tdestroy() {}\r\n\r\n\t/**\r\n\t * Event fired by decorated {@link #init} method.\r\n\t * See {@link module:utils/observablemixin~ObservableMixin.decorate} for more information and samples.\r\n\t *\r\n\t * @event init\r\n\t */\r\n}\r\n\r\nmix( DataController, ObservableMixin );\r\n\r\n// Helper function for downcast conversion.\r\n//\r\n// Takes a document element (element that is added to a model document) and checks which markers are inside it\r\n// and which markers are containing it. If the marker is intersecting with element, the intersection is returned.\r\nfunction _getMarkersRelativeToElement( element ) {\r\n\tconst result = [];\r\n\tconst doc = element.root.document;\r\n\r\n\tif ( !doc ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst elementRange = ModelRange._createIn( element );\r\n\r\n\tfor ( const marker of doc.model.markers ) {\r\n\t\tconst intersection = elementRange.getIntersection( marker.getRange() );\r\n\r\n\t\tif ( intersection ) {\r\n\t\t\tresult.push( [ marker.name, intersection ] );\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/conversion/conversion\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\nimport {\r\n\tdowncastElementToElement,\r\n\tdowncastAttributeToElement,\r\n\tdowncastAttributeToAttribute\r\n} from './downcast-converters';\r\n\r\nimport {\r\n\tupcastElementToElement,\r\n\tupcastElementToAttribute,\r\n\tupcastAttributeToAttribute\r\n} from './upcast-converters';\r\n\r\n/**\r\n * A utility class that helps add converters to upcast and downcast dispatchers.\r\n *\r\n * We recommend reading the {@glink framework/guides/architecture/editing-engine Editing engine architecture} guide first to\r\n * understand the core concepts of the conversion mechanisms.\r\n *\r\n * The instance of the conversion manager is available in the\r\n * {@link module:core/editor/editor~Editor#conversion `editor.conversion`} property\r\n * and by default has the following groups of dispatchers (i.e. directions of conversion):\r\n *\r\n * * `downcast` (editing and data downcasts)\r\n * * `editingDowncast`\r\n * * `dataDowncast`\r\n * * `upcast`\r\n *\r\n * To add a converter to a specific group, use the {@link module:engine/conversion/conversion~Conversion#for `for()`}\r\n * method:\r\n *\r\n *\t\t// Add a converter to editing downcast and data downcast.\r\n *\t\teditor.conversion.for( 'downcast' ).add( downcastElementToElement( config ) );\r\n *\r\n *\t\t// Add a converter to the data pipepline only:\r\n *\t\teditor.conversion.for( 'dataDowncast' ).add( downcastElementToElement( dataConversionConfig ) );\r\n *\t\t// And a slightly different one for the editing pipeline:\r\n *\t\teditor.conversion.for( 'editingDowncast' ).add( downcastElementToElement( editingConversionConfig ) );\r\n *\r\n * The functions used in `add()` calls are one-way converters (i.e. you need to remember yourself to add\r\n * a converter in the other direction, if your feature requires that). They are also called \"conversion helpers\".\r\n * You can find a set of them in the {@link module:engine/conversion/downcast-converters} and\r\n * {@link module:engine/conversion/upcast-converters} modules.\r\n *\r\n * Besides allowing to register converters to specific dispatchers, you can also use methods available in this\r\n * class to add two-way converters (upcast and downcast):\r\n *\r\n * * {@link module:engine/conversion/conversion~Conversion#elementToElement `elementToElement()`} &ndash;\r\n * Model element to view element and vice versa.\r\n * * {@link module:engine/conversion/conversion~Conversion#attributeToElement `attributeToElement()`} &ndash;\r\n * Model attribute to view element and vice versa.\r\n * * {@link module:engine/conversion/conversion~Conversion#attributeToAttribute `attributeToAttribute()`} &ndash;\r\n * Model attribute to view element and vice versa.\r\n */\r\nexport default class Conversion {\r\n\t/**\r\n\t * Creates a new conversion instance.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._dispatchersGroups = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Registers one or more converters under a given group name. The group name can then be used to assign a converter\r\n\t * to multiple dispatchers at once.\r\n\t *\r\n\t * If a given group name is used for the second time, the\r\n\t * {@link module:utils/ckeditorerror~CKEditorError `conversion-register-group-exists` error} is thrown.\r\n\t *\r\n\t * @param {String} groupName The name for dispatchers group.\r\n\t * @param {Array.<module:engine/conversion/downcastdispatcher~DowncastDispatcher|\r\n\t * module:engine/conversion/upcastdispatcher~UpcastDispatcher>} dispatchers Dispatchers to register\r\n\t * under the given name.\r\n\t */\r\n\tregister( groupName, dispatchers ) {\r\n\t\tif ( this._dispatchersGroups.has( groupName ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to register a group name that was already registered.\r\n\t\t\t *\r\n\t\t\t * @error conversion-register-group-exists\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'conversion-register-group-exists: Trying to register a group name that was already registered.' );\r\n\t\t}\r\n\r\n\t\tthis._dispatchersGroups.set( groupName, dispatchers );\r\n\t}\r\n\r\n\t/**\r\n\t * Provides chainable API to assign converters to dispatchers registered under a given group name. Converters are added\r\n\t * by calling the `.add()` method of an object returned by this function.\r\n\t *\r\n\t *\t\tconversion.for( 'downcast' )\r\n\t *\t\t\t.add( conversionHelperA )\r\n\t *\t\t\t.add( conversionHelperB );\r\n\t *\r\n\t * In this example `conversionHelperA` and `conversionHelperB` will be called for all dispatchers from the `'model'` group.\r\n\t *\r\n\t * The `.add()` method takes exactly one parameter, which is a function. This function should accept one parameter that\r\n\t * is a dispatcher instance. The function should add an actual converter to the passed dispatcher instance.\r\n\t *\r\n\t * Conversion helpers for most common cases are already provided. They are flexible enough to cover most use cases.\r\n\t * See the documentation to learn how they can be configured.\r\n\t *\r\n\t * For downcast (model-to-view conversion), these are:\r\n\t *\r\n\t * * {@link module:engine/conversion/downcast-converters~downcastElementToElement Downcast element-to-element converter},\r\n\t * * {@link module:engine/conversion/downcast-converters~downcastAttributeToElement Downcast attribute-to-element converter},\r\n\t * * {@link module:engine/conversion/downcast-converters~downcastAttributeToAttribute Downcast attribute-to-attribute converter}.\r\n\t *\r\n\t * For upcast (view-to-model conversion), these are:\r\n\t *\r\n\t * * {@link module:engine/conversion/upcast-converters~upcastElementToElement Upcast element-to-element converter},\r\n\t * * {@link module:engine/conversion/upcast-converters~upcastElementToAttribute Upcast attribute-to-element converter},\r\n\t * * {@link module:engine/conversion/upcast-converters~upcastAttributeToAttribute Upcast attribute-to-attribute converter}.\r\n\t *\r\n\t * An example of using conversion helpers to convert the `paragraph` model element to the `p` view element (and back):\r\n\t *\r\n\t *\t\t// Define conversion configuration - model element 'paragraph' should be converted to view element 'p'.\r\n\t *\t\tconst config = { model: 'paragraph', view: 'p' };\r\n\t *\r\n\t *\t\t// Add converters to proper dispatchers using conversion helpers.\r\n\t *\t\tconversion.for( 'downcast' ).add( downcastElementToElement( config ) );\r\n\t *\t\tconversion.for( 'upcast' ).add( upcastElementToElement( config ) );\r\n\t *\r\n\t * An example of providing a custom conversion helper that uses a custom converter function:\r\n\t *\r\n\t *\t\t// Adding a custom `myConverter` converter for 'paragraph' element insertion, with the default priority ('normal').\r\n\t *\t\tconversion.for( 'downcast' ).add( conversion.customConverter( 'insert:paragraph', myConverter ) );\r\n\t *\r\n\t * @param {String} groupName The name of dispatchers group to add the converters to.\r\n\t * @returns {Object} An object with the `.add()` method, providing a way to add converters.\r\n\t */\r\n\tfor( groupName ) {\r\n\t\tconst dispatchers = this._getDispatchers( groupName );\r\n\r\n\t\treturn {\r\n\t\t\tadd( conversionHelper ) {\r\n\t\t\t\t_addToDispatchers( dispatchers, conversionHelper );\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up converters between the model and the view that convert a model element to a view element (and vice versa).\r\n\t * For example, the model `<paragraph>Foo</paragraph>` is `<p>Foo</p>` in the view.\r\n\t *\r\n\t *\t\t// A simple conversion from the `paragraph` model element to the `<p>` view element (and vice versa).\r\n\t *\t\tconversion.elementToElement( { model: 'paragraph', view: 'p' } );\r\n\t *\r\n\t *\t\t// Override other converters by specifying a converter definition with a higher priority.\r\n\t *\t\tconversion.elementToElement( { model: 'paragraph', view: 'div', converterPriority: 'high' } );\r\n\t *\r\n\t *\t\t// View specified as an object instead of a string.\r\n\t *\t\tconversion.elementToElement( {\r\n\t *\t\t\tmodel: 'fancyParagraph',\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\tname: 'p',\r\n\t *\t\t\t\tclasses: 'fancy'\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Use `upcastAlso` to define other view elements that should also be converted to a `paragraph` element.\r\n\t *\t\tconversion.elementToElement( {\r\n\t *\t\t\tmodel: 'paragraph',\r\n\t *\t\t\tview: 'p',\r\n\t *\t\t\tupcastAlso: [\r\n\t *\t\t\t\t'div',\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\t// Any element with the `display: block` style.\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\tdisplay: 'block'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// `upcastAlso` set as callback enables a conversion of a wide range of different view elements.\r\n\t *\t\tconversion.elementToElement( {\r\n\t *\t\t\tmodel: 'heading',\r\n\t *\t\t\tview: 'h2',\r\n\t *\t\t\t// Convert \"headling-like\" paragraphs to headings.\r\n\t *\t\t\tupcastAlso: viewElement => {\r\n\t *\t\t\t\tconst fontSize = viewElement.getStyle( 'font-size' );\r\n\t *\r\n\t *\t\t\t\tif ( !fontSize ) {\r\n\t *\t\t\t\t\treturn null;\r\n\t *\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\tconst match = fontSize.match( /(\\d+)\\s*px/ );\r\n\t *\r\n\t *\t\t\t\tif ( !match ) {\r\n\t *\t\t\t\t\treturn null;\r\n\t *\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\tconst size = Number( match[ 1 ] );\r\n\t *\r\n\t *\t\t\t\tif ( size > 26 ) {\r\n\t *\t\t\t\t\t// Returned value can be an object with the matched properties.\r\n\t *\t\t\t\t\t// These properties will be \"consumed\" during the conversion.\r\n\t *\t\t\t\t\t// See `engine.view.Matcher~MatcherPattern` and `engine.view.Matcher#match` for more details.\r\n\t *\r\n\t *\t\t\t\t\treturn { name: true, styles: [ 'font-size' ] };\r\n\t *\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\treturn null;\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * `definition.model` is a `String` with a model element name to convert from or to.\r\n\t * See {@link module:engine/conversion/conversion~ConverterDefinition} to learn about other parameters.\r\n\t *\r\n\t * @param {module:engine/conversion/conversion~ConverterDefinition} definition The converter definition.\r\n\t */\r\n\telementToElement( definition ) {\r\n\t\t// Set up downcast converter.\r\n\t\tthis.for( 'downcast' ).add( downcastElementToElement( definition ) );\r\n\r\n\t\t// Set up upcast converter.\r\n\t\tfor ( const { model, view } of _getAllUpcastDefinitions( definition ) ) {\r\n\t\t\tthis.for( 'upcast' ).add(\r\n\t\t\t\tupcastElementToElement( {\r\n\t\t\t\t\tmodel,\r\n\t\t\t\t\tview,\r\n\t\t\t\t\tconverterPriority: definition.converterPriority\r\n\t\t\t\t} )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up converters between the model and the view that convert a model attribute to a view element (and vice versa).\r\n\t * For example, a model text node with `\"Foo\"` as data and the `bold` attribute is `<strong>Foo</strong>` in the view.\r\n\t *\r\n\t *\t\t// A simple conversion from the `bold=true` attribute to the `<strong>` view element (and vice versa).\r\n\t *\t\tconversion.attributeToElement( { model: 'bold', view: 'strong' } );\r\n\t *\r\n\t *\t\t// Override other converters by specifying a converter definition with a higher priority.\r\n\t *\t\tconversion.attributeToElement( { model: 'bold', view: 'b', converterPriority: 'high' } );\r\n\t *\r\n\t *\t\t// View specified as an object instead of a string.\r\n\t *\t\tconversion.attributeToElement( {\r\n\t *\t\t\tmodel: 'bold',\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\tname: 'span',\r\n\t *\t\t\t\tclasses: 'bold'\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Use `config.model.name` to define the conversion only from a given node type, `$text` in this case.\r\n\t *\t\t// The same attribute on different elements may then be handled by a different converter.\r\n\t *\t\tconversion.attributeToElement( {\r\n\t *\t\t\tmodel: {\r\n\t *\t\t\t\tkey: 'textDecoration',\r\n\t *\t\t\t\tvalues: [ 'underline', 'lineThrough' ],\r\n\t *\t\t\t\tname: '$text'\r\n\t *\t\t\t},\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\tunderline: {\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'text-decoration': 'underline'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tlineThrough: {\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'text-decoration': 'line-through'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Use `upcastAlso` to define other view elements that should also be converted to the `bold` attribute.\r\n\t *\t\tconversion.attributeToElement( {\r\n\t *\t\t\tmodel: 'bold',\r\n\t *\t\t\tview: 'strong',\r\n\t *\t\t\tupcastAlso: [\r\n\t *\t\t\t\t'b',\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tclasses: 'bold'\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'font-weight': 'bold'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tviewElement => {\r\n\t *\t\t\t\t\tconst fontWeight = viewElement.getStyle( 'font-weight' );\r\n\t *\r\n\t *\t\t\t\t\tif ( viewElement.is( 'span' ) && fontWeight && /\\d+/.test() && Number( fontWeight ) > 500 ) {\r\n\t *\t\t\t\t\t\t// Returned value can be an object with the matched properties.\r\n\t *\t\t\t\t\t\t// These properties will be \"consumed\" during the conversion.\r\n\t *\t\t\t\t\t\t// See `engine.view.Matcher~MatcherPattern` and `engine.view.Matcher#match` for more details.\r\n\t *\r\n\t *\t\t\t\t\t\treturn {\r\n\t *\t\t\t\t\t\t\tname: true,\r\n\t *\t\t\t\t\t\t\tstyles: [ 'font-weight' ]\r\n\t *\t\t\t\t\t\t};\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Conversion from and to a model attribute key whose value is an enum (`fontSize=big|small`).\r\n\t *\t\t// `upcastAlso` set as callback enables a conversion of a wide range of different view elements.\r\n\t *\t\tconversion.attributeToElement( {\r\n\t *\t\t\tmodel: {\r\n\t *\t\t\t\tkey: 'fontSize',\r\n\t *\t\t\t\tvalues: [ 'big', 'small' ]\r\n\t *\t\t\t},\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\tbig: {\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'font-size': '1.2em'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tsmall: {\r\n\t *\t\t\t\t\tname: 'span',\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'font-size': '0.8em'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t},\r\n\t *\t\t\tupcastAlso: {\r\n\t *\t\t\t\tbig: viewElement => {\r\n\t *\t\t\t\t\tconst fontSize = viewElement.getStyle( 'font-size' );\r\n\t *\r\n\t *\t\t\t\t\tif ( !fontSize ) {\r\n\t *\t\t\t\t\t\treturn null;\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\tconst match = fontSize.match( /(\\d+)\\s*px/ );\r\n\t *\r\n\t *\t\t\t\t\tif ( !match ) {\r\n\t *\t\t\t\t\t\treturn null;\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\tconst size = Number( match[ 1 ] );\r\n\t *\r\n\t *\t\t\t\t\tif ( viewElement.is( 'span' ) && size > 10 ) {\r\n\t *\t\t\t\t\t\t// Returned value can be an object with the matched properties.\r\n\t *\t\t\t\t\t\t// These properties will be \"consumed\" during the conversion.\r\n\t *\t\t\t\t\t\t// See `engine.view.Matcher~MatcherPattern` and `engine.view.Matcher#match` for more details.\r\n\t *\r\n\t *\t\t\t\t\t\treturn { name: true, styles: [ 'font-size' ] };\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\treturn null;\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tsmall: viewElement => {\r\n\t *\t\t\t\t\tconst fontSize = viewElement.getStyle( 'font-size' );\r\n\t *\r\n\t *\t\t\t\t\tif ( !fontSize ) {\r\n\t *\t\t\t\t\t\treturn null;\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\tconst match = fontSize.match( /(\\d+)\\s*px/ );\r\n\t *\r\n\t *\t\t\t\t\tif ( !match ) {\r\n\t *\t\t\t\t\t\treturn null;\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\tconst size = Number( match[ 1 ] );\r\n\t *\r\n\t *\t\t\t\t\tif ( viewElement.is( 'span' ) && size < 10 ) {\r\n\t *\t\t\t\t\t\t// Returned value can be an object with the matched properties.\r\n\t *\t\t\t\t\t\t// These properties will be \"consumed\" during the conversion.\r\n\t *\t\t\t\t\t\t// See `engine.view.Matcher~MatcherPattern` and `engine.view.Matcher#match` for more details.\r\n\t *\r\n\t *\t\t\t\t\t\treturn { name: true, styles: [ 'font-size' ] };\r\n\t *\t\t\t\t\t}\r\n\t *\r\n\t *\t\t\t\t\treturn null;\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * The `definition.model` parameter specifies which model attribute should be converted from or to. It can be a `{ key, value }` object\r\n\t * describing the attribute key and value to convert or a `String` specifying just the attribute key (then `value` is set to `true`).\r\n\t * See {@link module:engine/conversion/conversion~ConverterDefinition} to learn about other parameters.\r\n\t *\r\n\t * @param {module:engine/conversion/conversion~ConverterDefinition} definition The converter definition.\r\n\t */\r\n\tattributeToElement( definition ) {\r\n\t\t// Set up downcast converter.\r\n\t\tthis.for( 'downcast' ).add( downcastAttributeToElement( definition ) );\r\n\r\n\t\t// Set up upcast converter.\r\n\t\tfor ( const { model, view } of _getAllUpcastDefinitions( definition ) ) {\r\n\t\t\tthis.for( 'upcast' ).add(\r\n\t\t\t\tupcastElementToAttribute( {\r\n\t\t\t\t\tview,\r\n\t\t\t\t\tmodel,\r\n\t\t\t\t\tpriority: definition.priority\r\n\t\t\t\t} )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up converters between the model and the view that convert a model attribute to a view attribute (and vice versa).\r\n\t * For example, `<image src='foo.jpg'></image>` is converted to `<img src='foo.jpg'></img>` (the same attribute key and value).\r\n\t * This type of converters is intended to be used with {@link module:engine/model/element~Element model element} nodes.\r\n\t * To convert text attributes {@link module:engine/conversion/conversion~Conversion#attributeToElement `attributeToElement converter`}\r\n\t * should be set up.\r\n\t *\r\n\t *\t\t// A simple conversion from the `source` model attribute to the `src` view attribute (and vice versa).\r\n\t *\t\tconversion.attributeToAttribute( { model: 'source', view: 'src' } );\r\n\t *\r\n\t *\t\t// Attribute values are strictly specified.\r\n\t *\t\tconversion.attributeToAttribute( {\r\n\t *\t\t\tmodel: {\r\n\t *\t\t\t\tname: 'image',\r\n\t *\t\t\t\tkey: 'aside',\r\n\t *\t\t\t\tvalues: [ 'aside' ]\r\n\t *\t\t\t},\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\taside: {\r\n\t *\t\t\t\t\tname: 'img',\r\n\t *\t\t\t\t\tkey: 'class',\r\n\t *\t\t\t\t\tvalue: [ 'aside', 'half-size' ]\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Set the style attribute.\r\n\t *\t\tconversion.attributeToAttribute( {\r\n\t *\t\t\tmodel: {\r\n\t *\t\t\t\tname: 'image',\r\n\t *\t\t\t\tkey: 'aside',\r\n\t *\t\t\t\tvalues: [ 'aside' ]\r\n\t *\t\t\t},\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\taside: {\r\n\t *\t\t\t\t\tname: 'img',\r\n\t *\t\t\t\t\tkey: 'style',\r\n\t *\t\t\t\t\tvalue: {\r\n\t *\t\t\t\t\t\tfloat: 'right',\r\n\t *\t\t\t\t\t\twidth: '50%',\r\n\t *\t\t\t\t\t\tmargin: '5px'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Conversion from and to a model attribute key whose value is an enum (`align=right|center`).\r\n\t *\t\t// Use `upcastAlso` to define other view elements that should also be converted to the `align=right` attribute.\r\n\t *\t\tconversion.attributeToAttribute( {\r\n\t *\t\t\tmodel: {\r\n\t *\t\t\t\tkey: 'align',\r\n\t *\t\t\t\tvalues: [ 'right', 'center' ]\r\n\t *\t\t\t},\r\n\t *\t\t\tview: {\r\n\t *\t\t\t\tright: {\r\n\t *\t\t\t\t\tkey: 'class',\r\n\t *\t\t\t\t\tvalue: 'align-right'\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tcenter: {\r\n\t *\t\t\t\t\tkey: 'class',\r\n\t *\t\t\t\t\tvalue: 'align-center'\r\n\t *\t\t\t\t}\r\n\t *\t\t\t},\r\n\t *\t\t\tupcastAlso: {\r\n\t *\t\t\t\tright: {\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'text-align': 'right'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tcenter: {\r\n\t *\t\t\t\t\tstyles: {\r\n\t *\t\t\t\t\t\t'text-align': 'center'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * The `definition.model` parameter specifies which model attribute should be converted from and to.\r\n\t * It can be a `{ key, [ values ], [ name ] }` object or a `String`, which will be treated like `{ key: definition.model }`.\r\n\t * The `key` property is the model attribute key to convert from and to.\r\n\t * The `values` are the possible model attribute values. If `values` is not set, the model attribute value will be the same as the\r\n\t * view attribute value.\r\n\t * If `name` is set, the conversion will be set up only for model elements with the given name.\r\n\t *\r\n\t * The `definition.view` parameter specifies which view attribute should be converted from and to.\r\n\t * It can be a `{ key, value, [ name ] }` object or a `String`, which will be treated like `{ key: definition.view }`.\r\n\t * The `key` property is the view attribute key to convert from and to.\r\n\t * The `value` is the view attribute value to convert from and to. If `definition.value` is not set, the view attribute value will be\r\n\t * the same as the model attribute value.\r\n\t * If `key` is `'class'`, `value` can be a `String` or an array of `String`s.\r\n\t * If `key` is `'style'`, `value` is an object with key-value pairs.\r\n\t * In other cases, `value` is a `String`.\r\n\t * If `name` is set, the conversion will be set up only for model elements with the given name.\r\n\t * If `definition.model.values` is set, `definition.view` is an object that assigns values from `definition.model.values`\r\n\t * to `{ key, value, [ name ] }` objects.\r\n\t *\r\n\t * `definition.upcastAlso` specifies which other matching view elements should also be upcast to the given model configuration.\r\n\t * If `definition.model.values` is set, `definition.upcastAlso` should be an object assigning values from `definition.model.values`\r\n\t * to {@link module:engine/view/matcher~MatcherPattern}s or arrays of {@link module:engine/view/matcher~MatcherPattern}s.\r\n\t *\r\n\t * **Note:** `definition.model` and `definition.view` form should be mirrored, so the same types of parameters should\r\n\t * be given in both parameters.\r\n\t *\r\n\t * @param {Object} definition The converter definition.\r\n\t * @param {String|Object} definition.model The model attribute to convert from and to.\r\n\t * @param {String|Object} definition.view The view attribute to convert from and to.\r\n\t * @param {module:engine/view/matcher~MatcherPattern|Array.<module:engine/view/matcher~MatcherPattern>} [definition.upcastAlso]\r\n\t * Any view element matching `definition.upcastAlso` will also be converted to the given model attribute. `definition.upcastAlso`\r\n\t * is used only if `config.model.values` is specified.\r\n\t */\r\n\tattributeToAttribute( definition ) {\r\n\t\t// Set up downcast converter.\r\n\t\tthis.for( 'downcast' ).add( downcastAttributeToAttribute( definition ) );\r\n\r\n\t\t// Set up upcast converter.\r\n\t\tfor ( const { model, view } of _getAllUpcastDefinitions( definition ) ) {\r\n\t\t\tthis.for( 'upcast' ).add(\r\n\t\t\t\tupcastAttributeToAttribute( {\r\n\t\t\t\t\tview,\r\n\t\t\t\t\tmodel\r\n\t\t\t\t} )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns dispatchers registered under a given group name.\r\n\t *\r\n\t * If the given group name has not been registered, the\r\n\t * {@link module:utils/ckeditorerror~CKEditorError `conversion-for-unknown-group` error} is thrown.\r\n\t *\r\n\t * @private\r\n\t * @param {String} groupName\r\n\t * @returns {Array.<module:engine/conversion/downcastdispatcher~DowncastDispatcher|\r\n\t * module:engine/conversion/upcastdispatcher~UpcastDispatcher>}\r\n\t */\r\n\t_getDispatchers( groupName ) {\r\n\t\tconst dispatchers = this._dispatchersGroups.get( groupName );\r\n\r\n\t\tif ( !dispatchers ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to add a converter to an unknown dispatchers group.\r\n\t\t\t *\r\n\t\t\t * @error conversion-for-unknown-group\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'conversion-for-unknown-group: Trying to add a converter to an unknown dispatchers group.' );\r\n\t\t}\r\n\r\n\t\treturn dispatchers;\r\n\t}\r\n}\r\n\r\n/**\r\n * Defines how the model should be converted from and to the view.\r\n *\r\n * @typedef {Object} module:engine/conversion/conversion~ConverterDefinition\r\n *\r\n * @property {*} [model] The model conversion definition. Describes the model element or model attribute to convert. This parameter differs\r\n * for different functions that accept `ConverterDefinition`. See the description of the function to learn how to set it.\r\n * @property {module:engine/view/elementdefinition~ElementDefinition|Object} view The definition of the view element to convert from and\r\n * to. If `model` describes multiple values, `view` is an object that assigns these values (`view` object keys) to view element definitions\r\n * (`view` object values).\r\n * @property {module:engine/view/matcher~MatcherPattern|Array.<module:engine/view/matcher~MatcherPattern>} [upcastAlso]\r\n * Any view element matching `upcastAlso` will also be converted to the model. If `model` describes multiple values, `upcastAlso`\r\n * is an object that assigns these values (`upcastAlso` object keys) to {@link module:engine/view/matcher~MatcherPattern}s\r\n * (`upcastAlso` object values).\r\n * @property {module:utils/priorities~PriorityString} [converterPriority] The converter priority.\r\n */\r\n\r\n// Helper function for the `Conversion` `.add()` method.\r\n//\r\n// Calls `conversionHelper` on each dispatcher from the group specified earlier in the `.for()` call, effectively\r\n// adding converters to all specified dispatchers.\r\n//\r\n// @private\r\n// @param {Array.<module:engine/conversion/downcastdispatcher~DowncastDispatcher|\r\n// module:engine/conversion/upcastdispatcher~UpcastDispatcher>} dispatchers\r\n// @param {Function} conversionHelper\r\nfunction _addToDispatchers( dispatchers, conversionHelper ) {\r\n\tfor ( const dispatcher of dispatchers ) {\r\n\t\tconversionHelper( dispatcher );\r\n\t}\r\n}\r\n\r\n// Helper function that creates a joint array out of an item passed in `definition.view` and items passed in\r\n// `definition.upcastAlso`.\r\n//\r\n// @param {module:engine/conversion/conversion~ConverterDefinition} definition\r\n// @returns {Array} Array containing view definitions.\r\nfunction* _getAllUpcastDefinitions( definition ) {\r\n\tif ( definition.model.values ) {\r\n\t\tfor ( const value of definition.model.values ) {\r\n\t\t\tconst model = { key: definition.model.key, value };\r\n\t\t\tconst view = definition.view[ value ];\r\n\t\t\tconst upcastAlso = definition.upcastAlso ? definition.upcastAlso[ value ] : undefined;\r\n\r\n\t\t\tyield* _getUpcastDefinition( model, view, upcastAlso );\r\n\t\t}\r\n\t} else {\r\n\t\tyield* _getUpcastDefinition( definition.model, definition.view, definition.upcastAlso );\r\n\t}\r\n}\r\n\r\nfunction* _getUpcastDefinition( model, view, upcastAlso ) {\r\n\tyield { model, view };\r\n\r\n\tif ( upcastAlso ) {\r\n\t\tupcastAlso = Array.isArray( upcastAlso ) ? upcastAlso : [ upcastAlso ];\r\n\r\n\t\tfor ( const upcastAlsoItem of upcastAlso ) {\r\n\t\t\tyield { model, view: upcastAlsoItem };\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/batch\r\n */\r\n\r\n/**\r\n * A batch instance groups model changes ({@link module:engine/model/operation/operation~Operation operations}). All operations\r\n * grouped in a single batch can be reverted together, so you can also think about a batch as of a single undo step. If you want\r\n * to extend a given undo step, you can add more changes to the batch using {@link module:engine/model/model~Model#enqueueChange}:\r\n *\r\n *\t\tmodel.enqueueChange( batch, writer => {\r\n *\t\t\twriter.insertText( 'foo', paragraph, 'end' );\r\n *\t\t} );\r\n *\r\n * @see module:engine/model/model~Model#enqueueChange\r\n * @see module:engine/model/model~Model#change\r\n */\r\nexport default class Batch {\r\n\t/**\r\n\t * Creates a batch instance.\r\n\t *\r\n\t * @see module:engine/model/model~Model#enqueueChange\r\n\t * @see module:engine/model/model~Model#change\r\n\t * @param {'transparent'|'default'} [type='default'] The type of the batch.\r\n\t */\r\n\tconstructor( type = 'default' ) {\r\n\t\t/**\r\n\t\t * An array of operations that compose this batch.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @type {Array.<module:engine/model/operation/operation~Operation>}\r\n\t\t */\r\n\t\tthis.operations = [];\r\n\r\n\t\t/**\r\n\t\t * The type of the batch.\r\n\t\t *\r\n\t\t * It can be one of the following values:\r\n\t\t * * `'default'` &ndash; All \"normal\" batches. This is the most commonly used type.\r\n\t\t * * `'transparent'` &ndash; A batch that should be ignored by other features, i.e. an initial batch or collaborative editing\r\n\t\t * changes.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @type {'transparent'|'default'}\r\n\t\t */\r\n\t\tthis.type = type;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the base version of this batch, which is equal to the base version of the first operation in the batch.\r\n\t * If there are no operations in the batch or neither operation has the base version set, it returns `null`.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number|null}\r\n\t */\r\n\tget baseVersion() {\r\n\t\tfor ( const op of this.operations ) {\r\n\t\t\tif ( op.baseVersion !== null ) {\r\n\t\t\t\treturn op.baseVersion;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an operation to the batch instance.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation An operation to add.\r\n\t * @returns {module:engine/model/operation/operation~Operation} The added operation.\r\n\t */\r\n\taddOperation( operation ) {\r\n\t\toperation.batch = this;\r\n\t\tthis.operations.push( operation );\r\n\r\n\t\treturn operation;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/operation\r\n */\r\n\r\n/**\r\n * Abstract base operation class.\r\n *\r\n * @abstract\r\n */\r\nexport default class Operation {\r\n\t/**\r\n\t * Base operation constructor.\r\n\t *\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( baseVersion ) {\r\n\t\t/**\r\n\t\t * {@link module:engine/model/document~Document#version} on which operation can be applied. If you try to\r\n\t\t * {@link module:engine/model/model~Model#applyOperation apply} operation with different base version than the\r\n\t\t * {@link module:engine/model/document~Document#version document version} the\r\n\t\t * {@link module:utils/ckeditorerror~CKEditorError model-document-applyOperation-wrong-version} error is thrown.\r\n\t\t *\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.baseVersion = baseVersion;\r\n\r\n\t\t/**\r\n\t\t * Defines whether operation is executed on attached or detached {@link module:engine/model/item~Item items}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #isDocumentOperation\r\n\t\t */\r\n\t\tthis.isDocumentOperation = this.baseVersion !== null;\r\n\r\n\t\t/**\r\n\t\t * {@link module:engine/model/batch~Batch Batch} to which the operation is added or `null` if the operation is not\r\n\t\t * added to any batch yet.\r\n\t\t *\r\n\t\t * @member {module:engine/model/batch~Batch|null} #batch\r\n\t\t */\r\n\t\tthis.batch = null;\r\n\r\n\t\t/**\r\n\t\t * Operation type.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} #type\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t\t *\r\n\t\t * @method #clone\r\n\t\t * @returns {module:engine/model/operation/operation~Operation} Clone of this operation.\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Creates and returns a reverse operation. Reverse operation when executed right after\r\n\t\t * the original operation will bring back tree model state to the point before the original\r\n\t\t * operation execution. In other words, it reverses changes done by the original operation.\r\n\t\t *\r\n\t\t * Keep in mind that tree model state may change since executing the original operation,\r\n\t\t * so reverse operation will be \"outdated\". In that case you will need to transform it by\r\n\t\t * all operations that were executed after the original operation.\r\n\t\t *\r\n\t\t * @method #getReversed\r\n\t\t * @returns {module:engine/model/operation/operation~Operation} Reversed operation.\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Executes the operation - modifications described by the operation properties will be applied to the model tree.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @method #_execute\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the operation's parameters are correct and the operation can be correctly executed. Throws\r\n\t * an error if operation is not valid.\r\n\t *\r\n\t * @protected\r\n\t * @method #_validate\r\n\t */\r\n\t_validate() {\r\n\t}\r\n\r\n\t/**\r\n\t * Custom toJSON method to solve child-parent circular dependencies.\r\n\t *\r\n\t * @method #toJSON\r\n\t * @returns {Object} Clone of this object with the operation property replaced with string.\r\n\t */\r\n\ttoJSON() {\r\n\t\t// This method creates only a shallow copy, all nested objects should be defined separately.\r\n\t\t// See https://github.com/ckeditor/ckeditor5-engine/issues/1477.\r\n\t\tconst json = Object.assign( {}, this );\r\n\r\n\t\tjson.__className = this.constructor.className;\r\n\r\n\t\t// Remove reference to the parent `Batch` to avoid circular dependencies.\r\n\t\tdelete json.batch;\r\n\r\n\t\t// Only document operations are shared with other clients so it is not necessary to keep this information.\r\n\t\tdelete json.isDocumentOperation;\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Name of the operation class used for serialization.\r\n\t *\r\n\t * @type {String}\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'Operation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates Operation object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} doc Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/operation~Operation}\r\n\t */\r\n\tstatic fromJSON( json ) {\r\n\t\treturn new this( json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module module:engine/model/documentfragment\r\n */\r\n\r\nimport NodeList from './nodelist';\r\nimport Element from './element';\r\nimport Text from './text';\r\nimport TextProxy from './textproxy';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\n\r\n/**\r\n * DocumentFragment represents a part of model which does not have a common root but it's top-level nodes\r\n * can be seen as siblings. In other words, it is a detached part of model tree, without a root.\r\n *\r\n * DocumentFragment has own {@link module:engine/model/markercollection~MarkerCollection}. Markers from this collection\r\n * will be set to the {@link module:engine/model/model~Model#markers model markers} by a\r\n * {@link module:engine/model/writer~Writer#insert} function.\r\n */\r\nexport default class DocumentFragment {\r\n\t/**\r\n\t * Creates an empty `DocumentFragment`.\r\n\t *\r\n\t * **Note:** Constructor of this class shouldn't be used directly in the code.\r\n\t * Use the {@link module:engine/model/writer~Writer#createDocumentFragment} method instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/node~Node|Iterable.<module:engine/model/node~Node>} [children]\r\n\t * Nodes to be contained inside the `DocumentFragment`.\r\n\t */\r\n\tconstructor( children ) {\r\n\t\t/**\r\n\t\t * DocumentFragment static markers map. This is a list of names and {@link module:engine/model/range~Range ranges}\r\n\t\t * which will be set as Markers to {@link module:engine/model/model~Model#markers model markers collection}\r\n\t\t * when DocumentFragment will be inserted to the document.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Map<String,module:engine/model/range~Range>} module:engine/model/documentfragment~DocumentFragment#markers\r\n\t\t */\r\n\t\tthis.markers = new Map();\r\n\r\n\t\t/**\r\n\t\t * List of nodes contained inside the document fragment.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/nodelist~NodeList} module:engine/model/documentfragment~DocumentFragment#_children\r\n\t\t */\r\n\t\tthis._children = new NodeList();\r\n\r\n\t\tif ( children ) {\r\n\t\t\tthis._insertChild( 0, children );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all nodes contained inside this document fragment.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/node~Node>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this.getChildren();\r\n\t}\r\n\r\n\t/**\r\n\t * Number of this document fragment's children.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget childCount() {\r\n\t\treturn this._children.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Sum of {@link module:engine/model/node~Node#offsetSize offset sizes} of all of this document fragment's children.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Number}\r\n\t */\r\n\tget maxOffset() {\r\n\t\treturn this._children.maxOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Is `true` if there are no nodes inside this document fragment, `false` otherwise.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isEmpty() {\r\n\t\treturn this.childCount === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial root of `DocumentFragment`. Returns itself. Added for compatibility reasons.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tget root() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial parent of `DocumentFragment`. Returns `null`. Added for compatibility reasons.\r\n\t *\r\n\t * @readonly\r\n\t * @type {null}\r\n\t */\r\n\tget parent() {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given model tree object is of given type.\r\n\t *\r\n\t * Read more in {@link module:engine/model/node~Node#is}.\r\n\t *\r\n\t * @param {String} type\r\n\t * @returns {Boolean}\r\n\t */\r\n\tis( type ) {\r\n\t\treturn type == 'documentFragment';\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the child at the given index. Returns `null` if incorrect index was passed.\r\n\t *\r\n\t * @param {Number} index Index of child.\r\n\t * @returns {module:engine/model/node~Node|null} Child node.\r\n\t */\r\n\tgetChild( index ) {\r\n\t\treturn this._children.getNode( index );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that iterates over all of this document fragment's children.\r\n\t *\r\n\t * @returns {Iterable.<module:engine/model/node~Node>}\r\n\t */\r\n\tgetChildren() {\r\n\t\treturn this._children[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an index of the given child node. Returns `null` if given node is not a child of this document fragment.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Child node to look for.\r\n\t * @returns {Number|null} Child node's index.\r\n\t */\r\n\tgetChildIndex( node ) {\r\n\t\treturn this._children.getNodeIndex( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the starting offset of given child. Starting offset is equal to the sum of\r\n\t * {@link module:engine/model/node~Node#offsetSize offset sizes} of all node's siblings that are before it. Returns `null` if\r\n\t * given node is not a child of this document fragment.\r\n\t *\r\n\t * @param {module:engine/model/node~Node} node Child node to look for.\r\n\t * @returns {Number|null} Child node's starting offset.\r\n\t */\r\n\tgetChildStartOffset( node ) {\r\n\t\treturn this._children.getNodeStartOffset( node );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns path to a `DocumentFragment`, which is an empty array. Added for compatibility reasons.\r\n\t *\r\n\t * @returns {Array}\r\n\t */\r\n\tgetPath() {\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a descendant node by its path relative to this element.\r\n\t *\r\n\t *\t\t// <this>a<b>c</b></this>\r\n\t *\t\tthis.getNodeByPath( [ 0 ] );     // -> \"a\"\r\n\t *\t\tthis.getNodeByPath( [ 1 ] );     // -> <b>\r\n\t *\t\tthis.getNodeByPath( [ 1, 0 ] );  // -> \"c\"\r\n\t *\r\n\t * @param {Array.<Number>} relativePath Path of the node to find, relative to this element.\r\n\t * @returns {module:engine/model/node~Node|module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tgetNodeByPath( relativePath ) {\r\n\t\tlet node = this; // eslint-disable-line consistent-this\r\n\r\n\t\tfor ( const index of relativePath ) {\r\n\t\t\tnode = node.getChild( node.offsetToIndex( index ) );\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts offset \"position\" to index \"position\".\r\n\t *\r\n\t * Returns index of a node that occupies given offset. If given offset is too low, returns `0`. If given offset is\r\n\t * too high, returns index after last child}.\r\n\t *\r\n\t *\t\tconst textNode = new Text( 'foo' );\r\n\t *\t\tconst pElement = new Element( 'p' );\r\n\t *\t\tconst docFrag = new DocumentFragment( [ textNode, pElement ] );\r\n\t *\t\tdocFrag.offsetToIndex( -1 ); // Returns 0, because offset is too low.\r\n\t *\t\tdocFrag.offsetToIndex( 0 ); // Returns 0, because offset 0 is taken by `textNode` which is at index 0.\r\n\t *\t\tdocFrag.offsetToIndex( 1 ); // Returns 0, because `textNode` has `offsetSize` equal to 3, so it occupies offset 1 too.\r\n\t *\t\tdocFrag.offsetToIndex( 2 ); // Returns 0.\r\n\t *\t\tdocFrag.offsetToIndex( 3 ); // Returns 1.\r\n\t *\t\tdocFrag.offsetToIndex( 4 ); // Returns 2. There are no nodes at offset 4, so last available index is returned.\r\n\t *\r\n\t * @param {Number} offset Offset to look for.\r\n\t * @returns {Number} Index of a node that occupies given offset.\r\n\t */\r\n\toffsetToIndex( offset ) {\r\n\t\treturn this._children.offsetToIndex( offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `DocumentFragment` instance to plain object and returns it.\r\n\t * Takes care of converting all of this document fragment's children.\r\n\t *\r\n\t * @returns {Object} `DocumentFragment` instance converted to plain object.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = [];\r\n\r\n\t\tfor ( const node of this._children ) {\r\n\t\t\tjson.push( node.toJSON() );\r\n\t\t}\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `DocumentFragment` instance from given plain object (i.e. parsed JSON string).\r\n\t * Converts `DocumentFragment` children to proper nodes.\r\n\t *\r\n\t * @param {Object} json Plain object to be converted to `DocumentFragment`.\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment} `DocumentFragment` instance created using given plain object.\r\n\t */\r\n\tstatic fromJSON( json ) {\r\n\t\tconst children = [];\r\n\r\n\t\tfor ( const child of json ) {\r\n\t\t\tif ( child.name ) {\r\n\t\t\t\t// If child has name property, it is an Element.\r\n\t\t\t\tchildren.push( Element.fromJSON( child ) );\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, it is a Text node.\r\n\t\t\t\tchildren.push( Text.fromJSON( child ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new DocumentFragment( children );\r\n\t}\r\n\r\n\t/**\r\n\t * {@link #_insertChild Inserts} one or more nodes at the end of this document fragment.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/item~Item|Iterable.<module:engine/model/item~Item>} items Items to be inserted.\r\n\t */\r\n\t_appendChild( items ) {\r\n\t\tthis._insertChild( this.childCount, items );\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts one or more nodes at the given index and sets {@link module:engine/model/node~Node#parent parent} of these nodes\r\n\t * to this document fragment.\r\n\t *\r\n\t * @protected\r\n\t * @param {Number} index Index at which nodes should be inserted.\r\n\t * @param {module:engine/model/item~Item|Iterable.<module:engine/model/item~Item>} items Items to be inserted.\r\n\t */\r\n\t_insertChild( index, items ) {\r\n\t\tconst nodes = normalize( items );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\t// If node that is being added to this element is already inside another element, first remove it from the old parent.\r\n\t\t\tif ( node.parent !== null ) {\r\n\t\t\t\tnode._remove();\r\n\t\t\t}\r\n\r\n\t\t\tnode.parent = this;\r\n\t\t}\r\n\r\n\t\tthis._children._insertNodes( index, nodes );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes one or more nodes starting at the given index\r\n\t * and sets {@link module:engine/model/node~Node#parent parent} of these nodes to `null`.\r\n\t *\r\n\t * @protected\r\n\t * @param {Number} index Index of the first node to remove.\r\n\t * @param {Number} [howMany=1] Number of nodes to remove.\r\n\t * @returns {Array.<module:engine/model/node~Node>} Array containing removed nodes.\r\n\t */\r\n\t_removeChildren( index, howMany = 1 ) {\r\n\t\tconst nodes = this._children._removeNodes( index, howMany );\r\n\r\n\t\tfor ( const node of nodes ) {\r\n\t\t\tnode.parent = null;\r\n\t\t}\r\n\r\n\t\treturn nodes;\r\n\t}\r\n}\r\n\r\n// Converts strings to Text and non-iterables to arrays.\r\n//\r\n// @param {String|module:engine/model/item~Item|Iterable.<module:engine/model/item~Item>}\r\n// @returns {Iterable.<module:engine/model/node~Node>}\r\nfunction normalize( nodes ) {\r\n\t// Separate condition because string is iterable.\r\n\tif ( typeof nodes == 'string' ) {\r\n\t\treturn [ new Text( nodes ) ];\r\n\t}\r\n\r\n\tif ( !isIterable( nodes ) ) {\r\n\t\tnodes = [ nodes ];\r\n\t}\r\n\r\n\t// Array.from to enable .map() on non-arrays.\r\n\treturn Array.from( nodes )\r\n\t\t.map( node => {\r\n\t\t\tif ( typeof node == 'string' ) {\r\n\t\t\t\treturn new Text( node );\r\n\t\t\t}\r\n\r\n\t\t\tif ( node instanceof TextProxy ) {\r\n\t\t\t\treturn new Text( node.data, node.getAttributes() );\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/utils\r\n */\r\n\r\nimport Node from '../node';\r\nimport Text from '../text';\r\nimport TextProxy from '../textproxy';\r\nimport Range from '../range';\r\nimport DocumentFragment from '../documentfragment';\r\nimport NodeList from '../nodelist';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Contains functions used for composing model tree by {@link module:engine/model/operation/operation~Operation operations}.\r\n * Those functions are built on top of {@link module:engine/model/node~Node node}, and it's child classes', APIs.\r\n *\r\n * @protected\r\n * @namespace utils\r\n */\r\n\r\n/**\r\n * Inserts given nodes at given position.\r\n *\r\n * @protected\r\n * @function module:engine/model/operation/utils~utils.insert\r\n * @param {module:engine/model/position~Position} position Position at which nodes should be inserted.\r\n * @param {module:engine/model/node~NodeSet} nodes Nodes to insert.\r\n * @returns {module:engine/model/range~Range} Range spanning over inserted elements.\r\n */\r\nexport function _insert( position, nodes ) {\r\n\tnodes = _normalizeNodes( nodes );\r\n\r\n\t// We have to count offset before inserting nodes because they can get merged and we would get wrong offsets.\r\n\tconst offset = nodes.reduce( ( sum, node ) => sum + node.offsetSize, 0 );\r\n\tconst parent = position.parent;\r\n\r\n\t// Insertion might be in a text node, we should split it if that's the case.\r\n\t_splitNodeAtPosition( position );\r\n\tconst index = position.index;\r\n\r\n\t// Insert nodes at given index. After splitting we have a proper index and insertion is between nodes,\r\n\t// using basic `Element` API.\r\n\tparent._insertChild( index, nodes );\r\n\r\n\t// Merge text nodes, if possible. Merging is needed only at points where inserted nodes \"touch\" \"old\" nodes.\r\n\t_mergeNodesAtIndex( parent, index + nodes.length );\r\n\t_mergeNodesAtIndex( parent, index );\r\n\r\n\treturn new Range( position, position.getShiftedBy( offset ) );\r\n}\r\n\r\n/**\r\n * Removed nodes in given range. Only {@link module:engine/model/range~Range#isFlat flat} ranges are accepted.\r\n *\r\n * @protected\r\n * @function module:engine/model/operation/utils~utils._remove\r\n * @param {module:engine/model/range~Range} range Range containing nodes to remove.\r\n * @returns {Array.<module:engine/model/node~Node>}\r\n */\r\nexport function _remove( range ) {\r\n\tif ( !range.isFlat ) {\r\n\t\t/**\r\n\t\t * Trying to remove a range which starts and ends in different element.\r\n\t\t *\r\n\t\t * @error operation-utils-remove-range-not-flat\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'operation-utils-remove-range-not-flat: ' +\r\n\t\t\t'Trying to remove a range which starts and ends in different element.' );\r\n\t}\r\n\r\n\tconst parent = range.start.parent;\r\n\r\n\t// Range may be inside text nodes, we have to split them if that's the case.\r\n\t_splitNodeAtPosition( range.start );\r\n\t_splitNodeAtPosition( range.end );\r\n\r\n\t// Remove the text nodes using basic `Element` API.\r\n\tconst removed = parent._removeChildren( range.start.index, range.end.index - range.start.index );\r\n\r\n\t// Merge text nodes, if possible. After some nodes were removed, node before and after removed range will be\r\n\t// touching at the position equal to the removed range beginning. We check merging possibility there.\r\n\t_mergeNodesAtIndex( parent, range.start.index );\r\n\r\n\treturn removed;\r\n}\r\n\r\n/**\r\n * Moves nodes in given range to given target position. Only {@link module:engine/model/range~Range#isFlat flat} ranges are accepted.\r\n *\r\n * @protected\r\n * @function module:engine/model/operation/utils~utils.move\r\n * @param {module:engine/model/range~Range} sourceRange Range containing nodes to move.\r\n * @param {module:engine/model/position~Position} targetPosition Position to which nodes should be moved.\r\n * @returns {module:engine/model/range~Range} Range containing moved nodes.\r\n */\r\nexport function _move( sourceRange, targetPosition ) {\r\n\tif ( !sourceRange.isFlat ) {\r\n\t\t/**\r\n\t\t * Trying to move a range which starts and ends in different element.\r\n\t\t *\r\n\t\t * @error operation-utils-move-range-not-flat\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'operation-utils-move-range-not-flat: ' +\r\n\t\t\t'Trying to move a range which starts and ends in different element.' );\r\n\t}\r\n\r\n\tconst nodes = _remove( sourceRange );\r\n\r\n\t// We have to fix `targetPosition` because model changed after nodes from `sourceRange` got removed and\r\n\t// that change might have an impact on `targetPosition`.\r\n\ttargetPosition = targetPosition._getTransformedByDeletion( sourceRange.start, sourceRange.end.offset - sourceRange.start.offset );\r\n\r\n\treturn _insert( targetPosition, nodes );\r\n}\r\n\r\n/**\r\n * Sets given attribute on nodes in given range. The attributes are only set on top-level nodes of the range, not on its children.\r\n *\r\n * @protected\r\n * @function module:engine/model/operation/utils~utils._setAttribute\r\n * @param {module:engine/model/range~Range} range Range containing nodes that should have the attribute set. Must be a flat range.\r\n * @param {String} key Key of attribute to set.\r\n * @param {*} value Attribute value.\r\n */\r\nexport function _setAttribute( range, key, value ) {\r\n\t// Range might start or end in text nodes, so we have to split them.\r\n\t_splitNodeAtPosition( range.start );\r\n\t_splitNodeAtPosition( range.end );\r\n\r\n\t// Iterate over all items in the range.\r\n\tfor ( const item of range.getItems( { shallow: true } ) ) {\r\n\t\t// Iterator will return `TextProxy` instances but we know that those text proxies will\r\n\t\t// always represent full text nodes (this is guaranteed thanks to splitting we did before).\r\n\t\t// So, we can operate on those text proxies' text nodes.\r\n\t\tconst node = item.is( 'textProxy' ) ? item.textNode : item;\r\n\r\n\t\tif ( value !== null ) {\r\n\t\t\tnode._setAttribute( key, value );\r\n\t\t} else {\r\n\t\t\tnode._removeAttribute( key );\r\n\t\t}\r\n\r\n\t\t// After attributes changing it may happen that some text nodes can be merged. Try to merge with previous node.\r\n\t\t_mergeNodesAtIndex( node.parent, node.index );\r\n\t}\r\n\r\n\t// Try to merge last changed node with it's previous sibling (not covered by the loop above).\r\n\t_mergeNodesAtIndex( range.end.parent, range.end.index );\r\n}\r\n\r\n/**\r\n * Normalizes given object or an array of objects to an array of {@link module:engine/model/node~Node nodes}. See\r\n * {@link module:engine/model/node~NodeSet NodeSet} for details on how normalization is performed.\r\n *\r\n * @protected\r\n * @function module:engine/model/operation/utils~utils.normalizeNodes\r\n * @param {module:engine/model/node~NodeSet} nodes Objects to normalize.\r\n * @returns {Array.<module:engine/model/node~Node>} Normalized nodes.\r\n */\r\nexport function _normalizeNodes( nodes ) {\r\n\tconst normalized = [];\r\n\r\n\tif ( !( nodes instanceof Array ) ) {\r\n\t\tnodes = [ nodes ];\r\n\t}\r\n\r\n\t// Convert instances of classes other than Node.\r\n\tfor ( let i = 0; i < nodes.length; i++ ) {\r\n\t\tif ( typeof nodes[ i ] == 'string' ) {\r\n\t\t\tnormalized.push( new Text( nodes[ i ] ) );\r\n\t\t} else if ( nodes[ i ] instanceof TextProxy ) {\r\n\t\t\tnormalized.push( new Text( nodes[ i ].data, nodes[ i ].getAttributes() ) );\r\n\t\t} else if ( nodes[ i ] instanceof DocumentFragment || nodes[ i ] instanceof NodeList ) {\r\n\t\t\tfor ( const child of nodes[ i ] ) {\r\n\t\t\t\tnormalized.push( child );\r\n\t\t\t}\r\n\t\t} else if ( nodes[ i ] instanceof Node ) {\r\n\t\t\tnormalized.push( nodes[ i ] );\r\n\t\t}\r\n\t\t// Skip unrecognized type.\r\n\t}\r\n\r\n\t// Merge text nodes.\r\n\tfor ( let i = 1; i < normalized.length; i++ ) {\r\n\t\tconst node = normalized[ i ];\r\n\t\tconst prev = normalized[ i - 1 ];\r\n\r\n\t\tif ( node instanceof Text && prev instanceof Text && _haveSameAttributes( node, prev ) ) {\r\n\t\t\t// Doing this instead changing `prev.data` because `data` is readonly.\r\n\t\t\tnormalized.splice( i - 1, 2, new Text( prev.data + node.data, prev.getAttributes() ) );\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n\r\n\treturn normalized;\r\n}\r\n\r\n// Checks if nodes before and after given index in given element are {@link module:engine/model/text~Text text nodes} and\r\n// merges them into one node if they have same attributes.\r\n//\r\n// Merging is done by removing two text nodes and inserting a new text node containing data from both merged text nodes.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} element Parent element of nodes to merge.\r\n// @param {Number} index Index between nodes to merge.\r\nfunction _mergeNodesAtIndex( element, index ) {\r\n\tconst nodeBefore = element.getChild( index - 1 );\r\n\tconst nodeAfter = element.getChild( index );\r\n\r\n\t// Check if both of those nodes are text objects with same attributes.\r\n\tif ( nodeBefore && nodeAfter && nodeBefore.is( 'text' ) && nodeAfter.is( 'text' ) && _haveSameAttributes( nodeBefore, nodeAfter ) ) {\r\n\t\t// Append text of text node after index to the before one.\r\n\t\tconst mergedNode = new Text( nodeBefore.data + nodeAfter.data, nodeBefore.getAttributes() );\r\n\r\n\t\t// Remove separate text nodes.\r\n\t\telement._removeChildren( index - 1, 2 );\r\n\r\n\t\t// Insert merged text node.\r\n\t\telement._insertChild( index - 1, mergedNode );\r\n\t}\r\n}\r\n\r\n// Checks if given position is in a text node, and if so, splits the text node in two text nodes, each of them\r\n// containing a part of original text node.\r\n//\r\n// @private\r\n// @param {module:engine/model/position~Position} position Position at which node should be split.\r\nfunction _splitNodeAtPosition( position ) {\r\n\tconst textNode = position.textNode;\r\n\tconst element = position.parent;\r\n\r\n\tif ( textNode ) {\r\n\t\tconst offsetDiff = position.offset - textNode.startOffset;\r\n\t\tconst index = textNode.index;\r\n\r\n\t\telement._removeChildren( index, 1 );\r\n\r\n\t\tconst firstPart = new Text( textNode.data.substr( 0, offsetDiff ), textNode.getAttributes() );\r\n\t\tconst secondPart = new Text( textNode.data.substr( offsetDiff ), textNode.getAttributes() );\r\n\r\n\t\telement._insertChild( index, [ firstPart, secondPart ] );\r\n\t}\r\n}\r\n\r\n// Checks whether two given nodes have same attributes.\r\n//\r\n// @private\r\n// @param {module:engine/model/node~Node} nodeA Node to check.\r\n// @param {module:engine/model/node~Node} nodeB Node to check.\r\n// @returns {Boolean} `true` if nodes have same attributes, `false` otherwise.\r\nfunction _haveSameAttributes( nodeA, nodeB ) {\r\n\tconst iteratorA = nodeA.getAttributes();\r\n\tconst iteratorB = nodeB.getAttributes();\r\n\r\n\tfor ( const attr of iteratorA ) {\r\n\t\tif ( attr[ 1 ] !== nodeB.getAttribute( attr[ 0 ] ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\titeratorB.next();\r\n\t}\r\n\r\n\treturn iteratorB.next().done;\r\n}\r\n\r\n/**\r\n * Value that can be normalized to an array of {@link module:engine/model/node~Node nodes}.\r\n *\r\n * Non-arrays are normalized as follows:\r\n * * {@link module:engine/model/node~Node Node} is left as is,\r\n * * {@link module:engine/model/textproxy~TextProxy TextProxy} and `String` are normalized to {@link module:engine/model/text~Text Text},\r\n * * {@link module:engine/model/nodelist~NodeList NodeList} is normalized to an array containing all nodes that are in that node list,\r\n * * {@link module:engine/model/documentfragment~DocumentFragment DocumentFragment} is normalized to an array containing all of it's\r\n * * children.\r\n *\r\n * Arrays are processed item by item like non-array values and flattened to one array. Normalization always results in\r\n * a flat array of {@link module:engine/model/node~Node nodes}. Consecutive text nodes (or items normalized to text nodes) will be\r\n * merged if they have same attributes.\r\n *\r\n * @typedef {module:engine/model/node~Node|module:engine/model/textproxy~TextProxy|String|\r\n * module:engine/model/nodelist~NodeList|module:engine/model/documentfragment~DocumentFragment|Iterable}\r\n * module:engine/model/node~NodeSet\r\n */\r\n","import baseIsEqual from './_baseIsEqual.js';\n\n/**\n * Performs a deep comparison between two values to determine if they are\n * equivalent.\n *\n * **Note:** This method supports comparing arrays, array buffers, booleans,\n * date objects, error objects, maps, numbers, `Object` objects, regexes,\n * sets, strings, symbols, and typed arrays. `Object` objects are compared\n * by their own, not inherited, enumerable properties. Functions and DOM\n * nodes are compared by strict equality, i.e. `===`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.isEqual(object, other);\n * // => true\n *\n * object === other;\n * // => false\n */\nfunction isEqual(value, other) {\n  return baseIsEqual(value, other);\n}\n\nexport default isEqual;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/attributeoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Range from '../range';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport { _setAttribute } from './utils';\r\nimport { isEqual } from 'lodash-es';\r\n\r\n/**\r\n * Operation to change nodes' attribute.\r\n *\r\n * Using this class you can add, remove or change value of the attribute.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class AttributeOperation extends Operation {\r\n\t/**\r\n\t * Creates an operation that changes, removes or adds attributes.\r\n\t *\r\n\t * If only `newValue` is set, attribute will be added on a node. Note that all nodes in operation's range must not\r\n\t * have an attribute with the same key as the added attribute.\r\n\t *\r\n\t * If only `oldValue` is set, then attribute with given key will be removed. Note that all nodes in operation's range\r\n\t * must have an attribute with that key added.\r\n\t *\r\n\t * If both `newValue` and `oldValue` are set, then the operation will change the attribute value. Note that all nodes in\r\n\t * operation's ranges must already have an attribute with given key and `oldValue` as value\r\n\t *\r\n\t * @param {module:engine/model/range~Range} range Range on which the operation should be applied. Must be a flat range.\r\n\t * @param {String} key Key of an attribute to change or remove.\r\n\t * @param {*} oldValue Old value of the attribute with given key or `null`, if attribute was not set before.\r\n\t * @param {*} newValue New value of the attribute with given key or `null`, if operation should remove attribute.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( range, key, oldValue, newValue, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Range on which operation should be applied.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/range~Range}\r\n\t\t */\r\n\t\tthis.range = range.clone();\r\n\r\n\t\t/**\r\n\t\t * Key of an attribute to change or remove.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.key = key;\r\n\r\n\t\t/**\r\n\t\t * Old value of the attribute with given key or `null`, if attribute was not set before.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {*}\r\n\t\t */\r\n\t\tthis.oldValue = oldValue === undefined ? null : oldValue;\r\n\r\n\t\t/**\r\n\t\t * New value of the attribute with given key or `null`, if operation should remove attribute.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {*}\r\n\t\t */\r\n\t\tthis.newValue = newValue === undefined ? null : newValue;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\tif ( this.oldValue === null ) {\r\n\t\t\treturn 'addAttribute';\r\n\t\t} else if ( this.newValue === null ) {\r\n\t\t\treturn 'removeAttribute';\r\n\t\t} else {\r\n\t\t\treturn 'changeAttribute';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/attributeoperation~AttributeOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new AttributeOperation( this.range, this.key, this.oldValue, this.newValue, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/attributeoperation~AttributeOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\treturn new AttributeOperation( this.range, this.key, this.newValue, this.oldValue, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.range = this.range.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tif ( !this.range.isFlat ) {\r\n\t\t\t/**\r\n\t\t\t * The range to change is not flat.\r\n\t\t\t *\r\n\t\t\t * @error attribute-operation-range-not-flat\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'attribute-operation-range-not-flat: The range to change is not flat.' );\r\n\t\t}\r\n\r\n\t\tfor ( const item of this.range.getItems( { shallow: true } ) ) {\r\n\t\t\tif ( this.oldValue !== null && !isEqual( item.getAttribute( this.key ), this.oldValue ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Changed node has different attribute value than operation's old attribute value.\r\n\t\t\t\t *\r\n\t\t\t\t * @error attribute-operation-wrong-old-value\r\n\t\t\t\t * @param {module:engine/model/item~Item} item\r\n\t\t\t\t * @param {String} key\r\n\t\t\t\t * @param {*} value\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'attribute-operation-wrong-old-value: Changed node has different attribute value than operation\\'s ' +\r\n\t\t\t\t\t'old attribute value.',\r\n\t\t\t\t\t{ item, key: this.key, value: this.oldValue }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.oldValue === null && this.newValue !== null && item.hasAttribute( this.key ) ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * The attribute with given key already exists for the given node.\r\n\t\t\t\t *\r\n\t\t\t\t * @error attribute-operation-attribute-exists\r\n\t\t\t\t * @param {module:engine/model/node~Node} node\r\n\t\t\t\t * @param {String} key\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'attribute-operation-attribute-exists: The attribute with given key already exists.',\r\n\t\t\t\t\t{ node: item, key: this.key }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\t// If value to set is same as old value, don't do anything.\r\n\t\tif ( !isEqual( this.oldValue, this.newValue ) ) {\r\n\t\t\t// Execution.\r\n\t\t\t_setAttribute( this.range, this.key, this.newValue );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'AttributeOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `AttributeOperation` object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/attributeoperation~AttributeOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\treturn new AttributeOperation( Range.fromJSON( json.range, document ), json.key, json.oldValue, json.newValue, json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/detachoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Range from '../range';\r\nimport { _remove } from './utils';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Operation to permanently remove node from detached root.\r\n * Note this operation is only a local operation and won't be send to the other clients.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class DetachOperation extends Operation {\r\n\t/**\r\n\t * Creates an insert operation.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} sourcePosition\r\n\t * Position before the first {@link module:engine/model/item~Item model item} to move.\r\n\t * @param {Number} howMany Offset size of moved range. Moved range will start from `sourcePosition` and end at\r\n\t * `sourcePosition` with offset shifted by `howMany`.\r\n\t */\r\n\tconstructor( sourcePosition, howMany ) {\r\n\t\tsuper( null );\r\n\r\n\t\t/**\r\n\t\t * Position before the first {@link module:engine/model/item~Item model item} to detach.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} #sourcePosition\r\n\t\t */\r\n\t\tthis.sourcePosition = sourcePosition.clone();\r\n\r\n\t\t/**\r\n\t\t * Offset size of moved range.\r\n\t\t *\r\n\t\t * @member {Number} #howMany\r\n\t\t */\r\n\t\tthis.howMany = howMany;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'detach';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.sourcePosition = this.sourcePosition.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tif ( this.sourcePosition.root.document ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot detach document node.\r\n\t\t\t *\r\n\t\t\t * @error detach-operation-on-document-node\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'detach-operation-on-document-node: Cannot detach document node.' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\t_remove( Range._createFromPositionAndShift( this.sourcePosition, this.howMany ) );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'DetachOperation';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/moveoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Position from '../position';\r\nimport Range from '../range';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\nimport { _move } from './utils';\r\n\r\n/**\r\n * Operation to move a range of {@link module:engine/model/item~Item model items}\r\n * to given {@link module:engine/model/position~Position target position}.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class MoveOperation extends Operation {\r\n\t/**\r\n\t * Creates a move operation.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} sourcePosition\r\n\t * Position before the first {@link module:engine/model/item~Item model item} to move.\r\n\t * @param {Number} howMany Offset size of moved range. Moved range will start from `sourcePosition` and end at\r\n\t * `sourcePosition` with offset shifted by `howMany`.\r\n\t * @param {module:engine/model/position~Position} targetPosition Position at which moved nodes will be inserted.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( sourcePosition, howMany, targetPosition, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Position before the first {@link module:engine/model/item~Item model item} to move.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/moveoperation~MoveOperation#sourcePosition\r\n\t\t */\r\n\t\tthis.sourcePosition = sourcePosition.clone();\r\n\t\t// `'toNext'` because `sourcePosition` is a bit like a start of the moved range.\r\n\t\tthis.sourcePosition.stickiness = 'toNext';\r\n\r\n\t\t/**\r\n\t\t * Offset size of moved range.\r\n\t\t *\r\n\t\t * @member {Number} module:engine/model/operation/moveoperation~MoveOperation#howMany\r\n\t\t */\r\n\t\tthis.howMany = howMany;\r\n\r\n\t\t/**\r\n\t\t * Position at which moved nodes will be inserted.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/moveoperation~MoveOperation#targetPosition\r\n\t\t */\r\n\t\tthis.targetPosition = targetPosition.clone();\r\n\t\tthis.targetPosition.stickiness = 'toNone';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\tif ( this.targetPosition.root.rootName == '$graveyard' ) {\r\n\t\t\treturn 'remove';\r\n\t\t} else if ( this.sourcePosition.root.rootName == '$graveyard' ) {\r\n\t\t\treturn 'reinsert';\r\n\t\t}\r\n\r\n\t\treturn 'move';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/moveoperation~MoveOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new this.constructor( this.sourcePosition, this.howMany, this.targetPosition, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the start position of the moved range after it got moved. This may be different than\r\n\t * {@link module:engine/model/operation/moveoperation~MoveOperation#targetPosition} in some cases, i.e. when a range is moved\r\n\t * inside the same parent but {@link module:engine/model/operation/moveoperation~MoveOperation#targetPosition targetPosition}\r\n\t * is after {@link module:engine/model/operation/moveoperation~MoveOperation#sourcePosition sourcePosition}.\r\n\t *\r\n\t *\t\t vv              vv\r\n\t *\t\tabcdefg ===> adefbcg\r\n\t *\t\t     ^          ^\r\n\t *\t\t     targetPos\tmovedRangeStart\r\n\t *\t\t     offset 6\toffset 4\r\n\t *\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tgetMovedRangeStart() {\r\n\t\treturn this.targetPosition._getTransformedByDeletion( this.sourcePosition, this.howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/moveoperation~MoveOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\tconst newTargetPosition = this.sourcePosition._getTransformedByInsertion( this.targetPosition, this.howMany );\r\n\r\n\t\treturn new this.constructor( this.getMovedRangeStart(), this.howMany, newTargetPosition, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tconst sourceElement = this.sourcePosition.parent;\r\n\t\tconst targetElement = this.targetPosition.parent;\r\n\t\tconst sourceOffset = this.sourcePosition.offset;\r\n\t\tconst targetOffset = this.targetPosition.offset;\r\n\r\n\t\t// Validate whether move operation has correct parameters.\r\n\t\t// Validation is pretty complex but move operation is one of the core ways to manipulate the document state.\r\n\t\t// We expect that many errors might be connected with one of scenarios described below.\r\n\t\tif ( !sourceElement || !targetElement ) {\r\n\t\t\t/**\r\n\t\t\t * Source position or target position is invalid.\r\n\t\t\t *\r\n\t\t\t * @error move-operation-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'move-operation-position-invalid: Source position or target position is invalid.'\r\n\t\t\t);\r\n\t\t} else if ( sourceOffset + this.howMany > sourceElement.maxOffset ) {\r\n\t\t\t/**\r\n\t\t\t * The nodes which should be moved do not exist.\r\n\t\t\t *\r\n\t\t\t * @error move-operation-nodes-do-not-exist\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'move-operation-nodes-do-not-exist: The nodes which should be moved do not exist.'\r\n\t\t\t);\r\n\t\t} else if ( sourceElement === targetElement && sourceOffset < targetOffset && targetOffset < sourceOffset + this.howMany ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to move a range of nodes into the middle of that range.\r\n\t\t\t *\r\n\t\t\t * @error move-operation-range-into-itself\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'move-operation-range-into-itself: Trying to move a range of nodes to the inside of that range.'\r\n\t\t\t);\r\n\t\t} else if ( this.sourcePosition.root == this.targetPosition.root ) {\r\n\t\t\tif ( compareArrays( this.sourcePosition.getParentPath(), this.targetPosition.getParentPath() ) == 'prefix' ) {\r\n\t\t\t\tconst i = this.sourcePosition.path.length - 1;\r\n\r\n\t\t\t\tif ( this.targetPosition.path[ i ] >= sourceOffset && this.targetPosition.path[ i ] < sourceOffset + this.howMany ) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Trying to move a range of nodes into one of nodes from that range.\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * @error move-operation-node-into-itself\r\n\t\t\t\t\t */\r\n\t\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t\t'move-operation-node-into-itself: Trying to move a range of nodes into one of nodes from that range.'\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\t_move( Range._createFromPositionAndShift( this.sourcePosition, this.howMany ), this.targetPosition );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.sourcePosition = this.sourcePosition.toJSON();\r\n\t\tjson.targetPosition = this.targetPosition.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'MoveOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `MoveOperation` object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/moveoperation~MoveOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\tconst sourcePosition = Position.fromJSON( json.sourcePosition, document );\r\n\t\tconst targetPosition = Position.fromJSON( json.targetPosition, document );\r\n\r\n\t\treturn new this( sourcePosition, json.howMany, targetPosition, json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/insertoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Position from '../position';\r\nimport NodeList from '../nodelist';\r\nimport MoveOperation from './moveoperation';\r\nimport { _insert, _normalizeNodes } from './utils';\r\nimport Text from '../text';\r\nimport Element from '../element';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Operation to insert one or more nodes at given position in the model.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class InsertOperation extends Operation {\r\n\t/**\r\n\t * Creates an insert operation.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position of insertion.\r\n\t * @param {module:engine/model/node~NodeSet} nodes The list of nodes to be inserted.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( position, nodes, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Position of insertion.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/insertoperation~InsertOperation#position\r\n\t\t */\r\n\t\tthis.position = position.clone();\r\n\t\tthis.position.stickiness = 'toNone';\r\n\r\n\t\t/**\r\n\t\t * List of nodes to insert.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/nodelist~NodeList} module:engine/model/operation/insertoperation~InsertOperation#nodeList\r\n\t\t */\r\n\t\tthis.nodes = new NodeList( _normalizeNodes( nodes ) );\r\n\r\n\t\t/**\r\n\t\t * Flag deciding how the operation should be transformed. If set to `true`, nodes might get additional attributes\r\n\t\t * during operational transformation. This happens when the operation insertion position is inside of a range\r\n\t\t * where attributes have changed.\r\n\t\t *\r\n\t\t * @member {Boolean} module:engine/model/operation/insertoperation~InsertOperation#shouldReceiveAttributes\r\n\t\t */\r\n\t\tthis.shouldReceiveAttributes = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'insert';\r\n\t}\r\n\r\n\t/**\r\n\t * Total offset size of inserted nodes.\r\n\t *\r\n\t * @returns {Number}\r\n\t */\r\n\tget howMany() {\r\n\t\treturn this.nodes.maxOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/insertoperation~InsertOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\tconst nodes = new NodeList( [ ...this.nodes ].map( node => node._clone( true ) ) );\r\n\t\tconst insert = new InsertOperation( this.position, nodes, this.baseVersion );\r\n\r\n\t\tinsert.shouldReceiveAttributes = this.shouldReceiveAttributes;\r\n\r\n\t\treturn insert;\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/moveoperation~MoveOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\tconst graveyard = this.position.root.document.graveyard;\r\n\t\tconst gyPosition = new Position( graveyard, [ 0 ] );\r\n\r\n\t\treturn new MoveOperation( this.position, this.nodes.maxOffset, gyPosition, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tconst targetElement = this.position.parent;\r\n\r\n\t\tif ( !targetElement || targetElement.maxOffset < this.position.offset ) {\r\n\t\t\t/**\r\n\t\t\t * Insertion position is invalid.\r\n\t\t\t *\r\n\t\t\t * @error insert-operation-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'insert-operation-position-invalid: Insertion position is invalid.'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\t// What happens here is that we want original nodes be passed to writer because we want original nodes\r\n\t\t// to be inserted to the model. But in InsertOperation, we want to keep those nodes as they were added\r\n\t\t// to the operation, not modified. For example, text nodes can get merged or cropped while Elements can\r\n\t\t// get children. It is important that InsertOperation has the copy of original nodes in intact state.\r\n\t\tconst originalNodes = this.nodes;\r\n\t\tthis.nodes = new NodeList( [ ...originalNodes ].map( node => node._clone( true ) ) );\r\n\r\n\t\t_insert( this.position, originalNodes );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.position = this.position.toJSON();\r\n\t\tjson.nodes = this.nodes.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'InsertOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `InsertOperation` object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/insertoperation~InsertOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\tconst children = [];\r\n\r\n\t\tfor ( const child of json.nodes ) {\r\n\t\t\tif ( child.name ) {\r\n\t\t\t\t// If child has name property, it is an Element.\r\n\t\t\t\tchildren.push( Element.fromJSON( child ) );\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, it is a Text node.\r\n\t\t\t\tchildren.push( Text.fromJSON( child ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst insert = new InsertOperation( Position.fromJSON( json.position, document ), children, json.baseVersion );\r\n\t\tinsert.shouldReceiveAttributes = json.shouldReceiveAttributes;\r\n\r\n\t\treturn insert;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/markeroperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Range from '../range';\r\n\r\n/**\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class MarkerOperation extends Operation {\r\n\t/**\r\n\t * @param {String} name Marker name.\r\n\t * @param {module:engine/model/range~Range} oldRange Marker range before the change.\r\n\t * @param {module:engine/model/range~Range} newRange Marker range after the change.\r\n\t * @param {module:engine/model/markercollection~MarkerCollection} markers Marker collection on which change should be executed.\r\n\t * @param {Boolean} affectsData Specifies whether the marker operation affects the data produced by the data pipeline\r\n\t * (is persisted in the editor's data).\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( name, oldRange, newRange, markers, affectsData, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Marker name.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.name = name;\r\n\r\n\t\t/**\r\n\t\t * Marker range before the change.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/range~Range}\r\n\t\t */\r\n\t\tthis.oldRange = oldRange ? oldRange.clone() : null;\r\n\r\n\t\t/**\r\n\t\t * Marker range after the change.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/range~Range}\r\n\t\t */\r\n\t\tthis.newRange = newRange ? newRange.clone() : null;\r\n\r\n\t\t/**\r\n\t\t * Specifies whether the marker operation affects the data produced by the data pipeline\r\n\t\t * (is persisted in the editor's data).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis.affectsData = affectsData;\r\n\r\n\t\t/**\r\n\t\t * Marker collection on which change should be executed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/markercollection~MarkerCollection}\r\n\t\t */\r\n\t\tthis._markers = markers;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'marker';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/markeroperation~MarkerOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new MarkerOperation( this.name, this.oldRange, this.newRange, this._markers, this.affectsData, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/markeroperation~MarkerOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\treturn new MarkerOperation( this.name, this.newRange, this.oldRange, this._markers, this.affectsData, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\tconst type = this.newRange ? '_set' : '_remove';\r\n\r\n\t\tthis._markers[ type ]( this.name, this.newRange, true, this.affectsData );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tif ( this.oldRange ) {\r\n\t\t\tjson.oldRange = this.oldRange.toJSON();\r\n\t\t}\r\n\r\n\t\tif ( this.newRange ) {\r\n\t\t\tjson.newRange = this.newRange.toJSON();\r\n\t\t}\r\n\r\n\t\tdelete json._markers;\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'MarkerOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `MarkerOperation` object from deserialized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/markeroperation~MarkerOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\treturn new MarkerOperation(\r\n\t\t\tjson.name,\r\n\t\t\tjson.oldRange ? Range.fromJSON( json.oldRange, document ) : null,\r\n\t\t\tjson.newRange ? Range.fromJSON( json.newRange, document ) : null,\r\n\t\t\tdocument.model.markers,\r\n\t\t\tjson.affectsData,\r\n\t\t\tjson.baseVersion\r\n\t\t);\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/renameoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport Element from '../element';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport Position from '../position';\r\n\r\n/**\r\n * Operation to change element's name.\r\n *\r\n * Using this class you can change element's name.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class RenameOperation extends Operation {\r\n\t/**\r\n\t * Creates an operation that changes element's name.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position before an element to change.\r\n\t * @param {String} oldName Current name of the element.\r\n\t * @param {String} newName New name for the element.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( position, oldName, newName, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Position before an element to change.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/renameoperation~RenameOperation#position\r\n\t\t */\r\n\t\tthis.position = position;\r\n\t\t// This position sticks to the next node because it is a position before the node that we want to change.\r\n\t\tthis.position.stickiness = 'toNext';\r\n\r\n\t\t/**\r\n\t\t * Current name of the element.\r\n\t\t *\r\n\t\t * @member {String} module:engine/model/operation/renameoperation~RenameOperation#oldName\r\n\t\t */\r\n\t\tthis.oldName = oldName;\r\n\r\n\t\t/**\r\n\t\t * New name for the element.\r\n\t\t *\r\n\t\t * @member {String} module:engine/model/operation/renameoperation~RenameOperation#newName\r\n\t\t */\r\n\t\tthis.newName = newName;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'rename';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/renameoperation~RenameOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new RenameOperation( this.position.clone(), this.oldName, this.newName, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/renameoperation~RenameOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\treturn new RenameOperation( this.position.clone(), this.newName, this.oldName, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tconst element = this.position.nodeAfter;\r\n\r\n\t\tif ( !( element instanceof Element ) ) {\r\n\t\t\t/**\r\n\t\t\t * Given position is invalid or node after it is not instance of Element.\r\n\t\t\t *\r\n\t\t\t * @error rename-operation-wrong-position\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rename-operation-wrong-position: Given position is invalid or node after it is not an instance of Element.'\r\n\t\t\t);\r\n\t\t} else if ( element.name !== this.oldName ) {\r\n\t\t\t/**\r\n\t\t\t * Element to change has different name than operation's old name.\r\n\t\t\t *\r\n\t\t\t * @error rename-operation-wrong-name\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rename-operation-wrong-name: Element to change has different name than operation\\'s old name.'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\tconst element = this.position.nodeAfter;\r\n\r\n\t\telement.name = this.newName;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.position = this.position.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'RenameOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `RenameOperation` object from deserialized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/attributeoperation~AttributeOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\treturn new RenameOperation( Position.fromJSON( json.position, document ), json.oldName, json.newName, json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/rootattributeoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Operation to change root element's attribute. Using this class you can add, remove or change value of the attribute.\r\n *\r\n * This operation is needed, because root elements can't be changed through\r\n * @link module:engine/model/operation/attributeoperation~AttributeOperation}.\r\n * It is because {@link module:engine/model/operation/attributeoperation~AttributeOperation}\r\n * requires a range to change and root element can't\r\n * be a part of range because every {@link module:engine/model/position~Position} has to be inside a root.\r\n * {@link module:engine/model/position~Position} can't be created before a root element.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class RootAttributeOperation extends Operation {\r\n\t/**\r\n\t * Creates an operation that changes, removes or adds attributes on root element.\r\n\t *\r\n\t * @see module:engine/model/operation/attributeoperation~AttributeOperation\r\n\t * @param {module:engine/model/rootelement~RootElement} root Root element to change.\r\n\t * @param {String} key Key of an attribute to change or remove.\r\n\t * @param {*} oldValue Old value of the attribute with given key or `null` if adding a new attribute.\r\n\t * @param {*} newValue New value to set for the attribute. If `null`, then the operation just removes the attribute.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( root, key, oldValue, newValue, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Root element to change.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/rootelement~RootElement}\r\n\t\t */\r\n\t\tthis.root = root;\r\n\r\n\t\t/**\r\n\t\t * Key of an attribute to change or remove.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.key = key;\r\n\r\n\t\t/**\r\n\t\t * Old value of the attribute with given key or `null` if adding a new attribute.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {*}\r\n\t\t */\r\n\t\tthis.oldValue = oldValue;\r\n\r\n\t\t/**\r\n\t\t * New value to set for the attribute. If `null`, then the operation just removes the attribute.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {*}\r\n\t\t */\r\n\t\tthis.newValue = newValue;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\tif ( this.oldValue === null ) {\r\n\t\t\treturn 'addRootAttribute';\r\n\t\t} else if ( this.newValue === null ) {\r\n\t\t\treturn 'removeRootAttribute';\r\n\t\t} else {\r\n\t\t\treturn 'changeRootAttribute';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/rootattributeoperation~RootAttributeOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new RootAttributeOperation( this.root, this.key, this.oldValue, this.newValue, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/rootattributeoperation~RootAttributeOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\treturn new RootAttributeOperation( this.root, this.key, this.newValue, this.oldValue, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tif ( this.root != this.root.root || this.root.is( 'documentFragment' ) ) {\r\n\t\t\t/**\r\n\t\t\t * The element to change is not a root element.\r\n\t\t\t *\r\n\t\t\t * @error rootattribute-operation-not-a-root\r\n\t\t\t * @param {module:engine/model/rootelement~RootElement} root\r\n\t\t\t * @param {String} key\r\n\t\t\t * @param {*} value\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rootattribute-operation-not-a-root: The element to change is not a root element.',\r\n\t\t\t\t{ root: this.root, key: this.key }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( this.oldValue !== null && this.root.getAttribute( this.key ) !== this.oldValue ) {\r\n\t\t\t/**\r\n\t\t\t * The attribute which should be removed does not exists for the given node.\r\n\t\t\t *\r\n\t\t\t * @error rootattribute-operation-wrong-old-value\r\n\t\t\t * @param {module:engine/model/rootelement~RootElement} root\r\n\t\t\t * @param {String} key\r\n\t\t\t * @param {*} value\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rootattribute-operation-wrong-old-value: Changed node has different attribute value than operation\\'s ' +\r\n\t\t\t\t'old attribute value.',\r\n\t\t\t\t{ root: this.root, key: this.key }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( this.oldValue === null && this.newValue !== null && this.root.hasAttribute( this.key ) ) {\r\n\t\t\t/**\r\n\t\t\t * The attribute with given key already exists for the given node.\r\n\t\t\t *\r\n\t\t\t * @error rootattribute-operation-attribute-exists\r\n\t\t\t * @param {module:engine/model/rootelement~RootElement} root\r\n\t\t\t * @param {String} key\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rootattribute-operation-attribute-exists: The attribute with given key already exists.',\r\n\t\t\t\t{ root: this.root, key: this.key }\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\tif ( this.newValue !== null ) {\r\n\t\t\tthis.root._setAttribute( this.key, this.newValue );\r\n\t\t} else {\r\n\t\t\tthis.root._removeAttribute( this.key );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.root = this.root.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'RootAttributeOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates RootAttributeOperation object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/rootattributeoperation~RootAttributeOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\tif ( !document.getRoot( json.root ) ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot create RootAttributeOperation for document. Root with specified name does not exist.\r\n\t\t\t *\r\n\t\t\t * @error rootattributeoperation-fromjson-no-root\r\n\t\t\t * @param {String} rootName\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'rootattribute-operation-fromjson-no-root: Cannot create RootAttributeOperation. Root with specified name does not exist.',\r\n\t\t\t\t{ rootName: json.root }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn new RootAttributeOperation( document.getRoot( json.root ), json.key, json.oldValue, json.newValue, json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/mergeoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport SplitOperation from './splitoperation';\r\nimport Position from '../position';\r\nimport Range from '../range';\r\nimport { _move } from './utils';\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Operation to merge two {@link module:engine/model/element~Element elements}.\r\n *\r\n * The merged element is the parent of {@link ~MergeOperation#sourcePosition} and it is merged into the parent of\r\n * {@link ~MergeOperation#targetPosition}. All nodes from the merged element are moved to {@link ~MergeOperation#targetPosition}.\r\n *\r\n * The merged element is moved to the graveyard at {@link ~MergeOperation#graveyardPosition}.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class MergeOperation extends Operation {\r\n\t/**\r\n\t * Creates a merge operation.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} sourcePosition Position inside the merged element. All nodes from that\r\n\t * element after that position will be moved to {@link ~#targetPosition}.\r\n\t * @param {Number} howMany Summary offset size of nodes which will be moved from the merged element to the new parent.\r\n\t * @param {module:engine/model/position~Position} targetPosition Position which the nodes from the merged elements will be moved to.\r\n\t * @param {module:engine/model/position~Position} graveyardPosition Position in graveyard to which the merged element will be moved.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( sourcePosition, howMany, targetPosition, graveyardPosition, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Position inside the merged element. All nodes from that element after that position will be moved to {@link ~#targetPosition}.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/mergeoperation~MergeOperation#sourcePosition\r\n\t\t */\r\n\t\tthis.sourcePosition = sourcePosition.clone();\r\n\t\t// This is, and should always remain, the first position in its parent.\r\n\t\tthis.sourcePosition.stickiness = 'toPrevious';\r\n\r\n\t\t/**\r\n\t\t * Summary offset size of nodes which will be moved from the merged element to the new parent.\r\n\t\t *\r\n\t\t * @member {Number} module:engine/model/operation/mergeoperation~MergeOperation#howMany\r\n\t\t */\r\n\t\tthis.howMany = howMany;\r\n\r\n\t\t/**\r\n\t\t * Position which the nodes from the merged elements will be moved to.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/mergeoperation~MergeOperation#targetPosition\r\n\t\t */\r\n\t\tthis.targetPosition = targetPosition.clone();\r\n\t\t// Except of a rare scenario in `MergeOperation` x `MergeOperation` transformation,\r\n\t\t// this is, and should always remain, the last position in its parent.\r\n\t\tthis.targetPosition.stickiness = 'toNext';\r\n\r\n\t\t/**\r\n\t\t * Position in graveyard to which the merged element will be moved.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/mergeoperation~MergeOperation#graveyardPosition\r\n\t\t */\r\n\t\tthis.graveyardPosition = graveyardPosition.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'merge';\r\n\t}\r\n\r\n\t/**\r\n\t * Position before the merged element (which will be deleted).\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position}\r\n\t */\r\n\tget deletionPosition() {\r\n\t\treturn new Position( this.sourcePosition.root, this.sourcePosition.path.slice( 0, -1 ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial range that contains all the nodes from the merged element that will be moved to {@link ~MergeOperation#sourcePosition}.\r\n\t * The range starts at {@link ~MergeOperation#sourcePosition} and ends in the same parent, at `POSITIVE_INFINITY` offset.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/range~Range}\r\n\t */\r\n\tget movedRange() {\r\n\t\tconst end = this.sourcePosition.getShiftedBy( Number.POSITIVE_INFINITY );\r\n\r\n\t\treturn new Range( this.sourcePosition, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/mergeoperation~MergeOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new this.constructor( this.sourcePosition, this.howMany, this.targetPosition, this.graveyardPosition, this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/splitoperation~SplitOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\t// Positions in this method are transformed by this merge operation because the split operation bases on\r\n\t\t// the context after this merge operation happened (because split operation reverses it).\r\n\t\t// So we need to acknowledge that the merge operation happened and those positions changed a little.\r\n\t\tconst targetPosition = this.targetPosition._getTransformedByMergeOperation( this );\r\n\r\n\t\tconst path = this.sourcePosition.path.slice( 0, -1 );\r\n\t\tconst insertionPosition = new Position( this.sourcePosition.root, path )._getTransformedByMergeOperation( this );\r\n\r\n\t\tconst split = new SplitOperation( targetPosition, this.howMany, this.graveyardPosition, this.baseVersion + 1 );\r\n\t\tsplit.insertionPosition = insertionPosition;\r\n\r\n\t\treturn split;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tconst sourceElement = this.sourcePosition.parent;\r\n\t\tconst targetElement = this.targetPosition.parent;\r\n\r\n\t\t// Validate whether merge operation has correct parameters.\r\n\t\tif ( !sourceElement || !sourceElement.is( 'element' ) || !sourceElement.parent ) {\r\n\t\t\t/**\r\n\t\t\t * Merge source position is invalid.\r\n\t\t\t *\r\n\t\t\t * @error merge-operation-source-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'merge-operation-source-position-invalid: Merge source position is invalid.' );\r\n\t\t} else if ( !targetElement || !targetElement.is( 'element' ) || !targetElement.parent ) {\r\n\t\t\t/**\r\n\t\t\t * Merge target position is invalid.\r\n\t\t\t *\r\n\t\t\t * @error merge-operation-target-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'merge-operation-target-position-invalid: Merge target position is invalid.' );\r\n\t\t} else if ( this.howMany != sourceElement.maxOffset ) {\r\n\t\t\t/**\r\n\t\t\t * Merge operation specifies wrong number of nodes to move.\r\n\t\t\t *\r\n\t\t\t * @error merge-operation-how-many-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'merge-operation-how-many-invalid: Merge operation specifies wrong number of nodes to move.' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\tconst mergedElement = this.sourcePosition.parent;\r\n\t\tconst sourceRange = Range._createIn( mergedElement );\r\n\r\n\t\t_move( sourceRange, this.targetPosition );\r\n\t\t_move( Range._createOn( mergedElement ), this.graveyardPosition );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.sourcePosition = json.sourcePosition.toJSON();\r\n\t\tjson.targetPosition = json.targetPosition.toJSON();\r\n\t\tjson.graveyardPosition = json.graveyardPosition.toJSON();\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'MergeOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `MergeOperation` object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/mergeoperation~MergeOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\tconst sourcePosition = Position.fromJSON( json.sourcePosition, document );\r\n\t\tconst targetPosition = Position.fromJSON( json.targetPosition, document );\r\n\t\tconst graveyardPosition = Position.fromJSON( json.graveyardPosition, document );\r\n\r\n\t\treturn new this( sourcePosition, json.howMany, targetPosition, graveyardPosition, json.baseVersion );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/splitoperation\r\n */\r\n\r\nimport Operation from './operation';\r\nimport MergeOperation from './mergeoperation';\r\nimport Position from '../position';\r\nimport Range from '../range';\r\nimport { _insert, _move } from './utils';\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Operation to split {@link module:engine/model/element~Element an element} at given\r\n * {@link module:engine/model/operation/splitoperation~SplitOperation#splitPosition split position} into two elements,\r\n * both containing a part of the element's original content.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class SplitOperation extends Operation {\r\n\t/**\r\n\t * Creates a split operation.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} splitPosition Position at which an element should be split.\r\n\t * @param {Number} howMany Total offset size of elements that are in the split element after `position`.\r\n\t * @param {module:engine/model/position~Position|null} graveyardPosition Position in the graveyard root before the element which\r\n\t * should be used as a parent of the nodes after `position`. If it is not set, a copy of the the `position` parent will be used.\r\n\t * @param {Number|null} baseVersion Document {@link module:engine/model/document~Document#version} on which operation\r\n\t * can be applied or `null` if the operation operates on detached (non-document) tree.\r\n\t */\r\n\tconstructor( splitPosition, howMany, graveyardPosition, baseVersion ) {\r\n\t\tsuper( baseVersion );\r\n\r\n\t\t/**\r\n\t\t * Position at which an element should be split.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/splitoperation~SplitOperation#splitPosition\r\n\t\t */\r\n\t\tthis.splitPosition = splitPosition.clone();\r\n\t\t// Keep position sticking to the next node. This way any new content added at the place where the element is split\r\n\t\t// will be left in the original element.\r\n\t\tthis.splitPosition.stickiness = 'toNext';\r\n\r\n\t\t/**\r\n\t\t * Total offset size of elements that are in the split element after `position`.\r\n\t\t *\r\n\t\t * @member {Number} module:engine/model/operation/splitoperation~SplitOperation#howMany\r\n\t\t */\r\n\t\tthis.howMany = howMany;\r\n\r\n\t\t/**\r\n\t\t * Position at which the clone of split element (or element from graveyard) will be inserted.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} module:engine/model/operation/splitoperation~SplitOperation#insertionPosition\r\n\t\t */\r\n\t\tthis.insertionPosition = SplitOperation.getInsertionPosition( splitPosition );\r\n\t\tthis.insertionPosition.stickiness = 'toNone';\r\n\r\n\t\t/**\r\n\t\t * Position in the graveyard root before the element which should be used as a parent of the nodes after `position`.\r\n\t\t * If it is not set, a copy of the the `position` parent will be used.\r\n\t\t *\r\n\t\t * The default behavior is to clone the split element. Element from graveyard is used during undo.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position|null} #graveyardPosition\r\n\t\t */\r\n\t\tthis.graveyardPosition = graveyardPosition ? graveyardPosition.clone() : null;\r\n\r\n\t\tif ( this.graveyardPosition ) {\r\n\t\t\tthis.graveyardPosition.stickiness = 'toNext';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget type() {\r\n\t\treturn 'split';\r\n\t}\r\n\r\n\t/**\r\n\t * Position inside the new clone of a split element.\r\n\t *\r\n\t * This is a position where nodes that are after the split position will be moved to.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/position~Position}\r\n\t */\r\n\tget moveTargetPosition() {\r\n\t\tconst path = this.insertionPosition.path.slice();\r\n\t\tpath.push( 0 );\r\n\r\n\t\treturn new Position( this.insertionPosition.root, path );\r\n\t}\r\n\r\n\t/**\r\n\t * Artificial range that contains all the nodes from the split element that will be moved to the new element.\r\n\t * The range starts at {@link ~#splitPosition} and ends in the same parent, at `POSITIVE_INFINITY` offset.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/range~Range}\r\n\t */\r\n\tget movedRange() {\r\n\t\tconst end = this.splitPosition.getShiftedBy( Number.POSITIVE_INFINITY );\r\n\r\n\t\treturn new Range( this.splitPosition, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/splitoperation~SplitOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\tconst split = new this.constructor( this.splitPosition, this.howMany, this.graveyardPosition, this.baseVersion );\r\n\t\tsplit.insertionPosition = this.insertionPosition;\r\n\r\n\t\treturn split;\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/mergeoperation~MergeOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\tconst graveyard = this.splitPosition.root.document.graveyard;\r\n\t\tconst graveyardPosition = new Position( graveyard, [ 0 ] );\r\n\r\n\t\treturn new MergeOperation( this.moveTargetPosition, this.howMany, this.splitPosition, graveyardPosition, this.baseVersion + 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_validate() {\r\n\t\tconst element = this.splitPosition.parent;\r\n\t\tconst offset = this.splitPosition.offset;\r\n\r\n\t\t// Validate whether split operation has correct parameters.\r\n\t\tif ( !element || element.maxOffset < offset ) {\r\n\t\t\t/**\r\n\t\t\t * Split position is invalid.\r\n\t\t\t *\r\n\t\t\t * @error split-operation-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'split-operation-position-invalid: Split position is invalid.' );\r\n\t\t} else if ( !element.parent ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot split root element.\r\n\t\t\t *\r\n\t\t\t * @error split-operation-split-in-root\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'split-operation-split-in-root: Cannot split root element.' );\r\n\t\t} else if ( this.howMany != element.maxOffset - this.splitPosition.offset ) {\r\n\t\t\t/**\r\n\t\t\t * Split operation specifies wrong number of nodes to move.\r\n\t\t\t *\r\n\t\t\t * @error split-operation-how-many-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'split-operation-how-many-invalid: Split operation specifies wrong number of nodes to move.' );\r\n\t\t} else if ( this.graveyardPosition && !this.graveyardPosition.nodeAfter ) {\r\n\t\t\t/**\r\n\t\t\t * Graveyard position invalid.\r\n\t\t\t *\r\n\t\t\t * @error split-operation-graveyard-position-invalid\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'split-operation-graveyard-position-invalid: Graveyard position invalid.' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\t_execute() {\r\n\t\tconst splitElement = this.splitPosition.parent;\r\n\r\n\t\tif ( this.graveyardPosition ) {\r\n\t\t\t_move( Range._createFromPositionAndShift( this.graveyardPosition, 1 ), this.insertionPosition );\r\n\t\t} else {\r\n\t\t\tconst newElement = splitElement._clone();\r\n\r\n\t\t\t_insert( this.insertionPosition, newElement );\r\n\t\t}\r\n\r\n\t\tconst sourceRange = new Range(\r\n\t\t\tPosition._createAt( splitElement, this.splitPosition.offset ),\r\n\t\t\tPosition._createAt( splitElement, splitElement.maxOffset )\r\n\t\t);\r\n\r\n\t\t_move( sourceRange, this.moveTargetPosition );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = super.toJSON();\r\n\r\n\t\tjson.splitPosition = this.splitPosition.toJSON();\r\n\t\tjson.insertionPosition = this.insertionPosition.toJSON();\r\n\r\n\t\tif ( this.graveyardPosition ) {\r\n\t\t\tjson.graveyardPosition = this.graveyardPosition.toJSON();\r\n\t\t}\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'SplitOperation';\r\n\t}\r\n\r\n\t/**\r\n\t * Helper function that returns a default insertion position basing on given `splitPosition`. The default insertion\r\n\t * position is after the split element.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} splitPosition\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tstatic getInsertionPosition( splitPosition ) {\r\n\t\tconst path = splitPosition.path.slice( 0, -1 );\r\n\t\tpath[ path.length - 1 ]++;\r\n\r\n\t\treturn new Position( splitPosition.root, path );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates `SplitOperation` object from deserilized object, i.e. from parsed JSON string.\r\n\t *\r\n\t * @param {Object} json Deserialized JSON object.\r\n\t * @param {module:engine/model/document~Document} document Document on which this operation will be applied.\r\n\t * @returns {module:engine/model/operation/splitoperation~SplitOperation}\r\n\t */\r\n\tstatic fromJSON( json, document ) {\r\n\t\tconst splitPosition = Position.fromJSON( json.splitPosition, document );\r\n\t\tconst insertionPosition = Position.fromJSON( json.insertionPosition, document );\r\n\t\tconst graveyardPosition = json.graveyardPosition ? Position.fromJSON( json.graveyardPosition, document ) : null;\r\n\r\n\t\tconst split = new this( splitPosition, json.howMany, graveyardPosition, json.baseVersion );\r\n\t\tsplit.insertionPosition = insertionPosition;\r\n\r\n\t\treturn split;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/rootelement\r\n */\r\n\r\nimport Element from './element';\r\n\r\n/**\r\n * Type of {@link module:engine/model/element~Element} that is a root of a model tree.\r\n * @extends module:engine/model/element~Element\r\n */\r\nexport default class RootElement extends Element {\r\n\t/**\r\n\t * Creates root element.\r\n\t *\r\n\t * @param {module:engine/model/document~Document} doc Document that is an owner of this root.\r\n\t * @param {String} name Node name.\r\n\t * @param {String} [rootName='main'] Unique root name used to identify this root\r\n\t * element by {@link module:engine/model/document~Document}.\r\n\t */\r\n\tconstructor( doc, name, rootName = 'main' ) {\r\n\t\tsuper( name );\r\n\r\n\t\t/**\r\n\t\t * Document that is an owner of this root.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/document~Document}\r\n\t\t */\r\n\t\tthis._doc = doc;\r\n\r\n\t\t/**\r\n\t\t * Unique root name used to identify this root element by {@link module:engine/model/document~Document}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.rootName = rootName;\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:engine/model/document~Document Document} that owns this root element.\r\n\t *\r\n\t * In contrary, to {@link module:engine/model/node~Node node}, root element always have a `document`.\r\n\t *\r\n\t * @readonly\r\n\t * @type {module:engine/model/document~Document|null}\r\n\t */\r\n\tget document() {\r\n\t\treturn this._doc;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tis( type, name ) {\r\n\t\tif ( !name ) {\r\n\t\t\treturn type == 'rootElement' || super.is( type );\r\n\t\t} else {\r\n\t\t\treturn ( type == 'rootElement' && name == this.name ) || super.is( type, name );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `RootElement` instance to `String` containing it's name.\r\n\t *\r\n\t * @returns {String} `RootElement` instance converted to `String`.\r\n\t */\r\n\ttoJSON() {\r\n\t\treturn this.rootName;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/writer\r\n */\r\n\r\nimport AttributeOperation from './operation/attributeoperation';\r\nimport DetachOperation from './operation/detachoperation';\r\nimport InsertOperation from './operation/insertoperation';\r\nimport MarkerOperation from './operation/markeroperation';\r\nimport MoveOperation from './operation/moveoperation';\r\nimport RenameOperation from './operation/renameoperation';\r\nimport RootAttributeOperation from './operation/rootattributeoperation';\r\nimport SplitOperation from './operation/splitoperation';\r\nimport MergeOperation from './operation/mergeoperation';\r\n\r\nimport DocumentFragment from './documentfragment';\r\nimport Text from './text';\r\nimport Element from './element';\r\nimport RootElement from './rootelement';\r\nimport Position from './position';\r\nimport Range from './range.js';\r\nimport DocumentSelection from './documentselection';\r\n\r\nimport toMap from '@ckeditor/ckeditor5-utils/src/tomap';\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * The model can only be modified by using the writer. It should be used whenever you want to create a node, modify\r\n * child nodes, attributes or text, set the selection's position and its attributes.\r\n *\r\n * The instance of the writer is only available in the {@link module:engine/model/model~Model#change `change()`} or\r\n * {@link module:engine/model/model~Model#enqueueChange `enqueueChange()`}.\r\n *\r\n *\t\tmodel.change( writer => {\r\n *\t\t\twriter.insertText( 'foo', paragraph, 'end' );\r\n *\t\t} );\r\n *\r\n * Note that the writer should never be stored and used outside of the `change()` and\r\n * `enqueueChange()` blocks.\r\n *\r\n * Note that writer's methods do not check the {@link module:engine/model/schema~Schema}. It is possible\r\n * to create incorrect model structures by using the writer. Read more about in\r\n * {@glink framework/guides/deep-dive/schema#who-checks-the-schema \"Who checks the schema?\"}.\r\n *\r\n * @see module:engine/model/model~Model#change\r\n * @see module:engine/model/model~Model#enqueueChange\r\n */\r\nexport default class Writer {\r\n\t/**\r\n\t * Creates a writer instance.\r\n\t *\r\n\t * **Note:** It is not recommended to use it directly. Use {@link module:engine/model/model~Model#change `Model#change()`} or\r\n\t * {@link module:engine/model/model~Model#enqueueChange `Model#enqueueChange()`} instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/model~Model} model\r\n\t * @param {module:engine/model/batch~Batch} batch\r\n\t */\r\n\tconstructor( model, batch ) {\r\n\t\t/**\r\n\t\t * Instance of the model on which this writer operates.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @type {module:engine/model/model~Model}\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * The batch to which this writer will add changes.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @type {module:engine/model/batch~Batch}\r\n\t\t */\r\n\t\tthis.batch = batch;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/model/text~Text text node}.\r\n\t *\r\n\t *\t\twriter.createText( 'foo' );\r\n\t *\t\twriter.createText( 'foo', { bold: true } );\r\n\t *\r\n\t * @param {String} data Text data.\r\n\t * @param {Object} [attributes] Text attributes.\r\n\t * @returns {module:engine/model/text~Text} Created text node.\r\n\t */\r\n\tcreateText( data, attributes ) {\r\n\t\treturn new Text( data, attributes );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/model/element~Element element}.\r\n\t *\r\n\t *\t\twriter.createElement( 'paragraph' );\r\n\t *\t\twriter.createElement( 'paragraph', { alignment: 'center' } );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @returns {module:engine/model/element~Element} Created element.\r\n\t */\r\n\tcreateElement( name, attributes ) {\r\n\t\treturn new Element( name, attributes );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/model/documentfragment~DocumentFragment document fragment}.\r\n\t *\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment} Created document fragment.\r\n\t */\r\n\tcreateDocumentFragment() {\r\n\t\treturn new DocumentFragment();\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts item on given position.\r\n\t *\r\n\t *\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\t *\t\twriter.insert( paragraph, position );\r\n\t *\r\n\t * Instead of using position you can use parent and offset:\r\n\t *\r\n\t *\t\tconst text = writer.createText( 'foo' );\r\n\t *\t\twriter.insert( text, paragraph, 5 );\r\n\t *\r\n\t * You can also use `end` instead of the offset to insert at the end:\r\n\t *\r\n\t *\t\tconst text = writer.createText( 'foo' );\r\n\t *\t\twriter.insert( text, paragraph, 'end' );\r\n\t *\r\n\t * Or insert before or after another element:\r\n\t *\r\n\t *\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\t *\t\twriter.insert( paragraph, anotherParagraph, 'after' );\r\n\t *\r\n\t * These parameters works the same way as {@link #createPositionAt `writer.createPositionAt()`}.\r\n\t *\r\n\t * Note that if the item already has parent it will be removed from the previous parent.\r\n\t *\r\n\t * Note that you cannot re-insert a node from a document to a different document or a document fragment. In this case,\r\n\t * `model-writer-insert-forbidden-move` is thrown.\r\n\t *\r\n\t * If you want to move {@link module:engine/model/range~Range range} instead of an\r\n\t * {@link module:engine/model/item~Item item} use {@link module:engine/model/writer~Writer#move `Writer#move()`}.\r\n\t *\r\n\t * **Note:** For a paste-like content insertion mechanism see\r\n\t * {@link module:engine/model/model~Model#insertContent `model.insertContent()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/documentfragment~DocumentFragment} item Item or document\r\n\t * fragment to insert.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * second parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tinsert( item, itemOrPosition, offset = 0 ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tconst position = Position._createAt( itemOrPosition, offset );\r\n\r\n\t\t// If item has a parent already.\r\n\t\tif ( item.parent ) {\r\n\t\t\t// We need to check if item is going to be inserted within the same document.\r\n\t\t\tif ( isSameTree( item.root, position.root ) ) {\r\n\t\t\t\t// If it's we just need to move it.\r\n\t\t\t\tthis.move( Range._createOn( item ), position );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// If it isn't the same root.\r\n\t\t\telse {\r\n\t\t\t\tif ( item.root.document ) {\r\n\t\t\t\t\t// It is forbidden to move a node that was already in a document outside of it.\r\n\t\t\t\t\tthrow new Error( 'model-writer-insert-forbidden-move: Cannot move a node from a document to a different tree.' );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Move between two different document fragments or from document fragment to a document is possible.\r\n\t\t\t\t\t// In that case, remove the item from it's original parent.\r\n\t\t\t\t\tthis.remove( item );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst version = position.root.document ? position.root.document.version : null;\r\n\r\n\t\tconst insert = new InsertOperation( position, item, version );\r\n\r\n\t\tif ( item instanceof Text ) {\r\n\t\t\tinsert.shouldReceiveAttributes = true;\r\n\t\t}\r\n\r\n\t\tthis.batch.addOperation( insert );\r\n\t\tthis.model.applyOperation( insert );\r\n\r\n\t\t// When element is a DocumentFragment we need to move its markers to Document#markers.\r\n\t\tif ( item instanceof DocumentFragment ) {\r\n\t\t\tfor ( const [ markerName, markerRange ] of item.markers ) {\r\n\t\t\t\t// We need to migrate marker range from DocumentFragment to Document.\r\n\t\t\t\tconst rangeRootPosition = Position._createAt( markerRange.root, 0 );\r\n\t\t\t\tconst range = new Range(\r\n\t\t\t\t\tmarkerRange.start._getCombined( rangeRootPosition, position ),\r\n\t\t\t\t\tmarkerRange.end._getCombined( rangeRootPosition, position )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tthis.addMarker( markerName, { range, usingOperation: true, affectsData: true } );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and inserts text on given position. You can optionally set text attributes:\r\n\t *\r\n\t *\t\twriter.insertText( 'foo', position );\r\n\t *\t\twriter.insertText( 'foo', { bold: true }, position );\r\n\t *\r\n\t * Instead of using position you can use parent and offset or define that text should be inserted at the end\r\n\t * or before or after other node:\r\n\t *\r\n\t *\t\t// Inserts 'foo' in paragraph, at offset 5:\r\n\t *\t\twriter.insertText( 'foo', paragraph, 5 );\r\n\t *\t\t// Inserts 'foo' at the end of a paragraph:\r\n\t *\t\twriter.insertText( 'foo', paragraph, 'end' );\r\n\t *\t\t// Inserts 'foo' after an image:\r\n\t *\t\twriter.insertText( 'foo', image, 'after' );\r\n\t *\r\n\t * These parameters work in the same way as {@link #createPositionAt `writer.createPositionAt()`}.\r\n\t *\r\n\t * @param {String} data Text data.\r\n\t * @param {Object} [attributes] Text attributes.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * third parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tinsertText( text, attributes, itemOrPosition, offset ) {\r\n\t\tif ( attributes instanceof DocumentFragment || attributes instanceof Element || attributes instanceof Position ) {\r\n\t\t\tthis.insert( this.createText( text ), attributes, itemOrPosition );\r\n\t\t} else {\r\n\t\t\tthis.insert( this.createText( text, attributes ), itemOrPosition, offset );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and inserts element on given position. You can optionally set attributes:\r\n\t *\r\n\t *\t\twriter.insertElement( 'paragraph', position );\r\n\t *\t\twriter.insertElement( 'paragraph', { alignment: 'center' }, position );\r\n\t *\r\n\t * Instead of using position you can use parent and offset or define that text should be inserted at the end\r\n\t * or before or after other node:\r\n\t *\r\n\t *\t\t// Inserts paragraph in the root at offset 5:\r\n\t *\t\twriter.insertElement( 'paragraph', root, 5 );\r\n\t *\t\t// Inserts paragraph at the end of a blockquote:\r\n\t *\t\twriter.insertElement( 'paragraph', blockquote, 'end' );\r\n\t *\t\t// Inserts after an image:\r\n\t *\t\twriter.insertElement( 'paragraph', image, 'after' );\r\n\t *\r\n\t * These parameters works the same way as {@link #createPositionAt `writer.createPositionAt()`}.\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * third parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tinsertElement( name, attributes, itemOrPosition, offset ) {\r\n\t\tif ( attributes instanceof DocumentFragment || attributes instanceof Element || attributes instanceof Position ) {\r\n\t\t\tthis.insert( this.createElement( name ), attributes, itemOrPosition );\r\n\t\t} else {\r\n\t\t\tthis.insert( this.createElement( name, attributes ), itemOrPosition, offset );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts item at the end of the given parent.\r\n\t *\r\n\t *\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\t *\t\twriter.append( paragraph, root );\r\n\t *\r\n\t * Note that if the item already has parent it will be removed from the previous parent.\r\n\t *\r\n\t * If you want to move {@link module:engine/model/range~Range range} instead of an\r\n\t * {@link module:engine/model/item~Item item} use {@link module:engine/model/writer~Writer#move `Writer#move()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/documentfragment~DocumentFragment}\r\n\t * item Item or document fragment to insert.\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} parent\r\n\t */\r\n\tappend( item, parent ) {\r\n\t\tthis.insert( item, parent, 'end' );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates text node and inserts it at the end of the parent. You can optionally set text attributes:\r\n\t *\r\n\t *\t\twriter.appendText( 'foo', paragraph );\r\n\t *\t\twriter.appendText( 'foo', { bold: true }, paragraph );\r\n\t *\r\n\t * @param {String} text Text data.\r\n\t * @param {Object} [attributes] Text attributes.\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} parent\r\n\t */\r\n\tappendText( text, attributes, parent ) {\r\n\t\tif ( attributes instanceof DocumentFragment || attributes instanceof Element ) {\r\n\t\t\tthis.insert( this.createText( text ), attributes, 'end' );\r\n\t\t} else {\r\n\t\t\tthis.insert( this.createText( text, attributes ), parent, 'end' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates element and inserts it at the end of the parent. You can optionally set attributes:\r\n\t *\r\n\t *\t\twriter.appendElement( 'paragraph', root );\r\n\t *\t\twriter.appendElement( 'paragraph', { alignment: 'center' }, root );\r\n\t *\r\n\t * @param {String} name Name of the element.\r\n\t * @param {Object} [attributes] Elements attributes.\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} parent\r\n\t */\r\n\tappendElement( name, attributes, parent ) {\r\n\t\tif ( attributes instanceof DocumentFragment || attributes instanceof Element ) {\r\n\t\t\tthis.insert( this.createElement( name ), attributes, 'end' );\r\n\t\t} else {\r\n\t\t\tthis.insert( this.createElement( name, attributes ), parent, 'end' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets value of the attribute with given key on a {@link module:engine/model/item~Item model item}\r\n\t * or on a {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @param {*} value Attribute new value.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/range~Range} itemOrRange\r\n\t * Model item or range on which the attribute will be set.\r\n\t */\r\n\tsetAttribute( key, value, itemOrRange ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( itemOrRange instanceof Range ) {\r\n\t\t\tconst ranges = itemOrRange.getMinimalFlatRanges();\r\n\r\n\t\t\tfor ( const range of ranges ) {\r\n\t\t\t\tsetAttributeOnRange( this, key, value, range );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsetAttributeOnItem( this, key, value, itemOrRange );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets values of attributes on a {@link module:engine/model/item~Item model item}\r\n\t * or on a {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t *\t\twriter.setAttributes( {\r\n\t *\t\t\tbold: true,\r\n\t *\t\t\titalic: true\r\n\t *\t\t}, range );\r\n\t *\r\n\t * @param {Object} attributes Attributes keys and values.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/range~Range} itemOrRange\r\n\t * Model item or range on which the attributes will be set.\r\n\t */\r\n\tsetAttributes( attributes, itemOrRange ) {\r\n\t\tfor ( const [ key, val ] of toMap( attributes ) ) {\r\n\t\t\tthis.setAttribute( key, val, itemOrRange );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute with given key from a {@link module:engine/model/item~Item model item}\r\n\t * or from a {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t * @param {String} key Attribute key.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/range~Range} itemOrRange\r\n\t * Model item or range from which the attribute will be removed.\r\n\t */\r\n\tremoveAttribute( key, itemOrRange ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( itemOrRange instanceof Range ) {\r\n\t\t\tconst ranges = itemOrRange.getMinimalFlatRanges();\r\n\r\n\t\t\tfor ( const range of ranges ) {\r\n\t\t\t\tsetAttributeOnRange( this, key, null, range );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsetAttributeOnItem( this, key, null, itemOrRange );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all attributes from all elements in the range or from the given item.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/range~Range} itemOrRange\r\n\t * Model item or range from which all attributes will be removed.\r\n\t */\r\n\tclearAttributes( itemOrRange ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tconst removeAttributesFromItem = item => {\r\n\t\t\tfor ( const attribute of item.getAttributeKeys() ) {\r\n\t\t\t\tthis.removeAttribute( attribute, item );\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif ( !( itemOrRange instanceof Range ) ) {\r\n\t\t\tremoveAttributesFromItem( itemOrRange );\r\n\t\t} else {\r\n\t\t\tfor ( const item of itemOrRange.getItems() ) {\r\n\t\t\t\tremoveAttributesFromItem( item );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Moves all items in the source range to the target position.\r\n\t *\r\n\t *\t\twriter.move( sourceRange, targetPosition );\r\n\t *\r\n\t * Instead of the target position you can use parent and offset or define that range should be moved to the end\r\n\t * or before or after chosen item:\r\n\t *\r\n\t *\t\t// Moves all items in the range to the paragraph at offset 5:\r\n\t *\t\twriter.move( sourceRange, paragraph, 5 );\r\n\t *\t\t// Moves all items in the range to the end of a blockquote:\r\n\t *\t\twriter.move( sourceRange, blockquote, 'end' );\r\n\t *\t\t// Moves all items in the range to a position after an image:\r\n\t *\t\twriter.move( sourceRange, image, 'after' );\r\n\t *\r\n\t * These parameters works the same way as {@link #createPositionAt `writer.createPositionAt()`}.\r\n\t *\r\n\t * Note that items can be moved only within the same tree. It means that you can move items within the same root\r\n\t * (element or document fragment) or between {@link module:engine/model/document~Document#roots documents roots},\r\n\t * but you can not move items from document fragment to the document or from one detached element to another. Use\r\n\t * {@link module:engine/model/writer~Writer#insert} in such cases.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} range Source range.\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * second parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tmove( range, itemOrPosition, offset ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( !( range instanceof Range ) ) {\r\n\t\t\t/**\r\n\t\t\t * Invalid range to move.\r\n\t\t\t *\r\n\t\t\t * @error writer-move-invalid-range\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-move-invalid-range: Invalid range to move.' );\r\n\t\t}\r\n\r\n\t\tif ( !range.isFlat ) {\r\n\t\t\t/**\r\n\t\t\t * Range to move is not flat.\r\n\t\t\t *\r\n\t\t\t * @error writer-move-range-not-flat\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-move-range-not-flat: Range to move is not flat.' );\r\n\t\t}\r\n\r\n\t\tconst position = Position._createAt( itemOrPosition, offset );\r\n\r\n\t\tif ( !isSameTree( range.root, position.root ) ) {\r\n\t\t\t/**\r\n\t\t\t * Range is going to be moved within not the same document. Please use\r\n\t\t\t * {@link module:engine/model/writer~Writer#insert insert} instead.\r\n\t\t\t *\r\n\t\t\t * @error writer-move-different-document\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-move-different-document: Range is going to be moved between different documents.' );\r\n\t\t}\r\n\r\n\t\tconst version = range.root.document ? range.root.document.version : null;\r\n\t\tconst operation = new MoveOperation( range.start, range.end.offset - range.start.offset, position, version );\r\n\r\n\t\tthis.batch.addOperation( operation );\r\n\t\tthis.model.applyOperation( operation );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes given model {@link module:engine/model/item~Item item} or {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/range~Range} itemOrRange Model item or range to remove.\r\n\t */\r\n\tremove( itemOrRange ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( itemOrRange instanceof Range ) {\r\n\t\t\t// The array is reversed, so the ranges to remove are in correct order and do not have to be updated.\r\n\t\t\tconst ranges = itemOrRange.getMinimalFlatRanges().reverse();\r\n\r\n\t\t\tfor ( const flat of ranges ) {\r\n\t\t\t\tapplyRemoveOperation( flat.start, flat.end.offset - flat.start.offset, this.batch, this.model );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst howMany = itemOrRange.is( 'text' ) ? itemOrRange.offsetSize : 1;\r\n\r\n\t\t\tapplyRemoveOperation( Position._createBefore( itemOrRange ), howMany, this.batch, this.model );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Merges two siblings at the given position.\r\n\t *\r\n\t * Node before and after the position have to be an element. Otherwise `writer-merge-no-element-before` or\r\n\t * `writer-merge-no-element-after` error will be thrown.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position between merged elements.\r\n\t */\r\n\tmerge( position ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tconst nodeBefore = position.nodeBefore;\r\n\t\tconst nodeAfter = position.nodeAfter;\r\n\r\n\t\tif ( !( nodeBefore instanceof Element ) ) {\r\n\t\t\t/**\r\n\t\t\t * Node before merge position must be an element.\r\n\t\t\t *\r\n\t\t\t * @error writer-merge-no-element-before\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-merge-no-element-before: Node before merge position must be an element.' );\r\n\t\t}\r\n\r\n\t\tif ( !( nodeAfter instanceof Element ) ) {\r\n\t\t\t/**\r\n\t\t\t * Node after merge position must be an element.\r\n\t\t\t *\r\n\t\t\t * @error writer-merge-no-element-after\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-merge-no-element-after: Node after merge position must be an element.' );\r\n\t\t}\r\n\r\n\t\tif ( !position.root.document ) {\r\n\t\t\tthis._mergeDetached( position );\r\n\t\t} else {\r\n\t\t\tthis._merge( position );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createPositionFromPath `Model#createPositionFromPath()`}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} root Root of the position.\r\n\t * @param {Array.<Number>} path Position path. See {@link module:engine/model/position~Position#path}.\r\n\t * @param {module:engine/model/position~PositionStickiness} [stickiness='toNone'] Position stickiness.\r\n\t * See {@link module:engine/model/position~PositionStickiness}.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionFromPath( root, path, stickiness ) {\r\n\t\treturn this.model.createPositionFromPath( root, path, stickiness );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createPositionAt `Model#createPositionAt()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionAt( itemOrPosition, offset ) {\r\n\t\treturn this.model.createPositionAt( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createPositionAfter `Model#createPositionAfter()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item after which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionAfter( item ) {\r\n\t\treturn this.model.createPositionAfter( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createPositionBefore `Model#createPositionBefore()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item after which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionBefore( item ) {\r\n\t\treturn this.model.createPositionBefore( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createRange `Model#createRange()`}.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} start Start position.\r\n\t * @param {module:engine/model/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRange( start, end ) {\r\n\t\treturn this.model.createRange( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createRangeIn `Model#createRangeIn()`}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRangeIn( element ) {\r\n\t\treturn this.model.createRangeIn( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createRangeOn `Model#createRangeOn()`}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRangeOn( element ) {\r\n\t\treturn this.model.createRangeOn( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Shortcut for {@link module:engine/model/model~Model#createSelection `Model#createSelection()`}.\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/element~Element|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @returns {module:engine/model/selection~Selection}\r\n\t */\r\n\tcreateSelection( selectable, placeOrOffset, options ) {\r\n\t\treturn this.model.createSelection( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Performs merge action in a detached tree.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/position~Position} position Position between merged elements.\r\n\t */\r\n\t_mergeDetached( position ) {\r\n\t\tconst nodeBefore = position.nodeBefore;\r\n\t\tconst nodeAfter = position.nodeAfter;\r\n\r\n\t\tthis.move( Range._createIn( nodeAfter ), Position._createAt( nodeBefore, 'end' ) );\r\n\t\tthis.remove( nodeAfter );\r\n\t}\r\n\r\n\t/**\r\n\t * Performs merge action in a non-detached tree.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/position~Position} position Position between merged elements.\r\n\t */\r\n\t_merge( position ) {\r\n\t\tconst targetPosition = Position._createAt( position.nodeBefore, 'end' );\r\n\t\tconst sourcePosition = Position._createAt( position.nodeAfter, 0 );\r\n\r\n\t\tconst graveyard = position.root.document.graveyard;\r\n\t\tconst graveyardPosition = new Position( graveyard, [ 0 ] );\r\n\r\n\t\tconst version = position.root.document.version;\r\n\r\n\t\tconst merge = new MergeOperation( sourcePosition, position.nodeAfter.maxOffset, targetPosition, graveyardPosition, version );\r\n\r\n\t\tthis.batch.addOperation( merge );\r\n\t\tthis.model.applyOperation( merge );\r\n\t}\r\n\r\n\t/**\r\n\t * Renames the given element.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} element The element to rename.\r\n\t * @param {String} newName New element name.\r\n\t */\r\n\trename( element, newName ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( !( element instanceof Element ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to rename an object which is not an instance of Element.\r\n\t\t\t *\r\n\t\t\t * @error writer-rename-not-element-instance\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'writer-rename-not-element-instance: Trying to rename an object which is not an instance of Element.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst version = element.root.document ? element.root.document.version : null;\r\n\t\tconst renameOperation = new RenameOperation( Position._createBefore( element ), element.name, newName, version );\r\n\r\n\t\tthis.batch.addOperation( renameOperation );\r\n\t\tthis.model.applyOperation( renameOperation );\r\n\t}\r\n\r\n\t/**\r\n\t * Splits elements starting from the given position and going to the top of the model tree as long as given\r\n\t * `limitElement` is reached. When `limitElement` is not defined then only the parent of the given position will be split.\r\n\t *\r\n\t * The element needs to have a parent. It cannot be a root element nor a document fragment.\r\n\t * The `writer-split-element-no-parent` error will be thrown if you try to split an element with no parent.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position Position of split.\r\n\t * @param {module:engine/model/node~Node} [limitElement] Stop splitting when this element will be reached.\r\n\t * @returns {Object} result Split result.\r\n\t * @returns {module:engine/model/position~Position} result.position between split elements.\r\n\t * @returns {module:engine/model/range~Range} result.range Range that stars from the end of the first split element and ands\r\n\t * at the beginning of the first copy element.\r\n\t */\r\n\tsplit( position, limitElement ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tlet splitElement = position.parent;\r\n\r\n\t\tif ( !splitElement.parent ) {\r\n\t\t\t/**\r\n\t\t\t * Element with no parent can not be split.\r\n\t\t\t *\r\n\t\t\t * @error writer-split-element-no-parent\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-split-element-no-parent: Element with no parent can not be split.' );\r\n\t\t}\r\n\r\n\t\t// When limit element is not defined lets set splitElement parent as limit.\r\n\t\tif ( !limitElement ) {\r\n\t\t\tlimitElement = splitElement.parent;\r\n\t\t}\r\n\r\n\t\tif ( !position.parent.getAncestors( { includeSelf: true } ).includes( limitElement ) ) {\r\n\t\t\tthrow new CKEditorError( 'writer-split-invalid-limit-element: Limit element is not a position ancestor.' );\r\n\t\t}\r\n\r\n\t\t// We need to cache elements that will be created as a result of the first split because\r\n\t\t// we need to create a range from the end of the first split element to the beginning of the\r\n\t\t// first copy element. This should be handled by LiveRange but it doesn't work on detached nodes.\r\n\t\tlet firstSplitElement, firstCopyElement;\r\n\r\n\t\tdo {\r\n\t\t\tconst version = splitElement.root.document ? splitElement.root.document.version : null;\r\n\t\t\tconst howMany = splitElement.maxOffset - position.offset;\r\n\t\t\tconst split = new SplitOperation( position, howMany, null, version );\r\n\r\n\t\t\tthis.batch.addOperation( split );\r\n\t\t\tthis.model.applyOperation( split );\r\n\r\n\t\t\t// Cache result of the first split.\r\n\t\t\tif ( !firstSplitElement && !firstCopyElement ) {\r\n\t\t\t\tfirstSplitElement = splitElement;\r\n\t\t\t\tfirstCopyElement = position.parent.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\tposition = this.createPositionAfter( position.parent );\r\n\t\t\tsplitElement = position.parent;\r\n\t\t} while ( splitElement !== limitElement );\r\n\r\n\t\treturn {\r\n\t\t\tposition,\r\n\t\t\trange: new Range( Position._createAt( firstSplitElement, 'end' ), Position._createAt( firstCopyElement, 0 ) )\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Wraps the given range with the given element or with a new element (if a string was passed).\r\n\t *\r\n\t * **Note:** range to wrap should be a \"flat range\" (see {@link module:engine/model/range~Range#isFlat `Range#isFlat`}).\r\n\t * If not, an error will be thrown.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} range Range to wrap.\r\n\t * @param {module:engine/model/element~Element|String} elementOrString Element or name of element to wrap the range with.\r\n\t */\r\n\twrap( range, elementOrString ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( !range.isFlat ) {\r\n\t\t\t/**\r\n\t\t\t * Range to wrap is not flat.\r\n\t\t\t *\r\n\t\t\t * @error writer-wrap-range-not-flat\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-wrap-range-not-flat: Range to wrap is not flat.' );\r\n\t\t}\r\n\r\n\t\tconst element = elementOrString instanceof Element ? elementOrString : new Element( elementOrString );\r\n\r\n\t\tif ( element.childCount > 0 ) {\r\n\t\t\t/**\r\n\t\t\t * Element to wrap with is not empty.\r\n\t\t\t *\r\n\t\t\t * @error writer-wrap-element-not-empty\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-wrap-element-not-empty: Element to wrap with is not empty.' );\r\n\t\t}\r\n\r\n\t\tif ( element.parent !== null ) {\r\n\t\t\t/**\r\n\t\t\t * Element to wrap with is already attached to a tree model.\r\n\t\t\t *\r\n\t\t\t * @error writer-wrap-element-attached\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-wrap-element-attached: Element to wrap with is already attached to tree model.' );\r\n\t\t}\r\n\r\n\t\tconst version = range.root.document ? range.root.document.version : null;\r\n\r\n\t\t// Has to be `range.start` not `range.end` for better transformations.\r\n\t\tconst insert = new InsertOperation( range.start, element, version );\r\n\t\tthis.batch.addOperation( insert );\r\n\t\tthis.model.applyOperation( insert );\r\n\r\n\t\tconst move = new MoveOperation(\r\n\t\t\trange.start.getShiftedBy( 1 ),\r\n\t\t\trange.end.offset - range.start.offset,\r\n\t\t\tPosition._createAt( element, 0 ),\r\n\t\t\tversion === null ? null : version + 1\r\n\t\t);\r\n\r\n\t\tthis.batch.addOperation( move );\r\n\t\tthis.model.applyOperation( move );\r\n\t}\r\n\r\n\t/**\r\n\t * Unwraps children of the given element – all its children are moved before it and then the element is removed.\r\n\t * Throws error if you try to unwrap an element which does not have a parent.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} element Element to unwrap.\r\n\t */\r\n\tunwrap( element ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( element.parent === null ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to unwrap an element which has no parent.\r\n\t\t\t *\r\n\t\t\t * @error writer-unwrap-element-no-parent\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-unwrap-element-no-parent: Trying to unwrap an element which has no parent.' );\r\n\t\t}\r\n\r\n\t\tthis.move( Range._createIn( element ), this.createPositionAfter( element ) );\r\n\t\tthis.remove( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a {@link module:engine/model/markercollection~Marker marker}. Marker is a named range, which tracks\r\n\t * changes in the document and updates its range automatically, when model tree changes.\r\n\t *\r\n\t * As the first parameter you can set marker name.\r\n\t *\r\n\t * The required `options.usingOperation` parameter lets you decide if the marker should be managed by operations or not. See\r\n\t * {@link module:engine/model/markercollection~Marker marker class description} to learn about the difference between\r\n\t * markers managed by operations and not-managed by operations.\r\n\t *\r\n\t * The `options.affectsData` parameter, which defaults to `false`, allows you to define if a marker affects the data. It should be\r\n\t * `true` when the marker change changes the data returned by the\r\n\t * {@link module:core/editor/utils/dataapimixin~DataApi#getData `editor.getData()`} method.\r\n\t * When set to `true` it fires the {@link module:engine/model/document~Document#event:change:data `change:data`} event.\r\n\t * When set to `false` it fires the {@link module:engine/model/document~Document#event:change `change`} event.\r\n\t *\r\n\t * Create marker directly base on marker's name:\r\n\t *\r\n\t *\t\taddMarker( markerName, { range, usingOperation: false } );\r\n\t *\r\n\t * Create marker using operation:\r\n\t *\r\n\t *\t\taddMarker( markerName, { range, usingOperation: true } );\r\n\t *\r\n\t * Create marker that affects the editor data:\r\n\t *\r\n\t *\t\taddMarker( markerName, { range, usingOperation: false, affectsData: true } );\r\n\t *\r\n\t * Note: For efficiency reasons, it's best to create and keep as little markers as possible.\r\n\t *\r\n\t * @see module:engine/model/markercollection~Marker\r\n\t * @param {String} name Name of a marker to create - must be unique.\r\n\t * @param {Object} options\r\n\t * @param {Boolean} options.usingOperation Flag indicating that the marker should be added by MarkerOperation.\r\n\t * See {@link module:engine/model/markercollection~Marker#managedUsingOperations}.\r\n\t * @param {module:engine/model/range~Range} options.range Marker range.\r\n\t * @param {Boolean} [options.affectsData=false] Flag indicating that the marker changes the editor data.\r\n\t * @returns {module:engine/model/markercollection~Marker} Marker that was set.\r\n\t */\r\n\taddMarker( name, options ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( !options || typeof options.usingOperation != 'boolean' ) {\r\n\t\t\t/**\r\n\t\t\t * The `options.usingOperations` parameter is required when adding a new marker.\r\n\t\t\t *\r\n\t\t\t * @error writer-addMarker-no-usingOperations\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'writer-addMarker-no-usingOperations: The options.usingOperations parameter is required when adding a new marker.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst usingOperation = options.usingOperation;\r\n\t\tconst range = options.range;\r\n\t\tconst affectsData = options.affectsData === undefined ? false : options.affectsData;\r\n\r\n\t\tif ( this.model.markers.has( name ) ) {\r\n\t\t\t/**\r\n\t\t\t * Marker with provided name already exists.\r\n\t\t\t *\r\n\t\t\t * @error writer-addMarker-marker-exists\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-addMarker-marker-exists: Marker with provided name already exists.' );\r\n\t\t}\r\n\r\n\t\tif ( !range ) {\r\n\t\t\t/**\r\n\t\t\t * Range parameter is required when adding a new marker.\r\n\t\t\t *\r\n\t\t\t * @error writer-addMarker-no-range\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-addMarker-no-range: Range parameter is required when adding a new marker.' );\r\n\t\t}\r\n\r\n\t\tif ( !usingOperation ) {\r\n\t\t\treturn this.model.markers._set( name, range, usingOperation, affectsData );\r\n\t\t}\r\n\r\n\t\tapplyMarkerOperation( this, name, null, range, affectsData );\r\n\r\n\t\treturn this.model.markers.get( name );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds or updates a {@link module:engine/model/markercollection~Marker marker}. Marker is a named range, which tracks\r\n\t * changes in the document and updates its range automatically, when model tree changes. Still, it is possible to change the\r\n\t * marker's range directly using this method.\r\n\t *\r\n\t * As the first parameter you can set marker name or instance. If none of them is provided, new marker, with a unique\r\n\t * name is created and returned.\r\n\t *\r\n\t * The `options.usingOperation` parameter lets you change if the marker should be managed by operations or not. See\r\n\t * {@link module:engine/model/markercollection~Marker marker class description} to learn about the difference between\r\n\t * markers managed by operations and not-managed by operations. It is possible to change this option for an existing marker.\r\n\t *\r\n\t * The `options.affectsData` parameter, which defaults to `false`, allows you to define if a marker affects the data. It should be\r\n\t * `true` when the marker change changes the data returned by\r\n\t * the {@link module:core/editor/utils/dataapimixin~DataApi#getData `editor.getData()`} method.\r\n\t * When set to `true` it fires the {@link module:engine/model/document~Document#event:change:data `change:data`} event.\r\n\t * When set to `false` it fires the {@link module:engine/model/document~Document#event:change `change`} event.\r\n\t *\r\n\t * Update marker directly base on marker's name:\r\n\t *\r\n\t *\t\tupdateMarker( markerName, { range } );\r\n\t *\r\n\t * Update marker using operation:\r\n\t *\r\n\t *\t\tupdateMarker( marker, { range, usingOperation: true } );\r\n\t *\t\tupdateMarker( markerName, { range, usingOperation: true } );\r\n\t *\r\n\t * Change marker's option (start using operations to manage it):\r\n\t *\r\n\t *\t\tupdateMarker( marker, { usingOperation: true } );\r\n\t *\r\n\t * Change marker's option (inform the engine, that the marker does not affect the data anymore):\r\n\t *\r\n\t *\t\tupdateMarker( markerName, { affectsData: false } );\r\n\t *\r\n\t * @see module:engine/model/markercollection~Marker\r\n\t * @param {String} markerOrName Name of a marker to update, or a marker instance.\r\n\t * @param {Object} options\r\n\t * @param {module:engine/model/range~Range} [options.range] Marker range to update.\r\n\t * @param {Boolean} [options.usingOperation] Flag indicated whether the marker should be added by MarkerOperation.\r\n\t * See {@link module:engine/model/markercollection~Marker#managedUsingOperations}.\r\n\t * @param {Boolean} [options.affectsData] Flag indicating that the marker changes the editor data.\r\n\t */\r\n\tupdateMarker( markerOrName, options = {} ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tconst markerName = typeof markerOrName == 'string' ? markerOrName : markerOrName.name;\r\n\t\tconst currentMarker = this.model.markers.get( markerName );\r\n\r\n\t\tif ( !currentMarker ) {\r\n\t\t\t/**\r\n\t\t\t * Marker with provided name does not exists.\r\n\t\t\t *\r\n\t\t\t * @error writer-updateMarker-marker-not-exists\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-updateMarker-marker-not-exists: Marker with provided name does not exists.' );\r\n\t\t}\r\n\r\n\t\tconst hasUsingOperationDefined = typeof options.usingOperation == 'boolean';\r\n\t\tconst affectsDataDefined = typeof options.affectsData == 'boolean';\r\n\r\n\t\t// Use previously defined marker's affectsData if the property is not provided.\r\n\t\tconst affectsData = affectsDataDefined ? options.affectsData : currentMarker.affectsData;\r\n\r\n\t\tif ( !hasUsingOperationDefined && !options.range && !affectsDataDefined ) {\r\n\t\t\t/**\r\n\t\t\t * One of the options is required - provide range, usingOperations or affectsData.\r\n\t\t\t *\r\n\t\t\t * @error writer-updateMarker-wrong-options\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'writer-updateMarker-wrong-options: One of the options is required - provide range, usingOperations or affectsData.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst currentRange = currentMarker.getRange();\r\n\t\tconst updatedRange = options.range ? options.range : currentRange;\r\n\r\n\t\tif ( hasUsingOperationDefined && options.usingOperation !== currentMarker.managedUsingOperations ) {\r\n\t\t\t// The marker type is changed so it's necessary to create proper operations.\r\n\t\t\tif ( options.usingOperation ) {\r\n\t\t\t\t// If marker changes to a managed one treat this as synchronizing existing marker.\r\n\t\t\t\t// Create `MarkerOperation` with `oldRange` set to `null`, so reverse operation will remove the marker.\r\n\t\t\t\tapplyMarkerOperation( this, markerName, null, updatedRange, affectsData );\r\n\t\t\t} else {\r\n\t\t\t\t// If marker changes to a marker that do not use operations then we need to create additional operation\r\n\t\t\t\t// that removes that marker first.\r\n\t\t\t\tapplyMarkerOperation( this, markerName, currentRange, null, affectsData );\r\n\r\n\t\t\t\t// Although not managed the marker itself should stay in model and its range should be preserver or changed to passed range.\r\n\t\t\t\tthis.model.markers._set( markerName, updatedRange, undefined, affectsData );\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Marker's type doesn't change so update it accordingly.\r\n\t\tif ( currentMarker.managedUsingOperations ) {\r\n\t\t\tapplyMarkerOperation( this, markerName, currentRange, updatedRange, affectsData );\r\n\t\t} else {\r\n\t\t\tthis.model.markers._set( markerName, updatedRange, undefined, affectsData );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes given {@link module:engine/model/markercollection~Marker marker} or marker with given name.\r\n\t * The marker is removed accordingly to how it has been created, so if the marker was created using operation,\r\n\t * it will be destroyed using operation.\r\n\t *\r\n\t * @param {module:engine/model/markercollection~Marker|String} markerOrName Marker or marker name to remove.\r\n\t */\r\n\tremoveMarker( markerOrName ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tconst name = typeof markerOrName == 'string' ? markerOrName : markerOrName.name;\r\n\r\n\t\tif ( !this.model.markers.has( name ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to remove marker which does not exist.\r\n\t\t\t *\r\n\t\t\t * @error writer-removeMarker-no-marker\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'writer-removeMarker-no-marker: Trying to remove marker which does not exist.' );\r\n\t\t}\r\n\r\n\t\tconst marker = this.model.markers.get( name );\r\n\r\n\t\tif ( !marker.managedUsingOperations ) {\r\n\t\t\tthis.model.markers._remove( name );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst oldRange = marker.getRange();\r\n\r\n\t\tapplyMarkerOperation( this, name, oldRange, null, marker.affectsData );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the document's selection (ranges and direction) to the specified location based on:\r\n\t *\r\n\t * * the given {@link module:engine/model/selection~Selection selection},\r\n\t * * or the given {@link module:engine/model/position~Position position},\r\n\t * * or the given {@link module:engine/model/range~Range range},\r\n\t * * or the given iterable of {@link module:engine/model/range~Range ranges},\r\n\t * * or the given {@link module:engine/model/node~Node node},\r\n\t * * or `null`.\r\n\t *\r\n\t *\t\t// Sets selection to the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\twriter.setSelection( range );\r\n\t *\r\n\t *\t\t// Sets selection to given ranges.\r\n\t *\t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\twriter.setSelection( range );\r\n\t *\r\n\t *\t\t// Sets selection to other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\twriter.setSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Sets selection to the given document selection.\r\n\t *\t\tconst documentSelection = model.document.selection;\r\n\t *\t\twriter.setSelection( documentSelection );\r\n\t *\r\n\t *\t\t// Sets collapsed selection at the given position.\r\n\t *\t\tconst position = writer.createPosition( root, path );\r\n\t *\t\twriter.setSelection( position );\r\n\t *\r\n\t *\t\t// Sets collapsed selection at the position of the given node and an offset.\r\n\t *\t\twriter.setSelection( paragraph, offset );\r\n\t *\r\n\t * Creates a range inside an {@link module:engine/model/element~Element element} which starts before the first child of\r\n \t * that element and ends after the last child of that element.\r\n\t *\r\n\t *\t\twriter.setSelection( paragraph, 'in' );\r\n\t *\r\n\t * Creates a range on an {@link module:engine/model/item~Item item} which starts before the item and ends just after the item.\r\n\t *\r\n\t *\t\twriter.setSelection( paragraph, 'on' );\r\n\t *\r\n\t *\t\t// Removes all selection's ranges.\r\n\t *\t\twriter.setSelection( null );\r\n\t *\r\n\t * `Writer#setSelection()` allow passing additional options (`backward`) as the last argument.\r\n\t *\r\n\t *\t\t// Sets selection as backward.\r\n\t *\t\twriter.setSelection( range, { backward: true } );\r\n\t *\r\n\t * Throws `writer-incorrect-use` error when the writer is used outside the `change()` block.\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/node~Node|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t */\r\n\tsetSelection( selectable, placeOrOffset, options ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tthis.model.document.selection._setTo( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves {@link module:engine/model/documentselection~DocumentSelection#focus} to the specified location.\r\n\t *\r\n\t * The location can be specified in the same form as\r\n\t * {@link #createPositionAt `writer.createPositionAt()`} parameters.\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset=0] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tsetSelectionFocus( itemOrPosition, offset ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tthis.model.document.selection._setFocus( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets attribute(s) on the selection. If attribute with the same key already is set, it's value is overwritten.\r\n\t *\r\n\t * Using key and value pair:\r\n\t *\r\n\t * \twriter.setSelectionAttribute( 'italic', true );\r\n\t *\r\n\t * Using key-value object:\r\n\t *\r\n\t * \twriter.setSelectionAttribute( { italic: true, bold: false } );\r\n\t *\r\n\t * Using iterable object:\r\n\t *\r\n\t * \twriter.setSelectionAttribute( new Map( [ [ 'italic', true ] ] ) );\r\n\t *\r\n\t * @param {String|Object|Iterable.<*>} keyOrObjectOrIterable Key of the attribute to set\r\n\t * or object / iterable of key => value attribute pairs.\r\n\t * @param {*} [value] Attribute value.\r\n\t */\r\n\tsetSelectionAttribute( keyOrObjectOrIterable, value ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( typeof keyOrObjectOrIterable === 'string' ) {\r\n\t\t\tthis._setSelectionAttribute( keyOrObjectOrIterable, value );\r\n\t\t} else {\r\n\t\t\tfor ( const [ key, value ] of toMap( keyOrObjectOrIterable ) ) {\r\n\t\t\t\tthis._setSelectionAttribute( key, value );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes attribute(s) with given key(s) from the selection.\r\n\t *\r\n\t * Remove one attribute:\r\n\t *\r\n\t *\t\twriter.removeSelectionAttribute( 'italic' );\r\n\t *\r\n\t * Remove multiple attributes:\r\n\t *\r\n\t *\t\twriter.removeSelectionAttribute( [ 'italic', 'bold' ] );\r\n\t *\r\n\t * @param {String|Iterable.<String>} keyOrIterableOfKeys Key of the attribute to remove or an iterable of attribute keys to remove.\r\n\t */\r\n\tremoveSelectionAttribute( keyOrIterableOfKeys ) {\r\n\t\tthis._assertWriterUsedCorrectly();\r\n\r\n\t\tif ( typeof keyOrIterableOfKeys === 'string' ) {\r\n\t\t\tthis._removeSelectionAttribute( keyOrIterableOfKeys );\r\n\t\t} else {\r\n\t\t\tfor ( const key of keyOrIterableOfKeys ) {\r\n\t\t\t\tthis._removeSelectionAttribute( key );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Temporarily changes the {@link module:engine/model/documentselection~DocumentSelection#isGravityOverridden gravity}\r\n\t * of the selection from left to right.\r\n\t *\r\n\t * The gravity defines from which direction the selection inherits its attributes. If it's the default left gravity,\r\n\t * then the selection (after being moved by the user) inherits attributes from its left-hand side.\r\n\t * This method allows to temporarily override this behavior by forcing the gravity to the right.\r\n\t *\r\n\t * For the following model fragment:\r\n\t *\r\n\t *\t\t<$text bold=\"true\" linkHref=\"url\">bar[]</$text><$text bold=\"true\">biz</$text>\r\n\t *\r\n\t * * Default gravity: selection will have the `bold` and `linkHref` attributes.\r\n\t * * Overridden gravity: selection will have `bold` attribute.\r\n\t *\r\n\t * **Note**: It returns an unique identifier which is required to restore the gravity. It guarantees the symmetry\r\n\t * of the process.\r\n\t *\r\n\t * @returns {String} The unique id which allows restoring the gravity.\r\n\t */\r\n\toverrideSelectionGravity() {\r\n\t\treturn this.model.document.selection._overrideGravity();\r\n\t}\r\n\r\n\t/**\r\n\t * Restores {@link ~Writer#overrideSelectionGravity} gravity to default.\r\n\t *\r\n\t * Restoring the gravity is only possible using the unique identifier returned by\r\n\t * {@link ~Writer#overrideSelectionGravity}. Note that the gravity remains overridden as long as won't be restored\r\n\t * the same number of times it was overridden.\r\n\t *\r\n\t * @param {String} uid The unique id returned by {@link ~Writer#overrideSelectionGravity}.\r\n\t */\r\n\trestoreSelectionGravity( uid ) {\r\n\t\tthis.model.document.selection._restoreGravity( uid );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {String} key Key of the attribute to remove.\r\n\t * @param {*} value Attribute value.\r\n\t */\r\n\t_setSelectionAttribute( key, value ) {\r\n\t\tconst selection = this.model.document.selection;\r\n\r\n\t\t// Store attribute in parent element if the selection is collapsed in an empty node.\r\n\t\tif ( selection.isCollapsed && selection.anchor.parent.isEmpty ) {\r\n\t\t\tconst storeKey = DocumentSelection._getStoreAttributeKey( key );\r\n\r\n\t\t\tthis.setAttribute( storeKey, value, selection.anchor.parent );\r\n\t\t}\r\n\r\n\t\tselection._setAttribute( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {String} key Key of the attribute to remove.\r\n\t */\r\n\t_removeSelectionAttribute( key ) {\r\n\t\tconst selection = this.model.document.selection;\r\n\r\n\t\t// Remove stored attribute from parent element if the selection is collapsed in an empty node.\r\n\t\tif ( selection.isCollapsed && selection.anchor.parent.isEmpty ) {\r\n\t\t\tconst storeKey = DocumentSelection._getStoreAttributeKey( key );\r\n\r\n\t\t\tthis.removeAttribute( storeKey, selection.anchor.parent );\r\n\t\t}\r\n\r\n\t\tselection._removeAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Throws `writer-detached-writer-tries-to-modify-model` error when the writer is used outside of the `change()` block.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_assertWriterUsedCorrectly() {\r\n\t\t/**\r\n\t\t * Trying to use a writer outside a {@link module:engine/model/model~Model#change `change()` or\r\n\t\t * {@link module:engine/model/model~Model#enqueueChange `enqueueChange()`} blocks.\r\n\t\t *\r\n\t\t * The writer can only be used inside these blocks which ensures that the model\r\n\t\t * can only be changed during such \"sessions\".\r\n\t\t *\r\n\t\t * @error writer-incorrect-use\r\n\t\t */\r\n\t\tif ( this.model._currentWriter !== this ) {\r\n\t\t\tthrow new CKEditorError( 'writer-incorrect-use: Trying to use a writer outside the change() block.' );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Sets given attribute to each node in given range. When attribute value is null then attribute will be removed.\r\n//\r\n// Because attribute operation needs to have the same attribute value on the whole range, this function splits\r\n// the range into smaller parts.\r\n//\r\n// Given `range` must be flat.\r\n//\r\n// @private\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {String} key Attribute key.\r\n// @param {*} value Attribute new value.\r\n// @param {module:engine/model/range~Range} range Model range on which the attribute will be set.\r\nfunction setAttributeOnRange( writer, key, value, range ) {\r\n\tconst model = writer.model;\r\n\tconst doc = model.document;\r\n\r\n\t// Position of the last split, the beginning of the new range.\r\n\tlet lastSplitPosition = range.start;\r\n\r\n\t// Currently position in the scanning range. Because we need value after the position, it is not a current\r\n\t// position of the iterator but the previous one (we need to iterate one more time to get the value after).\r\n\tlet position;\r\n\r\n\t// Value before the currently position.\r\n\tlet valueBefore;\r\n\r\n\t// Value after the currently position.\r\n\tlet valueAfter;\r\n\r\n\tfor ( const val of range.getWalker( { shallow: true } ) ) {\r\n\t\tvalueAfter = val.item.getAttribute( key );\r\n\r\n\t\t// At the first run of the iterator the position in undefined. We also do not have a valueBefore, but\r\n\t\t// because valueAfter may be null, valueBefore may be equal valueAfter ( undefined == null ).\r\n\t\tif ( position && valueBefore != valueAfter ) {\r\n\t\t\t// if valueBefore == value there is nothing to change, so we add operation only if these values are different.\r\n\t\t\tif ( valueBefore != value ) {\r\n\t\t\t\taddOperation();\r\n\t\t\t}\r\n\r\n\t\t\tlastSplitPosition = position;\r\n\t\t}\r\n\r\n\t\tposition = val.nextPosition;\r\n\t\tvalueBefore = valueAfter;\r\n\t}\r\n\r\n\t// Because position in the loop is not the iterator position (see let position comment), the last position in\r\n\t// the while loop will be last but one position in the range. We need to check the last position manually.\r\n\tif ( position instanceof Position && position != lastSplitPosition && valueBefore != value ) {\r\n\t\taddOperation();\r\n\t}\r\n\r\n\tfunction addOperation() {\r\n\t\tconst range = new Range( lastSplitPosition, position );\r\n\t\tconst version = range.root.document ? doc.version : null;\r\n\t\tconst operation = new AttributeOperation( range, key, valueBefore, value, version );\r\n\r\n\t\twriter.batch.addOperation( operation );\r\n\t\tmodel.applyOperation( operation );\r\n\t}\r\n}\r\n\r\n// Sets given attribute to the given node. When attribute value is null then attribute will be removed.\r\n//\r\n// @private\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {String} key Attribute key.\r\n// @param {*} value Attribute new value.\r\n// @param {module:engine/model/item~Item} item Model item on which the attribute will be set.\r\nfunction setAttributeOnItem( writer, key, value, item ) {\r\n\tconst model = writer.model;\r\n\tconst doc = model.document;\r\n\tconst previousValue = item.getAttribute( key );\r\n\tlet range, operation;\r\n\r\n\tif ( previousValue != value ) {\r\n\t\tconst isRootChanged = item.root === item;\r\n\r\n\t\tif ( isRootChanged ) {\r\n\t\t\t// If we change attributes of root element, we have to use `RootAttributeOperation`.\r\n\t\t\tconst version = item.document ? doc.version : null;\r\n\r\n\t\t\toperation = new RootAttributeOperation( item, key, previousValue, value, version );\r\n\t\t} else {\r\n\t\t\trange = new Range( Position._createBefore( item ), writer.createPositionAfter( item ) );\r\n\r\n\t\t\tconst version = range.root.document ? doc.version : null;\r\n\r\n\t\t\toperation = new AttributeOperation( range, key, previousValue, value, version );\r\n\t\t}\r\n\r\n\t\twriter.batch.addOperation( operation );\r\n\t\tmodel.applyOperation( operation );\r\n\t}\r\n}\r\n\r\n// Creates and applies marker operation to {@link module:engine/model/operation/operation~Operation operation}.\r\n//\r\n// @private\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {String} name Marker name.\r\n// @param {module:engine/model/range~Range} oldRange Marker range before the change.\r\n// @param {module:engine/model/range~Range} newRange Marker range after the change.\r\n// @param {Boolean} affectsData\r\nfunction applyMarkerOperation( writer, name, oldRange, newRange, affectsData ) {\r\n\tconst model = writer.model;\r\n\tconst doc = model.document;\r\n\r\n\tconst operation = new MarkerOperation( name, oldRange, newRange, model.markers, affectsData, doc.version );\r\n\r\n\twriter.batch.addOperation( operation );\r\n\tmodel.applyOperation( operation );\r\n}\r\n\r\n// Creates `MoveOperation` or `DetachOperation` that removes `howMany` nodes starting from `position`.\r\n// The operation will be applied on given model instance and added to given operation instance.\r\n//\r\n// @private\r\n// @param {module:engine/model/position~Position} position Position from which nodes are removed.\r\n// @param {Number} howMany Number of nodes to remove.\r\n// @param {Batch} batch Batch to which the operation will be added.\r\n// @param {module:engine/model/model~Model} model Model instance on which operation will be applied.\r\nfunction applyRemoveOperation( position, howMany, batch, model ) {\r\n\tlet operation;\r\n\r\n\tif ( position.root.document ) {\r\n\t\tconst doc = model.document;\r\n\t\tconst graveyardPosition = new Position( doc.graveyard, [ 0 ] );\r\n\r\n\t\toperation = new MoveOperation( position, howMany, graveyardPosition, doc.version );\r\n\t} else {\r\n\t\toperation = new DetachOperation( position, howMany );\r\n\t}\r\n\r\n\tbatch.addOperation( operation );\r\n\tmodel.applyOperation( operation );\r\n}\r\n\r\n// Returns `true` if both root elements are the same element or both are documents root elements.\r\n//\r\n// Elements in the same tree can be moved (for instance you can move element form one documents root to another, or\r\n// within the same document fragment), but when element supposed to be moved from document fragment to the document, or\r\n// to another document it should be removed and inserted to avoid problems with OT. This is because features like undo or\r\n// collaboration may track changes on the document but ignore changes on detached fragments and should not get\r\n// unexpected `move` operation.\r\nfunction isSameTree( rootA, rootB ) {\r\n\t// If it is the same root this is the same tree.\r\n\tif ( rootA === rootB ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// If both roots are documents root it is operation within the document what we still treat as the same tree.\r\n\tif ( rootA instanceof RootElement && rootB instanceof RootElement ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/differ\r\n */\r\n\r\nimport Position from './position';\r\nimport Range from './range';\r\n\r\n/**\r\n * Calculates the difference between two model states.\r\n *\r\n * Receives operations that are to be applied on the model document. Marks parts of the model document tree which\r\n * are changed and saves the state of these elements before the change. Then, it compares saved elements with the\r\n * changed elements, after all changes are applied on the model document. Calculates the diff between saved\r\n * elements and new ones and returns a change set.\r\n */\r\nexport default class Differ {\r\n\t/**\r\n\t * Creates a `Differ` instance.\r\n\t *\r\n\t * @param {module:engine/model/markercollection~MarkerCollection} markerCollection Model's marker collection.\r\n\t */\r\n\tconstructor( markerCollection ) {\r\n\t\t/**\r\n\t\t * Reference to the model's marker collection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {module:engine/model/markercollection~MarkerCollection}\r\n\t\t */\r\n\t\tthis._markerCollection = markerCollection;\r\n\r\n\t\t/**\r\n\t\t * A map that stores changes that happened in a given element.\r\n\t\t *\r\n\t\t * The keys of the map are references to the model elements.\r\n\t\t * The values of the map are arrays with changes that were done on this element.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Map}\r\n\t\t */\r\n\t\tthis._changesInElement = new Map();\r\n\r\n\t\t/**\r\n\t\t * A map that stores \"element's children snapshots\". A snapshot is representing children of a given element before\r\n\t\t * the first change was applied on that element. Snapshot items are objects with two properties: `name`,\r\n\t\t * containing the element name (or `'$text'` for a text node) and `attributes` which is a map of the node's attributes.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Map}\r\n\t\t */\r\n\t\tthis._elementSnapshots = new Map();\r\n\r\n\t\t/**\r\n\t\t * A map that stores all changed markers.\r\n\t\t *\r\n\t\t * The keys of the map are marker names.\r\n\t\t * The values of the map are objects with the `oldRange` and `newRange` properties. They store the marker range\r\n\t\t * state before and after the change.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Map}\r\n\t\t */\r\n\t\tthis._changedMarkers = new Map();\r\n\r\n\t\t/**\r\n\t\t * Stores the number of changes that were processed. Used to order the changes chronologically. It is important\r\n\t\t * when changes are sorted.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Number}\r\n\t\t */\r\n\t\tthis._changeCount = 0;\r\n\r\n\t\t/**\r\n\t\t * For efficiency purposes, `Differ` stores the change set returned by the differ after {@link #getChanges} call.\r\n\t\t * Cache is reset each time a new operation is buffered. If the cache has not been reset, {@link #getChanges} will\r\n\t\t * return the cached value instead of calculating it again.\r\n\t\t *\r\n\t\t * This property stores those changes that did not take place in graveyard root.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Array.<Object>|null}\r\n\t\t */\r\n\t\tthis._cachedChanges = null;\r\n\r\n\t\t/**\r\n\t\t * For efficiency purposes, `Differ` stores the change set returned by the differ after the {@link #getChanges} call.\r\n\t\t * The cache is reset each time a new operation is buffered. If the cache has not been reset, {@link #getChanges} will\r\n\t\t * return the cached value instead of calculating it again.\r\n\t\t *\r\n\t\t * This property stores all changes evaluated by `Differ`, including those that took place in the graveyard.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Array.<Object>|null}\r\n\t\t */\r\n\t\tthis._cachedChangesWithGraveyard = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Informs whether there are any changes buffered in `Differ`.\r\n\t *\r\n\t * @readonly\r\n\t * @type {Boolean}\r\n\t */\r\n\tget isEmpty() {\r\n\t\treturn this._changesInElement.size == 0 && this._changedMarkers.size == 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Buffers the given operation. An operation has to be buffered before it is executed.\r\n\t *\r\n\t * Operation type is checked and it is checked which nodes it will affect. These nodes are then stored in `Differ`\r\n\t * in the state before the operation is executed.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation An operation to buffer.\r\n\t */\r\n\tbufferOperation( operation ) {\r\n\t\t// Below we take an operation, check its type, then use its parameters in marking (private) methods.\r\n\t\t// The general rule is to not mark elements inside inserted element. All inserted elements are re-rendered.\r\n\t\t// Marking changes in them would cause a \"double\" changing then.\r\n\t\t//\r\n\t\tswitch ( operation.type ) {\r\n\t\t\tcase 'insert': {\r\n\t\t\t\tif ( this._isInInsertedElement( operation.position.parent ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._markInsert( operation.position.parent, operation.position.offset, operation.nodes.maxOffset );\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'addAttribute':\r\n\t\t\tcase 'removeAttribute':\r\n\t\t\tcase 'changeAttribute': {\r\n\t\t\t\tfor ( const item of operation.range.getItems() ) {\r\n\t\t\t\t\tif ( this._isInInsertedElement( item.parent ) ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._markAttribute( item );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'remove':\r\n\t\t\tcase 'move':\r\n\t\t\tcase 'reinsert': {\r\n\t\t\t\tconst sourceParentInserted = this._isInInsertedElement( operation.sourcePosition.parent );\r\n\t\t\t\tconst targetParentInserted = this._isInInsertedElement( operation.targetPosition.parent );\r\n\r\n\t\t\t\tif ( !sourceParentInserted ) {\r\n\t\t\t\t\tthis._markRemove( operation.sourcePosition.parent, operation.sourcePosition.offset, operation.howMany );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( !targetParentInserted ) {\r\n\t\t\t\t\tthis._markInsert( operation.targetPosition.parent, operation.getMovedRangeStart().offset, operation.howMany );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'rename': {\r\n\t\t\t\tif ( this._isInInsertedElement( operation.position.parent ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._markRemove( operation.position.parent, operation.position.offset, 1 );\r\n\t\t\t\tthis._markInsert( operation.position.parent, operation.position.offset, 1 );\r\n\r\n\t\t\t\tconst range = Range._createFromPositionAndShift( operation.position, 1 );\r\n\r\n\t\t\t\tfor ( const marker of this._markerCollection.getMarkersIntersectingRange( range ) ) {\r\n\t\t\t\t\tconst markerRange = marker.getRange();\r\n\r\n\t\t\t\t\tthis.bufferMarkerChange( marker.name, markerRange, markerRange, marker.affectsData );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'split': {\r\n\t\t\t\tconst splitElement = operation.splitPosition.parent;\r\n\r\n\t\t\t\t// Mark that children of the split element were removed.\r\n\t\t\t\tif ( !this._isInInsertedElement( splitElement ) ) {\r\n\t\t\t\t\tthis._markRemove( splitElement, operation.splitPosition.offset, operation.howMany );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Mark that the new element (split copy) was inserted.\r\n\t\t\t\tif ( !this._isInInsertedElement( operation.insertionPosition.parent ) ) {\r\n\t\t\t\t\tthis._markInsert( operation.insertionPosition.parent, operation.insertionPosition.offset, 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the split took the element from the graveyard, mark that the element from the graveyard was removed.\r\n\t\t\t\tif ( operation.graveyardPosition ) {\r\n\t\t\t\t\tthis._markRemove( operation.graveyardPosition.parent, operation.graveyardPosition.offset, 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 'merge': {\r\n\t\t\t\t// Mark that the merged element was removed.\r\n\t\t\t\tconst mergedElement = operation.sourcePosition.parent;\r\n\r\n\t\t\t\tif ( !this._isInInsertedElement( mergedElement.parent ) ) {\r\n\t\t\t\t\tthis._markRemove( mergedElement.parent, mergedElement.startOffset, 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Mark that the merged element was inserted into graveyard.\r\n\t\t\t\tconst graveyardParent = operation.graveyardPosition.parent;\r\n\r\n\t\t\t\tthis._markInsert( graveyardParent, operation.graveyardPosition.offset, 1 );\r\n\r\n\t\t\t\t// Mark that children of merged element were inserted at new parent.\r\n\t\t\t\tconst mergedIntoElement = operation.targetPosition.parent;\r\n\r\n\t\t\t\tif ( !this._isInInsertedElement( mergedIntoElement ) ) {\r\n\t\t\t\t\tthis._markInsert( mergedIntoElement, operation.targetPosition.offset, mergedElement.maxOffset );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clear cache after each buffered operation as it is no longer valid.\r\n\t\tthis._cachedChanges = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Buffers a marker change.\r\n\t *\r\n\t * @param {String} markerName The name of the marker that changed.\r\n\t * @param {module:engine/model/range~Range|null} oldRange Marker range before the change or `null` if the marker has just\r\n\t * been created.\r\n\t * @param {module:engine/model/range~Range|null} newRange Marker range after the change or `null` if the marker was removed.\r\n\t * @param {Boolean} affectsData Flag indicating whether marker affects the editor data.\r\n\t */\r\n\tbufferMarkerChange( markerName, oldRange, newRange, affectsData ) {\r\n\t\tconst buffered = this._changedMarkers.get( markerName );\r\n\r\n\t\tif ( !buffered ) {\r\n\t\t\tthis._changedMarkers.set( markerName, {\r\n\t\t\t\toldRange,\r\n\t\t\t\tnewRange,\r\n\t\t\t\taffectsData\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tbuffered.newRange = newRange;\r\n\t\t\tbuffered.affectsData = affectsData;\r\n\r\n\t\t\tif ( buffered.oldRange == null && buffered.newRange == null ) {\r\n\t\t\t\t// The marker is going to be removed (`newRange == null`) but it did not exist before the first buffered change\r\n\t\t\t\t// (`buffered.oldRange == null`). In this case, do not keep the marker in buffer at all.\r\n\t\t\t\tthis._changedMarkers.delete( markerName );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all markers that should be removed as a result of buffered changes.\r\n\t *\r\n\t * @returns {Array.<Object>} Markers to remove. Each array item is an object containing the `name` and `range` properties.\r\n\t */\r\n\tgetMarkersToRemove() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor ( const [ name, change ] of this._changedMarkers ) {\r\n\t\t\tif ( change.oldRange != null ) {\r\n\t\t\t\tresult.push( { name, range: change.oldRange } );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all markers which should be added as a result of buffered changes.\r\n\t *\r\n\t * @returns {Array.<Object>} Markers to add. Each array item is an object containing the `name` and `range` properties.\r\n\t */\r\n\tgetMarkersToAdd() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor ( const [ name, change ] of this._changedMarkers ) {\r\n\t\t\tif ( change.newRange != null ) {\r\n\t\t\t\tresult.push( { name, range: change.newRange } );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether some of the buffered changes affect the editor data.\r\n\t *\r\n\t * Types of changes which affect the editor data:\r\n\t *\r\n\t * * model structure changes,\r\n\t * * attribute changes,\r\n\t * * changes of markers which were defined as `affectingData`.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t */\r\n\thasDataChanges() {\r\n\t\tfor ( const [ , change ] of this._changedMarkers ) {\r\n\t\t\tif ( change.affectsData ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If markers do not affect the data, check whether there are some changes in elements.\r\n\t\treturn this._changesInElement.size > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates the diff between the old model tree state (the state before the first buffered operations since the last {@link #reset}\r\n\t * call) and the new model tree state (actual one). It should be called after all buffered operations are executed.\r\n\t *\r\n\t * The diff set is returned as an array of diff items, each describing a change done on the model. The items are sorted by\r\n\t * the position on which the change happened. If a position {@link module:engine/model/position~Position#isBefore is before}\r\n\t * another one, it will be on an earlier index in the diff set.\r\n\t *\r\n\t * Because calculating the diff is a costly operation, the result is cached. If no new operation was buffered since the\r\n\t * previous {@link #getChanges} call, the next call will return the cached value.\r\n\t *\r\n\t * @param {Object} options Additional options.\r\n\t * @param {Boolean} [options.includeChangesInGraveyard=false] If set to `true`, also changes that happened\r\n\t * in the graveyard root will be returned. By default, changes in the graveyard root are not returned.\r\n\t * @returns {Array.<Object>} Diff between the old and the new model tree state.\r\n\t */\r\n\tgetChanges( options = { includeChangesInGraveyard: false } ) {\r\n\t\t// If there are cached changes, just return them instead of calculating changes again.\r\n\t\tif ( this._cachedChanges ) {\r\n\t\t\tif ( options.includeChangesInGraveyard ) {\r\n\t\t\t\treturn this._cachedChangesWithGraveyard.slice();\r\n\t\t\t} else {\r\n\t\t\t\treturn this._cachedChanges.slice();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Will contain returned results.\r\n\t\tconst diffSet = [];\r\n\r\n\t\t// Check all changed elements.\r\n\t\tfor ( const element of this._changesInElement.keys() ) {\r\n\t\t\t// Get changes for this element and sort them.\r\n\t\t\tconst changes = this._changesInElement.get( element ).sort( ( a, b ) => {\r\n\t\t\t\tif ( a.offset === b.offset ) {\r\n\t\t\t\t\tif ( a.type != b.type ) {\r\n\t\t\t\t\t\t// If there are multiple changes at the same position, \"remove\" change should be first.\r\n\t\t\t\t\t\t// If the order is different, for example, we would first add some nodes and then removed them\r\n\t\t\t\t\t\t// (instead of the nodes that we should remove).\r\n\t\t\t\t\t\treturn a.type == 'remove' ? -1 : 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn a.offset < b.offset ? -1 : 1;\r\n\t\t\t} );\r\n\r\n\t\t\t// Get children of this element before any change was applied on it.\r\n\t\t\tconst snapshotChildren = this._elementSnapshots.get( element );\r\n\t\t\t// Get snapshot of current element's children.\r\n\t\t\tconst elementChildren = _getChildrenSnapshot( element.getChildren() );\r\n\r\n\t\t\t// Generate actions basing on changes done on element.\r\n\t\t\tconst actions = _generateActionsFromChanges( snapshotChildren.length, changes );\r\n\r\n\t\t\tlet i = 0; // Iterator in `elementChildren` array -- iterates through current children of element.\r\n\t\t\tlet j = 0; // Iterator in `snapshotChildren` array -- iterates through old children of element.\r\n\r\n\t\t\t// Process every action.\r\n\t\t\tfor ( const action of actions ) {\r\n\t\t\t\tif ( action === 'i' ) {\r\n\t\t\t\t\t// Generate diff item for this element and insert it into the diff set.\r\n\t\t\t\t\tdiffSet.push( this._getInsertDiff( element, i, elementChildren[ i ].name ) );\r\n\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if ( action === 'r' ) {\r\n\t\t\t\t\t// Generate diff item for this element and insert it into the diff set.\r\n\t\t\t\t\tdiffSet.push( this._getRemoveDiff( element, i, snapshotChildren[ j ].name ) );\r\n\r\n\t\t\t\t\tj++;\r\n\t\t\t\t} else if ( action === 'a' ) {\r\n\t\t\t\t\t// Take attributes from saved and current children.\r\n\t\t\t\t\tconst elementAttributes = elementChildren[ i ].attributes;\r\n\t\t\t\t\tconst snapshotAttributes = snapshotChildren[ j ].attributes;\r\n\t\t\t\t\tlet range;\r\n\r\n\t\t\t\t\tif ( elementChildren[ i ].name == '$text' ) {\r\n\t\t\t\t\t\trange = new Range( Position._createAt( element, i ), Position._createAt( element, i + 1 ) );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst index = element.offsetToIndex( i );\r\n\t\t\t\t\t\trange = new Range( Position._createAt( element, i ), Position._createAt( element.getChild( index ), 0 ) );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Generate diff items for this change (there might be multiple attributes changed and\r\n\t\t\t\t\t// there is a single diff for each of them) and insert them into the diff set.\r\n\t\t\t\t\tdiffSet.push( ...this._getAttributesDiff( range, snapshotAttributes, elementAttributes ) );\r\n\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tj++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// `action` is 'equal'. Child not changed.\r\n\t\t\t\t\ti++;\r\n\t\t\t\t\tj++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Then, sort the changes by the position (change at position before other changes is first).\r\n\t\tdiffSet.sort( ( a, b ) => {\r\n\t\t\t// If the change is in different root, we don't care much, but we'd like to have all changes in given\r\n\t\t\t// root \"together\" in the array. So let's just sort them by the root name. It does not matter which root\r\n\t\t\t// will be processed first.\r\n\t\t\tif ( a.position.root != b.position.root ) {\r\n\t\t\t\treturn a.position.root.rootName < b.position.root.rootName ? -1 : 1;\r\n\t\t\t}\r\n\r\n\t\t\t// If change happens at the same position...\r\n\t\t\tif ( a.position.isEqual( b.position ) ) {\r\n\t\t\t\t// Keep chronological order of operations.\r\n\t\t\t\treturn a.changeCount - b.changeCount;\r\n\t\t\t}\r\n\r\n\t\t\t// If positions differ, position \"on the left\" should be earlier in the result.\r\n\t\t\treturn a.position.isBefore( b.position ) ? -1 : 1;\r\n\t\t} );\r\n\r\n\t\t// Glue together multiple changes (mostly on text nodes).\r\n\t\tfor ( let i = 1; i < diffSet.length; i++ ) {\r\n\t\t\tconst prevDiff = diffSet[ i - 1 ];\r\n\t\t\tconst thisDiff = diffSet[ i ];\r\n\r\n\t\t\t// Glue remove changes if they happen on text on same position.\r\n\t\t\tconst isConsecutiveTextRemove =\r\n\t\t\t\tprevDiff.type == 'remove' && thisDiff.type == 'remove' &&\r\n\t\t\t\tprevDiff.name == '$text' && thisDiff.name == '$text' &&\r\n\t\t\t\tprevDiff.position.isEqual( thisDiff.position );\r\n\r\n\t\t\t// Glue insert changes if they happen on text on consecutive fragments.\r\n\t\t\tconst isConsecutiveTextAdd =\r\n\t\t\t\tprevDiff.type == 'insert' && thisDiff.type == 'insert' &&\r\n\t\t\t\tprevDiff.name == '$text' && thisDiff.name == '$text' &&\r\n\t\t\t\tprevDiff.position.parent == thisDiff.position.parent &&\r\n\t\t\t\tprevDiff.position.offset + prevDiff.length == thisDiff.position.offset;\r\n\r\n\t\t\t// Glue attribute changes if they happen on consecutive fragments and have same key, old value and new value.\r\n\t\t\tconst isConsecutiveAttributeChange =\r\n\t\t\t\tprevDiff.type == 'attribute' && thisDiff.type == 'attribute' &&\r\n\t\t\t\tprevDiff.position.parent == thisDiff.position.parent &&\r\n\t\t\t\tprevDiff.range.isFlat && thisDiff.range.isFlat &&\r\n\t\t\t\tprevDiff.position.offset + prevDiff.length == thisDiff.position.offset &&\r\n\t\t\t\tprevDiff.attributeKey == thisDiff.attributeKey &&\r\n\t\t\t\tprevDiff.attributeOldValue == thisDiff.attributeOldValue &&\r\n\t\t\t\tprevDiff.attributeNewValue == thisDiff.attributeNewValue;\r\n\r\n\t\t\tif ( isConsecutiveTextRemove || isConsecutiveTextAdd || isConsecutiveAttributeChange ) {\r\n\t\t\t\tdiffSet[ i - 1 ].length++;\r\n\r\n\t\t\t\tif ( isConsecutiveAttributeChange ) {\r\n\t\t\t\t\tdiffSet[ i - 1 ].range.end = diffSet[ i - 1 ].range.end.getShiftedBy( 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdiffSet.splice( i, 1 );\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Remove `changeCount` property from diff items. It is used only for sorting and is internal thing.\r\n\t\tfor ( const item of diffSet ) {\r\n\t\t\tdelete item.changeCount;\r\n\r\n\t\t\tif ( item.type == 'attribute' ) {\r\n\t\t\t\tdelete item.position;\r\n\t\t\t\tdelete item.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._changeCount = 0;\r\n\r\n\t\t// Cache changes.\r\n\t\tthis._cachedChangesWithGraveyard = diffSet.slice();\r\n\t\tthis._cachedChanges = diffSet.slice().filter( _changesInGraveyardFilter );\r\n\r\n\t\tif ( options.includeChangesInGraveyard ) {\r\n\t\t\treturn this._cachedChangesWithGraveyard;\r\n\t\t} else {\r\n\t\t\treturn this._cachedChanges;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resets `Differ`. Removes all buffered changes.\r\n\t */\r\n\treset() {\r\n\t\tthis._changesInElement.clear();\r\n\t\tthis._elementSnapshots.clear();\r\n\t\tthis._changedMarkers.clear();\r\n\t\tthis._cachedChanges = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Saves and handles an insert change.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent\r\n\t * @param {Number} offset\r\n\t * @param {Number} howMany\r\n\t */\r\n\t_markInsert( parent, offset, howMany ) {\r\n\t\tconst changeItem = { type: 'insert', offset, howMany, count: this._changeCount++ };\r\n\r\n\t\tthis._markChange( parent, changeItem );\r\n\t}\r\n\r\n\t/**\r\n\t * Saves and handles a remove change.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent\r\n\t * @param {Number} offset\r\n\t * @param {Number} howMany\r\n\t */\r\n\t_markRemove( parent, offset, howMany ) {\r\n\t\tconst changeItem = { type: 'remove', offset, howMany, count: this._changeCount++ };\r\n\r\n\t\tthis._markChange( parent, changeItem );\r\n\r\n\t\tthis._removeAllNestedChanges( parent, offset, howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Saves and handles an attribute change.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/item~Item} item\r\n\t */\r\n\t_markAttribute( item ) {\r\n\t\tconst changeItem = { type: 'attribute', offset: item.startOffset, howMany: item.offsetSize, count: this._changeCount++ };\r\n\r\n\t\tthis._markChange( item.parent, changeItem );\r\n\t}\r\n\r\n\t/**\r\n\t * Saves and handles a model change.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent\r\n\t * @param {Object} changeItem\r\n\t */\r\n\t_markChange( parent, changeItem ) {\r\n\t\t// First, make a snapshot of this parent's children (it will be made only if it was not made before).\r\n\t\tthis._makeSnapshot( parent );\r\n\r\n\t\t// Then, get all changes that already were done on the element (empty array if this is the first change).\r\n\t\tconst changes = this._getChangesForElement( parent );\r\n\r\n\t\t// Then, look through all the changes, and transform them or the new change.\r\n\t\tthis._handleChange( changeItem, changes );\r\n\r\n\t\t// Add the new change.\r\n\t\tchanges.push( changeItem );\r\n\r\n\t\t// Remove incorrect changes. During transformation some change might be, for example, included in another.\r\n\t\t// In that case, the change will have `howMany` property set to `0` or less. We need to remove those changes.\r\n\t\tfor ( let i = 0; i < changes.length; i++ ) {\r\n\t\t\tif ( changes[ i ].howMany < 1 ) {\r\n\t\t\t\tchanges.splice( i, 1 );\r\n\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an array of changes that have already been saved for a given element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} element\r\n\t * @returns {Array.<Object>}\r\n\t */\r\n\t_getChangesForElement( element ) {\r\n\t\tlet changes;\r\n\r\n\t\tif ( this._changesInElement.has( element ) ) {\r\n\t\t\tchanges = this._changesInElement.get( element );\r\n\t\t} else {\r\n\t\t\tchanges = [];\r\n\r\n\t\t\tthis._changesInElement.set( element, changes );\r\n\t\t}\r\n\r\n\t\treturn changes;\r\n\t}\r\n\r\n\t/**\r\n\t * Saves a children snapshot for a given element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} element\r\n\t */\r\n\t_makeSnapshot( element ) {\r\n\t\tif ( !this._elementSnapshots.has( element ) ) {\r\n\t\t\tthis._elementSnapshots.set( element, _getChildrenSnapshot( element.getChildren() ) );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * For a given newly saved change, compares it with a change already done on the element and modifies the incoming\r\n\t * change and/or the old change.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} inc Incoming (new) change.\r\n\t * @param {Array.<Object>} changes An array containing all the changes done on that element.\r\n\t */\r\n\t_handleChange( inc, changes ) {\r\n\t\t// We need a helper variable that will store how many nodes are to be still handled for this change item.\r\n\t\t// `nodesToHandle` (how many nodes still need to be handled) and `howMany` (how many nodes were affected)\r\n\t\t// needs to be differentiated.\r\n\t\t//\r\n\t\t// This comes up when there are multiple changes that are affected by `inc` change item.\r\n\t\t//\r\n\t\t// For example: assume two insert changes: `{ offset: 2, howMany: 1 }` and `{ offset: 5, howMany: 1 }`.\r\n\t\t// Assume that `inc` change is remove `{ offset: 2, howMany: 2, nodesToHandle: 2 }`.\r\n\t\t//\r\n\t\t// Then, we:\r\n\t\t// - \"forget\" about first insert change (it is \"eaten\" by remove),\r\n\t\t// - because of that, at the end we will want to remove only one node (`nodesToHandle = 1`),\r\n\t\t// - but still we have to change offset of the second insert change from `5` to `3`!\r\n\t\t//\r\n\t\t// So, `howMany` does not change throughout items transformation and keeps information about how many nodes were affected,\r\n\t\t// while `nodesToHandle` means how many nodes need to be handled after the change item is transformed by other changes.\r\n\t\tinc.nodesToHandle = inc.howMany;\r\n\r\n\t\tfor ( const old of changes ) {\r\n\t\t\tconst incEnd = inc.offset + inc.howMany;\r\n\t\t\tconst oldEnd = old.offset + old.howMany;\r\n\r\n\t\t\tif ( inc.type == 'insert' ) {\r\n\t\t\t\tif ( old.type == 'insert' ) {\r\n\t\t\t\t\tif ( inc.offset <= old.offset ) {\r\n\t\t\t\t\t\told.offset += inc.howMany;\r\n\t\t\t\t\t} else if ( inc.offset < oldEnd ) {\r\n\t\t\t\t\t\told.howMany += inc.nodesToHandle;\r\n\t\t\t\t\t\tinc.nodesToHandle = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( old.type == 'remove' ) {\r\n\t\t\t\t\tif ( inc.offset < old.offset ) {\r\n\t\t\t\t\t\told.offset += inc.howMany;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( old.type == 'attribute' ) {\r\n\t\t\t\t\tif ( inc.offset <= old.offset ) {\r\n\t\t\t\t\t\told.offset += inc.howMany;\r\n\t\t\t\t\t} else if ( inc.offset < oldEnd ) {\r\n\t\t\t\t\t\t// This case is more complicated, because attribute change has to be split into two.\r\n\t\t\t\t\t\t// Example (assume that uppercase and lowercase letters mean different attributes):\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// initial state:\t\tabcxyz\r\n\t\t\t\t\t\t// attribute change:\taBCXYz\r\n\t\t\t\t\t\t// incoming insert:\t\taBCfooXYz\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// Change ranges cannot intersect because each item has to be described exactly (it was either\r\n\t\t\t\t\t\t// not changed, inserted, removed, or its attribute was changed). That's why old attribute\r\n\t\t\t\t\t\t// change has to be split and both parts has to be handled separately from now on.\r\n\t\t\t\t\t\tconst howMany = old.howMany;\r\n\r\n\t\t\t\t\t\told.howMany = inc.offset - old.offset;\r\n\r\n\t\t\t\t\t\t// Add the second part of attribute change to the beginning of processed array so it won't\r\n\t\t\t\t\t\t// be processed again in this loop.\r\n\t\t\t\t\t\tchanges.unshift( {\r\n\t\t\t\t\t\t\ttype: 'attribute',\r\n\t\t\t\t\t\t\toffset: incEnd,\r\n\t\t\t\t\t\t\thowMany: howMany - old.howMany,\r\n\t\t\t\t\t\t\tcount: this._changeCount++\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( inc.type == 'remove' ) {\r\n\t\t\t\tif ( old.type == 'insert' ) {\r\n\t\t\t\t\tif ( incEnd <= old.offset ) {\r\n\t\t\t\t\t\told.offset -= inc.howMany;\r\n\t\t\t\t\t} else if ( incEnd <= oldEnd ) {\r\n\t\t\t\t\t\tif ( inc.offset < old.offset ) {\r\n\t\t\t\t\t\t\tconst intersectionLength = incEnd - old.offset;\r\n\r\n\t\t\t\t\t\t\told.offset = inc.offset;\r\n\r\n\t\t\t\t\t\t\told.howMany -= intersectionLength;\r\n\t\t\t\t\t\t\tinc.nodesToHandle -= intersectionLength;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\told.howMany -= inc.nodesToHandle;\r\n\t\t\t\t\t\t\tinc.nodesToHandle = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif ( inc.offset <= old.offset ) {\r\n\t\t\t\t\t\t\tinc.nodesToHandle -= old.howMany;\r\n\t\t\t\t\t\t\told.howMany = 0;\r\n\t\t\t\t\t\t} else if ( inc.offset < oldEnd ) {\r\n\t\t\t\t\t\t\tconst intersectionLength = oldEnd - inc.offset;\r\n\r\n\t\t\t\t\t\t\told.howMany -= intersectionLength;\r\n\t\t\t\t\t\t\tinc.nodesToHandle -= intersectionLength;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( old.type == 'remove' ) {\r\n\t\t\t\t\tif ( incEnd <= old.offset ) {\r\n\t\t\t\t\t\told.offset -= inc.howMany;\r\n\t\t\t\t\t} else if ( inc.offset < old.offset ) {\r\n\t\t\t\t\t\tinc.nodesToHandle += old.howMany;\r\n\t\t\t\t\t\told.howMany = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( old.type == 'attribute' ) {\r\n\t\t\t\t\tif ( incEnd <= old.offset ) {\r\n\t\t\t\t\t\told.offset -= inc.howMany;\r\n\t\t\t\t\t} else if ( inc.offset < old.offset ) {\r\n\t\t\t\t\t\tconst intersectionLength = incEnd - old.offset;\r\n\r\n\t\t\t\t\t\told.offset = inc.offset;\r\n\t\t\t\t\t\told.howMany -= intersectionLength;\r\n\t\t\t\t\t} else if ( inc.offset < oldEnd ) {\r\n\t\t\t\t\t\tif ( incEnd <= oldEnd ) {\r\n\t\t\t\t\t\t\t// On first sight in this case we don't need to split attribute operation into two.\r\n\t\t\t\t\t\t\t// However the changes set is later converted to actions (see `_generateActionsFromChanges`).\r\n\t\t\t\t\t\t\t// For that reason, no two changes may intersect.\r\n\t\t\t\t\t\t\t// So we cannot have an attribute change that \"contains\" remove change.\r\n\t\t\t\t\t\t\t// Attribute change needs to be split.\r\n\t\t\t\t\t\t\tconst howMany = old.howMany;\r\n\r\n\t\t\t\t\t\t\told.howMany = inc.offset - old.offset;\r\n\r\n\t\t\t\t\t\t\tconst howManyAfter = howMany - old.howMany - inc.nodesToHandle;\r\n\r\n\t\t\t\t\t\t\t// Add the second part of attribute change to the beginning of processed array so it won't\r\n\t\t\t\t\t\t\t// be processed again in this loop.\r\n\t\t\t\t\t\t\tchanges.unshift( {\r\n\t\t\t\t\t\t\t\ttype: 'attribute',\r\n\t\t\t\t\t\t\t\toffset: inc.offset,\r\n\t\t\t\t\t\t\t\thowMany: howManyAfter,\r\n\t\t\t\t\t\t\t\tcount: this._changeCount++\r\n\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\told.howMany -= oldEnd - inc.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( inc.type == 'attribute' ) {\r\n\t\t\t\t// In case of attribute change, `howMany` should be kept same as `nodesToHandle`. It's not an error.\r\n\t\t\t\tif ( old.type == 'insert' ) {\r\n\t\t\t\t\tif ( inc.offset < old.offset && incEnd > old.offset ) {\r\n\t\t\t\t\t\tif ( incEnd > oldEnd ) {\r\n\t\t\t\t\t\t\t// This case is similar to a case described when incoming change was insert and old change was attribute.\r\n\t\t\t\t\t\t\t// See comment above.\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// This time incoming change is attribute. We need to split incoming change in this case too.\r\n\t\t\t\t\t\t\t// However this time, the second part of the attribute change needs to be processed further\r\n\t\t\t\t\t\t\t// because there might be other changes that it collides with.\r\n\t\t\t\t\t\t\tconst attributePart = {\r\n\t\t\t\t\t\t\t\ttype: 'attribute',\r\n\t\t\t\t\t\t\t\toffset: oldEnd,\r\n\t\t\t\t\t\t\t\thowMany: incEnd - oldEnd,\r\n\t\t\t\t\t\t\t\tcount: this._changeCount++\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tthis._handleChange( attributePart, changes );\r\n\r\n\t\t\t\t\t\t\tchanges.push( attributePart );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tinc.nodesToHandle = old.offset - inc.offset;\r\n\t\t\t\t\t\tinc.howMany = inc.nodesToHandle;\r\n\t\t\t\t\t} else if ( inc.offset >= old.offset && inc.offset < oldEnd ) {\r\n\t\t\t\t\t\tif ( incEnd > oldEnd ) {\r\n\t\t\t\t\t\t\tinc.nodesToHandle = incEnd - oldEnd;\r\n\t\t\t\t\t\t\tinc.offset = oldEnd;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tinc.nodesToHandle = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( old.type == 'attribute' ) {\r\n\t\t\t\t\t// There are only two conflicting scenarios possible here:\r\n\t\t\t\t\tif ( inc.offset >= old.offset && incEnd <= oldEnd ) {\r\n\t\t\t\t\t\t// `old` change includes `inc` change, or they are the same.\r\n\t\t\t\t\t\tinc.nodesToHandle = 0;\r\n\t\t\t\t\t\tinc.howMany = 0;\r\n\t\t\t\t\t\tinc.offset = 0;\r\n\t\t\t\t\t} else if ( inc.offset <= old.offset && incEnd >= oldEnd ) {\r\n\t\t\t\t\t\t// `inc` change includes `old` change.\r\n\t\t\t\t\t\told.howMany = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinc.howMany = inc.nodesToHandle;\r\n\t\tdelete inc.nodesToHandle;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object with a single insert change description.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent The element in which the change happened.\r\n\t * @param {Number} offset The offset at which change happened.\r\n\t * @param {String} name The name of the removed element or `'$text'` for a character.\r\n\t * @returns {Object} The diff item.\r\n\t */\r\n\t_getInsertDiff( parent, offset, name ) {\r\n\t\treturn {\r\n\t\t\ttype: 'insert',\r\n\t\t\tposition: Position._createAt( parent, offset ),\r\n\t\t\tname,\r\n\t\t\tlength: 1,\r\n\t\t\tchangeCount: this._changeCount++\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object with a single remove change description.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent The element in which change happened.\r\n\t * @param {Number} offset The offset at which change happened.\r\n\t * @param {String} name The name of the removed element or `'$text'` for a character.\r\n\t * @returns {Object} The diff item.\r\n\t */\r\n\t_getRemoveDiff( parent, offset, name ) {\r\n\t\treturn {\r\n\t\t\ttype: 'remove',\r\n\t\t\tposition: Position._createAt( parent, offset ),\r\n\t\t\tname,\r\n\t\t\tlength: 1,\r\n\t\t\tchangeCount: this._changeCount++\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array of objects where each one is a single attribute change description.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/range~Range} range The range where the change happened.\r\n\t * @param {Map} oldAttributes A map, map iterator or compatible object that contains attributes before the change.\r\n\t * @param {Map} newAttributes A map, map iterator or compatible object that contains attributes after the change.\r\n\t * @returns {Array.<Object>} An array containing one or more diff items.\r\n\t */\r\n\t_getAttributesDiff( range, oldAttributes, newAttributes ) {\r\n\t\t// Results holder.\r\n\t\tconst diffs = [];\r\n\r\n\t\t// Clone new attributes as we will be performing changes on this object.\r\n\t\tnewAttributes = new Map( newAttributes );\r\n\r\n\t\t// Look through old attributes.\r\n\t\tfor ( const [ key, oldValue ] of oldAttributes ) {\r\n\t\t\t// Check what is the new value of the attribute (or if it was removed).\r\n\t\t\tconst newValue = newAttributes.has( key ) ? newAttributes.get( key ) : null;\r\n\r\n\t\t\t// If values are different (or attribute was removed)...\r\n\t\t\tif ( newValue !== oldValue ) {\r\n\t\t\t\t// Add diff item.\r\n\t\t\t\tdiffs.push( {\r\n\t\t\t\t\ttype: 'attribute',\r\n\t\t\t\t\tposition: range.start,\r\n\t\t\t\t\trange: range.clone(),\r\n\t\t\t\t\tlength: 1,\r\n\t\t\t\t\tattributeKey: key,\r\n\t\t\t\t\tattributeOldValue: oldValue,\r\n\t\t\t\t\tattributeNewValue: newValue,\r\n\t\t\t\t\tchangeCount: this._changeCount++\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Prevent returning two diff items for the same change.\r\n\t\t\tnewAttributes.delete( key );\r\n\t\t}\r\n\r\n\t\t// Look through new attributes that weren't handled above.\r\n\t\tfor ( const [ key, newValue ] of newAttributes ) {\r\n\t\t\t// Each of them is a new attribute. Add diff item.\r\n\t\t\tdiffs.push( {\r\n\t\t\t\ttype: 'attribute',\r\n\t\t\t\tposition: range.start,\r\n\t\t\t\trange: range.clone(),\r\n\t\t\t\tlength: 1,\r\n\t\t\t\tattributeKey: key,\r\n\t\t\t\tattributeOldValue: null,\r\n\t\t\t\tattributeNewValue: newValue,\r\n\t\t\t\tchangeCount: this._changeCount++\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn diffs;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given element or any of its parents is an element that is buffered as an inserted element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} element Element to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_isInInsertedElement( element ) {\r\n\t\tconst parent = element.parent;\r\n\r\n\t\tif ( !parent ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst changes = this._changesInElement.get( parent );\r\n\t\tconst offset = element.startOffset;\r\n\r\n\t\tif ( changes ) {\r\n\t\t\tfor ( const change of changes ) {\r\n\t\t\t\tif ( change.type == 'insert' && offset >= change.offset && offset < change.offset + change.howMany ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._isInInsertedElement( parent );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes deeply all buffered changes that are registered in elements from range specified by `parent`, `offset`\r\n\t * and `howMany`.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} parent\r\n\t * @param {Number} offset\r\n\t * @param {Number} howMany\r\n\t */\r\n\t_removeAllNestedChanges( parent, offset, howMany ) {\r\n\t\tconst range = new Range( Position._createAt( parent, offset ), Position._createAt( parent, offset + howMany ) );\r\n\r\n\t\tfor ( const item of range.getItems( { shallow: true } ) ) {\r\n\t\t\tif ( item.is( 'element' ) ) {\r\n\t\t\t\tthis._elementSnapshots.delete( item );\r\n\t\t\t\tthis._changesInElement.delete( item );\r\n\r\n\t\t\t\tthis._removeAllNestedChanges( item, 0, item.maxOffset );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Returns an array that is a copy of passed child list with the exception that text nodes are split to one or more\r\n// objects, each representing one character and attributes set on that character.\r\nfunction _getChildrenSnapshot( children ) {\r\n\tconst snapshot = [];\r\n\r\n\tfor ( const child of children ) {\r\n\t\tif ( child.is( 'text' ) ) {\r\n\t\t\tfor ( let i = 0; i < child.data.length; i++ ) {\r\n\t\t\t\tsnapshot.push( {\r\n\t\t\t\t\tname: '$text',\r\n\t\t\t\t\tattributes: new Map( child.getAttributes() )\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsnapshot.push( {\r\n\t\t\t\tname: child.name,\r\n\t\t\t\tattributes: new Map( child.getAttributes() )\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\treturn snapshot;\r\n}\r\n\r\n// Generates array of actions for given changes set.\r\n// It simulates what `diff` function does.\r\n// Generated actions are:\r\n// - 'e' for 'equal' - when item at that position did not change,\r\n// - 'i' for 'insert' - when item at that position was inserted,\r\n// - 'r' for 'remove' - when item at that position was removed,\r\n// - 'a' for 'attribute' - when item at that position has it attributes changed.\r\n//\r\n// Example (assume that uppercase letters have bold attribute, compare with function code):\r\n//\r\n// children before:\tfooBAR\r\n// children after:\tfoxybAR\r\n//\r\n// changes: type: remove, offset: 1, howMany: 1\r\n//\t\t\ttype: insert, offset: 2, howMany: 2\r\n//\t\t\ttype: attribute, offset: 4, howMany: 1\r\n//\r\n// expected actions: equal (f), remove (o), equal (o), insert (x), insert (y), attribute (b), equal (A), equal (R)\r\n//\r\n// steps taken by th script:\r\n//\r\n// 1. change = \"type: remove, offset: 1, howMany: 1\"; offset = 0; oldChildrenHandled = 0\r\n//    1.1 between this change and the beginning is one not-changed node, fill with one equal action, one old child has been handled\r\n//    1.2 this change removes one node, add one remove action\r\n//    1.3 change last visited `offset` to 1\r\n//    1.4 since an old child has been removed, one more old child has been handled\r\n//    1.5 actions at this point are: equal, remove\r\n//\r\n// 2. change = \"type: insert, offset: 2, howMany: 2\"; offset = 1; oldChildrenHandled = 2\r\n//    2.1 between this change and previous change is one not-changed node, add equal action, another one old children has been handled\r\n//    2.2 this change inserts two nodes, add two insert actions\r\n//    2.3 change last visited offset to the end of the inserted range, that is 4\r\n//    2.4 actions at this point are: equal, remove, equal, insert, insert\r\n//\r\n// 3. change = \"type: attribute, offset: 4, howMany: 1\"; offset = 4, oldChildrenHandled = 3\r\n//    3.1 between this change and previous change are no not-changed nodes\r\n//    3.2 this change changes one node, add one attribute action\r\n//    3.3 change last visited `offset` to the end of change range, that is 5\r\n//    3.4 since an old child has been changed, one more old child has been handled\r\n//    3.5 actions at this point are: equal, remove, equal, insert, insert, attribute\r\n//\r\n// 4. after loop oldChildrenHandled = 4, oldChildrenLength = 6 (fooBAR is 6 characters)\r\n//    4.1 fill up with two equal actions\r\n//\r\n// The result actions are: equal, remove, equal, insert, insert, attribute, equal, equal.\r\nfunction _generateActionsFromChanges( oldChildrenLength, changes ) {\r\n\tconst actions = [];\r\n\r\n\tlet offset = 0;\r\n\tlet oldChildrenHandled = 0;\r\n\r\n\t// Go through all buffered changes.\r\n\tfor ( const change of changes ) {\r\n\t\t// First, fill \"holes\" between changes with \"equal\" actions.\r\n\t\tif ( change.offset > offset ) {\r\n\t\t\tactions.push( ...'e'.repeat( change.offset - offset ).split( '' ) );\r\n\r\n\t\t\toldChildrenHandled += change.offset - offset;\r\n\t\t}\r\n\r\n\t\t// Then, fill up actions accordingly to change type.\r\n\t\tif ( change.type == 'insert' ) {\r\n\t\t\tactions.push( ...'i'.repeat( change.howMany ).split( '' ) );\r\n\r\n\t\t\t// The last handled offset is after inserted range.\r\n\t\t\toffset = change.offset + change.howMany;\r\n\t\t} else if ( change.type == 'remove' ) {\r\n\t\t\tactions.push( ...'r'.repeat( change.howMany ).split( '' ) );\r\n\r\n\t\t\t// The last handled offset is at the position where the nodes were removed.\r\n\t\t\toffset = change.offset;\r\n\t\t\t// We removed `howMany` old nodes, update `oldChildrenHandled`.\r\n\t\t\toldChildrenHandled += change.howMany;\r\n\t\t} else {\r\n\t\t\tactions.push( ...'a'.repeat( change.howMany ).split( '' ) );\r\n\r\n\t\t\t// The last handled offset isa at the position after the changed range.\r\n\t\t\toffset = change.offset + change.howMany;\r\n\t\t\t// We changed `howMany` old nodes, update `oldChildrenHandled`.\r\n\t\t\toldChildrenHandled += change.howMany;\r\n\t\t}\r\n\t}\r\n\r\n\t// Fill \"equal\" actions at the end of actions set. Use `oldChildrenHandled` to see how many children\r\n\t// has not been changed / removed at the end of their parent.\r\n\tif ( oldChildrenHandled < oldChildrenLength ) {\r\n\t\tactions.push( ...'e'.repeat( oldChildrenLength - oldChildrenHandled ).split( '' ) );\r\n\t}\r\n\r\n\treturn actions;\r\n}\r\n\r\n// Filter callback for Array.filter that filters out change entries that are in graveyard.\r\nfunction _changesInGraveyardFilter( entry ) {\r\n\tconst posInGy = entry.position && entry.position.root.rootName == '$graveyard';\r\n\tconst rangeInGy = entry.range && entry.range.root.rootName == '$graveyard';\r\n\r\n\treturn !posInGy && !rangeInGy;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/history\r\n */\r\n\r\n/**\r\n * `History` keeps the track of all the operations applied to the {@link module:engine/model/document~Document document}.\r\n */\r\nexport default class History {\r\n\t/**\r\n\t * Creates an empty History instance.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Operations added to the history.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Array.<module:engine/model/operation/operation~Operation>} module:engine/model/history~History#_operations\r\n\t\t */\r\n\t\tthis._operations = [];\r\n\r\n\t\t/**\r\n\t\t * Holds an information which {@link module:engine/model/operation/operation~Operation operation} undoes which\r\n\t\t * {@link module:engine/model/operation/operation~Operation operation}.\r\n\t\t *\r\n\t\t * Keys of the map are \"undoing operations\", that is operations that undone some other operations. For each key, the\r\n\t\t * value is an operation that has been undone by the \"undoing operation\".\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} module:engine/model/history~History#_undoPairs\r\n\t\t */\r\n\t\tthis._undoPairs = new Map();\r\n\r\n\t\t/**\r\n\t\t * Holds all undone operations.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Set.<module:engine/model/operation/operation~Operation>} module:engine/model/history~History#_undoneOperations\r\n\t\t */\r\n\t\tthis._undoneOperations = new Set();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an operation to the history.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation Operation to add.\r\n\t */\r\n\taddOperation( operation ) {\r\n\t\tif ( this._operations.includes( operation ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._operations.push( operation );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns operations added to the history.\r\n\t *\r\n\t * @param {Number} [from=0] Base version from which operations should be returned (inclusive). Defaults to `0`, which means\r\n\t * that operations from the first one will be returned.\r\n\t * @param {Number} [to=Number.POSITIVE_INFINITY] Base version up to which operations should be returned (exclusive).\r\n\t * Defaults to `Number.POSITIVE_INFINITY` which means that operations up to the last one will be returned.\r\n\t * @returns {Iterable.<module:engine/model/operation/operation~Operation>} Operations added to the history.\r\n\t */\r\n\tgetOperations( from = 0, to = Number.POSITIVE_INFINITY ) {\r\n\t\tif ( from < 0 ) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn this._operations.slice( from, to );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns operation from the history that bases on given `baseVersion`.\r\n\t *\r\n\t * @param {Number} baseVersion Base version of the operation to get.\r\n\t * @returns {module:engine/model/operation/operation~Operation|null} Operation with given base version or `null` if\r\n\t * there is no such operation in history.\r\n\t */\r\n\tgetOperation( baseVersion ) {\r\n\t\treturn this._operations[ baseVersion ];\r\n\t}\r\n\r\n\t/**\r\n\t * Marks in history that one operation is an operation that is undoing the other operation. By marking operation this way,\r\n\t * history is keeping more context information about operations, which helps in operational transformation.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} undoneOperation Operation which is undone by `undoingOperation`.\r\n\t * @param {module:engine/model/operation/operation~Operation} undoingOperation Operation which undoes `undoneOperation`.\r\n\t */\r\n\tsetOperationAsUndone( undoneOperation, undoingOperation ) {\r\n\t\tthis._undoPairs.set( undoingOperation, undoneOperation );\r\n\t\tthis._undoneOperations.add( undoneOperation );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given `operation` is undoing any other operation.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation Operation to check.\r\n\t * @returns {Boolean} `true` if given `operation` is undoing any other operation, `false` otherwise.\r\n\t */\r\n\tisUndoingOperation( operation ) {\r\n\t\treturn this._undoPairs.has( operation );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether given `operation` has been undone by any other operation.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation Operation to check.\r\n\t * @returns {Boolean} `true` if given `operation` has been undone any other operation, `false` otherwise.\r\n\t */\r\n\tisUndoneOperation( operation ) {\r\n\t\treturn this._undoneOperations.has( operation );\r\n\t}\r\n\r\n\t/**\r\n\t * For given `undoingOperation`, returns the operation which has been undone by it.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} undoingOperation\r\n\t * @returns {module:engine/model/operation/operation~Operation|undefined} Operation that has been undone by given\r\n\t * `undoingOperation` or `undefined` if given `undoingOperation` is not undoing any other operation.\r\n\t */\r\n\tgetUndoneOperation( undoingOperation ) {\r\n\t\treturn this._undoPairs.get( undoingOperation );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * Set of utils to handle unicode characters.\r\n *\r\n * @module utils/unicode\r\n */\r\n\r\n/**\r\n * Checks whether given `character` is a combining mark.\r\n *\r\n * @param {String} character Character to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isCombiningMark( character ) {\r\n\treturn !!character && character.length == 1 && /[\\u0300-\\u036f\\u1ab0-\\u1aff\\u1dc0-\\u1dff\\u20d0-\\u20ff\\ufe20-\\ufe2f]/.test( character );\r\n}\r\n\r\n/**\r\n * Checks whether given `character` is a high half of surrogate pair.\r\n *\r\n * Using UTF-16 terminology, a surrogate pair denotes UTF-16 character using two UTF-8 characters. The surrogate pair\r\n * consist of high surrogate pair character followed by low surrogate pair character.\r\n *\r\n * @param {String} character Character to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isHighSurrogateHalf( character ) {\r\n\treturn !!character && character.length == 1 && /[\\ud800-\\udbff]/.test( character );\r\n}\r\n\r\n/**\r\n * Checks whether given `character` is a low half of surrogate pair.\r\n *\r\n * Using UTF-16 terminology, a surrogate pair denotes UTF-16 character using two UTF-8 characters. The surrogate pair\r\n * consist of high surrogate pair character followed by low surrogate pair character.\r\n *\r\n * @param {String} character Character to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isLowSurrogateHalf( character ) {\r\n\treturn !!character && character.length == 1 && /[\\udc00-\\udfff]/.test( character );\r\n}\r\n\r\n/**\r\n * Checks whether given offset in a string is inside a surrogate pair (between two surrogate halves).\r\n *\r\n * @param {String} string String to check.\r\n * @param {Number} offset Offset to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isInsideSurrogatePair( string, offset ) {\r\n\treturn isHighSurrogateHalf( string.charAt( offset - 1 ) ) && isLowSurrogateHalf( string.charAt( offset ) );\r\n}\r\n\r\n/**\r\n * Checks whether given offset in a string is between base character and combining mark or between two combining marks.\r\n *\r\n * @param {String} string String to check.\r\n * @param {Number} offset Offset to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isInsideCombinedSymbol( string, offset ) {\r\n\treturn isCombiningMark( string.charAt( offset ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/document\r\n */\r\n\r\nimport Differ from './differ';\r\nimport RootElement from './rootelement';\r\nimport History from './history';\r\nimport DocumentSelection from './documentselection';\r\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport { isInsideSurrogatePair, isInsideCombinedSymbol } from '@ckeditor/ckeditor5-utils/src/unicode';\r\nimport { clone } from 'lodash-es';\r\n\r\nconst graveyardName = '$graveyard';\r\n\r\n/**\r\n * Data model's document. It contains the model's structure, its selection and the history of changes.\r\n *\r\n * Read more about working with the model in\r\n * {@glink framework/guides/architecture/editing-engine#model introduction to the the editing engine's architecture}.\r\n *\r\n * Usually, the document contains just one {@link module:engine/model/document~Document#roots root element}, so\r\n * you can retrieve it by just calling {@link module:engine/model/document~Document#getRoot} without specifying its name:\r\n *\r\n *\t\tmodel.document.getRoot(); // -> returns the main root\r\n *\r\n * However, the document may contain multiple roots – e.g. when the editor has multiple editable areas\r\n * (e.g. a title and a body of a message).\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class Document {\r\n\t/**\r\n\t * Creates an empty document instance with no {@link #roots} (other than\r\n\t * the {@link #graveyard graveyard root}).\r\n\t */\r\n\tconstructor( model ) {\r\n\t\t/**\r\n\t\t * The {@link module:engine/model/model~Model model} that the document is a part of.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model}\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * The document version. It starts from `0` and every operation increases the version number. It is used to ensure that\r\n\t\t * operations are applied on a proper document version.\r\n\t\t *\r\n\t\t * If the {@link module:engine/model/operation/operation~Operation#baseVersion base version} does not match the document version,\r\n\t\t * a {@link module:utils/ckeditorerror~CKEditorError model-document-applyOperation-wrong-version} error is thrown.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.version = 0;\r\n\r\n\t\t/**\r\n\t\t * The document's history.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/history~History}\r\n\t\t */\r\n\t\tthis.history = new History( this );\r\n\r\n\t\t/**\r\n\t\t * The selection in this document.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/documentselection~DocumentSelection}\r\n\t\t */\r\n\t\tthis.selection = new DocumentSelection( this );\r\n\r\n\t\t/**\r\n\t\t * A list of roots that are owned and managed by this document. Use {@link #createRoot} and\r\n\t\t * {@link #getRoot} to manipulate it.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/collection~Collection}\r\n\t\t */\r\n\t\tthis.roots = new Collection( { idProperty: 'rootName' } );\r\n\r\n\t\t/**\r\n\t\t * The model differ object. Its role is to buffer changes done on the model document and then calculate a diff of those changes.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/differ~Differ}\r\n\t\t */\r\n\t\tthis.differ = new Differ( model.markers );\r\n\r\n\t\t/**\r\n\t\t * Post-fixer callbacks registered to the model document.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Set}\r\n\t\t */\r\n\t\tthis._postFixers = new Set();\r\n\r\n\t\t// Graveyard tree root. Document always have a graveyard root, which stores removed nodes.\r\n\t\tthis.createRoot( '$root', graveyardName );\r\n\r\n\t\t// First, if the operation is a document operation check if it's base version is correct.\r\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\tif ( operation.isDocumentOperation && operation.baseVersion !== this.version ) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Only operations with matching versions can be applied.\r\n\t\t\t\t *\r\n\t\t\t\t * @error document-applyOperation-wrong-version\r\n\t\t\t\t * @param {module:engine/model/operation/operation~Operation} operation\r\n\t\t\t\t */\r\n\t\t\t\tthrow new CKEditorError(\r\n\t\t\t\t\t'model-document-applyOperation-wrong-version: Only operations with matching versions can be applied.',\r\n\t\t\t\t\t{ operation }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\t// Then, still before an operation is applied on model, buffer the change in differ.\r\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\tif ( operation.isDocumentOperation ) {\r\n\t\t\t\tthis.differ.bufferOperation( operation );\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\r\n\t\t// After the operation is applied, bump document's version and add the operation to the history.\r\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\tif ( operation.isDocumentOperation ) {\r\n\t\t\t\tthis.version++;\r\n\t\t\t\tthis.history.addOperation( operation );\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// Listen to selection changes. If selection changed, mark it.\r\n\t\tlet hasSelectionChanged = false;\r\n\r\n\t\tthis.listenTo( this.selection, 'change', () => {\r\n\t\t\thasSelectionChanged = true;\r\n\t\t} );\r\n\r\n\t\t// Wait for `_change` event from model, which signalizes that outermost change block has finished.\r\n\t\t// When this happens, check if there were any changes done on document, and if so, call post-fixers,\r\n\t\t// fire `change` event for features and conversion and then reset the differ.\r\n\t\t// Fire `change:data` event when at least one operation or buffered marker changes the data.\r\n\t\tthis.listenTo( model, '_change', ( evt, writer ) => {\r\n\t\t\tif ( !this.differ.isEmpty || hasSelectionChanged ) {\r\n\t\t\t\tthis._callPostFixers( writer );\r\n\r\n\t\t\t\tif ( this.differ.hasDataChanges() ) {\r\n\t\t\t\t\tthis.fire( 'change:data', writer.batch );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fire( 'change', writer.batch );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.differ.reset();\r\n\t\t\t\thasSelectionChanged = false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Buffer marker changes.\r\n\t\t// This is not covered in buffering operations because markers may change outside of them (when they\r\n\t\t// are modified using `model.markers` collection, not through `MarkerOperation`).\r\n\t\tthis.listenTo( model.markers, 'update', ( evt, marker, oldRange, newRange ) => {\r\n\t\t\t// Whenever marker is updated, buffer that change.\r\n\t\t\tthis.differ.bufferMarkerChange( marker.name, oldRange, newRange, marker.affectsData );\r\n\r\n\t\t\tif ( oldRange === null ) {\r\n\t\t\t\t// If this is a new marker, add a listener that will buffer change whenever marker changes.\r\n\t\t\t\tmarker.on( 'change', ( evt, oldRange ) => {\r\n\t\t\t\t\tthis.differ.bufferMarkerChange( marker.name, oldRange, marker.getRange(), marker.affectsData );\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * The graveyard tree root. A document always has a graveyard root that stores removed nodes.\r\n\t *\r\n\t * @readonly\r\n\t * @member {module:engine/model/rootelement~RootElement}\r\n\t */\r\n\tget graveyard() {\r\n\t\treturn this.getRoot( graveyardName );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new root.\r\n\t *\r\n\t * @param {String} [elementName='$root'] The element name. Defaults to `'$root'` which also has some basic schema defined\r\n\t * (`$block`s are allowed inside the `$root`). Make sure to define a proper schema if you use a different name.\r\n\t * @param {String} [rootName='main'] A unique root name.\r\n\t * @returns {module:engine/model/rootelement~RootElement} The created root.\r\n\t */\r\n\tcreateRoot( elementName = '$root', rootName = 'main' ) {\r\n\t\tif ( this.roots.get( rootName ) ) {\r\n\t\t\t/**\r\n\t\t\t * A root with the specified name already exists.\r\n\t\t\t *\r\n\t\t\t * @error model-document-createRoot-name-exists\r\n\t\t\t * @param {module:engine/model/document~Document} doc\r\n\t\t\t * @param {String} name\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'model-document-createRoot-name-exists: Root with specified name already exists.',\r\n\t\t\t\t{ name: rootName }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst root = new RootElement( this, elementName, rootName );\r\n\t\tthis.roots.add( root );\r\n\r\n\t\treturn root;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all event listeners set by the document instance.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.selection.destroy();\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a root by its name.\r\n\t *\r\n\t * @param {String} [name='main'] A unique root name.\r\n\t * @returns {module:engine/model/rootelement~RootElement|null} The root registered under a given name or `null` when\r\n\t * there is no root with the given name.\r\n\t */\r\n\tgetRoot( name = 'main' ) {\r\n\t\treturn this.roots.get( name );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array with names of all roots (without the {@link #graveyard}) added to the document.\r\n\t *\r\n\t * @returns {Array.<String>} Roots names.\r\n\t */\r\n\tgetRootNames() {\r\n\t\treturn Array.from( this.roots, root => root.rootName ).filter( name => name != graveyardName );\r\n\t}\r\n\r\n\t/**\r\n\t * Used to register a post-fixer callback. A post-fixer mechanism guarantees that the features that listen to\r\n\t * the {@link module:engine/model/model~Model#event:_change model's change event} will operate on a correct model state.\r\n\t *\r\n\t * An execution of a feature may lead to an incorrect document tree state. The callbacks are used to fix the document tree after\r\n\t * it has changed. Post-fixers are fired just after all changes from the outermost change block were applied but\r\n\t * before the {@link module:engine/model/document~Document#event:change change event} is fired. If a post-fixer callback made\r\n\t * a change, it should return `true`. When this happens, all post-fixers are fired again to check if something else should\r\n\t * not be fixed in the new document tree state.\r\n\t *\r\n\t * As a parameter, a post-fixer callback receives a {@link module:engine/model/writer~Writer writer} instance connected with the\r\n\t * executed changes block. Thanks to that, all changes done by the callback will be added to the same\r\n\t * {@link module:engine/model/batch~Batch batch} (and undo step) as the original changes. This makes post-fixer changes transparent\r\n\t * for the user.\r\n\t *\r\n\t * An example of a post-fixer is a callback that checks if all the data were removed from the editor. If so, the\r\n\t * callback should add an empty paragraph so that the editor is never empty:\r\n\t *\r\n\t *\t\tdocument.registerPostFixer( writer => {\r\n\t *\t\t\tconst changes = document.differ.getChanges();\r\n\t *\r\n\t *\t\t\t// Check if the changes lead to an empty root in the editor.\r\n\t *\t\t\tfor ( const entry of changes ) {\r\n\t *\t\t\t\tif ( entry.type == 'remove' && entry.position.root.isEmpty ) {\r\n\t *\t\t\t\t\twriter.insertElement( 'paragraph', entry.position.root, 0 );\r\n\t *\r\n\t *\t\t\t\t\t// It is fine to return early, even if multiple roots would need to be fixed.\r\n\t *\t\t\t\t\t// All post-fixers will be fired again, so if there are more empty roots, those will be fixed, too.\r\n\t *\t\t\t\t\treturn true;\r\n\t *\t\t\t\t}\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {Function} postFixer\r\n\t */\r\n\tregisterPostFixer( postFixer ) {\r\n\t\tthis._postFixers.add( postFixer );\r\n\t}\r\n\r\n\t/**\r\n\t * A custom `toJSON()` method to solve child-parent circular dependencies.\r\n\t *\r\n\t * @returns {Object} A clone of this object with the document property changed to a string.\r\n\t */\r\n\ttoJSON() {\r\n\t\tconst json = clone( this );\r\n\r\n\t\t// Due to circular references we need to remove parent reference.\r\n\t\tjson.selection = '[engine.model.DocumentSelection]';\r\n\t\tjson.model = '[engine.model.Model]';\r\n\r\n\t\treturn json;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the default root for this document which is either the first root that was added to the document using\r\n\t * {@link #createRoot} or the {@link #graveyard graveyard root} if no other roots were created.\r\n\t *\r\n\t * @protected\r\n\t * @returns {module:engine/model/rootelement~RootElement} The default root for this document.\r\n\t */\r\n\t_getDefaultRoot() {\r\n\t\tfor ( const root of this.roots ) {\r\n\t\t\tif ( root !== this.graveyard ) {\r\n\t\t\t\treturn root;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.graveyard;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the default range for this selection. The default range is a collapsed range that starts and ends\r\n\t * at the beginning of this selection's document {@link #_getDefaultRoot default root}.\r\n\t *\r\n\t * @protected\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\t_getDefaultRange() {\r\n\t\tconst defaultRoot = this._getDefaultRoot();\r\n\t\tconst model = this.model;\r\n\t\tconst schema = model.schema;\r\n\r\n\t\t// Find the first position where the selection can be put.\r\n\t\tconst position = model.createPositionFromPath( defaultRoot, [ 0 ] );\r\n\t\tconst nearestRange = schema.getNearestSelectionRange( position );\r\n\r\n\t\t// If valid selection range is not found - return range collapsed at the beginning of the root.\r\n\t\treturn nearestRange || model.createRange( position );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether a given {@link module:engine/model/range~Range range} is a valid range for\r\n\t * the {@link #selection document's selection}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/range~Range} range A range to check.\r\n\t * @returns {Boolean} `true` if `range` is valid, `false` otherwise.\r\n\t */\r\n\t_validateSelectionRange( range ) {\r\n\t\treturn validateTextNodePosition( range.start ) && validateTextNodePosition( range.end );\r\n\t}\r\n\r\n\t/**\r\n\t * Performs post-fixer loops. Executes post-fixer callbacks as long as none of them has done any changes to the model.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_callPostFixers( writer ) {\r\n\t\tlet wasFixed = false;\r\n\r\n\t\tdo {\r\n\t\t\tfor ( const callback of this._postFixers ) {\r\n\t\t\t\twasFixed = callback( writer );\r\n\r\n\t\t\t\tif ( wasFixed ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} while ( wasFixed );\r\n\t}\r\n\r\n\t/**\r\n\t * Fired after each {@link module:engine/model/model~Model#enqueueChange `enqueueChange()` block} or the outermost\r\n\t * {@link module:engine/model/model~Model#change `change()` block} was executed and the document was changed\r\n\t * during that block's execution.\r\n\t *\r\n\t * The changes which this event will cover include:\r\n\t *\r\n\t * * document structure changes,\r\n\t * * selection changes,\r\n\t * * marker changes.\r\n\t *\r\n\t * If you want to be notified about all these changes, then simply listen to this event like this:\r\n\t *\r\n\t *\t\tmodel.document.on( 'change', () => {\r\n\t *\t\t\tconsole.log( 'The document has changed!' );\r\n\t *\t\t} );\r\n\t *\r\n\t * If, however, you only want to be notified about the data changes, then use the\r\n\t * {@link module:engine/model/document~Document#event:change:data change:data} event,\r\n\t * which is fired for document structure changes and marker changes (which affects the data).\r\n\t *\r\n\t *\t\tmodel.document.on( 'change:data', () => {\r\n\t *\t\t\tconsole.log( 'The data has changed!' );\r\n\t *\t\t} );\r\n\t *\r\n\t * @event change\r\n\t * @param {module:engine/model/batch~Batch} batch The batch that was used in the executed changes block.\r\n\t */\r\n\r\n\t/**\r\n\t * It is a narrower version of the {@link #event:change} event. It is fired for changes which\r\n\t * affect the editor data. This is:\r\n\t *\r\n\t * * document structure changes,\r\n\t * * marker changes (which affects the data).\r\n\t *\r\n\t * If you want to be notified about the data changes, then listen to this event:\r\n\t *\r\n\t *\t\tmodel.document.on( 'change:data', () => {\r\n\t *\t\t\tconsole.log( 'The data has changed!' );\r\n\t *\t\t} );\r\n\t *\r\n\t * If you would like to listen to all document changes, then check out the\r\n\t * {@link module:engine/model/document~Document#event:change change} event.\r\n\t *\r\n\t * @event change:data\r\n\t * @param {module:engine/model/batch~Batch} batch The batch that was used in the executed changes block.\r\n\t */\r\n}\r\n\r\nmix( Document, EmitterMixin );\r\n\r\n// Checks whether given range boundary position is valid for document selection, meaning that is not between\r\n// unicode surrogate pairs or base character and combining marks.\r\nfunction validateTextNodePosition( rangeBoundary ) {\r\n\tconst textNode = rangeBoundary.textNode;\r\n\r\n\tif ( textNode ) {\r\n\t\tconst data = textNode.data;\r\n\t\tconst offset = rangeBoundary.offset - textNode.startOffset;\r\n\r\n\t\treturn !isInsideSurrogatePair( data, offset ) && !isInsideCombinedSymbol( data, offset );\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/markercollection\r\n */\r\n\r\nimport LiveRange from './liverange';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * The collection of all {@link module:engine/model/markercollection~Marker markers} attached to the document.\r\n * It lets you {@link module:engine/model/markercollection~MarkerCollection#get get} markers or track them using\r\n * {@link module:engine/model/markercollection~MarkerCollection#event:update} event.\r\n *\r\n * To create, change or remove makers use {@link module:engine/model/writer~Writer model writers'} methods:\r\n * {@link module:engine/model/writer~Writer#addMarker} or {@link module:engine/model/writer~Writer#removeMarker}. Since\r\n * the writer is the only proper way to change the data model it is not possible to change markers directly using this\r\n * collection. All markers created by the writer will be automatically added to this collection.\r\n *\r\n * By default there is one marker collection available as {@link module:engine/model/model~Model#markers model property}.\r\n *\r\n * @see module:engine/model/markercollection~Marker\r\n */\r\nexport default class MarkerCollection {\r\n\t/**\r\n\t * Creates a markers collection.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Stores {@link ~Marker markers} added to the collection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} #_markers\r\n\t\t */\r\n\t\tthis._markers = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * Iterates over all {@link ~Marker markers} added to the collection.\r\n\t *\r\n\t * @returns {Iterable}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._markers.values();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if marker with given `markerName` is in the collection.\r\n\t *\r\n\t * @param {String} markerName Marker name.\r\n\t * @returns {Boolean} `true` if marker with given `markerName` is in the collection, `false` otherwise.\r\n\t */\r\n\thas( markerName ) {\r\n\t\treturn this._markers.has( markerName );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns {@link ~Marker marker} with given `markerName`.\r\n\t *\r\n\t * @param {String} markerName Name of marker to get.\r\n\t * @returns {module:engine/model/markercollection~Marker|null} Marker with given name or `null` if such marker was\r\n\t * not added to the collection.\r\n\t */\r\n\tget( markerName ) {\r\n\t\treturn this._markers.get( markerName ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and adds a {@link ~Marker marker} to the `MarkerCollection` with given name on given\r\n\t * {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t * If `MarkerCollection` already had a marker with given name (or {@link ~Marker marker} was passed), the marker in\r\n\t * collection is updated and {@link module:engine/model/markercollection~MarkerCollection#event:update} event is fired\r\n\t * but only if there was a change (marker range or {@link module:engine/model/markercollection~Marker#managedUsingOperations}\r\n\t * flag has changed.\r\n\t *\r\n\t * @protected\r\n\t * @fires module:engine/model/markercollection~MarkerCollection#event:update\r\n\t * @param {String|module:engine/model/markercollection~Marker} markerOrName Name of marker to set or marker instance to update.\r\n\t * @param {module:engine/model/range~Range} range Marker range.\r\n\t * @param {Boolean} [managedUsingOperations=false] Specifies whether the marker is managed using operations.\r\n\t * @param {Boolean} [affectsData=false] Specifies whether the marker affects the data produced by the data pipeline\r\n\t * (is persisted in the editor's data).\r\n\t * @returns {module:engine/model/markercollection~Marker} `Marker` instance which was added or updated.\r\n\t */\r\n\t_set( markerOrName, range, managedUsingOperations = false, affectsData = false ) {\r\n\t\tconst markerName = markerOrName instanceof Marker ? markerOrName.name : markerOrName;\r\n\t\tconst oldMarker = this._markers.get( markerName );\r\n\r\n\t\tif ( oldMarker ) {\r\n\t\t\tconst oldRange = oldMarker.getRange();\r\n\t\t\tlet hasChanged = false;\r\n\r\n\t\t\tif ( !oldRange.isEqual( range ) ) {\r\n\t\t\t\toldMarker._attachLiveRange( LiveRange.fromRange( range ) );\r\n\t\t\t\thasChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( managedUsingOperations != oldMarker.managedUsingOperations ) {\r\n\t\t\t\toldMarker._managedUsingOperations = managedUsingOperations;\r\n\t\t\t\thasChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof affectsData === 'boolean' && affectsData != oldMarker.affectsData ) {\r\n\t\t\t\toldMarker._affectsData = affectsData;\r\n\t\t\t\thasChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasChanged ) {\r\n\t\t\t\tthis.fire( 'update:' + markerName, oldMarker, oldRange, range );\r\n\t\t\t}\r\n\r\n\t\t\treturn oldMarker;\r\n\t\t}\r\n\r\n\t\tconst liveRange = LiveRange.fromRange( range );\r\n\t\tconst marker = new Marker( markerName, liveRange, managedUsingOperations, affectsData );\r\n\r\n\t\tthis._markers.set( markerName, marker );\r\n\t\tthis.fire( 'update:' + markerName, marker, null, range );\r\n\r\n\t\treturn marker;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes given {@link ~Marker marker} or a marker with given name from the `MarkerCollection`.\r\n\t *\r\n\t * @protected\r\n\t * @fires module:engine/model/markercollection~MarkerCollection#event:update\r\n\t * @param {String} markerOrName Marker or name of a marker to remove.\r\n\t * @returns {Boolean} `true` if marker was found and removed, `false` otherwise.\r\n\t */\r\n\t_remove( markerOrName ) {\r\n\t\tconst markerName = markerOrName instanceof Marker ? markerOrName.name : markerOrName;\r\n\t\tconst oldMarker = this._markers.get( markerName );\r\n\r\n\t\tif ( oldMarker ) {\r\n\t\t\tthis._markers.delete( markerName );\r\n\t\t\tthis.fire( 'update:' + markerName, oldMarker, oldMarker.getRange(), null );\r\n\r\n\t\t\tthis._destroyMarker( oldMarker );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over all markers, which ranges contain given {@link module:engine/model/position~Position position}.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position\r\n\t * @returns {Iterable.<module:engine/model/markercollection~Marker>}\r\n\t */\r\n\t* getMarkersAtPosition( position ) {\r\n\t\tfor ( const marker of this ) {\r\n\t\t\tif ( marker.getRange().containsPosition( position ) ) {\r\n\t\t\t\tyield marker;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns iterator that iterates over all markers, which intersects with given {@link module:engine/model/range~Range range}.\r\n\t *\r\n\t * @param {module:engine/model/range~Range} range\r\n\t * @returns {Iterable.<module:engine/model/markercollection~Marker>}\r\n\t */\r\n\t* getMarkersIntersectingRange( range ) {\r\n\t\tfor ( const marker of this ) {\r\n\t\t\tif ( marker.getRange().getIntersection( range ) !== null ) {\r\n\t\t\t\tyield marker;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys marker collection and all markers inside it.\r\n\t */\r\n\tdestroy() {\r\n\t\tfor ( const marker of this._markers.values() ) {\r\n\t\t\tthis._destroyMarker( marker );\r\n\t\t}\r\n\r\n\t\tthis._markers = null;\r\n\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterates over all markers that starts with given `prefix`.\r\n\t *\r\n\t *\t\tconst markerFooA = markersCollection.set( 'foo:a', rangeFooA );\r\n\t *\t\tconst markerFooB = markersCollection.set( 'foo:b', rangeFooB );\r\n\t *\t\tconst markerBarA = markersCollection.set( 'bar:a', rangeBarA );\r\n\t *\t\tconst markerFooBarA = markersCollection.set( 'foobar:a', rangeFooBarA );\r\n\t *\t\tArray.from( markersCollection.getMarkersGroup( 'foo' ) ); // [ markerFooA, markerFooB ]\r\n\t *\t\tArray.from( markersCollection.getMarkersGroup( 'a' ) ); // []\r\n\t *\r\n\t * @param prefix\r\n\t * @returns {Iterable.<module:engine/model/markercollection~Marker>}\r\n\t */\r\n\t* getMarkersGroup( prefix ) {\r\n\t\tfor ( const marker of this._markers.values() ) {\r\n\t\t\tif ( marker.name.startsWith( prefix + ':' ) ) {\r\n\t\t\t\tyield marker;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the marker.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/markercollection~Marker} marker Marker to destroy.\r\n\t */\r\n\t_destroyMarker( marker ) {\r\n\t\tmarker.stopListening();\r\n\t\tmarker._detachLiveRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Fired whenever marker is added, updated or removed from `MarkerCollection`.\r\n\t *\r\n\t * @event update\r\n\t * @param {module:engine/model/markercollection~Marker} Updated Marker.\r\n\t * @param {module:engine/model/range~Range|null} oldRange Marker range before the update. When is not defined it\r\n\t * means that marker is just added.\r\n\t * @param {module:engine/model/range~Range|null} newRange Marker range after update. When is not defined it\r\n\t * means that marker is just removed.\r\n\t */\r\n}\r\n\r\nmix( MarkerCollection, EmitterMixin );\r\n\r\n/**\r\n * `Marker` is a continuous parts of model (like a range), is named and represent some kind of information about marked\r\n * part of model document. In contrary to {@link module:engine/model/node~Node nodes}, which are building blocks of\r\n * model document tree, markers are not stored directly in document tree but in\r\n * {@link module:engine/model/model~Model#markers model markers' collection}. Still, they are document data, by giving\r\n * additional meaning to the part of a model document between marker start and marker end.\r\n *\r\n * In this sense, markers are similar to adding and converting attributes on nodes. The difference is that attribute is\r\n * connected with a given node (e.g. a character is bold no matter if it gets moved or content around it changes).\r\n * Markers on the other hand are continuous ranges and are characterized by their start and end position. This means that\r\n * any character in the marker is marked by the marker. For example, if a character is moved outside of marker it stops being\r\n * \"special\" and the marker is shrunk. Similarly, when a character is moved into the marker from other place in document\r\n * model, it starts being \"special\" and the marker is enlarged.\r\n *\r\n * Another upside of markers is that finding marked part of document is fast and easy. Using attributes to mark some nodes\r\n * and then trying to find that part of document would require traversing whole document tree. Marker gives instant access\r\n * to the range which it is marking at the moment.\r\n *\r\n * Markers are built from a name and a range.\r\n *\r\n * Range of the marker is updated automatically when document changes, using\r\n * {@link module:engine/model/liverange~LiveRange live range} mechanism.\r\n *\r\n * Name is used to group and identify markers. Names have to be unique, but markers can be grouped by\r\n * using common prefixes, separated with `:`, for example: `user:john` or `search:3`. That's useful in term of creating\r\n * namespaces for custom elements (e.g. comments, highlights). You can use this prefixes in\r\n * {@link module:engine/model/markercollection~MarkerCollection#event:update} listeners to listen on changes in a group of markers.\r\n * For instance: `model.markers.on( 'set:user', callback );` will be called whenever any `user:*` markers changes.\r\n *\r\n * There are two types of markers.\r\n *\r\n * 1. Markers managed directly, without using operations. They are added directly by {@link module:engine/model/writer~Writer}\r\n * to the {@link module:engine/model/markercollection~MarkerCollection} without any additional mechanism. They can be used\r\n * as bookmarks or visual markers. They are great for showing results of the find, or select link when the focus is in the input.\r\n *\r\n * 1. Markers managed using operations. These markers are also stored in {@link module:engine/model/markercollection~MarkerCollection}\r\n * but changes in these markers is managed the same way all other changes in the model structure - using operations.\r\n * Therefore, they are handled in the undo stack and synchronized between clients if the collaboration plugin is enabled.\r\n * This type of markers is useful for solutions like spell checking or comments.\r\n *\r\n * Both type of them should be added / updated by {@link module:engine/model/writer~Writer#addMarker}\r\n * and removed by {@link module:engine/model/writer~Writer#removeMarker} methods.\r\n *\r\n *\t\tmodel.change( ( writer ) => {\r\n * \t\t\tconst marker = writer.addMarker( name, { range, usingOperation: true } );\r\n *\r\n * \t\t\t// ...\r\n *\r\n * \t\t\twriter.removeMarker( marker );\r\n *\t\t} );\r\n *\r\n * See {@link module:engine/model/writer~Writer} to find more examples.\r\n *\r\n * Since markers need to track change in the document, for efficiency reasons, it is best to create and keep as little\r\n * markers as possible and remove them as soon as they are not needed anymore.\r\n *\r\n * Markers can be downcasted and upcasted.\r\n *\r\n * Markers downcast happens on {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:addMarker} and\r\n * {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:removeMarker} events.\r\n * Use {@link module:engine/conversion/downcast-converters downcast converters} or attach a custom converter to mentioned events.\r\n * For {@link module:engine/controller/datacontroller~DataController data pipeline}, marker should be downcasted to an element.\r\n * Then, it can be upcasted back to a marker. Again, use {@link module:engine/conversion/upcast-converters upcast converters} or\r\n * attach a custom converter to {@link module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element}.\r\n *\r\n * Another upside of markers is that finding marked part of document is fast and easy. Using attributes to mark some nodes\r\n * and then trying to find that part of document would require traversing whole document tree. Marker gives instant access\r\n * to the range which it is marking at the moment.\r\n *\r\n * `Marker` instances are created and destroyed only by {@link ~MarkerCollection MarkerCollection}.\r\n */\r\nclass Marker {\r\n\t/**\r\n\t * Creates a marker instance.\r\n\t *\r\n\t * @param {String} name Marker name.\r\n\t * @param {module:engine/model/liverange~LiveRange} liveRange Range marked by the marker.\r\n\t * @param {Boolean} managedUsingOperations Specifies whether the marker is managed using operations.\r\n\t * @param {Boolean} affectsData Specifies whether the marker affects the data produced by the data pipeline\r\n\t * (is persisted in the editor's data).\r\n\t */\r\n\tconstructor( name, liveRange, managedUsingOperations, affectsData ) {\r\n\t\t/**\r\n\t\t * Marker's name.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis.name = name;\r\n\r\n\t\t/**\r\n\t\t * Range marked by the marker.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:engine/model/liverange~LiveRange}\r\n\t\t */\r\n\t\tthis._liveRange = this._attachLiveRange( liveRange );\r\n\r\n\t\t/**\r\n\t\t * Flag indicates if the marker is managed using operations or not.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._managedUsingOperations = managedUsingOperations;\r\n\r\n\t\t/**\r\n\t\t * Specifies whether the marker affects the data produced by the data pipeline\r\n\t\t * (is persisted in the editor's data).\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._affectsData = affectsData;\r\n\t}\r\n\r\n\t/**\r\n\t * A value indicating if the marker is managed using operations.\r\n\t * See {@link ~Marker marker class description} to learn more about marker types.\r\n\t * See {@link module:engine/model/writer~Writer#addMarker}.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t */\r\n\tget managedUsingOperations() {\r\n\t\tif ( !this._liveRange ) {\r\n\t\t\tthrow new CKEditorError( 'marker-destroyed: Cannot use a destroyed marker instance.' );\r\n\t\t}\r\n\r\n\t\treturn this._managedUsingOperations;\r\n\t}\r\n\r\n\t/**\r\n\t * A value indicating if the marker changes the data.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t */\r\n\tget affectsData() {\r\n\t\tif ( !this._liveRange ) {\r\n\t\t\tthrow new CKEditorError( 'marker-destroyed: Cannot use a destroyed marker instance.' );\r\n\t\t}\r\n\r\n\t\treturn this._affectsData;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current marker start position.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tgetStart() {\r\n\t\tif ( !this._liveRange ) {\r\n\t\t\tthrow new CKEditorError( 'marker-destroyed: Cannot use a destroyed marker instance.' );\r\n\t\t}\r\n\r\n\t\treturn this._liveRange.start.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current marker end position.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tgetEnd() {\r\n\t\tif ( !this._liveRange ) {\r\n\t\t\tthrow new CKEditorError( 'marker-destroyed: Cannot use a destroyed marker instance.' );\r\n\t\t}\r\n\r\n\t\treturn this._liveRange.end.clone();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a range that represents the current state of the marker.\r\n\t *\r\n\t * Keep in mind that returned value is a {@link module:engine/model/range~Range Range}, not a\r\n\t * {@link module:engine/model/liverange~LiveRange LiveRange}. This means that it is up-to-date and relevant only\r\n\t * until next model document change. Do not store values returned by this method. Instead, store {@link ~Marker#name}\r\n\t * and get `Marker` instance from {@link module:engine/model/markercollection~MarkerCollection MarkerCollection} every\r\n\t * time there is a need to read marker properties. This will guarantee that the marker has not been removed and\r\n\t * that it's data is up-to-date.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tgetRange() {\r\n\t\tif ( !this._liveRange ) {\r\n\t\t\tthrow new CKEditorError( 'marker-destroyed: Cannot use a destroyed marker instance.' );\r\n\t\t}\r\n\r\n\t\treturn this._liveRange.toRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Binds new live range to the marker and detach the old one if is attached.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/liverange~LiveRange} liveRange Live range to attach\r\n\t * @returns {module:engine/model/liverange~LiveRange} Attached live range.\r\n\t */\r\n\t_attachLiveRange( liveRange ) {\r\n\t\tif ( this._liveRange ) {\r\n\t\t\tthis._detachLiveRange();\r\n\t\t}\r\n\r\n\t\t// Delegating does not work with namespaces. Alternatively, we could delegate all events (using `*`).\r\n\t\tliveRange.delegate( 'change:range' ).to( this );\r\n\t\tliveRange.delegate( 'change:content' ).to( this );\r\n\r\n\t\tthis._liveRange = liveRange;\r\n\r\n\t\treturn liveRange;\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds and destroys currently attached live range.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_detachLiveRange() {\r\n\t\tthis._liveRange.stopDelegating( 'change:range', this );\r\n\t\tthis._liveRange.stopDelegating( 'change:content', this );\r\n\t\tthis._liveRange.detach();\r\n\t\tthis._liveRange = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Fired whenever {@link ~Marker#_liveRange marker range} is changed due to changes on {@link module:engine/model/document~Document}.\r\n\t * This is a delegated {@link module:engine/model/liverange~LiveRange#event:change:range LiveRange change:range event}.\r\n\t *\r\n\t * When marker is removed from {@link module:engine/model/markercollection~MarkerCollection MarkerCollection},\r\n\t * all event listeners listening to it should be removed. It is best to do it on\r\n\t * {@link module:engine/model/markercollection~MarkerCollection#event:update MarkerCollection update event}.\r\n\t *\r\n\t * @see module:engine/model/liverange~LiveRange#event:change:range\r\n\t * @event change:range\r\n\t * @param {module:engine/model/range~Range} oldRange\r\n\t * @param {Object} data\r\n\t */\r\n\r\n\t/**\r\n\t * Fired whenever change on {@link module:engine/model/document~Document} is done inside {@link ~Marker#_liveRange marker range}.\r\n\t * This is a delegated {@link module:engine/model/liverange~LiveRange#event:change:content LiveRange change:content event}.\r\n\t *\r\n\t * When marker is removed from {@link module:engine/model/markercollection~MarkerCollection MarkerCollection},\r\n\t * all event listeners listening to it should be removed. It is best to do it on\r\n\t * {@link module:engine/model/markercollection~MarkerCollection#event:update MarkerCollection update event}.\r\n\t *\r\n\t * @see module:engine/model/liverange~LiveRange#event:change:content\r\n\t * @event change:content\r\n\t * @param {module:engine/model/range~Range} oldRange\r\n\t * @param {Object} data\r\n\t */\r\n}\r\n\r\nmix( Marker, EmitterMixin );\r\n\r\n/**\r\n * Cannot use a {@link module:engine/model/markercollection~MarkerCollection#destroy destroyed marker} instance.\r\n *\r\n * @error marker-destroyed\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/liveposition\r\n */\r\n\r\nimport Position from './position';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * `LivePosition` is a type of {@link module:engine/model/position~Position Position}\r\n * that updates itself as {@link module:engine/model/document~Document document}\r\n * is changed through operations. It may be used as a bookmark.\r\n *\r\n * **Note:** Contrary to {@link module:engine/model/position~Position}, `LivePosition` works only in roots that are\r\n * {@link module:engine/model/rootelement~RootElement}.\r\n * If {@link module:engine/model/documentfragment~DocumentFragment} is passed, error will be thrown.\r\n *\r\n * **Note:** Be very careful when dealing with `LivePosition`. Each `LivePosition` instance bind events that might\r\n * have to be unbound.\r\n * Use {@link module:engine/model/liveposition~LivePosition#detach} whenever you don't need `LivePosition` anymore.\r\n *\r\n * @extends module:engine/model/position~Position\r\n */\r\nexport default class LivePosition extends Position {\r\n\t/**\r\n\t * Creates a live position.\r\n\t *\r\n\t * @see module:engine/model/position~Position\r\n\t * @param {module:engine/model/rootelement~RootElement} root\r\n\t * @param {Array.<Number>} path\r\n\t * @param {module:engine/model/position~PositionStickiness} [stickiness]\r\n\t */\r\n\tconstructor( root, path, stickiness = 'toNone' ) {\r\n\t\tsuper( root, path, stickiness );\r\n\r\n\t\tif ( !this.root.is( 'rootElement' ) ) {\r\n\t\t\t/**\r\n\t\t\t * LivePosition's root has to be an instance of RootElement.\r\n\t\t\t *\r\n\t\t\t * @error liveposition-root-not-rootelement\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'model-liveposition-root-not-rootelement: LivePosition\\'s root has to be an instance of RootElement.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tbindWithDocument.call( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Unbinds all events previously bound by `LivePosition`. Use it whenever you don't need `LivePosition` instance\r\n\t * anymore (i.e. when leaving scope in which it was declared or before re-assigning variable that was\r\n\t * referring to it).\r\n\t */\r\n\tdetach() {\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/model/position~Position position instance}, which is equal to this live position.\r\n\t *\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\ttoPosition() {\r\n\t\treturn new Position( this.root, this.path.slice(), this.stickiness );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `LivePosition` instance that is equal to position.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position\r\n\t * @param {module:engine/model/position~PositionStickiness} [stickiness]\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tstatic fromPosition( position, stickiness ) {\r\n\t\treturn new this( position.root, position.path.slice(), stickiness ? stickiness : position.stickiness );\r\n\t}\r\n\r\n\t/**\r\n\t * @static\r\n\t * @protected\r\n\t * @method module:engine/model/liveposition~LivePosition._createAfter\r\n\t * @see module:engine/model/position~Position._createAfter\r\n\t * @param {module:engine/model/node~Node} node\r\n\t * @returns {module:engine/model/liveposition~LivePosition}\r\n\t */\r\n\r\n\t/**\r\n\t * @static\r\n\t * @protected\r\n\t * @method module:engine/model/liveposition~LivePosition._createBefore\r\n\t * @see module:engine/model/position~Position._createBefore\r\n\t * @param {module:engine/model/node~Node} node\r\n\t * @returns {module:engine/model/liveposition~LivePosition}\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `LivePosition` instance is changed due to changes on {@link module:engine/model/document~Document}.\r\n\t *\r\n\t * @event module:engine/model/liveposition~LivePosition#change\r\n\t * @param {module:engine/model/position~Position} oldPosition Position equal to this live position before it got changed.\r\n\t */\r\n}\r\n\r\n// Binds this `LivePosition` to the {@link module:engine/model/document~Document document} that owns\r\n// this position's {@link module:engine/model/position~Position#root root}.\r\n//\r\n// @private\r\nfunction bindWithDocument() {\r\n\tthis.listenTo(\r\n\t\tthis.root.document.model,\r\n\t\t'applyOperation',\r\n\t\t( event, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\tif ( !operation.isDocumentOperation ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttransform.call( this, operation );\r\n\t\t},\r\n\t\t{ priority: 'low' }\r\n\t);\r\n}\r\n\r\n// Updates this position accordingly to the updates applied to the model. Bases on change events.\r\n//\r\n// @private\r\n// @param {module:engine/model/operation/operation~Operation} operation Executed operation.\r\nfunction transform( operation ) {\r\n\tconst result = this.getTransformedByOperation( operation );\r\n\r\n\tif ( !this.isEqual( result ) ) {\r\n\t\tconst oldPosition = this.toPosition();\r\n\r\n\t\tthis.path = result.path;\r\n\t\tthis.root = result.root;\r\n\r\n\t\tthis.fire( 'change', oldPosition );\r\n\t}\r\n}\r\n\r\nmix( LivePosition, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/utils/insertcontent\r\n */\r\n\r\nimport Position from '../position';\r\nimport LivePosition from '../liveposition';\r\nimport Element from '../element';\r\nimport Range from '../range';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport DocumentSelection from '../documentselection';\r\nimport Selection from '../selection';\r\n\r\n/**\r\n * Inserts content into the editor (specified selection) as one would expect the paste\r\n * functionality to work.\r\n *\r\n * If an instance of {@link module:engine/model/selection~Selection} is passed as `selectable` it will be modified\r\n * to the insertion selection (equal to a range to be selected after insertion).\r\n *\r\n * **Note:** Use {@link module:engine/model/model~Model#insertContent} instead of this function.\r\n * This function is only exposed to be reusable in algorithms which change the {@link module:engine/model/model~Model#insertContent}\r\n * method's behavior.\r\n *\r\n * @param {module:engine/model/model~Model} model The model in context of which the insertion\r\n * should be performed.\r\n * @param {module:engine/model/documentfragment~DocumentFragment|module:engine/model/item~Item} content The content to insert.\r\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n * module:engine/model/position~Position|module:engine/model/element~Element|\r\n * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} [selectable=model.document.selection]\r\n * Selection into which the content should be inserted.\r\n * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n */\r\nexport default function insertContent( model, content, selectable, placeOrOffset ) {\r\n\tmodel.change( writer => {\r\n\t\tlet selection;\r\n\r\n\t\tif ( !selectable ) {\r\n\t\t\tselection = model.document.selection;\r\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\r\n\t\t\tselection = selectable;\r\n\t\t} else {\r\n\t\t\tselection = writer.createSelection( selectable, placeOrOffset );\r\n\t\t}\r\n\r\n\t\tif ( !selection.isCollapsed ) {\r\n\t\t\tmodel.deleteContent( selection );\r\n\t\t}\r\n\r\n\t\tconst insertion = new Insertion( model, writer, selection.anchor );\r\n\r\n\t\tlet nodesToInsert;\r\n\r\n\t\tif ( content.is( 'documentFragment' ) ) {\r\n\t\t\tnodesToInsert = content.getChildren();\r\n\t\t} else {\r\n\t\t\tnodesToInsert = [ content ];\r\n\t\t}\r\n\r\n\t\tinsertion.handleNodes( nodesToInsert, {\r\n\t\t\t// The set of children being inserted is the only set in this context\r\n\t\t\t// so it's the first and last (it's a hack ;)).\r\n\t\t\tisFirst: true,\r\n\t\t\tisLast: true\r\n\t\t} );\r\n\r\n\t\tconst newRange = insertion.getSelectionRange();\r\n\r\n\t\t/* istanbul ignore else */\r\n\t\tif ( newRange ) {\r\n\t\t\tif ( selection instanceof DocumentSelection ) {\r\n\t\t\t\twriter.setSelection( newRange );\r\n\t\t\t} else {\r\n\t\t\t\tselection.setTo( newRange );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// We are not testing else because it's a safe check for unpredictable edge cases:\r\n\t\t\t// an insertion without proper range to select.\r\n\r\n\t\t\t/**\r\n\t\t\t * Cannot determine a proper selection range after insertion.\r\n\t\t\t *\r\n\t\t\t * @warning insertcontent-no-range\r\n\t\t\t */\r\n\t\t\tlog.warn( 'insertcontent-no-range: Cannot determine a proper selection range after insertion.' );\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Utility class for performing content insertion.\r\n *\r\n * @private\r\n */\r\nclass Insertion {\r\n\tconstructor( model, writer, position ) {\r\n\t\t/**\r\n\t\t * The model in context of which the insertion should be performed.\r\n\t\t *\r\n\t\t * @member {module:engine/model~Model} #model\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * Batch to which operations will be added.\r\n\t\t *\r\n\t\t * @member {module:engine/controller/writer~Batch} #writer\r\n\t\t */\r\n\t\tthis.writer = writer;\r\n\r\n\t\t/**\r\n\t\t * The position at which (or near which) the next node will be inserted.\r\n\t\t *\r\n\t\t * @member {module:engine/model/position~Position} #position\r\n\t\t */\r\n\t\tthis.position = position;\r\n\r\n\t\t/**\r\n\t\t * Elements with which the inserted elements can be merged.\r\n\t\t *\r\n\t\t *\t\t<p>x^</p><p>y</p> + <p>z</p> (can merge to <p>x</p>)\r\n\t\t *\t\t<p>x</p><p>^y</p> + <p>z</p> (can merge to <p>y</p>)\r\n\t\t *\t\t<p>x^y</p> + <p>z</p> (can merge to <p>xy</p> which will be split during the action,\r\n\t\t *\t\t\t\t\t\t\t\tso both its pieces will be added to this set)\r\n\t\t *\r\n\t\t *\r\n\t\t * @member {Set} #canMergeWith\r\n\t\t */\r\n\t\tthis.canMergeWith = new Set( [ this.position.parent ] );\r\n\r\n\t\t/**\r\n\t\t * Schema of the model.\r\n\t\t *\r\n\t\t * @member {module:engine/model/schema~Schema} #schema\r\n\t\t */\r\n\t\tthis.schema = model.schema;\r\n\r\n\t\tthis._filterAttributesOf = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Handles insertion of a set of nodes.\r\n\t *\r\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes to insert.\r\n\t * @param {Object} parentContext Context in which parent of these nodes was supposed to be inserted.\r\n\t * If the parent context is passed it means that the parent element was stripped (was not allowed).\r\n\t */\r\n\thandleNodes( nodes, parentContext ) {\r\n\t\tnodes = Array.from( nodes );\r\n\r\n\t\tfor ( let i = 0; i < nodes.length; i++ ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\r\n\t\t\tthis._handleNode( node, {\r\n\t\t\t\tisFirst: i === 0 && parentContext.isFirst,\r\n\t\t\t\tisLast: ( i === ( nodes.length - 1 ) ) && parentContext.isLast\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\t// TMP this will become a post-fixer.\r\n\t\tthis.schema.removeDisallowedAttributes( this._filterAttributesOf, this.writer );\r\n\t\tthis._filterAttributesOf = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns range to be selected after insertion.\r\n\t * Returns null if there is no valid range to select after insertion.\r\n\t *\r\n\t * @returns {module:engine/model/range~Range|null}\r\n\t */\r\n\tgetSelectionRange() {\r\n\t\tif ( this.nodeToSelect ) {\r\n\t\t\treturn Range._createOn( this.nodeToSelect );\r\n\t\t}\r\n\r\n\t\treturn this.model.schema.getNearestSelectionRange( this.position );\r\n\t}\r\n\r\n\t/**\r\n\t * Handles insertion of a single node.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node\r\n\t * @param {Object} context\r\n\t * @param {Boolean} context.isFirst Whether the given node is the first one in the content to be inserted.\r\n\t * @param {Boolean} context.isLast Whether the given node is the last one in the content to be inserted.\r\n\t */\r\n\t_handleNode( node, context ) {\r\n\t\t// Let's handle object in a special way.\r\n\t\t// * They should never be merged with other elements.\r\n\t\t// * If they are not allowed in any of the selection ancestors, they could be either autoparagraphed or totally removed.\r\n\t\tif ( this.schema.isObject( node ) ) {\r\n\t\t\tthis._handleObject( node, context );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Try to find a place for the given node.\r\n\t\t// Split the position.parent's branch up to a point where the node can be inserted.\r\n\t\t// If it isn't allowed in the whole branch, then of course don't split anything.\r\n\t\tconst isAllowed = this._checkAndSplitToAllowedPosition( node, context );\r\n\r\n\t\tif ( !isAllowed ) {\r\n\t\t\tthis._handleDisallowedNode( node, context );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._insert( node );\r\n\r\n\t\t// After the node was inserted we may try to merge it with its siblings.\r\n\t\t// This should happen only if it was the first and/or last of the nodes (so only with boundary nodes)\r\n\t\t// and only if the selection was in those elements initially.\r\n\t\t//\r\n\t\t// E.g.:\r\n\t\t// <p>x^</p> + <p>y</p> => <p>x</p><p>y</p> => <p>xy[]</p>\r\n\t\t// and:\r\n\t\t// <p>x^y</p> + <p>z</p> => <p>x</p>^<p>y</p> + <p>z</p> => <p>x</p><p>y</p><p>z</p> => <p>xy[]z</p>\r\n\t\t// but:\r\n\t\t// <p>x</p><p>^</p><p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging)\r\n\t\t// <p>x</p>[<img>]<p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging, note: after running deletetContents\r\n\t\t//\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t it's exactly the same case as above)\r\n\t\tthis._mergeSiblingsOf( node, context );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} node The object element.\r\n\t * @param {Object} context\r\n\t */\r\n\t_handleObject( node, context ) {\r\n\t\t// Try finding it a place in the tree.\r\n\t\tif ( this._checkAndSplitToAllowedPosition( node ) ) {\r\n\t\t\tthis._insert( node );\r\n\t\t}\r\n\t\t// Try autoparagraphing.\r\n\t\telse {\r\n\t\t\tthis._tryAutoparagraphing( node, context );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The disallowed node which needs to be handled.\r\n\t * @param {Object} context\r\n\t */\r\n\t_handleDisallowedNode( node, context ) {\r\n\t\t// If the node is an element, try inserting its children (strip the parent).\r\n\t\tif ( node.is( 'element' ) ) {\r\n\t\t\tthis.handleNodes( node.getChildren(), context );\r\n\t\t}\r\n\t\t// If text is not allowed, try autoparagraphing it.\r\n\t\telse {\r\n\t\t\tthis._tryAutoparagraphing( node, context );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node to insert.\r\n\t */\r\n\t_insert( node ) {\r\n\t\t/* istanbul ignore if */\r\n\t\tif ( !this.schema.checkChild( this.position, node ) ) {\r\n\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\r\n\t\t\t// Note that it would often be a silent issue if we insert node in a place where it's not allowed.\r\n\t\t\tlog.error(\r\n\t\t\t\t'insertcontent-wrong-position: The node cannot be inserted on the given position.',\r\n\t\t\t\t{ node, position: this.position }\r\n\t\t\t);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst livePos = LivePosition.fromPosition( this.position, 'toNext' );\r\n\r\n\t\tthis.writer.insert( node, this.position );\r\n\r\n\t\tthis.position = livePos.toPosition();\r\n\t\tlivePos.detach();\r\n\r\n\t\t// The last inserted object should be selected because we can't put a collapsed selection after it.\r\n\t\tif ( this.schema.isObject( node ) && !this.schema.checkChild( this.position, '$text' ) ) {\r\n\t\t\tthis.nodeToSelect = node;\r\n\t\t} else {\r\n\t\t\tthis.nodeToSelect = null;\r\n\t\t}\r\n\r\n\t\tthis._filterAttributesOf.push( node );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\r\n\t * @param {Object} context\r\n\t */\r\n\t_mergeSiblingsOf( node, context ) {\r\n\t\tif ( !( node instanceof Element ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst mergeLeft = this._canMergeLeft( node, context );\r\n\t\tconst mergeRight = this._canMergeRight( node, context );\r\n\t\tconst mergePosLeft = LivePosition._createBefore( node );\r\n\t\tmergePosLeft.stickiness = 'toNext';\r\n\t\tconst mergePosRight = LivePosition._createAfter( node );\r\n\t\tmergePosRight.stickiness = 'toNext';\r\n\r\n\t\tif ( mergeLeft ) {\r\n\t\t\tconst livePosition = LivePosition.fromPosition( this.position );\r\n\t\t\tlivePosition.stickiness = 'toNext';\r\n\r\n\t\t\tthis.writer.merge( mergePosLeft );\r\n\r\n\t\t\tthis.position = livePosition.toPosition();\r\n\t\t\tlivePosition.detach();\r\n\t\t}\r\n\r\n\t\tif ( mergeRight ) {\r\n\t\t\t/* istanbul ignore if */\r\n\t\t\tif ( !this.position.isEqual( mergePosRight ) ) {\r\n\t\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\r\n\t\t\t\t// At this point the insertion position should be after the node we'll merge. If it isn't,\r\n\t\t\t\t// it should need to be secured as in the left merge case.\r\n\t\t\t\tlog.error( 'insertcontent-wrong-position-on-merge: The insertion position should equal the merge position' );\r\n\t\t\t}\r\n\r\n\t\t\t// Move the position to the previous node, so it isn't moved to the graveyard on merge.\r\n\t\t\t// <p>x</p>[]<p>y</p> => <p>x[]</p><p>y</p>\r\n\t\t\tthis.position = Position._createAt( mergePosRight.nodeBefore, 'end' );\r\n\r\n\t\t\t// OK:  <p>xx[]</p> + <p>yy</p> => <p>xx[]yy</p> (when sticks to previous)\r\n\t\t\t// NOK: <p>xx[]</p> + <p>yy</p> => <p>xxyy[]</p> (when sticks to next)\r\n\t\t\tconst livePosition = new LivePosition( this.position.root, this.position.path, 'toPrevious' );\r\n\r\n\t\t\tthis.writer.merge( mergePosRight );\r\n\r\n\t\t\tthis.position = livePosition.toPosition();\r\n\t\t\tlivePosition.detach();\r\n\t\t}\r\n\r\n\t\tif ( mergeLeft || mergeRight ) {\r\n\t\t\t// After merge elements that were marked by _insert() to be filtered might be gone so\r\n\t\t\t// we need to mark the new container.\r\n\t\t\tthis._filterAttributesOf.push( this.position.parent );\r\n\t\t}\r\n\r\n\t\tmergePosLeft.detach();\r\n\t\tmergePosRight.detach();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether specified node can be merged with previous sibling element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\r\n\t * @param {Object} context\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_canMergeLeft( node, context ) {\r\n\t\tconst previousSibling = node.previousSibling;\r\n\r\n\t\treturn context.isFirst &&\r\n\t\t\t( previousSibling instanceof Element ) &&\r\n\t\t\tthis.canMergeWith.has( previousSibling ) &&\r\n\t\t\tthis.model.schema.checkMerge( previousSibling, node );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether specified node can be merged with next sibling element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\r\n\t * @param {Object} context\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_canMergeRight( node, context ) {\r\n\t\tconst nextSibling = node.nextSibling;\r\n\r\n\t\treturn context.isLast &&\r\n\t\t\t( nextSibling instanceof Element ) &&\r\n\t\t\tthis.canMergeWith.has( nextSibling ) &&\r\n\t\t\tthis.model.schema.checkMerge( node, nextSibling );\r\n\t}\r\n\r\n\t/**\r\n\t * Tries wrapping the node in a new paragraph and inserting it this way.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node which needs to be autoparagraphed.\r\n\t * @param {Object} context\r\n\t */\r\n\t_tryAutoparagraphing( node, context ) {\r\n\t\tconst paragraph = this.writer.createElement( 'paragraph' );\r\n\r\n\t\t// Do not autoparagraph if the paragraph won't be allowed there,\r\n\t\t// cause that would lead to an infinite loop. The paragraph would be rejected in\r\n\t\t// the next _handleNode() call and we'd be here again.\r\n\t\tif ( this._getAllowedIn( paragraph, this.position.parent ) && this.schema.checkChild( paragraph, node ) ) {\r\n\t\t\tparagraph._appendChild( node );\r\n\t\t\tthis._handleNode( paragraph, context );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node\r\n\t * @returns {Boolean} Whether an allowed position was found.\r\n\t * `false` is returned if the node isn't allowed at any position up in the tree, `true` if was.\r\n\t */\r\n\t_checkAndSplitToAllowedPosition( node ) {\r\n\t\tconst allowedIn = this._getAllowedIn( node, this.position.parent );\r\n\r\n\t\tif ( !allowedIn ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\twhile ( allowedIn != this.position.parent ) {\r\n\t\t\t// If a parent which we'd need to leave is a limit element, break.\r\n\t\t\tif ( this.schema.isLimit( this.position.parent ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.position.isAtStart ) {\r\n\t\t\t\tconst parent = this.position.parent;\r\n\t\t\t\tthis.position = this.writer.createPositionBefore( parent );\r\n\r\n\t\t\t\t// Special case – parent is empty (<p>^</p>) so isAtStart == isAtEnd == true.\r\n\t\t\t\t// We can remove the element after moving selection out of it.\r\n\t\t\t\tif ( parent.isEmpty ) {\r\n\t\t\t\t\tthis.writer.remove( parent );\r\n\t\t\t\t}\r\n\t\t\t} else if ( this.position.isAtEnd ) {\r\n\t\t\t\tthis.position = this.writer.createPositionAfter( this.position.parent );\r\n\t\t\t} else {\r\n\t\t\t\tconst tempPos = this.writer.createPositionAfter( this.position.parent );\r\n\r\n\t\t\t\tthis.writer.split( this.position );\r\n\r\n\t\t\t\tthis.position = tempPos;\r\n\r\n\t\t\t\tthis.canMergeWith.add( this.position.nodeAfter );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the element in which the given node is allowed. It checks the passed element and all its ancestors.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/node~Node} node The node to check.\r\n\t * @param {module:engine/model/element~Element} element The element in which the node's correctness should be checked.\r\n\t * @returns {module:engine/model/element~Element|null}\r\n\t */\r\n\t_getAllowedIn( node, element ) {\r\n\t\tif ( this.schema.checkChild( element, node ) ) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\r\n\t\tif ( element.parent ) {\r\n\t\t\treturn this._getAllowedIn( node, element.parent );\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/utils/deletecontent\r\n */\r\n\r\nimport LivePosition from '../liveposition';\r\nimport Range from '../range';\r\nimport DocumentSelection from '../documentselection';\r\n\r\n/**\r\n * Deletes content of the selection and merge siblings. The resulting selection is always collapsed.\r\n *\r\n * **Note:** Use {@link module:engine/model/model~Model#deleteContent} instead of this function.\r\n * This function is only exposed to be reusable in algorithms\r\n * which change the {@link module:engine/model/model~Model#deleteContent}\r\n * method's behavior.\r\n *\r\n * @param {module:engine/model/model~Model} model The model in context of which the insertion\r\n * should be performed.\r\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n * Selection of which the content should be deleted.\r\n * @param {module:engine/model/batch~Batch} batch Batch to which the operations will be added.\r\n * @param {Object} [options]\r\n * @param {Boolean} [options.leaveUnmerged=false] Whether to merge elements after removing the content of the selection.\r\n *\r\n * For example `<heading>x[x</heading><paragraph>y]y</paragraph>` will become:\r\n *\r\n * * `<heading>x^y</heading>` with the option disabled (`leaveUnmerged == false`)\r\n * * `<heading>x^</heading><paragraph>y</paragraph>` with enabled (`leaveUnmerged == true`).\r\n *\r\n * Note: {@link module:engine/model/schema~Schema#isObject object} and {@link module:engine/model/schema~Schema#isLimit limit}\r\n * elements will not be merged.\r\n *\r\n * @param {Boolean} [options.doNotResetEntireContent=false] Whether to skip replacing the entire content with a\r\n * paragraph when the entire content was selected.\r\n *\r\n * For example `<heading>[x</heading><paragraph>y]</paragraph>` will become:\r\n *\r\n * * `<paragraph>^</paragraph>` with the option disabled (`doNotResetEntireContent == false`)\r\n * * `<heading>^</heading>` with enabled (`doNotResetEntireContent == true`).\r\n */\r\nexport default function deleteContent( model, selection, options = {} ) {\r\n\tif ( selection.isCollapsed ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst schema = model.schema;\r\n\r\n\tmodel.change( writer => {\r\n\t\t// 1. Replace the entire content with paragraph.\r\n\t\t// See: https://github.com/ckeditor/ckeditor5-engine/issues/1012#issuecomment-315017594.\r\n\t\tif ( !options.doNotResetEntireContent && shouldEntireContentBeReplacedWithParagraph( schema, selection ) ) {\r\n\t\t\treplaceEntireContentWithParagraph( writer, selection, schema );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst selRange = selection.getFirstRange();\r\n\t\tconst startPos = selRange.start;\r\n\t\tconst endPos = LivePosition.fromPosition( selRange.end, 'toNext' );\r\n\r\n\t\t// 2. Remove the content if there is any.\r\n\t\tif ( !selRange.start.isTouching( selRange.end ) ) {\r\n\t\t\twriter.remove( selRange );\r\n\t\t}\r\n\r\n\t\t// 3. Merge elements in the right branch to the elements in the left branch.\r\n\t\t// The only reasonable (in terms of data and selection correctness) case in which we need to do that is:\r\n\t\t//\r\n\t\t// <heading type=1>Fo[</heading><paragraph>]ar</paragraph> => <heading type=1>Fo^ar</heading>\r\n\t\t//\r\n\t\t// However, the algorithm supports also merging deeper structures (up to the depth of the shallower branch),\r\n\t\t// as it's hard to imagine what should actually be the default behavior. Usually, specific features will\r\n\t\t// want to override that behavior anyway.\r\n\t\tif ( !options.leaveUnmerged ) {\r\n\t\t\tmergeBranches( writer, startPos, endPos );\r\n\r\n\t\t\t// TMP this will be replaced with a postifxer.\r\n\t\t\t// We need to check and strip disallowed attributes in all nested nodes because after merge\r\n\t\t\t// some attributes could end up in a path where are disallowed.\r\n\t\t\t//\r\n\t\t\t// e.g. bold is disallowed for <H1>\r\n\t\t\t// <h1>Fo{o</h1><p>b}a<b>r</b><p> -> <h1>Fo{}a<b>r</b><h1> -> <h1>Fo{}ar<h1>.\r\n\t\t\tschema.removeDisallowedAttributes( startPos.parent.getChildren(), writer );\r\n\t\t}\r\n\r\n\t\tif ( selection instanceof DocumentSelection ) {\r\n\t\t\twriter.setSelection( startPos );\r\n\t\t} else {\r\n\t\t\tselection.setTo( startPos );\r\n\t\t}\r\n\r\n\t\t// 4. Autoparagraphing.\r\n\t\t// Check if a text is allowed in the new container. If not, try to create a new paragraph (if it's allowed here).\r\n\t\tif ( shouldAutoparagraph( schema, startPos ) ) {\r\n\t\t\tinsertParagraph( writer, startPos, selection );\r\n\t\t}\r\n\r\n\t\tendPos.detach();\r\n\t} );\r\n}\r\n\r\n// This function is a result of reaching the Ballmer's peak for just the right amount of time.\r\n// Even I had troubles documenting it after a while and after reading it again I couldn't believe that it really works.\r\nfunction mergeBranches( writer, startPos, endPos ) {\r\n\tconst startParent = startPos.parent;\r\n\tconst endParent = endPos.parent;\r\n\r\n\t// If both positions ended up in the same parent, then there's nothing more to merge:\r\n\t// <$root><p>x[]</p><p>{}y</p></$root> => <$root><p>xy</p>[]{}</$root>\r\n\tif ( startParent == endParent ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// If one of the positions is a limit element, then there's nothing to merge because we don't want to cross the limit boundaries.\r\n\tif ( writer.model.schema.isLimit( startParent ) || writer.model.schema.isLimit( endParent ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Check if operations we'll need to do won't need to cross object or limit boundaries.\r\n\t// E.g., we can't merge endParent into startParent in this case:\r\n\t// <limit><startParent>x[]</startParent></limit><endParent>{}</endParent>\r\n\tif ( !checkCanBeMerged( startPos, endPos, writer.model.schema ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Remember next positions to merge. For example:\r\n\t// <a><b>x[]</b></a><c><d>{}y</d></c>\r\n\t// will become:\r\n\t// <a><b>xy</b>[]</a><c>{}</c>\r\n\tstartPos = writer.createPositionAfter( startParent );\r\n\tendPos = writer.createPositionBefore( endParent );\r\n\r\n\tif ( !endPos.isEqual( startPos ) ) {\r\n\t\t// In this case, before we merge, we need to move `endParent` to the `startPos`:\r\n\t\t// <a><b>x[]</b></a><c><d>{}y</d></c>\r\n\t\t// becomes:\r\n\t\t// <a><b>x</b>[]<d>y</d></a><c>{}</c>\r\n\t\twriter.insert( endParent, startPos );\r\n\t}\r\n\r\n\t// Merge two siblings:\r\n\t// <a>x</a>[]<b>y</b> -> <a>xy</a> (the usual case)\r\n\t// <a><b>x</b>[]<d>y</d></a><c></c> -> <a><b>xy</b>[]</a><c></c> (this is the \"move parent\" case shown above)\r\n\twriter.merge( startPos );\r\n\r\n\t// Remove empty end ancestors:\r\n\t// <a>fo[o</a><b><a><c>bar]</c></a></b>\r\n\t// becomes:\r\n\t// <a>fo[]</a><b><a>{}</a></b>\r\n\t// So we can remove <a> and <b>.\r\n\twhile ( endPos.parent.isEmpty ) {\r\n\t\tconst parentToRemove = endPos.parent;\r\n\r\n\t\tendPos = writer.createPositionBefore( parentToRemove );\r\n\r\n\t\twriter.remove( parentToRemove );\r\n\t}\r\n\r\n\t// Continue merging next level.\r\n\tmergeBranches( writer, startPos, endPos );\r\n}\r\n\r\nfunction shouldAutoparagraph( schema, position ) {\r\n\tconst isTextAllowed = schema.checkChild( position, '$text' );\r\n\tconst isParagraphAllowed = schema.checkChild( position, 'paragraph' );\r\n\r\n\treturn !isTextAllowed && isParagraphAllowed;\r\n}\r\n\r\n// Check if parents of two positions can be merged by checking if there are no limit/object\r\n// boundaries between those two positions.\r\n//\r\n// E.g. in <bQ><p>x[]</p></bQ><widget><caption>{}</caption></widget>\r\n// we'll check <p>, <bQ>, <widget> and <caption>.\r\n// Usually, widget and caption are marked as objects/limits in the schema, so in this case merging will be blocked.\r\nfunction checkCanBeMerged( leftPos, rightPos, schema ) {\r\n\tconst rangeToCheck = new Range( leftPos, rightPos );\r\n\r\n\tfor ( const value of rangeToCheck.getWalker() ) {\r\n\t\tif ( schema.isLimit( value.item ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction insertParagraph( writer, position, selection ) {\r\n\tconst paragraph = writer.createElement( 'paragraph' );\r\n\r\n\twriter.insert( paragraph, position );\r\n\r\n\tif ( selection instanceof DocumentSelection ) {\r\n\t\twriter.setSelection( paragraph, 0 );\r\n\t} else {\r\n\t\tselection.setTo( paragraph, 0 );\r\n\t}\r\n}\r\n\r\nfunction replaceEntireContentWithParagraph( writer, selection ) {\r\n\tconst limitElement = writer.model.schema.getLimitElement( selection );\r\n\r\n\twriter.remove( writer.createRangeIn( limitElement ) );\r\n\tinsertParagraph( writer, writer.createPositionAt( limitElement, 0 ), selection );\r\n}\r\n\r\n// We want to replace the entire content with a paragraph when:\r\n// * the entire content is selected,\r\n// * selection contains at least two elements,\r\n// * whether the paragraph is allowed in schema in the common ancestor.\r\nfunction shouldEntireContentBeReplacedWithParagraph( schema, selection ) {\r\n\tconst limitElement = schema.getLimitElement( selection );\r\n\r\n\tif ( !selection.containsEntireContent( limitElement ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst range = selection.getFirstRange();\r\n\r\n\tif ( range.start.parent == range.end.parent ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn schema.checkChild( limitElement, 'paragraph' );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/utils/modifyselection\r\n */\r\n\r\nimport Position from '../position';\r\nimport TreeWalker from '../treewalker';\r\nimport Range from '../range';\r\nimport { isInsideSurrogatePair, isInsideCombinedSymbol } from '@ckeditor/ckeditor5-utils/src/unicode';\r\nimport DocumentSelection from '../documentselection';\r\n\r\nconst wordBoundaryCharacters = ' ,.?!:;\"-()';\r\n\r\n/**\r\n * Modifies the selection. Currently, the supported modifications are:\r\n *\r\n * * Extending. The selection focus is moved in the specified `options.direction` with a step specified in `options.unit`.\r\n * Possible values for `unit` are:\r\n *  * `'character'` (default) - moves selection by one user-perceived character. In most cases this means moving by one\r\n *  character in `String` sense. However, unicode also defines \"combing marks\". These are special symbols, that combines\r\n *  with a symbol before it (\"base character\") to create one user-perceived character. For example, `q̣̇` is a normal\r\n *  letter `q` with two \"combining marks\": upper dot (`Ux0307`) and lower dot (`Ux0323`). For most actions, i.e. extending\r\n *  selection by one position, it is correct to include both \"base character\" and all of it's \"combining marks\". That is\r\n *  why `'character'` value is most natural and common method of modifying selection.\r\n *  * `'codePoint'` - moves selection by one unicode code point. In contrary to, `'character'` unit, this will insert\r\n *  selection between \"base character\" and \"combining mark\", because \"combining marks\" have their own unicode code points.\r\n *  However, for technical reasons, unicode code points with values above `UxFFFF` are represented in native `String` by\r\n *  two characters, called \"surrogate pairs\". Halves of \"surrogate pairs\" have a meaning only when placed next to each other.\r\n *  For example `𨭎` is represented in `String` by `\\uD862\\uDF4E`. Both `\\uD862` and `\\uDF4E` do not have any meaning\r\n *  outside the pair (are rendered as ? when alone). Position between them would be incorrect. In this case, selection\r\n *  extension will include whole \"surrogate pair\".\r\n *  * `'word'` - moves selection by a whole word.\r\n *\r\n * **Note:** if you extend a forward selection in a backward direction you will in fact shrink it.\r\n *\r\n * **Note:** Use {@link module:engine/model/model~Model#modifySelection} instead of this function.\r\n * This function is only exposed to be reusable in algorithms\r\n * which change the {@link module:engine/model/model~Model#modifySelection}\r\n * method's behavior.\r\n *\r\n * @param {module:engine/model/model~Model} model The model in context of which\r\n * the selection modification should be performed.\r\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n * The selection to modify.\r\n * @param {Object} [options]\r\n * @param {'forward'|'backward'} [options.direction='forward'] The direction in which the selection should be modified.\r\n * @param {'character'|'codePoint'|'word'} [options.unit='character'] The unit by which selection should be modified.\r\n */\r\nexport default function modifySelection( model, selection, options = {} ) {\r\n\tconst schema = model.schema;\r\n\tconst isForward = options.direction != 'backward';\r\n\tconst unit = options.unit ? options.unit : 'character';\r\n\r\n\tconst focus = selection.focus;\r\n\r\n\tconst walker = new TreeWalker( {\r\n\t\tboundaries: getSearchRange( focus, isForward ),\r\n\t\tsingleCharacters: true,\r\n\t\tdirection: isForward ? 'forward' : 'backward'\r\n\t} );\r\n\r\n\tconst data = { walker, schema, isForward, unit };\r\n\r\n\tlet next;\r\n\r\n\twhile ( ( next = walker.next() ) ) {\r\n\t\tif ( next.done ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst position = tryExtendingTo( data, next.value );\r\n\r\n\t\tif ( position ) {\r\n\t\t\tif ( selection instanceof DocumentSelection ) {\r\n\t\t\t\tmodel.change( writer => {\r\n\t\t\t\t\twriter.setSelectionFocus( position );\r\n\t\t\t\t} );\r\n\t\t\t} else {\r\n\t\t\t\tselection.setFocus( position );\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Checks whether the selection can be extended to the the walker's next value (next position).\r\n// @param {{ walker, unit, isForward, schema }} data\r\n// @param {module:engine/view/treewalker~TreeWalkerValue} value\r\nfunction tryExtendingTo( data, value ) {\r\n\t// If found text, we can certainly put the focus in it. Let's just find a correct position\r\n\t// based on the unit.\r\n\tif ( value.type == 'text' ) {\r\n\t\tif ( data.unit === 'word' ) {\r\n\t\t\treturn getCorrectWordBreakPosition( data.walker, data.isForward );\r\n\t\t}\r\n\r\n\t\treturn getCorrectPosition( data.walker, data.unit, data.isForward );\r\n\t}\r\n\r\n\t// Entering an element.\r\n\tif ( value.type == ( data.isForward ? 'elementStart' : 'elementEnd' ) ) {\r\n\t\t// If it's an object, we can select it now.\r\n\t\tif ( data.schema.isObject( value.item ) ) {\r\n\t\t\treturn Position._createAt( value.item, data.isForward ? 'after' : 'before' );\r\n\t\t}\r\n\r\n\t\t// If text allowed on this position, extend to this place.\r\n\t\tif ( data.schema.checkChild( value.nextPosition, '$text' ) ) {\r\n\t\t\treturn value.nextPosition;\r\n\t\t}\r\n\t}\r\n\t// Leaving an element.\r\n\telse {\r\n\t\t// If leaving a limit element, stop.\r\n\t\tif ( data.schema.isLimit( value.item ) ) {\r\n\t\t\t// NOTE: Fast-forward the walker until the end.\r\n\t\t\tdata.walker.skip( () => true );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If text allowed on this position, extend to this place.\r\n\t\tif ( data.schema.checkChild( value.nextPosition, '$text' ) ) {\r\n\t\t\treturn value.nextPosition;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Finds a correct position by walking in a text node and checking whether selection can be extended to given position\r\n// or should be extended further.\r\n//\r\n// @param {module:engine/model/treewalker~TreeWalker} walker\r\n// @param {String} unit The unit by which selection should be modified.\r\nfunction getCorrectPosition( walker, unit ) {\r\n\tconst textNode = walker.position.textNode;\r\n\r\n\tif ( textNode ) {\r\n\t\tconst data = textNode.data;\r\n\t\tlet offset = walker.position.offset - textNode.startOffset;\r\n\r\n\t\twhile ( isInsideSurrogatePair( data, offset ) || ( unit == 'character' && isInsideCombinedSymbol( data, offset ) ) ) {\r\n\t\t\twalker.next();\r\n\r\n\t\t\toffset = walker.position.offset - textNode.startOffset;\r\n\t\t}\r\n\t}\r\n\r\n\treturn walker.position;\r\n}\r\n\r\n// Finds a correct position of a word break by walking in a text node and checking whether selection can be extended to given position\r\n// or should be extended further.\r\n//\r\n// @param {module:engine/model/treewalker~TreeWalker} walker\r\n// @param {Boolean} isForward Is the direction in which the selection should be modified is forward.\r\nfunction getCorrectWordBreakPosition( walker, isForward ) {\r\n\tlet textNode = walker.position.textNode;\r\n\r\n\tif ( textNode ) {\r\n\t\tlet offset = walker.position.offset - textNode.startOffset;\r\n\r\n\t\twhile ( !isAtWordBoundary( textNode.data, offset, isForward ) && !isAtNodeBoundary( textNode, offset, isForward ) ) {\r\n\t\t\twalker.next();\r\n\r\n\t\t\t// Check of adjacent text nodes with different attributes (like BOLD).\r\n\t\t\t// Example          : 'foofoo []bar<$text bold=\"true\">bar</$text> bazbaz'\r\n\t\t\t// should expand to : 'foofoo [bar<$text bold=\"true\">bar</$text>] bazbaz'.\r\n\t\t\tconst nextNode = isForward ? walker.position.nodeAfter : walker.position.nodeBefore;\r\n\r\n\t\t\t// Scan only text nodes. Ignore inline elements (like `<softBreak>`).\r\n\t\t\tif ( nextNode && nextNode.is( 'text' ) ) {\r\n\t\t\t\t// Check boundary char of an adjacent text node.\r\n\t\t\t\tconst boundaryChar = nextNode.data.charAt( isForward ? 0 : nextNode.data.length - 1 );\r\n\r\n\t\t\t\t// Go to the next node if the character at the boundary of that node belongs to the same word.\r\n\t\t\t\tif ( !wordBoundaryCharacters.includes( boundaryChar ) ) {\r\n\t\t\t\t\t// If adjacent text node belongs to the same word go to it & reset values.\r\n\t\t\t\t\twalker.next();\r\n\r\n\t\t\t\t\ttextNode = walker.position.textNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\toffset = walker.position.offset - textNode.startOffset;\r\n\t\t}\r\n\t}\r\n\r\n\treturn walker.position;\r\n}\r\n\r\nfunction getSearchRange( start, isForward ) {\r\n\tconst root = start.root;\r\n\tconst searchEnd = Position._createAt( root, isForward ? 'end' : 0 );\r\n\r\n\tif ( isForward ) {\r\n\t\treturn new Range( start, searchEnd );\r\n\t} else {\r\n\t\treturn new Range( searchEnd, start );\r\n\t}\r\n}\r\n\r\n// Checks if selection is on word boundary.\r\n//\r\n// @param {String} data The text node value to investigate.\r\n// @param {Number} offset Position offset.\r\n// @param {Boolean} isForward Is the direction in which the selection should be modified is forward.\r\nfunction isAtWordBoundary( data, offset, isForward ) {\r\n\t// The offset to check depends on direction.\r\n\tconst offsetToCheck = offset + ( isForward ? 0 : -1 );\r\n\r\n\treturn wordBoundaryCharacters.includes( data.charAt( offsetToCheck ) );\r\n}\r\n\r\n// Checks if selection is on node boundary.\r\n//\r\n// @param {module:engine/model/text~Text} textNode The text node to investigate.\r\n// @param {Number} offset Position offset.\r\n// @param {Boolean} isForward Is the direction in which the selection should be modified is forward.\r\nfunction isAtNodeBoundary( textNode, offset, isForward ) {\r\n\treturn offset === ( isForward ? textNode.endOffset : 0 );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/utils/getselectedcontent\r\n */\r\n\r\n/**\r\n * Gets a clone of the selected content.\r\n *\r\n * For example, for the following selection:\r\n *\r\n * ```html\r\n * <p>x</p><quote><p>y</p><h>fir[st</h></quote><p>se]cond</p><p>z</p>\r\n * ```\r\n *\r\n * It will return a document fragment with such a content:\r\n *\r\n * ```html\r\n * <quote><h>st</h></quote><p>se</p>\r\n * ```\r\n *\r\n * @param {module:engine/model/model~Model} model The model in context of which\r\n * the selection modification should be performed.\r\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n * The selection of which content will be returned.\r\n * @returns {module:engine/model/documentfragment~DocumentFragment}\r\n */\r\nexport default function getSelectedContent( model, selection ) {\r\n\treturn model.change( writer => {\r\n\t\tconst frag = writer.createDocumentFragment();\r\n\t\tconst range = selection.getFirstRange();\r\n\r\n\t\tif ( !range || range.isCollapsed ) {\r\n\t\t\treturn frag;\r\n\t\t}\r\n\r\n\t\tconst root = range.start.root;\r\n\t\tconst commonPath = range.start.getCommonPath( range.end );\r\n\t\tconst commonParent = root.getNodeByPath( commonPath );\r\n\r\n\t\t// ## 1st step\r\n\t\t//\r\n\t\t// First, we'll clone a fragment represented by a minimal flat range\r\n\t\t// containing the original range to be cloned.\r\n\t\t// E.g. let's consider such a range:\r\n\t\t//\r\n\t\t// <p>x</p><quote><p>y</p><h>fir[st</h></quote><p>se]cond</p><p>z</p>\r\n\t\t//\r\n\t\t// A minimal flat range containing this one is:\r\n\t\t//\r\n\t\t// <p>x</p>[<quote><p>y</p><h>first</h></quote><p>second</p>]<p>z</p>\r\n\t\t//\r\n\t\t// We can easily clone this structure, preserving e.g. the <quote> element.\r\n\t\tlet flatSubtreeRange;\r\n\r\n\t\tif ( range.start.parent == range.end.parent ) {\r\n\t\t\t// The original range is flat, so take it.\r\n\t\t\tflatSubtreeRange = range;\r\n\t\t} else {\r\n\t\t\tflatSubtreeRange = writer.createRange(\r\n\t\t\t\twriter.createPositionAt( commonParent, range.start.path[ commonPath.length ] ),\r\n\t\t\t\twriter.createPositionAt( commonParent, range.end.path[ commonPath.length ] + 1 )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst howMany = flatSubtreeRange.end.offset - flatSubtreeRange.start.offset;\r\n\r\n\t\t// Clone the whole contents.\r\n\t\tfor ( const item of flatSubtreeRange.getItems( { shallow: true } ) ) {\r\n\t\t\tif ( item.is( 'textProxy' ) ) {\r\n\t\t\t\twriter.appendText( item.data, item.getAttributes(), frag );\r\n\t\t\t} else {\r\n\t\t\t\twriter.append( item._clone( true ), frag );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// ## 2nd step\r\n\t\t//\r\n\t\t// If the original range wasn't flat, then we need to remove the excess nodes from the both ends of the cloned fragment.\r\n\t\t//\r\n\t\t// For example, for the range shown in the 1st step comment, we need to remove these pieces:\r\n\t\t//\r\n\t\t// <quote>[<p>y</p>]<h>[fir]st</h></quote><p>se[cond]</p>\r\n\t\t//\r\n\t\t// So this will be the final copied content:\r\n\t\t//\r\n\t\t// <quote><h>st</h></quote><p>se</p>\r\n\t\t//\r\n\t\t// In order to do that, we remove content from these two ranges:\r\n\t\t//\r\n\t\t// [<quote><p>y</p><h>fir]st</h></quote><p>se[cond</p>]\r\n\t\tif ( flatSubtreeRange != range ) {\r\n\t\t\t// Find the position of the original range in the cloned fragment.\r\n\t\t\tconst newRange = range._getTransformedByMove( flatSubtreeRange.start, writer.createPositionAt( frag, 0 ), howMany )[ 0 ];\r\n\r\n\t\t\tconst leftExcessRange = writer.createRange( writer.createPositionAt( frag, 0 ), newRange.start );\r\n\t\t\tconst rightExcessRange = writer.createRange( newRange.end, writer.createPositionAt( frag, 'end' ) );\r\n\r\n\t\t\tremoveRangeContent( rightExcessRange, writer );\r\n\t\t\tremoveRangeContent( leftExcessRange, writer );\r\n\t\t}\r\n\r\n\t\treturn frag;\r\n\t} );\r\n}\r\n\r\n// After https://github.com/ckeditor/ckeditor5-engine/issues/690 is fixed,\r\n// this function will, most likely, be able to rewritten using getMinimalFlatRanges().\r\nfunction removeRangeContent( range, writer ) {\r\n\tconst parentsToCheck = [];\r\n\r\n\tArray.from( range.getItems( { direction: 'backward' } ) )\r\n\t\t// We should better store ranges because text proxies will lose integrity\r\n\t\t// with the text nodes when we'll start removing content.\r\n\t\t.map( item => writer.createRangeOn( item ) )\r\n\t\t// Filter only these items which are fully contained in the passed range.\r\n\t\t//\r\n\t\t// E.g. for the following range: [<quote><p>y</p><h>fir]st</h>\r\n\t\t// the walker will return the entire <h> element, when only the \"fir\" item inside it is fully contained.\r\n\t\t.filter( itemRange => {\r\n\t\t\t// We should be able to use Range.containsRange, but https://github.com/ckeditor/ckeditor5-engine/issues/691.\r\n\t\t\tconst contained =\r\n\t\t\t\t( itemRange.start.isAfter( range.start ) || itemRange.start.isEqual( range.start ) ) &&\r\n\t\t\t\t( itemRange.end.isBefore( range.end ) || itemRange.end.isEqual( range.end ) );\r\n\r\n\t\t\treturn contained;\r\n\t\t} )\r\n\t\t.forEach( itemRange => {\r\n\t\t\tparentsToCheck.push( itemRange.start.parent );\r\n\r\n\t\t\twriter.remove( itemRange );\r\n\t\t} );\r\n\r\n\t// Remove ancestors of the removed items if they turned to be empty now\r\n\t// (their whole content was contained in the range).\r\n\tparentsToCheck.forEach( parentToCheck => {\r\n\t\tlet parent = parentToCheck;\r\n\r\n\t\twhile ( parent.parent && parent.isEmpty ) {\r\n\t\t\tconst removeRange = writer.createRangeOn( parent );\r\n\r\n\t\t\tparent = parent.parent;\r\n\r\n\t\t\twriter.remove( removeRange );\r\n\t\t}\r\n\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/utils/selection-post-fixer\r\n */\r\n\r\nimport Range from '../range';\r\nimport Position from '../position';\r\n\r\n/**\r\n * Injects selection post-fixer to the model.\r\n *\r\n * The role of the selection post-fixer is to ensure that the selection is in a correct place\r\n * after a {@link module:engine/model/model~Model#change `change()`} block was executed.\r\n *\r\n * The correct position means that:\r\n *\r\n * * All collapsed selection ranges are in a place where the {@link module:engine/model/schema~Schema}\r\n * allows a `$text`.\r\n * * None of the selection's non-collapsed ranges crosses a {@link module:engine/model/schema~Schema#isLimit limit element}\r\n * boundary (a range must be rooted within one limit element).\r\n * * Only {@link module:engine/model/schema~Schema#isObject object elements} can be selected from the outside\r\n * (e.g. `[<paragraph>foo</paragraph>]` is invalid). This rule applies independently to both selection ends, so this\r\n * selection is correct: `<paragraph>f[oo</paragraph><image></image>]`.\r\n *\r\n * If the position is not correct, the post-fixer will automatically correct it.\r\n *\r\n * ## Fixing a non-collapsed selection\r\n *\r\n * See as an example a selection that starts in a P1 element and ends inside the text of a TD element\r\n * (`[` and `]` are range boundaries and `(l)` denotes an element defined as `isLimit=true`):\r\n *\r\n *\t\troot\r\n *\t\t |- element P1\r\n *\t\t |   |- \"foo\"                                      root\r\n *\t\t |- element TABLE (l)                   P1         TABLE             P2\r\n *\t\t |   |- element TR (l)                 f o[o     TR      TR         b a r\r\n *\t\t |   |   |- element TD (l)                       TD      TD\r\n *\t\t |   |       |- \"aaa\"                          a]a a    b b b\r\n *\t\t |   |- element TR (l)\r\n *\t\t |   |   |- element TD (l)                           ||\r\n *\t\t |   |       |- \"bbb\"                                ||\r\n *\t\t |- element P2                                       VV\r\n *\t\t |   |- \"bar\"\r\n *\t\t                                                   root\r\n *\t\t                                        P1         TABLE]            P2\r\n *\t\t                                       f o[o     TR      TR         b a r\r\n *\t\t                                                 TD      TD\r\n *\t\t                                               a a a    b b b\r\n *\r\n * In the example above, the TABLE, TR and TD are defined as `isLimit=true` in the schema. The range which is not contained within\r\n * a single limit element must be expanded to select the outermost limit element. The range end is inside the text node of the TD element.\r\n * As the TD element is a child of the TR and TABLE elements, where both are defined as `isLimit=true` in the schema, the range must be\r\n * expanded to select the whole TABLE element.\r\n *\r\n * **Note** If the selection contains multiple ranges, the method returns a minimal set of ranges that are not intersecting after expanding\r\n * them to select `isLimit=true` elements.\r\n *\r\n * @param {module:engine/model/model~Model} model\r\n */\r\nexport function injectSelectionPostFixer( model ) {\r\n\tmodel.document.registerPostFixer( writer => selectionPostFixer( writer, model ) );\r\n}\r\n\r\n// The selection post-fixer.\r\n//\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/model~Model} model\r\nfunction selectionPostFixer( writer, model ) {\r\n\tconst selection = model.document.selection;\r\n\tconst schema = model.schema;\r\n\r\n\tconst ranges = [];\r\n\r\n\tlet wasFixed = false;\r\n\r\n\tfor ( const modelRange of selection.getRanges() ) {\r\n\t\t// Go through all ranges in selection and try fixing each of them.\r\n\t\t// Those ranges might overlap but will be corrected later.\r\n\t\tconst correctedRange = tryFixingRange( modelRange, schema );\r\n\r\n\t\tif ( correctedRange ) {\r\n\t\t\tranges.push( correctedRange );\r\n\t\t\twasFixed = true;\r\n\t\t} else {\r\n\t\t\tranges.push( modelRange );\r\n\t\t}\r\n\t}\r\n\r\n\t// If any of ranges were corrected update the selection.\r\n\tif ( wasFixed ) {\r\n\t\t// The above algorithm might create ranges that intersects each other when selection contains more then one range.\r\n\t\t// This is case happens mostly on Firefox which creates multiple ranges for selected table.\r\n\t\tlet fixedRanges = ranges;\r\n\r\n\t\t// Fixing selection with many ranges usually breaks the selection in Firefox. As only Firefox supports multiple selection ranges\r\n\t\t// we simply create one continuous range from fixed selection ranges (even if they are not adjacent).\r\n\t\tif ( ranges.length > 1 ) {\r\n\t\t\tconst selectionStart = ranges[ 0 ].start;\r\n\t\t\tconst selectionEnd = ranges[ ranges.length - 1 ].end;\r\n\r\n\t\t\tfixedRanges = [ new Range( selectionStart, selectionEnd ) ];\r\n\t\t}\r\n\r\n\t\twriter.setSelection( fixedRanges, { backward: selection.isBackward } );\r\n\t}\r\n}\r\n\r\n// Tries fixing a range if it's incorrect.\r\n//\r\n// @param {module:engine/model/range~Range} range\r\n// @param {module:engine/model/schema~Schema} schema\r\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\r\nfunction tryFixingRange( range, schema ) {\r\n\tif ( range.isCollapsed ) {\r\n\t\treturn tryFixingCollapsedRange( range, schema );\r\n\t}\r\n\r\n\treturn tryFixingNonCollapsedRage( range, schema );\r\n}\r\n\r\n// Tries to fix collapsed ranges.\r\n//\r\n// * Fixes situation when a range is in a place where $text is not allowed\r\n//\r\n// @param {module:engine/model/range~Range} range Collapsed range to fix.\r\n// @param {module:engine/model/schema~Schema} schema\r\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\r\nfunction tryFixingCollapsedRange( range, schema ) {\r\n\tconst originalPosition = range.start;\r\n\r\n\tconst nearestSelectionRange = schema.getNearestSelectionRange( originalPosition );\r\n\r\n\t// This might be null ie when editor data is empty.\r\n\t// In such cases there is no need to fix the selection range.\r\n\tif ( !nearestSelectionRange ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst fixedPosition = nearestSelectionRange.start;\r\n\r\n\t// Fixed position is the same as original - no need to return corrected range.\r\n\tif ( originalPosition.isEqual( fixedPosition ) ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Check single node selection (happens in tables).\r\n\tif ( fixedPosition.nodeAfter && schema.isLimit( fixedPosition.nodeAfter ) ) {\r\n\t\treturn new Range( fixedPosition, Position._createAfter( fixedPosition.nodeAfter ) );\r\n\t}\r\n\r\n\treturn new Range( fixedPosition );\r\n}\r\n\r\n// Tries to fix an expanded range.\r\n//\r\n// @param {module:engine/model/range~Range} range Expanded range to fix.\r\n// @param {module:engine/model/schema~Schema} schema\r\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\r\nfunction tryFixingNonCollapsedRage( range, schema ) {\r\n\tconst start = range.start;\r\n\tconst end = range.end;\r\n\r\n\tconst isTextAllowedOnStart = schema.checkChild( start, '$text' );\r\n\tconst isTextAllowedOnEnd = schema.checkChild( end, '$text' );\r\n\r\n\tconst startLimitElement = schema.getLimitElement( start );\r\n\tconst endLimitElement = schema.getLimitElement( end );\r\n\r\n\t// Ranges which both end are inside the same limit element (or root) might needs only minor fix.\r\n\tif ( startLimitElement === endLimitElement ) {\r\n\t\t// Range is valid when both position allows to place a text:\r\n\t\t// - <block>f[oobarba]z</block>\r\n\t\t// This would be \"fixed\" by a next check but as it will be the same it's better to return null so the selection stays the same.\r\n\t\tif ( isTextAllowedOnStart && isTextAllowedOnEnd ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Range that is on non-limit element (or is partially) must be fixed so it is placed inside the block around $text:\r\n\t\t// - [<block>foo</block>]    ->    <block>[foo]</block>\r\n\t\t// - [<block>foo]</block>    ->    <block>[foo]</block>\r\n\t\t// - <block>f[oo</block>]    ->    <block>f[oo]</block>\r\n\t\tif ( checkSelectionOnNonLimitElements( start, end, schema ) ) {\r\n\t\t\tconst fixedStart = schema.getNearestSelectionRange( start, 'forward' );\r\n\t\t\tconst fixedEnd = schema.getNearestSelectionRange( end, 'backward' );\r\n\r\n\t\t\treturn new Range( fixedStart ? fixedStart.start : start, fixedEnd ? fixedEnd.start : end );\r\n\t\t}\r\n\t}\r\n\r\n\tconst isStartInLimit = startLimitElement && !startLimitElement.is( 'rootElement' );\r\n\tconst isEndInLimit = endLimitElement && !endLimitElement.is( 'rootElement' );\r\n\r\n\t// At this point we eliminated valid positions on text nodes so if one of range positions is placed inside a limit element\r\n\t// then the range crossed limit element boundaries and needs to be fixed.\r\n\tif ( isStartInLimit || isEndInLimit ) {\r\n\t\t// Although we've already found limit element on start/end positions we must find the outer-most limit element.\r\n\t\t// as limit elements might be nested directly inside (ie table > tableRow > tableCell).\r\n\t\tconst startPosition = Position._createAt( startLimitElement, 0 );\r\n\t\tconst endPosition = Position._createAt( endLimitElement, 0 );\r\n\r\n\t\tconst fixedStart = isStartInLimit ? expandSelectionOnIsLimitNode( startPosition, schema, 'start' ) : start;\r\n\t\tconst fixedEnd = isEndInLimit ? expandSelectionOnIsLimitNode( endPosition, schema, 'end' ) : end;\r\n\r\n\t\treturn new Range( fixedStart, fixedEnd );\r\n\t}\r\n\r\n\t// Range was not fixed at this point so it is valid - ie it was placed around limit element already.\r\n\treturn null;\r\n}\r\n\r\n// Expands selection so it contains whole limit node.\r\n//\r\n// @param {module:engine/model/position~Position} position\r\n// @param {module:engine/model/schema~Schema} schema\r\n// @param {String} expandToDirection Direction of expansion - either 'start' or 'end' of the range.\r\n// @returns {module:engine/model/position~Position}\r\nfunction expandSelectionOnIsLimitNode( position, schema, expandToDirection ) {\r\n\tlet node = position.parent;\r\n\tlet parent = node;\r\n\r\n\t// Find outer most isLimit block as such blocks might be nested (ie. in tables).\r\n\twhile ( schema.isLimit( parent ) && parent.parent ) {\r\n\t\tnode = parent;\r\n\t\tparent = parent.parent;\r\n\t}\r\n\r\n\t// Depending on direction of expanding selection return position before or after found node.\r\n\treturn expandToDirection === 'start' ? Position._createBefore( node ) : Position._createAfter( node );\r\n}\r\n\r\n// Checks whether both range ends are placed around non-limit elements.\r\n//\r\n// @param {module:engine/model/position~Position} start\r\n// @param {module:engine/model/position~Position} end\r\n// @param {module:engine/model/schema~Schema} schema\r\nfunction checkSelectionOnNonLimitElements( start, end, schema ) {\r\n\tconst startIsOnBlock = ( start.nodeAfter && !schema.isLimit( start.nodeAfter ) ) || schema.checkChild( start, '$text' );\r\n\tconst endIsOnBlock = ( end.nodeBefore && !schema.isLimit( end.nodeBefore ) ) || schema.checkChild( end, '$text' );\r\n\r\n\treturn startIsOnBlock && endIsOnBlock;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/model\r\n */\r\n\r\nimport Batch from './batch';\r\nimport Writer from './writer';\r\nimport Schema from './schema';\r\nimport Document from './document';\r\nimport MarkerCollection from './markercollection';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ModelElement from './element';\r\nimport ModelRange from './range';\r\nimport ModelPosition from './position';\r\nimport ModelSelection from './selection';\r\n\r\nimport insertContent from './utils/insertcontent';\r\nimport deleteContent from './utils/deletecontent';\r\nimport modifySelection from './utils/modifyselection';\r\nimport getSelectedContent from './utils/getselectedcontent';\r\nimport { injectSelectionPostFixer } from './utils/selection-post-fixer';\r\n\r\n/**\r\n * Editor's data model. Read about the model in the\r\n * {@glink framework/guides/architecture/editing-engine engine architecture guide}.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Model {\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Model's marker collection.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/markercollection~MarkerCollection}\r\n\t\t */\r\n\t\tthis.markers = new MarkerCollection();\r\n\r\n\t\t/**\r\n\t\t * Model's document.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/document~Document}\r\n\t\t */\r\n\t\tthis.document = new Document( this );\r\n\r\n\t\t/**\r\n\t\t * Model's schema.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/schema~Schema}\r\n\t\t */\r\n\t\tthis.schema = new Schema();\r\n\r\n\t\t/**\r\n\t\t * All callbacks added by {@link module:engine/model/model~Model#change} or\r\n\t\t * {@link module:engine/model/model~Model#enqueueChange} methods waiting to be executed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Array.<Function>}\r\n\t\t */\r\n\t\tthis._pendingChanges = [];\r\n\r\n\t\t/**\r\n\t\t * The last created and currently used writer instance.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/writer~Writer}\r\n\t\t */\r\n\t\tthis._currentWriter = null;\r\n\r\n\t\t[ 'insertContent', 'deleteContent', 'modifySelection', 'getSelectedContent', 'applyOperation' ]\r\n\t\t\t.forEach( methodName => this.decorate( methodName ) );\r\n\r\n\t\t// Adding operation validation with `highest` priority, so it is called before any other feature would like\r\n\t\t// to do anything with the operation. If the operation has incorrect parameters it should throw on the earliest occasion.\r\n\t\tthis.on( 'applyOperation', ( evt, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\toperation._validate();\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\t// Register some default abstract entities.\r\n\t\tthis.schema.register( '$root', {\r\n\t\t\tisLimit: true\r\n\t\t} );\r\n\t\tthis.schema.register( '$block', {\r\n\t\t\tallowIn: '$root',\r\n\t\t\tisBlock: true\r\n\t\t} );\r\n\t\tthis.schema.register( '$text', {\r\n\t\t\tallowIn: '$block'\r\n\t\t} );\r\n\t\tthis.schema.register( '$clipboardHolder', {\r\n\t\t\tallowContentOf: '$root',\r\n\t\t\tisLimit: true\r\n\t\t} );\r\n\t\tthis.schema.extend( '$text', { allowIn: '$clipboardHolder' } );\r\n\r\n\t\t// Element needed by `upcastElementToMarker` converter.\r\n\t\t// This element temporarily represents marker bound during conversion process and is removed\r\n\t\t// at the end of conversion. `UpcastDispatcher` or at least `Conversion` class looks like a better for this\r\n\t\t// registration but both know nothing about Schema.\r\n\t\tthis.schema.register( '$marker', {\r\n\t\t\tallowIn: [ '$root', '$block' ]\r\n\t\t} );\r\n\r\n\t\tinjectSelectionPostFixer( this );\r\n\t}\r\n\r\n\t/**\r\n\t * The `change()` method is the primary way of changing the model. You should use it to modify all document nodes\r\n\t * (including detached nodes – i.e. nodes not added to the {@link module:engine/model/model~Model#document model document}),\r\n\t * the {@link module:engine/model/document~Document#selection document's selection}, and\r\n\t * {@link module:engine/model/model~Model#markers model markers}.\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\twriter.insertText( 'foo', paragraph, 'end' );\r\n\t *\t\t} );\r\n\t *\r\n\t * All changes inside the change block use the same {@link module:engine/model/batch~Batch} so they are combined\r\n\t * into a single undo step.\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\twriter.insertText( 'foo', paragraph, 'end' ); // foo.\r\n\t *\r\n\t *\t\t\tmodel.change( writer => {\r\n\t *\t\t\t\twriter.insertText( 'bar', paragraph, 'end' ); // foobar.\r\n\t *\t\t\t} );\r\n\t *\r\n\t * \t\t\twriter.insertText( 'bom', paragraph, 'end' ); // foobarbom.\r\n\t *\t\t} );\r\n\t *\r\n\t * The callback of the `change()` block is executed synchronously.\r\n\t *\r\n\t * You can also return a value from the change block.\r\n\t *\r\n\t *\t\tconst img = model.change( writer => {\r\n\t *\t\t\treturn writer.createElement( 'img' );\r\n\t *\t\t} );\r\n\t *\r\n\t * @see #enqueueChange\r\n\t * @param {Function} callback Callback function which may modify the model.\r\n\t * @returns {*} Value returned by the callback.\r\n\t */\r\n\tchange( callback ) {\r\n\t\tif ( this._pendingChanges.length === 0 ) {\r\n\t\t\t// If this is the outermost block, create a new batch and start `_runPendingChanges` execution flow.\r\n\t\t\tthis._pendingChanges.push( { batch: new Batch(), callback } );\r\n\r\n\t\t\treturn this._runPendingChanges()[ 0 ];\r\n\t\t} else {\r\n\t\t\t// If this is not the outermost block, just execute the callback.\r\n\t\t\treturn callback( this._currentWriter );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The `enqueueChange()` method performs similar task as the {@link #change `change()` method}, with two major differences.\r\n\t *\r\n\t * First, the callback of `enqueueChange()` is executed when all other enqueued changes are done. It might be executed\r\n\t * immediately if it is not nested in any other change block, but if it is nested in another (enqueue)change block,\r\n\t * it will be delayed and executed after the outermost block.\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\tconsole.log( 1 );\r\n\t *\r\n\t *\t\t\tmodel.enqueueChange( writer => {\r\n\t *\t\t\t\tconsole.log( 2 );\r\n\t *\t\t\t} );\r\n\t *\r\n\t * \t\t\tconsole.log( 3 );\r\n\t *\t\t} ); // Will log: 1, 3, 2.\r\n\t *\r\n\t * Second, it lets you define the {@link module:engine/model/batch~Batch} into which you want to add your changes.\r\n\t * By default, a new batch is created. In the sample above, `change` and `enqueueChange` blocks use a different\r\n\t * batch (and different {@link module:engine/model/writer~Writer} since each of them operates on the separate batch).\r\n\t *\r\n\t * When using the `enqueueChange()` block you can also add some changes to the batch you used before.\r\n\t *\r\n\t *\t\tmodel.enqueueChange( batch, writer => {\r\n\t *\t\t\twriter.insertText( 'foo', paragraph, 'end' );\r\n\t *\t\t} );\r\n\t *\r\n\t * The batch instance can be obtained from {@link module:engine/model/writer~Writer#batch the writer}.\r\n\t *\r\n\t * @param {module:engine/model/batch~Batch|'transparent'|'default'} batchOrType Batch or batch type should be used in the callback.\r\n\t * If not defined, a new batch will be created.\r\n\t * @param {Function} callback Callback function which may modify the model.\r\n\t */\r\n\tenqueueChange( batchOrType, callback ) {\r\n\t\tif ( typeof batchOrType === 'string' ) {\r\n\t\t\tbatchOrType = new Batch( batchOrType );\r\n\t\t} else if ( typeof batchOrType == 'function' ) {\r\n\t\t\tcallback = batchOrType;\r\n\t\t\tbatchOrType = new Batch();\r\n\t\t}\r\n\r\n\t\tthis._pendingChanges.push( { batch: batchOrType, callback } );\r\n\r\n\t\tif ( this._pendingChanges.length == 1 ) {\r\n\t\t\tthis._runPendingChanges();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:utils/observablemixin~ObservableMixin#decorate Decorated} function for applying\r\n\t * {@link module:engine/model/operation/operation~Operation operations} to the model.\r\n\t *\r\n\t * This is a low-level way of changing the model. It is exposed for very specific use cases (like the undo feature).\r\n\t * Normally, to modify the model, you will want to use {@link module:engine/model/writer~Writer `Writer`}.\r\n\t * See also {@glink framework/guides/architecture/editing-engine#changing-the-model Changing the model} section\r\n\t * of the {@glink framework/guides/architecture/editing-engine Editing architecture} guide.\r\n\t *\r\n\t * @param {module:engine/model/operation/operation~Operation} operation The operation to apply.\r\n\t */\r\n\tapplyOperation( operation ) {\r\n\t\toperation._execute();\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts content at the position in the editor specified by the selection, as one would expect the paste\r\n\t * functionality to work.\r\n\t *\r\n\t * This is a high-level method. It takes the {@link #schema schema} into consideration when inserting\r\n\t * the content, clears the given selection's content before inserting nodes and moves the selection\r\n\t * to its target position at the end of the process.\r\n\t * It can split elements, merge them, wrap bare text nodes with paragraphs, etc. &mdash; just like the\r\n\t * pasting feature should do.\r\n\t *\r\n\t * For lower-level methods see {@link module:engine/model/writer~Writer `Writer`}.\r\n\t *\r\n\t * This method, unlike {@link module:engine/model/writer~Writer `Writer`}'s methods, does not have to be used\r\n\t * inside a {@link #change `change()` block}.\r\n\t *\r\n\t * # Conversion and schema\r\n\t *\r\n\t * Inserting elements and text nodes into the model is not enough to make CKEditor 5 render that content\r\n\t * to the user. CKEditor 5 implements a model-view-controller architecture and what `model.insertContent()` does\r\n\t * is only adding nodes to the model. Additionally, you need to define\r\n\t * {@glink framework/guides/architecture/editing-engine#conversion converters} between the model and view\r\n\t * and define those nodes in the {@glink framework/guides/architecture/editing-engine#schema schema}.\r\n\t *\r\n\t * So, while this method may seem similar to CKEditor 4 `editor.insertHtml()` (in fact, both methods\r\n\t * are used for paste-like content insertion), the CKEditor 5 method cannot be use to insert arbitrary HTML\r\n\t * unless converters are defined for all elements and attributes in that HTML.\r\n\t *\r\n\t * # Examples\r\n\t *\r\n\t * Using `insertContent()` with a manually created model structure:\r\n\t *\r\n\t *\t\t// Let's create a document fragment containing such content as:\r\n\t *\t\t//\r\n\t *\t\t// <paragrap>foo</paragraph>\r\n\t *\t\t// <blockQuote>\r\n\t *\t\t//    <paragraph>bar</paragraph>\r\n\t *\t\t// </blockQuote>\r\n\t *\t\tconst docFrag = editor.model.change( writer => {\r\n\t *\t\t\tconst p1 = writer.createElement( 'paragraph' );\r\n\t *\t\t\tconst p2 = writer.createElement( 'paragraph' );\r\n\t *\t\t\tconst blockQuote = writer.createElement( 'blockQuote' );\r\n\t *\t\t\tconst docFrag = writer.createDocumentFragment();\r\n\t *\r\n\t *\t\t\twriter.append( p1, docFrag );\r\n\t *\t\t\twriter.append( blockQuote, docFrag );\r\n\t *\t\t\twriter.append( p2, blockQuote );\r\n\t *\t\t\twriter.insertText( 'foo', p1 );\r\n\t *\t\t\twriter.insertText( 'bar', p2 );\r\n\t *\r\n\t *\t\t\treturn docFrag;\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// insertContent() does not have to be used in a change() block. It can, though,\r\n\t *\t\t// so this code could be moved to the callback defined above.\r\n\t *\t\teditor.model.insertContent( docFrag );\r\n\t *\r\n\t * Using `insertContent()` with an HTML string converted to a model document fragment (similar to the pasting mechanism):\r\n\t *\r\n\t *\t\t// You can create your own HtmlDataProcessor instance or use editor.data.processor\r\n\t *\t\t// if you have not overridden the default one (which is the HtmlDataProcessor instance).\r\n\t *\t\tconst htmlDP = new HtmlDataProcessor();\r\n\t *\r\n\t *\t\t// Convert an HTML string to a view document fragment:\r\n\t *\t\tconst viewFragment = htmlDP.toView( htmlString );\r\n\t *\r\n\t *\t\t// Convert the view document fragment to a model document fragment\r\n\t *\t\t// in the context of $root. This conversion takes the schema into\r\n\t *\t\t// account so if, for example, the view document fragment contained a bare text node,\r\n\t *\t\t// this text node cannot be a child of $root, so it will be automatically\r\n\t *\t\t// wrapped with a <paragraph>. You can define the context yourself (in the second parameter),\r\n\t *\t\t// and e.g. convert the content like it would happen in a <paragraph>.\r\n\t *\t\t// Note: The clipboard feature uses a custom context called $clipboardHolder\r\n\t *\t\t// which has a loosened schema.\r\n\t *\t\tconst modelFragment = editor.data.toModel( viewFragment );\r\n\t *\r\n\t *\t\teditor.model.insertContent( modelFragment );\r\n\t *\r\n\t * By default this method will use the document selection but it can also be used with a position, range or selection instance.\r\n\t *\r\n\t *\t\t// Insert text at the current document selection position.\r\n\t *\t\teditor.model.change( writer => {\r\n\t *\t\t\teditor.model.insertContent( writer.createText( 'x' ) );\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Insert text at a given position - the document selection will not be modified.\r\n\t *\t\teditor.model.change( writer => {\r\n\t *\t\t\teditor.model.insertContent( writer.createText( 'x' ), doc.getRoot(), 2 );\r\n\t *\r\n\t *\t\t\t// Which is a shorthand for:\r\n\t *\t\t\teditor.model.insertContent( writer.createText( 'x' ), writer.createPositionAt( doc.getRoot(), 2 ) );\r\n\t *\t\t} );\r\n\t *\r\n\t * If an instance of {@link module:engine/model/selection~Selection} is passed as `selectable`\r\n\t * it will be moved to the target position (where the document selection should be moved after the insertion).\r\n\t *\r\n\t *\t\teditor.model.change( writer => {\r\n\t *\t\t\t// Insert text replacing the given selection instance.\r\n\t *\t\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t\teditor.model.insertContent( writer.createText( 'x' ), selection );\r\n\t *\r\n\t *\t\t\t// insertContent() modifies the passed selection instance so it can be used to set the document selection.\r\n\t *\t\t\t// Note: This is not necessary when you passed the document selection to insertContent().\r\n\t *\t\t\twriter.setSelection( selection );\r\n\t *\t\t} );\r\n\t *\r\n\t * @fires insertContent\r\n\t * @param {module:engine/model/documentfragment~DocumentFragment|module:engine/model/item~Item} content The content to insert.\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/item~Item|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} [selectable=model.document.selection]\r\n\t * The selection into which the content should be inserted. If not provided the current model document selection will be used.\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] To be used when a model item was passed as `selectable`.\r\n\t * This param defines a position in relation to that item.\r\n\t */\r\n\tinsertContent( content, selectable, placeOrOffset ) {\r\n\t\tinsertContent( this, content, selectable, placeOrOffset );\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes content of the selection and merge siblings. The resulting selection is always collapsed.\r\n\t *\r\n\t * **Note:** For the sake of predictability, the resulting selection should always be collapsed.\r\n\t * In cases where a feature wants to modify deleting behavior so selection isn't collapsed\r\n\t * (e.g. a table feature may want to keep row selection after pressing <kbd>Backspace</kbd>),\r\n\t * then that behavior should be implemented in the view's listener. At the same time, the table feature\r\n\t * will need to modify this method's behavior too, e.g. to \"delete contents and then collapse\r\n\t * the selection inside the last selected cell\" or \"delete the row and collapse selection somewhere near\".\r\n\t * That needs to be done in order to ensure that other features which use `deleteContent()` will work well with tables.\r\n\t *\r\n\t * @fires deleteContent\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n\t * Selection of which the content should be deleted.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.leaveUnmerged=false] Whether to merge elements after removing the content of the selection.\r\n\t *\r\n\t * For example `<heading1>x[x</heading1><paragraph>y]y</paragraph>` will become:\r\n\t *\r\n\t * * `<heading1>x^y</heading1>` with the option disabled (`leaveUnmerged == false`)\r\n\t * * `<heading1>x^</heading1><paragraph>y</paragraph>` with enabled (`leaveUnmerged == true`).\r\n\t *\r\n\t * Note: {@link module:engine/model/schema~Schema#isObject object} and {@link module:engine/model/schema~Schema#isLimit limit}\r\n\t * elements will not be merged.\r\n\t *\r\n\t * @param {Boolean} [options.doNotResetEntireContent=false] Whether to skip replacing the entire content with a\r\n\t * paragraph when the entire content was selected.\r\n\t *\r\n\t * For example `<heading1>[x</heading1><paragraph>y]</paragraph>` will become:\r\n\t *\r\n\t * * `<paragraph>^</paragraph>` with the option disabled (`doNotResetEntireContent == false`)\r\n\t * * `<heading1>^</heading1>` with enabled (`doNotResetEntireContent == true`)\r\n\t */\r\n\tdeleteContent( selection, options ) {\r\n\t\tdeleteContent( this, selection, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Modifies the selection. Currently, the supported modifications are:\r\n\t *\r\n\t * * Extending. The selection focus is moved in the specified `options.direction` with a step specified in `options.unit`.\r\n\t * Possible values for `unit` are:\r\n\t *  * `'character'` (default) - moves selection by one user-perceived character. In most cases this means moving by one\r\n\t *  character in `String` sense. However, unicode also defines \"combing marks\". These are special symbols, that combines\r\n\t *  with a symbol before it (\"base character\") to create one user-perceived character. For example, `q̣̇` is a normal\r\n\t *  letter `q` with two \"combining marks\": upper dot (`Ux0307`) and lower dot (`Ux0323`). For most actions, i.e. extending\r\n\t *  selection by one position, it is correct to include both \"base character\" and all of it's \"combining marks\". That is\r\n\t *  why `'character'` value is most natural and common method of modifying selection.\r\n\t *  * `'codePoint'` - moves selection by one unicode code point. In contrary to, `'character'` unit, this will insert\r\n\t *  selection between \"base character\" and \"combining mark\", because \"combining marks\" have their own unicode code points.\r\n\t *  However, for technical reasons, unicode code points with values above `UxFFFF` are represented in native `String` by\r\n\t *  two characters, called \"surrogate pairs\". Halves of \"surrogate pairs\" have a meaning only when placed next to each other.\r\n\t *  For example `𨭎` is represented in `String` by `\\uD862\\uDF4E`. Both `\\uD862` and `\\uDF4E` do not have any meaning\r\n\t *  outside the pair (are rendered as ? when alone). Position between them would be incorrect. In this case, selection\r\n\t *  extension will include whole \"surrogate pair\".\r\n\t *  * `'word'` - moves selection by a whole word.\r\n\t *\r\n\t * **Note:** if you extend a forward selection in a backward direction you will in fact shrink it.\r\n\t *\r\n\t * @fires modifySelection\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n\t * The selection to modify.\r\n\t * @param {Object} [options]\r\n\t * @param {'forward'|'backward'} [options.direction='forward'] The direction in which the selection should be modified.\r\n\t * @param {'character'|'codePoint'|'word'} [options.unit='character'] The unit by which selection should be modified.\r\n\t */\r\n\tmodifySelection( selection, options ) {\r\n\t\tmodifySelection( this, selection, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a clone of the selected content.\r\n\t *\r\n\t * For example, for the following selection:\r\n\t *\r\n\t * ```html\r\n\t * <paragraph>x</paragraph>\r\n\t * <blockQuote>\r\n\t *\t<paragraph>y</paragraph>\r\n\t *\t<heading1>fir[st</heading1>\r\n\t * </blockQuote>\r\n\t * <paragraph>se]cond</paragraph>\r\n\t * <paragraph>z</paragraph>\r\n\t * ```\r\n\t *\r\n\t * It will return a document fragment with such a content:\r\n\t *\r\n\t * ```html\r\n\t * <blockQuote>\r\n\t *\t<heading1>st</heading1>\r\n\t * </blockQuote>\r\n\t * <paragraph>se</paragraph>\r\n\t * ```\r\n\t *\r\n\t * @fires getSelectedContent\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n\t * The selection of which content will be returned.\r\n\t * @returns {module:engine/model/documentfragment~DocumentFragment}\r\n\t */\r\n\tgetSelectedContent( selection ) {\r\n\t\treturn getSelectedContent( this, selection );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given {@link module:engine/model/range~Range range} or\r\n\t * {@link module:engine/model/element~Element element}\r\n\t * has any content.\r\n\t *\r\n\t * Content is any text node or element which is registered in the {@link module:engine/model/schema~Schema schema}.\r\n\t *\r\n\t * @param {module:engine/model/range~Range|module:engine/model/element~Element} rangeOrElement Range or element to check.\r\n\t * @returns {Boolean}\r\n\t */\r\n\thasContent( rangeOrElement ) {\r\n\t\tif ( rangeOrElement instanceof ModelElement ) {\r\n\t\t\trangeOrElement = ModelRange._createIn( rangeOrElement );\r\n\t\t}\r\n\r\n\t\tif ( rangeOrElement.isCollapsed ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor ( const item of rangeOrElement.getItems() ) {\r\n\t\t\t// Remember, `TreeWalker` returns always `textProxy` nodes.\r\n\t\t\tif ( item.is( 'textProxy' ) || this.schema.isObject( item ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a position from the given root and path in that root.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createPositionFromPath `Writer#createPositionFromPath()`}.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment} root Root of the position.\r\n\t * @param {Array.<Number>} path Position path. See {@link module:engine/model/position~Position#path}.\r\n\t * @param {module:engine/model/position~PositionStickiness} [stickiness='toNone'] Position stickiness.\r\n\t * See {@link module:engine/model/position~PositionStickiness}.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionFromPath( root, path, stickiness ) {\r\n\t\treturn new ModelPosition( root, path, stickiness );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/model/position~Position position},\r\n\t * * a parent element and offset in that element,\r\n\t * * a parent element and `'end'` (the position will be set at the end of that element),\r\n\t * * a {@link module:engine/model/item~Item model item} and `'before'` or `'after'`\r\n\t * (the position will be set before or after the given model item).\r\n\t *\r\n\t * This method is a shortcut to other factory methods such as:\r\n\t *\r\n\t * * {@link module:engine/model/model~Model#createPositionBefore `createPositionBefore()`},\r\n\t * * {@link module:engine/model/model~Model#createPositionAfter `createPositionAfter()`}.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createPositionAt `Writer#createPositionAt()`},\r\n\t *\r\n\t * @param {module:engine/model/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/model/item~Item model item}.\r\n\t */\r\n\tcreatePositionAt( itemOrPosition, offset ) {\r\n\t\treturn ModelPosition._createAt( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position after the given {@link module:engine/model/item~Item model item}.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createPositionAfter `Writer#createPositionAfter()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item after which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionAfter( item ) {\r\n\t\treturn ModelPosition._createAfter( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position before the given {@link module:engine/model/item~Item model item}.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createPositionBefore `Writer#createPositionBefore()`}.\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item Item before which the position should be placed.\r\n\t * @returns {module:engine/model/position~Position}\r\n\t */\r\n\tcreatePositionBefore( item ) {\r\n\t\treturn ModelPosition._createBefore( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range spanning from the `start` position to the `end` position.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createRange `Writer#createRange()`}:\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\tconst range = writer.createRange( start, end );\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {module:engine/model/position~Position} start Start position.\r\n\t * @param {module:engine/model/position~Position} [end] End position. If not set, the range will be collapsed\r\n\t * to the `start` position.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRange( start, end ) {\r\n\t\treturn new ModelRange( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside the given element which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createRangeIn `Writer#createRangeIn()`}:\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\tconst range = writer.createRangeIn( paragraph );\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {module:engine/model/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRangeIn( element ) {\r\n\t\treturn ModelRange._createIn( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before the given {@link module:engine/model/item~Item model item} and ends after it.\r\n\t *\r\n\t * Note: This method is also available on `writer` instance as\r\n\t * {@link module:engine/model/writer~Writer#createRangeOn `Writer.createRangeOn()`}:\r\n\t *\r\n\t *\t\tmodel.change( writer => {\r\n\t *\t\t\tconst range = writer.createRangeOn( paragraph );\r\n\t *\t\t} );\r\n\t *\r\n\t * @param {module:engine/model/item~Item} item\r\n\t * @returns {module:engine/model/range~Range}\r\n\t */\r\n\tcreateRangeOn( item ) {\r\n\t\treturn ModelRange._createOn( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new selection instance based on:\r\n\t *\r\n\t * * the given {@link module:engine/model/selection~Selection selection},\r\n\t * * or based on the given {@link module:engine/model/range~Range range},\r\n\t * * or based on the given iterable collection of {@link module:engine/model/range~Range ranges}\r\n\t * * or at the given {@link module:engine/model/position~Position position},\r\n\t * * or on the given {@link module:engine/model/element~Element element},\r\n\t * * or creates an empty selection if no arguments were passed.\r\n\t *\r\n\t * Note: This method is also available as\r\n\t * {@link module:engine/model/writer~Writer#createSelection `Writer#createSelection()`}.\r\n\t *\r\n\t *\t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = writer.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = writer.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t *\t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = writer.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = writer.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the given document selection.\r\n\t *\t\t// Note: It doesn't copies selection attributes.\r\n\t *\t\tconst documentSelection = model.document.selection;\r\n\t *\t\tconst selection = writer.createSelection( documentSelection );\r\n\t *\r\n\t *\t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = writer.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates selection at the given offset in the given element.\r\n\t *\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/model/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/model/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\r\n\t *\r\n\t *\t\t// Additional options (`'backward'`) can be specified as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection|\r\n\t * module:engine/model/position~Position|module:engine/model/element~Element|\r\n\t * Iterable.<module:engine/model/range~Range>|module:engine/model/range~Range|null} selectable\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @returns {module:engine/model/selection~Selection}\r\n\t */\r\n\tcreateSelection( selectable, placeOrOffset, options ) {\r\n\t\treturn new ModelSelection( selectable, placeOrOffset, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:engine/model/batch~Batch} instance.\r\n\t *\r\n\t * **Note:** In most cases creating a batch instance is not necessary as they are created when using:\r\n\t *\r\n\t * * {@link #change `change()`},\r\n\t * * {@link #enqueueChange `enqueueChange()`}.\r\n\t *\r\n\t * @returns {module:engine/model/batch~Batch}\r\n\t */\r\n\tcreateBatch() {\r\n\t\treturn new Batch();\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all events listeners set by model instance and destroys {@link module:engine/model/document~Document}.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.document.destroy();\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Common part of {@link module:engine/model/model~Model#change} and {@link module:engine/model/model~Model#enqueueChange}\r\n\t * which calls callbacks and returns array of values returned by these callbacks.\r\n\t *\r\n\t * @private\r\n\t * @returns {Array.<*>} Array of values returned by callbacks.\r\n\t */\r\n\t_runPendingChanges() {\r\n\t\tconst ret = [];\r\n\r\n\t\tthis.fire( '_beforeChanges' );\r\n\r\n\t\twhile ( this._pendingChanges.length ) {\r\n\t\t\t// Create a new writer using batch instance created for this chain of changes.\r\n\t\t\tconst currentBatch = this._pendingChanges[ 0 ].batch;\r\n\t\t\tthis._currentWriter = new Writer( this, currentBatch );\r\n\r\n\t\t\t// Execute changes callback and gather the returned value.\r\n\t\t\tconst callbackReturnValue = this._pendingChanges[ 0 ].callback( this._currentWriter );\r\n\t\t\tret.push( callbackReturnValue );\r\n\r\n\t\t\t// Fire internal `_change` event.\r\n\t\t\tthis.fire( '_change', this._currentWriter );\r\n\r\n\t\t\tthis._pendingChanges.shift();\r\n\t\t\tthis._currentWriter = null;\r\n\t\t}\r\n\r\n\t\tthis.fire( '_afterChanges' );\r\n\r\n\t\treturn ret;\r\n\t}\r\n\r\n\t/**\r\n\t * Fired after leaving each {@link module:engine/model/model~Model#enqueueChange} block or outermost\r\n\t * {@link module:engine/model/model~Model#change} block.\r\n\t *\r\n\t * **Note:** This is an internal event! Use {@link module:engine/model/document~Document#event:change} instead.\r\n\t *\r\n\t * @protected\r\n\t * @event _change\r\n\t * @param {module:engine/model/writer~Writer} writer `Writer` instance that has been used in the change block.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when entering the outermost {@link module:engine/model/model~Model#enqueueChange} or\r\n\t * {@link module:engine/model/model~Model#change} block.\r\n\t *\r\n\t * @protected\r\n\t * @event _beforeChanges\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when leaving the outermost {@link module:engine/model/model~Model#enqueueChange} or\r\n\t * {@link module:engine/model/model~Model#change} block.\r\n\t *\r\n\t * @protected\r\n\t * @event _afterChanges\r\n\t */\r\n\r\n\t/**\r\n\t * Fired every time any {@link module:engine/model/operation/operation~Operation operation} is applied on the model\r\n\t * using {@link #applyOperation}.\r\n\t *\r\n\t * Note that this event is suitable only for very specific use-cases. Use it if you need to listen to every single operation\r\n\t * applied on the document. However, in most cases {@link module:engine/model/document~Document#event:change} should\r\n\t * be used.\r\n\t *\r\n\t * A few callbacks are already added to this event by engine internal classes:\r\n\t *\r\n\t * * with `highest` priority operation is validated,\r\n\t * * with `normal` priority operation is executed,\r\n\t * * with `low` priority the {@link module:engine/model/document~Document} updates its version,\r\n\t * * with `low` priority {@link module:engine/model/liveposition~LivePosition} and {@link module:engine/model/liverange~LiveRange}\r\n\t * update themselves.\r\n\t *\r\n\t * @event applyOperation\r\n\t * @param {Array} args Arguments of the `applyOperation` which is an array with a single element - applied\r\n\t * {@link module:engine/model/operation/operation~Operation operation}.\r\n\t */\r\n\r\n\t/**\r\n\t * Event fired when {@link #insertContent} method is called.\r\n\t *\r\n\t * The {@link #insertContent default action of that method} is implemented as a\r\n\t * listener to this event so it can be fully customized by the features.\r\n\t *\r\n\t * **Note** The `selectable` parameter for the {@link #insertContent} is optional. When `undefined` value is passed the method uses\r\n\t * `model.document.selection`.\r\n\t *\r\n\t * @event insertContent\r\n\t * @param {Array} args The arguments passed to the original method.\r\n\t */\r\n\r\n\t/**\r\n\t * Event fired when {@link #deleteContent} method is called.\r\n\t *\r\n\t * The {@link #deleteContent default action of that method} is implemented as a\r\n\t * listener to this event so it can be fully customized by the features.\r\n\t *\r\n\t * @event deleteContent\r\n\t * @param {Array} args The arguments passed to the original method.\r\n\t */\r\n\r\n\t/**\r\n\t * Event fired when {@link #modifySelection} method is called.\r\n\t *\r\n\t * The {@link #modifySelection default action of that method} is implemented as a\r\n\t * listener to this event so it can be fully customized by the features.\r\n\t *\r\n\t * @event modifySelection\r\n\t * @param {Array} args The arguments passed to the original method.\r\n\t */\r\n\r\n\t/**\r\n\t * Event fired when {@link #getSelectedContent} method is called.\r\n\t *\r\n\t * The {@link #getSelectedContent default action of that method} is implemented as a\r\n\t * listener to this event so it can be fully customized by the features.\r\n\t *\r\n\t * @event getSelectedContent\r\n\t * @param {Array} args The arguments passed to the original method.\r\n\t */\r\n}\r\n\r\nmix( Model, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/keystrokehandler\r\n */\r\n\r\nimport DomEmitterMixin from './dom/emittermixin';\r\nimport { getCode, parseKeystroke } from './keyboard';\r\n\r\n/**\r\n * Keystroke handler allows registering callbacks for given keystrokes.\r\n *\r\n * The most frequent use of this class is through the {@link module:core/editor/editor~Editor#keystrokes `editor.keystrokes`}\r\n * property. It allows listening to keystrokes executed in the editing view:\r\n *\r\n *\t\teditor.keystrokes.set( 'Ctrl+A', ( keyEvtData, cancel ) => {\r\n *\t\t\tconsole.log( 'Ctrl+A has been pressed' );\r\n *\t\t\tcancel();\r\n *\t\t} );\r\n *\r\n * However, this utility class can be used in various part of the UI. For instance, a certain {@link module:ui/view~View}\r\n * can use it like this:\r\n *\r\n *\t\tclass MyView extends View {\r\n *\t\t\tconstructor() {\r\n *\t\t\t\tthis.keystrokes = new KeystrokeHandler();\r\n *\r\n * \t\t\t\tthis.keystrokes.set( 'tab', handleTabKey );\r\n *\t\t\t}\r\n *\r\n *\t\t\trender() {\r\n *\t\t\t\tsuper.render();\r\n *\r\n *\t\t\t\tthis.keystrokes.listenTo( this.element );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n * That keystroke handler will listen to `keydown` events fired in this view's main element.\r\n *\r\n */\r\nexport default class KeystrokeHandler {\r\n\t/**\r\n\t * Creates an instance of the keystroke handler.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Listener used to listen to events for easier keystroke handler destruction.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:utils/dom/emittermixin~Emitter}\r\n\t\t */\r\n\t\tthis._listener = Object.create( DomEmitterMixin );\r\n\t}\r\n\r\n\t/**\r\n\t * Starts listening for `keydown` events from a given emitter.\r\n\t *\r\n\t * @param {module:utils/emittermixin~Emitter} emitter\r\n\t */\r\n\tlistenTo( emitter ) {\r\n\t\t// The #_listener works here as a kind of dispatcher. It groups the events coming from the same\r\n\t\t// keystroke so the listeners can be attached to them with different priorities.\r\n\t\t//\r\n\t\t// E.g. all the keystrokes with the `keyCode` of 42 coming from the `emitter` are propagated\r\n\t\t// as a `_keydown:42` event by the `_listener`. If there's a callback created by the `set`\r\n\t\t// method for this 42 keystroke, it listens to the `_listener#_keydown:42` event only and interacts\r\n\t\t// only with other listeners of this particular event, thus making it possible to prioritize\r\n\t\t// the listeners and safely cancel execution, when needed. Instead of duplicating the Emitter logic,\r\n\t\t// the KeystrokeHandler re–uses it to do its job.\r\n\t\tthis._listener.listenTo( emitter, 'keydown', ( evt, keyEvtData ) => {\r\n\t\t\tthis._listener.fire( '_keydown:' + getCode( keyEvtData ), keyEvtData );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a handler for the specified keystroke.\r\n\t *\r\n\t * @param {String|Array.<String|Number>} keystroke Keystroke defined in a format accepted by\r\n\t * the {@link module:utils/keyboard~parseKeystroke} function.\r\n\t * @param {Function} callback A function called with the\r\n\t * {@link module:engine/view/observer/keyobserver~KeyEventData key event data} object and\r\n\t * a helper funcion to call both `preventDefault()` and `stopPropagation()` on the underlying event.\r\n\t * @param {Object} [options={}] Additional options.\r\n\t * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of the keystroke\r\n\t * callback. The higher the priority value the sooner the callback will be executed. Keystrokes having the same priority\r\n\t * are called in the order they were added.\r\n\t */\r\n\tset( keystroke, callback, options = {} ) {\r\n\t\tconst keyCode = parseKeystroke( keystroke );\r\n\t\tconst priority = options.priority;\r\n\r\n\t\t// Execute the passed callback on KeystrokeHandler#_keydown.\r\n\t\t// TODO: https://github.com/ckeditor/ckeditor5-utils/issues/144\r\n\t\tthis._listener.listenTo( this._listener, '_keydown:' + keyCode, ( evt, keyEvtData ) => {\r\n\t\t\tcallback( keyEvtData, () => {\r\n\t\t\t\t// Stop the event in the DOM: no listener in the web page\r\n\t\t\t\t// will be triggered by this event.\r\n\t\t\t\tkeyEvtData.preventDefault();\r\n\t\t\t\tkeyEvtData.stopPropagation();\r\n\r\n\t\t\t\t// Stop the event in the KeystrokeHandler: no more callbacks\r\n\t\t\t\t// will be executed for this keystroke.\r\n\t\t\t\tevt.stop();\r\n\t\t\t} );\r\n\r\n\t\t\t// Mark this keystroke as handled by the callback. See: #press.\r\n\t\t\tevt.return = true;\r\n\t\t}, { priority } );\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers a keystroke handler for a specified key combination, if such a keystroke was {@link #set defined}.\r\n\t *\r\n\t * @param {module:engine/view/observer/keyobserver~KeyEventData} keyEvtData Key event data.\r\n\t * @returns {Boolean} Whether the keystroke was handled.\r\n\t */\r\n\tpress( keyEvtData ) {\r\n\t\treturn !!this._listener.fire( '_keydown:' + getCode( keyEvtData ), keyEvtData );\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the keystroke handler.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._listener.stopListening();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/editingkeystrokehandler\r\n */\r\n\r\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\r\n\r\n/**\r\n * A keystroke handler for editor editing. Its instance is available\r\n * in {@link module:core/editor/editor~Editor#keystrokes} so plugins\r\n * can register their keystrokes.\r\n *\r\n * E.g. an undo plugin would do this:\r\n *\r\n *\t\teditor.keystrokes.set( 'Ctrl+Z', 'undo' );\r\n *\t\teditor.keystrokes.set( 'Ctrl+Shift+Z', 'redo' );\r\n *\t\teditor.keystrokes.set( 'Ctrl+Y', 'redo' );\r\n *\r\n * @extends utils/keystrokehandler~KeystrokeHandler\r\n */\r\nexport default class EditingKeystrokeHandler extends KeystrokeHandler {\r\n\t/**\r\n\t * Creates an instance of the keystroke handler.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\tsuper();\r\n\r\n\t\t/**\r\n\t\t * The editor instance.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor}\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a handler for the specified keystroke.\r\n\t *\r\n\t * The handler can be specified as a command name or a callback.\r\n\t *\r\n\t * @param {String|Array.<String|Number>} keystroke Keystroke defined in a format accepted by\r\n\t * the {@link module:utils/keyboard~parseKeystroke} function.\r\n\t * @param {Function|String} callback If a string is passed, then the keystroke will\r\n\t * {@link module:core/editor/editor~Editor#execute execute a command}.\r\n\t * If a function, then it will be called with the\r\n\t * {@link module:engine/view/observer/keyobserver~KeyEventData key event data} object and\r\n\t * a `cancel()` helper to both `preventDefault()` and `stopPropagation()` of the event.\r\n\t * @param {Object} [options={}] Additional options.\r\n\t * @param {module:utils/priorities~PriorityString|Number} [options.priority='normal'] The priority of the keystroke\r\n\t * callback. The higher the priority value the sooner the callback will be executed. Keystrokes having the same priority\r\n\t * are called in the order they were added.\r\n\t */\r\n\tset( keystroke, callback, options = {} ) {\r\n\t\tif ( typeof callback == 'string' ) {\r\n\t\t\tconst commandName = callback;\r\n\r\n\t\t\tcallback = ( evtData, cancel ) => {\r\n\t\t\t\tthis.editor.execute( commandName );\r\n\t\t\t\tcancel();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tsuper.set( keystroke, callback, options );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/editor/editor\r\n */\r\n\r\nimport Config from '@ckeditor/ckeditor5-utils/src/config';\r\nimport EditingController from '@ckeditor/ckeditor5-engine/src/controller/editingcontroller';\r\nimport PluginCollection from '../plugincollection';\r\nimport CommandCollection from '../commandcollection';\r\nimport Locale from '@ckeditor/ckeditor5-utils/src/locale';\r\nimport DataController from '@ckeditor/ckeditor5-engine/src/controller/datacontroller';\r\nimport Conversion from '@ckeditor/ckeditor5-engine/src/conversion/conversion';\r\nimport Model from '@ckeditor/ckeditor5-engine/src/model/model';\r\nimport EditingKeystrokeHandler from '../editingkeystrokehandler';\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\nimport '@ckeditor/ckeditor5-utils/src/version';\r\n\r\n/**\r\n * Class representing a basic, generic editor.\r\n *\r\n * Check out the list of its subclasses to learn about specific editor implementations.\r\n *\r\n * All editor implementations (like {@link module:editor-classic/classiceditor~ClassicEditor} or\r\n * {@link module:editor-inline/inlineeditor~InlineEditor}) should extend this class. They can add their\r\n * own methods and properties.\r\n *\r\n * When you are implementing a plugin, then this editor represents the API\r\n * which your plugin can expect to get when using its {@link module:core/plugin~Plugin#editor} property.\r\n *\r\n * This API should be sufficient in order to implement the \"editing\" part of your feature\r\n * (schema definition, conversion, commands, keystrokes, etc.).\r\n * It does not define the editor UI, which is available only if the\r\n * the specific editor implements also the {@link module:core/editor/editorwithui~EditorWithUI} interface\r\n * (as most editor implementations do).\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Editor {\r\n\t/**\r\n\t * Creates a new instance of the Editor class.\r\n\t *\r\n\t * Usually, not to be used directly. See the static {@link module:core/editor/editor~Editor.create `create()`} method.\r\n\t *\r\n\t * @param {Object} [config] The editor config.\r\n\t */\r\n\tconstructor( config ) {\r\n\t\tconst availablePlugins = this.constructor.builtinPlugins;\r\n\r\n\t\t/**\r\n\t\t * Holds all configurations specific to this editor instance.\r\n\t\t *\r\n\t\t *\t\teditor.config.get( 'image.toolbar' );\r\n\t\t *\t\t// -> [ 'imageStyle:full', 'imageStyle:side', '|', 'imageTextAlternative' ]\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/config~Config}\r\n\t\t */\r\n\t\tthis.config = new Config( config, this.constructor.defaultConfig );\r\n\r\n\t\tthis.config.define( 'plugins', availablePlugins );\r\n\r\n\t\t/**\r\n\t\t * The plugins loaded and in use by this editor instance.\r\n\t\t *\r\n\t\t *\t\teditor.plugins.get( 'Clipboard' ); // -> instance of the Clipboard plugin.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/plugincollection~PluginCollection}\r\n\t\t */\r\n\t\tthis.plugins = new PluginCollection( this, availablePlugins );\r\n\r\n\t\t/**\r\n\t\t * Commands registered to the editor.\r\n\t\t *\r\n\t\t * Use the shorthand {@link #execute `editor.execute()`} method to execute commands:\r\n\t\t *\r\n\t\t *\t\t// Execute the bold command:\r\n\t\t *\t\teditor.execute( 'bold' );\r\n\t\t *\r\n\t\t *\t\t// Check the state of the bold command:\r\n\t\t *\t\teditor.commands.get( 'bold' ).value;\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/commandcollection~CommandCollection}\r\n\t\t */\r\n\t\tthis.commands = new CommandCollection();\r\n\r\n\t\t/**\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/locale~Locale}\r\n\t\t */\r\n\t\tthis.locale = new Locale( this.config.get( 'language' ) );\r\n\r\n\t\t/**\r\n\t\t * Shorthand for {@link module:utils/locale~Locale#t}.\r\n\t\t *\r\n\t\t * @see module:utils/locale~Locale#t\r\n\t\t * @method #t\r\n\t\t */\r\n\t\tthis.t = this.locale.t;\r\n\r\n\t\t/**\r\n\t\t * Indicates the editor life-cycle state.\r\n\t\t *\r\n\t\t * The editor is in one of the following states:\r\n\t\t *\r\n\t\t * * `initializing` - during the editor initialization (before {@link module:core/editor/editor~Editor.create `Editor.create()`})\r\n\t\t * finished its job,\r\n\t\t * * `ready` - after the promise returned by the {@link module:core/editor/editor~Editor.create `Editor.create()`}\r\n\t\t * method is resolved,\r\n\t\t * * `destroyed` - once the {@link #destroy `editor.destroy()`} method was called.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {'initializing'|'ready'|'destroyed'} #state\r\n\t\t */\r\n\t\tthis.set( 'state', 'initializing' );\r\n\t\tthis.once( 'ready', () => ( this.state = 'ready' ), { priority: 'high' } );\r\n\t\tthis.once( 'destroy', () => ( this.state = 'destroyed' ), { priority: 'high' } );\r\n\r\n\t\t/**\r\n\t\t * Defines whether this editor is in read-only mode.\r\n\t\t *\r\n\t\t * In read-only mode the editor {@link #commands commands} are disabled so it is not possible\r\n\t\t * to modify the document by using them. Also, the editable element(s) become non-editable.\r\n\t\t *\r\n\t\t * In order to make the editor read-only, you can set this value directly:\r\n\t\t *\r\n\t\t *\t\teditor.isReadOnly = true;\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * The editor's model.\r\n\t\t *\r\n\t\t * The central point of the editor's abstract data model.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model}\r\n\t\t */\r\n\t\tthis.model = new Model();\r\n\r\n\t\t/**\r\n\t\t * The {@link module:engine/controller/datacontroller~DataController data controller}.\r\n\t\t * Used e.g. for setting and retrieving editor data.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/controller/datacontroller~DataController}\r\n\t\t */\r\n\t\tthis.data = new DataController( this.model );\r\n\r\n\t\t/**\r\n\t\t * The {@link module:engine/controller/editingcontroller~EditingController editing controller}.\r\n\t\t * Controls user input and rendering the content for editing.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/controller/editingcontroller~EditingController}\r\n\t\t */\r\n\t\tthis.editing = new EditingController( this.model );\r\n\t\tthis.editing.view.document.bind( 'isReadOnly' ).to( this );\r\n\r\n\t\t/**\r\n\t\t * Conversion manager through which you can register model to view and view to model converters.\r\n\t\t *\r\n\t\t * See {@link module:engine/conversion/conversion~Conversion}'s documentation to learn how to add converters.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/conversion/conversion~Conversion}\r\n\t\t */\r\n\t\tthis.conversion = new Conversion();\r\n\r\n\t\tthis.conversion.register( 'downcast', [ this.editing.downcastDispatcher, this.data.downcastDispatcher ] );\r\n\t\tthis.conversion.register( 'editingDowncast', [ this.editing.downcastDispatcher ] );\r\n\t\tthis.conversion.register( 'dataDowncast', [ this.data.downcastDispatcher ] );\r\n\r\n\t\tthis.conversion.register( 'upcast', [ this.data.upcastDispatcher ] );\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:core/editingkeystrokehandler~EditingKeystrokeHandler}.\r\n\t\t *\r\n\t\t * It allows setting simple keystrokes:\r\n\t\t *\r\n\t\t *\t\t// Execute the bold command on Ctrl+E:\r\n\t\t *\t\teditor.keystrokes.set( 'Ctrl+E', 'bold' );\r\n\t\t *\r\n\t\t *\t\t// Execute your own callback:\r\n\t\t *\t\teditor.keystrokes.set( 'Ctrl+E', ( data, cancel ) => {\r\n\t\t *\t\t\tconsole.log( data.keyCode );\r\n\t\t *\r\n\t\t *\t\t\t// Prevent default (native) action and stop the underlying keydown event\r\n\t\t *\t\t\t// so no other editor feature will interfere.\r\n\t\t *\t\t\tcancel();\r\n\t\t *\t\t} );\r\n\t\t *\r\n\t\t * Note: Certain, typing oriented keystrokes (like <kbd>Backspace</kbd> or <kbd>Enter</kbd>) are handled\r\n\t\t * by low level mechanism and trying to listen to them via the keystroke handler will not work reliably.\r\n\t\t * To handle those specific keystrokes see the events fired by the\r\n\t\t * {@link module:engine/view/document~Document editing view document} (`editor.editing.view.document`).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editingkeystrokehandler~EditingKeystrokeHandler}\r\n\t\t */\r\n\t\tthis.keystrokes = new EditingKeystrokeHandler( this );\r\n\t\tthis.keystrokes.listenTo( this.editing.view.document );\r\n\t}\r\n\r\n\t/**\r\n\t * Loads and initializes plugins specified in the config.\r\n\t *\r\n\t * @returns {Promise} A promise which resolves once the initialization is completed.\r\n\t */\r\n\tinitPlugins() {\r\n\t\tconst that = this;\r\n\t\tconst config = this.config;\r\n\r\n\t\treturn loadPlugins()\r\n\t\t\t.then( loadedPlugins => {\r\n\t\t\t\treturn initPlugins( loadedPlugins, 'init' )\r\n\t\t\t\t\t.then( () => initPlugins( loadedPlugins, 'afterInit' ) );\r\n\t\t\t} )\r\n\t\t\t.then( () => this.fire( 'pluginsReady' ) );\r\n\r\n\t\tfunction loadPlugins() {\r\n\t\t\tconst plugins = config.get( 'plugins' ) || [];\r\n\t\t\tconst removePlugins = config.get( 'removePlugins' ) || [];\r\n\t\t\tconst extraPlugins = config.get( 'extraPlugins' ) || [];\r\n\r\n\t\t\treturn that.plugins.load( plugins.concat( extraPlugins ), removePlugins );\r\n\t\t}\r\n\r\n\t\tfunction initPlugins( loadedPlugins, method ) {\r\n\t\t\treturn loadedPlugins.reduce( ( promise, plugin ) => {\r\n\t\t\t\tif ( !plugin[ method ] ) {\r\n\t\t\t\t\treturn promise;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn promise.then( plugin[ method ].bind( plugin ) );\r\n\t\t\t}, Promise.resolve() );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the editor instance, releasing all resources used by it.\r\n\t *\r\n\t * **Note** The editor cannot be destroyed during the initialization phase so if it is called\r\n\t * while the editor {@link #state is being initialized}, it will wait for the editor initialization before destroying it.\r\n\t *\r\n\t * @fires destroy\r\n\t * @returns {Promise} A promise that resolves once the editor instance is fully destroyed.\r\n\t */\r\n\tdestroy() {\r\n\t\tlet readyPromise = Promise.resolve();\r\n\r\n\t\tif ( this.state == 'initializing' ) {\r\n\t\t\treadyPromise = new Promise( resolve => this.once( 'ready', resolve ) );\r\n\t\t}\r\n\r\n\t\treturn readyPromise\r\n\t\t\t.then( () => {\r\n\t\t\t\tthis.fire( 'destroy' );\r\n\t\t\t\tthis.stopListening();\r\n\t\t\t\tthis.commands.destroy();\r\n\t\t\t} )\r\n\t\t\t.then( () => this.plugins.destroy() )\r\n\t\t\t.then( () => {\r\n\t\t\t\tthis.model.destroy();\r\n\t\t\t\tthis.data.destroy();\r\n\t\t\t\tthis.editing.destroy();\r\n\t\t\t\tthis.keystrokes.destroy();\r\n\t\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes specified command with given parameters.\r\n\t *\r\n\t * Shorthand for:\r\n\t *\r\n\t *\t\teditor.commands.get( commandName ).execute( ... );\r\n\t *\r\n\t * @param {String} commandName Name of command to execute.\r\n\t * @param {*} [...commandParams] Command parameters.\r\n\t */\r\n\texecute( ...args ) {\r\n\t\tthis.commands.execute( ...args );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and initializes a new editor instance.\r\n\t *\r\n\t * @param {Object} config The editor config. You can find the list of config options in\r\n\t * {@link module:core/editor/editorconfig~EditorConfig}.\r\n\t * @returns {Promise} Promise resolved once editor is ready.\r\n\t * @returns {module:core/editor/editor~Editor} return.editor The editor instance.\r\n\t */\r\n\tstatic create( config ) {\r\n\t\treturn new Promise( resolve => {\r\n\t\t\tconst editor = new this( config );\r\n\r\n\t\t\tresolve(\r\n\t\t\t\teditor.initPlugins()\r\n\t\t\t\t\t.then( () => {\r\n\t\t\t\t\t\teditor.fire( 'dataReady' );\r\n\t\t\t\t\t\teditor.fire( 'ready' );\r\n\t\t\t\t\t} )\r\n\t\t\t\t\t.then( () => editor )\r\n\t\t\t);\r\n\t\t} );\r\n\t}\r\n}\r\n\r\nmix( Editor, ObservableMixin );\r\n\r\n/**\r\n * Fired after {@link #initPlugins plugins are initialized}.\r\n *\r\n * @event pluginsReady\r\n */\r\n\r\n/**\r\n * Fired when the data loaded to the editor is ready. If a specific editor doesn't load\r\n * any data initially, this event will be fired right before {@link #event:ready}.\r\n *\r\n * @event dataReady\r\n */\r\n\r\n/**\r\n * Fired when {@link #event:pluginsReady plugins}, and {@link #event:dataReady data} and all additional\r\n * editor components are ready.\r\n *\r\n * Note: This event is most useful for plugin developers. When integrating the editor with your website or\r\n * application you do not have to listen to `editor#ready` because when the promise returned by the static\r\n * {@link module:core/editor/editor~Editor.create `Editor.create()`} event is resolved, the editor is already ready.\r\n * In fact, since the first moment when the editor instance is available to you is inside `then()`'s callback,\r\n * you cannot even add a listener to the `editor#ready` event.\r\n *\r\n * See also the {@link #state `editor.state`} property.\r\n *\r\n * @event ready\r\n */\r\n\r\n/**\r\n * Fired when this editor instance is destroyed. The editor at this point is not usable and this event should be used to\r\n * perform the clean-up in any plugin.\r\n *\r\n *\r\n * See also the {@link #state `editor.state`} property.\r\n *\r\n * @event destroy\r\n */\r\n\r\n/**\r\n * An array of plugins built into this editor class.\r\n * It is used in CKEditor 5 builds to provide a list of plugins which are later automatically initialized\r\n * during the editor initialization.\r\n *\r\n * They will be automatically initialized by the editor, unless listed in `config.removePlugins` and\r\n * unless `config.plugins` is passed.\r\n *\r\n *\t\t// Build some plugins into the editor class first.\r\n *\t\tClassicEditor.builtinPlugins = [ FooPlugin, BarPlugin ];\r\n *\r\n *\t\t// Normally, you need to define config.plugins, but since ClassicEditor.builtinPlugins was\r\n *\t\t// defined, now you can call create() without any configuration.\r\n *\t\tClassicEditor\r\n *\t\t\t.create( sourceElement )\r\n *\t\t\t.then( editor => {\r\n *\t\t\t\teditor.plugins.get( FooPlugin ); // -> instance of the Foo plugin\r\n *\t\t\t\teditor.plugins.get( BarPlugin ); // -> instance of the Bar plugin\r\n *\t\t\t} );\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( sourceElement, {\r\n *\t\t\t\t// Don't initialize this plugins (note: it's defined by a string):\r\n *\t\t\t\tremovePlugins: [ 'Foo' ]\r\n *\t\t\t} )\r\n *\t\t\t.then( editor => {\r\n *\t\t\t\teditor.plugins.get( FooPlugin ); // -> undefined\r\n *\t\t\t\teditor.config.get( BarPlugin ); // -> instance of the Bar plugin\r\n *\t\t\t} );\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( sourceElement, {\r\n *\t\t\t\t// Load only this plugin. Can also be define by a string if\r\n *\t\t\t\t// this plugin was built into the editor class.\r\n *\t\t\t\tplugins: [ FooPlugin ]\r\n *\t\t\t} )\r\n *\t\t\t.then( editor => {\r\n *\t\t\t\teditor.plugins.get( FooPlugin ); // -> instance of the Foo plugin\r\n *\t\t\t\teditor.config.get( BarPlugin ); // -> undefined\r\n *\t\t\t} );\r\n *\r\n * See also {@link module:core/editor/editor~Editor.defaultConfig}.\r\n *\r\n * @static\r\n * @member {Array.<Function>} module:core/editor/editor~Editor.builtinPlugins\r\n */\r\n\r\n/**\r\n * The default config which is built into the editor class.\r\n * It is used in CKEditor 5 builds to provide the default config options which are later used during editor initialization.\r\n *\r\n *\t\tClassicEditor.defaultConfig = {\r\n *\t\t\tfoo: 1,\r\n *\t\t\tbar: 2\r\n *\t\t};\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( sourceElement )\r\n *\t\t\t.then( editor => {\r\n *\t\t\t\teditor.config.get( 'foo' ); // -> 1\r\n *\t\t\t\teditor.config.get( 'bar' ); // -> 2\r\n *\t\t\t} );\r\n *\r\n *\t\t// The default options can be overridden by the config passed to create().\r\n *\t\tClassicEditor\r\n *\t\t\t.create( sourceElement, { bar: 3 } )\r\n *\t\t\t.then( editor => {\r\n *\t\t\t\teditor.config.get( 'foo' ); // -> 1\r\n *\t\t\t\teditor.config.get( 'bar' ); // -> 3\r\n *\t\t\t} );\r\n *\r\n * See also {@link module:core/editor/editor~Editor.builtinPlugins}.\r\n *\r\n * @static\r\n * @member {Object} module:core/editor/editor~Editor.defaultConfig\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/editor/utils/dataapimixin\r\n */\r\n\r\n/**\r\n * Implementation of the {@link module:core/editor/utils/dataapimixin~DataApi}.\r\n *\r\n * @mixin DataApiMixin\r\n * @implements module:core/editor/utils/dataapimixin~DataApi\r\n */\r\nconst DataApiMixin = {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tsetData( data ) {\r\n\t\tthis.data.set( data );\r\n\t},\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tgetData() {\r\n\t\treturn this.data.get();\r\n\t}\r\n};\r\n\r\nexport default DataApiMixin;\r\n\r\n/**\r\n * Interface defining editor methods for setting and getting data to and from the editor's main root element\r\n * using the {@link module:core/editor/editor~Editor#data data pipeline}.\r\n *\r\n * This interface is not a part of the {@link module:core/editor/editor~Editor} class because one may want to implement\r\n * an editor with multiple root elements, in which case the methods for setting and getting data will need to be implemented\r\n * differently.\r\n *\r\n * @interface DataApi\r\n */\r\n\r\n/**\r\n * Sets the data in the editor.\r\n *\r\n *\t\teditor.setData( '<p>This is editor!</p>' );\r\n *\r\n * By default the editor accepts HTML. This can be controlled by injecting a different data processor.\r\n * See the {@glink features/markdown Markdown output} guide for more details.\r\n *\r\n * Note: Not only is the format of the data configurable, but the type of the `setData()`'s parameter does not\r\n * have to be a string either. You can e.g. accept an object or a DOM `DocumentFragment` if you consider this\r\n * the right format for you.\r\n *\r\n * @method #setData\r\n * @param {String} data Input data.\r\n */\r\n\r\n/**\r\n * Gets the data from the editor.\r\n *\r\n *\t\teditor.getData(); // -> '<p>This is editor!</p>'\r\n *\r\n * By default the editor outputs HTML. This can be controlled by injecting a different data processor.\r\n * See the {@glink features/markdown Markdown output} guide for more details.\r\n *\r\n * Note: Not only is the format of the data configurable, but the type of the `getData()`'s return value does not\r\n * have to be a string either. You can e.g. return an object or a DOM `DocumentFragment`  if you consider this\r\n * the right format for you.\r\n *\r\n * @method #getData\r\n * @returns {String} Output data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport setDataInElement from '@ckeditor/ckeditor5-utils/src/dom/setdatainelement';\r\n\r\n/**\r\n * @module core/editor/utils/elementapimixin\r\n */\r\n\r\n/**\r\n * Implementation of the {@link module:core/editor/utils/elementapimixin~ElementApi}.\r\n *\r\n * @mixin ElementApiMixin\r\n * @implements module:core/editor/utils/elementapimixin~ElementApi\r\n */\r\nconst ElementApiMixin = {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tupdateSourceElement() {\r\n\t\tif ( !this.sourceElement ) {\r\n\t\t\t/**\r\n\t\t\t * Cannot update the source element of a detached editor.\r\n\t\t\t *\r\n\t\t\t * The {@link ~ElementApi#updateSourceElement `updateSourceElement()`} method cannot be called if you did not\r\n\t\t\t * pass an element to `Editor.create()`.\r\n\t\t\t *\r\n\t\t\t * @error editor-missing-sourceelement\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'editor-missing-sourceelement: Cannot update the source element of a detached editor.' );\r\n\t\t}\r\n\r\n\t\tsetDataInElement( this.sourceElement, this.data.get() );\r\n\t}\r\n};\r\n\r\nexport default ElementApiMixin;\r\n\r\n/**\r\n * Interface describing an editor that replaced a DOM element (was \"initialized on an element\").\r\n *\r\n * Such an editor should provide a method to\r\n * {@link module:core/editor/utils/elementapimixin~ElementApi#updateSourceElement update the replaced element with the current data}.\r\n *\r\n * @interface ElementApi\r\n */\r\n\r\n/**\r\n * The element on which the editor has been initialized.\r\n *\r\n * @readonly\r\n * @member {HTMLElement} #sourceElement\r\n */\r\n\r\n/**\r\n * Updates the {@link #sourceElement editor source element}'s content with the data.\r\n *\r\n * @method #updateSourceElement\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/setdatainelement\r\n */\r\n\r\n/* globals HTMLTextAreaElement */\r\n\r\n/**\r\n * Sets data in a given element.\r\n *\r\n * @param {HTMLElement} el The element in which the data will be set.\r\n * @param {String} data The data string.\r\n */\r\nexport default function setDataInElement( el, data ) {\r\n\tif ( el instanceof HTMLTextAreaElement ) {\r\n\t\tel.value = data;\r\n\t}\r\n\r\n\tel.innerHTML = data;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/dataprocessor/basichtmlwriter\r\n */\r\n\r\n/* globals document */\r\n\r\n/**\r\n * Basic HTML writer. It uses the native `innerHTML` property for basic conversion\r\n * from a document fragment to an HTML string.\r\n *\r\n * @implements module:engine/dataprocessor/htmlwriter~HtmlWriter\r\n */\r\nexport default class BasicHtmlWriter {\r\n\t/**\r\n\t * Returns an HTML string created from the document fragment.\r\n\t *\r\n\t * @param {DocumentFragment} fragment\r\n\t * @returns {String}\r\n\t */\r\n\tgetHtml( fragment ) {\r\n\t\tconst doc = document.implementation.createHTMLDocument( '' );\r\n\t\tconst container = doc.createElement( 'div' );\r\n\t\tcontainer.appendChild( fragment );\r\n\r\n\t\treturn container.innerHTML;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/dataprocessor/htmldataprocessor\r\n */\r\n\r\n/* globals document, DOMParser */\r\n\r\nimport BasicHtmlWriter from './basichtmlwriter';\r\nimport DomConverter from '../view/domconverter';\r\nimport { NBSP_FILLER } from '../view/filler';\r\n\r\n/**\r\n * The HTML data processor class.\r\n * This data processor implementation uses HTML as input and output data.\r\n *\r\n * @implements module:engine/dataprocessor/dataprocessor~DataProcessor\r\n */\r\nexport default class HtmlDataProcessor {\r\n\t/**\r\n\t * Creates a new instance of the HTML data processor class.\r\n\t */\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * A DOM parser instance used to parse an HTML string to an HTML document.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {DOMParser}\r\n\t\t */\r\n\t\tthis._domParser = new DOMParser();\r\n\r\n\t\t/**\r\n\t\t * A DOM converter used to convert DOM elements to view elements.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/domconverter~DomConverter}\r\n\t\t */\r\n\t\tthis._domConverter = new DomConverter( { blockFiller: NBSP_FILLER } );\r\n\r\n\t\t/**\r\n\t\t * A basic HTML writer instance used to convert DOM elements to an HTML string.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/dataprocessor/basichtmlwriter~BasicHtmlWriter}\r\n\t\t */\r\n\t\tthis._htmlWriter = new BasicHtmlWriter();\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a provided {@link module:engine/view/documentfragment~DocumentFragment document fragment}\r\n\t * to data format &mdash; in this case to an HTML string.\r\n\t *\r\n\t * @param {module:engine/view/documentfragment~DocumentFragment} viewFragment\r\n\t * @returns {String} HTML string.\r\n\t */\r\n\ttoData( viewFragment ) {\r\n\t\t// Convert view DocumentFragment to DOM DocumentFragment.\r\n\t\tconst domFragment = this._domConverter.viewToDom( viewFragment, document );\r\n\r\n\t\t// Convert DOM DocumentFragment to HTML output.\r\n\t\treturn this._htmlWriter.getHtml( domFragment );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the provided HTML string to a view tree.\r\n\t *\r\n\t * @param {String} data An HTML string.\r\n\t * @returns {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment|null} A converted view element.\r\n\t */\r\n\ttoView( data ) {\r\n\t\t// Convert input HTML data to DOM DocumentFragment.\r\n\t\tconst domFragment = this._toDom( data );\r\n\r\n\t\t// Convert DOM DocumentFragment to view DocumentFragment.\r\n\t\treturn this._domConverter.domToView( domFragment );\r\n\t}\r\n\r\n\t/**\r\n\t * Converts an HTML string to its DOM representation. Returns a document fragment containing nodes parsed from\r\n\t * the provided data.\r\n\t *\r\n\t * @private\r\n\t * @param {String} data\r\n\t * @returns {DocumentFragment}\r\n\t */\r\n\t_toDom( data ) {\r\n\t\tconst document = this._domParser.parseFromString( data, 'text/html' );\r\n\t\tconst fragment = document.createDocumentFragment();\r\n\t\tconst nodes = document.body.childNodes;\r\n\r\n\t\twhile ( nodes.length > 0 ) {\r\n\t\t\tfragment.appendChild( nodes[ 0 ] );\r\n\t\t}\r\n\r\n\t\treturn fragment;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/componentfactory\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * A helper class implementing the UI component ({@link module:ui/view~View view}) factory.\r\n *\r\n * It allows functions producing specific UI components to be registered under their unique names\r\n * in the factory. A registered component can be then instantiated by providing its name.\r\n * Note that names are case insensitive.\r\n *\r\n *\t\t// The editor provides localization tools for the factory.\r\n *\t\tconst factory = new ComponentFactory( editor );\r\n *\r\n *\t\tfactory.add( 'foo', locale => new FooView( locale ) );\r\n *\t\tfactory.add( 'bar', locale => new BarView( locale ) );\r\n *\r\n *\t\t// An instance of FooView.\r\n *\t\tconst fooInstance = factory.create( 'foo' );\r\n *\r\n *\t\t// Names are case insensitive so this is also allowed:\r\n *\t\tconst barInstance = factory.create( 'Bar' );\r\n *\r\n * The {@link module:core/editor/editor~Editor#locale editor locale} is passed to the factory\r\n * function when {@link module:ui/componentfactory~ComponentFactory#create} is called.\r\n */\r\nexport default class ComponentFactory {\r\n\t/**\r\n\t * Creates an instance of the factory.\r\n\t *\r\n\t * @constructor\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\t/**\r\n\t\t * The editor instance that the factory belongs to.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor}\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\r\n\t\t/**\r\n\t\t * Registered component factories.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map}\r\n\t\t */\r\n\t\tthis._components = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator of registered component names. Names are returned in lower case.\r\n\t *\r\n\t * @returns {Iterable.<String>}\r\n\t */\r\n\t* names() {\r\n\t\tfor ( const value of this._components.values() ) {\r\n\t\t\tyield value.originalName;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a component factory function that will be used by the\r\n\t * {@link #create create} method and called with the\r\n\t * {@link module:core/editor/editor~Editor#locale editor locale} as an argument,\r\n\t * allowing localization of the {@link module:ui/view~View view}.\r\n\t *\r\n\t * @param {String} name The name of the component.\r\n\t * @param {Function} callback The callback that returns the component.\r\n\t */\r\n\tadd( name, callback ) {\r\n\t\tif ( this.has( name ) ) {\r\n\t\t\t/**\r\n\t\t\t * The item already exists in the component factory.\r\n\t\t\t *\r\n\t\t\t * @error componentfactory-item-exists\r\n\t\t\t * @param {String} name The name of the component.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'componentfactory-item-exists: The item already exists in the component factory.', { name }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis._components.set( getNormalized( name ), { callback, originalName: name } );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an instance of a component registered in the factory under a specific name.\r\n\t *\r\n\t * When called, the {@link module:core/editor/editor~Editor#locale editor locale} is passed to\r\n\t * the previously {@link #add added} factory function, allowing localization of the\r\n\t * {@link module:ui/view~View view}.\r\n\t *\r\n\t * @param {String} name The name of the component.\r\n\t * @returns {module:ui/view~View} The instantiated component view.\r\n\t */\r\n\tcreate( name ) {\r\n\t\tif ( !this.has( name ) ) {\r\n\t\t\t/**\r\n\t\t\t * The required component is not registered in the component factory. Please make sure\r\n\t\t\t * the provided name is correct and the component has been correctly\r\n\t\t\t * {@link #add added} to the factory.\r\n\t\t\t *\r\n\t\t\t * @error componentfactory-item-missing\r\n\t\t\t * @param {String} name The name of the missing component.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'componentfactory-item-missing: The required component is not registered in the factory.', { name }\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this._components.get( getNormalized( name ) ).callback( this.editor.locale );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a component of a given name is registered in the factory.\r\n\t *\r\n\t * @param {String} name The name of the component.\r\n\t * @returns {Boolean}\r\n\t */\r\n\thas( name ) {\r\n\t\treturn this._components.has( getNormalized( name ) );\r\n\t}\r\n}\r\n\r\n//\r\n// Ensures that the component name used as the key in the internal map is in lower case.\r\n//\r\n// @private\r\n// @param {String} name\r\n// @returns {String}\r\nfunction getNormalized( name ) {\r\n\treturn String( name ).toLowerCase();\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* global setTimeout, clearTimeout */\r\n\r\n/**\r\n * @module utils/focustracker\r\n */\r\n\r\nimport DomEmitterMixin from './dom/emittermixin';\r\nimport ObservableMixin from './observablemixin';\r\nimport CKEditorError from './ckeditorerror';\r\nimport mix from './mix';\r\n\r\n/**\r\n * Allows observing a group of `HTMLElement`s whether at least one of them is focused.\r\n *\r\n * Used by the {@link module:core/editor/editor~Editor} in order to track whether the focus is still within the application,\r\n * or were used outside of its UI.\r\n *\r\n * **Note** `focus` and `blur` listeners use event capturing, so it is only needed to register wrapper `HTMLElement`\r\n * which contain other `focusable` elements. But note that this wrapper element has to be focusable too\r\n * (have e.g. `tabindex=\"-1\"`).\r\n *\r\n * @mixes module:utils/dom/emittermixin~EmitterMixin\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class FocusTracker {\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * True when one of the registered elements is focused.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isFocused\r\n\t\t */\r\n\t\tthis.set( 'isFocused', false );\r\n\r\n\t\t/**\r\n\t\t * Currently focused element.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {HTMLElement}\r\n\t\t */\r\n\t\tthis.focusedElement = null;\r\n\r\n\t\t/**\r\n\t\t * List of registered elements.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Set.<HTMLElement>}\r\n\t\t */\r\n\t\tthis._elements = new Set();\r\n\r\n\t\t/**\r\n\t\t * Event loop timeout.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis._nextEventLoopTimeout = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Starts tracking the specified element.\r\n\t *\r\n\t * @param {HTMLElement} element\r\n\t */\r\n\tadd( element ) {\r\n\t\tif ( this._elements.has( element ) ) {\r\n\t\t\tthrow new CKEditorError( 'focusTracker-add-element-already-exist' );\r\n\t\t}\r\n\r\n\t\tthis.listenTo( element, 'focus', () => this._focus( element ), { useCapture: true } );\r\n\t\tthis.listenTo( element, 'blur', () => this._blur(), { useCapture: true } );\r\n\t\tthis._elements.add( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Stops tracking the specified element and stops listening on this element.\r\n\t *\r\n\t * @param {HTMLElement} element\r\n\t */\r\n\tremove( element ) {\r\n\t\tif ( element === this.focusedElement ) {\r\n\t\t\tthis._blur( element );\r\n\t\t}\r\n\r\n\t\tif ( this._elements.has( element ) ) {\r\n\t\t\tthis.stopListening( element );\r\n\t\t\tthis._elements.delete( element );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stores currently focused element and set {#isFocused} as `true`.\r\n\t *\r\n\t * @private\r\n\t * @param {HTMLElement} element Element which has been focused.\r\n\t */\r\n\t_focus( element ) {\r\n\t\tclearTimeout( this._nextEventLoopTimeout );\r\n\r\n\t\tthis.focusedElement = element;\r\n\t\tthis.isFocused = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Clears currently focused element and set {@link #isFocused} as `false`.\r\n\t * This method uses `setTimeout` to change order of fires `blur` and `focus` events.\r\n\t *\r\n\t * @private\r\n\t * @fires blur\r\n\t */\r\n\t_blur() {\r\n\t\tclearTimeout( this._nextEventLoopTimeout );\r\n\r\n\t\tthis._nextEventLoopTimeout = setTimeout( () => {\r\n\t\t\tthis.focusedElement = null;\r\n\t\t\tthis.isFocused = false;\r\n\t\t}, 0 );\r\n\t}\r\n\r\n\t/**\r\n\t * @event focus\r\n\t */\r\n\r\n\t/**\r\n\t * @event blur\r\n\t */\r\n}\r\n\r\nmix( FocusTracker, DomEmitterMixin );\r\nmix( FocusTracker, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/editor/editorui\r\n */\r\n\r\nimport ComponentFactory from '@ckeditor/ckeditor5-ui/src/componentfactory';\r\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\r\n\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * A class providing the minimal interface that is required to successfully bootstrap any editor UI.\r\n *\r\n * @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class EditorUI {\r\n\t/**\r\n\t * Creates an instance of the editor UI class.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {module:ui/editorui/editoruiview~EditorUIView} view The view of the UI.\r\n\t */\r\n\tconstructor( editor, view ) {\r\n\t\t/**\r\n\t\t * The editor that the UI belongs to.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor} #editor\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\r\n\t\t/**\r\n\t\t * The main (top–most) view of the editor UI.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/editorui/editoruiview~EditorUIView} #view\r\n\t\t */\r\n\t\tthis.view = view;\r\n\r\n\t\t/**\r\n\t\t * An instance of the {@link module:ui/componentfactory~ComponentFactory}, a registry used by plugins\r\n\t\t * to register factories of specific UI components.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/componentfactory~ComponentFactory} #componentFactory\r\n\t\t */\r\n\t\tthis.componentFactory = new ComponentFactory( editor );\r\n\r\n\t\t/**\r\n\t\t * Stores the information about the editor UI focus and propagates it so various plugins and components\r\n\t\t * are unified as a focus group.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker} #focusTracker\r\n\t\t */\r\n\t\tthis.focusTracker = new FocusTracker();\r\n\r\n\t\t// Informs UI components that should be refreshed after layout change.\r\n\t\tthis.listenTo( editor.editing.view.document, 'layoutChanged', () => this.update() );\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the {@link module:core/editor/editorui~EditorUI#event:update `update`} event.\r\n\t *\r\n\t * This method should be called when the editor UI (e.g. positions of its balloons) needs to be updated due to\r\n\t * some environmental change which CKEditor 5 is not aware of (e.g. resize of a container in which it is used).\r\n\t */\r\n\tupdate() {\r\n\t\tthis.fire( 'update' );\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the UI.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.stopListening();\r\n\t\tthis.view.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Fired whenever the UI (all related components) should be refreshed.\r\n\t *\r\n\t * **Note:**: The event is fired after each {@link module:engine/view/document~Document#event:layoutChanged}.\r\n\t * It can also be fired manually via the {@link module:core/editor/editorui~EditorUI#update} method.\r\n\t *\r\n\t * @event update\r\n\t */\r\n}\r\n\r\nmix( EditorUI, EmitterMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module editor-classic/classiceditorui\r\n */\r\n\r\nimport EditorUI from '@ckeditor/ckeditor5-core/src/editor/editorui';\r\nimport enableToolbarKeyboardFocus from '@ckeditor/ckeditor5-ui/src/toolbar/enabletoolbarkeyboardfocus';\r\nimport normalizeToolbarConfig from '@ckeditor/ckeditor5-ui/src/toolbar/normalizetoolbarconfig';\r\n\r\n/**\r\n * The classic editor UI class.\r\n *\r\n * @extends module:core/editor/editorui~EditorUI\r\n */\r\nexport default class ClassicEditorUI extends EditorUI {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor, view ) {\r\n\t\tsuper( editor, view );\r\n\r\n\t\t/**\r\n\t\t * A normalized `config.toolbar` object.\r\n\t\t *\r\n\t\t * @type {Object}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._toolbarConfig = normalizeToolbarConfig( editor.config.get( 'toolbar' ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the UI.\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst view = this.view;\r\n\r\n\t\tview.render();\r\n\r\n\t\t// Set–up the sticky panel with toolbar.\r\n\t\tview.stickyPanel.bind( 'isActive' ).to( this.focusTracker, 'isFocused' );\r\n\t\tview.stickyPanel.limiterElement = view.element;\r\n\r\n\t\tif ( this._toolbarConfig.viewportTopOffset ) {\r\n\t\t\tview.stickyPanel.viewportTopOffset = this._toolbarConfig.viewportTopOffset;\r\n\t\t}\r\n\r\n\t\t// Setup the editable.\r\n\t\tconst editingRoot = editor.editing.view.document.getRoot();\r\n\t\tview.editable.bind( 'isReadOnly' ).to( editingRoot );\r\n\t\tview.editable.bind( 'isFocused' ).to( editor.editing.view.document );\r\n\t\tview.editable.name = editingRoot.rootName;\r\n\r\n\t\tthis.focusTracker.add( this.view.editableElement );\r\n\r\n\t\tthis.view.toolbar.fillFromConfig( this._toolbarConfig.items, this.componentFactory );\r\n\r\n\t\tenableToolbarKeyboardFocus( {\r\n\t\t\torigin: editor.editing.view,\r\n\t\t\toriginFocusTracker: this.focusTracker,\r\n\t\t\toriginKeystrokeHandler: editor.keystrokes,\r\n\t\t\ttoolbar: this.view.toolbar\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/toolbar/normalizetoolbarconfig\r\n */\r\n\r\n/**\r\n * Normalizes the toolbar configuration (`config.toolbar`), which:\r\n *\r\n * * may be defined as an `Array`:\r\n *\r\n * \t\ttoolbar: [ 'heading', 'bold', 'italic', 'link', ... ]\r\n *\r\n * * or an `Object`:\r\n *\r\n *\t\ttoolbar: {\r\n *\t\t\titems: [ 'heading', 'bold', 'italic', 'link', ... ],\r\n *\t\t\t...\r\n *\t\t}\r\n *\r\n * * or may not be defined at all (`undefined`)\r\n *\r\n * and returns it in the object form.\r\n *\r\n * @param {Array|Object|undefined} config The value of `config.toolbar`.\r\n * @returns {Object} A normalized toolbar config object.\r\n */\r\nexport default function normalizeToolbarConfig( config ) {\r\n\tif ( Array.isArray( config ) ) {\r\n\t\treturn {\r\n\t\t\titems: config\r\n\t\t};\r\n\t}\r\n\r\n\tif ( !config ) {\r\n\t\treturn {\r\n\t\t\titems: []\r\n\t\t};\r\n\t}\r\n\r\n\treturn Object.assign( {\r\n\t\titems: []\r\n\t}, config );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/toolbar/enabletoolbarkeyboardfocus\r\n */\r\n\r\n/**\r\n * Enables focus/blur toolbar navigation using `Alt+F10` and `Esc` keystrokes.\r\n *\r\n * @param {Object} options Options of the utility.\r\n * @param {*} options.origin A view to which the focus will return when `Esc` is pressed and\r\n * `options.toolbar` is focused.\r\n * @param {module:utils/keystrokehandler~KeystrokeHandler} options.originKeystrokeHandler A keystroke\r\n * handler to register `Alt+F10` keystroke.\r\n * @param {module:utils/focustracker~FocusTracker} options.originFocusTracker A focus tracker\r\n * for `options.origin`.\r\n * @param {module:ui/toolbar/toolbarview~ToolbarView} options.toolbar A toolbar which is to gain\r\n * focus when `Alt+F10` is pressed.\r\n * @param {Function} [options.beforeFocus] A callback executed before the `options.toolbar` gains focus\r\n * upon the `Alt+F10` keystroke.\r\n * @param {Function} [options.afterBlur] A callback executed after `options.toolbar` loses focus upon\r\n * `Esc` keystroke but before the focus goes back to `options.origin`.\r\n */\r\nexport default function enableToolbarKeyboardFocus( {\r\n\torigin,\r\n\toriginKeystrokeHandler,\r\n\toriginFocusTracker,\r\n\ttoolbar,\r\n\tbeforeFocus,\r\n\tafterBlur\r\n} ) {\r\n\t// Because toolbar items can get focus, the overall state of the toolbar must\r\n\t// also be tracked.\r\n\toriginFocusTracker.add( toolbar.element );\r\n\r\n\t// Focus the toolbar on the keystroke, if not already focused.\r\n\toriginKeystrokeHandler.set( 'Alt+F10', ( data, cancel ) => {\r\n\t\tif ( originFocusTracker.isFocused && !toolbar.focusTracker.isFocused ) {\r\n\t\t\tif ( beforeFocus ) {\r\n\t\t\t\tbeforeFocus();\r\n\t\t\t}\r\n\r\n\t\t\ttoolbar.focus();\r\n\r\n\t\t\tcancel();\r\n\t\t}\r\n\t} );\r\n\r\n\t// Blur the toolbar and bring the focus back to origin.\r\n\ttoolbar.keystrokes.set( 'Esc', ( data, cancel ) => {\r\n\t\tif ( toolbar.focusTracker.isFocused ) {\r\n\t\t\torigin.focus();\r\n\r\n\t\t\tif ( afterBlur ) {\r\n\t\t\t\tafterBlur();\r\n\t\t\t}\r\n\r\n\t\t\tcancel();\r\n\t\t}\r\n\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/viewcollection\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Collects {@link module:ui/view~View} instances.\r\n *\r\n *\t\tconst parentView = new ParentView( locale );\r\n *\t\tconst collection = new ViewCollection( locale );\r\n *\r\n *\t\tcollection.setParent( parentView.element );\r\n *\r\n *\t\tconst viewA = new ChildView( locale );\r\n *\t\tconst viewB = new ChildView( locale );\r\n *\r\n * View collection renders and manages view {@link module:ui/view~View#element elements}:\r\n *\r\n *\t\tcollection.add( viewA );\r\n *\t\tcollection.add( viewB );\r\n *\r\n *\t\tconsole.log( parentView.element.firsChild ); // -> viewA.element\r\n *\t\tconsole.log( parentView.element.lastChild ); // -> viewB.element\r\n *\r\n * It {@link module:ui/viewcollection~ViewCollection#delegate propagates} DOM events too:\r\n *\r\n *\t\t// Delegate #click and #keydown events from viewA and viewB to the parentView.\r\n *\t\tcollection.delegate( 'click' ).to( parentView );\r\n *\r\n *\t\tparentView.on( 'click', ( evt ) => {\r\n *\t\t\tconsole.log( `${ evt.source } has been clicked.` );\r\n *\t\t} );\r\n *\r\n *\t\t// This event will be delegated to the parentView.\r\n *\t\tviewB.fire( 'click' );\r\n *\r\n * **Note**: A view collection can be used directly in the {@link module:ui/template~TemplateDefinition definition}\r\n * of a {@link module:ui/template~Template template}.\r\n *\r\n * @extends module:utils/collection~Collection\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class ViewCollection extends Collection {\r\n\t/**\r\n\t * Creates a new instance of the {@link module:ui/viewcollection~ViewCollection}.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The {@link module:core/editor/editor~Editor editor's locale} instance.\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( {\r\n\t\t\t// An #id Number attribute should be legal and not break the `ViewCollection` instance.\r\n\t\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/93\r\n\t\t\tidProperty: 'viewUid'\r\n\t\t} );\r\n\r\n\t\t// Handle {@link module:ui/view~View#element} in DOM when a new view is added to the collection.\r\n\t\tthis.on( 'add', ( evt, view, index ) => {\r\n\t\t\tif ( !view.isRendered ) {\r\n\t\t\t\tview.render();\r\n\t\t\t}\r\n\r\n\t\t\tif ( view.element && this._parentElement ) {\r\n\t\t\t\tthis._parentElement.insertBefore( view.element, this._parentElement.children[ index ] );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Handle {@link module:ui/view~View#element} in DOM when a view is removed from the collection.\r\n\t\tthis.on( 'remove', ( evt, view ) => {\r\n\t\t\tif ( view.element && this._parentElement ) {\r\n\t\t\t\tview.element.remove();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * The {@link module:core/editor/editor~Editor#locale editor's locale} instance.\r\n\t\t * See the view {@link module:ui/view~View#locale locale} property.\r\n\t\t *\r\n\t\t * @member {module:utils/locale~Locale}\r\n\t\t */\r\n\t\tthis.locale = locale;\r\n\r\n\t\t/**\r\n\t\t * A parent element within which child views are rendered and managed in DOM.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {HTMLElement}\r\n\t\t */\r\n\t\tthis._parentElement = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the view collection along with child views.\r\n\t * See the view {@link module:ui/view~View#destroy} method.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.map( view => view.destroy() );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the parent HTML element of this collection. When parent is set, {@link #add adding} and\r\n\t * {@link #remove removing} views in the collection synchronizes their\r\n\t * {@link module:ui/view~View#element elements} in the parent element.\r\n\t *\r\n\t * @param {HTMLElement} element A new parent element.\r\n\t */\r\n\tsetParent( elementOrDocFragment ) {\r\n\t\tthis._parentElement = elementOrDocFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * Delegates selected events coming from within views in the collection to any\r\n\t * {@link module:utils/emittermixin~Emitter}.\r\n\t *\r\n\t * For the following views and collection:\r\n\t *\r\n\t *\t\tconst viewA = new View();\r\n\t *\t\tconst viewB = new View();\r\n\t *\t\tconst viewC = new View();\r\n\t *\r\n\t *\t\tconst views = parentView.createCollection();\r\n\t *\r\n\t *\t\tviews.delegate( 'eventX' ).to( viewB );\r\n\t *\t\tviews.delegate( 'eventX', 'eventY' ).to( viewC );\r\n\t *\r\n\t *\t\tviews.add( viewA );\r\n\t *\r\n\t * the `eventX` is delegated (fired by) `viewB` and `viewC` along with `customData`:\r\n\t *\r\n\t *\t\tviewA.fire( 'eventX', customData );\r\n\t *\r\n\t * and `eventY` is delegated (fired by) `viewC` along with `customData`:\r\n\t *\r\n\t *\t\tviewA.fire( 'eventY', customData );\r\n\t *\r\n\t * See {@link module:utils/emittermixin~EmitterMixin#delegate}.\r\n\t *\r\n\t * @param {...String} events {@link module:ui/view~View} event names to be delegated to another\r\n\t * {@link module:utils/emittermixin~Emitter}.\r\n\t * @returns {Object}\r\n\t * @returns {Function} return.to A function which accepts the destination of\r\n\t * {@link module:utils/emittermixin~EmitterMixin#delegate delegated} events.\r\n\t */\r\n\tdelegate( ...events ) {\r\n\t\tif ( !events.length || !isStringArray( events ) ) {\r\n\t\t\t/**\r\n\t\t\t * All event names must be strings.\r\n\t\t\t *\r\n\t\t\t * @error ui-viewcollection-delegate-wrong-events\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'ui-viewcollection-delegate-wrong-events: All event names must be strings.' );\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t/**\r\n\t\t\t * Selects destination for {@link module:utils/emittermixin~EmitterMixin#delegate} events.\r\n\t\t\t *\r\n\t\t\t * @memberOf module:ui/viewcollection~ViewCollection#delegate\r\n\t\t\t * @function module:ui/viewcollection~ViewCollection#delegate.to\r\n\t\t\t * @param {module:utils/emittermixin~EmitterMixin} dest An `EmitterMixin` instance which is\r\n\t\t\t * the destination for delegated events.\r\n\t\t\t */\r\n\t\t\tto: dest => {\r\n\t\t\t\t// Activate delegating on existing views in this collection.\r\n\t\t\t\tfor ( const view of this ) {\r\n\t\t\t\t\tfor ( const evtName of events ) {\r\n\t\t\t\t\t\tview.delegate( evtName ).to( dest );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Activate delegating on future views in this collection.\r\n\t\t\t\tthis.on( 'add', ( evt, view ) => {\r\n\t\t\t\t\tfor ( const evtName of events ) {\r\n\t\t\t\t\t\tview.delegate( evtName ).to( dest );\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t// Deactivate delegating when view is removed from this collection.\r\n\t\t\t\tthis.on( 'remove', ( evt, view ) => {\r\n\t\t\t\t\tfor ( const evtName of events ) {\r\n\t\t\t\t\t\tview.stopDelegating( evtName, dest );\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a child view from the collection. If the {@link #setParent parent element} of the\r\n\t * collection has been set, the {@link module:ui/view~View#element element} of the view is also removed\r\n\t * in DOM, reflecting the order of the collection.\r\n\t *\r\n\t * See the {@link #add} method.\r\n\t *\r\n\t * @method #remove\r\n\t * @param {module:ui/view~View|Number|String} subject The view to remove, its id or index in the collection.\r\n\t * @returns {Object} The removed view.\r\n\t */\r\n}\r\n\r\nmix( Collection, ObservableMixin );\r\n\r\n// Check if all entries of the array are of `String` type.\r\n//\r\n// @private\r\n// @param {Array} arr An array to be checked.\r\n// @returns {Boolean}\r\nfunction isStringArray( arr ) {\r\n\treturn arr.every( a => typeof a == 'string' );\r\n}\r\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * This method is like `_.cloneWith` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @param {Function} [customizer] The function to customize cloning.\n * @returns {*} Returns the deep cloned value.\n * @see _.cloneWith\n * @example\n *\n * function customizer(value) {\n *   if (_.isElement(value)) {\n *     return value.cloneNode(true);\n *   }\n * }\n *\n * var el = _.cloneDeepWith(document.body, customizer);\n *\n * console.log(el === document.body);\n * // => false\n * console.log(el.nodeName);\n * // => 'BODY'\n * console.log(el.childNodes.length);\n * // => 20\n */\nfunction cloneDeepWith(value, customizer) {\n  customizer = typeof customizer == 'function' ? customizer : undefined;\n  return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG, customizer);\n}\n\nexport default cloneDeepWith;\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/template\r\n */\r\n\r\n/* global document */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport View from './view';\r\nimport ViewCollection from './viewcollection';\r\nimport isNode from '@ckeditor/ckeditor5-utils/src/dom/isnode';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport { isObject, cloneDeepWith } from 'lodash-es';\r\n\r\nconst xhtmlNs = 'http://www.w3.org/1999/xhtml';\r\n\r\n/**\r\n * A basic Template class. It renders a DOM HTML element or text from a\r\n * {@link module:ui/template~TemplateDefinition definition} and supports element attributes, children,\r\n * bindings to {@link module:utils/observablemixin~Observable observables} and DOM event propagation.\r\n *\r\n * A simple template can look like this:\r\n *\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\t\t\tattributes: {\r\n *\t\t\t\tclass: 'foo',\r\n *\t\t\t\tstyle: {\r\n *\t\t\t\t\tbackgroundColor: 'yellow'\r\n *\t\t\t\t}\r\n *\t\t\t},\r\n *\t\t\ton: {\r\n *\t\t\t\tclick: bind.to( 'clicked' )\r\n *\t\t\t}\r\n *\t\t\tchildren: [\r\n *\t\t\t\t'A paragraph.'\r\n *\t\t\t]\r\n *\t\t} ).render();\r\n *\r\n * and it will render the following HTML element:\r\n *\r\n *\t\t<p class=\"foo\" style=\"background-color: yellow;\">A paragraph.</p>\r\n *\r\n * Additionally, the `observable` will always fire `clicked` upon clicking `<p>` in the DOM.\r\n *\r\n * See {@link module:ui/template~TemplateDefinition} to know more about templates and complex\r\n * template definitions.\r\n *\r\n* @mixes module:utils/emittermixin~EmitterMixin\r\n */\r\nexport default class Template {\r\n\t/**\r\n\t * Creates an instance of the {@link ~Template} class.\r\n\t *\r\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the template.\r\n\t */\r\n\tconstructor( def ) {\r\n\t\tObject.assign( this, normalize( clone( def ) ) );\r\n\r\n\t\t/**\r\n\t\t * Indicates whether this particular Template instance has been\r\n\t\t * {@link #render rendered}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis._isRendered = false;\r\n\r\n\t\t/**\r\n\t\t * The tag (`tagName`) of this template, e.g. `div`. It also indicates that the template\r\n\t\t * renders to an HTML element.\r\n\t\t *\r\n\t\t * @member {String} #tag\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The text of the template. It also indicates that the template renders to a DOM text node.\r\n\t\t *\r\n\t\t * @member {Array.<String|module:ui/template~TemplateValueSchema>} #text\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The attributes of the template, e.g. `{ id: [ 'ck-id' ] }`, corresponding with\r\n\t\t * the attributes of an HTML element.\r\n\t\t *\r\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\r\n\t\t *\r\n\t\t * @member {Object} #attributes\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The children of the template. They can be either:\r\n\t\t * * independent instances of {@link ~Template} (sub–templates),\r\n\t\t * * native DOM Nodes.\r\n\t\t *\r\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\r\n\t\t *\r\n\t\t * @member {Array.<module:ui/template~Template|Node>} #children\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The DOM event listeners of the template.\r\n\t\t *\r\n\t\t * @member {Object} #eventListeners\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The data used by the {@link #revert} method to restore a node to its original state.\r\n\t\t *\r\n\t\t * See: {@link #apply}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/template~RenderData}\r\n\t\t */\r\n\t\tthis._revertData = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders a DOM Node (an HTML element or text) out of the template.\r\n\t *\r\n\t *\t\tconst domNode = new Template( { ... } ).render();\r\n\t *\r\n\t * See: {@link #apply}.\r\n\t *\r\n\t * @returns {HTMLElement|Text}\r\n\t */\r\n\trender() {\r\n\t\tconst node = this._renderNode( {\r\n\t\t\tintoFragment: true\r\n\t\t} );\r\n\r\n\t\tthis._isRendered = true;\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies the template to an existing DOM Node, either HTML element or text.\r\n\t *\r\n\t * **Note:** No new DOM nodes will be created. Applying extends\r\n\t * {@link module:ui/template~TemplateDefinition attributes} and\r\n\t * {@link module:ui/template~TemplateDefinition event listeners} only.\r\n\t *\r\n\t * **Note:** Existing `class` and `style` attributes are extended when a template\r\n\t * is applied to an HTML element, while other attributes and `textContent` are overridden.\r\n\t *\r\n\t * **Note:** The process of applying a template can be easily reverted using the\r\n\t * {@link module:ui/template~Template#revert} method.\r\n\t *\r\n\t *\t\tconst element = document.createElement( 'div' );\r\n\t *\t\tconst bind = Template.bind( observable, emitter );\r\n\t *\r\n\t *\t\tnew Template( {\r\n\t *\t\t\tattrs: {\r\n\t *\t\t\t\tid: 'first-div',\r\n\t *\t\t\t\tclass: bind.to( 'divClass' )\r\n\t *\t\t\t},\r\n\t *\t\t\ton: {\r\n\t *\t\t\t\tclick: bind( 'elementClicked' ) // Will be fired by the observable.\r\n\t *\t\t\t}\r\n\t *\t\t\tchildren: [\r\n\t *\t\t\t\t'Div text.'\r\n\t *\t\t\t]\r\n\t *\t\t} ).apply( element );\r\n\t *\r\n\t *\t\telement.outerHTML == \"<div id=\"first-div\" class=\"my-div\">Div text.</div>\"\r\n\t *\r\n\t * @see module:ui/template~Template#render\r\n\t * @see module:ui/template~Template#revert\r\n\t * @param {Node} node Root node for the template to apply.\r\n\t */\r\n\tapply( node ) {\r\n\t\tthis._revertData = getEmptyRevertData();\r\n\r\n\t\tthis._renderNode( {\r\n\t\t\tnode,\r\n\t\t\tisApplying: true,\r\n\t\t\trevertData: this._revertData\r\n\t\t} );\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Reverts a template {@link module:ui/template~Template#apply applied} to a DOM node.\r\n\t *\r\n\t * @param {Node} node The root node for the template to revert. In most of the cases, it is the\r\n\t * same node used by {@link module:ui/template~Template#apply}.\r\n\t */\r\n\trevert( node ) {\r\n\t\tif ( !this._revertData ) {\r\n\t\t\t/**\r\n\t\t\t * Attempting to revert a template which has not been applied yet.\r\n\t\t\t *\r\n\t\t\t * @error ui-template-revert-not-applied\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'ui-template-revert-not-applied: Attempting to revert a template which has not been applied yet.' );\r\n\t\t}\r\n\r\n\t\tthis._revertTemplateFromNode( node, this._revertData );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator which traverses the template in search of {@link module:ui/view~View}\r\n\t * instances and returns them one by one.\r\n\t *\r\n\t *\t\tconst viewFoo = new View();\r\n\t *\t\tconst viewBar = new View();\r\n\t *\t\tconst viewBaz = new View();\r\n\t *\t\tconst template = new Template( {\r\n\t *\t\t\ttag: 'div',\r\n\t *\t\t\tchildren: [\r\n\t *\t\t\t\tviewFoo,\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\ttag: 'div',\r\n\t *\t\t\t\t\tchildren: [\r\n\t *\t\t\t\t\t\tviewBar\r\n\t *\t\t\t\t\t]\r\n\t *\t\t\t\t},\r\n\t *\t\t\t\tviewBaz\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Logs: viewFoo, viewBar, viewBaz\r\n\t *\t\tfor ( const view of template.getViews() ) {\r\n\t *\t\t\tconsole.log( view );\r\n\t *\t\t}\r\n\t *\r\n\t * @returns {Iterable.<module:ui/view~View>}\r\n\t */\r\n\t* getViews() {\r\n\t\tfunction* search( def ) {\r\n\t\t\tif ( def.children ) {\r\n\t\t\t\tfor ( const child of def.children ) {\r\n\t\t\t\t\tif ( isView( child ) ) {\r\n\t\t\t\t\t\tyield child;\r\n\t\t\t\t\t} else if ( isTemplate( child ) ) {\r\n\t\t\t\t\t\tyield* search( child );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tyield* search( this );\r\n\t}\r\n\r\n\t/**\r\n\t * An entry point to the interface which binds DOM nodes to\r\n\t * {@link module:utils/observablemixin~Observable observables}.\r\n\t * There are two types of bindings:\r\n\t *\r\n\t * * HTML element attributes or text `textContent` synchronized with attributes of an\r\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}\r\n\t * and {@link module:ui/template~BindChain#if}.\r\n\t *\r\n\t *\t\tconst bind = Template.bind( observable, emitter );\r\n\t *\r\n\t *\t\tnew Template( {\r\n\t *\t\t\tattrs: {\r\n\t *\t\t\t\t// Binds the element \"class\" attribute to observable#classAttribute.\r\n\t *\t\t\t\tclass: bind.to( 'classAttribute' )\r\n\t *\t\t\t}\r\n\t *\t\t} ).render();\r\n\t *\r\n\t * * DOM events fired on HTML element propagated through\r\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}.\r\n\t *\r\n\t *\t\tconst bind = Template.bind( observable, emitter );\r\n\t *\r\n\t *\t\tnew Template( {\r\n\t *\t\t\ton: {\r\n\t *\t\t\t\t// Will be fired by the observable.\r\n\t *\t\t\t\tclick: bind( 'elementClicked' )\r\n\t *\t\t\t}\r\n\t *\t\t} ).render();\r\n\t *\r\n\t * Also see {@link module:ui/view~View#bindTemplate}.\r\n\t *\r\n\t * @param {module:utils/observablemixin~Observable} observable An observable which provides boundable attributes.\r\n\t * @param {module:utils/emittermixin~Emitter} emitter An emitter that listens to observable attribute\r\n\t * changes or DOM Events (depending on the kind of the binding). Usually, a {@link module:ui/view~View} instance.\r\n\t * @returns {module:ui/template~BindChain}\r\n\t */\r\n\tstatic bind( observable, emitter ) {\r\n\t\treturn {\r\n\t\t\tto( eventNameOrFunctionOrAttribute, callback ) {\r\n\t\t\t\treturn new TemplateToBinding( {\r\n\t\t\t\t\teventNameOrFunction: eventNameOrFunctionOrAttribute,\r\n\t\t\t\t\tattribute: eventNameOrFunctionOrAttribute,\r\n\t\t\t\t\tobservable, emitter, callback\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\r\n\t\t\tif( attribute, valueIfTrue, callback ) {\r\n\t\t\t\treturn new TemplateIfBinding( {\r\n\t\t\t\t\tobservable, emitter, attribute, valueIfTrue, callback\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Extends an existing {@link module:ui/template~Template} instance with some additional content\r\n\t * from another {@link module:ui/template~TemplateDefinition}.\r\n\t *\r\n\t *\t\tconst bind = Template.bind( observable, emitter );\r\n\t *\r\n\t *\t\tconst template = new Template( {\r\n\t *\t\t\ttag: 'p',\r\n\t *\t\t\tattributes: {\r\n\t *\t\t\t\tclass: 'a',\r\n\t *\t\t\t\tdata-x: bind.to( 'foo' )\r\n\t *\t\t\t},\r\n\t *\t\t\tchildren: [\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\ttag: 'span',\r\n\t *\t\t\t\t\tattributes: {\r\n\t *\t\t\t\t\t\tclass: 'b'\r\n\t *\t\t\t\t\t},\r\n\t *\t\t\t\t\tchildren: [\r\n\t *\t\t\t\t\t\t'Span'\r\n\t *\t\t\t\t\t]\r\n\t *\t\t\t\t}\r\n\t *\t\t\t]\r\n\t *\t\t } );\r\n\t *\r\n\t *\t\t// Instance-level extension.\r\n\t *\t\tTemplate.extend( template, {\r\n\t *\t\t\tattributes: {\r\n\t *\t\t\t\tclass: 'b',\r\n\t *\t\t\t\tdata-x: bind.to( 'bar' )\r\n\t *\t\t\t},\r\n\t *\t\t\tchildren: [\r\n\t *\t\t\t\t{\r\n\t *\t\t\t\t\tattributes: {\r\n\t *\t\t\t\t\t\tclass: 'c'\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t}\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Child extension.\r\n\t *\t\tTemplate.extend( template.children[ 0 ], {\r\n\t *\t\t\tattributes: {\r\n\t *\t\t\t\tclass: 'd'\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * the `outerHTML` of `template.render()` is:\r\n\t *\r\n\t *\t\t<p class=\"a b\" data-x=\"{ observable.foo } { observable.bar }\">\r\n\t *\t\t\t<span class=\"b c d\">Span</span>\r\n\t *\t\t</p>\r\n\t *\r\n\t * @param {module:ui/template~Template} template An existing template instance to be extended.\r\n\t * @param {module:ui/template~TemplateDefinition} def Additional definition to be applied to a template.\r\n\t */\r\n\tstatic extend( template, def ) {\r\n\t\tif ( template._isRendered ) {\r\n\t\t\t/**\r\n\t\t\t * Extending a template after rendering may not work as expected. To make sure\r\n\t\t\t * the {@link module:ui/template~Template.extend extending} works for an element,\r\n\t\t\t * make sure it happens before {@link #render} is called.\r\n\t\t\t *\r\n\t\t\t * @error template-extend-render\r\n\t\t\t */\r\n\t\t\tlog.warn( 'template-extend-render: Attempting to extend a template which has already been rendered.' );\r\n\t\t}\r\n\r\n\t\textendTemplate( template, normalize( clone( def ) ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Renders a DOM Node (either an HTML element or text) out of the template.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderNode( data ) {\r\n\t\tlet isInvalid;\r\n\r\n\t\tif ( data.node ) {\r\n\t\t\t// When applying, a definition cannot have \"tag\" and \"text\" at the same time.\r\n\t\t\tisInvalid = this.tag && this.text;\r\n\t\t} else {\r\n\t\t\t// When rendering, a definition must have either \"tag\" or \"text\": XOR( this.tag, this.text ).\r\n\t\t\tisInvalid = this.tag ? this.text : !this.text;\r\n\t\t}\r\n\r\n\t\tif ( isInvalid ) {\r\n\t\t\t/**\r\n\t\t\t * Node definition cannot have the \"tag\" and \"text\" properties at the same time.\r\n\t\t\t * Node definition must have either \"tag\" or \"text\" when rendering a new Node.\r\n\t\t\t *\r\n\t\t\t * @error ui-template-wrong-syntax\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'ui-template-wrong-syntax: Node definition must have either \"tag\" or \"text\" when rendering a new Node.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( this.text ) {\r\n\t\t\treturn this._renderText( data );\r\n\t\t} else {\r\n\t\t\treturn this._renderElement( data );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders an HTML element out of the template.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderElement( data ) {\r\n\t\tlet node = data.node;\r\n\r\n\t\tif ( !node ) {\r\n\t\t\tnode = data.node = document.createElementNS( this.ns || xhtmlNs, this.tag );\r\n\t\t}\r\n\r\n\t\tthis._renderAttributes( data );\r\n\t\tthis._renderElementChildren( data );\r\n\t\tthis._setUpListeners( data );\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders a text node out of {@link module:ui/template~Template#text}.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderText( data ) {\r\n\t\tlet node = data.node;\r\n\r\n\t\t// Save the original textContent to revert it in #revert().\r\n\t\tif ( node ) {\r\n\t\t\tdata.revertData.text = node.textContent;\r\n\t\t} else {\r\n\t\t\tnode = data.node = document.createTextNode( '' );\r\n\t\t}\r\n\r\n\t\t// Check if this Text Node is bound to Observable. Cases:\r\n\t\t//\r\n\t\t//\t\ttext: [ Template.bind( ... ).to( ... ) ]\r\n\t\t//\r\n\t\t//\t\ttext: [\r\n\t\t//\t\t\t'foo',\r\n\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\r\n\t\t//\t\t\t...\r\n\t\t//\t\t]\r\n\t\t//\r\n\t\tif ( hasTemplateBinding( this.text ) ) {\r\n\t\t\tthis._bindToObservable( {\r\n\t\t\t\tschema: this.text,\r\n\t\t\t\tupdater: getTextUpdater( node ),\r\n\t\t\t\tdata\r\n\t\t\t} );\r\n\t\t}\r\n\t\t// Simply set text. Cases:\r\n\t\t//\r\n\t\t//\t\ttext: [ 'all', 'are', 'static' ]\r\n\t\t//\r\n\t\t//\t\ttext: [ 'foo' ]\r\n\t\t//\r\n\t\telse {\r\n\t\t\tnode.textContent = this.text.join( '' );\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders HTML element attributes out of {@link module:ui/template~Template#attributes}.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderAttributes( data ) {\r\n\t\tlet attrName, attrValue, domAttrValue, attrNs;\r\n\r\n\t\tif ( !this.attributes ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst node = data.node;\r\n\t\tconst revertData = data.revertData;\r\n\r\n\t\tfor ( attrName in this.attributes ) {\r\n\t\t\t// Current attribute value in DOM.\r\n\t\t\tdomAttrValue = node.getAttribute( attrName );\r\n\r\n\t\t\t// The value to be set.\r\n\t\t\tattrValue = this.attributes[ attrName ];\r\n\r\n\t\t\t// Save revert data.\r\n\t\t\tif ( revertData ) {\r\n\t\t\t\trevertData.attributes[ attrName ] = domAttrValue;\r\n\t\t\t}\r\n\r\n\t\t\t// Detect custom namespace:\r\n\t\t\t//\r\n\t\t\t//\t\tclass: {\r\n\t\t\t//\t\t\tns: 'abc',\r\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\r\n\t\t\t//\t\t}\r\n\t\t\t//\r\n\t\t\tattrNs = ( isObject( attrValue[ 0 ] ) && attrValue[ 0 ].ns ) ? attrValue[ 0 ].ns : null;\r\n\r\n\t\t\t// Activate binding if one is found. Cases:\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [\r\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... )\r\n\t\t\t//\t\t]\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [\r\n\t\t\t//\t\t\t'bar',\r\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\r\n\t\t\t//\t\t\t'baz'\r\n\t\t\t//\t\t]\r\n\t\t\t//\r\n\t\t\t//\t\tclass: {\r\n\t\t\t//\t\t\tns: 'abc',\r\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\r\n\t\t\t//\t\t}\r\n\t\t\t//\r\n\t\t\tif ( hasTemplateBinding( attrValue ) ) {\r\n\t\t\t\t// Normalize attributes with additional data like namespace:\r\n\t\t\t\t//\r\n\t\t\t\t//\t\tclass: {\r\n\t\t\t\t//\t\t\tns: 'abc',\r\n\t\t\t\t//\t\t\tvalue: [ ... ]\r\n\t\t\t\t//\t\t}\r\n\t\t\t\t//\r\n\t\t\t\tconst valueToBind = attrNs ? attrValue[ 0 ].value : attrValue;\r\n\r\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\r\n\t\t\t\t// don't override them.\r\n\t\t\t\tif ( revertData && shouldExtend( attrName ) ) {\r\n\t\t\t\t\tvalueToBind.unshift( domAttrValue );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._bindToObservable( {\r\n\t\t\t\t\tschema: valueToBind,\r\n\t\t\t\t\tupdater: getAttributeUpdater( node, attrName, attrNs ),\r\n\t\t\t\t\tdata\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Style attribute could be an Object so it needs to be parsed in a specific way.\r\n\t\t\t//\r\n\t\t\t//\t\tstyle: {\r\n\t\t\t//\t\t\twidth: '100px',\r\n\t\t\t//\t\t\theight: Template.bind( ... ).to( ... )\r\n\t\t\t//\t\t}\r\n\t\t\t//\r\n\t\t\telse if ( attrName == 'style' && typeof attrValue[ 0 ] !== 'string' ) {\r\n\t\t\t\tthis._renderStyleAttribute( attrValue[ 0 ], data );\r\n\t\t\t}\r\n\r\n\t\t\t// Otherwise simply set the static attribute:\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [ 'foo' ]\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [ 'all', 'are', 'static' ]\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [\r\n\t\t\t//\t\t\t{\r\n\t\t\t//\t\t\t\tns: 'abc',\r\n\t\t\t//\t\t\t\tvalue: [ 'foo' ]\r\n\t\t\t//\t\t\t}\r\n\t\t\t//\t\t]\r\n\t\t\t//\r\n\t\t\telse {\r\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\r\n\t\t\t\t// don't override them.\r\n\t\t\t\tif ( revertData && domAttrValue && shouldExtend( attrName ) ) {\r\n\t\t\t\t\tattrValue.unshift( domAttrValue );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattrValue = attrValue\r\n\t\t\t\t\t// Retrieve \"values\" from:\r\n\t\t\t\t\t//\r\n\t\t\t\t\t//\t\tclass: [\r\n\t\t\t\t\t//\t\t\t{\r\n\t\t\t\t\t//\t\t\t\tns: 'abc',\r\n\t\t\t\t\t//\t\t\t\tvalue: [ ... ]\r\n\t\t\t\t\t//\t\t\t}\r\n\t\t\t\t\t//\t\t]\r\n\t\t\t\t\t//\r\n\t\t\t\t\t.map( val => val ? ( val.value || val ) : val )\r\n\t\t\t\t\t// Flatten the array.\r\n\t\t\t\t\t.reduce( ( prev, next ) => prev.concat( next ), [] )\r\n\t\t\t\t\t// Convert into string.\r\n\t\t\t\t\t.reduce( arrayValueReducer, '' );\r\n\r\n\t\t\t\tif ( !isFalsy( attrValue ) ) {\r\n\t\t\t\t\tnode.setAttributeNS( attrNs, attrName, attrValue );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the `style` attribute of an HTML element based on\r\n\t * {@link module:ui/template~Template#attributes}.\r\n\t *\r\n\t * A style attribute is an {Object} with static values:\r\n\t *\r\n\t *\t\tattributes: {\r\n\t *\t\t\tstyle: {\r\n\t *\t\t\t\tcolor: 'red'\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t * or values bound to {@link module:ui/model~Model} properties:\r\n\t *\r\n\t *\t\tattributes: {\r\n\t *\t\t\tstyle: {\r\n\t *\t\t\t\tcolor: bind.to( ... )\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t * Note: The `style` attribute is rendered without setting the namespace. It does not seem to be\r\n\t * needed.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} styles Styles located in `attributes.style` of {@link module:ui/template~TemplateDefinition}.\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderStyleAttribute( styles, data ) {\r\n\t\tconst node = data.node;\r\n\r\n\t\tfor ( const styleName in styles ) {\r\n\t\t\tconst styleValue = styles[ styleName ];\r\n\r\n\t\t\t// Cases:\r\n\t\t\t//\r\n\t\t\t//\t\tstyle: {\r\n\t\t\t//\t\t\tcolor: bind.to( 'attribute' )\r\n\t\t\t//\t\t}\r\n\t\t\t//\r\n\t\t\tif ( hasTemplateBinding( styleValue ) ) {\r\n\t\t\t\tthis._bindToObservable( {\r\n\t\t\t\t\tschema: [ styleValue ],\r\n\t\t\t\t\tupdater: getStyleUpdater( node, styleName ),\r\n\t\t\t\t\tdata\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Cases:\r\n\t\t\t//\r\n\t\t\t//\t\tstyle: {\r\n\t\t\t//\t\t\tcolor: 'red'\r\n\t\t\t//\t\t}\r\n\t\t\t//\r\n\t\t\telse {\r\n\t\t\t\tnode.style[ styleName ] = styleValue;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Recursively renders HTML element's children from {@link module:ui/template~Template#children}.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_renderElementChildren( data ) {\r\n\t\tconst node = data.node;\r\n\t\tconst container = data.intoFragment ? document.createDocumentFragment() : node;\r\n\t\tconst isApplying = data.isApplying;\r\n\t\tlet childIndex = 0;\r\n\r\n\t\tfor ( const child of this.children ) {\r\n\t\t\tif ( isViewCollection( child ) ) {\r\n\t\t\t\tif ( !isApplying ) {\r\n\t\t\t\t\tchild.setParent( node );\r\n\r\n\t\t\t\t\t// Note: ViewCollection renders its children.\r\n\t\t\t\t\tfor ( const view of child ) {\r\n\t\t\t\t\t\tcontainer.appendChild( view.element );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if ( isView( child ) ) {\r\n\t\t\t\tif ( !isApplying ) {\r\n\t\t\t\t\tif ( !child.isRendered ) {\r\n\t\t\t\t\t\tchild.render();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontainer.appendChild( child.element );\r\n\t\t\t\t}\r\n\t\t\t} else if ( isNode( child ) ) {\r\n\t\t\t\tcontainer.appendChild( child );\r\n\t\t\t} else {\r\n\t\t\t\tif ( isApplying ) {\r\n\t\t\t\t\tconst revertData = data.revertData;\r\n\t\t\t\t\tconst childRevertData = getEmptyRevertData();\r\n\r\n\t\t\t\t\trevertData.children.push( childRevertData );\r\n\r\n\t\t\t\t\tchild._renderNode( {\r\n\t\t\t\t\t\tnode: container.childNodes[ childIndex++ ],\r\n\t\t\t\t\t\tisApplying: true,\r\n\t\t\t\t\t\trevertData: childRevertData\r\n\t\t\t\t\t} );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontainer.appendChild( child.render() );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( data.intoFragment ) {\r\n\t\t\tnode.appendChild( container );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Activates `on` event listeners from the {@link module:ui/template~TemplateDefinition}\r\n\t * on an HTML element.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t */\r\n\t_setUpListeners( data ) {\r\n\t\tif ( !this.eventListeners ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor ( const key in this.eventListeners ) {\r\n\t\t\tconst revertBindings = this.eventListeners[ key ].map( schemaItem => {\r\n\t\t\t\tconst [ domEvtName, domSelector ] = key.split( '@' );\r\n\r\n\t\t\t\treturn schemaItem.activateDomEventListener( domEvtName, domSelector, data );\r\n\t\t\t} );\r\n\r\n\t\t\tif ( data.revertData ) {\r\n\t\t\t\tdata.revertData.bindings.push( revertBindings );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * For a given {@link module:ui/template~TemplateValueSchema} containing {@link module:ui/template~TemplateBinding}\r\n\t * activates the binding and sets its initial value.\r\n\t *\r\n\t * Note: {@link module:ui/template~TemplateValueSchema} can be for HTML element attributes or\r\n\t * text node `textContent`.\r\n\t *\r\n\t * @protected\r\n\t * @param {Object} options Binding options.\r\n\t * @param {module:ui/template~TemplateValueSchema} options.schema\r\n\t * @param {Function} options.updater A function which updates the DOM (like attribute or text).\r\n\t * @param {module:ui/template~RenderData} options.data Rendering data.\r\n\t */\r\n\t_bindToObservable( { schema, updater, data } ) {\r\n\t\tconst revertData = data.revertData;\r\n\r\n\t\t// Set initial values.\r\n\t\tsyncValueSchemaValue( schema, updater, data );\r\n\r\n\t\tconst revertBindings = schema\r\n\t\t\t// Filter \"falsy\" (false, undefined, null, '') value schema components out.\r\n\t\t\t.filter( item => !isFalsy( item ) )\r\n\t\t\t// Filter inactive bindings from schema, like static strings ('foo'), numbers (42), etc.\r\n\t\t\t.filter( item => item.observable )\r\n\t\t\t// Once only the actual binding are left, let the emitter listen to observable change:attribute event.\r\n\t\t\t// TODO: Reduce the number of listeners attached as many bindings may listen\r\n\t\t\t// to the same observable attribute.\r\n\t\t\t.map( templateBinding => templateBinding.activateAttributeListener( schema, updater, data ) );\r\n\r\n\t\tif ( revertData ) {\r\n\t\t\trevertData.bindings.push( revertBindings );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reverts {@link module:ui/template~RenderData#revertData template data} from a node to\r\n\t * return it to the original state.\r\n\t *\r\n\t * @protected\r\n\t * @param {HTMLElement|Text} node A node to be reverted.\r\n\t * @param {module:ui/template~RenderData#revertData} revertData Stores information about\r\n\t * what changes have been made by {@link #apply} to the node.\r\n\t */\r\n\t_revertTemplateFromNode( node, revertData ) {\r\n\t\tfor ( const binding of revertData.bindings ) {\r\n\t\t\t// Each binding may consist of several observable+observable#attribute.\r\n\t\t\t// like the following has 2:\r\n\t\t\t//\r\n\t\t\t//\t\tclass: [\r\n\t\t\t//\t\t\t'x',\r\n\t\t\t//\t\t\tbind.to( 'foo' ),\r\n\t\t\t//\t\t\t'y',\r\n\t\t\t//\t\t\tbind.to( 'bar' )\r\n\t\t\t//\t\t]\r\n\t\t\t//\r\n\t\t\tfor ( const revertBinding of binding ) {\r\n\t\t\t\trevertBinding();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( revertData.text ) {\r\n\t\t\tnode.textContent = revertData.text;\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor ( const attrName in revertData.attributes ) {\r\n\t\t\tconst attrValue = revertData.attributes[ attrName ];\r\n\r\n\t\t\t// When the attribute has **not** been set before #apply().\r\n\t\t\tif ( attrValue === null ) {\r\n\t\t\t\tnode.removeAttribute( attrName );\r\n\t\t\t} else {\r\n\t\t\t\tnode.setAttribute( attrName, attrValue );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( let i = 0; i < revertData.children.length; ++i ) {\r\n\t\t\tthis._revertTemplateFromNode( node.childNodes[ i ], revertData.children[ i ] );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmix( Template, EmitterMixin );\r\n\r\n/**\r\n * Describes a binding created by the {@link module:ui/template~Template.bind} interface.\r\n *\r\n * @protected\r\n */\r\nexport class TemplateBinding {\r\n\t/**\r\n\t * Creates an instance of the {@link module:ui/template~TemplateBinding} class.\r\n\t *\r\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the binding.\r\n\t */\r\n\tconstructor( def ) {\r\n\t\tObject.assign( this, def );\r\n\r\n\t\t/**\r\n\t\t * An observable instance of the binding. It either:\r\n\t\t *\r\n\t\t * * provides the attribute with the value,\r\n\t\t * * or passes the event when a corresponding DOM event is fired.\r\n\t\t *\r\n\t\t * @member {module:utils/observablemixin~ObservableMixin} module:ui/template~TemplateBinding#observable\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * An {@link module:utils/emittermixin~Emitter} used by the binding to:\r\n\t\t *\r\n\t\t * * listen to the attribute change in the {@link module:ui/template~TemplateBinding#observable},\r\n\t\t * * or listen to the event in the DOM.\r\n\t\t *\r\n\t\t * @member {module:utils/emittermixin~EmitterMixin} module:ui/template~TemplateBinding#emitter\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The name of the {@link module:ui/template~TemplateBinding#observable observed attribute}.\r\n\t\t *\r\n\t\t * @member {String} module:ui/template~TemplateBinding#attribute\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * A custom function to process the value of the {@link module:ui/template~TemplateBinding#attribute}.\r\n\t\t *\r\n\t\t * @member {Function} [module:ui/template~TemplateBinding#callback]\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the value of the binding. It is the value of the {@link module:ui/template~TemplateBinding#attribute} in\r\n\t * {@link module:ui/template~TemplateBinding#observable}. The value may be processed by the\r\n\t * {@link module:ui/template~TemplateBinding#callback}, if such has been passed to the binding.\r\n\t *\r\n\t * @param {Node} [node] A native DOM node, passed to the custom {@link module:ui/template~TemplateBinding#callback}.\r\n\t * @returns {*} The value of {@link module:ui/template~TemplateBinding#attribute} in\r\n\t * {@link module:ui/template~TemplateBinding#observable}.\r\n\t */\r\n\tgetValue( node ) {\r\n\t\tconst value = this.observable[ this.attribute ];\r\n\r\n\t\treturn this.callback ? this.callback( value, node ) : value;\r\n\t}\r\n\r\n\t/**\r\n\t * Activates the listener which waits for changes of the {@link module:ui/template~TemplateBinding#attribute} in\r\n\t * {@link module:ui/template~TemplateBinding#observable}, then updates the DOM with the aggregated\r\n\t * value of {@link module:ui/template~TemplateValueSchema}.\r\n\t *\r\n\t * @param {module:ui/template~TemplateValueSchema} schema A full schema to generate an attribute or text in the DOM.\r\n\t * @param {Function} updater A DOM updater function used to update the native DOM attribute or text.\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t * @returns {Function} A function to sever the listener binding.\r\n\t */\r\n\tactivateAttributeListener( schema, updater, data ) {\r\n\t\tconst callback = () => syncValueSchemaValue( schema, updater, data );\r\n\r\n\t\tthis.emitter.listenTo( this.observable, 'change:' + this.attribute, callback );\r\n\r\n\t\t// Allows revert of the listener.\r\n\t\treturn () => {\r\n\t\t\tthis.emitter.stopListening( this.observable, 'change:' + this.attribute, callback );\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * Describes either:\r\n *\r\n * * a binding to an {@link module:utils/observablemixin~Observable},\r\n * * or a native DOM event binding.\r\n *\r\n * It is created by the {@link module:ui/template~BindChain#to} method.\r\n *\r\n * @protected\r\n */\r\nexport class TemplateToBinding extends TemplateBinding {\r\n\t/**\r\n\t * Activates the listener for the native DOM event, which when fired, is propagated by\r\n\t * the {@link module:ui/template~TemplateBinding#emitter}.\r\n\t *\r\n\t * @param {String} domEvtName The name of the native DOM event.\r\n\t * @param {String} domSelector The selector in the DOM to filter delegated events.\r\n\t * @param {module:ui/template~RenderData} data Rendering data.\r\n\t * @returns {Function} A function to sever the listener binding.\r\n\t */\r\n\tactivateDomEventListener( domEvtName, domSelector, data ) {\r\n\t\tconst callback = ( evt, domEvt ) => {\r\n\t\t\tif ( !domSelector || domEvt.target.matches( domSelector ) ) {\r\n\t\t\t\tif ( typeof this.eventNameOrFunction == 'function' ) {\r\n\t\t\t\t\tthis.eventNameOrFunction( domEvt );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.observable.fire( this.eventNameOrFunction, domEvt );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.emitter.listenTo( data.node, domEvtName, callback );\r\n\r\n\t\t// Allows revert of the listener.\r\n\t\treturn () => {\r\n\t\t\tthis.emitter.stopListening( data.node, domEvtName, callback );\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * Describes a binding to {@link module:utils/observablemixin~ObservableMixin} created by the {@link module:ui/template~BindChain#if}\r\n * method.\r\n *\r\n * @protected\r\n */\r\nexport class TemplateIfBinding extends TemplateBinding {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tgetValue( node ) {\r\n\t\tconst value = super.getValue( node );\r\n\r\n\t\treturn isFalsy( value ) ? false : ( this.valueIfTrue || true );\r\n\t}\r\n\r\n\t/**\r\n\t * The value of the DOM attribute or text to be set if the {@link module:ui/template~TemplateBinding#attribute} in\r\n\t * {@link module:ui/template~TemplateBinding#observable} is `true`.\r\n\t *\r\n\t * @member {String} [module:ui/template~TemplateIfBinding#valueIfTrue]\r\n\t */\r\n}\r\n\r\n// Checks whether given {@link module:ui/template~TemplateValueSchema} contains a\r\n// {@link module:ui/template~TemplateBinding}.\r\n//\r\n// @param {module:ui/template~TemplateValueSchema} schema\r\n// @returns {Boolean}\r\nfunction hasTemplateBinding( schema ) {\r\n\tif ( !schema ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Normalize attributes with additional data like namespace:\r\n\t//\r\n\t//\t\tclass: {\r\n\t//\t\t\tns: 'abc',\r\n\t//\t\t\tvalue: [ ... ]\r\n\t//\t\t}\r\n\t//\r\n\tif ( schema.value ) {\r\n\t\tschema = schema.value;\r\n\t}\r\n\r\n\tif ( Array.isArray( schema ) ) {\r\n\t\treturn schema.some( hasTemplateBinding );\r\n\t} else if ( schema instanceof TemplateBinding ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n// Assembles the value using {@link module:ui/template~TemplateValueSchema} and stores it in a form of\r\n// an Array. Each entry of the Array corresponds to one of {@link module:ui/template~TemplateValueSchema}\r\n// items.\r\n//\r\n// @param {module:ui/template~TemplateValueSchema} schema\r\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\r\n// @returns {Array}\r\nfunction getValueSchemaValue( schema, node ) {\r\n\treturn schema.map( schemaItem => {\r\n\t\t// Process {@link module:ui/template~TemplateBinding} bindings.\r\n\t\tif ( schemaItem instanceof TemplateBinding ) {\r\n\t\t\treturn schemaItem.getValue( node );\r\n\t\t}\r\n\r\n\t\t// All static values like strings, numbers, and \"falsy\" values (false, null, undefined, '', etc.) just pass.\r\n\t\treturn schemaItem;\r\n\t} );\r\n}\r\n\r\n// A function executed each time the bound Observable attribute changes, which updates the DOM with a value\r\n// constructed from {@link module:ui/template~TemplateValueSchema}.\r\n//\r\n// @param {module:ui/template~TemplateValueSchema} schema\r\n// @param {Function} updater A function which updates the DOM (like attribute or text).\r\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\r\nfunction syncValueSchemaValue( schema, updater, { node } ) {\r\n\tlet value = getValueSchemaValue( schema, node );\r\n\r\n\t// Check if schema is a single Template.bind.if, like:\r\n\t//\r\n\t//\t\tclass: Template.bind.if( 'foo' )\r\n\t//\r\n\tif ( schema.length == 1 && schema[ 0 ] instanceof TemplateIfBinding ) {\r\n\t\tvalue = value[ 0 ];\r\n\t} else {\r\n\t\tvalue = value.reduce( arrayValueReducer, '' );\r\n\t}\r\n\r\n\tif ( isFalsy( value ) ) {\r\n\t\tupdater.remove();\r\n\t} else {\r\n\t\tupdater.set( value );\r\n\t}\r\n}\r\n\r\n// Returns an object consisting of `set` and `remove` functions, which\r\n// can be used in the context of DOM Node to set or reset `textContent`.\r\n// @see module:ui/view~View#_bindToObservable\r\n//\r\n// @param {Node} node DOM Node to be modified.\r\n// @returns {Object}\r\nfunction getTextUpdater( node ) {\r\n\treturn {\r\n\t\tset( value ) {\r\n\t\t\tnode.textContent = value;\r\n\t\t},\r\n\r\n\t\tremove() {\r\n\t\t\tnode.textContent = '';\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Returns an object consisting of `set` and `remove` functions, which\r\n// can be used in the context of DOM Node to set or reset an attribute.\r\n// @see module:ui/view~View#_bindToObservable\r\n//\r\n// @param {Node} node DOM Node to be modified.\r\n// @param {String} attrName Name of the attribute to be modified.\r\n// @param {String} [ns=null] Namespace to use.\r\n// @returns {Object}\r\nfunction getAttributeUpdater( el, attrName, ns ) {\r\n\treturn {\r\n\t\tset( value ) {\r\n\t\t\tel.setAttributeNS( ns, attrName, value );\r\n\t\t},\r\n\r\n\t\tremove() {\r\n\t\t\tel.removeAttributeNS( ns, attrName );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Returns an object consisting of `set` and `remove` functions, which\r\n// can be used in the context of CSSStyleDeclaration to set or remove a style.\r\n// @see module:ui/view~View#_bindToObservable\r\n//\r\n// @param {Node} node DOM Node to be modified.\r\n// @param {String} styleName Name of the style to be modified.\r\n// @returns {Object}\r\nfunction getStyleUpdater( el, styleName ) {\r\n\treturn {\r\n\t\tset( value ) {\r\n\t\t\tel.style[ styleName ] = value;\r\n\t\t},\r\n\r\n\t\tremove() {\r\n\t\t\tel.style[ styleName ] = null;\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Clones definition of the template.\r\n//\r\n// @param {module:ui/template~TemplateDefinition} def\r\n// @returns {module:ui/template~TemplateDefinition}\r\nfunction clone( def ) {\r\n\tconst clone = cloneDeepWith( def, value => {\r\n\t\t// Don't clone the `Template.bind`* bindings because of the references to Observable\r\n\t\t// and DomEmitterMixin instances inside, which would also be traversed and cloned by greedy\r\n\t\t// cloneDeepWith algorithm. There's no point in cloning Observable/DomEmitterMixins\r\n\t\t// along with the definition.\r\n\t\t//\r\n\t\t// Don't clone Template instances if provided as a child. They're simply #render()ed\r\n\t\t// and nothing should interfere.\r\n\t\t//\r\n\t\t// Also don't clone View instances if provided as a child of the Template. The template\r\n\t\t// instance will be extracted from the View during the normalization and there's no need\r\n\t\t// to clone it.\r\n\t\tif ( value && ( value instanceof TemplateBinding || isTemplate( value ) || isView( value ) || isViewCollection( value ) ) ) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t} );\r\n\r\n\treturn clone;\r\n}\r\n\r\n// Normalizes given {@link module:ui/template~TemplateDefinition}.\r\n//\r\n// See:\r\n//  * {@link normalizeAttributes}\r\n//  * {@link normalizeListeners}\r\n//  * {@link normalizePlainTextDefinition}\r\n//  * {@link normalizeTextDefinition}\r\n//\r\n// @param {module:ui/template~TemplateDefinition} def\r\n// @returns {module:ui/template~TemplateDefinition} Normalized definition.\r\nfunction normalize( def ) {\r\n\tif ( typeof def == 'string' ) {\r\n\t\tdef = normalizePlainTextDefinition( def );\r\n\t} else if ( def.text ) {\r\n\t\tnormalizeTextDefinition( def );\r\n\t}\r\n\r\n\tif ( def.on ) {\r\n\t\tdef.eventListeners = normalizeListeners( def.on );\r\n\r\n\t\t// Template mixes EmitterMixin, so delete #on to avoid collision.\r\n\t\tdelete def.on;\r\n\t}\r\n\r\n\tif ( !def.text ) {\r\n\t\tif ( def.attributes ) {\r\n\t\t\tnormalizeAttributes( def.attributes );\r\n\t\t}\r\n\r\n\t\tconst children = [];\r\n\r\n\t\tif ( def.children ) {\r\n\t\t\tif ( isViewCollection( def.children ) ) {\r\n\t\t\t\tchildren.push( def.children );\r\n\t\t\t} else {\r\n\t\t\t\tfor ( const child of def.children ) {\r\n\t\t\t\t\tif ( isTemplate( child ) || isView( child ) || isNode( child ) ) {\r\n\t\t\t\t\t\tchildren.push( child );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchildren.push( new Template( child ) );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdef.children = children;\r\n\t}\r\n\r\n\treturn def;\r\n}\r\n\r\n// Normalizes \"attributes\" section of {@link module:ui/template~TemplateDefinition}.\r\n//\r\n//\t\tattributes: {\r\n//\t\t\ta: 'bar',\r\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\r\n//\t\t\tc: {\r\n//\t\t\t\tvalue: 'bar'\r\n//\t\t\t}\r\n//\t\t}\r\n//\r\n// becomes\r\n//\r\n//\t\tattributes: {\r\n//\t\t\ta: [ 'bar' ],\r\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\r\n//\t\t\tc: {\r\n//\t\t\t\tvalue: [ 'bar' ]\r\n//\t\t\t}\r\n//\t\t}\r\n//\r\n// @param {Object} attrs\r\nfunction normalizeAttributes( attrs ) {\r\n\tfor ( const a in attrs ) {\r\n\t\tif ( attrs[ a ].value ) {\r\n\t\t\tattrs[ a ].value = [].concat( attrs[ a ].value );\r\n\t\t}\r\n\r\n\t\tarrayify( attrs, a );\r\n\t}\r\n}\r\n\r\n// Normalizes \"on\" section of {@link module:ui/template~TemplateDefinition}.\r\n//\r\n//\t\ton: {\r\n//\t\t\ta: 'bar',\r\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\r\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\r\n//\t\t}\r\n//\r\n// becomes\r\n//\r\n//\t\ton: {\r\n//\t\t\ta: [ 'bar' ],\r\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\r\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\r\n//\t\t}\r\n//\r\n// @param {Object} listeners\r\n// @returns {Object} Object containing normalized listeners.\r\nfunction normalizeListeners( listeners ) {\r\n\tfor ( const l in listeners ) {\r\n\t\tarrayify( listeners, l );\r\n\t}\r\n\r\n\treturn listeners;\r\n}\r\n\r\n// Normalizes \"string\" {@link module:ui/template~TemplateDefinition}.\r\n//\r\n//\t\t\"foo\"\r\n//\r\n// becomes\r\n//\r\n//\t\t{ text: [ 'foo' ] },\r\n//\r\n// @param {String} def\r\n// @returns {module:ui/template~TemplateDefinition} Normalized template definition.\r\nfunction normalizePlainTextDefinition( def ) {\r\n\treturn {\r\n\t\ttext: [ def ]\r\n\t};\r\n}\r\n\r\n// Normalizes text {@link module:ui/template~TemplateDefinition}.\r\n//\r\n//\t\tchildren: [\r\n//\t\t\t{ text: 'def' },\r\n//\t\t\t{ text: {@link module:ui/template~TemplateBinding} }\r\n//\t\t]\r\n//\r\n// becomes\r\n//\r\n//\t\tchildren: [\r\n//\t\t\t{ text: [ 'def' ] },\r\n//\t\t\t{ text: [ {@link module:ui/template~TemplateBinding} ] }\r\n//\t\t]\r\n//\r\n// @param {module:ui/template~TemplateDefinition} def\r\nfunction normalizeTextDefinition( def ) {\r\n\tif ( !Array.isArray( def.text ) ) {\r\n\t\tdef.text = [ def.text ];\r\n\t}\r\n}\r\n\r\n// Wraps an entry in Object in an Array, if not already one.\r\n//\r\n//\t\t{\r\n//\t\t\tx: 'y',\r\n//\t\t\ta: [ 'b' ]\r\n//\t\t}\r\n//\r\n// becomes\r\n//\r\n//\t\t{\r\n//\t\t\tx: [ 'y' ],\r\n//\t\t\ta: [ 'b' ]\r\n//\t\t}\r\n//\r\n// @param {Object} obj\r\n// @param {String} key\r\nfunction arrayify( obj, key ) {\r\n\tif ( !Array.isArray( obj[ key ] ) ) {\r\n\t\tobj[ key ] = [ obj[ key ] ];\r\n\t}\r\n}\r\n\r\n// A helper which concatenates the value avoiding unwanted\r\n// leading white spaces.\r\n//\r\n// @param {String} prev\r\n// @param {String} cur\r\n// @returns {String}\r\nfunction arrayValueReducer( prev, cur ) {\r\n\tif ( isFalsy( cur ) ) {\r\n\t\treturn prev;\r\n\t} else if ( isFalsy( prev ) ) {\r\n\t\treturn cur;\r\n\t} else {\r\n\t\treturn `${ prev } ${ cur }`;\r\n\t}\r\n}\r\n\r\n// Extends one object defined in the following format:\r\n//\r\n//\t\t{\r\n//\t\t\tkey1: [Array1],\r\n//\t\t\tkey2: [Array2],\r\n//\t\t\t...\r\n//\t\t\tkeyN: [ArrayN]\r\n//\t\t}\r\n//\r\n// with another object of the same data format.\r\n//\r\n// @param {Object} obj Base object.\r\n// @param {Object} ext Object extending base.\r\n// @returns {String}\r\nfunction extendObjectValueArray( obj, ext ) {\r\n\tfor ( const a in ext ) {\r\n\t\tif ( obj[ a ] ) {\r\n\t\t\tobj[ a ].push( ...ext[ a ] );\r\n\t\t} else {\r\n\t\t\tobj[ a ] = ext[ a ];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// A helper for {@link module:ui/template~Template#extend}. Recursively extends {@link module:ui/template~Template} instance\r\n// with content from {@link module:ui/template~TemplateDefinition}. See {@link module:ui/template~Template#extend} to learn more.\r\n//\r\n// @param {module:ui/template~Template} def A template instance to be extended.\r\n// @param {module:ui/template~TemplateDefinition} def A definition which is to extend the template instance.\r\nfunction extendTemplate( template, def ) {\r\n\tif ( def.attributes ) {\r\n\t\tif ( !template.attributes ) {\r\n\t\t\ttemplate.attributes = {};\r\n\t\t}\r\n\r\n\t\textendObjectValueArray( template.attributes, def.attributes );\r\n\t}\r\n\r\n\tif ( def.eventListeners ) {\r\n\t\tif ( !template.eventListeners ) {\r\n\t\t\ttemplate.eventListeners = {};\r\n\t\t}\r\n\r\n\t\textendObjectValueArray( template.eventListeners, def.eventListeners );\r\n\t}\r\n\r\n\tif ( def.text ) {\r\n\t\ttemplate.text.push( ...def.text );\r\n\t}\r\n\r\n\tif ( def.children && def.children.length ) {\r\n\t\tif ( template.children.length != def.children.length ) {\r\n\t\t\t/**\r\n\t\t\t * The number of children in extended definition does not match.\r\n\t\t\t *\r\n\t\t\t * @error ui-template-extend-children-mismatch\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError(\r\n\t\t\t\t'ui-template-extend-children-mismatch: The number of children in extended definition does not match.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet childIndex = 0;\r\n\r\n\t\tfor ( const childDef of def.children ) {\r\n\t\t\textendTemplate( template.children[ childIndex++ ], childDef );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Checks if value is \"falsy\".\r\n// Note: 0 (Number) is not \"falsy\" in this context.\r\n//\r\n// @private\r\n// @param {*} value Value to be checked.\r\nfunction isFalsy( value ) {\r\n\treturn !value && value !== 0;\r\n}\r\n\r\n// Checks if the item is an instance of {@link module:ui/view~View}\r\n//\r\n// @private\r\n// @param {*} value Value to be checked.\r\nfunction isView( item ) {\r\n\treturn item instanceof View;\r\n}\r\n\r\n// Checks if the item is an instance of {@link module:ui/template~Template}\r\n//\r\n// @private\r\n// @param {*} value Value to be checked.\r\nfunction isTemplate( item ) {\r\n\treturn item instanceof Template;\r\n}\r\n\r\n// Checks if the item is an instance of {@link module:ui/viewcollection~ViewCollection}\r\n//\r\n// @private\r\n// @param {*} value Value to be checked.\r\nfunction isViewCollection( item ) {\r\n\treturn item instanceof ViewCollection;\r\n}\r\n\r\n// Creates an empty skeleton for {@link module:ui/template~Template#revert}\r\n// data.\r\n//\r\n// @private\r\nfunction getEmptyRevertData() {\r\n\treturn {\r\n\t\tchildren: [],\r\n\t\tbindings: [],\r\n\t\tattributes: {}\r\n\t};\r\n}\r\n\r\n// Checks whether an attribute should be extended when\r\n// {@link module:ui/template~Template#apply} is called.\r\n//\r\n// @private\r\n// @param {String} attrName Attribute name to check.\r\nfunction shouldExtend( attrName ) {\r\n\treturn attrName == 'class' || attrName == 'style';\r\n}\r\n\r\n/**\r\n * A definition of the {@link module:ui/template~Template}. It describes what kind of\r\n * node a template will render (HTML element or text), attributes of an element, DOM event\r\n * listeners and children.\r\n *\r\n * Also see:\r\n * * {@link module:ui/template~TemplateValueSchema} to learn about HTML element attributes,\r\n * * {@link module:ui/template~TemplateListenerSchema} to learn about DOM event listeners.\r\n *\r\n * A sample definition on an HTML element can look like this:\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\t\t\tchildren: [\r\n *\t\t\t\t{\r\n *\t\t\t\t\ttag: 'span',\r\n *\t\t\t\t\tattributes: { ... },\r\n *\t\t\t\t\tchildren: [ ... ],\r\n *\t\t\t\t},\r\n *\t\t\t\t{\r\n *\t\t\t\t\ttext: 'static–text'\r\n *\t\t\t\t},\r\n *\t\t\t\t'also-static–text',\r\n *\t\t\t],\r\n *\t\t\tattributes: {\r\n *\t\t\t\tclass: {@link module:ui/template~TemplateValueSchema},\r\n *\t\t\t\tid: {@link module:ui/template~TemplateValueSchema},\r\n *\t\t\t\tstyle: {@link module:ui/template~TemplateValueSchema}\r\n *\r\n *\t\t\t\t// ...\r\n *\t\t\t},\r\n *\t\t\ton: {\r\n *\t\t\t\t'click': {@link module:ui/template~TemplateListenerSchema}\r\n *\r\n *\t\t\t\t// Document.querySelector format is also accepted.\r\n *\t\t\t\t'keyup@a.some-class': {@link module:ui/template~TemplateListenerSchema}\r\n *\r\n *\t\t\t\t// ...\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * A {@link module:ui/view~View}, another {@link module:ui/template~Template} or a native DOM node\r\n * can also become a child of a template. When a view is passed, its {@link module:ui/view~View#element} is used:\r\n *\r\n *\t\tconst view = new SomeView();\r\n *\t\tconst childTemplate = new Template( { ... } );\r\n *\t\tconst childNode = document.createElement( 'b' );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\r\n *\t\t\tchildren: [\r\n *\t\t\t\t// view#element will be added as a child of this <p>.\r\n *\t\t\t\tview,\r\n *\r\n * \t\t\t\t// The output of childTemplate.render() will be added here.\r\n *\t\t\t\tchildTemplate,\r\n *\r\n *\t\t\t\t// Native DOM nodes are included directly in the rendered output.\r\n *\t\t\t\tchildNode\r\n *\t\t\t]\r\n *\t\t} );\r\n *\r\n * An entire {@link module:ui/viewcollection~ViewCollection} can be used as a child in the definition:\r\n *\r\n *\t\tconst collection = new ViewCollection();\r\n *\t\tcollection.add( someView );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\r\n *\t\t\tchildren: collection\r\n *\t\t} );\r\n *\r\n * @typedef module:ui/template~TemplateDefinition\r\n * @type Object\r\n *\r\n * @property {String} tag See the template {@link module:ui/template~Template#tag} property.\r\n *\r\n * @property {Array.<module:ui/template~TemplateDefinition>} [children]\r\n * See the template {@link module:ui/template~Template#children} property.\r\n *\r\n * @property {Object.<String, module:ui/template~TemplateValueSchema>} [attributes]\r\n * See the template {@link module:ui/template~Template#attributes} property.\r\n *\r\n * @property {String|module:ui/template~TemplateValueSchema|Array.<String|module:ui/template~TemplateValueSchema>} [text]\r\n * See the template {@link module:ui/template~Template#text} property.\r\n *\r\n * @property {Object.<String, module:ui/template~TemplateListenerSchema>} [on]\r\n * See the template {@link module:ui/template~Template#eventListeners} property.\r\n */\r\n\r\n/**\r\n * Describes a value of an HTML element attribute or `textContent`. It allows combining multiple\r\n * data sources like static values and {@link module:utils/observablemixin~Observable} attributes.\r\n *\r\n * Also see:\r\n * * {@link module:ui/template~TemplateDefinition} to learn where to use it,\r\n * * {@link module:ui/template~Template.bind} to learn how to configure\r\n * {@link module:utils/observablemixin~Observable} attribute bindings,\r\n * * {@link module:ui/template~Template#render} to learn how to render a template,\r\n * * {@link module:ui/template~BindChain#to `to()`} and {@link module:ui/template~BindChain#if `if()`}\r\n * methods to learn more about bindings.\r\n *\r\n * Attribute values can be described in many different ways:\r\n *\r\n *\t\t// Bind helper will create bindings to attributes of the observable.\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\t\t\tattributes: {\r\n *\t\t\t\t// A plain string schema.\r\n *\t\t\t\t'class': 'static-text',\r\n *\r\n *\t\t\t\t// An object schema, binds to the \"foo\" attribute of the\r\n *\t\t\t\t// observable and follows its value.\r\n *\t\t\t\t'class': bind.to( 'foo' ),\r\n *\r\n *\t\t\t\t// An array schema, combines the above.\r\n *\t\t\t\t'class': [\r\n *\t\t\t\t\t'static-text',\r\n *\t\t\t\t\tbind.to( 'bar', () => { ... } ),\r\n *\r\n * \t\t\t\t\t// Bindings can also be conditional.\r\n *\t\t\t\t\tbind.if( 'baz', 'class-when-baz-is-true' )\r\n *\t\t\t\t],\r\n *\r\n *\t\t\t\t// An array schema, with a custom namespace, e.g. useful for creating SVGs.\r\n *\t\t\t\t'class': {\r\n *\t\t\t\t\tns: 'http://ns.url',\r\n *\t\t\t\t\tvalue: [\r\n *\t\t\t\t\t\tbind.if( 'baz', 'value-when-true' ),\r\n *\t\t\t\t\t\t'static-text'\r\n *\t\t\t\t\t]\r\n *\t\t\t\t},\r\n *\r\n *\t\t\t\t// An object schema, specific for styles.\r\n *\t\t\t\tstyle: {\r\n *\t\t\t\t\tcolor: 'red',\r\n *\t\t\t\t\tbackgroundColor: bind.to( 'qux', () => { ... } )\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * Text nodes can also have complex values:\r\n *\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\t// Will render a \"foo\" text node.\r\n *\t\tnew Template( {\r\n *\t\t\ttext: 'foo'\r\n *\t\t} );\r\n *\r\n *\t\t// Will render a \"static text: {observable.foo}\" text node.\r\n *\t\t// The text of the node will be updated as the \"foo\" attribute changes.\r\n *\t\tnew Template( {\r\n *\t\t\ttext: [\r\n *\t\t\t\t'static text: ',\r\n *\t\t\t\tbind.to( 'foo', () => { ... } )\r\n *\t\t\t]\r\n *\t\t} );\r\n *\r\n * @typedef module:ui/template~TemplateValueSchema\r\n * @type {Object|String|Array}\r\n */\r\n\r\n/**\r\n * Describes an event listener attached to an HTML element. Such listener can propagate DOM events\r\n * through an {@link module:utils/observablemixin~Observable} instance, execute custom callbacks\r\n * or both, if necessary.\r\n *\r\n * Also see:\r\n * * {@link module:ui/template~TemplateDefinition} to learn more about template definitions,\r\n * * {@link module:ui/template~BindChain#to `to()`} method to learn more about bindings.\r\n *\r\n * Check out different ways of attaching event listeners below:\r\n *\r\n *\t\t// Bind helper will propagate events through the observable.\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\t\t\ton: {\r\n *\t\t\t\t// An object schema. The observable will fire the \"clicked\" event upon DOM \"click\".\r\n *\t\t\t\tclick: bind.to( 'clicked' )\r\n *\r\n *\t\t\t\t// An object schema. It will work for \"click\" event on \"a.foo\" children only.\r\n *\t\t\t\t'click@a.foo': bind.to( 'clicked' )\r\n *\r\n *\t\t\t\t// An array schema, makes the observable propagate multiple events.\r\n *\t\t\t\tclick: [\r\n *\t\t\t\t\tbind.to( 'clicked' ),\r\n *\t\t\t\t\tbind.to( 'executed' )\r\n *\t\t\t\t],\r\n *\r\n *\t\t\t\t// An array schema with a custom callback.\r\n *\t\t\t\t'click@a.foo': {\r\n *\t\t\t\t\tbind.to( 'clicked' ),\r\n *\t\t\t\t\tbind.to( evt => {\r\n *\t\t\t\t\t\tconsole.log( `${ evt.target } has been clicked!` );\r\n *\t\t\t\t\t} }\r\n *\t\t\t\t}\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * @typedef module:ui/template~TemplateListenerSchema\r\n * @type {Object|String|Array}\r\n */\r\n\r\n/**\r\n * The return value of {@link ~Template.bind `Template.bind()`}. It provides `to()` and `if()`\r\n * methods to create the {@link module:utils/observablemixin~Observable observable} attribute and event bindings.\r\n *\r\n * @interface module:ui/template~BindChain\r\n */\r\n\r\n/**\r\n * Binds an {@link module:utils/observablemixin~Observable observable} to either:\r\n *\r\n * * an HTML element attribute or a text node `textContent`, so it remains in sync with the observable\r\n * attribute as it changes,\r\n * * or an HTML element DOM event, so the DOM events are propagated through an observable.\r\n *\r\n * Some common use cases of `to()` bindings are presented below:\r\n *\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'p',\r\n *\t\t\tattributes: {\r\n *\t\t\t\t// class=\"...\" attribute gets bound to `observable#a`\r\n *\t\t\t\tclass: bind.to( 'a' )\r\n *\t\t\t},\r\n *\t\t\tchildren: [\r\n *\t\t\t\t// <p>...</p> gets bound to observable#b; always `toUpperCase()`.\r\n *\t\t\t\t{\r\n *\t\t\t\t\ttext: bind.to( 'b', ( value, node ) => value.toUpperCase() )\r\n *\t\t\t\t}\r\n *\t\t\t],\r\n *\t\t\ton: {\r\n *\t\t\t\tclick: [\r\n *\t\t\t\t\t// An observable will fire \"clicked\" upon \"click\" in the DOM.\r\n *\t\t\t\t\tbind.to( 'clicked' ),\r\n *\r\n *\t\t\t\t\t// A custom callback will be executed upon \"click\" in the DOM.\r\n *\t\t\t\t\tbind.to( () => {\r\n *\t\t\t\t\t\t...\r\n *\t\t\t\t\t} )\r\n *\t\t\t\t]\r\n *\t\t\t}\r\n *\t\t} ).render();\r\n *\r\n * Learn more about using `to()` in the {@link module:ui/template~TemplateValueSchema} and\r\n * {@link module:ui/template~TemplateListenerSchema}.\r\n *\r\n * @method #to\r\n * @param {String|Function} eventNameOrFunctionOrAttribute An attribute name of\r\n * {@link module:utils/observablemixin~Observable} or a DOM event name or an event callback.\r\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\r\n * @returns {module:ui/template~TemplateBinding}\r\n */\r\n\r\n/**\r\n * Binds an {@link module:utils/observablemixin~Observable observable} to an HTML element attribute or a text\r\n * node `textContent` so it remains in sync with the observable attribute as it changes.\r\n *\r\n * Unlike {@link module:ui/template~BindChain#to}, it controls the presence of the attribute or `textContent`\r\n * depending on the \"falseness\" of an {@link module:utils/observablemixin~Observable} attribute.\r\n *\r\n *\t\tconst bind = Template.bind( observable, emitter );\r\n *\r\n *\t\tnew Template( {\r\n *\t\t\ttag: 'input',\r\n *\t\t\tattributes: {\r\n *\t\t\t\t// <input checked> when `observable#a` is not undefined/null/false/''\r\n *\t\t\t\t// <input> when `observable#a` is undefined/null/false\r\n *\t\t\t\tchecked: bind.if( 'a' )\r\n *\t\t\t},\r\n *\t\t\tchildren: [\r\n *\t\t\t\t{\r\n *\t\t\t\t\t// <input>\"b-is-not-set\"</input> when `observable#b` is undefined/null/false/''\r\n *\t\t\t\t\t// <input></input> when `observable#b` is not \"falsy\"\r\n *\t\t\t\t\ttext: bind.if( 'b', 'b-is-not-set', ( value, node ) => !value )\r\n *\t\t\t\t}\r\n *\t\t\t]\r\n *\t\t} ).render();\r\n *\r\n * Learn more about using `if()` in the {@link module:ui/template~TemplateValueSchema}.\r\n *\r\n * @method #if\r\n * @param {String} attribute An attribute name of {@link module:utils/observablemixin~Observable} used in the binding.\r\n * @param {String} [valueIfTrue] Value set when the {@link module:utils/observablemixin~Observable} attribute is not\r\n * undefined/null/false/'' (empty string).\r\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\r\n * @returns {module:ui/template~TemplateBinding}\r\n */\r\n\r\n/**\r\n * The {@link module:ui/template~Template#_renderNode} configuration.\r\n *\r\n * @private\r\n * @interface module:ui/template~RenderData\r\n */\r\n\r\n/**\r\n * Tells {@link module:ui/template~Template#_renderNode} to render\r\n * children into `DocumentFragment` first and then append the fragment\r\n * to the parent element. It is a speed optimization.\r\n *\r\n * @member {Boolean} #intoFragment\r\n */\r\n\r\n/**\r\n * A node which is being rendered.\r\n *\r\n * @member {HTMLElement|Text} #node\r\n */\r\n\r\n/**\r\n * Indicates whether the {@module:ui/template~RenderNodeOptions#node} has\r\n * been provided by {@module:ui/template~Template#apply}.\r\n *\r\n * @member {Boolean} #isApplying\r\n */\r\n\r\n/**\r\n * An object storing the data that helps {@module:ui/template~Template#revert}\r\n * bringing back an element to its initial state, i.e. before\r\n * {@module:ui/template~Template#apply} was called.\r\n *\r\n * @member {Object} #revertData\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/view\r\n */\r\n\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\nimport ViewCollection from './viewcollection';\r\nimport Template from './template';\r\nimport DomEmitterMixin from '@ckeditor/ckeditor5-utils/src/dom/emittermixin';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\r\n\r\nimport '../theme/globals/globals.css';\r\n\r\n/**\r\n * The basic view class, which represents an HTML element created out of a\r\n * {@link module:ui/view~View#template}. Views are building blocks of the user interface and handle\r\n * interaction\r\n *\r\n * Views {@link module:ui/view~View#registerChild aggregate} children in\r\n * {@link module:ui/view~View#createCollection collections} and manage the life cycle of DOM\r\n * listeners e.g. by handling rendering and destruction.\r\n *\r\n * See the {@link module:ui/template~TemplateDefinition} syntax to learn more about shaping view\r\n * elements, attributes and listeners.\r\n *\r\n *\t\tclass SampleView extends View {\r\n *\t\t\tconstructor( locale ) {\r\n *\t\t\t\tsuper( locale );\r\n *\r\n *\t\t\t\tconst bind = this.bindTemplate;\r\n *\r\n *\t\t\t\t// Views define their interface (state) using observable attributes.\r\n *\t\t\t\tthis.set( 'elementClass', 'bar' );\r\n *\r\n *\t\t\t\tthis.setTemplate( {\r\n *\t\t\t\t\ttag: 'p',\r\n *\r\n *\t\t\t\t\t// The element of the view can be defined with its children.\r\n *\t\t\t\t\tchildren: [\r\n *\t\t\t\t\t\t'Hello',\r\n *\t\t\t\t\t\t{\r\n *\t\t\t\t\t\t\ttag: 'b',\r\n *\t\t\t\t\t\t\tchildren: [ 'world!' ]\r\n *\t\t\t\t\t\t}\r\n *\t\t\t\t\t],\r\n *\t\t\t\t\tattributes: {\r\n *\t\t\t\t\t\tclass: [\r\n *\t\t\t\t\t\t\t'foo',\r\n *\r\n *\t\t\t\t\t\t\t// Observable attributes control the state of the view in DOM.\r\n *\t\t\t\t\t\t\tbind.to( 'elementClass' )\r\n *\t\t\t\t\t\t]\r\n *\t\t\t\t\t},\r\n *\t\t\t\t\ton: {\r\n *\t\t\t\t\t\t// Views listen to DOM events and propagate them.\r\n *\t\t\t\t\t\tclick: bind.to( 'clicked' )\r\n *\t\t\t\t\t}\r\n *\t\t\t\t} );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n *\t\tconst view = new SampleView( locale );\r\n *\r\n *\t\tview.render();\r\n *\r\n *\t\t// Append <p class=\"foo bar\">Hello<b>world</b></p> to the <body>\r\n *\t\tdocument.body.appendChild( view.element );\r\n *\r\n *\t\t// Change the class attribute to <p class=\"foo baz\">Hello<b>world</b></p>\r\n *\t\tview.elementClass = 'baz';\r\n *\r\n *\t\t// Respond to the \"click\" event in DOM by executing a custom action.\r\n *\t\tview.on( 'clicked', () => {\r\n *\t\t\tconsole.log( 'The view has been clicked!' );\r\n *\t\t} );\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class View {\r\n\t/**\r\n\t * Creates an instance of the {@link module:ui/view~View} class.\r\n\t *\r\n\t * Also see {@link #render}.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The localization services instance.\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\t/**\r\n\t\t * An HTML element of the view. `null` until {@link #render rendered}\r\n\t\t * from the {@link #template}.\r\n\t\t *\r\n\t\t *\t\tclass SampleView extends View {\r\n\t\t *\t\t\tconstructor() {\r\n\t\t *\t\t\t\tsuper();\r\n\t\t *\r\n\t\t *\t\t\t\t// A template instance the #element will be created from.\r\n\t\t *\t\t\t\tthis.setTemplate( {\r\n\t\t *\t\t\t\t\ttag: 'p'\r\n\t\t *\r\n\t\t *\t\t\t\t\t// ...\r\n\t\t *\t\t\t\t} );\r\n\t\t *\t\t\t}\r\n\t\t *\t\t}\r\n\t\t *\r\n\t\t *\t\tconst view = new SampleView();\r\n\t\t *\r\n\t\t *\t\t// Renders the #template.\r\n\t\t *\t\tview.render();\r\n\t\t *\r\n\t\t *\t\t// Append the HTML element of the view to <body>.\r\n\t\t *\t\tdocument.body.appendChild( view.element );\r\n\t\t *\r\n\t\t * **Note**: The element of the view can also be assigned directly:\r\n\t\t *\r\n\t\t *\t\tview.element = document.querySelector( '#my-container' );\r\n\t\t *\r\n\t\t * @member {HTMLElement}\r\n\t\t */\r\n\t\tthis.element = null;\r\n\r\n\t\t/**\r\n\t\t * Set `true` when the view has already been {@link module:ui/view~View#render rendered}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #isRendered\r\n\t\t */\r\n\t\tthis.isRendered = false;\r\n\r\n\t\t/**\r\n\t\t * A set of tools to localize the user interface.\r\n\t\t *\r\n\t\t * Also see {@link module:core/editor/editor~Editor#locale}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/locale~Locale}\r\n\t\t */\r\n\t\tthis.locale = locale;\r\n\r\n\t\t/**\r\n\t\t * Shorthand for {@link module:utils/locale~Locale#t}.\r\n\t\t *\r\n\t\t * Note: If {@link #locale} instance hasn't been passed to the view this method may not\r\n\t\t * be available.\r\n\t\t *\r\n\t\t * @see module:utils/locale~Locale#t\r\n\t\t * @method\r\n\t\t */\r\n\t\tthis.t = locale && locale.t;\r\n\r\n\t\t/**\r\n\t\t * Collections registered with {@link #createCollection}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Set.<module:ui/viewcollection~ViewCollection>}\r\n\t\t */\r\n\t\tthis._viewCollections = new Collection();\r\n\r\n\t\t/**\r\n\t\t * A collection of view instances, which have been added directly\r\n\t\t * into the {@link module:ui/template~Template#children}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis._unboundChildren = this.createCollection();\r\n\r\n\t\t// Pass parent locale to its children.\r\n\t\tthis._viewCollections.on( 'add', ( evt, collection ) => {\r\n\t\t\tcollection.locale = locale;\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * Template of this view. It provides the {@link #element} representing\r\n\t\t * the view in DOM, which is {@link #render rendered}.\r\n\t\t *\r\n\t\t * @member {module:ui/template~Template} #template\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Cached {@link module:ui/template~BindChain bind chain} object created by the\r\n\t\t * {@link #template}. See {@link #bindTemplate}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object} #_bindTemplate\r\n\t\t */\r\n\r\n\t\tthis.decorate( 'render' );\r\n\t}\r\n\r\n\t/**\r\n\t * Shorthand for {@link module:ui/template~Template.bind}, a binding\r\n\t * {@link module:ui/template~BindChain interface} pre–configured for the view instance.\r\n\t *\r\n\t * It provides {@link module:ui/template~BindChain#to `to()`} and\r\n\t * {@link module:ui/template~BindChain#if `if()`} methods that initialize bindings with\r\n\t * observable attributes and attach DOM listeners.\r\n\t *\r\n\t *\t\tclass SampleView extends View {\r\n\t *\t\t\tconstructor( locale ) {\r\n\t *\t\t\t\tsuper( locale );\r\n\t *\r\n\t *\t\t\t\tconst bind = this.bindTemplate;\r\n\t *\r\n\t *\t\t\t\t// These {@link module:utils/observablemixin~Observable observable} attributes will control\r\n\t *\t\t\t\t// the state of the view in DOM.\r\n\t *\t\t\t\tthis.set( {\r\n\t *\t\t\t\t\telementClass: 'foo',\r\n\t *\t\t\t\t \tisEnabled: true\r\n\t *\t\t\t\t } );\r\n\t *\r\n\t *\t\t\t\tthis.setTemplate( {\r\n\t *\t\t\t\t\ttag: 'p',\r\n\t *\r\n\t *\t\t\t\t\tattributes: {\r\n\t *\t\t\t\t\t\t// The class HTML attribute will follow elementClass\r\n\t *\t\t\t\t\t\t// and isEnabled view attributes.\r\n\t *\t\t\t\t\t\tclass: [\r\n\t *\t\t\t\t\t\t\tbind.to( 'elementClass' )\r\n\t *\t\t\t\t\t\t\tbind.if( 'isEnabled', 'present-when-enabled' )\r\n\t *\t\t\t\t\t\t]\r\n\t *\t\t\t\t\t},\r\n\t *\r\n\t *\t\t\t\t\ton: {\r\n\t *\t\t\t\t\t\t// The view will fire the \"clicked\" event upon clicking <p> in DOM.\r\n\t *\t\t\t\t\t\tclick: bind.to( 'clicked' )\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t} );\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t * @method #bindTemplate\r\n\t */\r\n\tget bindTemplate() {\r\n\t\tif ( this._bindTemplate ) {\r\n\t\t\treturn this._bindTemplate;\r\n\t\t}\r\n\r\n\t\treturn ( this._bindTemplate = Template.bind( this, this ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new collection of views, which can be used as\r\n\t * {@link module:ui/template~Template#children} of this view.\r\n\t *\r\n\t *\t\tclass SampleView extends View {\r\n\t *\t\t\tconstructor( locale ) {\r\n\t *\t\t\t\tsuper( locale );\r\n\t *\r\n\t *\t\t\t\tthis.items = this.createCollection();\r\n \t *\r\n\t *\t\t\t\tthis.setTemplate( {\r\n\t *\t\t\t\t\ttag: 'p',\r\n\t *\r\n\t *\t\t\t\t\t// `items` collection will render here.\r\n\t *\t\t\t\t\tchildren: this.items\r\n\t *\t\t\t\t} );\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tconst view = new SampleView( locale );\r\n\t *\t\tconst child = new ChildView( locale );\r\n\t *\r\n\t *\t\tview.render();\r\n\t *\r\n\t *\t\t// It will append <p></p> to the <body>.\r\n\t *\t\tdocument.body.appendChild( view.element );\r\n\t *\r\n\t *\t\t// From now on the child is nested under its parent, which is also reflected in DOM.\r\n\t *\t\t// <p><child#element></p>\r\n\t *\t\tview.items.add( child );\r\n\t *\r\n\t * @returns {module:ui/viewcollection~ViewCollection} A new collection of view instances.\r\n\t */\r\n\tcreateCollection() {\r\n\t\tconst collection = new ViewCollection();\r\n\r\n\t\tthis._viewCollections.add( collection );\r\n\r\n\t\treturn collection;\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a new child view under the view instance. Once registered, a child\r\n\t * view is managed by its parent, including {@link #render rendering}\r\n\t * and {@link #destroy destruction}.\r\n\t *\r\n\t * To revert this, use {@link #deregisterChild}.\r\n\t *\r\n\t *\t\tclass SampleView extends View {\r\n\t *\t\t\tconstructor( locale ) {\r\n\t *\t\t\t\tsuper( locale );\r\n\t *\r\n\t *\t\t\t\tthis.childA = new SomeChildView( locale );\r\n\t *\t\t\t\tthis.childB = new SomeChildView( locale );\r\n\t *\r\n\t *\t\t\t\tthis.setTemplate( { tag: 'p' } );\r\n\t *\r\n\t *\t\t\t\t// Register the children.\r\n\t *\t\t\t\tthis.registerChild( [ this.childA, this.childB ] );\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\trender() {\r\n\t *\t\t\t\tsuper.render();\r\n\t *\r\n\t *\t\t\t\tthis.element.appendChild( this.childA.element );\r\n\t *\t\t\t\tthis.element.appendChild( this.childB.element );\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tconst view = new SampleView( locale );\r\n\t *\r\n\t *\t\tview.render();\r\n\t *\r\n\t *\t\t// Will append <p><childA#element><b></b><childB#element></p>.\r\n\t *\t\tdocument.body.appendChild( view.element );\r\n\t *\r\n\t * **Note**: There's no need to add child views if they're already referenced in the\r\n\t * {@link #template}:\r\n\t *\r\n\t *\t\tclass SampleView extends View {\r\n\t *\t\t\tconstructor( locale ) {\r\n\t *\t\t\t\tsuper( locale );\r\n\t *\r\n\t *\t\t\t\tthis.childA = new SomeChildView( locale );\r\n\t *\t\t\t\tthis.childB = new SomeChildView( locale );\r\n\t *\r\n\t *\t\t\t\tthis.setTemplate( {\r\n\t *\t\t\t\t\ttag: 'p',\r\n\t *\r\n \t *\t\t\t\t\t// These children will be added automatically. There's no\r\n \t *\t\t\t\t\t// need to call {@link #registerChild} for any of them.\r\n\t *\t\t\t\t\tchildren: [ this.childA, this.childB ]\r\n\t *\t\t\t\t} );\r\n\t *\t\t\t}\r\n\t *\r\n\t *\t\t\t// ...\r\n\t *\t\t}\r\n\t *\r\n\t * @param {module:ui/view~View|Iterable.<module:ui/view~View>} children Children views to be registered.\r\n\t */\r\n\tregisterChild( children ) {\r\n\t\tif ( !isIterable( children ) ) {\r\n\t\t\tchildren = [ children ];\r\n\t\t}\r\n\r\n\t\tfor ( const child of children ) {\r\n\t\t\tthis._unboundChildren.add( child );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The opposite of {@link #registerChild}. Removes a child view from this view instance.\r\n\t * Once removed, the child is no longer managed by its parent, e.g. it can safely\r\n\t * become a child of another parent view.\r\n\t *\r\n\t * @see #registerChild\r\n\t * @param {module:ui/view~View|Iterable.<module:ui/view~View>} children Child views to be removed.\r\n\t */\r\n\tderegisterChild( children ) {\r\n\t\tif ( !isIterable( children ) ) {\r\n\t\t\tchildren = [ children ];\r\n\t\t}\r\n\r\n\t\tfor ( const child of children ) {\r\n\t\t\tthis._unboundChildren.remove( child );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the {@link #template} of the view with with given definition.\r\n\t *\r\n\t * A shorthand for:\r\n\t *\r\n\t *\t\tview.setTemplate( definition );\r\n\t *\r\n\t * @param {module:ui/template~TemplateDefinition} definition Definition of view's template.\r\n\t */\r\n\tsetTemplate( definition ) {\r\n\t\tthis.template = new Template( definition );\r\n\t}\r\n\r\n\t/**\r\n\t * {@link module:ui/template~Template.extend Extends} the {@link #template} of the view with\r\n\t * with given definition.\r\n\t *\r\n\t * A shorthand for:\r\n\t *\r\n\t *\t\tTemplate.extend( view.template, definition );\r\n\t *\r\n\t * **Note**: Is requires the {@link #template} to be already set. See {@link #setTemplate}.\r\n\t *\r\n\t * @param {module:ui/template~TemplateDefinition} definition Definition which\r\n\t * extends the {@link #template}.\r\n\t */\r\n\textendTemplate( definition ) {\r\n\t\tTemplate.extend( this.template, definition );\r\n\t}\r\n\r\n\t/**\r\n\t * Recursively renders the view.\r\n\t *\r\n\t * Once the view is rendered:\r\n\t * * the {@link #element} becomes an HTML element out of {@link #template},\r\n\t * * the {@link #isRendered} flag is set `true`.\r\n\t *\r\n\t * **Note**: The children of the view:\r\n\t * * defined directly in the {@link #template}\r\n\t * * residing in collections created by the {@link #createCollection} method,\r\n\t * * and added by {@link #registerChild}\r\n\t * are also rendered in the process.\r\n\t *\r\n\t * In general, `render()` method is the right place to keep the code which refers to the\r\n\t * {@link #element} and should be executed at the very beginning of the view's life cycle.\r\n\t *\r\n\t * It is possible to {@link module:ui/template~Template.extend} the {@link #template} before\r\n\t * the view is rendered. To allow an early customization of the view (e.g. by its parent),\r\n\t * such references should be done in `render()`.\r\n\t *\r\n\t *\t\tclass SampleView extends View {\r\n\t *\t\t\tconstructor() {\r\n\t *\t\t\t\tthis.setTemplate( {\r\n\t *\t\t\t\t\t// ...\r\n\t *\t\t\t\t} );\r\n\t *\t\t\t},\r\n\t *\r\n\t *\t\t\trender() {\r\n\t *\t\t\t\t// View#element becomes available.\r\n\t *\t\t\t\tsuper.render();\r\n\t *\r\n\t *\t\t\t\t// The \"scroll\" listener depends on #element.\r\n\t *\t\t\t\tthis.listenTo( window, 'scroll', () => {\r\n\t *\t\t\t\t\t// A reference to #element would render the #template and make it non-extendable.\r\n\t *\t\t\t\t\tif ( window.scrollY > 0 ) {\r\n\t *\t\t\t\t\t\tthis.element.scrollLeft = 100;\r\n\t *\t\t\t\t\t} else {\r\n\t *\t\t\t\t\t\tthis.element.scrollLeft = 0;\r\n\t *\t\t\t\t\t}\r\n\t *\t\t\t\t} );\r\n\t *\t\t\t}\r\n\t *\t\t}\r\n\t *\r\n\t *\t\tconst view = new SampleView();\r\n\t *\r\n\t *\t\t// Let's customize the view before it gets rendered.\r\n\t *\t\tview.extendTemplate( {\r\n\t *\t\t\tattributes: {\r\n\t *\t\t\t\tclass: [\r\n\t *\t\t\t\t\t'additional-class'\r\n\t *\t\t\t\t]\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t *\t\t// Late rendering allows customization of the view.\r\n\t *\t\tview.render();\r\n\t */\r\n\trender() {\r\n\t\tif ( this.isRendered ) {\r\n\t\t\t/**\r\n\t\t\t * This View has already been rendered.\r\n\t\t\t *\r\n\t\t\t * @error ui-view-render-rendered\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'ui-view-render-already-rendered: This View has already been rendered.' );\r\n\t\t}\r\n\r\n\t\t// Render #element of the view.\r\n\t\tif ( this.template ) {\r\n\t\t\tthis.element = this.template.render();\r\n\r\n\t\t\t// Auto–register view children from #template.\r\n\t\t\tthis.registerChild( this.template.getViews() );\r\n\t\t}\r\n\r\n\t\tthis.isRendered = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Recursively destroys the view instance and child views added by {@link #registerChild} and\r\n\t * residing in collections created by the {@link #createCollection}.\r\n\t *\r\n\t * Destruction disables all event listeners:\r\n\t * * created on the view, e.g. `view.on( 'event', () => {} )`,\r\n\t * * defined in the {@link #template} for DOM events.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.stopListening();\r\n\r\n\t\tthis._viewCollections.map( c => c.destroy() );\r\n\t}\r\n\r\n\t/**\r\n\t * Event fired by the {@link #render} method. Actual rendering is executed as a listener to\r\n\t * this event with the default priority.\r\n\t *\r\n\t * See {@link module:utils/observablemixin~ObservableMixin.decorate} for more information and samples.\r\n\t *\r\n\t * @event render\r\n\t */\r\n}\r\n\r\nmix( View, DomEmitterMixin );\r\nmix( View, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/editorui/editoruiview\r\n */\r\n\r\n/* globals document */\r\n\r\nimport View from '../view';\r\nimport Template from '../template';\r\n\r\nimport '../../theme/components/editorui/editorui.css';\r\n\r\n/**\r\n * The editor UI view class. Base class for the editor main views.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class EditorUIView extends View {\r\n\t/**\r\n\t * Creates an instance of the editor UI view class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The locale instance.\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views, detached from the DOM\r\n\t\t * structure of the editor, like panels, icons etc.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection} #body\r\n\t\t */\r\n\t\tthis.body = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * The element holding elements of the 'body' region.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {HTMLElement} #_bodyCollectionContainer\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tthis._renderBodyCollection();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._bodyCollectionContainer.remove();\r\n\r\n\t\treturn super.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and appends to `<body>` the {@link #body} collection container.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_renderBodyCollection() {\r\n\t\tconst bodyElement = this._bodyCollectionContainer = new Template( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-reset_all',\r\n\t\t\t\t\t'ck-body',\r\n\t\t\t\t\t'ck-rounded-corners'\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tchildren: this.body\r\n\t\t} ).render();\r\n\r\n\t\tdocument.body.appendChild( bodyElement );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/label/labelview\r\n */\r\n\r\nimport View from '../view';\r\n\r\nimport '../../theme/components/label/label.css';\r\n\r\n/**\r\n * The label view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class LabelView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * The text of the label.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #text\r\n\t\t */\r\n\t\tthis.set( 'text' );\r\n\r\n\t\t/**\r\n\t\t * The `for` attribute of the label (i.e. to pair with an `<input>` element).\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #for\r\n\t\t */\r\n\t\tthis.set( 'for' );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'label',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-label'\r\n\t\t\t\t],\r\n\t\t\t\tfor: bind.to( 'for' )\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: bind.to( 'text' )\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module ui/editorui/boxed/boxededitoruiview\r\n */\nimport EditorUIView from '../../editorui/editoruiview';\nimport LabelView from '../../label/labelview';\nimport uid from '@ckeditor/ckeditor5-utils/src/uid';\n/**\r\n * The boxed editor UI view class. This class represents an editor interface\r\n * consisting of a toolbar and an editable area, enclosed within a box.\r\n *\r\n * @extends module:ui/editorui/editoruiview~EditorUIView\r\n */\nexport default class BoxedEditorUIView extends EditorUIView {\n    /**\r\n\t * Creates an instance of the boxed editor UI view class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} locale The locale instance..\r\n\t */\n    constructor(locale) {\n        super(locale);\n        const ariaLabelUid = uid();\n        /**\r\n\t\t * Collection of the child views located in the top (`.ck-editor__top`)\r\n\t\t * area of the UI.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this.top = this.createCollection();\n        /**\r\n\t\t * Collection of the child views located in the main (`.ck-editor__main`)\r\n\t\t * area of the UI.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this.main = this.createCollection();\n        /**\r\n\t\t * Voice label of the UI.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/view~View} #_voiceLabelView\r\n\t\t */\n        this._voiceLabelView = this._createVoiceLabel(ariaLabelUid);\n        this.setTemplate({\n            tag: 'div',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-reset',\n                    'ck-editor',\n                    'ck-rounded-corners'\n                ],\n                role: 'application',\n                dir: 'ltr',\n                lang: locale.language,\n                'aria-labelledby': `ck-editor__aria-label_${ ariaLabelUid }`\n            },\n            children: [\n                this._voiceLabelView,\n                {\n                    tag: 'div',\n                    attributes: {\n                        class: [\n                            'ck',\n                            'ck-editor__top',\n                            'ck-reset_all'\n                        ],\n                        role: 'presentation'\n                    },\n                    children: this.top\n                },\n                {\n                    tag: 'div',\n                    attributes: {\n                        class: [\n                            'ck',\n                            'ck-editor__main'\n                        ],\n                        role: 'presentation'\n                    },\n                    children: this.main\n                }\n            ]\n        });\n    }\n    /**\r\n\t * Creates a voice label view instance.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/label/labelview~LabelView}\r\n\t */\n    _createVoiceLabel(ariaLabelUid) {\n        const t = this.t;\n        const voiceLabel = new LabelView();\n        voiceLabel.text = t('bb');\n        voiceLabel.extendTemplate({\n            attributes: {\n                id: `ck-editor__aria-label_${ ariaLabelUid }`,\n                class: 'ck-voice-label'\n            }\n        });\n        return voiceLabel;\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/editableui/editableuiview\r\n */\r\n\r\nimport View from '../view';\r\n\r\n/**\r\n * The editable UI view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class EditableUIView extends View {\r\n\t/**\r\n\t * Creates an instance of EditableUIView class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The locale instance.\r\n\t * @param {HTMLElement} [editableElement] The editable element. If not specified, this view\r\n\t * should create it. Otherwise, the existing element should be used.\r\n\t */\r\n\tconstructor( locale, editableElement ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tif ( editableElement ) {\r\n\t\t\tthis.element = this.editableElement = editableElement;\r\n\t\t}\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-content',\r\n\t\t\t\t\t'ck-editor__editable',\r\n\t\t\t\t\t'ck-rounded-corners',\r\n\t\t\t\t\tbind.to( 'isFocused', value => value ? 'ck-focused' : 'ck-blurred' ),\r\n\t\t\t\t\tbind.if( 'isReadOnly', 'ck-read-only' )\r\n\r\n\t\t\t\t],\r\n\t\t\t\tcontenteditable: bind.to( 'isReadOnly', value => !value ),\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the editable is writable or not.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the editable is focused, i.e. the user is typing in it.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isFocused\r\n\t\t */\r\n\t\tthis.set( 'isFocused', false );\r\n\r\n\t\t/**\r\n\t\t * An external {@link #editableElement} passed into the constructor, which also means\r\n\t\t * the view will not render its {@link #template}.\r\n\t\t *\r\n\t\t * @member {HTMLElement} #externalElement\r\n\t\t */\r\n\t\tthis.externalElement = editableElement;\r\n\r\n\t\t/**\r\n\t\t * The element which is the main editable element (usually the one with `contentEditable=\"true\"`).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {HTMLElement} #editableElement\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the view by either applying the {@link #template} to the existing\r\n\t * {@link #editableElement} or assigning {@link #element} as {@link #editableElement}.\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tif ( this.externalElement ) {\r\n\t\t\tthis.template.apply( this.element = this.externalElement );\r\n\t\t} else {\r\n\t\t\tthis.editableElement = this.element;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tif ( this.externalElement ) {\r\n\t\t\tthis.template.revert( this.externalElement );\r\n\t\t}\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module ui/editableui/inline/inlineeditableuiview\r\n */\nimport EditableUIView from '../../editableui/editableuiview';\n/**\r\n * The inline editable UI class implementing an inline {@link module:ui/editableui/editableuiview~EditableUIView}.\r\n *\r\n * @extends module:ui/editableui/editableuiview~EditableUIView\r\n */\nexport default class InlineEditableUIView extends EditableUIView {\n    /**\r\n\t * Creates an instance of the InlineEditableUIView class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The locale instance.\r\n\t * @param {HTMLElement} [editableElement] The editable element. If not specified, the\r\n\t * {@link module:ui/editableui/editableuiview~EditableUIView}\r\n\t * will create it. Otherwise, the existing element will be used.\r\n\t */\n    constructor(locale, editableElement) {\n        super(locale, editableElement);\n        const bind = this.bindTemplate;\n        const t = this.t;\n        /**\r\n\t\t * The name of the editable UI view.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #name\r\n\t\t */\n        this.set('name', null);\n        const getLabel = value => {\n            return t('bc', [value]);\n        };\n        this.extendTemplate({\n            attributes: {\n                role: 'textbox',\n                'aria-label': bind.to('name', getLabel),\n                class: 'ck-editor__editable_inline'\n            }\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/tounit\r\n */\r\n\r\n/**\r\n * Returns a helper function, which adds a desired trailing\r\n * `unit` to the passed value.\r\n *\r\n * @param {String} unit An unit like \"px\" or \"em\".\r\n * @returns {module:utils/dom/tounit~helper}\r\n */\r\nexport default function toUnit( unit ) {\r\n\t/**\r\n\t * A function, which adds a pre–defined trailing `unit`\r\n\t * to the passed `value`.\r\n\t *\r\n\t * @function helper\r\n \t * @param {*} value A value to be given the unit.\r\n \t * @returns {String} A value with the trailing unit.\r\n\t */\r\n\treturn value => value + unit;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/panel/sticky/stickypanelview\r\n */\r\n\r\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\r\nimport View from '../../view';\r\nimport Template from '../../template';\r\nimport toUnit from '@ckeditor/ckeditor5-utils/src/dom/tounit';\r\n\r\nimport '../../../theme/components/panel/stickypanel.css';\r\n\r\nconst toPx = toUnit( 'px' );\r\n\r\n/**\r\n * The sticky panel view class.\r\n */\r\nexport default class StickyPanelView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * Controls whether the sticky panel should be active.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isActive\r\n\t\t */\r\n\t\tthis.set( 'isActive', false );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the sticky panel is in the \"sticky\" state.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isSticky\r\n\t\t */\r\n\t\tthis.set( 'isSticky', false );\r\n\r\n\t\t/**\r\n\t\t * The limiter element for the sticky panel instance. Its bounding rect limits\r\n\t\t * the \"stickyness\" of the panel, i.e. when the panel reaches the bottom\r\n\t\t * edge of the limiter, it becomes sticky to that edge and does not float\r\n\t\t * off the limiter. It is mandatory for the panel to work properly and once\r\n\t\t * set, it cannot be changed.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {HTMLElement} #limiterElement\r\n\t\t */\r\n\t\tthis.set( 'limiterElement', null );\r\n\r\n\t\t/**\r\n\t\t * The offset from the bottom edge of {@link #limiterElement}\r\n\t\t * which stops the panel from stickying any further to prevent limiter's content\r\n\t\t * from being completely covered.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @default 50\r\n\t\t * @member {Number} #limiterBottomOffset\r\n\t\t */\r\n\t\tthis.set( 'limiterBottomOffset', 50 );\r\n\r\n\t\t/**\r\n\t\t * The offset from the top edge of the web browser's viewport which makes the\r\n\t\t * panel become sticky. The default value is `0`, which means the panel becomes\r\n\t\t * sticky when it's upper edge touches the top of the page viewport.\r\n\t\t *\r\n\t\t * This attribute is useful when the web page has UI elements positioned to the top\r\n\t\t * either using `position: fixed` or `position: sticky`, which would cover the\r\n\t\t * sticky panel or vice–versa (depending on the `z-index` hierarchy).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @default 0\r\n\t\t * @member {Number} #viewportTopOffset\r\n\t\t */\r\n\t\tthis.set( 'viewportTopOffset', 0 );\r\n\r\n\t\t/**\r\n\t\t * Controls the `margin-left` CSS style of the panel.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {String} #_marginLeft\r\n\t\t */\r\n\t\tthis.set( '_marginLeft', null );\r\n\r\n\t\t/**\r\n\t\t * Set `true` if the sticky panel reached the bottom edge of the\r\n\t\t * {@link #limiterElement}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #_isStickyToTheLimiter\r\n\t\t */\r\n\t\tthis.set( '_isStickyToTheLimiter', false );\r\n\r\n\t\t/**\r\n\t\t * Set `true` if the sticky panel uses the {@link #viewportTopOffset},\r\n\t\t * i.e. not {@link #_isStickyToTheLimiter} and the {@link #viewportTopOffset}\r\n\t\t * is not `0`.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #_hasViewportTopOffset\r\n\t\t */\r\n\t\tthis.set( '_hasViewportTopOffset', false );\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views which creates balloon panel contents.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.content = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * The DOM bounding client rect of the {@link module:ui/view~View#element} of the panel.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Object} #_panelRect\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The DOM bounding client rect of the {@link #limiterElement}\r\n\t\t * of the panel.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Object} #_limiterRect\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * A dummy element which visually fills the space as long as the\r\n\t\t * actual panel is sticky. It prevents flickering of the UI.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @property {HTMLElement}\r\n\t\t */\r\n\t\tthis._contentPanelPlaceholder = new Template( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-sticky-panel__placeholder'\r\n\t\t\t\t],\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\tdisplay: bind.to( 'isSticky', isSticky => isSticky ? 'block' : 'none' ),\r\n\t\t\t\t\theight: bind.to( 'isSticky', isSticky => {\r\n\t\t\t\t\t\treturn isSticky ? toPx( this._panelRect.height ) : null;\r\n\t\t\t\t\t} )\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} ).render();\r\n\r\n\t\t/**\r\n\t\t * The panel which accepts children into {@link #content} collection.\r\n\t\t * Also an element which is positioned when {@link #isSticky}.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @property {HTMLElement}\r\n\t\t */\r\n\t\tthis._contentPanel = new Template( {\r\n\t\t\ttag: 'div',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-sticky-panel__content',\r\n\t\t\t\t\t// Toggle class of the panel when \"sticky\" state changes in the view.\r\n\t\t\t\t\tbind.if( 'isSticky', 'ck-sticky-panel__content_sticky' ),\r\n\t\t\t\t\tbind.if( '_isStickyToTheLimiter', 'ck-sticky-panel__content_sticky_bottom-limit' ),\r\n\t\t\t\t],\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\twidth: bind.to( 'isSticky', isSticky => {\r\n\t\t\t\t\t\treturn isSticky ? toPx( this._contentPanelPlaceholder.getBoundingClientRect().width ) : null;\r\n\t\t\t\t\t} ),\r\n\r\n\t\t\t\t\ttop: bind.to( '_hasViewportTopOffset', _hasViewportTopOffset => {\r\n\t\t\t\t\t\treturn _hasViewportTopOffset ? toPx( this.viewportTopOffset ) : null;\r\n\t\t\t\t\t} ),\r\n\r\n\t\t\t\t\tbottom: bind.to( '_isStickyToTheLimiter', _isStickyToTheLimiter => {\r\n\t\t\t\t\t\treturn _isStickyToTheLimiter ? toPx( this.limiterBottomOffset ) : null;\r\n\t\t\t\t\t} ),\r\n\r\n\t\t\t\t\tmarginLeft: bind.to( '_marginLeft' )\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.content\r\n\t\t} ).render();\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-sticky-panel'\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\tthis._contentPanelPlaceholder,\r\n\t\t\t\tthis._contentPanel\r\n\t\t\t]\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\t// Check if the panel should go into the sticky state immediately.\r\n\t\tthis._checkIfShouldBeSticky();\r\n\r\n\t\t// Update sticky state of the panel as the window is being scrolled.\r\n\t\tthis.listenTo( global.window, 'scroll', () => {\r\n\t\t\tthis._checkIfShouldBeSticky();\r\n\t\t} );\r\n\r\n\t\t// Synchronize with `model.isActive` because sticking an inactive panel is pointless.\r\n\t\tthis.listenTo( this, 'change:isActive', () => {\r\n\t\t\tthis._checkIfShouldBeSticky();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Analyzes the environment to decide whether the panel should\r\n\t * be sticky or not.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_checkIfShouldBeSticky() {\r\n\t\tconst panelRect = this._panelRect = this._contentPanel.getBoundingClientRect();\r\n\t\tlet limiterRect;\r\n\r\n\t\tif ( !this.limiterElement ) {\r\n\t\t\tthis.isSticky = false;\r\n\t\t} else {\r\n\t\t\tlimiterRect = this._limiterRect = this.limiterElement.getBoundingClientRect();\r\n\r\n\t\t\t// The panel must be active to become sticky.\r\n\t\t\tthis.isSticky = this.isActive &&\r\n\t\t\t\t// The limiter's top edge must be beyond the upper edge of the visible viewport (+the viewportTopOffset).\r\n\t\t\t\tlimiterRect.top < this.viewportTopOffset &&\r\n\t\t\t\t// The model#limiterElement's height mustn't be smaller than the panel's height and model#limiterBottomOffset.\r\n\t\t\t\t// There's no point in entering the sticky mode if the model#limiterElement is very, very small, because\r\n\t\t\t\t// it would immediately set model#_isStickyToTheLimiter true and, given model#limiterBottomOffset, the panel\r\n\t\t\t\t// would be positioned before the model#limiterElement.\r\n\t\t\t\tthis._panelRect.height + this.limiterBottomOffset < limiterRect.height;\r\n\t\t}\r\n\r\n\t\t// Stick the panel to the top edge of the viewport simulating CSS position:sticky.\r\n\t\t// TODO: Possibly replaced by CSS in the future http://caniuse.com/#feat=css-sticky\r\n\t\tif ( this.isSticky ) {\r\n\t\t\tthis._isStickyToTheLimiter =\r\n\t\t\t\tlimiterRect.bottom < panelRect.height + this.limiterBottomOffset + this.viewportTopOffset;\r\n\t\t\tthis._hasViewportTopOffset = !this._isStickyToTheLimiter && !!this.viewportTopOffset;\r\n\t\t\tthis._marginLeft = this._isStickyToTheLimiter ? null : toPx( -global.window.scrollX );\r\n\t\t}\r\n\t\t// Detach the panel from the top edge of the viewport.\r\n\t\telse {\r\n\t\t\tthis._isStickyToTheLimiter = false;\r\n\t\t\tthis._hasViewportTopOffset = false;\r\n\t\t\tthis._marginLeft = null;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/focuscycler\r\n */\r\n\r\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\r\n\r\n/**\r\n * A utility class that helps cycling over focusable {@link module:ui/view~View views} in a\r\n * {@link module:ui/viewcollection~ViewCollection} when the focus is tracked by the\r\n * {@link module:utils/focustracker~FocusTracker} instance. It helps implementing keyboard\r\n * navigation in HTML forms, toolbars, lists and the like.\r\n *\r\n * To work properly it requires:\r\n * * a collection of focusable (HTML `tabindex` attribute) views that implement the `focus()` method,\r\n * * an associated focus tracker to determine which view is focused.\r\n *\r\n * A simple cycler setup can look like this:\r\n *\r\n *\t\tconst focusables = new ViewCollection();\r\n *\t\tconst focusTracker = new FocusTracker();\r\n *\r\n *\t\t// Add focusable views to the focus tracker.\r\n *\t\tfocusTracker.add( ... );\r\n *\r\n * Then, the cycler can be used manually:\r\n *\r\n *\t\tconst cycler = new FocusCycler( { focusables, focusTracker } );\r\n *\r\n *\t\t// Will focus the first focusable view in #focusables.\r\n *\t\tcycler.focusFirst();\r\n *\r\n *\t\t// Will log the next focusable item in #focusables.\r\n *\t\tconsole.log( cycler.next );\r\n *\r\n * Alternatively, it can work side by side with the {@link module:utils/keystrokehandler~KeystrokeHandler}:\r\n *\r\n *\t\tconst keystrokeHandler = new KeystrokeHandler();\r\n *\r\n *\t\t// Activate the keystroke handler.\r\n *\t\tkeystrokeHandler.listenTo( sourceOfEvents );\r\n *\r\n *\t\tconst cycler = new FocusCycler( {\r\n *\t\t\tfocusables, focusTracker, keystrokeHandler,\r\n *\t\t\tactions: {\r\n *\t\t\t\t// When arrowup of arrowleft is detected by the #keystrokeHandler,\r\n *\t\t\t\t// focusPrevious() will be called on the cycler.\r\n *\t\t\t\tfocusPrevious: [ 'arrowup', 'arrowleft' ],\r\n *\t\t\t}\r\n *\t\t} );\r\n */\r\nexport default class FocusCycler {\r\n\t/**\r\n\t * Creates an instance of the focus cycler utility.\r\n\t *\r\n\t * @param {Object} options Configuration options.\r\n\t * @param {module:utils/collection~Collection|Object} options.focusables\r\n\t * @param {module:utils/focustracker~FocusTracker} options.focusTracker\r\n\t * @param {module:utils/keystrokehandler~KeystrokeHandler} [options.keystrokeHandler]\r\n\t * @param {Object} [options.actions]\r\n\t */\r\n\tconstructor( options ) {\r\n\t\tObject.assign( this, options );\r\n\r\n\t\t/**\r\n\t\t * A {@link module:ui/view~View view} collection that the cycler operates on.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/collection~Collection} #focusables\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * A focus tracker instance that the cycler uses to determine the current focus\r\n\t\t * state in {@link #focusables}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker} #focusTracker\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t * which can respond to certain keystrokes and cycle the focus.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler} #keystrokeHandler\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Actions that the cycler can take when a keystroke is pressed. Requires\r\n\t\t * `options.keystrokeHandler` to be passed and working. When an action is\r\n\t\t * performed, `preventDefault` and `stopPropagation` will be called on the event\r\n\t\t * the keystroke fired in the DOM.\r\n\t\t *\r\n\t\t *\t\tactions: {\r\n\t\t *\t\t\t// Will call #focusPrevious() when arrowleft or arrowup is pressed.\r\n\t\t *\t\t\tfocusPrevious: [ 'arrowleft', 'arrowup' ],\r\n\t\t *\r\n\t\t *\t\t\t// Will call #focusNext() when arrowdown is pressed.\r\n\t\t *\t\t\tfocusNext: 'arrowdown'\r\n\t\t *\t\t}\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Object} #actions\r\n\t\t */\r\n\r\n\t\tif ( options.actions && options.keystrokeHandler ) {\r\n\t\t\tfor ( const methodName in options.actions ) {\r\n\t\t\t\tlet actions = options.actions[ methodName ];\r\n\r\n\t\t\t\tif ( typeof actions == 'string' ) {\r\n\t\t\t\t\tactions = [ actions ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( const keystroke of actions ) {\r\n\t\t\t\t\toptions.keystrokeHandler.set( keystroke, ( data, cancel ) => {\r\n\t\t\t\t\t\tthis[ methodName ]();\r\n\t\t\t\t\t\tcancel();\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first focusable view in {@link #focusables}.\r\n\t * Returns `null` if there is none.\r\n\t *\r\n\t * @readonly\r\n\t * @member {module:ui/view~View|null} #first\r\n\t */\r\n\tget first() {\r\n\t\treturn this.focusables.find( isFocusable ) || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the last focusable view in {@link #focusables}.\r\n\t * Returns `null` if there is none.\r\n\t *\r\n\t * @readonly\r\n\t * @member {module:ui/view~View|null} #last\r\n\t */\r\n\tget last() {\r\n\t\treturn this.focusables.filter( isFocusable ).slice( -1 )[ 0 ] || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next focusable view in {@link #focusables} based on {@link #current}.\r\n\t * Returns `null` if there is none.\r\n\t *\r\n\t * @readonly\r\n\t * @member {module:ui/view~View|null} #next\r\n\t */\r\n\tget next() {\r\n\t\treturn this._getFocusableItem( 1 );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the previous focusable view in {@link #focusables} based on {@link #current}.\r\n\t * Returns `null` if there is none.\r\n\t *\r\n\t * @readonly\r\n\t * @member {module:ui/view~View|null} #previous\r\n\t */\r\n\tget previous() {\r\n\t\treturn this._getFocusableItem( -1 );\r\n\t}\r\n\r\n\t/**\r\n\t * An index of the view in the {@link #focusables} which is focused according\r\n\t * to {@link #focusTracker}. Returns `null` when there is no such view.\r\n\t *\r\n\t * @readonly\r\n\t * @member {Number|null} #current\r\n\t */\r\n\tget current() {\r\n\t\tlet index = null;\r\n\r\n\t\t// There's no focused view in the focusables.\r\n\t\tif ( this.focusTracker.focusedElement === null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tthis.focusables.find( ( view, viewIndex ) => {\r\n\t\t\tconst focused = view.element === this.focusTracker.focusedElement;\r\n\r\n\t\t\tif ( focused ) {\r\n\t\t\t\tindex = viewIndex;\r\n\t\t\t}\r\n\r\n\t\t\treturn focused;\r\n\t\t} );\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #first} item in {@link #focusables}.\r\n\t */\r\n\tfocusFirst() {\r\n\t\tthis._focus( this.first );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #last} item in {@link #focusables}.\r\n\t */\r\n\tfocusLast() {\r\n\t\tthis._focus( this.last );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #next} item in {@link #focusables}.\r\n\t */\r\n\tfocusNext() {\r\n\t\tthis._focus( this.next );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #previous} item in {@link #focusables}.\r\n\t */\r\n\tfocusPrevious() {\r\n\t\tthis._focus( this.previous );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the given view if it exists.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:ui/view~View} view\r\n\t */\r\n\t_focus( view ) {\r\n\t\tif ( view ) {\r\n\t\t\tview.focus();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next or previous focusable view in {@link #focusables} with respect\r\n\t * to {@link #current}.\r\n\t *\r\n\t * @protected\r\n\t * @param {Number} step Either `1` for checking forward from {@link #current} or\r\n\t * `-1` for checking backwards.\r\n\t * @returns {module:ui/view~View|null}\r\n\t */\r\n\t_getFocusableItem( step ) {\r\n\t\t// Cache for speed.\r\n\t\tconst current = this.current;\r\n\t\tconst collectionLength = this.focusables.length;\r\n\r\n\t\tif ( !collectionLength ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Start from the beginning if no view is focused.\r\n\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/206\r\n\t\tif ( current === null ) {\r\n\t\t\treturn this[ step === 1 ? 'first' : 'last' ];\r\n\t\t}\r\n\r\n\t\t// Cycle in both directions.\r\n\t\tlet index = ( current + collectionLength + step ) % collectionLength;\r\n\r\n\t\tdo {\r\n\t\t\tconst view = this.focusables.get( index );\r\n\r\n\t\t\t// TODO: Check if view is visible.\r\n\t\t\tif ( isFocusable( view ) ) {\r\n\t\t\t\treturn view;\r\n\t\t\t}\r\n\r\n\t\t\t// Cycle in both directions.\r\n\t\t\tindex = ( index + collectionLength + step ) % collectionLength;\r\n\t\t} while ( index !== current );\r\n\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n// Checks whether a view is focusable.\r\n//\r\n// @private\r\n// @param {module:ui/view~View} view A view to be checked.\r\n// @returns {Boolean}\r\nfunction isFocusable( view ) {\r\n\treturn !!( view.focus && global.window.getComputedStyle( view.element ).display != 'none' );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/toolbar/toolbarseparatorview\r\n */\r\n\r\nimport View from '../view';\r\n\r\n/**\r\n * The toolbar separator view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class ToolbarSeparatorView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'span',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-toolbar__separator'\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/toolbar/toolbarview\r\n */\r\n\r\nimport View from '../view';\r\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\r\nimport FocusCycler from '../focuscycler';\r\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\r\nimport ToolbarSeparatorView from './toolbarseparatorview';\r\nimport preventDefault from '../bindings/preventdefault.js';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\n\r\nimport '../../theme/components/toolbar/toolbar.css';\r\n\r\n/**\r\n * The toolbar view class.\r\n *\r\n * @extends module:ui/view~View\r\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\r\n */\r\nexport default class ToolbarView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * Collection of the toolbar items (like buttons).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.items = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * Tracks information about DOM focus in the list.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\r\n\t\tthis.focusTracker = new FocusTracker();\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\r\n\t\tthis.keystrokes = new KeystrokeHandler();\r\n\r\n\t\t/**\r\n\t\t * Controls the orientation of toolbar items.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isVertical\r\n\t\t */\r\n\t\tthis.set( 'isVertical', false );\r\n\r\n\t\t/**\r\n\t\t * An additional CSS class added to the {@link #element}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #className\r\n\t\t */\r\n\t\tthis.set( 'className' );\r\n\r\n\t\t/**\r\n\t\t * Helps cycling over focusable {@link #items} in the toolbar.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\r\n\t\tthis._focusCycler = new FocusCycler( {\r\n\t\t\tfocusables: this.items,\r\n\t\t\tfocusTracker: this.focusTracker,\r\n\t\t\tkeystrokeHandler: this.keystrokes,\r\n\t\t\tactions: {\r\n\t\t\t\t// Navigate toolbar items backwards using the arrow[left,up] keys.\r\n\t\t\t\tfocusPrevious: [ 'arrowleft', 'arrowup' ],\r\n\r\n\t\t\t\t// Navigate toolbar items forwards using the arrow[right,down] keys.\r\n\t\t\t\tfocusNext: [ 'arrowright', 'arrowdown' ]\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-toolbar',\r\n\t\t\t\t\tbind.if( 'isVertical', 'ck-toolbar_vertical' ),\r\n\t\t\t\t\tbind.to( 'className' )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.items,\r\n\r\n\t\t\ton: {\r\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/206\r\n\t\t\t\tmousedown: preventDefault( this )\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\t// Items added before rendering should be known to the #focusTracker.\r\n\t\tfor ( const item of this.items ) {\r\n\t\t\tthis.focusTracker.add( item.element );\r\n\t\t}\r\n\r\n\t\tthis.items.on( 'add', ( evt, item ) => {\r\n\t\t\tthis.focusTracker.add( item.element );\r\n\t\t} );\r\n\r\n\t\tthis.items.on( 'remove', ( evt, item ) => {\r\n\t\t\tthis.focusTracker.remove( item.element );\r\n\t\t} );\r\n\r\n\t\t// Start listening for the keystrokes coming from #element.\r\n\t\tthis.keystrokes.listenTo( this.element );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the first focusable in {@link #items}.\r\n\t */\r\n\tfocus() {\r\n\t\tthis._focusCycler.focusFirst();\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the last focusable in {@link #items}.\r\n\t */\r\n\tfocusLast() {\r\n\t\tthis._focusCycler.focusLast();\r\n\t}\r\n\r\n\t/**\r\n\t * A utility which expands a plain toolbar configuration into\r\n\t * {@link module:ui/toolbar/toolbarview~ToolbarView#items} using a given component factory.\r\n\t *\r\n\t * @param {Array.<String>} config The toolbar items config.\r\n\t * @param {module:ui/componentfactory~ComponentFactory} factory A factory producing toolbar items.\r\n\t */\r\n\tfillFromConfig( config, factory ) {\r\n\t\tconfig.map( name => {\r\n\t\t\tif ( name == '|' ) {\r\n\t\t\t\tthis.items.add( new ToolbarSeparatorView() );\r\n\t\t\t} else if ( factory.has( name ) ) {\r\n\t\t\t\tthis.items.add( factory.create( name ) );\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * There was a problem processing the configuration of the toolbar. The item with the given\r\n\t\t\t\t * name does not exist so it was omitted when rendering the toolbar.\r\n\t\t\t\t *\r\n\t\t\t\t * This warning usually shows up when the {@link module:core/plugin~Plugin} which is supposed\r\n\t\t\t\t * to provide a toolbar item has not been loaded or there is a typo in the configuration.\r\n\t\t\t\t *\r\n\t\t\t\t * Make sure the plugin responsible for this toolbar item is loaded and the toolbar configuration\r\n\t\t\t\t * is correct, e.g. {@link module:basic-styles/bold~Bold} is loaded for the `'bold'` toolbar item.\r\n\t\t\t\t *\r\n\t\t\t\t * You can use the following snippet to retrieve all available toolbar items:\r\n\t\t\t\t *\r\n\t\t\t\t *\t\tArray.from( editor.ui.componentFactory.names() );\r\n\t\t\t\t *\r\n\t\t\t\t * @error toolbarview-item-unavailable\r\n\t\t\t\t * @param {String} name The name of the component.\r\n\t\t\t\t */\r\n\t\t\t\tlog.warn(\r\n\t\t\t\t\t'toolbarview-item-unavailable: The requested toolbar item is unavailable.',\r\n\t\t\t\t\t{ name }\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/bindings/preventdefault\r\n */\r\n\r\n/**\r\n * A helper which executes a native `Event.preventDefault()` if the target of an event equals the\r\n * {@link module:ui/view~View#element element of the view}. It shortens the definition of a\r\n * {@link module:ui/view~View#template template}.\r\n *\r\n *\t\t// In a class extending View.\r\n *\t\timport preventDefault from '@ckeditor/ckeditor5-ui/src/bindings/preventdefault';\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tthis.setTemplate( {\r\n *\t\t\ttag: 'div',\r\n *\r\n *\t\t\ton: {\r\n *\t\t\t\t// Prevent the default mousedown action on this view.\r\n *\t\t\t\tmousedown: preventDefault( this )\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * @param {module:ui/view~View} view View instance that defines the template.\r\n * @returns {module:ui/template~TemplateToBinding}\r\n */\r\nexport default function preventDefault( view ) {\r\n\treturn view.bindTemplate.to( evt => {\r\n\t\tif ( evt.target === view.element ) {\r\n\t\t\tevt.preventDefault();\r\n\t\t}\r\n\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module editor-classic/classiceditoruiview\r\n */\r\n\r\nimport BoxedEditorUIView from '@ckeditor/ckeditor5-ui/src/editorui/boxed/boxededitoruiview';\r\nimport InlineEditableUIView from '@ckeditor/ckeditor5-ui/src/editableui/inline/inlineeditableuiview';\r\nimport StickyPanelView from '@ckeditor/ckeditor5-ui/src/panel/sticky/stickypanelview';\r\nimport ToolbarView from '@ckeditor/ckeditor5-ui/src/toolbar/toolbarview';\r\n\r\nimport '../theme/classiceditor.css';\r\n\r\n/**\r\n * Classic editor UI view. Uses an inline editable and a sticky toolbar, all\r\n * enclosed in a boxed UI view.\r\n *\r\n * @extends module:ui/editorui/boxed/boxededitoruiview~BoxedEditorUIView\r\n */\r\nexport default class ClassicEditorUIView extends BoxedEditorUIView {\r\n\t/**\r\n\t * Creates an instance of the classic editor UI view.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} locale The {@link module:core/editor/editor~Editor#locale} instance.\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * Sticky panel view instance. This is a parent view of a {@link #toolbar}\r\n\t\t * that makes toolbar sticky.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/panel/sticky/stickypanelview~StickyPanelView}\r\n\t\t */\r\n\t\tthis.stickyPanel = new StickyPanelView( locale );\r\n\r\n\t\t/**\r\n\t\t * Toolbar view instance.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarView}\r\n\t\t */\r\n\t\tthis.toolbar = new ToolbarView( locale );\r\n\r\n\t\t/**\r\n\t\t * Editable UI view.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/editableui/inline/inlineeditableuiview~InlineEditableUIView}\r\n\t\t */\r\n\t\tthis.editable = new InlineEditableUIView( locale );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\t// Set toolbar as a child of a stickyPanel and makes toolbar sticky.\r\n\t\tthis.stickyPanel.content.add( this.toolbar );\r\n\r\n\t\tthis.top.add( this.stickyPanel );\r\n\t\tthis.main.add( this.editable );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget editableElement() {\r\n\t\treturn this.editable.element;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/elementreplacer\r\n */\r\n\r\n/**\r\n * Utility class allowing to hide existing HTML elements or replace them with given ones in a way that doesn't remove\r\n * the original elements from the DOM.\r\n */\r\nexport default class ElementReplacer {\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * The elements replaced by {@link #replace} and their replacements.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Array.<Object>}\r\n\t\t */\r\n\t\tthis._replacedElements = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the `element` and, if specified, inserts the the given element next to it.\r\n\t *\r\n\t * The effect of this method can be reverted by {@link #restore}.\r\n\t *\r\n\t * @param {HTMLElement} element The element to replace.\r\n\t * @param {HTMLElement} [newElement] The replacement element. If not passed, then the `element` will just be hidden.\r\n\t */\r\n\treplace( element, newElement ) {\r\n\t\tthis._replacedElements.push( { element, newElement } );\r\n\r\n\t\telement.style.display = 'none';\r\n\r\n\t\tif ( newElement ) {\r\n\t\t\telement.parentNode.insertBefore( newElement, element.nextSibling );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Restores what {@link #replace} did.\r\n\t */\r\n\trestore() {\r\n\t\tthis._replacedElements.forEach( ( { element, newElement } ) => {\r\n\t\t\telement.style.display = '';\r\n\r\n\t\t\tif ( newElement ) {\r\n\t\t\t\tnewElement.remove();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis._replacedElements = [];\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module editor-classic/classiceditor\r\n */\r\n\r\nimport Editor from '@ckeditor/ckeditor5-core/src/editor/editor';\r\nimport DataApiMixin from '@ckeditor/ckeditor5-core/src/editor/utils/dataapimixin';\r\nimport ElementApiMixin from '@ckeditor/ckeditor5-core/src/editor/utils/elementapimixin';\r\nimport attachToForm from '@ckeditor/ckeditor5-core/src/editor/utils/attachtoform';\r\nimport HtmlDataProcessor from '@ckeditor/ckeditor5-engine/src/dataprocessor/htmldataprocessor';\r\nimport ClassicEditorUI from './classiceditorui';\r\nimport ClassicEditorUIView from './classiceditoruiview';\r\nimport ElementReplacer from '@ckeditor/ckeditor5-utils/src/elementreplacer';\r\nimport getDataFromElement from '@ckeditor/ckeditor5-utils/src/dom/getdatafromelement';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport { isElement } from 'lodash-es';\r\n\r\n/**\r\n * The {@glink builds/guides/overview#classic-editor classic editor} implementation.\r\n * It uses an inline editable and a sticky toolbar, all enclosed in a boxed UI.\r\n * See the {@glink examples/builds/classic-editor demo}.\r\n *\r\n * In order to create a classic editor instance, use the static\r\n * {@link module:editor-classic/classiceditor~ClassicEditor.create `ClassicEditor.create()`} method.\r\n *\r\n * # Classic editor and classic build\r\n *\r\n * The classic editor can be used directly from source (if you installed the\r\n * [`@ckeditor/ckeditor5-editor-classic`](https://www.npmjs.com/package/@ckeditor/ckeditor5-editor-classic) package)\r\n * but it is also available in the {@glink builds/guides/overview#classic-editor classic build}.\r\n *\r\n * {@glink builds/guides/overview Builds} are ready-to-use editors with plugins bundled in. When using the editor from\r\n * source you need to take care of loading all plugins by yourself\r\n * (through the {@link module:core/editor/editorconfig~EditorConfig#plugins `config.plugins`} option).\r\n * Using the editor from source gives much better flexibility and allows easier customization.\r\n *\r\n * Read more about initializing the editor from source or as a build in\r\n * {@link module:editor-classic/classiceditor~ClassicEditor.create `ClassicEditor.create()`}.\r\n *\r\n * @mixes module:core/editor/utils/dataapimixin~DataApiMixin\r\n * @mixes module:core/editor/utils/elementapimixin~ElementApiMixin\r\n * @implements module:core/editor/editorwithui~EditorWithUI\r\n * @extends module:core/editor/editor~Editor\r\n */\r\nexport default class ClassicEditor extends Editor {\r\n\t/**\r\n\t * Creates an instance of the classic editor.\r\n\t *\r\n\t * **Note:** do not use the constructor to create editor instances. Use the static\r\n\t * {@link module:editor-classic/classiceditor~ClassicEditor.create `ClassicEditor.create()`} method instead.\r\n\t *\r\n\t * @protected\r\n\t * @param {HTMLElement|String} sourceElementOrData The DOM element that will be the source for the created editor\r\n\t * or the editor's initial data. For more information see\r\n\t * {@link module:editor-classic/classiceditor~ClassicEditor.create `ClassicEditor.create()`}.\r\n\t * @param {module:core/editor/editorconfig~EditorConfig} config The editor configuration.\r\n\t */\r\n\tconstructor( sourceElementOrData, config ) {\r\n\t\tsuper( config );\r\n\r\n\t\tif ( isElement( sourceElementOrData ) ) {\r\n\t\t\tthis.sourceElement = sourceElementOrData;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * The element replacer instance used to hide the editor's source element.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:utils/elementreplacer~ElementReplacer}\r\n\t\t */\r\n\t\tthis._elementReplacer = new ElementReplacer();\r\n\r\n\t\tthis.data.processor = new HtmlDataProcessor();\r\n\r\n\t\tthis.model.document.createRoot();\r\n\r\n\t\tthis.ui = new ClassicEditorUI( this, new ClassicEditorUIView( this.locale ) );\r\n\r\n\t\tattachToForm( this );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tget element() {\r\n\t\treturn this.ui.view.element;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the editor instance, releasing all resources used by it.\r\n\t *\r\n\t * Updates the editor's source element with the data.\r\n\t *\r\n\t * @returns {Promise}\r\n\t */\r\n\tdestroy() {\r\n\t\tif ( this.sourceElement ) {\r\n\t\t\tthis.updateSourceElement();\r\n\t\t}\r\n\r\n\t\tthis._elementReplacer.restore();\r\n\t\tthis.ui.destroy();\r\n\r\n\t\treturn super.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a classic editor instance.\r\n\t *\r\n\t * Creating an instance when using a {@glink builds/index CKEditor build}:\r\n\t *\r\n\t *\t\tClassicEditor\r\n\t *\t\t\t.create( document.querySelector( '#editor' ) )\r\n\t *\t\t\t.then( editor => {\r\n\t *\t\t\t\tconsole.log( 'Editor was initialized', editor );\r\n\t *\t\t\t} )\r\n\t *\t\t\t.catch( err => {\r\n\t *\t\t\t\tconsole.error( err.stack );\r\n\t *\t\t\t} );\r\n\t *\r\n\t * Creating an instance when using CKEditor from source (make sure to specify the list of plugins to load and the toolbar):\r\n\t *\r\n\t *\t\timport ClassicEditor from '@ckeditor/ckeditor5-editor-classic/src/classiceditor';\r\n\t *\t\timport Essentials from '@ckeditor/ckeditor5-essentials/src/essentials';\r\n\t *\t\timport Bold from '@ckeditor/ckeditor5-basic-styles/src/bold';\r\n\t *\t\timport Italic from '@ckeditor/ckeditor5-basic-styles/src/italic';\r\n\t *\t\timport ...\r\n\t *\r\n\t *\t\tClassicEditor\r\n\t *\t\t\t.create( document.querySelector( '#editor' ), {\r\n\t *\t\t\t\tplugins: [ Essentials, Bold, Italic, ... ],\r\n\t *\t\t\t\ttoolbar: [ 'bold', 'italic', ... ]\r\n\t *\t\t\t} )\r\n\t *\t\t\t.then( editor => {\r\n\t *\t\t\t\tconsole.log( 'Editor was initialized', editor );\r\n\t *\t\t\t} )\r\n\t *\t\t\t.catch( err => {\r\n\t *\t\t\t\tconsole.error( err.stack );\r\n\t *\t\t\t} );\r\n\t *\r\n\t * Creating an instance when using initial data instead of a DOM element:\r\n\t *\r\n\t *\t\timport ClassicEditor from '@ckeditor/ckeditor5-editor-classic/src/classiceditor';\r\n\t *\t\timport Essentials from '@ckeditor/ckeditor5-essentials/src/essentials';\r\n\t *\t\timport Bold from '@ckeditor/ckeditor5-basic-styles/src/bold';\r\n\t *\t\timport Italic from '@ckeditor/ckeditor5-basic-styles/src/italic';\r\n\t *\t\timport ...\r\n\t *\r\n\t *\t\tClassicEditor\r\n\t *\t\t\t.create( '<p>Hello world!</p>' )\r\n\t *\t\t\t.then( editor => {\r\n\t *\t\t\t\tconsole.log( 'Editor was initialized', editor );\r\n\t *\r\n\t *\t\t\t\t// Initial data was provided so `editor.element` needs to be added manually to the DOM.\r\n\t *\t\t\t\tdocument.body.appendChild( editor.element );\r\n\t *\t\t\t} )\r\n\t *\t\t\t.catch( err => {\r\n\t *\t\t\t\tconsole.error( err.stack );\r\n\t *\t\t\t} );\r\n\t *\r\n\t * @param {HTMLElement|String} sourceElementOrData The DOM element that will be the source for the created editor\r\n\t * or the editor's initial data.\r\n\t *\r\n\t * If a source element is passed, then its contents will be automatically\r\n\t * {@link module:editor-classic/classiceditor~ClassicEditor#setData loaded} to the editor on startup\r\n\t * and the {@link module:core/editor/editorwithui~EditorWithUI#element editor element} will replace the passed element in the DOM\r\n\t * (the original one will be hidden and the editor will be injected next to it).\r\n\t *\r\n\t * Moreover, the data will be set back to the source element once the editor is destroyed and\r\n\t * (if the element is a `<textarea>`) when a form in which this element is contained is submitted (which ensures\r\n\t * automatic integration with native web forms).\r\n\t *\r\n\t * If the data is passed, a detached editor will be created. It means that you need to insert it into the DOM manually\r\n\t * (by accessing the {@link module:editor-classic/classiceditor~ClassicEditor#element `editor.element`} property).\r\n\t *\r\n\t * See the examples above to learn more.\r\n\t *\r\n\t * @param {module:core/editor/editorconfig~EditorConfig} config The editor configuration.\r\n\t * @returns {Promise} A promise resolved once the editor is ready.\r\n\t * The promise returns the created {@link module:editor-classic/classiceditor~ClassicEditor} instance.\r\n\t */\r\n\tstatic create( sourceElementOrData, config ) {\r\n\t\treturn new Promise( resolve => {\r\n\t\t\tconst editor = new this( sourceElementOrData, config );\r\n\r\n\t\t\tresolve(\r\n\t\t\t\teditor.initPlugins()\r\n\t\t\t\t\t.then( () => editor.ui.init() )\r\n\t\t\t\t\t.then( () => {\r\n\t\t\t\t\t\tif ( isElement( sourceElementOrData ) ) {\r\n\t\t\t\t\t\t\teditor._elementReplacer.replace( sourceElementOrData, editor.element );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\teditor.fire( 'uiReady' );\r\n\t\t\t\t\t} )\r\n\t\t\t\t\t.then( () => editor.editing.view.attachDomRoot( editor.ui.view.editableElement ) )\r\n\t\t\t\t\t.then( () => {\r\n\t\t\t\t\t\tconst initialData = isElement( sourceElementOrData ) ?\r\n\t\t\t\t\t\t\tgetDataFromElement( sourceElementOrData ) :\r\n\t\t\t\t\t\t\tsourceElementOrData;\r\n\r\n\t\t\t\t\t\treturn editor.data.init( initialData );\r\n\t\t\t\t\t} )\r\n\t\t\t\t\t.then( () => {\r\n\t\t\t\t\t\teditor.fire( 'dataReady' );\r\n\t\t\t\t\t\teditor.fire( 'ready' );\r\n\t\t\t\t\t} )\r\n\t\t\t\t\t.then( () => editor )\r\n\t\t\t);\r\n\t\t} );\r\n\t}\r\n}\r\n\r\nmix( ClassicEditor, DataApiMixin );\r\nmix( ClassicEditor, ElementApiMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport { isFunction } from 'lodash-es';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * @module core/editor/utils/attachtoform\r\n */\r\n\r\n/**\r\n * Checks if the editor is initialized on a `<textarea>` element that belongs to a form. If yes, it updates the editor's element\r\n * content before submitting the form.\r\n *\r\n * This helper requires the {@link module:core/editor/utils/elementapimixin~ElementApi ElementApi interface}.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor Editor instance.\r\n */\r\nexport default function attachToForm( editor ) {\r\n\tif ( !isFunction( editor.updateSourceElement ) ) {\r\n\t\t/**\r\n\t\t * The editor passed to `attachToForm()` must implement the\r\n\t\t * {@link module:core/editor/utils/elementapimixin~ElementApi} interface.\r\n\t\t *\r\n\t\t * @error attachtoform-missing-elementapi-interface\r\n\t\t */\r\n\t\tthrow new CKEditorError( 'attachtoform-missing-elementapi-interface: Editor passed to attachToForm() must implement ElementApi.' );\r\n\t}\r\n\r\n\tconst sourceElement = editor.sourceElement;\r\n\r\n\t// Only when replacing a textarea which is inside of a form element.\r\n\tif ( sourceElement && sourceElement.tagName.toLowerCase() === 'textarea' && sourceElement.form ) {\r\n\t\tlet originalSubmit;\r\n\t\tconst form = sourceElement.form;\r\n\t\tconst onSubmit = () => editor.updateSourceElement();\r\n\r\n\t\t// Replace the original form#submit() to call a custom submit function first.\r\n\t\t// Check if #submit is a function because the form might have an input named \"submit\".\r\n\t\tif ( isFunction( form.submit ) ) {\r\n\t\t\toriginalSubmit = form.submit;\r\n\r\n\t\t\tform.submit = () => {\r\n\t\t\t\tonSubmit();\r\n\t\t\t\toriginalSubmit.apply( form );\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Update the replaced textarea with data before each form#submit event.\r\n\t\tform.addEventListener( 'submit', onSubmit );\r\n\r\n\t\t// Remove the submit listener and revert the original submit method on\r\n\t\t// editor#destroy.\r\n\t\teditor.on( 'destroy', () => {\r\n\t\t\tform.removeEventListener( 'submit', onSubmit );\r\n\r\n\t\t\tif ( originalSubmit ) {\r\n\t\t\t\tform.submit = originalSubmit;\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals HTMLTextAreaElement */\r\n\r\n/**\r\n * @module utils/dom/getdatafromelement\r\n */\r\n\r\n/**\r\n * Gets data from a given source element.\r\n *\r\n * @param {HTMLElement} el The element from which the data will be retrieved.\r\n * @returns {String} The data string.\r\n */\r\nexport default function getDataFromElement( el ) {\r\n\tif ( el instanceof HTMLTextAreaElement ) {\r\n\t\treturn el.value;\r\n\t}\r\n\r\n\treturn el.innerHTML;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/plugin\r\n */\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * The base class for CKEditor plugin classes.\r\n *\r\n * @implements module:core/plugin~PluginInterface\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\t/**\r\n\t\t * The editor instance.\r\n\t\t *\r\n\t\t * Note that most editors implement the {@link module:core/editor/editorwithui~EditorWithUI} interface in addition\r\n\t\t * to the base {@link module:core/editor/editor~Editor} interface. However, editors with an external UI\r\n\t\t * (i.e. Bootstrap-based) or a headless editor may not implement the {@link module:core/editor/editorwithui~EditorWithUI}\r\n\t\t * interface.\r\n\t\t *\r\n\t\t * Because of above, to make plugins more universal, it is recommended to split features into:\r\n\t\t *  - The \"editing\" part that only uses the {@link module:core/editor/editor~Editor} interface.\r\n\t\t *  - The \"UI\" part that uses both the {@link module:core/editor/editor~Editor} interface and\r\n\t\t *  the {@link module:core/editor/editorwithui~EditorWithUI} interface.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor} #editor\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.stopListening();\r\n\t}\r\n}\r\n\r\nmix( Plugin, ObservableMixin );\r\n\r\n/**\r\n * The base interface for CKEditor plugins.\r\n *\r\n * In its minimal form it can be a simple function (it will be used as a constructor) that accepts\r\n * {@link module:core/editor/editor~Editor the editor} as a parameter.\r\n * It can also implement a few methods which, when present, will be used to properly initialize and destroy the plugin.\r\n *\r\n *\t\t// A simple plugin that enables a data processor.\r\n *\t\tfunction MyPlugin( editor ) {\r\n *\t\t\teditor.data.processor = new MyDataProcessor();\r\n *\t\t}\r\n *\r\n * In most cases, however, you will want to inherit from the {@link module:core/plugin~Plugin} class which implements the\r\n * {@link module:utils/observablemixin~ObservableMixin} and is, therefore, more convenient:\r\n *\r\n *\t\tclass MyPlugin extends Plugin {\r\n *\t\t\tinit() {\r\n *\t\t\t\t// `listenTo()` and `editor` are available thanks to `Plugin`.\r\n *\t\t\t\t// By using `listenTo()` you will ensure that the listener is removed when\r\n *\t\t\t\t// the plugin is destroyed.\r\n *\t\t\t\tthis.listenTo( this.editor, 'dataReady', () => {\r\n *\t\t\t\t\t// Do something when the data is ready.\r\n *\t\t\t\t} );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n * @interface PluginInterface\r\n */\r\n\r\n/**\r\n * Creates a new plugin instance. This is the first step of the plugin initialization.\r\n * See also {@link #init} and {@link #afterInit}.\r\n *\r\n * A plugin is always instantiated after its {@link module:core/plugin~PluginInterface.requires dependencies} and the\r\n * {@link #init} and {@link #afterInit} methods are called in the same order.\r\n *\r\n * Usually, you will want to put your plugin's initialization code in the {@link #init} method.\r\n * The constructor can be understood as \"before init\" and used in special cases, just like\r\n * {@link #afterInit} serves the special \"after init\" scenarios (e.g.the code which depends on other\r\n * plugins, but which does not {@link module:core/plugin~PluginInterface.requires explicitly require} them).\r\n *\r\n * @method #constructor\r\n * @param {module:core/editor/editor~Editor} editor\r\n */\r\n\r\n/**\r\n * An array of plugins required by this plugin.\r\n *\r\n * To keep the plugin class definition tight it is recommended to define this property as a static getter:\r\n *\r\n *\t\timport Image from './image.js';\r\n *\r\n *\t\texport default class ImageCaption {\r\n *\t\t\tstatic get requires() {\r\n *\t\t\t\treturn [ Image ];\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n * @static\r\n * @readonly\r\n * @member {Array.<Function>|undefined} module:core/plugin~PluginInterface.requires\r\n */\r\n\r\n/**\r\n * An optional name of the plugin. If set, the plugin will be available in\r\n * {@link module:core/plugincollection~PluginCollection#get} by its\r\n * name and its constructor. If not, then only by its constructor.\r\n *\r\n * The name should reflect the constructor name.\r\n *\r\n * To keep the plugin class definition tight it is recommended to define this property as a static getter:\r\n *\r\n *\t\texport default class ImageCaption {\r\n *\t\t\tstatic get pluginName() {\r\n *\t\t\t\treturn 'ImageCaption';\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n * Note: The native `Function.name` property could not be used to keep the plugin name because\r\n * it will be mangled during code minification.\r\n *\r\n * Naming a plugin is necessary to enable removing it through the\r\n * {@link module:core/editor/editorconfig~EditorConfig#removePlugins `config.removePlugins`} option.\r\n *\r\n * @static\r\n * @readonly\r\n * @member {String|undefined} module:core/plugin~PluginInterface.pluginName\r\n */\r\n\r\n/**\r\n * The second stage (after plugin {@link #constructor}) of plugin initialization.\r\n * Unlike the plugin constructor this method can be asynchronous.\r\n *\r\n * A plugin's `init()` method is called after its {@link module:core/plugin~PluginInterface.requires dependencies} are initialized,\r\n * so in the same order as constructors of these plugins.\r\n *\r\n * **Note:** This method is optional. A plugin instance does not need to have it defined.\r\n *\r\n * @method #init\r\n * @returns {null|Promise}\r\n */\r\n\r\n/**\r\n * The third (and last) stage of plugin initialization. See also {@link #constructor} and {@link #init}.\r\n *\r\n * **Note:** This method is optional. A plugin instance does not need to have it defined.\r\n *\r\n * @method #afterInit\r\n * @returns {null|Promise}\r\n */\r\n\r\n/**\r\n * Destroys the plugin.\r\n *\r\n * **Note:** This method is optional. A plugin instance does not need to have it defined.\r\n *\r\n * @method #destroy\r\n * @returns {null|Promise}\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/datatransfer\r\n */\r\n\r\n/**\r\n * Facade over the native [`DataTransfer`](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer) object.\r\n */\r\nexport default class DataTransfer {\r\n\tconstructor( nativeDataTransfer ) {\r\n\t\t/**\r\n\t\t * The array of files created from the native `DataTransfer#files` or `DataTransfer#items`.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<File>} #files\r\n\t\t */\r\n\t\tthis.files = getFiles( nativeDataTransfer );\r\n\r\n\t\t/**\r\n\t\t * The native DataTransfer object.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {DataTransfer} #_native\r\n\t\t */\r\n\t\tthis._native = nativeDataTransfer;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array of available native content types.\r\n\t *\r\n\t * @returns {Array.<String>}\r\n\t */\r\n\tget types() {\r\n\t\treturn this._native.types;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets data from the data transfer by its mime type.\r\n\t *\r\n\t *\t\tdataTransfer.getData( 'text/plain' );\r\n\t *\r\n\t * @param {String} type The mime type. E.g. `text/html` or `text/plain`.\r\n\t * @returns {String}\r\n\t */\r\n\tgetData( type ) {\r\n\t\treturn this._native.getData( type );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets data in the data transfer.\r\n\t *\r\n\t * @param {String} type The mime type. E.g. `text/html` or `text/plain`.\r\n\t * @param {String} data\r\n\t */\r\n\tsetData( type, data ) {\r\n\t\tthis._native.setData( type, data );\r\n\t}\r\n}\r\n\r\nfunction getFiles( nativeDataTransfer ) {\r\n\t// DataTransfer.files and items are Array-like and might not have an iterable interface.\r\n\tconst files = nativeDataTransfer.files ? Array.from( nativeDataTransfer.files ) : [];\r\n\tconst items = nativeDataTransfer.items ? Array.from( nativeDataTransfer.items ) : [];\r\n\r\n\tif ( files.length ) {\r\n\t\treturn files;\r\n\t}\r\n\t// Chrome have empty DataTransfer.files, but let get files through the items interface.\r\n\treturn items\r\n\t\t.filter( item => item.kind === 'file' )\r\n\t\t.map( item => item.getAsFile() );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/clipboardobserver\r\n */\r\n\r\nimport DomEventObserver from '@ckeditor/ckeditor5-engine/src/view/observer/domeventobserver';\r\nimport DataTransfer from './datatransfer';\r\n\r\n/**\r\n * Clipboard events observer.\r\n *\r\n * Fires the following events:\r\n *\r\n * * {@link module:engine/view/document~Document#event:clipboardInput}\r\n * * {@link module:engine/view/document~Document#event:dragover}\r\n * * {@link module:engine/view/document~Document#event:drop}\r\n * * {@link module:engine/view/document~Document#event:paste}\r\n * * {@link module:engine/view/document~Document#event:copy}\r\n * * {@link module:engine/view/document~Document#event:cut}\r\n *\r\n * Note that this observer is not available by default (it is not added by the engine).\r\n * To make it available it needs to be added to {@link module:engine/view/document~Document} by\r\n * the {@link module:engine/view/view~View#addObserver `View#addObserver()`} method. You can also load the\r\n * {@link module:clipboard/clipboard~Clipboard} plugin which adds this observer automatically (because it uses it).\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class ClipboardObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tconst viewDocument = this.document;\r\n\r\n\t\tthis.domEventType = [ 'paste', 'copy', 'cut', 'drop', 'dragover' ];\r\n\r\n\t\tthis.listenTo( viewDocument, 'paste', handleInput, { priority: 'low' } );\r\n\t\tthis.listenTo( viewDocument, 'drop', handleInput, { priority: 'low' } );\r\n\r\n\t\tfunction handleInput( evt, data ) {\r\n\t\t\tdata.preventDefault();\r\n\r\n\t\t\tconst targetRanges = data.dropRange ? [ data.dropRange ] : Array.from( viewDocument.selection.getRanges() );\r\n\r\n\t\t\tviewDocument.fire( 'clipboardInput', {\r\n\t\t\t\tdataTransfer: data.dataTransfer,\r\n\t\t\t\ttargetRanges\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\tonDomEvent( domEvent ) {\r\n\t\tconst evtData = {\r\n\t\t\tdataTransfer: new DataTransfer( domEvent.clipboardData ? domEvent.clipboardData : domEvent.dataTransfer )\r\n\t\t};\r\n\r\n\t\tif ( domEvent.type == 'drop' ) {\r\n\t\t\tevtData.dropRange = getDropViewRange( this.view, domEvent );\r\n\t\t}\r\n\r\n\t\tthis.fire( domEvent.type, domEvent, evtData );\r\n\t}\r\n}\r\n\r\nfunction getDropViewRange( view, domEvent ) {\r\n\tconst domDoc = domEvent.target.ownerDocument;\r\n\tconst x = domEvent.clientX;\r\n\tconst y = domEvent.clientY;\r\n\tlet domRange;\r\n\r\n\t// Webkit & Blink.\r\n\tif ( domDoc.caretRangeFromPoint && domDoc.caretRangeFromPoint( x, y ) ) {\r\n\t\tdomRange = domDoc.caretRangeFromPoint( x, y );\r\n\t}\r\n\t// FF.\r\n\telse if ( domEvent.rangeParent ) {\r\n\t\tdomRange = domDoc.createRange();\r\n\t\tdomRange.setStart( domEvent.rangeParent, domEvent.rangeOffset );\r\n\t\tdomRange.collapse( true );\r\n\t}\r\n\r\n\tif ( domRange ) {\r\n\t\treturn view.domConverter.domRangeToView( domRange );\r\n\t} else {\r\n\t\treturn view.document.selection.getFirstRange();\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired as a continuation of {@link #event:paste} and {@link #event:drop} events.\r\n *\r\n * It is a part of the {@glink framework/guides/deep-dive/clipboard#input-pipeline \"clipboard input pipeline\"}.\r\n *\r\n * Fired with a `dataTransfer` which comes from the clipboard and which content should be processed\r\n * and inserted into the editor.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:clipboard/clipboardobserver~ClipboardObserver\r\n * @see module:clipboard/clipboard~Clipboard\r\n * @event module:engine/view/document~Document#event:clipboardInput\r\n * @param {Object} data Event data.\r\n * @param {module:clipboard/datatransfer~DataTransfer} data.dataTransfer Data transfer instance.\r\n * @param {Array.<module:engine/view/range~Range>} data.targetRanges Ranges which are the target of the operation\r\n * (usually – into which the content should be inserted).\r\n * If clipboard input was triggered by a paste operation, then these are the selection ranges. If by a drop operation,\r\n * then it's the drop position (which can be different than the selection at the moment of drop).\r\n */\r\n\r\n/**\r\n * Fired when user drags content over one of the editables.\r\n *\r\n * Introduced by {@link module:clipboard/clipboardobserver~ClipboardObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:engine/view/document~Document#event:clipboardInput\r\n * @event module:engine/view/document~Document#event:dragover\r\n * @param {module:clipboard/clipboardobserver~ClipboardEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when user dropped content into one of the editables.\r\n *\r\n * Introduced by {@link module:clipboard/clipboardobserver~ClipboardObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:engine/view/document~Document#event:clipboardInput\r\n * @event module:engine/view/document~Document#event:drop\r\n * @param {module:clipboard/clipboardobserver~ClipboardEventData} data Event data.\r\n * @param {module:engine/view/range~Range} dropRange The position into which the content is dropped.\r\n */\r\n\r\n/**\r\n * Fired when user pasted content into one of the editables.\r\n *\r\n * Introduced by {@link module:clipboard/clipboardobserver~ClipboardObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:engine/view/document~Document#event:clipboardInput\r\n * @event module:engine/view/document~Document#event:paste\r\n * @param {module:clipboard/clipboardobserver~ClipboardEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when user copied content from one of the editables.\r\n *\r\n * Introduced by {@link module:clipboard/clipboardobserver~ClipboardObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:clipboard/clipboardobserver~ClipboardObserver\r\n * @event module:engine/view/document~Document#event:copy\r\n * @param {module:clipboard/clipboardobserver~ClipboardEventData} data Event data.\r\n */\r\n\r\n/**\r\n * Fired when user cut content from one of the editables.\r\n *\r\n * Introduced by {@link module:clipboard/clipboardobserver~ClipboardObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:clipboard/clipboardobserver~ClipboardObserver}\r\n * needs to be added to {@link module:engine/view/document~Document} by the {@link module:engine/view/view~View#addObserver} method.\r\n * It's done by the {@link module:clipboard/clipboard~Clipboard} feature. If it's not loaded, it must be done manually.\r\n *\r\n * @see module:clipboard/clipboardobserver~ClipboardObserver\r\n * @event module:engine/view/document~Document#event:cut\r\n * @param {module:clipboard/clipboardobserver~ClipboardEventData} data Event data.\r\n */\r\n\r\n/**\r\n * The value of the {@link module:engine/view/document~Document#event:paste},\r\n * {@link module:engine/view/document~Document#event:copy} and {@link module:engine/view/document~Document#event:cut} events.\r\n *\r\n * In order to access clipboard data use `dataTransfer` property.\r\n *\r\n * @class module:clipboard/clipboardobserver~ClipboardEventData\r\n * @extends module:engine/view/observer/domeventdata~DomEventData\r\n */\r\n\r\n/**\r\n * Data transfer instance.\r\n *\r\n * @readonly\r\n * @member {module:clipboard/datatransfer~DataTransfer} module:clipboard/clipboardobserver~ClipboardEventData#dataTransfer\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/utils/viewtoplaintext\r\n */\r\n\r\n// Elements which should not have empty-line padding.\r\n// Most `view.ContainerElement` want to be separate by new-line, but some are creating one structure\r\n// together (like `<li>`) so it is better to separate them by only one \"\\n\".\r\nconst smallPaddingElements = [ 'figcaption', 'li' ];\r\n\r\n/**\r\n * Converts {@link module:engine/view/item~Item view item} and all of its children to plain text.\r\n *\r\n * @param {module:engine/view/item~Item} viewItem View item to convert.\r\n * @returns {String} Plain text representation of `viewItem`.\r\n */\r\nexport default function viewToPlainText( viewItem ) {\r\n\tlet text = '';\r\n\r\n\tif ( viewItem.is( 'text' ) || viewItem.is( 'textProxy' ) ) {\r\n\t\t// If item is `Text` or `TextProxy` simple take its text data.\r\n\t\ttext = viewItem.data;\r\n\t} else if ( viewItem.is( 'img' ) && viewItem.hasAttribute( 'alt' ) ) {\r\n\t\t// Special case for images - use alt attribute if it is provided.\r\n\t\ttext = viewItem.getAttribute( 'alt' );\r\n\t} else {\r\n\t\t// Other elements are document fragments, attribute elements or container elements.\r\n\t\t// They don't have their own text value, so convert their children.\r\n\t\tlet prev = null;\r\n\r\n\t\tfor ( const child of viewItem.getChildren() ) {\r\n\t\t\tconst childText = viewToPlainText( child );\r\n\r\n\t\t\t// Separate container element children with one or more new-line characters.\r\n\t\t\tif ( prev && ( prev.is( 'containerElement' ) || child.is( 'containerElement' ) ) ) {\r\n\t\t\t\tif ( smallPaddingElements.includes( prev.name ) || smallPaddingElements.includes( child.name ) ) {\r\n\t\t\t\t\ttext += '\\n';\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext += '\\n\\n';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttext += childText;\r\n\t\t\tprev = child;\r\n\t\t}\r\n\t}\r\n\r\n\treturn text;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/clipboard\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport ClipboardObserver from './clipboardobserver';\r\n\r\nimport plainTextToHtml from './utils/plaintexttohtml';\r\nimport normalizeClipboardHtml from './utils/normalizeclipboarddata';\r\nimport viewToPlainText from './utils/viewtoplaintext.js';\r\n\r\nimport HtmlDataProcessor from '@ckeditor/ckeditor5-engine/src/dataprocessor/htmldataprocessor';\r\n\r\n/**\r\n * The clipboard feature. It is responsible for intercepting the `paste` and `drop` events and\r\n * passing the pasted content through the clipboard pipeline in order to insert it into the editor's content.\r\n * It also handles the `cut` and `copy` events to fill the native clipboard with serialized editor's data.\r\n *\r\n * Read more about the clipboard integration in {@glink framework/guides/deep-dive/clipboard \"Clipboard\" deep dive} guide.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Clipboard extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Clipboard';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst modelDocument = editor.model.document;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\r\n\t\t/**\r\n\t\t * Data processor used to convert pasted HTML to a view structure.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/dataprocessor/htmldataprocessor~HtmlDataProcessor} #_htmlDataProcessor\r\n\t\t */\r\n\t\tthis._htmlDataProcessor = new HtmlDataProcessor();\r\n\r\n\t\tview.addObserver( ClipboardObserver );\r\n\r\n\t\t// The clipboard paste pipeline.\r\n\r\n\t\t// Pasting and dropping is disabled when editor is read-only.\r\n\t\t// See: https://github.com/ckeditor/ckeditor5-clipboard/issues/26.\r\n\t\tthis.listenTo( viewDocument, 'clipboardInput', evt => {\r\n\t\t\tif ( editor.isReadOnly ) {\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\tthis.listenTo( viewDocument, 'clipboardInput', ( evt, data ) => {\r\n\t\t\tconst dataTransfer = data.dataTransfer;\r\n\t\t\tlet content = '';\r\n\r\n\t\t\tif ( dataTransfer.getData( 'text/html' ) ) {\r\n\t\t\t\tcontent = normalizeClipboardHtml( dataTransfer.getData( 'text/html' ) );\r\n\t\t\t} else if ( dataTransfer.getData( 'text/plain' ) ) {\r\n\t\t\t\tcontent = plainTextToHtml( dataTransfer.getData( 'text/plain' ) );\r\n\t\t\t}\r\n\r\n\t\t\tcontent = this._htmlDataProcessor.toView( content );\r\n\r\n\t\t\tthis.fire( 'inputTransformation', { content, dataTransfer } );\r\n\r\n\t\t\tview.scrollToTheSelection();\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\tthis.listenTo( this, 'inputTransformation', ( evt, data ) => {\r\n\t\t\tif ( !data.content.isEmpty ) {\r\n\t\t\t\tconst dataController = this.editor.data;\r\n\t\t\t\tconst model = this.editor.model;\r\n\r\n\t\t\t\t// Convert the pasted content to a model document fragment.\r\n\t\t\t\t// Conversion is contextual, but in this case we need an \"all allowed\" context and for that\r\n\t\t\t\t// we use the $clipboardHolder item.\r\n\t\t\t\tconst modelFragment = dataController.toModel( data.content, '$clipboardHolder' );\r\n\r\n\t\t\t\tif ( modelFragment.childCount == 0 ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodel.insertContent( modelFragment );\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// The clipboard copy/cut pipeline.\r\n\r\n\t\tfunction onCopyCut( evt, data ) {\r\n\t\t\tconst dataTransfer = data.dataTransfer;\r\n\r\n\t\t\tdata.preventDefault();\r\n\r\n\t\t\tconst content = editor.data.toView( editor.model.getSelectedContent( modelDocument.selection ) );\r\n\r\n\t\t\tviewDocument.fire( 'clipboardOutput', { dataTransfer, content, method: evt.name } );\r\n\t\t}\r\n\r\n\t\tthis.listenTo( viewDocument, 'copy', onCopyCut, { priority: 'low' } );\r\n\t\tthis.listenTo( viewDocument, 'cut', ( evt, data ) => {\r\n\t\t\t// Cutting is disabled when editor is read-only.\r\n\t\t\t// See: https://github.com/ckeditor/ckeditor5-clipboard/issues/26.\r\n\t\t\tif ( editor.isReadOnly ) {\r\n\t\t\t\tdata.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\tonCopyCut( evt, data );\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\tthis.listenTo( viewDocument, 'clipboardOutput', ( evt, data ) => {\r\n\t\t\tif ( !data.content.isEmpty ) {\r\n\t\t\t\tdata.dataTransfer.setData( 'text/html', this._htmlDataProcessor.toData( data.content ) );\r\n\t\t\t\tdata.dataTransfer.setData( 'text/plain', viewToPlainText( data.content ) );\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.method == 'cut' ) {\r\n\t\t\t\teditor.model.deleteContent( modelDocument.selection );\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired with a `content` and `dataTransfer` objects. The `content` which comes from the clipboard (was pasted or dropped)\r\n * should be processed in order to be inserted into the editor. The `dataTransfer` object is available\r\n * in case the transformation functions needs access to a raw clipboard data.\r\n *\r\n * It is a part of the {@glink framework/guides/deep-dive/clipboard#input-pipeline \"clipboard input pipeline\"}.\r\n *\r\n * @see module:clipboard/clipboardobserver~ClipboardObserver\r\n * @see module:clipboard/clipboard~Clipboard\r\n * @event module:clipboard/clipboard~Clipboard#event:inputTransformation\r\n * @param {Object} data Event data.\r\n * @param {module:engine/view/documentfragment~DocumentFragment} data.content Event data. Content to be inserted into the editor.\r\n * It can be modified by the event listeners. Read more about the clipboard pipelines in\r\n * {@glink framework/guides/deep-dive/clipboard \"Clipboard\" deep dive}.\r\n * @param {module:clipboard/datatransfer~DataTransfer} data.dataTransfer Data transfer instance.\r\n */\r\n\r\n/**\r\n * Fired on {@link module:engine/view/document~Document#event:copy} and {@link module:engine/view/document~Document#event:cut}\r\n * with a copy of selected content. The content can be processed before it ends up in the clipboard.\r\n *\r\n * It is a part of the {@glink framework/guides/deep-dive/clipboard#output-pipeline \"clipboard output pipeline\"}.\r\n *\r\n * @see module:clipboard/clipboardobserver~ClipboardObserver\r\n * @see module:clipboard/clipboard~Clipboard\r\n * @event module:engine/view/document~Document#event:clipboardOutput\r\n * @param {module:clipboard/clipboard~ClipboardOutputEventData} data Event data.\r\n */\r\n\r\n/**\r\n * The value of the {@link module:engine/view/document~Document#event:clipboardOutput} event.\r\n *\r\n * @class module:clipboard/clipboard~ClipboardOutputEventData\r\n */\r\n\r\n/**\r\n * Data transfer instance.\r\n *\r\n * @readonly\r\n * @member {module:clipboard/datatransfer~DataTransfer} module:clipboard/clipboard~ClipboardOutputEventData#dataTransfer\r\n */\r\n\r\n/**\r\n * Content to be put into the clipboard. It can be modified by the event listeners.\r\n * Read more about the clipboard pipelines in {@glink framework/guides/deep-dive/clipboard \"Clipboard\" deep dive}.\r\n *\r\n * @member {module:engine/view/documentfragment~DocumentFragment} module:clipboard/clipboard~ClipboardOutputEventData#content\r\n */\r\n\r\n/**\r\n * Whether the event was triggered by copy or cut operation.\r\n *\r\n * @member {'copy'|'cut'} module:clipboard/clipboard~ClipboardOutputEventData#method\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/utils/normalizeclipboarddata\r\n */\r\n\r\n/**\r\n * Removes some popular browser quirks out of the clipboard data (HTML).\r\n *\r\n * @param {String} data The HTML data to normalize.\r\n * @returns {String} Normalized HTML.\r\n */\r\nexport default function normalizeClipboardData( data ) {\r\n\treturn data\r\n\t\t.replace( /<span(?: class=\"Apple-converted-space\"|)>(\\s+)<\\/span>/g, ( fullMatch, spaces ) => {\r\n\t\t\t// Handle the most popular and problematic case when even a single space becomes an nbsp;.\r\n\t\t\t// Decode those to normal spaces. Read more in https://github.com/ckeditor/ckeditor5-clipboard/issues/2.\r\n\t\t\tif ( spaces.length == 1 ) {\r\n\t\t\t\treturn ' ';\r\n\t\t\t}\r\n\r\n\t\t\treturn spaces;\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module clipboard/utils/plaintexttohtml\r\n */\r\n\r\n/**\r\n * Converts plain text to its HTML-ized version.\r\n *\r\n * @param {String} text The plain text to convert.\r\n * @returns {String} HTML generated from the plain text.\r\n */\r\nexport default function plainTextToHtml( text ) {\r\n\ttext = text\r\n\t\t// Encode <>.\r\n\t\t.replace( /</g, '&lt;' )\r\n\t\t.replace( />/g, '&gt;' )\r\n\t\t// Creates paragraphs for double line breaks and change single line breaks to <br>s.\r\n\t\t.replace( /\\n\\n/g, '</p><p>' )\r\n\t\t.replace( /\\n/g, '<br>' )\r\n\t\t// Preserve trailing spaces (only the first and last one – the rest is handled below).\r\n\t\t.replace( /^\\s/, '&nbsp;' )\r\n\t\t.replace( /\\s$/, '&nbsp;' )\r\n\t\t// Preserve other subsequent spaces now.\r\n\t\t.replace( /\\s\\s/g, ' &nbsp;' );\r\n\r\n\tif ( text.indexOf( '</p><p>' ) > -1 ) {\r\n\t\t// If we created paragraphs above, add the trailing ones.\r\n\t\ttext = `<p>${ text }</p>`;\r\n\t}\r\n\r\n\t// TODO:\r\n\t// * What about '\\nfoo' vs ' foo'?\r\n\r\n\treturn text;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/command\r\n */\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * The base class for CKEditor commands.\r\n *\r\n * Commands are the main way to manipulate editor contents and state. They are mostly used by UI elements (or by other\r\n * commands) to make changes in the model. Commands are available in every part of code that has access to\r\n * the {@link module:core/editor/editor~Editor editor} instance.\r\n *\r\n * Instances of registered commands can be retrieved from {@link module:core/editor/editor~Editor#commands `editor.commands`}.\r\n * The easiest way to execute a command is through {@link module:core/editor/editor~Editor#execute `editor.execute()`}.\r\n *\r\n * By default commands are disabled when the editor is in {@link module:core/editor/editor~Editor#isReadOnly read-only} mode.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Command {\r\n\t/**\r\n\t * Creates a new `Command` instance.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor Editor on which this command will be used.\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\t/**\r\n\t\t * The editor on which this command will be used.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor}\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\r\n\t\t/**\r\n\t\t * The value of the command. A concrete command class should define what it represents for it.\r\n\t\t *\r\n\t\t * For example, the `'bold'` command's value indicates whether the selection starts in a bolded text.\r\n\t\t * And the value of the `'link'` command may be an object with links details.\r\n\t\t *\r\n\t\t * It is possible for a command to have no value (e.g. for stateless actions such as `'imageUpload'`).\r\n\t\t *\r\n\t\t * A concrete command class should control this value by overriding the {@link #refresh `refresh()`} method.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member #value\r\n\t\t */\r\n\t\tthis.set( 'value', undefined );\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether a command is enabled or disabled.\r\n\t\t * A disabled command will do nothing when executed.\r\n\t\t *\r\n\t\t * A concrete command class should control this value by overriding the {@link #refresh `refresh()`} method.\r\n\t\t *\r\n\t\t * It is possible to disable a command from \"outside\". For instance, in your integration you may want to disable\r\n\t\t * a certain set of commands for the time being. To do that, you can use the fact that `isEnabled` is observable\r\n\t\t * and it fires the `set:isEnabled` event every time anyone tries to modify its value:\r\n\t\t *\r\n\t\t *\t\tfunction disableCommand( cmd ) {\r\n\t\t *\t\t\tcmd.on( 'set:isEnabled', forceDisable, { priority: 'highest' } );\r\n\t\t *\r\n\t\t *\t\t\tcmd.isEnabled = false;\r\n\t\t *\r\n\t\t *\t\t\t// Make it possible to enable the command again.\r\n\t\t *\t\t\treturn () => {\r\n\t\t *\t\t\t\tcmd.off( 'set:isEnabled', forceDisable );\r\n\t\t *\t\t\t\tcmd.refresh();\r\n\t\t *\t\t\t};\r\n\t\t *\r\n\t\t *\t\t\tfunction forceDisable( evt ) {\r\n\t\t *\t\t\t\tevt.return = false;\r\n\t\t *\t\t\t\tevt.stop();\r\n\t\t *\t\t\t}\r\n\t\t *\t\t}\r\n\t\t *\r\n\t\t *\t\t// Usage:\r\n\t\t *\r\n\t\t *\t\t// Disabling the command.\r\n\t\t *\t\tconst enableBold = disableCommand( editor.commands.get( 'bold' ) );\r\n\t\t *\r\n\t\t *\t\t// Enabling the command again.\r\n\t\t *\t\tenableBold();\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #isEnabled\r\n\t\t */\r\n\t\tthis.set( 'isEnabled', false );\r\n\r\n\t\tthis.decorate( 'execute' );\r\n\r\n\t\t// By default every command is refreshed when changes are applied to the model.\r\n\t\tthis.listenTo( this.editor.model.document, 'change', () => {\r\n\t\t\tthis.refresh();\r\n\t\t} );\r\n\r\n\t\tthis.on( 'execute', evt => {\r\n\t\t\tif ( !this.isEnabled ) {\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\r\n\t\t// By default commands are disabled when the editor is in read-only mode.\r\n\t\tthis.listenTo( editor, 'change:isReadOnly', ( evt, name, value ) => {\r\n\t\t\tif ( value ) {\r\n\t\t\t\tthis.on( 'set:isEnabled', forceDisable, { priority: 'highest' } );\r\n\t\t\t\tthis.isEnabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.off( 'set:isEnabled', forceDisable );\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Refreshes the command. The command should update its {@link #isEnabled} and {@link #value} properties\r\n\t * in this method.\r\n\t *\r\n\t * This method is automatically called when\r\n\t * {@link module:engine/model/document~Document#event:change any changes are applied to the document}.\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * A command may accept parameters. They will be passed from {@link module:core/editor/editor~Editor#execute `editor.execute()`}\r\n\t * to the command.\r\n\t *\r\n\t * The `execute()` method will automatically abort when the command is disabled ({@link #isEnabled} is `false`).\r\n\t * This behavior is implemented by a high priority listener to the {@link #event:execute} event.\r\n\t *\r\n\t * In order to see how to disable a command from \"outside\" see the {@link #isEnabled} documentation.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {}\r\n\r\n\t/**\r\n\t * Destroys the command.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.stopListening();\r\n\t}\r\n\r\n\t/**\r\n\t * Event fired by the {@link #execute} method. The command action is a listener to this event so it's\r\n\t * possible to change/cancel the behavior of the command by listening to this event.\r\n\t *\r\n\t * See {@link module:utils/observablemixin~ObservableMixin.decorate} for more information and samples.\r\n\t *\r\n\t * **Note:** This event is fired even if command is disabled. However, it is automatically blocked\r\n\t * by a high priority listener in order to prevent command execution.\r\n\t *\r\n\t * @event execute\r\n\t */\r\n}\r\n\r\nmix( Command, ObservableMixin );\r\n\r\n// Helper function that forces command to be disabled.\r\nfunction forceDisable( evt ) {\r\n\tevt.return = false;\r\n\tevt.stop();\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module enter/entercommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\n/**\r\n * Enter command. It is used by the {@link module:enter/enter~Enter Enter feature} to handle the <kbd>Enter</kbd> key.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class EnterCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tenterBlock( this.editor.model, writer, doc.selection, model.schema );\r\n\t\t\tthis.fire( 'afterExecute', { writer } );\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Creates a new block in the way that the <kbd>Enter</kbd> key is expected to work.\r\n//\r\n// @param {module:engine/model~Model} model\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n// Selection on which the action should be performed.\r\n// @param {module:engine/model/schema~Schema} schema\r\nfunction enterBlock( model, writer, selection, schema ) {\r\n\tconst isSelectionEmpty = selection.isCollapsed;\r\n\tconst range = selection.getFirstRange();\r\n\tconst startElement = range.start.parent;\r\n\tconst endElement = range.end.parent;\r\n\r\n\t// Don't touch the roots and other limit elements.\r\n\tif ( schema.isLimit( startElement ) || schema.isLimit( endElement ) ) {\r\n\t\t// Delete the selected content but only if inside a single limit element.\r\n\t\t// Abort, when crossing limit elements boundary (e.g. <limit1>x[x</limit1>donttouchme<limit2>y]y</limit2>).\r\n\t\t// This is an edge case and it's hard to tell what should actually happen because such a selection\r\n\t\t// is not entirely valid.\r\n\t\tif ( !isSelectionEmpty && startElement == endElement ) {\r\n\t\t\tmodel.deleteContent( selection );\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tif ( isSelectionEmpty ) {\r\n\t\tsplitBlock( writer, range.start );\r\n\t} else {\r\n\t\tconst leaveUnmerged = !( range.start.isAtStart && range.end.isAtEnd );\r\n\t\tconst isContainedWithinOneElement = ( startElement == endElement );\r\n\r\n\t\tmodel.deleteContent( selection, { leaveUnmerged } );\r\n\r\n\t\tif ( leaveUnmerged ) {\r\n\t\t\t// Partially selected elements.\r\n\t\t\t//\r\n\t\t\t// <h>x[xx]x</h>\t\t-> <h>x^x</h>\t\t\t-> <h>x</h><h>^x</h>\r\n\t\t\tif ( isContainedWithinOneElement ) {\r\n\t\t\t\tsplitBlock( writer, selection.focus );\r\n\t\t\t}\r\n\t\t\t// Selection over multiple elements.\r\n\t\t\t//\r\n\t\t\t// <h>x[x</h><p>y]y<p>\t-> <h>x^</h><p>y</p>\t-> <h>x</h><p>^y</p>\r\n\t\t\telse {\r\n\t\t\t\twriter.setSelection( endElement, 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction splitBlock( writer, splitPos ) {\r\n\twriter.split( splitPos );\r\n\twriter.setSelection( splitPos.parent.nextSibling, 0 );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module enter/enterobserver\r\n */\r\n\r\nimport Observer from '@ckeditor/ckeditor5-engine/src/view/observer/observer';\r\nimport DomEventData from '@ckeditor/ckeditor5-engine/src/view/observer/domeventdata';\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\n/**\r\n * Enter observer introduces the {@link module:engine/view/document~Document#event:enter} event.\r\n *\r\n * @extends module:engine/view/observer~Observer\r\n */\r\nexport default class EnterObserver extends Observer {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tconst doc = this.document;\r\n\r\n\t\tdoc.on( 'keydown', ( evt, data ) => {\r\n\t\t\tif ( this.isEnabled && data.keyCode == keyCodes.enter ) {\r\n\t\t\t\t// Save the event object to check later if it was stopped or not.\r\n\t\t\t\tlet event;\r\n\t\t\t\tdoc.once( 'enter', evt => ( event = evt ), { priority: 'highest' } );\r\n\r\n\t\t\t\tdoc.fire( 'enter', new DomEventData( doc, data.domEvent, {\r\n\t\t\t\t\tisSoft: data.shiftKey\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t\t// Stop `keydown` event if `enter` event was stopped.\r\n\t\t\t\t// https://github.com/ckeditor/ckeditor5/issues/753\r\n\t\t\t\tif ( event && event.stop.called ) {\r\n\t\t\t\t\tevt.stop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve() {}\r\n}\r\n\r\n/**\r\n * Event fired when the user presses the <kbd>Enter</kbd> key.\r\n *\r\n * Note: This event is fired by the {@link module:enter/enterobserver~EnterObserver observer}\r\n * (usually registered by the {@link module:enter/enter~Enter Enter feature} and\r\n * {@link module:enter/shiftenter~ShiftEnter ShiftEnter feature}).\r\n *\r\n * @event module:engine/view/document~Document#event:enter\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data\r\n * @param {Boolean} data.isSoft Whether it's a soft enter (<kbd>Shift</kbd>+<kbd>Enter</kbd>) or hard enter (<kbd>Enter</kbd>).\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module enter/enter\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport EnterCommand from './entercommand';\r\nimport EnterObserver from './enterobserver';\r\n\r\n/**\r\n * This plugin handles the <kbd>Enter</kbd> key (hard line break) in the editor.\r\n *\r\n * See also the {@link module:enter/shiftenter~ShiftEnter} plugin.\r\n *\r\n * For more information about this feature see the {@glink api/enter package page}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Enter extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Enter';\r\n\t}\r\n\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\r\n\t\tview.addObserver( EnterObserver );\r\n\r\n\t\teditor.commands.add( 'enter', new EnterCommand( editor ) );\r\n\r\n\t\tthis.listenTo( viewDocument, 'enter', ( evt, data ) => {\r\n\t\t\tdata.preventDefault();\r\n\r\n\t\t\t// The soft enter key is handled by the ShiftEnter plugin.\r\n\t\t\tif ( data.isSoft ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\teditor.execute( 'enter' );\r\n\t\t\tview.scrollToTheSelection();\r\n\t\t}, { priority: 'low' } );\r\n\t}\r\n}\r\n","/**\r\n * @module enter/shiftentercommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\n/**\r\n * ShiftEnter command. It is used by the {@link module:enter/shiftenter~ShiftEnter ShiftEnter feature} to handle\r\n * the <kbd>Shift</kbd>+<kbd>Enter</kbd> keystroke.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ShiftEnterCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tsoftBreakAction( model, writer, doc.selection );\r\n\t\t\tthis.fire( 'afterExecute', { writer } );\r\n\t\t} );\r\n\t}\r\n\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tthis.isEnabled = isEnabled( model.schema, doc.selection );\r\n\t}\r\n}\r\n\r\n// Checks whether the ShiftEnter command should be enabled in the specified selection.\r\n//\r\n// @param {module:engine/model/schema~Schema} schema\r\n// @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\nfunction isEnabled( schema, selection ) {\r\n\t// At this moment it is okay to support single range selections only.\r\n\t// But in the future we may need to change that.\r\n\tif ( selection.rangeCount > 1 ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst anchorPos = selection.anchor;\r\n\r\n\t// Check whether the break element can be inserted in the current selection anchor.\r\n\tif ( !anchorPos || !schema.checkChild( anchorPos, 'softBreak' ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst range = selection.getFirstRange();\r\n\tconst startElement = range.start.parent;\r\n\tconst endElement = range.end.parent;\r\n\r\n\t// Do not modify the content if selection is cross-limit elements.\r\n\tif ( ( isInsideLimitElement( startElement, schema ) || isInsideLimitElement( endElement, schema ) ) && startElement !== endElement ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\n// Creates a break in the way that the <kbd>Shift</kbd>+<kbd>Enter</kbd> keystroke is expected to work.\r\n//\r\n// @param {module:engine/model~Model} model\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n// Selection on which the action should be performed.\r\nfunction softBreakAction( model, writer, selection ) {\r\n\tconst isSelectionEmpty = selection.isCollapsed;\r\n\tconst range = selection.getFirstRange();\r\n\tconst startElement = range.start.parent;\r\n\tconst endElement = range.end.parent;\r\n\tconst isContainedWithinOneElement = ( startElement == endElement );\r\n\r\n\tif ( isSelectionEmpty ) {\r\n\t\tinsertBreak( writer, range.end );\r\n\t} else {\r\n\t\tconst leaveUnmerged = !( range.start.isAtStart && range.end.isAtEnd );\r\n\t\tmodel.deleteContent( selection, { leaveUnmerged } );\r\n\r\n\t\t// Selection within one element:\r\n\t\t//\r\n\t\t// <h>x[xx]x</h>\t\t-> <h>x^x</h>\t\t\t-> <h>x<br>^x</h>\r\n\t\tif ( isContainedWithinOneElement ) {\r\n\t\t\tinsertBreak( writer, selection.focus );\r\n\t\t}\r\n\t\t// Selection over multiple elements.\r\n\t\t//\r\n\t\t// <h>x[x</h><p>y]y<p>\t-> <h>x^</h><p>y</p>\t-> <h>x</h><p>^y</p>\r\n\t\t//\r\n\t\t// We chose not to insert a line break in this case because:\r\n\t\t//\r\n\t\t// * it's not a very common scenario,\r\n\t\t// * it actually surprised me when I saw the \"expected behavior\" in real life.\r\n\t\t//\r\n\t\t// It's ok if the user will need to be more specific where they want the <br> to be inserted.\r\n\t\telse {\r\n\t\t\t// Move the selection to the 2nd element (last step of the example above).\r\n\t\t\tif ( leaveUnmerged ) {\r\n\t\t\t\twriter.setSelection( endElement, 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction insertBreak( writer, position ) {\r\n\tconst breakLineElement = writer.createElement( 'softBreak' );\r\n\r\n\twriter.insert( breakLineElement, position );\r\n\twriter.setSelection( breakLineElement, 'after' );\r\n}\r\n\r\n// Checks whether the specified `element` is a child of the limit element.\r\n//\r\n// Checking whether the `<p>` element is inside a limit element:\r\n//   - <$root><p>Text.</p></$root> => false\r\n//   - <$root><limitElement><p>Text</p></limitElement></$root> => true\r\n//\r\n// @param {module:engine/model/element~Element} element\r\n// @param {module:engine/schema~Schema} schema\r\n// @returns {Boolean}\r\nfunction isInsideLimitElement( element, schema ) {\r\n\t// `$root` is a limit element but in this case is an invalid element.\r\n\tif ( element.is( 'rootElement' ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn schema.isLimit( element ) || isInsideLimitElement( element.parent, schema );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module enter/shiftenter\r\n */\r\n\r\nimport ShiftEnterCommand from './shiftentercommand';\r\nimport EnterObserver from './enterobserver';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport { upcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\r\nimport { downcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/downcast-converters';\r\n\r\n/**\r\n * This plugin handles the <kbd>Shift</kbd>+<kbd>Enter</kbd> keystroke (soft line break) in the editor.\r\n *\r\n * See also the {@link module:enter/enter~Enter} plugin.\r\n *\r\n * For more information about this feature see the {@glink api/enter package page}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ShiftEnter extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ShiftEnter';\r\n\t}\r\n\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst schema = editor.model.schema;\r\n\t\tconst conversion = editor.conversion;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\r\n\t\t// Configure the schema.\r\n\t\tschema.register( 'softBreak', {\r\n\t\t\tallowWhere: '$text'\r\n\t\t} );\r\n\r\n\t\t// Configure converters.\r\n\t\tconversion.for( 'upcast' )\r\n\t\t\t.add( upcastElementToElement( {\r\n\t\t\t\tmodel: 'softBreak',\r\n\t\t\t\tview: 'br'\r\n\t\t\t} ) );\r\n\r\n\t\tconversion.for( 'downcast' )\r\n\t\t\t.add( downcastElementToElement( {\r\n\t\t\t\tmodel: 'softBreak',\r\n\t\t\t\tview: ( modelElement, viewWriter ) => viewWriter.createEmptyElement( 'br' )\r\n\t\t\t} ) );\r\n\r\n\t\tview.addObserver( EnterObserver );\r\n\r\n\t\teditor.commands.add( 'shiftEnter', new ShiftEnterCommand( editor ) );\r\n\r\n\t\tthis.listenTo( viewDocument, 'enter', ( evt, data ) => {\r\n\t\t\tdata.preventDefault();\r\n\r\n\t\t\t// The hard enter key is handled by the Enter plugin.\r\n\t\t\tif ( !data.isSoft ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\teditor.execute( 'shiftEnter' );\r\n\t\t\tview.scrollToTheSelection();\r\n\t\t}, { priority: 'low' } );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/utils/changebuffer\r\n */\r\n\r\n/**\r\n * Change buffer allows to group atomic changes (like characters that have been typed) into\r\n * {@link module:engine/model/batch~Batch batches}.\r\n *\r\n * Batches represent single undo steps, hence changes added to one single batch are undone together.\r\n *\r\n * The buffer has a configurable limit of atomic changes that it can accommodate. After the limit was\r\n * exceeded (see {@link ~ChangeBuffer#input}), a new batch is created in {@link ~ChangeBuffer#batch}.\r\n *\r\n * To use the change buffer you need to let it know about the number of changes that were added to the batch:\r\n *\r\n *\t\tconst buffer = new ChangeBuffer( model, LIMIT );\r\n *\r\n *\t\t// Later on in your feature:\r\n *\t\tbuffer.batch.insert( pos, insertedCharacters );\r\n *\t\tbuffer.input( insertedCharacters.length );\r\n *\r\n */\r\nexport default class ChangeBuffer {\r\n\t/**\r\n\t * Creates a new instance of the change buffer.\r\n\t *\r\n\t * @param {module:engine/model/model~Model} model\r\n\t * @param {Number} [limit=20] The maximum number of atomic changes which can be contained in one batch.\r\n\t */\r\n\tconstructor( model, limit = 20 ) {\r\n\t\t/**\r\n\t\t * The model instance.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model} #model\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * The number of atomic changes in the buffer. Once it exceeds the {@link #limit},\r\n\t\t * the {@link #batch batch} is set to a new one.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #size\r\n\t\t */\r\n\t\tthis.size = 0;\r\n\r\n\t\t/**\r\n\t\t * The maximum number of atomic changes which can be contained in one batch.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number} #limit\r\n\t\t */\r\n\t\tthis.limit = limit;\r\n\r\n\t\t/**\r\n\t\t * Whether the buffer is locked. A locked buffer cannot be reset unless it gets unlocked.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #isLocked\r\n\t\t */\r\n\t\tthis.isLocked = false;\r\n\r\n\t\t// The function to be called in order to notify the buffer about batches which appeared in the document.\r\n\t\t// The callback will check whether it is a new batch and in that case the buffer will be flushed.\r\n\t\t//\r\n\t\t// The reason why the buffer needs to be flushed whenever a new batch appears is that the changes added afterwards\r\n\t\t// should be added to a new batch. For instance, when the  user types, then inserts an image, and then types again,\r\n\t\t// the characters typed after inserting the image should be added to a different batch than the characters typed before.\r\n\t\tthis._changeCallback = ( evt, batch ) => {\r\n\t\t\tif ( batch.type != 'transparent' && batch !== this._batch ) {\r\n\t\t\t\tthis._reset( true );\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis._selectionChangeCallback = () => {\r\n\t\t\tthis._reset();\r\n\t\t};\r\n\r\n\t\tthis.model.document.on( 'change', this._changeCallback );\r\n\r\n\t\tthis.model.document.selection.on( 'change:range', this._selectionChangeCallback );\r\n\t\tthis.model.document.selection.on( 'change:attribute', this._selectionChangeCallback );\r\n\r\n\t\t/**\r\n\t\t * The current batch instance.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member #_batch\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The callback to document the change event which later needs to be removed.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member #_changeCallback\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The callback to document selection `change:attribute` and `change:range` events which resets the buffer.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member #_selectionChangeCallback\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * The current batch to which a feature should add its operations. Once the {@link #size}\r\n\t * is reached or exceeds the {@link #limit}, the batch is set to a new instance and the size is reset.\r\n\t *\r\n\t * @type {module:engine/model/batch~Batch}\r\n\t */\r\n\tget batch() {\r\n\t\tif ( !this._batch ) {\r\n\t\t\tthis._batch = this.model.createBatch();\r\n\t\t}\r\n\r\n\t\treturn this._batch;\r\n\t}\r\n\r\n\t/**\r\n\t * The input number of changes into the buffer. Once the {@link #size} is\r\n\t * reached or exceeds the {@link #limit}, the batch is set to a new instance and the size is reset.\r\n\t *\r\n\t * @param {Number} changeCount The number of atomic changes to input.\r\n\t */\r\n\tinput( changeCount ) {\r\n\t\tthis.size += changeCount;\r\n\r\n\t\tif ( this.size >= this.limit ) {\r\n\t\t\tthis._reset( true );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Locks the buffer.\r\n\t */\r\n\tlock() {\r\n\t\tthis.isLocked = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Unlocks the buffer.\r\n\t */\r\n\tunlock() {\r\n\t\tthis.isLocked = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the buffer.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.model.document.off( 'change', this._changeCallback );\r\n\t\tthis.model.document.selection.off( 'change:range', this._selectionChangeCallback );\r\n\t\tthis.model.document.selection.off( 'change:attribute', this._selectionChangeCallback );\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the change buffer.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} [ignoreLock] Whether internal lock {@link #isLocked} should be ignored.\r\n\t */\r\n\t_reset( ignoreLock ) {\r\n\t\tif ( !this.isLocked || ignoreLock ) {\r\n\t\t\tthis._batch = null;\r\n\t\t\tthis.size = 0;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/inputcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport ChangeBuffer from './utils/changebuffer';\r\n\r\n/**\r\n * The input command. Used by the {@link module:typing/input~Input input feature} to handle typing.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class InputCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the command.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t * @param {Number} undoStepSize The maximum number of atomic changes\r\n\t * which can be contained in one batch in the command buffer.\r\n\t */\r\n\tconstructor( editor, undoStepSize ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * Typing's change buffer used to group subsequent changes into batches.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @private\r\n\t\t * @member {module:typing/utils/changebuffer~ChangeBuffer} #_buffer\r\n\t\t */\r\n\t\tthis._buffer = new ChangeBuffer( editor.model, undoStepSize );\r\n\t}\r\n\r\n\t/**\r\n\t * The current change buffer.\r\n\t *\r\n\t * @type {module:typing/utils/changebuffer~ChangeBuffer}\r\n\t */\r\n\tget buffer() {\r\n\t\treturn this._buffer;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tthis._buffer.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the input command. It replaces the content within the given range with the given text.\r\n\t * Replacing is a two step process, first the content within the range is removed and then the new text is inserted\r\n\t * at the beginning of the range (which after the removal is a collapsed range).\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} [options] The command options.\r\n\t * @param {String} [options.text=''] The text to be inserted.\r\n\t * @param {module:engine/model/range~Range} [options.range] The range in which the text is inserted. Defaults\r\n\t * to the first range in the current selection.\r\n\t * @param {module:engine/model/range~Range} [options.resultRange] The range where the selection\r\n\t * should be placed after the insertion. If not specified, the selection will be placed right after\r\n\t * the inserted text.\r\n\t */\r\n\texecute( options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst text = options.text || '';\r\n\t\tconst textInsertions = text.length;\r\n\t\tconst range = options.range || doc.selection.getFirstRange();\r\n\t\tconst resultRange = options.resultRange;\r\n\r\n\t\tmodel.enqueueChange( this._buffer.batch, writer => {\r\n\t\t\tconst isCollapsedRange = range.isCollapsed;\r\n\r\n\t\t\tthis._buffer.lock();\r\n\r\n\t\t\tif ( !isCollapsedRange ) {\r\n\t\t\t\twriter.remove( range );\r\n\t\t\t}\r\n\r\n\t\t\tif ( text ) {\r\n\t\t\t\twriter.insertText( text, doc.selection.getAttributes(), range.start );\r\n\t\t\t}\r\n\r\n\t\t\tif ( resultRange ) {\r\n\t\t\t\twriter.setSelection( resultRange );\r\n\t\t\t} else if ( isCollapsedRange ) {\r\n\t\t\t\t// If range was collapsed just shift the selection by the number of inserted characters.\r\n\t\t\t\twriter.setSelection( range.start.getShiftedBy( textInsertions ) );\r\n\t\t\t}\r\n\r\n\t\t\tthis._buffer.unlock();\r\n\r\n\t\t\tthis._buffer.input( textInsertions );\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/utils/injectunsafekeystrokeshandling\r\n */\r\n\r\nimport { getCode } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\n/**\r\n * Handles keystrokes which are unsafe for typing. This handler's logic is explained\r\n * in https://github.com/ckeditor/ckeditor5-typing/issues/83#issuecomment-398690251.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n */\r\nexport default function injectUnsafeKeystrokesHandling( editor ) {\r\n\tlet latestCompositionSelection = null;\r\n\r\n\tconst model = editor.model;\r\n\tconst view = editor.editing.view;\r\n\tconst inputCommand = editor.commands.get( 'input' );\r\n\r\n\tview.document.on( 'keydown', ( evt, evtData ) => handleKeydown( evtData ), { priority: 'lowest' } );\r\n\r\n\tview.document.on( 'compositionstart', handleCompositionStart, { priority: 'lowest' } );\r\n\r\n\tview.document.on( 'compositionend', () => {\r\n\t\tlatestCompositionSelection = model.createSelection( model.document.selection );\r\n\t}, { priority: 'lowest' } );\r\n\r\n\t// Handles the keydown event. We need to guess whether such keystroke is going to result\r\n\t// in typing. If so, then before character insertion happens, any selected content needs\r\n\t// to be deleted. Otherwise the default browser deletion mechanism would be\r\n\t// triggered, resulting in:\r\n\t//\r\n\t// * Hundreds of mutations which could not be handled.\r\n\t// * But most importantly, loss of control over how the content is being deleted.\r\n\t//\r\n\t// The method is used in a low-priority listener, hence allowing other listeners (e.g. delete or enter features)\r\n\t// to handle the event.\r\n\t//\r\n\t// @param {module:engine/view/observer/keyobserver~KeyEventData} evtData\r\n\tfunction handleKeydown( evtData ) {\r\n\t\tconst doc = model.document;\r\n\t\tconst isComposing = view.document.isComposing;\r\n\t\tconst isSelectionUnchanged = latestCompositionSelection && latestCompositionSelection.isEqual( doc.selection );\r\n\r\n\t\t// Reset stored composition selection.\r\n\t\tlatestCompositionSelection = null;\r\n\r\n\t\t// By relying on the state of the input command we allow disabling the entire input easily\r\n\t\t// by just disabling the input command. We could’ve used here the delete command but that\r\n\t\t// would mean requiring the delete feature which would block loading one without the other.\r\n\t\t// We could also check the editor.isReadOnly property, but that wouldn't allow to block\r\n\t\t// the input without blocking other features.\r\n\t\tif ( !inputCommand.isEnabled ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( isSafeKeystroke( evtData ) || doc.selection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If during composition, deletion should be prevented as it may remove composed sequence (#83).\r\n\t\tif ( isComposing && evtData.keyCode === 229 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If there is a `keydown` event fired with '229' keycode it might be related\r\n\t\t// to recent composition. Check if selection is the same as upon ending recent composition,\r\n\t\t// if so do not remove selected content as it will remove composed sequence (#83).\r\n\t\tif ( !isComposing && evtData.keyCode === 229 && isSelectionUnchanged ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdeleteSelectionContent();\r\n\t}\r\n\r\n\t// Handles the `compositionstart` event. It is used only in special cases to remove the contents\r\n\t// of a non-collapsed selection so composition itself does not result in complex mutations.\r\n\t//\r\n\t// The special case mentioned above is a situation in which the `keydown` event is fired after\r\n\t// `compositionstart` event. In such cases {@link #handleKeydown} cannot clear current selection\r\n\t// contents (because it is too late and will break the composition) so the composition handler takes care of it.\r\n\tfunction handleCompositionStart() {\r\n\t\tconst doc = model.document;\r\n\t\tconst isFlatSelection = doc.selection.rangeCount === 1 ? doc.selection.getFirstRange().isFlat : true;\r\n\r\n\t\t// If on `compositionstart` there is a non-collapsed selection which start and end have different parents\r\n\t\t// it means the `handleKeydown()` method did not remove its contents. It happens usually because\r\n\t\t// of different order of events (`compositionstart` before `keydown` - in Safari). In such cases\r\n\t\t// we need to remove selection contents on composition start (#83).\r\n\t\tif ( doc.selection.isCollapsed || isFlatSelection ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdeleteSelectionContent();\r\n\t}\r\n\r\n\tfunction deleteSelectionContent() {\r\n\t\tconst buffer = inputCommand.buffer;\r\n\r\n\t\tbuffer.lock();\r\n\r\n\t\tmodel.enqueueChange( buffer.batch, () => {\r\n\t\t\tmodel.deleteContent( model.document.selection );\r\n\t\t} );\r\n\r\n\t\tbuffer.unlock();\r\n\t}\r\n}\r\n\r\nconst safeKeycodes = [\r\n\tgetCode( 'arrowUp' ),\r\n\tgetCode( 'arrowRight' ),\r\n\tgetCode( 'arrowDown' ),\r\n\tgetCode( 'arrowLeft' ),\r\n\t9, // Tab\r\n\t16, // Shift\r\n\t17, // Ctrl\r\n\t18, // Alt\r\n\t19, // Pause\r\n\t20, // CapsLock\r\n\t27, // Escape\r\n\t33, // PageUp\r\n\t34, // PageDown\r\n\t35, // Home\r\n\t36, // End,\r\n\t45, // Insert,\r\n\t91, // Windows,\r\n\t93, // Menu key,\r\n\t144, // NumLock\r\n\t145, // ScrollLock,\r\n\t173, // Mute/Unmute\r\n\t174, // Volume up\r\n\t175, // Volume down,\r\n\t176, // Next song,\r\n\t177, // Previous song,\r\n\t178, // Stop,\r\n\t179, // Play/Pause,\r\n\t255 // Display brightness (increase and decrease)\r\n];\r\n\r\n// Function keys.\r\nfor ( let code = 112; code <= 135; code++ ) {\r\n\tsafeKeycodes.push( code );\r\n}\r\n\r\n// Returns `true` if a keystroke should not cause any content change caused by \"typing\".\r\n//\r\n// Note: This implementation is very simple and will need to be refined with time.\r\n//\r\n// @private\r\n// @param {engine.view.observer.keyObserver.KeyEventData} keyData\r\n// @returns {Boolean}\r\nfunction isSafeKeystroke( keyData ) {\r\n\t// Keystrokes which contain Ctrl don't represent typing.\r\n\tif ( keyData.ctrlKey ) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn safeKeycodes.includes( keyData.keyCode );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/utils/utils\r\n */\r\n\r\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\r\nimport diffToChanges from '@ckeditor/ckeditor5-utils/src/difftochanges';\r\n\r\n/**\r\n * Returns true if container children have mutated or more than a single text node was changed.\r\n *\r\n * @private\r\n * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n * @returns {Boolean}\r\n */\r\nexport function containerChildrenMutated( mutations ) {\r\n\tif ( mutations.length == 0 ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Check if there is any mutation of `children` type or any mutation that changes more than one text node.\r\n\tfor ( const mutation of mutations ) {\r\n\t\tif ( mutation.type === 'children' && !getSingleTextNodeChange( mutation ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Returns change made to a single text node.\r\n *\r\n * @private\r\n * @param {module:engine/view/observer/mutationobserver~MutatedText|\r\n * module:engine/view/observer/mutationobserver~MutatedChildren} mutation\r\n * @returns {Object|undefined} Change object (see {@link module:utils/difftochanges~diffToChanges} output)\r\n * or undefined if more than a single text node was changed.\r\n */\r\nexport function getSingleTextNodeChange( mutation ) {\r\n\t// One new node.\r\n\tif ( mutation.newChildren.length - mutation.oldChildren.length != 1 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Which is text.\r\n\tconst diffResult = diff( mutation.oldChildren, mutation.newChildren, compareChildNodes );\r\n\tconst changes = diffToChanges( diffResult, mutation.newChildren );\r\n\r\n\t// In case of [ delete, insert, insert ] the previous check will not exit.\r\n\tif ( changes.length > 1 ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst change = changes[ 0 ];\r\n\r\n\t// Which is text.\r\n\tif ( !( !!change.values[ 0 ] && change.values[ 0 ].is( 'text' ) ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn change;\r\n}\r\n\r\n/**\r\n * Checks whether two view nodes are identical, which means they are the same object\r\n * or contain exactly same data (in case of text nodes).\r\n *\r\n * @private\r\n * @param {module:engine/view/node~Node} oldChild\r\n * @param {module:engine/view/node~Node} newChild\r\n * @returns {Boolean}\r\n */\r\nexport function compareChildNodes( oldChild, newChild ) {\r\n\tif ( !!oldChild && oldChild.is( 'text' ) && !!newChild && newChild.is( 'text' ) ) {\r\n\t\treturn oldChild.data === newChild.data;\r\n\t} else {\r\n\t\treturn oldChild === newChild;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/difftochanges\r\n */\r\n\r\n/**\r\n * Creates a set of changes which need to be applied to the input in order to transform\r\n * it into the output. This function can be used with strings or arrays.\r\n *\r\n *\t\tconst input = Array.from( 'abc' );\r\n *\t\tconst output = Array.from( 'xaby' );\r\n *\t\tconst changes = diffToChanges( diff( input, output ), output );\r\n *\r\n *\t\tchanges.forEach( change => {\r\n *\t\t\tif ( change.type == 'insert' ) {\r\n *\t\t\t\tinput.splice( change.index, 0, ...change.values );\r\n *\t\t\t} else if ( change.type == 'delete' ) {\r\n *\t\t\t\tinput.splice( change.index, change.howMany );\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n *\t\tinput.join( '' ) == output.join( '' ); // -> true\r\n *\r\n * @param {Array.<'equal'|'insert'|'delete'>} diff Result of {@link module:utils/diff~diff}.\r\n * @param {String|Array} output The string or array which was passed as diff's output.\r\n * @returns {Array.<Object>} Set of changes (insert or delete) which need to be applied to the input\r\n * in order to transform it into the output.\r\n */\r\nexport default function diffToChanges( diff, output ) {\r\n\tconst changes = [];\r\n\tlet index = 0;\r\n\tlet lastOperation;\r\n\r\n\tdiff.forEach( change => {\r\n\t\tif ( change == 'equal' ) {\r\n\t\t\tpushLast();\r\n\r\n\t\t\tindex++;\r\n\t\t} else if ( change == 'insert' ) {\r\n\t\t\tif ( isContinuationOf( 'insert' ) ) {\r\n\t\t\t\tlastOperation.values.push( output[ index ] );\r\n\t\t\t} else {\r\n\t\t\t\tpushLast();\r\n\r\n\t\t\t\tlastOperation = {\r\n\t\t\t\t\ttype: 'insert',\r\n\t\t\t\t\tindex,\r\n\t\t\t\t\tvalues: [ output[ index ] ]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tindex++;\r\n\t\t} else /* if ( change == 'delete' ) */ {\r\n\t\t\tif ( isContinuationOf( 'delete' ) ) {\r\n\t\t\t\tlastOperation.howMany++;\r\n\t\t\t} else {\r\n\t\t\t\tpushLast();\r\n\r\n\t\t\t\tlastOperation = {\r\n\t\t\t\t\ttype: 'delete',\r\n\t\t\t\t\tindex,\r\n\t\t\t\t\thowMany: 1\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t} );\r\n\r\n\tpushLast();\r\n\r\n\treturn changes;\r\n\r\n\tfunction pushLast() {\r\n\t\tif ( lastOperation ) {\r\n\t\t\tchanges.push( lastOperation );\r\n\t\t\tlastOperation = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isContinuationOf( expected ) {\r\n\t\treturn lastOperation && lastOperation.type == expected;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/utils/injecttypingmutationshandling\r\n */\r\n\r\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\r\nimport DomConverter from '@ckeditor/ckeditor5-engine/src/view/domconverter';\r\n\r\nimport { getSingleTextNodeChange, containerChildrenMutated } from './utils';\r\n\r\n/**\r\n * Handles mutations caused by normal typing.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n */\r\nexport default function injectTypingMutationsHandling( editor ) {\r\n\teditor.editing.view.document.on( 'mutations', ( evt, mutations, viewSelection ) => {\r\n\t\tnew MutationHandler( editor ).handle( mutations, viewSelection );\r\n\t} );\r\n}\r\n\r\n/**\r\n * Helper class for translating DOM mutations into model changes.\r\n *\r\n * @private\r\n */\r\nclass MutationHandler {\r\n\t/**\r\n\t * Creates an instance of the mutation handler.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\t/**\r\n\t\t * Editor instance for which mutations are handled.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:core/editor/editor~Editor} #editor\r\n\t\t */\r\n\t\tthis.editor = editor;\r\n\r\n\t\t/**\r\n\t\t * The editing controller.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/controller/editingcontroller~EditingController} #editing\r\n\t\t */\r\n\t\tthis.editing = this.editor.editing;\r\n\t}\r\n\r\n\t/**\r\n\t * Handles given mutations.\r\n\t *\r\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\r\n\t */\r\n\thandle( mutations, viewSelection ) {\r\n\t\tif ( containerChildrenMutated( mutations ) ) {\r\n\t\t\tthis._handleContainerChildrenMutations( mutations, viewSelection );\r\n\t\t} else {\r\n\t\t\tfor ( const mutation of mutations ) {\r\n\t\t\t\t// Fortunately it will never be both.\r\n\t\t\t\tthis._handleTextMutation( mutation, viewSelection );\r\n\t\t\t\tthis._handleTextNodeInsertion( mutation );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles situations when container's children mutated during input. This can happen when\r\n\t * the browser is trying to \"fix\" DOM in certain situations. For example, when the user starts to type\r\n\t * in `<p><a href=\"\"><i>Link{}</i></a></p>`, the browser might change the order of elements\r\n\t * to `<p><i><a href=\"\">Link</a>x{}</i></p>`. A similar situation happens when the spell checker\r\n\t * replaces a word wrapped with `<strong>` with a word wrapped with a `<b>` element.\r\n\t *\r\n\t * To handle such situations, the common DOM ancestor of all mutations is converted to the model representation\r\n\t * and then compared with the current model to calculate the proper text change.\r\n\t *\r\n\t * Note: Single text node insertion is handled in {@link #_handleTextNodeInsertion} and text node mutation is handled\r\n\t * in {@link #_handleTextMutation}).\r\n\t *\r\n\t * @private\r\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\r\n\t */\r\n\t_handleContainerChildrenMutations( mutations, viewSelection ) {\r\n\t\t// Get common ancestor of all mutations.\r\n\t\tconst mutationsCommonAncestor = getMutationsContainer( mutations );\r\n\r\n\t\t// Quit if there is no common ancestor.\r\n\t\tif ( !mutationsCommonAncestor ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domConverter = this.editor.editing.view.domConverter;\r\n\r\n\t\t// Get common ancestor in DOM.\r\n\t\tconst domMutationCommonAncestor = domConverter.mapViewToDom( mutationsCommonAncestor );\r\n\r\n\t\t// Create fresh DomConverter so it will not use existing mapping and convert current DOM to model.\r\n\t\t// This wouldn't be needed if DomConverter would allow to create fresh view without checking any mappings.\r\n\t\tconst freshDomConverter = new DomConverter();\r\n\t\tconst modelFromCurrentDom = this.editor.data.toModel(\r\n\t\t\tfreshDomConverter.domToView( domMutationCommonAncestor )\r\n\t\t).getChild( 0 );\r\n\r\n\t\t// Current model.\r\n\t\tconst currentModel = this.editor.editing.mapper.toModelElement( mutationsCommonAncestor );\r\n\r\n\t\t// If common ancestor is not mapped, do not do anything. It probably is a parent of another view element.\r\n\t\t// That means that we would need to diff model elements (see `if` below). Better return early instead of\r\n\t\t// trying to get a reasonable model ancestor. It will fell into the `if` below anyway.\r\n\t\t// This situation happens for example for lists. If `<ul>` is a common ancestor, `currentModel` is `undefined`\r\n\t\t// because `<ul>` is not mapped (`<li>`s are).\r\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/718.\r\n\t\tif ( !currentModel ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Get children from both ancestors.\r\n\t\tconst modelFromDomChildren = Array.from( modelFromCurrentDom.getChildren() );\r\n\t\tconst currentModelChildren = Array.from( currentModel.getChildren() );\r\n\r\n\t\t// Remove the last `<softBreak>` from the end of `modelFromDomChildren` if there is no `<softBreak>` in current model.\r\n\t\t// If the described scenario happened, it means that this is a bogus `<br />` added by a browser.\r\n\t\tconst lastDomChild = modelFromDomChildren[ modelFromDomChildren.length - 1 ];\r\n\t\tconst lastCurrentChild = currentModelChildren[ currentModelChildren.length - 1 ];\r\n\r\n\t\tif ( lastDomChild && lastDomChild.is( 'softBreak' ) && lastCurrentChild && !lastCurrentChild.is( 'softBreak' ) ) {\r\n\t\t\tmodelFromDomChildren.pop();\r\n\t\t}\r\n\r\n\t\t// Skip situations when common ancestor has any container elements.\r\n\t\tif ( !isSafeForTextMutation( modelFromDomChildren ) || !isSafeForTextMutation( currentModelChildren ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Replace &nbsp; inserted by the browser with normal space. See comment in `_handleTextMutation`.\r\n\t\t// Replace non-texts with any character. This is potentially dangerous but passes in manual tests. The thing is\r\n\t\t// that we need to take care of proper indexes so we cannot simply remove non-text elements from the content.\r\n\t\t// By inserting a character we keep all the real texts on their indexes.\r\n\t\tconst newText = modelFromDomChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\r\n\t\tconst oldText = currentModelChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\r\n\r\n\t\t// Do nothing if mutations created same text.\r\n\t\tif ( oldText === newText ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diffResult = diff( oldText, newText );\r\n\r\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\r\n\r\n\t\t// Try setting new model selection according to passed view selection.\r\n\t\tlet modelSelectionRange = null;\r\n\r\n\t\tif ( viewSelection ) {\r\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\r\n\t\t}\r\n\r\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\r\n\t\tconst removeRange = this.editor.model.createRange(\r\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt ),\r\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt + deletions )\r\n\t\t);\r\n\r\n\t\tthis.editor.execute( 'input', {\r\n\t\t\ttext: insertText,\r\n\t\t\trange: removeRange,\r\n\t\t\tresultRange: modelSelectionRange\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_handleTextMutation( mutation, viewSelection ) {\r\n\t\tif ( mutation.type != 'text' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Replace &nbsp; inserted by the browser with normal space.\r\n\t\t// We want only normal spaces in the model and in the view. Renderer and DOM Converter will be then responsible\r\n\t\t// for rendering consecutive spaces using &nbsp;, but the model and the view has to be clear.\r\n\t\t// Other feature may introduce inserting non-breakable space on specific key stroke (for example shift + space).\r\n\t\t// However then it will be handled outside of mutations, like enter key is.\r\n\t\t// The replacing is here because it has to be done before `diff` and `diffToChanges` functions, as they\r\n\t\t// take `newText` and compare it to (cleaned up) view.\r\n\t\t// It could also be done in mutation observer too, however if any outside plugin would like to\r\n\t\t// introduce additional events for mutations, they would get already cleaned up version (this may be good or not).\r\n\t\tconst newText = mutation.newText.replace( /\\u00A0/g, ' ' );\r\n\t\t// To have correct `diffResult`, we also compare view node text data with &nbsp; replaced by space.\r\n\t\tconst oldText = mutation.oldText.replace( /\\u00A0/g, ' ' );\r\n\r\n\t\tconst diffResult = diff( oldText, newText );\r\n\r\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\r\n\r\n\t\t// Try setting new model selection according to passed view selection.\r\n\t\tlet modelSelectionRange = null;\r\n\r\n\t\tif ( viewSelection ) {\r\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\r\n\t\t}\r\n\r\n\t\t// Get the position in view and model where the changes will happen.\r\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, firstChangeAt );\r\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\r\n\t\tconst removeRange = this.editor.model.createRange( modelPos, modelPos.getShiftedBy( deletions ) );\r\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\r\n\r\n\t\tthis.editor.execute( 'input', {\r\n\t\t\ttext: insertText,\r\n\t\t\trange: removeRange,\r\n\t\t\tresultRange: modelSelectionRange\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_handleTextNodeInsertion( mutation ) {\r\n\t\tif ( mutation.type != 'children' ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst change = getSingleTextNodeChange( mutation );\r\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, change.index );\r\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\r\n\t\tconst insertedText = change.values[ 0 ].data;\r\n\r\n\t\tthis.editor.execute( 'input', {\r\n\t\t\t// Replace &nbsp; inserted by the browser with normal space.\r\n\t\t\t// See comment in `_handleTextMutation`.\r\n\t\t\t// In this case we don't need to do this before `diff` because we diff whole nodes.\r\n\t\t\t// Just change &nbsp; in case there are some.\r\n\t\t\ttext: insertedText.replace( /\\u00A0/g, ' ' ),\r\n\t\t\trange: this.editor.model.createRange( modelPos )\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Returns first common ancestor of all mutations that is either {@link module:engine/view/containerelement~ContainerElement}\r\n// or {@link module:engine/view/rootelement~RootElement}.\r\n//\r\n// @private\r\n// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n// @returns {module:engine/view/containerelement~ContainerElement|engine/view/rootelement~RootElement|undefined}\r\nfunction getMutationsContainer( mutations ) {\r\n\tconst lca = mutations\r\n\t\t.map( mutation => mutation.node )\r\n\t\t.reduce( ( commonAncestor, node ) => {\r\n\t\t\treturn commonAncestor.getCommonAncestor( node, { includeSelf: true } );\r\n\t\t} );\r\n\r\n\tif ( !lca ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// We need to look for container and root elements only, so check all LCA's\r\n\t// ancestors (starting from itself).\r\n\treturn lca.getAncestors( { includeSelf: true, parentFirst: true } )\r\n\t\t.find( element => element.is( 'containerElement' ) || element.is( 'rootElement' ) );\r\n}\r\n\r\n// Returns true if provided array contains content that won't be problematic during diffing and text mutation handling.\r\n//\r\n// @param {Array.<module:engine/model/node~Node>} children\r\n// @returns {Boolean}\r\nfunction isSafeForTextMutation( children ) {\r\n\treturn children.every( child => child.is( 'text' ) || child.is( 'softBreak' ) );\r\n}\r\n\r\n// Calculates first change index and number of characters that should be inserted and deleted starting from that index.\r\n//\r\n// @private\r\n// @param diffResult\r\n// @returns {{insertions: number, deletions: number, firstChangeAt: *}}\r\nfunction calculateChanges( diffResult ) {\r\n\t// Index where the first change happens. Used to set the position from which nodes will be removed and where will be inserted.\r\n\tlet firstChangeAt = null;\r\n\t// Index where the last change happens. Used to properly count how many characters have to be removed and inserted.\r\n\tlet lastChangeAt = null;\r\n\r\n\t// Get `firstChangeAt` and `lastChangeAt`.\r\n\tfor ( let i = 0; i < diffResult.length; i++ ) {\r\n\t\tconst change = diffResult[ i ];\r\n\r\n\t\tif ( change != 'equal' ) {\r\n\t\t\tfirstChangeAt = firstChangeAt === null ? i : firstChangeAt;\r\n\t\t\tlastChangeAt = i;\r\n\t\t}\r\n\t}\r\n\r\n\t// How many characters, starting from `firstChangeAt`, should be removed.\r\n\tlet deletions = 0;\r\n\t// How many characters, starting from `firstChangeAt`, should be inserted.\r\n\tlet insertions = 0;\r\n\r\n\tfor ( let i = firstChangeAt; i <= lastChangeAt; i++ ) {\r\n\t\t// If there is no change (equal) or delete, the character is existing in `oldText`. We count it for removing.\r\n\t\tif ( diffResult[ i ] != 'insert' ) {\r\n\t\t\tdeletions++;\r\n\t\t}\r\n\r\n\t\t// If there is no change (equal) or insert, the character is existing in `newText`. We count it for inserting.\r\n\t\tif ( diffResult[ i ] != 'delete' ) {\r\n\t\t\tinsertions++;\r\n\t\t}\r\n\t}\r\n\r\n\treturn { insertions, deletions, firstChangeAt };\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/input\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport InputCommand from './inputcommand';\r\n\r\nimport injectUnsafeKeystrokesHandling from './utils/injectunsafekeystrokeshandling';\r\nimport injectTypingMutationsHandling from './utils/injecttypingmutationshandling';\r\n\r\n/**\r\n * Handles text input coming from the keyboard or other input methods.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Input extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Input';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// TODO The above default configuration value should be defined using editor.config.define() once it's fixed.\r\n\t\tconst inputCommand = new InputCommand( editor, editor.config.get( 'typing.undoStep' ) || 20 );\r\n\r\n\t\teditor.commands.add( 'input', inputCommand );\r\n\r\n\t\tinjectUnsafeKeystrokesHandling( editor );\r\n\t\tinjectTypingMutationsHandling( editor );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/deletecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport count from '@ckeditor/ckeditor5-utils/src/count';\r\n\r\nimport ChangeBuffer from './utils/changebuffer';\r\n\r\n/**\r\n * The delete command. Used by the {@link module:typing/delete~Delete delete feature} to handle the <kbd>Delete</kbd> and\r\n * <kbd>Backspace</kbd> keys.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class DeleteCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the command.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t * @param {'forward'|'backward'} direction The directionality of the delete describing in what direction it\r\n\t * should consume the content when the selection is collapsed.\r\n\t */\r\n\tconstructor( editor, direction ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The directionality of the delete describing in what direction it should\r\n\t\t * consume the content when the selection is collapsed.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {'forward'|'backward'} #direction\r\n\t\t */\r\n\t\tthis.direction = direction;\r\n\r\n\t\t/**\r\n\t\t * Delete's change buffer used to group subsequent changes into batches.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @private\r\n\t\t * @member {typing.ChangeBuffer} #buffer\r\n\t\t */\r\n\t\tthis._buffer = new ChangeBuffer( editor.model, editor.config.get( 'typing.undoStep' ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the delete command. Depending on whether the selection is collapsed or not, deletes its content\r\n\t * or a piece of content in the {@link #direction defined direction}.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} [options] The command options.\r\n\t * @param {'character'} [options.unit='character'] See {@link module:engine/model/utils/modifyselection~modifySelection}'s options.\r\n\t * @param {Number} [options.sequence=1] A number describing which subsequent delete event it is without the key being released.\r\n\t * See the {@link module:engine/view/document~Document#event:delete} event data.\r\n\t */\r\n\texecute( options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tmodel.enqueueChange( this._buffer.batch, writer => {\r\n\t\t\tthis._buffer.lock();\r\n\r\n\t\t\tconst selection = writer.createSelection( doc.selection );\r\n\r\n\t\t\t// Do not replace the whole selected content if selection was collapsed.\r\n\t\t\t// This prevents such situation:\r\n\t\t\t//\r\n\t\t\t// <h1></h1><p>[]</p>\t-->  <h1>[</h1><p>]</p> \t\t-->  <p></p>\r\n\t\t\t// starting content\t\t-->   after `modifySelection`\t-->  after `deleteContent`.\r\n\t\t\tconst doNotResetEntireContent = selection.isCollapsed;\r\n\r\n\t\t\t// Try to extend the selection in the specified direction.\r\n\t\t\tif ( selection.isCollapsed ) {\r\n\t\t\t\tmodel.modifySelection( selection, { direction: this.direction, unit: options.unit } );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if deleting in an empty editor. See #61.\r\n\t\t\tif ( this._shouldEntireContentBeReplacedWithParagraph( options.sequence || 1 ) ) {\r\n\t\t\t\tthis._replaceEntireContentWithParagraph( writer );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If selection is still collapsed, then there's nothing to delete.\r\n\t\t\tif ( selection.isCollapsed ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet changeCount = 0;\r\n\r\n\t\t\tselection.getFirstRange().getMinimalFlatRanges().forEach( range => {\r\n\t\t\t\tchangeCount += count(\r\n\t\t\t\t\trange.getWalker( { singleCharacters: true, ignoreElementEnd: true, shallow: true } )\r\n\t\t\t\t);\r\n\t\t\t} );\r\n\r\n\t\t\tmodel.deleteContent( selection, { doNotResetEntireContent } );\r\n\t\t\tthis._buffer.input( changeCount );\r\n\r\n\t\t\twriter.setSelection( selection );\r\n\r\n\t\t\tthis._buffer.unlock();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * If the user keeps <kbd>Backspace</kbd> or <kbd>Delete</kbd> key pressed, the content of the current\r\n\t * editable will be cleared. However, this will not yet lead to resetting the remaining block to a paragraph\r\n\t * (which happens e.g. when the user does <kbd>Ctrl</kbd> + <kbd>A</kbd>, <kbd>Backspace</kbd>).\r\n\t *\r\n\t * But, if the user pressed the key in an empty editable for the first time,\r\n\t * we want to replace the entire content with a paragraph if:\r\n\t *\r\n\t * * the current limit element is empty,\r\n\t * * the paragraph is allowed in the limit element,\r\n\t * * the limit doesn't already have a paragraph inside.\r\n\t *\r\n\t * See https://github.com/ckeditor/ckeditor5-typing/issues/61.\r\n\t *\r\n\t * @private\r\n\t * @param {Number} sequence A number describing which subsequent delete event it is without the key being released.\r\n\t * @returns {Boolean}\r\n\t */\r\n\t_shouldEntireContentBeReplacedWithParagraph( sequence ) {\r\n\t\t// Does nothing if user pressed and held the \"Backspace\" or \"Delete\" key.\r\n\t\tif ( sequence > 1 ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\t\tconst limitElement = model.schema.getLimitElement( selection );\r\n\r\n\t\t// If a collapsed selection contains the whole content it means that the content is empty\r\n\t\t// (from the user perspective).\r\n\t\tconst limitElementIsEmpty = selection.isCollapsed && selection.containsEntireContent( limitElement );\r\n\r\n\t\tif ( !limitElementIsEmpty ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( !model.schema.checkChild( limitElement, 'paragraph' ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst limitElementFirstChild = limitElement.getChild( 0 );\r\n\r\n\t\t// Does nothing if the limit element already contains only a paragraph.\r\n\t\t// We ignore the case when paragraph might have some inline elements (<p><inlineWidget>[]</inlineWidget></p>)\r\n\t\t// because we don't support such cases yet and it's unclear whether inlineWidget shouldn't be a limit itself.\r\n\t\tif ( limitElementFirstChild && limitElementFirstChild.name === 'paragraph' ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * The entire content is replaced with the paragraph. Selection is moved inside the paragraph.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_replaceEntireContentWithParagraph( writer ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\t\tconst limitElement = model.schema.getLimitElement( selection );\r\n\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\r\n\t\twriter.remove( writer.createRangeIn( limitElement ) );\r\n\t\twriter.insert( paragraph, limitElement );\r\n\r\n\t\twriter.setSelection( paragraph, 0 );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/deleteobserver\r\n */\r\n\r\nimport Observer from '@ckeditor/ckeditor5-engine/src/view/observer/observer';\r\nimport DomEventData from '@ckeditor/ckeditor5-engine/src/view/observer/domeventdata';\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\nimport env from '@ckeditor/ckeditor5-utils/src/env';\r\n\r\n/**\r\n * Delete observer introduces the {@link module:engine/view/document~Document#event:delete} event.\r\n *\r\n * @extends module:engine/view/observer/observer~Observer\r\n */\r\nexport default class DeleteObserver extends Observer {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tconst document = view.document;\r\n\t\tlet sequence = 0;\r\n\r\n\t\tdocument.on( 'keyup', ( evt, data ) => {\r\n\t\t\tif ( data.keyCode == keyCodes.delete || data.keyCode == keyCodes.backspace ) {\r\n\t\t\t\tsequence = 0;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tdocument.on( 'keydown', ( evt, data ) => {\r\n\t\t\tconst deleteData = {};\r\n\r\n\t\t\tif ( data.keyCode == keyCodes.delete ) {\r\n\t\t\t\tdeleteData.direction = 'forward';\r\n\t\t\t\tdeleteData.unit = 'character';\r\n\t\t\t} else if ( data.keyCode == keyCodes.backspace ) {\r\n\t\t\t\tdeleteData.direction = 'backward';\r\n\t\t\t\tdeleteData.unit = 'codePoint';\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst hasWordModifier = env.isMac ? data.altKey : data.ctrlKey;\r\n\t\t\tdeleteData.unit = hasWordModifier ? 'word' : deleteData.unit;\r\n\t\t\tdeleteData.sequence = ++sequence;\r\n\r\n\t\t\t// Save the event object to check later if it was stopped or not.\r\n\t\t\tlet event;\r\n\t\t\tdocument.once( 'delete', evt => ( event = evt ), { priority: 'highest' } );\r\n\r\n\t\t\tdocument.fire( 'delete', new DomEventData( document, data.domEvent, deleteData ) );\r\n\r\n\t\t\t// Stop `keydown` event if `delete` event was stopped.\r\n\t\t\t// https://github.com/ckeditor/ckeditor5/issues/753\r\n\t\t\tif ( event && event.stop.called ) {\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve() {}\r\n}\r\n\r\n/**\r\n * Event fired when the user tries to delete content (e.g. presses <kbd>Delete</kbd> or <kbd>Backspace</kbd>).\r\n *\r\n * Note: This event is fired by the {@link module:typing/deleteobserver~DeleteObserver observer}\r\n * (usually registered by the {@link module:typing/delete~Delete delete feature}).\r\n *\r\n * @event module:engine/view/document~Document#event:delete\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data\r\n * @param {'forward'|'delete'} data.direction The direction in which the deletion should happen.\r\n * @param {'character'|'word'} data.unit The \"amount\" of content that should be deleted.\r\n * @param {Number} data.sequence A number describing which subsequent delete event it is without the key being released.\r\n * If it's 2 or more it means that the key was pressed and hold.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/utils/injectandroidbackspacenutationshandling\r\n */\r\n\r\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\r\n\r\nimport { containerChildrenMutated } from './utils';\r\n\r\n/**\r\n * Handles mutations triggered by <kbd>Backspace</kbd> on Android.\r\n * Due to the fact that on Android `keydown` events don't have the `keyCode` set, we are not able\r\n * to handle backspacing directly. We need to guess that from mutations which the IME\r\n * on Android caused.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n */\r\nexport default function injectAndroidBackspaceMutationsHandling( editor ) {\r\n\tconst model = editor.model;\r\n\tconst view = editor.editing.view;\r\n\tconst selectionChangeToleranceMs = 200;\r\n\r\n\tlet previousSelection = null;\r\n\tlet currentSelection = model.createSelection( model.document.selection );\r\n\tlet latestSelectionChangeMs = Date.now();\r\n\r\n\tmodel.document.selection.on( 'change', handleSelectionChange );\r\n\r\n\tview.document.on( 'mutations', handleMutations, { priority: 'highest' } );\r\n\r\n\t// Saves current and previous selection when it changes. Saved selections are used\r\n\t// to remove correct piece of content when `Backspace` mutations are detected.\r\n\t//\r\n\t// @param {Object} evt\r\n\tfunction handleSelectionChange( evt ) {\r\n\t\tconst newSelection = model.createSelection( evt.source );\r\n\t\tif ( !currentSelection.isEqual( newSelection ) ) {\r\n\t\t\tpreviousSelection = currentSelection;\r\n\t\t\tcurrentSelection = newSelection;\r\n\t\t\tlatestSelectionChangeMs = Date.now();\r\n\t\t}\r\n\t}\r\n\r\n\t// Handles DOM mutations and checks if they should be processed as block elements removal mutations.\r\n\t//\r\n\t// @param {Object} evt\r\n\t// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n\t// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n\tfunction handleMutations( evt, mutations ) {\r\n\t\tif ( containerChildrenMutated( mutations ) && containsContainersRemoval( mutations ) ) {\r\n\t\t\thandleContainerRemovalMutations();\r\n\r\n\t\t\t// Stop mutations event propagation so other mutation handlers are not triggered.\r\n\t\t\tevt.stop();\r\n\t\t}\r\n\t}\r\n\r\n\t// Handles situations when mutations were generated by container removal.\r\n\t// It happens on Android devices where every typing input has `229` key code\r\n\t// and delete observer will not be triggered. In such cases we need to handle\r\n\t// container removal mutations manually.\r\n\tfunction handleContainerRemovalMutations() {\r\n\t\tif ( shouldUsePreviousSelection() ) {\r\n\t\t\t// If previous selection is used, update model selection in order\r\n\t\t\t// to use `delete` command and to make `undo` work correctly.\r\n\t\t\tmodel.enqueueChange( writer => {\r\n\t\t\t\twriter.setSelection( previousSelection );\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\teditor.execute( 'delete' );\r\n\t}\r\n\r\n\t// Whether previously saved selection should be used instead of the current one to remove content.\r\n\t//\r\n\t// On Android devices when pressing backspace on non-collapsed selection, selection like:\r\n\t//\r\n\t//\t\t`<h1>[Foo</h1><p>Bar]</p>`\r\n\t//\r\n\t// is changed to:\r\n\t//\r\n\t//\t\t`<h1>Foo</h1><p>Bar[]</p>`\r\n\t//\r\n\t// even before `keypress` event, so in such cases we have to rely on previous selection to correctly process selected content.\r\n\t//\r\n\t// Previous selection will be used if:\r\n\t//\r\n\t//\t\t* current selection is collapsed (see example above),\r\n\t//\t\t* previous selection exists, is non-collapsed and has same ending (last position) as the current one,\r\n\t//\t\t* change of the selection happened not earlier than X milliseconds ago (see `selectionChangeToleranceMs`).\r\n\t//\r\n\t// The last check is needed, because user can manually collapse the selection on its current end and then press `Backspace`.\r\n\t// In such situations timing determines if the selection change was caused by the user or browser native behaviour.\r\n\t// However, this happens only if selection was collapsed by the user on the beginning of the paragraph (so mutations\r\n\t// still will show container removal).\r\n\t//\r\n\t// @returns {Boolean}\r\n\tfunction shouldUsePreviousSelection() {\r\n\t\treturn Date.now() - latestSelectionChangeMs < selectionChangeToleranceMs &&\r\n\t\t\tpreviousSelection && !previousSelection.isCollapsed && currentSelection.isCollapsed &&\r\n\t\t\tcurrentSelection.getLastPosition().isEqual( previousSelection.getLastPosition() );\r\n\t}\r\n}\r\n\r\n// Checks whether mutations array contains mutation generated by container/containers removal.\r\n// For example mutations generated on Android when pressing `backspace` on the beginning of the line:\r\n//\r\n//\t\t<h1>Header1</h1>\r\n//\t\t<p>{}Paragraph</p>\r\n//\r\n// are:\r\n//\r\n//\t\t[\r\n//\t\t\t{ newChildren: [], oldChildren: [ 'Paragraph' ], node: P, type: 'children' },\r\n//\t\t\t{ newChildren: [ ContainerElement ], oldChildren: [ ContainerElement, ContainerElement ], node: Root, type: 'children' },\r\n//\t\t\t{ newChildren: [ 'Heading 1Paragraph' ], oldChildren: [ 'Heading 1' ], node: H1, type: 'children' }\r\n//\t\t]\r\n//\r\n// The 1st and 3rd mutations are just changes in a text (1st - text in `p` element was removed, 3rd - text in `h2` was changed)\r\n// and the 2nd one shows that one `ContainerElement` was removed. We have to recognize if mutations like 2nd one are present.\r\n// Based on that heuristic mutations are treated as the one removing container element.\r\n//\r\n// @private\r\n// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\r\n// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\r\n// @returns {Boolean}\r\nfunction containsContainersRemoval( mutations ) {\r\n\tfor ( const mutation of mutations ) {\r\n\t\tif ( mutation.type !== 'children' ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst childrenBefore = mutation.oldChildren;\r\n\t\tconst childrenAfter = mutation.newChildren;\r\n\r\n\t\t// Check if only containers were present before the mutation.\r\n\t\tif ( !hasOnlyContainers( childrenBefore ) ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst diffResult = diff( childrenBefore, childrenAfter );\r\n\r\n\t\t// Check if there was only removing in that mutation without any insertions.\r\n\t\tconst hasDelete = diffResult.some( item => item === 'delete' );\r\n\t\tconst hasInsert = diffResult.some( item => item === 'insert' );\r\n\r\n\t\tif ( hasDelete && !hasInsert ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n// Whether provided array contains only nodes of `containerElement` type.\r\n//\r\n// @private\r\n// @param {Array.<module:engine/view/node~Node>} children\r\n// @returns {Boolean}\r\nfunction hasOnlyContainers( children ) {\r\n\treturn children.every( child => child.is( 'containerElement' ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/delete\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport DeleteCommand from './deletecommand';\r\nimport DeleteObserver from './deleteobserver';\r\n\r\nimport injectAndroidBackspaceMutationsHandling from './utils/injectandroidbackspacemutationshandling';\r\n\r\n/**\r\n * The delete and backspace feature. Handles the <kbd>Delete</kbd> and <kbd>Backspace</kbd> keys in the editor.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Delete extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Delete';\r\n\t}\r\n\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\r\n\t\tview.addObserver( DeleteObserver );\r\n\r\n\t\teditor.commands.add( 'forwardDelete', new DeleteCommand( editor, 'forward' ) );\r\n\t\teditor.commands.add( 'delete', new DeleteCommand( editor, 'backward' ) );\r\n\r\n\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\r\n\t\t\teditor.execute( data.direction == 'forward' ? 'forwardDelete' : 'delete', { unit: data.unit, sequence: data.sequence } );\r\n\t\t\tdata.preventDefault();\r\n\t\t\tview.scrollToTheSelection();\r\n\t\t} );\r\n\r\n\t\tinjectAndroidBackspaceMutationsHandling( editor );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module typing/typing\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Input from './input';\r\nimport Delete from './delete';\r\n\r\n/**\r\n * The typing feature. It handles typing.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:typing/input~Input} and {@link module:typing/delete~Delete}\r\n * plugins.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Typing extends Plugin {\r\n\tstatic get requires() {\r\n\t\treturn [ Input, Delete ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Typing';\r\n\t}\r\n}\r\n\r\n/**\r\n * The configuration of the typing features. Used by the features from the `@ckeditor/ckeditor5-typing` package.\r\n *\r\n * Read more in {@link module:typing/typing~TypingConfig}.\r\n *\r\n * @member {module:typing/typing~TypingConfig} module:core/editor/editorconfig~EditorConfig#typing\r\n */\r\n\r\n/**\r\n * The configuration of the typing features. Used by the typing features in `@ckeditor/ckeditor5-typing` package.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n * \t\t\t\ttyping: ... // Typing feature options.\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface TypingConfig\r\n */\r\n\r\n/**\r\n * The granularity of undo/redo for typing and deleting. The value `20` means (more or less) that a new undo step\r\n * is created every 20 characters are inserted or deleted.\r\n *\r\n * @member {Number} [module:typing/typing~TypingConfig#undoStep=20]\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/model/operation/nooperation\r\n */\r\n\r\nimport Operation from './operation';\r\n\r\n/**\r\n * Operation which is doing nothing (\"empty operation\", \"do-nothing operation\", \"noop\"). This is an operation,\r\n * which when executed does not change the tree model. It still has some parameters defined for transformation purposes.\r\n *\r\n * In most cases this operation is a result of transforming operations. When transformation returns\r\n * {@link module:engine/model/operation/nooperation~NoOperation} it means that changes done by the transformed operation\r\n * have already been applied.\r\n *\r\n * @extends module:engine/model/operation/operation~Operation\r\n */\r\nexport default class NoOperation extends Operation {\r\n\tget type() {\r\n\t\treturn 'noop';\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns an operation that has the same parameters as this operation.\r\n\t *\r\n\t * @returns {module:engine/model/operation/nooperation~NoOperation} Clone of this operation.\r\n\t */\r\n\tclone() {\r\n\t\treturn new NoOperation( this.baseVersion );\r\n\t}\r\n\r\n\t/**\r\n\t * See {@link module:engine/model/operation/operation~Operation#getReversed `Operation#getReversed()`}.\r\n\t *\r\n\t * @returns {module:engine/model/operation/nooperation~NoOperation}\r\n\t */\r\n\tgetReversed() {\r\n\t\treturn new NoOperation( this.baseVersion + 1 );\r\n\t}\r\n\r\n\t_execute() {\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get className() {\r\n\t\treturn 'NoOperation';\r\n\t}\r\n}\r\n","import InsertOperation from './insertoperation';\r\nimport AttributeOperation from './attributeoperation';\r\nimport RenameOperation from './renameoperation';\r\nimport MarkerOperation from './markeroperation';\r\nimport MoveOperation from './moveoperation';\r\nimport RootAttributeOperation from './rootattributeoperation';\r\nimport MergeOperation from './mergeoperation';\r\nimport SplitOperation from './splitoperation';\r\nimport NoOperation from './nooperation';\r\nimport Range from '../range';\r\nimport Position from '../position';\r\n\r\nimport compareArrays from '@ckeditor/ckeditor5-utils/src/comparearrays';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\n\r\nconst transformations = new Map();\r\n\r\n/**\r\n * @module engine/model/operation/transform\r\n */\r\n\r\n/**\r\n * Sets a transformation function to be be used to transform instances of class `OperationA` by instances of class `OperationB`.\r\n *\r\n * The `transformationFunction` is passed three parameters:\r\n *\r\n * * `a` - operation to be transformed, an instance of `OperationA`,\r\n * * `b` - operation to be transformed by, an instance of `OperationB`,\r\n * * {@link module:engine/model/operation/transform~TransformationContext `context`} - object with additional information about\r\n * transformation context.\r\n *\r\n * The `transformationFunction` should return transformation result, which is an array with one or multiple\r\n * {@link module:engine/model/operation/operation~Operation operation} instances.\r\n *\r\n * @protected\r\n * @param {Function} OperationA\r\n * @param {Function} OperationB\r\n * @param {Function} transformationFunction Function to use for transforming.\r\n */\r\nfunction setTransformation( OperationA, OperationB, transformationFunction ) {\r\n\tlet aGroup = transformations.get( OperationA );\r\n\r\n\tif ( !aGroup ) {\r\n\t\taGroup = new Map();\r\n\t\ttransformations.set( OperationA, aGroup );\r\n\t}\r\n\r\n\taGroup.set( OperationB, transformationFunction );\r\n}\r\n\r\n/**\r\n * Returns a previously set transformation function for transforming an instance of `OperationA` by an instance of `OperationB`.\r\n *\r\n * If no transformation was set for given pair of operations, {@link module:engine/model/operation/transform~noUpdateTransformation}\r\n * is returned. This means that if no transformation was set, the `OperationA` instance will not change when transformed\r\n * by the `OperationB` instance.\r\n *\r\n * @private\r\n * @param {Function} OperationA\r\n * @param {Function} OperationB\r\n * @returns {Function} Function set to transform an instance of `OperationA` by an instance of `OperationB`.\r\n */\r\nfunction getTransformation( OperationA, OperationB ) {\r\n\tconst aGroup = transformations.get( OperationA );\r\n\r\n\tif ( aGroup && aGroup.has( OperationB ) ) {\r\n\t\treturn aGroup.get( OperationB );\r\n\t}\r\n\r\n\treturn noUpdateTransformation;\r\n}\r\n\r\n/**\r\n * A transformation function that only clones operation to transform, without changing it.\r\n *\r\n * @private\r\n * @param {module:engine/model/operation/operation~Operation} a Operation to transform.\r\n * @returns {Array.<module:engine/model/operation/operation~Operation>}\r\n */\r\nfunction noUpdateTransformation( a ) {\r\n\treturn [ a ];\r\n}\r\n\r\n/**\r\n * Transforms operation `a` by operation `b`.\r\n *\r\n * @param {module:engine/model/operation/operation~Operation} a Operation to be transformed.\r\n * @param {module:engine/model/operation/operation~Operation} b Operation to transform by.\r\n * @param {module:engine/model/operation/transform~TransformationContext} context Transformation context for this transformation.\r\n * @returns {Array.<module:engine/model/operation/operation~Operation>} Transformation result.\r\n */\r\nexport function transform( a, b, context = {} ) {\r\n\tconst transformationFunction = getTransformation( a.constructor, b.constructor );\r\n\r\n\ttry {\r\n\t\ta = a.clone();\r\n\r\n\t\treturn transformationFunction( a, b, context );\r\n\t} catch ( e ) {\r\n\t\tlog.error( 'Error during operation transformation!', e.message );\r\n\t\tlog.error( 'Transformed operation', a );\r\n\t\tlog.error( 'Operation transformed by', b );\r\n\t\tlog.error( 'context.aIsStrong', context.aIsStrong );\r\n\t\tlog.error( 'context.aWasUndone', context.aWasUndone );\r\n\t\tlog.error( 'context.bWasUndone', context.bWasUndone );\r\n\t\tlog.error( 'context.abRelation', context.abRelation );\r\n\t\tlog.error( 'context.baRelation', context.baRelation );\r\n\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\n/**\r\n * Performs a transformation of two sets of operations - `operationsA` and `operationsB`. The transformation is two-way -\r\n * both transformed `operationsA` and transformed `operationsB` are returned.\r\n *\r\n * Note, that the first operation in each set should base on the same document state (\r\n * {@link module:engine/model/document~Document#version document version}).\r\n *\r\n * It is assumed that `operationsA` are \"more important\" during conflict resolution between two operations.\r\n *\r\n * New copies of both passed arrays and operations inside them are returned. Passed arguments are not altered.\r\n *\r\n * Base versions of the transformed operations sets are updated accordingly. For example, assume that base versions are `4`\r\n * and there are `3` operations in `operationsA` and `5` operations in `operationsB`. Then:\r\n *\r\n * * transformed `operationsA` will start from base version `9` (`4` base version + `5` operations B),\r\n * * transformed `operationsB` will start from base version `7` (`4` base version + `3` operations A).\r\n *\r\n * If no operation was broken into two during transformation, then both sets will end up with an operation that bases on version `11`:\r\n *\r\n * * transformed `operationsA` start from `9` and there are `3` of them, so the last will have `baseVersion` equal to `11`,\r\n * * transformed `operationsB` start from `7` and there are `5` of them, so the last will have `baseVersion` equal to `11`.\r\n *\r\n * @param {Array.<module:engine/model/operation/operation~Operation>} operationsA\r\n * @param {Array.<module:engine/model/operation/operation~Operation>} operationsB\r\n * @param {Object} options Additional transformation options.\r\n * @param {module:engine/model/document~Document|null} options.document Document which the operations change.\r\n * @param {Boolean} [options.useRelations=false] Whether during transformation relations should be used (used during undo for\r\n * better conflict resolution).\r\n * @param {Boolean} [options.padWithNoOps=false] Whether additional {@link module:engine/model/operation/nooperation~NoOperation}s\r\n * should be added to the transformation results to force the same last base version for both transformed sets (in case\r\n * if some operations got broken into multiple operations during transformation).\r\n * @returns {Object} Transformation result.\r\n * @returns {Array.<module:engine/model/operation/operation~Operation>} return.operationsA Transformed `operationsA`.\r\n * @returns {Array.<module:engine/model/operation/operation~Operation>} return.operationsB Transformed `operationsB`.\r\n */\r\nexport function transformSets( operationsA, operationsB, options ) {\r\n\t// Create new arrays so the originally passed arguments are not changed.\r\n\t// No need to clone operations, they are cloned as they are transformed.\r\n\toperationsA = operationsA.slice();\r\n\toperationsB = operationsB.slice();\r\n\r\n\t// If one of sets is empty there is simply nothing to transform, so return sets as they are.\r\n\tif ( operationsA.length == 0 || operationsB.length == 0 ) {\r\n\t\treturn { operationsA, operationsB };\r\n\t}\r\n\t//\r\n\t// Following is a description of transformation process:\r\n\t//\r\n\t// There are `operationsA` and `operationsB` to be transformed, both by both.\r\n\t//\r\n\t// So, suppose we have sets of two operations each: `operationsA` = `[ a1, a2 ]`, `operationsB` = `[ b1, b2 ]`.\r\n\t//\r\n\t// Remember, that we can only transform operations that base on the same context. We assert that `a1` and `b1` base on\r\n\t// the same context and we transform them. Then, we get `a1'` and `b1'`. `a2` bases on a context with `a1` -- `a2`\r\n\t// is an operation that followed `a1`. Similarly, `b2` bases on a context with `b1`.\r\n\t//\r\n\t// However, since `a1'` is a result of transformation by `b1`, `a1'` now also has a context with `b1`. This means that\r\n\t// we can safely transform `a1'` by `b2`. As we finish transforming `a1`, we also transformed all `operationsB`.\r\n\t// All `operationsB` also have context including `a1`. Now, we can properly transform `a2` by those operations.\r\n\t//\r\n\t// The transformation process can be visualized on a transformation diagram (\"diamond diagram\"):\r\n\t//\r\n\t//          [the initial state]\r\n\t//         [common for a1 and b1]\r\n\t//\r\n\t//                   *\r\n\t//                  / \\\r\n\t//                 /   \\\r\n\t//               b1     a1\r\n\t//               /       \\\r\n\t//              /         \\\r\n\t//             *           *\r\n\t//            / \\         / \\\r\n\t//           /   \\       /   \\\r\n\t//         b2    a1'   b1'    a2\r\n\t//         /       \\   /       \\\r\n\t//        /         \\ /         \\\r\n\t//       *           *           *\r\n\t//        \\         / \\         /\r\n\t//         \\       /   \\       /\r\n\t//        a1''   b2'   a2'   b1''\r\n\t//           \\   /       \\   /\r\n\t//            \\ /         \\ /\r\n\t//             *           *\r\n\t//              \\         /\r\n\t//               \\       /\r\n\t//              a2''   b2''\r\n\t//                 \\   /\r\n\t//                  \\ /\r\n\t//                   *\r\n\t//\r\n\t//           [the final state]\r\n\t//\r\n\t// The final state can be reached from the initial state by applying `a1`, `a2`, `b1''` and `b2''`, as well as by\r\n\t// applying `b1`, `b2`, `a1''`, `a2''`. Note how the operations get to a proper common state before each pair is\r\n\t// transformed.\r\n\t//\r\n\t// Another thing to consider is that an operation during transformation can be broken into multiple operations.\r\n\t// Suppose that `a1` * `b1` = `[ a11', a12' ]` (instead of `a1'` that we considered previously).\r\n\t//\r\n\t// In that case, we leave `a12'` for later and we continue transforming `a11'` until it is transformed by all `operationsB`\r\n\t// (in our case it is just `b2`). At this point, `b1` is transformed by \"whole\" `a1`, while `b2` is only transformed\r\n\t// by `a11'`. Similarly, `a12'` is only transformed by `b1`. This leads to a conclusion that we need to start transforming `a12'`\r\n\t// from the moment just after it was broken. So, `a12'` is transformed by `b2`. Now, \"the whole\" `a1` is transformed\r\n\t// by `operationsB`, while all `operationsB` are transformed by \"the whole\" `a1`. This means that we can continue with\r\n\t// following `operationsA` (in our case it is just `a2`).\r\n\t//\r\n\t// Of course, also `operationsB` can be broken. However, since we focus on transforming operation `a` to the end,\r\n\t// the only thing to do is to store both pieces of operation `b`, so that the next transformed operation `a` will\r\n\t// be transformed by both of them.\r\n\t//\r\n\t//                       *\r\n\t//                      / \\\r\n\t//                     /   \\\r\n\t//                    /     \\\r\n\t//                  b1       a1\r\n\t//                  /         \\\r\n\t//                 /           \\\r\n\t//                /             \\\r\n\t//               *               *\r\n\t//              / \\             / \\\r\n\t//             /  a11'         /   \\\r\n\t//            /     \\         /     \\\r\n\t//          b2       *      b1'      a2\r\n\t//          /       / \\     /         \\\r\n\t//         /       /  a12' /           \\\r\n\t//        /       /     \\ /             \\\r\n\t//       *       b2'     *               *\r\n\t//        \\     /       / \\             /\r\n\t//       a11'' /     b21'' \\           /\r\n\t//          \\ /       /     \\         /\r\n\t//           *       *      a2'     b1''\r\n\t//            \\     / \\       \\     /\r\n\t//          a12'' b22''\\       \\   /\r\n\t//              \\ /     \\       \\ /\r\n\t//               *      a2''     *\r\n\t//                \\       \\     /\r\n\t//                 \\       \\  b21'''\r\n\t//                  \\       \\ /\r\n\t//                a2'''      *\r\n\t//                    \\     /\r\n\t//                     \\  b22'''\r\n\t//                      \\ /\r\n\t//                       *\r\n\t//\r\n\t// Note, how `a1` is broken and transformed into `a11'` and `a12'`, while `b2'` got broken and transformed into `b21''` and `b22''`.\r\n\t//\r\n\t// Having all that on mind, here is an outline for the transformation process algorithm:\r\n\t//\r\n\t// 1. We have `operationsA` and `operationsB` array, which we dynamically update as the transformation process goes.\r\n\t//\r\n\t// 2. We take next (or first) operation from `operationsA` and check from which operation `b` we need to start transforming it.\r\n\t// All original `operationsA` are set to be transformed starting from the first operation `b`.\r\n\t//\r\n\t// 3. We take operations from `operationsB`, one by one, starting from the correct one, and transform operation `a`\r\n\t// by operation `b` (and vice versa). We update `operationsA` and `operationsB` by replacing the original operations\r\n\t// with the transformation results.\r\n\t//\r\n\t// 4. If operation is broken into multiple operations, we save all the new operations in the place of the\r\n\t// original operation.\r\n\t//\r\n\t// 5. Additionally, if operation `a` was broken, for the \"new\" operation, we remember from which operation `b` it should\r\n\t// be transformed by.\r\n\t//\r\n\t// 6. We continue transforming \"current\" operation `a` until it is transformed by all `operationsB`. Then, go to 2.\r\n\t// unless the last operation `a` was transformed.\r\n\t//\r\n\t// The actual implementation of the above algorithm is slightly different, as only one loop (while) is used.\r\n\t// The difference is that we have \"current\" `a` operation to transform and we store the index of the next `b` operation\r\n\t// to transform by. Each loop operates on two indexes then: index pointing to currently processed `a` operation and\r\n\t// index pointing to next `b` operation. Each loop is just one `a * b` + `b * a` transformation. After each loop\r\n\t// operation `b` index is updated. If all `b` operations were visited for the current `a` operation, we change\r\n\t// current `a` operation index to the next one.\r\n\t//\r\n\r\n\t// For each operation `a`, keeps information what is the index in `operationsB` from which the transformation should start.\r\n\tconst nextTransformIndex = new WeakMap();\r\n\r\n\t// For all the original `operationsA`, set that they should be transformed starting from the first of `operationsB`.\r\n\tfor ( const op of operationsA ) {\r\n\t\tnextTransformIndex.set( op, 0 );\r\n\t}\r\n\r\n\t// Additional data that is used for some postprocessing after the main transformation process is done.\r\n\tconst data = {\r\n\t\tnextBaseVersionA: operationsA[ operationsA.length - 1 ].baseVersion + 1,\r\n\t\tnextBaseVersionB: operationsB[ operationsB.length - 1 ].baseVersion + 1,\r\n\t\toriginalOperationsACount: operationsA.length,\r\n\t\toriginalOperationsBCount: operationsB.length\r\n\t};\r\n\r\n\tconst contextFactory = new ContextFactory( options.document, options.useRelations );\r\n\tcontextFactory.setOriginalOperations( operationsA );\r\n\tcontextFactory.setOriginalOperations( operationsB );\r\n\r\n\t// Index of currently transformed operation `a`.\r\n\tlet i = 0;\r\n\r\n\t// While not all `operationsA` are transformed...\r\n\twhile ( i < operationsA.length ) {\r\n\t\t// Get \"current\" operation `a`.\r\n\t\tconst opA = operationsA[ i ];\r\n\r\n\t\t// For the \"current\" operation `a`, get the index of the next operation `b` to transform by.\r\n\t\tconst indexB = nextTransformIndex.get( opA );\r\n\r\n\t\t// If operation `a` was already transformed by every operation `b`, change \"current\" operation `a` to the next one.\r\n\t\tif ( indexB == operationsB.length ) {\r\n\t\t\ti++;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst opB = operationsB[ indexB ];\r\n\r\n\t\t// Transform `a` by `b` and `b` by `a`.\r\n\t\tconst newOpsA = transform( opA, opB, contextFactory.getContext( opA, opB, true ) );\r\n\t\tconst newOpsB = transform( opB, opA, contextFactory.getContext( opB, opA, false ) );\r\n\t\t// As a result we get one or more `newOpsA` and one or more `newOpsB` operations.\r\n\r\n\t\t// Update contextual information about operations.\r\n\t\tcontextFactory.updateRelation( opA, opB );\r\n\r\n\t\tcontextFactory.setOriginalOperations( newOpsA, opA );\r\n\t\tcontextFactory.setOriginalOperations( newOpsB, opB );\r\n\r\n\t\t// For new `a` operations, update their index of the next operation `b` to transform them by.\r\n\t\t//\r\n\t\t// This is needed even if there was only one result (`a` was not broken) because that information is used\r\n\t\t// at the beginning of this loop every time.\r\n\t\tfor ( const newOpA of newOpsA ) {\r\n\t\t\t// Acknowledge, that operation `b` also might be broken into multiple operations.\r\n\t\t\t//\r\n\t\t\t// This is why we raise `indexB` not just by 1. If `newOpsB` are multiple operations, they will be\r\n\t\t\t// spliced in the place of `opB`. So we need to change `transformBy` accordingly, so that an operation won't\r\n\t\t\t// be transformed by the same operation (part of it) again.\r\n\t\t\tnextTransformIndex.set( newOpA, indexB + newOpsB.length );\r\n\t\t}\r\n\r\n\t\t// Update `operationsA` and `operationsB` with the transformed versions.\r\n\t\toperationsA.splice( i, 1, ...newOpsA );\r\n\t\toperationsB.splice( indexB, 1, ...newOpsB );\r\n\t}\r\n\r\n\tif ( options.padWithNoOps ) {\r\n\t\t// If no-operations padding is enabled, count how many extra `a` and `b` operations were generated.\r\n\t\tconst brokenOperationsACount = operationsA.length - data.originalOperationsACount;\r\n\t\tconst brokenOperationsBCount = operationsB.length - data.originalOperationsBCount;\r\n\r\n\t\t// Then, if that number is not the same, pad `operationsA` or `operationsB` with correct number of no-ops so\r\n\t\t// that the base versions are equalled.\r\n\t\t//\r\n\t\t// Note that only one array will be updated, as only one of those subtractions can be greater than zero.\r\n\t\tpadWithNoOps( operationsA, brokenOperationsBCount - brokenOperationsACount );\r\n\t\tpadWithNoOps( operationsB, brokenOperationsACount - brokenOperationsBCount );\r\n\t}\r\n\r\n\t// Finally, update base versions of transformed operations.\r\n\tupdateBaseVersions( operationsA, data.nextBaseVersionB );\r\n\tupdateBaseVersions( operationsB, data.nextBaseVersionA );\r\n\r\n\treturn { operationsA, operationsB };\r\n}\r\n\r\n// Gathers additional data about operations processed during transformation. Can be used to obtain contextual information\r\n// about two operations that are about to be transformed. This contextual information can be used for better conflict resolution.\r\nclass ContextFactory {\r\n\t// Creates `ContextFactory` instance.\r\n\t//\r\n\t// @param {module:engine/model/document~Document} document Document which the operations change.\r\n\t// @param {Boolean} useRelations Whether during transformation relations should be used (used during undo for\r\n\t// better conflict resolution).\r\n\tconstructor( document, useRelations ) {\r\n\t\t// `model.History` instance which information about undone operations will be taken from.\r\n\t\tthis._history = document.history;\r\n\r\n\t\t// Whether additional context should be used.\r\n\t\tthis._useRelations = useRelations;\r\n\r\n\t\t// For each operation that is created during transformation process, we keep a reference to the original operation\r\n\t\t// which it comes from. The original operation works as a kind of \"identifier\". Every contextual information\r\n\t\t// gathered during transformation that we want to save for given operation, is actually saved for the original operation.\r\n\t\t// This way no matter if operation `a` is cloned, then transformed, even breaks, we still have access to the previously\r\n\t\t// gathered data through original operation reference.\r\n\t\tthis._originalOperations = new Map();\r\n\r\n\t\t// Relations is a double-map structure (maps in map) where for two operations we store how those operations were related\r\n\t\t// to each other. Those relations are evaluated during transformation process. For every transformated pair of operations\r\n\t\t// we keep relations between them.\r\n\t\tthis._relations = new Map();\r\n\t}\r\n\r\n\t// Sets \"original operation\" for given operations.\r\n\t//\r\n\t// During transformation process, operations are cloned, then changed, then processed again, sometimes broken into two\r\n\t// or multiple operations. When gathering additional data it is important that all operations can be somehow linked\r\n\t// so a cloned and transformed \"version\" still kept track of the data assigned earlier to it.\r\n\t//\r\n\t// The original operation object will be used as such an universal linking id. Throughout the transformation process\r\n\t// all cloned operations will refer to \"the original operation\" when storing and reading additional data.\r\n\t//\r\n\t// If `takeFrom` is not set, each operation from `operations` array will be assigned itself as \"the original operation\".\r\n\t// This should be used as an initialization step.\r\n\t//\r\n\t// If `takeFrom` is set, each operation from `operations` will be assigned the same original operation as assigned\r\n\t// for `takeFrom` operation. This should be used to update original operations. It should be used in a way that\r\n\t// `operations` are the result of `takeFrom` transformation to ensure proper \"original operation propagation\".\r\n\t//\r\n\t// @param {Array.<module:engine/model/operation/operation~Operation>} operations\r\n\t// @param {module:engine/model/operation/operation~Operation|null} [takeFrom=null]\r\n\tsetOriginalOperations( operations, takeFrom = null ) {\r\n\t\tconst originalOperation = takeFrom ? this._originalOperations.get( takeFrom ) : null;\r\n\r\n\t\tfor ( const operation of operations ) {\r\n\t\t\tthis._originalOperations.set( operation, originalOperation || operation );\r\n\t\t}\r\n\t}\r\n\r\n\t// Saves a relation between operations `opA` and `opB`.\r\n\t//\r\n\t// Relations are then later used to help solve conflicts when operations are transformed.\r\n\t//\r\n\t// @param {module:engine/model/operation/operation~Operation} opA\r\n\t// @param {module:engine/model/operation/operation~Operation} opB\r\n\tupdateRelation( opA, opB ) {\r\n\t\t// The use of relations is described in a bigger detail in transformation functions.\r\n\t\t//\r\n\t\t// In brief, this function, for specified pairs of operation types, checks how positions defined in those operations relate.\r\n\t\t// Then those relations are saved. For example, for two move operations, it is saved if one of those operations target\r\n\t\t// position is before the other operation source position. This kind of information gives contextual information when\r\n\t\t// transformation is used during undo. Similar checks are done for other pairs of operations.\r\n\t\t//\r\n\t\tswitch ( opA.constructor ) {\r\n\t\t\tcase MoveOperation: {\r\n\t\t\t\tswitch ( opB.constructor ) {\r\n\t\t\t\t\tcase MergeOperation: {\r\n\t\t\t\t\t\tif ( opA.targetPosition.isEqual( opB.sourcePosition ) || opB.movedRange.containsPosition( opA.targetPosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'insertAtSource' );\r\n\t\t\t\t\t\t} else if ( opA.targetPosition.isEqual( opB.deletionPosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'insertBetween' );\r\n\t\t\t\t\t\t} else if ( opA.targetPosition.isAfter( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'moveTargetAfter' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcase MoveOperation: {\r\n\t\t\t\t\t\tif ( opA.targetPosition.isEqual( opB.sourcePosition ) || opA.targetPosition.isBefore( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'insertBefore' );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'insertAfter' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase SplitOperation: {\r\n\t\t\t\tswitch ( opB.constructor ) {\r\n\t\t\t\t\tcase MergeOperation: {\r\n\t\t\t\t\t\tif ( opA.splitPosition.isBefore( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'splitBefore' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcase MoveOperation: {\r\n\t\t\t\t\t\tif ( opA.splitPosition.isEqual( opB.sourcePosition ) || opA.splitPosition.isBefore( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'splitBefore' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase MergeOperation: {\r\n\t\t\t\tswitch ( opB.constructor ) {\r\n\t\t\t\t\tcase MergeOperation: {\r\n\t\t\t\t\t\tif ( !opA.targetPosition.isEqual( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'mergeTargetNotMoved' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( opA.sourcePosition.isEqual( opB.sourcePosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'mergeSameElement' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcase SplitOperation: {\r\n\t\t\t\t\t\tif ( opA.sourcePosition.isEqual( opB.splitPosition ) ) {\r\n\t\t\t\t\t\t\tthis._setRelation( opA, opB, 'splitAtSource' );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Evaluates and returns contextual information about two given operations `opA` and `opB` which are about to be transformed.\r\n\t//\r\n\t// @param {module:engine/model/operation/operation~Operation} opA\r\n\t// @param {module:engine/model/operation/operation~Operation} opB\r\n\t// @returns {module:engine/model/operation/transform~TransformationContext}\r\n\tgetContext( opA, opB, aIsStrong ) {\r\n\t\treturn {\r\n\t\t\taIsStrong,\r\n\t\t\taWasUndone: this._wasUndone( opA ),\r\n\t\t\tbWasUndone: this._wasUndone( opB ),\r\n\t\t\tabRelation: this._useRelations ? this._getRelation( opA, opB ) : null,\r\n\t\t\tbaRelation: this._useRelations ? this._getRelation( opB, opA ) : null\r\n\t\t};\r\n\t}\r\n\r\n\t// Returns whether given operation `op` has already been undone.\r\n\t//\r\n\t// Information whether an operation was undone gives more context when making a decision when two operations are in conflict.\r\n\t//\r\n\t// @param {module:engine/model/operation/operation~Operation} op\r\n\t// @returns {Boolean}\r\n\t_wasUndone( op ) {\r\n\t\t// For `op`, get its original operation. After all, if `op` is a clone (or even transformed clone) of another\r\n\t\t// operation, literally `op` couldn't be undone. It was just generated. If anything, it was the operation it origins\r\n\t\t// from which was undone. So get that original operation.\r\n\t\tconst originalOp = this._originalOperations.get( op );\r\n\r\n\t\t// And check with the document if the original operation was undone.\r\n\t\treturn originalOp.wasUndone || this._history.isUndoneOperation( originalOp );\r\n\t}\r\n\r\n\t// Returns a relation between `opA` and an operation which is undone by `opB`. This can be `String` value if a relation\r\n\t// was set earlier or `null` if there was no relation between those operations.\r\n\t//\r\n\t// This is a little tricky to understand, so let's compare it to `ContextFactory#_wasUndone`.\r\n\t//\r\n\t// When `wasUndone( opB )` is used, we check if the `opB` has already been undone. It is obvious, that the\r\n\t// undoing operation must happen after the undone operation. So, essentially, we have `opB`, we take document history,\r\n\t// we look forward in the future and ask if in that future `opB` was undone.\r\n\t//\r\n\t// Relations is a backward process to `wasUndone()`.\r\n\t//\r\n\t// Long story short - using relations is asking what happened in the past. Looking back. This time we have an undoing\r\n\t// operation `opB` which has undone some other operation. When there is a transformation `opA` x `opB` and there is\r\n\t// a conflict to solve and `opB` is an undoing operation, we can look back in the history and see what was a relation\r\n\t// between `opA` and the operation which `opB` undone. Basing on that relation from the past, we can now make\r\n\t// a better decision when resolving a conflict between two operations, because we know more about the context of\r\n\t// those two operations.\r\n\t//\r\n\t// This is why this function does not return a relation directly between `opA` and `opB` because we need to look\r\n\t// back to search for a meaningful contextual information.\r\n\t//\r\n\t// @param {module:engine/model/operation/operation~Operation} opA\r\n\t// @param {module:engine/model/operation/operation~Operation} opB\r\n\t// @returns {String|null}\r\n\t_getRelation( opA, opB ) {\r\n\t\t// Get the original operation. Similarly as in `wasUndone()` it is used as an universal identifier for stored data.\r\n\t\tconst origB = this._originalOperations.get( opB );\r\n\t\tconst undoneB = this._history.getUndoneOperation( origB );\r\n\r\n\t\t// If `opB` is not undoing any operation, there is no relation.\r\n\t\tif ( !undoneB ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst origA = this._originalOperations.get( opA );\r\n\t\tconst relationsA = this._relations.get( origA );\r\n\r\n\t\t// Get all relations for `opA`, and check if there is a relation with `opB`-undone-counterpart. If so, return it.\r\n\t\tif ( relationsA ) {\r\n\t\t\treturn relationsA.get( undoneB ) || null;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Helper function for `ContextFactory#updateRelations`.\r\n\t//\r\n\t// @private\r\n\t// @param {module:engine/model/operation/operation~Operation} opA\r\n\t// @param {module:engine/model/operation/operation~Operation} opB\r\n\t// @param {String} relation\r\n\t_setRelation( opA, opB, relation ) {\r\n\t\t// As always, setting is for original operations, not the clones/transformed operations.\r\n\t\tconst origA = this._originalOperations.get( opA );\r\n\t\tconst origB = this._originalOperations.get( opB );\r\n\r\n\t\tlet relationsA = this._relations.get( origA );\r\n\r\n\t\tif ( !relationsA ) {\r\n\t\t\trelationsA = new Map();\r\n\t\t\tthis._relations.set( origA, relationsA );\r\n\t\t}\r\n\r\n\t\trelationsA.set( origB, relation );\r\n\t}\r\n}\r\n\r\n/**\r\n * Holds additional contextual information about a transformed pair of operations (`a` and `b`). Those information\r\n * can be used for better conflict resolving.\r\n *\r\n * @typedef {Object} module:engine/model/operation/transform~TransformationContext\r\n *\r\n * @property {Boolean} aIsStrong Whether `a` is strong operation in this transformation, or weak.\r\n * @property {Boolean} aWasUndone Whether `a` operation was undone.\r\n * @property {Boolean} bWasUndone Whether `b` operation was undone.\r\n * @property {String|null} abRelation The relation between `a` operation and an operation undone by `b` operation.\r\n * @property {String|null} baRelation The relation between `b` operation and an operation undone by `a` operation.\r\n */\r\n\r\n/**\r\n * An utility function that updates {@link module:engine/model/operation/operation~Operation#baseVersion base versions}\r\n * of passed operations.\r\n *\r\n * The function simply sets `baseVersion` as a base version of the first passed operation and then increments it for\r\n * each following operation in `operations`.\r\n *\r\n * @private\r\n * @param {Array.<module:engine/model/operation/operation~Operation>} operations Operations to update.\r\n * @param {Number} baseVersion Base version to set for the first operation in `operations`.\r\n */\r\nfunction updateBaseVersions( operations, baseVersion ) {\r\n\tfor ( const operation of operations ) {\r\n\t\toperation.baseVersion = baseVersion++;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds `howMany` instances of {@link module:engine/model/operation/nooperation~NoOperation} to `operations` set.\r\n *\r\n * @private\r\n * @param {Array.<module:engine/model/operation/operation~Operation>} operations\r\n * @param {Number} howMany\r\n */\r\nfunction padWithNoOps( operations, howMany ) {\r\n\tfor ( let i = 0; i < howMany; i++ ) {\r\n\t\toperations.push( new NoOperation( 0 ) );\r\n\t}\r\n}\r\n\r\n// -----------------------\r\n\r\nsetTransformation( AttributeOperation, AttributeOperation, ( a, b, context ) => {\r\n\tif ( a.key === b.key ) {\r\n\t\t// If operations attributes are in conflict, check if their ranges intersect and manage them properly.\r\n\r\n\t\t// First, we want to apply change to the part of a range that has not been changed by the other operation.\r\n\t\tconst operations = a.range.getDifference( b.range ).map( range => {\r\n\t\t\treturn new AttributeOperation( range, a.key, a.oldValue, a.newValue, 0 );\r\n\t\t} );\r\n\r\n\t\t// Then we take care of the common part of ranges.\r\n\t\tconst common = a.range.getIntersection( b.range );\r\n\r\n\t\tif ( common ) {\r\n\t\t\t// If this operation is more important, we also want to apply change to the part of the\r\n\t\t\t// original range that has already been changed by the other operation. Since that range\r\n\t\t\t// got changed we also have to update `oldValue`.\r\n\t\t\tif ( context.aIsStrong ) {\r\n\t\t\t\toperations.push( new AttributeOperation( common, b.key, b.newValue, a.newValue, 0 ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( operations.length == 0 ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\r\n\t\treturn operations;\r\n\t} else {\r\n\t\t// If operations don't conflict, simply return an array containing just a clone of this operation.\r\n\t\treturn [ a ];\r\n\t}\r\n} );\r\n\r\nsetTransformation( AttributeOperation, InsertOperation, ( a, b ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// The attribute operation range includes the position where nodes were inserted.\r\n\t// There are two possible scenarios: the inserted nodes were text and they should receive attributes or\r\n\t// the inserted nodes were elements and they should not receive attributes.\r\n\t//\r\n\tif ( a.range.start.hasSameParentAs( b.position ) && a.range.containsPosition( b.position ) ) {\r\n\t\t// If new nodes should not receive attributes, two separated ranges will be returned.\r\n\t\t// Otherwise, one expanded range will be returned.\r\n\t\tconst range = a.range._getTransformedByInsertion( b.position, b.howMany, !b.shouldReceiveAttributes );\r\n\t\tconst result = range.map( r => {\r\n\t\t\treturn new AttributeOperation( r, a.key, a.oldValue, a.newValue, a.baseVersion );\r\n\t\t} );\r\n\r\n\t\tif ( b.shouldReceiveAttributes ) {\r\n\t\t\t// `AttributeOperation#range` includes some newly inserted text.\r\n\t\t\t// The operation should also change the attribute of that text. An example:\r\n\t\t\t//\r\n\t\t\t// Bold should be applied on the following range:\r\n\t\t\t// <p>Fo[zb]ar</p>\r\n\t\t\t//\r\n\t\t\t// In meantime, new text is typed:\r\n\t\t\t// <p>Fozxxbar</p>\r\n\t\t\t//\r\n\t\t\t// Bold should be applied also on the new text:\r\n\t\t\t// <p>Fo[zxxb]ar</p>\r\n\t\t\t// <p>Fo<$text bold=\"true\">zxxb</$text>ar</p>\r\n\t\t\t//\r\n\t\t\t// There is a special case to consider here to consider.\r\n\t\t\t//\r\n\t\t\t// Consider setting an attribute with multiple possible values, for example `highlight`. The inserted text might\r\n\t\t\t// have already an attribute value applied and the `oldValue` property of the attribute operation might be wrong:\r\n\t\t\t//\r\n\t\t\t// Attribute `highlight=\"yellow\"` should be applied on the following range:\r\n\t\t\t// <p>Fo[zb]ar<p>\r\n\t\t\t//\r\n\t\t\t// In meantime, character `x` with `highlight=\"red\"` is typed:\r\n\t\t\t// <p>Fo[z<$text highlight=\"red\">x</$text>b]ar</p>\r\n\t\t\t//\r\n\t\t\t// In this case we cannot simply apply operation changing the attribute value from `null` to `\"yellow\"` for the whole range\r\n\t\t\t// because that would lead to an exception (`oldValue` is incorrect for `x`).\r\n\t\t\t//\r\n\t\t\t// We also cannot break the original range as this would mess up a scenario when there are multiple following\r\n\t\t\t// insert operations, because then only the first inserted character is included in those ranges:\r\n\t\t\t// <p>Fo[z][x][b]ar</p>   -->   <p>Fo[z][x]x[b]ar</p>   -->   <p>Fo[z][x]xx[b]ar</p>\r\n\t\t\t//\r\n\t\t\t// So, the attribute range needs be expanded, no matter what attributes are set on the inserted nodes:\r\n\t\t\t//\r\n\t\t\t// <p>Fo[z<$text highlight=\"red\">x</$text>b]ar</p>      <--- Change from `null` to `yellow`, throwing an exception.\r\n\t\t\t//\r\n\t\t\t// But before that operation would be applied, we will add an additional attribute operation that will change\r\n\t\t\t// attributes on the inserted nodes in a way which would make the original operation correct:\r\n\t\t\t//\r\n\t\t\t// <p>Fo[z{<$text highlight=\"red\">}x</$text>b]ar</p>    <--- Change range `{}` from `red` to `null`.\r\n\t\t\t// <p>Fo[zxb]ar</p>                                     <--- Now change from `null` to `yellow` is completely fine.\r\n\t\t\t//\r\n\r\n\t\t\t// Generate complementary attribute operation. Be sure to add it before the original operation.\r\n\t\t\tconst op = _getComplementaryAttributeOperations( b, a.key, a.oldValue );\r\n\r\n\t\t\tif ( op ) {\r\n\t\t\t\tresult.unshift( op );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If nodes should not receive new attribute, we are done here.\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// If insert operation is not expanding the attribute operation range, simply transform the range.\r\n\ta.range = a.range._getTransformedByInsertion( b.position, b.howMany, false )[ 0 ];\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n/**\r\n * Helper function for `AttributeOperation` x `InsertOperation` (and reverse) transformation.\r\n *\r\n * For given `insertOperation` it checks the inserted node if it has an attribute `key` set to a value different\r\n * than `newValue`. If so, it generates an `AttributeOperation` which changes the value of `key` attribute to `newValue`.\r\n *\r\n * @private\r\n * @param {module:engine/model/operation/insertoperation~InsertOperation} insertOperation\r\n * @param {String} key\r\n * @param {*} newValue\r\n * @returns {module:engine/model/operation/attributeoperation~AttributeOperation|null}\r\n */\r\nfunction _getComplementaryAttributeOperations( insertOperation, key, newValue ) {\r\n\tconst nodes = insertOperation.nodes;\r\n\r\n\t// At the beginning we store the attribute value from the first node.\r\n\tconst insertValue = nodes.getNode( 0 ).getAttribute( key );\r\n\r\n\tif ( insertValue == newValue ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst range = new Range( insertOperation.position, insertOperation.position.getShiftedBy( insertOperation.howMany ) );\r\n\r\n\treturn new AttributeOperation( range, key, insertValue, newValue, 0 );\r\n}\r\n\r\nsetTransformation( AttributeOperation, MergeOperation, ( a, b ) => {\r\n\tconst ranges = [];\r\n\r\n\t// Case 1:\r\n\t//\r\n\t// Attribute change on the merged element. In this case, the merged element was moved to the graveyard.\r\n\t// An additional attribute operation that will change the (re)moved element needs to be generated.\r\n\t//\r\n\tif ( a.range.start.hasSameParentAs( b.deletionPosition ) ) {\r\n\t\tif ( a.range.containsPosition( b.deletionPosition ) || a.range.start.isEqual( b.deletionPosition ) ) {\r\n\t\t\tranges.push( Range._createFromPositionAndShift( b.graveyardPosition, 1 ) );\r\n\t\t}\r\n\t}\r\n\r\n\tconst range = a.range._getTransformedByMergeOperation( b );\r\n\r\n\t// Do not add empty (collapsed) ranges to the result. `range` may be collapsed if it contained only the merged element.\r\n\tif ( !range.isCollapsed ) {\r\n\t\tranges.push( range );\r\n\t}\r\n\r\n\t// Create `AttributeOperation`s out of the ranges.\r\n\treturn ranges.map( range => {\r\n\t\treturn new AttributeOperation( range, a.key, a.oldValue, a.newValue, a.baseVersion );\r\n\t} );\r\n} );\r\n\r\nsetTransformation( AttributeOperation, MoveOperation, ( a, b ) => {\r\n\tconst ranges = _breakRangeByMoveOperation( a.range, b );\r\n\r\n\t// Create `AttributeOperation`s out of the ranges.\r\n\treturn ranges.map( range => new AttributeOperation( range, a.key, a.oldValue, a.newValue, a.baseVersion ) );\r\n} );\r\n\r\n// Helper function for `AttributeOperation` x `MoveOperation` transformation.\r\n//\r\n// Takes the passed `range` and transforms it by move operation `moveOp` in a specific way. Only top-level nodes of `range`\r\n// are considered to be in the range. If move operation moves nodes deep from inside of the range, those nodes won't\r\n// be included in the result. In other words, top-level nodes of the ranges from the result are exactly the same as\r\n// top-level nodes of the original `range`.\r\n//\r\n// This is important for `AttributeOperation` because, for its range, it changes only the top-level nodes. So we need to\r\n// track only how those nodes have been affected by `MoveOperation`.\r\n//\r\n// @private\r\n// @param {module:engine/model/range~Range} range\r\n// @param {module:engine/model/operation/moveoperation~MoveOperation} moveOp\r\n// @returns {Array.<module:engine/model/range~Range>}\r\nfunction _breakRangeByMoveOperation( range, moveOp ) {\r\n\tconst moveRange = Range._createFromPositionAndShift( moveOp.sourcePosition, moveOp.howMany );\r\n\r\n\t// We are transforming `range` (original range) by `moveRange` (range moved by move operation). As usual when it comes to\r\n\t// transforming a ranges, we may have a common part of the ranges and we may have a difference part (zero to two ranges).\r\n\tlet common = null;\r\n\tlet difference = [];\r\n\r\n\t// Let's compare the ranges.\r\n\tif ( moveRange.containsRange( range, true ) ) {\r\n\t\t// If the whole original range is moved, treat it whole as a common part. There's also no difference part.\r\n\t\tcommon = range;\r\n\t} else if ( range.start.hasSameParentAs( moveRange.start ) ) {\r\n\t\t// If the ranges are \"on the same level\" (in the same parent) then move operation may move exactly those nodes\r\n\t\t// that are changed by the attribute operation. In this case we get common part and difference part in the usual way.\r\n\t\tdifference = range.getDifference( moveRange );\r\n\t\tcommon = range.getIntersection( moveRange );\r\n\t} else {\r\n\t\t// In any other situation we assume that original range is different than move range, that is that move operation\r\n\t\t// moves other nodes that attribute operation change. Even if the moved range is deep inside in the original range.\r\n\t\t//\r\n\t\t// Note that this is different than in `.getIntersection` (we would get a common part in that case) and different\r\n\t\t// than `.getDifference` (we would get two ranges).\r\n\t\tdifference = [ range ];\r\n\t}\r\n\r\n\tconst result = [];\r\n\r\n\t// The default behaviour of `_getTransformedByMove` might get wrong results for difference part, though, so\r\n\t// we do it by hand.\r\n\tfor ( let diff of difference ) {\r\n\t\t// First, transform the range by removing moved nodes. Since this is a difference, this is safe, `null` won't be returned\r\n\t\t// as the range is different than the moved range.\r\n\t\tdiff = diff._getTransformedByDeletion( moveOp.sourcePosition, moveOp.howMany );\r\n\r\n\t\t// Transform also `targetPosition`.\r\n\t\tconst targetPosition = moveOp.getMovedRangeStart();\r\n\r\n\t\t// Spread the range only if moved nodes are inserted only between the top-level nodes of the `diff` range.\r\n\t\tconst spread = diff.start.hasSameParentAs( targetPosition );\r\n\r\n\t\t// Transform by insertion of moved nodes.\r\n\t\tdiff = diff._getTransformedByInsertion( targetPosition, moveOp.howMany, spread );\r\n\r\n\t\tresult.push( ...diff );\r\n\t}\r\n\r\n\t// Common part can be simply transformed by the move operation. This is because move operation will not target to\r\n\t// that common part (the operation would have to target inside its own moved range).\r\n\tif ( common ) {\r\n\t\tresult.push(\r\n\t\t\tcommon._getTransformedByMove( moveOp.sourcePosition, moveOp.targetPosition, moveOp.howMany, false )[ 0 ]\r\n\t\t);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nsetTransformation( AttributeOperation, SplitOperation, ( a, b ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Split node is the last node in `AttributeOperation#range`.\r\n\t// `AttributeOperation#range` needs to be expanded to include the new (split) node.\r\n\t//\r\n\t// Attribute `type` to be changed to `numbered` but the `listItem` is split.\r\n\t// <listItem type=\"bulleted\">foobar</listItem>\r\n\t//\r\n\t// After split:\r\n\t// <listItem type=\"bulleted\">foo</listItem><listItem type=\"bulleted\">bar</listItem>\r\n\t//\r\n\t// After attribute change:\r\n\t// <listItem type=\"numbered\">foo</listItem><listItem type=\"numbered\">foo</listItem>\r\n\t//\r\n\tif ( a.range.end.isEqual( b.insertionPosition ) ) {\r\n\t\tif ( !b.graveyardPosition ) {\r\n\t\t\ta.range.end.offset++;\r\n\t\t}\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// Split position is inside `AttributeOperation#range`, at the same level, so the nodes to change are\r\n\t// not going to make a flat range.\r\n\t//\r\n\t// Content with range-to-change and split position:\r\n\t// <p>Fo[zb^a]r</p>\r\n\t//\r\n\t// After split:\r\n\t// <p>Fozb</p><p>ar</p>\r\n\t//\r\n\t// Make two separate ranges containing all nodes to change:\r\n\t// <p>Fo[zb]</p><p>[a]r</p>\r\n\t//\r\n\tif ( a.range.start.hasSameParentAs( b.splitPosition ) && a.range.containsPosition( b.splitPosition ) ) {\r\n\t\tconst secondPart = a.clone();\r\n\r\n\t\tsecondPart.range = new Range(\r\n\t\t\tb.moveTargetPosition.clone(),\r\n\t\t\ta.range.end._getCombined( b.splitPosition, b.moveTargetPosition )\r\n\t\t);\r\n\r\n\t\ta.range.end = b.splitPosition.clone();\r\n\t\ta.range.end.stickiness = 'toPrevious';\r\n\r\n\t\treturn [ a, secondPart ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\ta.range = a.range._getTransformedBySplitOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( InsertOperation, AttributeOperation, ( a, b ) => {\r\n\tconst result = [ a ];\r\n\r\n\t// Case 1:\r\n\t//\r\n\t// The attribute operation range includes the position where nodes were inserted.\r\n\t// There are two possible scenarios: the inserted nodes were text and they should receive attributes or\r\n\t// the inserted nodes were elements and they should not receive attributes.\r\n\t//\r\n\t// This is a mirror scenario to the one described in `AttributeOperation` x `InsertOperation` transformation,\r\n\t// although this case is a little less complicated. In this case we simply need to change attributes of the\r\n\t// inserted nodes and that's it.\r\n\t//\r\n\tif ( a.shouldReceiveAttributes && a.position.hasSameParentAs( b.range.start ) && b.range.containsPosition( a.position ) ) {\r\n\t\tconst op = _getComplementaryAttributeOperations( a, b.key, b.newValue );\r\n\r\n\t\tif ( op ) {\r\n\t\t\tresult.push( op );\r\n\t\t}\r\n\t}\r\n\r\n\t// The default case is: do nothing.\r\n\t// `AttributeOperation` does not change the model tree structure so `InsertOperation` does not need to be changed.\r\n\t//\r\n\treturn result;\r\n} );\r\n\r\nsetTransformation( InsertOperation, InsertOperation, ( a, b, context ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Two insert operations insert nodes at the same position. Since they are the same, it needs to be decided\r\n\t// what will be the order of inserted nodes. However, there is no additional information to help in that\r\n\t// decision. Also, when `b` will be transformed by `a`, the same order must be maintained.\r\n\t//\r\n\t// To achieve that, we will check if the operation is strong.\r\n\t// If it is, it won't get transformed. If it is not, it will be moved.\r\n\t//\r\n\tif ( a.position.isEqual( b.position ) && context.aIsStrong ) {\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\ta.position = a.position._getTransformedByInsertOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( InsertOperation, MoveOperation, ( a, b ) => {\r\n\t// The default case.\r\n\t//\r\n\ta.position = a.position._getTransformedByMoveOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( InsertOperation, SplitOperation, ( a, b ) => {\r\n\t// The default case.\r\n\t//\r\n\ta.position = a.position._getTransformedBySplitOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( InsertOperation, MergeOperation, ( a, b ) => {\r\n\ta.position = a.position._getTransformedByMergeOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( MarkerOperation, InsertOperation, ( a, b ) => {\r\n\tif ( a.oldRange ) {\r\n\t\ta.oldRange = a.oldRange._getTransformedByInsertOperation( b )[ 0 ];\r\n\t}\r\n\r\n\tif ( a.newRange ) {\r\n\t\ta.newRange = a.newRange._getTransformedByInsertOperation( b )[ 0 ];\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MarkerOperation, MarkerOperation, ( a, b, context ) => {\r\n\tif ( a.name == b.name ) {\r\n\t\tif ( context.aIsStrong ) {\r\n\t\t\ta.oldRange = b.newRange ? b.newRange.clone() : null;\r\n\t\t} else {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MarkerOperation, MergeOperation, ( a, b ) => {\r\n\tif ( a.oldRange ) {\r\n\t\ta.oldRange = a.oldRange._getTransformedByMergeOperation( b );\r\n\t}\r\n\r\n\tif ( a.newRange ) {\r\n\t\ta.newRange = a.newRange._getTransformedByMergeOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MarkerOperation, MoveOperation, ( a, b ) => {\r\n\tif ( a.oldRange ) {\r\n\t\ta.oldRange = Range._createFromRanges( a.oldRange._getTransformedByMoveOperation( b ) );\r\n\t}\r\n\r\n\tif ( a.newRange ) {\r\n\t\ta.newRange = Range._createFromRanges( a.newRange._getTransformedByMoveOperation( b ) );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MarkerOperation, SplitOperation, ( a, b ) => {\r\n\tif ( a.oldRange ) {\r\n\t\ta.oldRange = a.oldRange._getTransformedBySplitOperation( b );\r\n\t}\r\n\r\n\tif ( a.newRange ) {\r\n\t\ta.newRange = a.newRange._getTransformedBySplitOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( MergeOperation, InsertOperation, ( a, b ) => {\r\n\tif ( a.sourcePosition.hasSameParentAs( b.position ) ) {\r\n\t\ta.howMany += b.howMany;\r\n\t}\r\n\r\n\ta.sourcePosition = a.sourcePosition._getTransformedByInsertOperation( b );\r\n\ta.targetPosition = a.targetPosition._getTransformedByInsertOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MergeOperation, MergeOperation, ( a, b, context ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Same merge operations.\r\n\t//\r\n\t// Both operations have same source and target positions. So the element already got merged and there is\r\n\t// theoretically nothing to do.\r\n\t//\r\n\tif ( a.sourcePosition.isEqual( b.sourcePosition ) && a.targetPosition.isEqual( b.targetPosition ) ) {\r\n\t\t// There are two ways that we can provide a do-nothing operation.\r\n\t\t//\r\n\t\t// First is simply a NoOperation instance. We will use it if `b` operation was not undone.\r\n\t\t//\r\n\t\t// Second is a merge operation that has the source operation in the merged element - in the graveyard -\r\n\t\t// same target position and `howMany` equal to `0`. So it is basically merging an empty element from graveyard\r\n\t\t// which is almost the same as NoOperation.\r\n\t\t//\r\n\t\t// This way the merge operation can be later transformed by split operation\r\n\t\t// to provide correct undo. This will be used if `b` operation was undone (only then it is correct).\r\n\t\t//\r\n\t\tif ( !context.bWasUndone ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t} else {\r\n\t\t\tconst path = b.graveyardPosition.path.slice();\r\n\t\t\tpath.push( 0 );\r\n\r\n\t\t\ta.sourcePosition = new Position( b.graveyardPosition.root, path );\r\n\t\t\ta.howMany = 0;\r\n\r\n\t\t\treturn [ a ];\r\n\t\t}\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// Same merge source position but different target position.\r\n\t//\r\n\t// This can happen during collaboration. For example, if one client merged a paragraph to the previous paragraph\r\n\t// and the other person removed that paragraph and merged the same paragraph to something before:\r\n\t//\r\n\t// Client A:\r\n\t// <p>Foo</p><p>Bar</p><p>[]Xyz</p>\r\n\t// <p>Foo</p><p>BarXyz</p>\r\n\t//\r\n\t// Client B:\r\n\t// <p>Foo</p>[<p>Bar</p>]<p>Xyz</p>\r\n\t// <p>Foo</p><p>[]Xyz</p>\r\n\t// <p>FooXyz</p>\r\n\t//\r\n\t// In this case we need to decide where finally \"Xyz\" will land:\r\n\t//\r\n\t// <p>FooXyz</p>               graveyard: <p>Bar</p>\r\n\t// <p>Foo</p>                  graveyard: <p>BarXyz</p>\r\n\t//\r\n\t// Let's move it in a way so that a merge operation that does not target to graveyard is more important so that\r\n\t// nodes does not end up in the graveyard. It makes sense. Both for Client A and for Client B \"Xyz\" finally did not\r\n\t// end up in the graveyard (see above).\r\n\t//\r\n\t// If neither or both operations point to graveyard, then let `aIsStrong` decide.\r\n\t//\r\n\tif (\r\n\t\ta.sourcePosition.isEqual( b.sourcePosition ) && !a.targetPosition.isEqual( b.targetPosition ) &&\r\n\t\t!context.bWasUndone && context.abRelation != 'splitAtSource'\r\n\t) {\r\n\t\tconst aToGraveyard = a.targetPosition.root.rootName == '$graveyard';\r\n\t\tconst bToGraveyard = b.targetPosition.root.rootName == '$graveyard';\r\n\r\n\t\t// If `aIsWeak` it means that `a` points to graveyard while `b` doesn't. Don't move nodes then.\r\n\t\tconst aIsWeak = aToGraveyard && !bToGraveyard;\r\n\r\n\t\t// If `bIsWeak` it means that `b` points to graveyard while `a` doesn't. Force moving nodes then.\r\n\t\tconst bIsWeak = bToGraveyard && !aToGraveyard;\r\n\r\n\t\t// Force move if `b` is weak or neither operation is weak but `a` is stronger through `context.aIsStrong`.\r\n\t\tconst forceMove = bIsWeak || ( !aIsWeak && context.aIsStrong );\r\n\r\n\t\tif ( forceMove ) {\r\n\t\t\tconst sourcePosition = b.targetPosition._getTransformedByMergeOperation( b );\r\n\t\t\tconst targetPosition = a.targetPosition._getTransformedByMergeOperation( b );\r\n\r\n\t\t\treturn [ new MoveOperation( sourcePosition, a.howMany, targetPosition, 0 ) ];\r\n\t\t} else {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tif ( a.sourcePosition.hasSameParentAs( b.targetPosition ) ) {\r\n\t\ta.howMany += b.howMany;\r\n\t}\r\n\r\n\ta.sourcePosition = a.sourcePosition._getTransformedByMergeOperation( b );\r\n\ta.targetPosition = a.targetPosition._getTransformedByMergeOperation( b );\r\n\r\n\t// Handle positions in graveyard.\r\n\t// If graveyard positions are same and `a` operation is strong - do not transform.\r\n\tif ( !a.graveyardPosition.isEqual( b.graveyardPosition ) || !context.aIsStrong ) {\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedByMergeOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MergeOperation, MoveOperation, ( a, b, context ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// The element to merge got removed.\r\n\t//\r\n\t// Merge operation does support merging elements which are not siblings. So it would not be a problem\r\n\t// from technical point of view. However, if the element was removed, the intention of the user deleting it\r\n\t// was to have it all deleted, together with its children. From user experience point of view, moving back the\r\n\t// removed nodes might be unexpected. This means that in this scenario we will block the merging.\r\n\t//\r\n\t// The exception of this rule would be if the remove operation was later undone.\r\n\t//\r\n\tconst removedRange = Range._createFromPositionAndShift( b.sourcePosition, b.howMany );\r\n\r\n\tif ( b.type == 'remove' && !context.bWasUndone ) {\r\n\t\tif ( a.deletionPosition.hasSameParentAs( b.sourcePosition ) && removedRange.containsPosition( a.sourcePosition ) ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tif ( a.sourcePosition.hasSameParentAs( b.targetPosition ) ) {\r\n\t\ta.howMany += b.howMany;\r\n\t}\r\n\r\n\tif ( a.sourcePosition.hasSameParentAs( b.sourcePosition ) ) {\r\n\t\ta.howMany -= b.howMany;\r\n\t}\r\n\r\n\ta.sourcePosition = a.sourcePosition._getTransformedByMoveOperation( b );\r\n\ta.targetPosition = a.targetPosition._getTransformedByMoveOperation( b );\r\n\r\n\t// `MergeOperation` graveyard position is like `MoveOperation` target position. It is a position where element(s) will\r\n\t// be moved. Like in other similar cases, we need to consider the scenario when those positions are same.\r\n\t// Here, we will treat `MergeOperation` like it is always strong (see `InsertOperation` x `InsertOperation` for comparison).\r\n\t// This means that we won't transform graveyard position if it is equal to move operation target position.\r\n\tif ( !a.graveyardPosition.isEqual( b.targetPosition ) ) {\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedByMoveOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MergeOperation, SplitOperation, ( a, b, context ) => {\r\n\tif ( b.graveyardPosition ) {\r\n\t\t// If `b` operation defines graveyard position, a node from graveyard will be moved. This means that we need to\r\n\t\t// transform `a.graveyardPosition` accordingly.\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedByDeletion( b.graveyardPosition, 1 );\r\n\r\n\t\t// This is a scenario foreseen in `MergeOperation` x `MergeOperation`, with two identical merge operations.\r\n\t\t//\r\n\t\t// So, there was `MergeOperation` x `MergeOperation` transformation earlier. Now, `a` is a merge operation which\r\n\t\t// source position is in graveyard. Interestingly, split operation wants to use the node to be merged by `a`. This\r\n\t\t// means that `b` is undoing that merge operation from earlier, which caused `a` to be in graveyard.\r\n\t\t//\r\n\t\t// If that's the case, at this point, we will only \"fix\" `a.howMany`. It was earlier set to `0` in\r\n\t\t// `MergeOperation` x `MergeOperation` transformation. Later transformations in this function will change other\r\n\t\t// properties.\r\n\t\t//\r\n\t\tif ( a.deletionPosition.isEqual( b.graveyardPosition ) ) {\r\n\t\t\ta.howMany = b.howMany;\r\n\t\t}\r\n\t}\r\n\r\n\t// Case 1:\r\n\t//\r\n\t// Merge operation moves nodes to the place where split happens.\r\n\t// This is a classic situation when there are two paragraphs, and there is a split (enter) after the first\r\n\t// paragraph and there is a merge (delete) at the beginning of the second paragraph:\r\n\t//\r\n\t// <p>Foo{}</p><p>[]Bar</p>.\r\n\t//\r\n\t// Split is after `Foo`, while merge is from `Bar` to the end of `Foo`.\r\n\t//\r\n\t// State after split:\r\n\t// <p>Foo</p><p></p><p>Bar</p>\r\n\t//\r\n\t// Now, `Bar` should be merged to the new paragraph:\r\n\t// <p>Foo</p><p>Bar</p>\r\n\t//\r\n\t// Instead of merging it to the original paragraph:\r\n\t// <p>FooBar</p><p></p>\r\n\t//\r\n\t// This means that `targetPosition` needs to be transformed. This is the default case though.\r\n\t// For example, if the split would be after `F`, `targetPosition` should also be transformed.\r\n\t//\r\n\t// There are three exceptions, though, when we want to keep `targetPosition` as it was.\r\n\t//\r\n\t// First exception is when the merge target position is inside an element (not at the end, as usual). This\r\n\t// happens when the merge operation earlier was transformed by \"the same\" merge operation. If merge operation\r\n\t// targets inside the element we want to keep the original target position (and not transform it) because\r\n\t// we have additional context telling us that we want to merge to the original element. We can check if the\r\n\t// merge operation points inside element by checking what is `SplitOperation#howMany`. Since merge target position\r\n\t// is same as split position, if `howMany` is non-zero, it means that the merge target position is inside an element.\r\n\t//\r\n\t// Second exception is when the element to merge is in the graveyard and split operation uses it. In that case\r\n\t// if target position would be transformed, the merge operation would target at the source position:\r\n\t//\r\n\t// root: <p>Foo</p>\t\t\t\tgraveyard: <p></p>\r\n\t//\r\n\t// SplitOperation: root [ 0, 3 ] using graveyard [ 0 ] (howMany = 0)\r\n\t// MergeOperation: graveyard [ 0, 0 ] -> root [ 0, 3 ] (howMany = 0)\r\n\t//\r\n\t// Since split operation moves the graveyard node back to the root, the merge operation source position changes.\r\n\t// We would like to merge from the empty <p> to the \"Foo\" <p>:\r\n\t//\r\n\t// root: <p>Foo</p><p></p>\t\t\tgraveyard:\r\n\t//\r\n\t// MergeOperation#sourcePosition = root [ 1, 0 ]\r\n\t//\r\n\t// If `targetPosition` is transformed, it would become root [ 1, 0 ] as well. It has to be kept as it was.\r\n\t//\r\n\t// Third exception is connected with relations. If this happens during undo and we have explicit information\r\n\t// that target position has not been affected by the operation which is undone by this split then this split should\r\n\t// not move the target position either.\r\n\t//\r\n\tif ( a.targetPosition.isEqual( b.splitPosition ) ) {\r\n\t\tconst mergeInside = b.howMany != 0;\r\n\t\tconst mergeSplittingElement = b.graveyardPosition && a.deletionPosition.isEqual( b.graveyardPosition );\r\n\r\n\t\tif ( mergeInside || mergeSplittingElement || context.abRelation == 'mergeTargetNotMoved' ) {\r\n\t\t\ta.sourcePosition = a.sourcePosition._getTransformedBySplitOperation( b );\r\n\r\n\t\t\treturn [ a ];\r\n\t\t}\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// Merge source is at the same position as split position. This sometimes happen during undo. This merge operation\r\n\t// might have been earlier transformed by a merge operation which both merged the same element. See case in\r\n\t// `MergeOperation` x `MergeOperation` transformation. In that case, if the merge operation has been undone, the special\r\n\t// case is not applied.\r\n\t//\r\n\t// In this scenario the merge operation is now transformed by the split which has undone the previous merge operation.\r\n\t// So now we are fixing situation which was skipped in `MergeOperation` x `MergeOperation` case.\r\n\t//\r\n\tif ( a.sourcePosition.isEqual( b.splitPosition ) && ( context.abRelation == 'mergeSameElement' || a.sourcePosition.offset > 0 ) ) {\r\n\t\ta.sourcePosition = b.moveTargetPosition.clone();\r\n\t\ta.targetPosition = a.targetPosition._getTransformedBySplitOperation( b );\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tif ( a.sourcePosition.hasSameParentAs( b.splitPosition ) ) {\r\n\t\ta.howMany = b.splitPosition.offset;\r\n\t}\r\n\r\n\ta.sourcePosition = a.sourcePosition._getTransformedBySplitOperation( b );\r\n\ta.targetPosition = a.targetPosition._getTransformedBySplitOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( MoveOperation, InsertOperation, ( a, b ) => {\r\n\tconst moveRange = Range._createFromPositionAndShift( a.sourcePosition, a.howMany );\r\n\tconst transformed = moveRange._getTransformedByInsertOperation( b, false )[ 0 ];\r\n\r\n\ta.sourcePosition = transformed.start;\r\n\ta.howMany = transformed.end.offset - transformed.start.offset;\r\n\r\n\t// See `InsertOperation` x `MoveOperation` transformation for details on this case.\r\n\t//\r\n\t// In summary, both operations point to the same place, so the order of nodes needs to be decided.\r\n\t// `MoveOperation` is considered weaker, so it is always transformed, unless there was a certain relation\r\n\t// between operations.\r\n\t//\r\n\tif ( !a.targetPosition.isEqual( b.position ) ) {\r\n\t\ta.targetPosition = a.targetPosition._getTransformedByInsertOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( MoveOperation, MoveOperation, ( a, b, context ) => {\r\n\t//\r\n\t// Setting and evaluating some variables that will be used in special cases and default algorithm.\r\n\t//\r\n\t// Create ranges from `MoveOperations` properties.\r\n\tconst rangeA = Range._createFromPositionAndShift( a.sourcePosition, a.howMany );\r\n\tconst rangeB = Range._createFromPositionAndShift( b.sourcePosition, b.howMany );\r\n\r\n\t// Assign `context.aIsStrong` to a different variable, because the value may change during execution of\r\n\t// this algorithm and we do not want to override original `context.aIsStrong` that will be used in later transformations.\r\n\tlet aIsStrong = context.aIsStrong;\r\n\r\n\t// This will be used to decide the order of nodes if both operations target at the same position.\r\n\t// By default, use strong/weak operation mechanism.\r\n\tlet insertBefore = !context.aIsStrong;\r\n\r\n\t// If the relation is set, then use it to decide nodes order.\r\n\tif ( context.abRelation == 'insertBefore' || context.baRelation == 'insertAfter' ) {\r\n\t\tinsertBefore = true;\r\n\t} else if ( context.abRelation == 'insertAfter' || context.baRelation == 'insertBefore' ) {\r\n\t\tinsertBefore = false;\r\n\t}\r\n\r\n\t// `a.targetPosition` could be affected by the `b` operation. We will transform it.\r\n\tlet newTargetPosition;\r\n\r\n\tif ( a.targetPosition.isEqual( b.targetPosition ) && insertBefore ) {\r\n\t\tnewTargetPosition = a.targetPosition._getTransformedByDeletion(\r\n\t\t\tb.sourcePosition,\r\n\t\t\tb.howMany\r\n\t\t);\r\n\t} else {\r\n\t\tnewTargetPosition = a.targetPosition._getTransformedByMove(\r\n\t\t\tb.sourcePosition,\r\n\t\t\tb.targetPosition,\r\n\t\t\tb.howMany\r\n\t\t);\r\n\t}\r\n\r\n\t//\r\n\t// Special case #1 + mirror.\r\n\t//\r\n\t// Special case when both move operations' target positions are inside nodes that are\r\n\t// being moved by the other move operation. So in other words, we move ranges into inside of each other.\r\n\t// This case can't be solved reasonably (on the other hand, it should not happen often).\r\n\tif ( _moveTargetIntoMovedRange( a, b ) && _moveTargetIntoMovedRange( b, a ) ) {\r\n\t\t// Instead of transforming operation, we return a reverse of the operation that we transform by.\r\n\t\t// So when the results of this \"transformation\" will be applied, `b` MoveOperation will get reversed.\r\n\t\treturn [ b.getReversed() ];\r\n\t}\r\n\t//\r\n\t// End of special case #1.\r\n\t//\r\n\r\n\t//\r\n\t// Special case #2.\r\n\t//\r\n\t// Check if `b` operation targets inside `rangeA`.\r\n\tconst bTargetsToA = rangeA.containsPosition( b.targetPosition );\r\n\r\n\t// If `b` targets to `rangeA` and `rangeA` contains `rangeB`, `b` operation has no influence on `a` operation.\r\n\t// You might say that operation `b` is captured inside operation `a`.\r\n\tif ( bTargetsToA && rangeA.containsRange( rangeB, true ) ) {\r\n\t\t// There is a mini-special case here, where `rangeB` is on other level than `rangeA`. That's why\r\n\t\t// we need to transform `a` operation anyway.\r\n\t\trangeA.start = rangeA.start._getTransformedByMove( b.sourcePosition, b.targetPosition, b.howMany );\r\n\t\trangeA.end = rangeA.end._getTransformedByMove( b.sourcePosition, b.targetPosition, b.howMany );\r\n\r\n\t\treturn _makeMoveOperationsFromRanges( [ rangeA ], newTargetPosition );\r\n\t}\r\n\r\n\t//\r\n\t// Special case #2 mirror.\r\n\t//\r\n\tconst aTargetsToB = rangeB.containsPosition( a.targetPosition );\r\n\r\n\tif ( aTargetsToB && rangeB.containsRange( rangeA, true ) ) {\r\n\t\t// `a` operation is \"moved together\" with `b` operation.\r\n\t\t// Here, just move `rangeA` \"inside\" `rangeB`.\r\n\t\trangeA.start = rangeA.start._getCombined( b.sourcePosition, b.getMovedRangeStart() );\r\n\t\trangeA.end = rangeA.end._getCombined( b.sourcePosition, b.getMovedRangeStart() );\r\n\r\n\t\treturn _makeMoveOperationsFromRanges( [ rangeA ], newTargetPosition );\r\n\t}\r\n\t//\r\n\t// End of special case #2.\r\n\t//\r\n\r\n\t//\r\n\t// Special case #3 + mirror.\r\n\t//\r\n\t// `rangeA` has a node which is an ancestor of `rangeB`. In other words, `rangeB` is inside `rangeA`\r\n\t// but not on the same tree level. In such case ranges have common part but we have to treat it\r\n\t// differently, because in such case those ranges are not really conflicting and should be treated like\r\n\t// two separate ranges. Also we have to discard two difference parts.\r\n\tconst aCompB = compareArrays( a.sourcePosition.getParentPath(), b.sourcePosition.getParentPath() );\r\n\r\n\tif ( aCompB == 'prefix' || aCompB == 'extension' ) {\r\n\t\t// Transform `rangeA` by `b` operation and make operation out of it, and that's all.\r\n\t\t// Note that this is a simplified version of default case, but here we treat the common part (whole `rangeA`)\r\n\t\t// like a one difference part.\r\n\t\trangeA.start = rangeA.start._getTransformedByMove( b.sourcePosition, b.targetPosition, b.howMany );\r\n\t\trangeA.end = rangeA.end._getTransformedByMove( b.sourcePosition, b.targetPosition, b.howMany );\r\n\r\n\t\treturn _makeMoveOperationsFromRanges( [ rangeA ], newTargetPosition );\r\n\t}\r\n\t//\r\n\t// End of special case #3.\r\n\t//\r\n\r\n\t//\r\n\t// Default case - ranges are on the same level or are not connected with each other.\r\n\t//\r\n\t// Modifier for default case.\r\n\t// Modifies `aIsStrong` flag in certain conditions.\r\n\t//\r\n\t// If only one of operations is a remove operation, we force remove operation to be the \"stronger\" one\r\n\t// to provide more expected results.\r\n\tif ( a.type == 'remove' && b.type != 'remove' && !context.aWasUndone ) {\r\n\t\taIsStrong = true;\r\n\t} else if ( a.type != 'remove' && b.type == 'remove' && !context.bWasUndone ) {\r\n\t\taIsStrong = false;\r\n\t}\r\n\r\n\t// Handle operation's source ranges - check how `rangeA` is affected by `b` operation.\r\n\t// This will aggregate transformed ranges.\r\n\tconst ranges = [];\r\n\r\n\t// Get the \"difference part\" of `a` operation source range.\r\n\t// This is an array with one or two ranges. Two ranges if `rangeB` is inside `rangeA`.\r\n\tconst difference = rangeA.getDifference( rangeB );\r\n\r\n\tfor ( const range of difference ) {\r\n\t\t// Transform those ranges by `b` operation. For example if `b` moved range from before those ranges, fix those ranges.\r\n\t\trange.start = range.start._getTransformedByDeletion( b.sourcePosition, b.howMany );\r\n\t\trange.end = range.end._getTransformedByDeletion( b.sourcePosition, b.howMany );\r\n\r\n\t\t// If `b` operation targets into `rangeA` on the same level, spread `rangeA` into two ranges.\r\n\t\tconst shouldSpread = compareArrays( range.start.getParentPath(), b.getMovedRangeStart().getParentPath() ) == 'same';\r\n\t\tconst newRanges = range._getTransformedByInsertion( b.getMovedRangeStart(), b.howMany, shouldSpread );\r\n\r\n\t\tranges.push( ...newRanges );\r\n\t}\r\n\r\n\t// Then, we have to manage the \"common part\" of both move ranges.\r\n\tconst common = rangeA.getIntersection( rangeB );\r\n\r\n\tif ( common !== null && aIsStrong ) {\r\n\t\t// Calculate the new position of that part of original range.\r\n\t\tcommon.start = common.start._getCombined( b.sourcePosition, b.getMovedRangeStart() );\r\n\t\tcommon.end = common.end._getCombined( b.sourcePosition, b.getMovedRangeStart() );\r\n\r\n\t\t// Take care of proper range order.\r\n\t\t//\r\n\t\t// Put `common` at appropriate place. Keep in mind that we are interested in original order.\r\n\t\t// Basically there are only three cases: there is zero, one or two difference ranges.\r\n\t\t//\r\n\t\t// If there is zero difference ranges, just push `common` in the array.\r\n\t\tif ( ranges.length === 0 ) {\r\n\t\t\tranges.push( common );\r\n\t\t}\r\n\t\t// If there is one difference range, we need to check whether common part was before it or after it.\r\n\t\telse if ( ranges.length == 1 ) {\r\n\t\t\tif ( rangeB.start.isBefore( rangeA.start ) || rangeB.start.isEqual( rangeA.start ) ) {\r\n\t\t\t\tranges.unshift( common );\r\n\t\t\t} else {\r\n\t\t\t\tranges.push( common );\r\n\t\t\t}\r\n\t\t}\r\n\t\t// If there are more ranges (which means two), put common part between them. This is the only scenario\r\n\t\t// where there could be two difference ranges so we don't have to make any comparisons.\r\n\t\telse {\r\n\t\t\tranges.splice( 1, 0, common );\r\n\t\t}\r\n\t}\r\n\r\n\tif ( ranges.length === 0 ) {\r\n\t\t// If there are no \"source ranges\", nothing should be changed.\r\n\t\t// Note that this can happen only if `aIsStrong == false` and `rangeA.isEqual( rangeB )`.\r\n\t\treturn [ new NoOperation( a.baseVersion ) ];\r\n\t}\r\n\r\n\treturn _makeMoveOperationsFromRanges( ranges, newTargetPosition );\r\n} );\r\n\r\nsetTransformation( MoveOperation, SplitOperation, ( a, b, context ) => {\r\n\tlet newTargetPosition = a.targetPosition.clone();\r\n\r\n\t// Do not transform if target position is same as split insertion position and this split comes from undo.\r\n\t// This should be done on relations but it is too much work for now as it would require relations working in collaboration.\r\n\t// We need to make a decision how we will resolve such conflict and this is less harmful way.\r\n\tif ( !a.targetPosition.isEqual( b.insertionPosition ) || !b.graveyardPosition || context.abRelation == 'moveTargetAfter' ) {\r\n\t\tnewTargetPosition = a.targetPosition._getTransformedBySplitOperation( b );\r\n\t}\r\n\r\n\t// Case 1:\r\n\t//\r\n\t// Last element in the moved range got split.\r\n\t//\r\n\t// In this case the default range transformation will not work correctly as the element created by\r\n\t// split operation would be outside the range. The range to move needs to be fixed manually.\r\n\t//\r\n\tconst moveRange = Range._createFromPositionAndShift( a.sourcePosition, a.howMany );\r\n\r\n\tif ( moveRange.end.isEqual( b.insertionPosition ) ) {\r\n\t\t// Do it only if this is a \"natural\" split, not a one that comes from undo.\r\n\t\t// If this is undo split, only `targetPosition` needs to be changed (if the move is a remove).\r\n\t\tif ( !b.graveyardPosition ) {\r\n\t\t\ta.howMany++;\r\n\t\t}\r\n\r\n\t\ta.targetPosition = newTargetPosition;\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// Split happened between the moved nodes. In this case two ranges to move need to be generated.\r\n\t//\r\n\t// Characters `ozba` are moved to the end of paragraph `Xyz` but split happened.\r\n\t// <p>F[oz|ba]r</p><p>Xyz</p>\r\n\t//\r\n\t// After split:\r\n\t// <p>F[oz</p><p>ba]r</p><p>Xyz</p>\r\n\t//\r\n\t// Correct ranges:\r\n\t// <p>F[oz]</p><p>[ba]r</p><p>Xyz</p>\r\n\t//\r\n\t// After move:\r\n\t// <p>F</p><p>r</p><p>Xyzozba</p>\r\n\t//\r\n\tif ( moveRange.start.hasSameParentAs( b.splitPosition ) && moveRange.containsPosition( b.splitPosition ) ) {\r\n\t\tlet rightRange = new Range( b.splitPosition, moveRange.end );\r\n\t\trightRange = rightRange._getTransformedBySplitOperation( b );\r\n\r\n\t\tconst ranges = [\r\n\t\t\tnew Range( moveRange.start, b.splitPosition ),\r\n\t\t\trightRange\r\n\t\t];\r\n\r\n\t\treturn _makeMoveOperationsFromRanges( ranges, newTargetPosition );\r\n\t}\r\n\r\n\t// Case 3:\r\n\t//\r\n\t// Move operation targets at the split position. We need to decide if the nodes should be inserted\r\n\t// at the end of the split element or at the beginning of the new element.\r\n\t//\r\n\tif ( a.targetPosition.isEqual( b.splitPosition ) && context.abRelation == 'insertAtSource' ) {\r\n\t\tnewTargetPosition = b.moveTargetPosition;\r\n\t}\r\n\r\n\t// Case 4:\r\n\t//\r\n\t// Move operation targets just after the split element. We need to decide if the nodes should be inserted\r\n\t// between two parts of split element, or after the new element.\r\n\t//\r\n\t// Split at `|`, while move operation moves `<p>Xyz</p>` and targets at `^`:\r\n\t// <p>Foo|bar</p>^<p>baz</p>\r\n\t// <p>Foo</p>^<p>bar</p><p>baz</p> or <p>Foo</p><p>bar</p>^<p>baz</p>?\r\n\t//\r\n\t// If there is no contextual information between operations (for example, they come from collaborative\r\n\t// editing), we don't want to put some unrelated content (move) between parts of related content (split parts).\r\n\t// However, if the split is from undo, in the past, the moved content might be targeting between the\r\n\t// split parts, meaning that was exactly user's intention:\r\n\t//\r\n\t// <p>Foo</p>^<p>bar</p>\t\t<--- original situation, in \"past\".\r\n\t// <p>Foobar</p>^\t\t\t\t<--- after merge target position is transformed.\r\n\t// <p>Foo|bar</p>^\t\t\t\t<--- then the merge is undone, and split happens, which leads us to current situation.\r\n\t//\r\n\t// In this case it is pretty clear that the intention was to put new paragraph between those nodes,\r\n\t// so we need to transform accordingly. We can detect this scenario thanks to relations.\r\n\t//\r\n\tif ( a.targetPosition.isEqual( b.insertionPosition ) && context.abRelation == 'insertBetween' ) {\r\n\t\tnewTargetPosition = a.targetPosition;\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tconst transformed = moveRange._getTransformedBySplitOperation( b );\r\n\tconst ranges = [ transformed ];\r\n\r\n\t// Case 5:\r\n\t//\r\n\t// Moved range contains graveyard element used by split operation. Add extra move operation to the result.\r\n\t//\r\n\tif ( b.graveyardPosition ) {\r\n\t\tconst movesGraveyardElement = moveRange.start.isEqual( b.graveyardPosition ) || moveRange.containsPosition( b.graveyardPosition );\r\n\r\n\t\tif ( a.howMany > 1 && movesGraveyardElement ) {\r\n\t\t\tranges.push( Range._createFromPositionAndShift( b.insertionPosition, 1 ) );\r\n\t\t}\r\n\t}\r\n\r\n\treturn _makeMoveOperationsFromRanges( ranges, newTargetPosition );\r\n} );\r\n\r\nsetTransformation( MoveOperation, MergeOperation, ( a, b, context ) => {\r\n\tconst movedRange = Range._createFromPositionAndShift( a.sourcePosition, a.howMany );\r\n\r\n\tif ( b.deletionPosition.hasSameParentAs( a.sourcePosition ) && movedRange.containsPosition( b.sourcePosition ) ) {\r\n\t\tif ( a.type == 'remove' ) {\r\n\t\t\t// Case 1:\r\n\t\t\t//\r\n\t\t\t// The element to remove got merged.\r\n\t\t\t//\r\n\t\t\t// Merge operation does support merging elements which are not siblings. So it would not be a problem\r\n\t\t\t// from technical point of view. However, if the element was removed, the intention of the user\r\n\t\t\t// deleting it was to have it all deleted. From user experience point of view, moving back the\r\n\t\t\t// removed nodes might be unexpected. This means that in this scenario we will reverse merging and remove the element.\r\n\t\t\t//\r\n\t\t\tif ( !context.aWasUndone ) {\r\n\t\t\t\tconst results = [];\r\n\r\n\t\t\t\tlet gyMoveSource = b.graveyardPosition.clone();\r\n\t\t\t\tlet splitNodesMoveSource = b.targetPosition.clone();\r\n\r\n\t\t\t\tif ( a.howMany > 1 ) {\r\n\t\t\t\t\tresults.push( new MoveOperation( a.sourcePosition, a.howMany - 1, a.targetPosition, 0 ) );\r\n\t\t\t\t\tgyMoveSource = gyMoveSource._getTransformedByInsertion( a.targetPosition, a.howMany - 1 );\r\n\t\t\t\t\tsplitNodesMoveSource = splitNodesMoveSource._getTransformedByMove( a.sourcePosition, a.targetPosition, a.howMany - 1 );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst gyMoveTarget = b.deletionPosition._getCombined( a.sourcePosition, a.targetPosition );\r\n\t\t\t\tconst gyMove = new MoveOperation( gyMoveSource, 1, gyMoveTarget, 0 );\r\n\r\n\t\t\t\tconst targetPositionPath = gyMove.getMovedRangeStart().path.slice();\r\n\t\t\t\ttargetPositionPath.push( 0 );\r\n\r\n\t\t\t\tconst splitNodesMoveTarget = new Position( gyMove.targetPosition.root, targetPositionPath );\r\n\t\t\t\tconst splitNodesMove = new MoveOperation( splitNodesMoveSource, b.howMany, splitNodesMoveTarget, 0 );\r\n\r\n\t\t\t\tresults.push( gyMove );\r\n\t\t\t\tresults.push( splitNodesMove );\r\n\r\n\t\t\t\treturn results;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Case 2:\r\n\t\t\t//\r\n\t\t\t// The element to move got merged and it was the only element to move.\r\n\t\t\t// In this case just don't do anything, leave the node in the graveyard. Without special case\r\n\t\t\t// it would be a move operation that moves 0 nodes, so maybe it is better just to return no-op.\r\n\t\t\t//\r\n\t\t\tif ( a.howMany == 1 ) {\r\n\t\t\t\tif ( !context.bWasUndone ) {\r\n\t\t\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta.sourcePosition = b.graveyardPosition.clone();\r\n\t\t\t\t\ta.targetPosition = a.targetPosition._getTransformedByMergeOperation( b );\r\n\r\n\t\t\t\t\treturn [ a ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tconst moveRange = Range._createFromPositionAndShift( a.sourcePosition, a.howMany );\r\n\tconst transformed = moveRange._getTransformedByMergeOperation( b );\r\n\r\n\ta.sourcePosition = transformed.start;\r\n\ta.howMany = transformed.end.offset - transformed.start.offset;\r\n\ta.targetPosition = a.targetPosition._getTransformedByMergeOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( RenameOperation, InsertOperation, ( a, b ) => {\r\n\ta.position = a.position._getTransformedByInsertOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( RenameOperation, MergeOperation, ( a, b ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Element to rename got merged, so it was moved to `b.graveyardPosition`.\r\n\t//\r\n\tif ( a.position.isEqual( b.deletionPosition ) ) {\r\n\t\ta.position = b.graveyardPosition.clone();\r\n\t\ta.position.stickiness = 'toNext';\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\ta.position = a.position._getTransformedByMergeOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( RenameOperation, MoveOperation, ( a, b ) => {\r\n\ta.position = a.position._getTransformedByMoveOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( RenameOperation, RenameOperation, ( a, b, context ) => {\r\n\tif ( a.position.isEqual( b.position ) ) {\r\n\t\tif ( context.aIsStrong ) {\r\n\t\t\ta.oldName = b.newName;\r\n\t\t} else {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( RenameOperation, SplitOperation, ( a, b ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// The element to rename has been split. In this case, the new element should be also renamed.\r\n\t//\r\n\t// User decides to change the paragraph to a list item:\r\n\t// <paragraph>Foobar</paragraph>\r\n\t//\r\n\t// However, in meantime, split happens:\r\n\t// <paragraph>Foo</paragraph><paragraph>bar</paragraph>\r\n\t//\r\n\t// As a result, rename both elements:\r\n\t// <listItem>Foo</listItem><listItem>bar</listItem>\r\n\t//\r\n\tconst renamePath = a.position.path;\r\n\tconst splitPath = b.splitPosition.getParentPath();\r\n\r\n\tif ( compareArrays( renamePath, splitPath ) == 'same' && !b.graveyardPosition ) {\r\n\t\tconst extraRename = new RenameOperation( a.position.getShiftedBy( 1 ), a.oldName, a.newName, 0 );\r\n\r\n\t\treturn [ a, extraRename ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\ta.position = a.position._getTransformedBySplitOperation( b );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( RootAttributeOperation, RootAttributeOperation, ( a, b, context ) => {\r\n\tif ( a.root === b.root && a.key === b.key ) {\r\n\t\tif ( !context.aIsStrong || a.newValue === b.newValue ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t} else {\r\n\t\t\ta.oldValue = b.newValue;\r\n\t\t}\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// -----------------------\r\n\r\nsetTransformation( SplitOperation, InsertOperation, ( a, b ) => {\r\n\t// The default case.\r\n\t//\r\n\tif ( a.splitPosition.hasSameParentAs( b.position ) && a.splitPosition.offset < b.position.offset ) {\r\n\t\ta.howMany += b.howMany;\r\n\t}\r\n\r\n\ta.splitPosition = a.splitPosition._getTransformedByInsertOperation( b );\r\n\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( SplitOperation, MergeOperation, ( a, b, context ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Split element got merged. If two different elements were merged, clients will have different content.\r\n\t//\r\n\t// Example. Merge at `{}`, split at `[]`:\r\n\t// <heading>Foo</heading>{}<paragraph>B[]ar</paragraph>\r\n\t//\r\n\t// On merge side it will look like this:\r\n\t// <heading>FooB[]ar</heading>\r\n\t// <heading>FooB</heading><heading>ar</heading>\r\n\t//\r\n\t// On split side it will look like this:\r\n\t// <heading>Foo</heading>{}<paragraph>B</paragraph><paragraph>ar</paragraph>\r\n\t// <heading>FooB</heading><paragraph>ar</paragraph>\r\n\t//\r\n\t// Clearly, the second element is different for both clients.\r\n\t//\r\n\t// We could use the removed merge element from graveyard as a split element but then clients would have a different\r\n\t// model state (in graveyard), because the split side client would still have an element in graveyard (removed by merge).\r\n\t//\r\n\t// To overcome this, in `SplitOperation` x `MergeOperation` transformation we will add additional `SplitOperation`\r\n\t// in the graveyard, which will actually clone the merged-and-deleted element. Then, that cloned element will be\r\n\t// used for splitting. Example below.\r\n\t//\r\n\t// Original state:\r\n\t// <heading>Foo</heading>{}<paragraph>B[]ar</paragraph>\r\n\t//\r\n\t// Merge side client:\r\n\t//\r\n\t// After merge:\r\n\t// <heading>FooB[]ar</heading>                                 graveyard: <paragraph></paragraph>\r\n\t//\r\n\t// Extra split:\r\n\t// <heading>FooB[]ar</heading>                                 graveyard: <paragraph></paragraph><paragraph></paragraph>\r\n\t//\r\n\t// Use the \"cloned\" element from graveyard:\r\n\t// <heading>FooB</heading><paragraph>ar</paragraph>            graveyard: <paragraph></paragraph>\r\n\t//\r\n\t// Split side client:\r\n\t//\r\n\t// After split:\r\n\t// <heading>Foo</heading>{}<paragraph>B</paragraph><paragraph>ar</paragraph>\r\n\t//\r\n\t// After merge:\r\n\t// <heading>FooB</heading><paragraph>ar</paragraph>            graveyard: <paragraph></paragraph>\r\n\t//\r\n\t// This special case scenario only applies if the original split operation clones the split element.\r\n\t// If the original split operation has `graveyardPosition` set, it all doesn't have sense because split operation\r\n\t// knows exactly which element it should use. So there would be no original problem with different contents.\r\n\t//\r\n\t// Additionally, the special case applies only if the merge wasn't already undone.\r\n\t//\r\n\tif ( !a.graveyardPosition && !context.bWasUndone && a.splitPosition.hasSameParentAs( b.sourcePosition ) ) {\r\n\t\tconst splitPath = b.graveyardPosition.path.slice();\r\n\t\tsplitPath.push( 0 );\r\n\r\n\t\tconst splitPosition = new Position( b.graveyardPosition.root, splitPath );\r\n\t\tconst insertionPosition = SplitOperation.getInsertionPosition( new Position( b.graveyardPosition.root, splitPath ) );\r\n\r\n\t\tconst additionalSplit = new SplitOperation( splitPosition, 0, null, 0 );\r\n\t\tadditionalSplit.insertionPosition = insertionPosition;\r\n\r\n\t\ta.splitPosition = a.splitPosition._getTransformedByMergeOperation( b );\r\n\t\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\t\ta.graveyardPosition = additionalSplit.insertionPosition.clone();\r\n\t\ta.graveyardPosition.stickiness = 'toNext';\r\n\r\n\t\treturn [ additionalSplit, a ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tif ( a.splitPosition.hasSameParentAs( b.deletionPosition ) && !a.splitPosition.isAfter( b.deletionPosition ) ) {\r\n\t\ta.howMany--;\r\n\t}\r\n\r\n\tif ( a.splitPosition.hasSameParentAs( b.targetPosition ) ) {\r\n\t\ta.howMany += b.howMany;\r\n\t}\r\n\r\n\ta.splitPosition = a.splitPosition._getTransformedByMergeOperation( b );\r\n\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\r\n\tif ( a.graveyardPosition ) {\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedByMergeOperation( b );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( SplitOperation, MoveOperation, ( a, b, context ) => {\r\n\tconst rangeToMove = Range._createFromPositionAndShift( b.sourcePosition, b.howMany );\r\n\r\n\tif ( a.graveyardPosition ) {\r\n\t\t// Case 1:\r\n\t\t//\r\n\t\t// Split operation graveyard node was moved. In this case move operation is stronger. Since graveyard element\r\n\t\t// is already moved to the correct position, we need to only move the nodes after the split position.\r\n\t\t// This will be done by `MoveOperation` instead of `SplitOperation`.\r\n\t\t//\r\n\t\tif ( rangeToMove.start.isEqual( a.graveyardPosition ) || rangeToMove.containsPosition( a.graveyardPosition ) ) {\r\n\t\t\tconst sourcePosition = a.splitPosition._getTransformedByMoveOperation( b );\r\n\r\n\t\t\tconst newParentPosition = a.graveyardPosition._getTransformedByMoveOperation( b );\r\n\t\t\tconst newTargetPath = newParentPosition.path.slice();\r\n\t\t\tnewTargetPath.push( 0 );\r\n\r\n\t\t\tconst newTargetPosition = new Position( newParentPosition.root, newTargetPath );\r\n\t\t\tconst moveOp = new MoveOperation( sourcePosition, a.howMany, newTargetPosition, 0 );\r\n\r\n\t\t\treturn [ moveOp ];\r\n\t\t}\r\n\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedByMoveOperation( b );\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// If the split position is inside the moved range, we need to shift the split position to a proper place.\r\n\t// The position cannot be moved together with moved range because that would result in splitting of an incorrect element.\r\n\t//\r\n\t// Characters `bc` should be moved to the second paragraph while split position is between them:\r\n\t// <paragraph>A[b|c]d</paragraph><paragraph>Xyz</paragraph>\r\n\t//\r\n\t// After move, new split position is incorrect:\r\n\t// <paragraph>Ad</paragraph><paragraph>Xb|cyz</paragraph>\r\n\t//\r\n\t// Correct split position:\r\n\t// <paragraph>A|d</paragraph><paragraph>Xbcyz</paragraph>\r\n\t//\r\n\t// After split:\r\n\t// <paragraph>A</paragraph><paragraph>d</paragraph><paragraph>Xbcyz</paragraph>\r\n\t//\r\n\tif ( a.splitPosition.hasSameParentAs( b.sourcePosition ) && rangeToMove.containsPosition( a.splitPosition ) ) {\r\n\t\tconst howManyRemoved = b.howMany - ( a.splitPosition.offset - b.sourcePosition.offset );\r\n\t\ta.howMany -= howManyRemoved;\r\n\r\n\t\tif ( a.splitPosition.hasSameParentAs( b.targetPosition ) && a.splitPosition.offset < b.targetPosition.offset ) {\r\n\t\t\ta.howMany += b.howMany;\r\n\t\t}\r\n\r\n\t\ta.splitPosition = b.sourcePosition.clone();\r\n\t\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// Case 3:\r\n\t//\r\n\t// Split is at a position where nodes were moved.\r\n\t//\r\n\t// This is a scenario described in `MoveOperation` x `SplitOperation` transformation but from the\r\n\t// \"split operation point of view\".\r\n\t//\r\n\tconst splitAtTarget = a.splitPosition.isEqual( b.targetPosition );\r\n\r\n\tif ( splitAtTarget && ( context.baRelation == 'insertAtSource' || context.abRelation == 'splitBefore' ) ) {\r\n\t\ta.howMany += b.howMany;\r\n\t\ta.splitPosition = a.splitPosition._getTransformedByDeletion( b.sourcePosition, b.howMany );\r\n\t\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t// Don't change `howMany` if move operation does not really move anything.\r\n\t//\r\n\tif ( !b.sourcePosition.isEqual( b.targetPosition ) ) {\r\n\t\tif ( a.splitPosition.hasSameParentAs( b.sourcePosition ) && a.splitPosition.offset <= b.sourcePosition.offset ) {\r\n\t\t\ta.howMany -= b.howMany;\r\n\t\t}\r\n\r\n\t\tif ( a.splitPosition.hasSameParentAs( b.targetPosition ) && a.splitPosition.offset < b.targetPosition.offset ) {\r\n\t\t\ta.howMany += b.howMany;\r\n\t\t}\r\n\t}\r\n\r\n\t// Change position stickiness to force a correct transformation.\r\n\ta.splitPosition.stickiness = 'toNone';\r\n\ta.splitPosition = a.splitPosition._getTransformedByMoveOperation( b );\r\n\ta.splitPosition.stickiness = 'toNext';\r\n\r\n\tif ( a.graveyardPosition ) {\r\n\t\ta.insertionPosition = a.insertionPosition._getTransformedByMoveOperation( b );\r\n\t} else {\r\n\t\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\t}\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\nsetTransformation( SplitOperation, SplitOperation, ( a, b, context ) => {\r\n\t// Case 1:\r\n\t//\r\n\t// Split at the same position.\r\n\t//\r\n\t// If there already was a split at the same position as in `a` operation, it means that the intention\r\n\t// conveyed by `a` operation has already been fulfilled and `a` should not do anything (to avoid double split).\r\n\t//\r\n\t// However, there is a difference if these are new splits or splits created by undo. These have different\r\n\t// intentions. Also splits moving back different elements from graveyard have different intentions. They\r\n\t// are just different operations.\r\n\t//\r\n\t// So we cancel split operation only if it was really identical.\r\n\t//\r\n\tif ( a.splitPosition.isEqual( b.splitPosition ) ) {\r\n\t\tif ( !a.graveyardPosition && !b.graveyardPosition ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\r\n\t\tif ( a.graveyardPosition && b.graveyardPosition && a.graveyardPosition.isEqual( b.graveyardPosition ) ) {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\t// Case 2:\r\n\t//\r\n\t// Same node is using to split different elements. This happens in undo when previously same element was merged to\r\n\t// two different elements. This is described in `MergeOperation` x `MergeOperation` transformation.\r\n\t//\r\n\t// In this case we will follow the same logic. We will assume that `insertionPosition` is same for both\r\n\t// split operations. This might not always be true but in the real cases that were experienced it was. After all,\r\n\t// if these splits are reverses of merge operations that were merging the same element, then the `insertionPosition`\r\n\t// should be same for both of those splits.\r\n\t//\r\n\t// Again, we will decide which operation is stronger by checking if split happens in graveyard or in non-graveyard root.\r\n\t//\r\n\tif ( a.graveyardPosition && b.graveyardPosition && a.graveyardPosition.isEqual( b.graveyardPosition ) ) {\r\n\t\tconst aInGraveyard = a.splitPosition.root.rootName == '$graveyard';\r\n\t\tconst bInGraveyard = b.splitPosition.root.rootName == '$graveyard';\r\n\r\n\t\t// If `aIsWeak` it means that `a` points to graveyard while `b` doesn't. Don't move nodes then.\r\n\t\tconst aIsWeak = aInGraveyard && !bInGraveyard;\r\n\r\n\t\t// If `bIsWeak` it means that `b` points to graveyard while `a` doesn't. Force moving nodes then.\r\n\t\tconst bIsWeak = bInGraveyard && !aInGraveyard;\r\n\r\n\t\t// Force move if `b` is weak or neither operation is weak but `a` is stronger through `context.aIsStrong`.\r\n\t\tconst forceMove = bIsWeak || ( !aIsWeak && context.aIsStrong );\r\n\r\n\t\tif ( forceMove ) {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\t// First we need to move any nodes split by `b` back to where they were.\r\n\t\t\t// Do it only if `b` actually moved something.\r\n\t\t\tif ( b.howMany ) {\r\n\t\t\t\tresult.push( new MoveOperation( b.moveTargetPosition, b.howMany, b.splitPosition, 0 ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Then we need to move nodes from `a` split position to their new element.\r\n\t\t\t// Do it only if `a` actually should move something.\r\n\t\t\tif ( a.howMany ) {\r\n\t\t\t\tresult.push( new MoveOperation( a.splitPosition, a.howMany, a.moveTargetPosition, 0 ) );\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn [ new NoOperation( 0 ) ];\r\n\t\t}\r\n\t}\r\n\r\n\tif ( a.graveyardPosition ) {\r\n\t\ta.graveyardPosition = a.graveyardPosition._getTransformedBySplitOperation( b );\r\n\t}\r\n\r\n\t// Case 3:\r\n\t//\r\n\t// Position where operation `b` inserted a new node after split is the same as the operation `a` split position.\r\n\t// As in similar cases, there is ambiguity if the split should be before the new node (created by `b`) or after.\r\n\t//\r\n\tif ( a.splitPosition.isEqual( b.insertionPosition ) && context.abRelation == 'splitBefore' ) {\r\n\t\ta.howMany++;\r\n\r\n\t\treturn [ a ];\r\n\t}\r\n\r\n\t// Case 4:\r\n\t//\r\n\t// This is a mirror to the case 2. above.\r\n\t//\r\n\tif ( b.splitPosition.isEqual( a.insertionPosition ) && context.baRelation == 'splitBefore' ) {\r\n\t\tconst newPositionPath = b.insertionPosition.path.slice();\r\n\t\tnewPositionPath.push( 0 );\r\n\r\n\t\tconst newPosition = new Position( b.insertionPosition.root, newPositionPath );\r\n\t\tconst moveOp = new MoveOperation( a.insertionPosition, 1, newPosition, 0 );\r\n\r\n\t\treturn [ a, moveOp ];\r\n\t}\r\n\r\n\t// The default case.\r\n\t//\r\n\tif ( a.splitPosition.hasSameParentAs( b.splitPosition ) && a.splitPosition.offset < b.splitPosition.offset ) {\r\n\t\ta.howMany -= b.howMany;\r\n\t}\r\n\r\n\ta.splitPosition = a.splitPosition._getTransformedBySplitOperation( b );\r\n\ta.insertionPosition = SplitOperation.getInsertionPosition( a.splitPosition );\r\n\r\n\treturn [ a ];\r\n} );\r\n\r\n// Checks whether `MoveOperation` `targetPosition` is inside a node from the moved range of the other `MoveOperation`.\r\n//\r\n// @private\r\n// @param {module:engine/model/operation/moveoperation~MoveOperation} a\r\n// @param {module:engine/model/operation/moveoperation~MoveOperation} b\r\n// @returns {Boolean}\r\nfunction _moveTargetIntoMovedRange( a, b ) {\r\n\treturn a.targetPosition._getTransformedByDeletion( b.sourcePosition, b.howMany ) === null;\r\n}\r\n\r\n// Helper function for `MoveOperation` x `MoveOperation` transformation. Converts given ranges and target position to\r\n// move operations and returns them.\r\n//\r\n// Ranges and target position will be transformed on-the-fly when generating operations.\r\n//\r\n// Given `ranges` should be in the order of how they were in the original transformed operation.\r\n//\r\n// Given `targetPosition` is the target position of the first range from `ranges`.\r\n//\r\n// @private\r\n// @param {Array.<module:engine/model/range~Range>} ranges\r\n// @param {module:engine/model/position~Position} targetPosition\r\n// @returns {Array.<module:engine/model/operation/moveoperation~MoveOperation>}\r\nfunction _makeMoveOperationsFromRanges( ranges, targetPosition ) {\r\n\t// At this moment we have some ranges and a target position, to which those ranges should be moved.\r\n\t// Order in `ranges` array is the go-to order of after transformation.\r\n\t//\r\n\t// We are almost done. We have `ranges` and `targetPosition` to make operations from.\r\n\t// Unfortunately, those operations may affect each other. Precisely, first operation after move\r\n\t// may affect source range and target position of second and third operation. Same with second\r\n\t// operation affecting third.\r\n\t//\r\n\t// We need to fix those source ranges and target positions once again, before converting `ranges` to operations.\r\n\tconst operations = [];\r\n\r\n\t// Keep in mind that nothing will be transformed if there is just one range in `ranges`.\r\n\tfor ( let i = 0; i < ranges.length; i++ ) {\r\n\t\t// Create new operation out of a range and target position.\r\n\t\tconst range = ranges[ i ];\r\n\t\tconst op = new MoveOperation(\r\n\t\t\trange.start,\r\n\t\t\trange.end.offset - range.start.offset,\r\n\t\t\t// If the target is the end of the move range this operation doesn't really move anything.\r\n\t\t\t// In this case, it is better for OT to use range start instead of range end.\r\n\t\t\ttargetPosition.isEqual( range.end ) ? range.start : targetPosition,\r\n\t\t\t0\r\n\t\t);\r\n\r\n\t\toperations.push( op );\r\n\r\n\t\t// Transform other ranges by the generated operation.\r\n\t\tfor ( let j = i + 1; j < ranges.length; j++ ) {\r\n\t\t\t// All ranges in `ranges` array should be:\r\n\t\t\t//\r\n\t\t\t// * non-intersecting (these are part of original operation source range), and\r\n\t\t\t// * `targetPosition` does not target into them (opposite would mean that transformed operation targets \"inside itself\").\r\n\t\t\t//\r\n\t\t\t// This means that the transformation will be \"clean\" and always return one result.\r\n\t\t\tranges[ j ] = ranges[ j ]._getTransformedByMove( op.sourcePosition, op.targetPosition, op.howMany )[ 0 ];\r\n\t\t}\r\n\r\n\t\ttargetPosition = targetPosition._getTransformedByMove( op.sourcePosition, op.targetPosition, op.howMany );\r\n\t}\r\n\r\n\treturn operations;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module undo/basecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { transformSets } from '@ckeditor/ckeditor5-engine/src/model/operation/transform';\r\n\r\n/**\r\n * Base class for undo feature commands: {@link module:undo/undocommand~UndoCommand} and {@link module:undo/redocommand~RedoCommand}.\r\n *\r\n * @protected\r\n * @extends module:core/command~Command\r\n */\r\nexport default class BaseCommand extends Command {\r\n\tconstructor( editor ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * Stack of items stored by the command. These are pairs of:\r\n\t\t *\r\n\t\t * * {@link module:engine/model/batch~Batch batch} saved by the command,\r\n\t\t * * {@link module:engine/model/selection~Selection selection} state at the moment of saving the batch.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Array} #_stack\r\n\t\t */\r\n\t\tthis._stack = [];\r\n\r\n\t\t/**\r\n\t\t * Stores all batches that were created by this command.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {WeakSet.<module:engine/model/batch~Batch>} #_createdBatches\r\n\t\t */\r\n\t\tthis._createdBatches = new WeakSet();\r\n\r\n\t\t// Refresh state, so the command is inactive right after initialization.\r\n\t\tthis.refresh();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = this._stack.length > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Stores a batch in the command, together with the selection state of the {@link module:engine/model/document~Document document}\r\n\t * created by the editor which this command is registered to.\r\n\t *\r\n\t * @param {module:engine/model/batch~Batch} batch The batch to add.\r\n\t */\r\n\taddBatch( batch ) {\r\n\t\tconst docSelection = this.editor.model.document.selection;\r\n\r\n\t\tconst selection = {\r\n\t\t\tranges: docSelection.hasOwnRange ? Array.from( docSelection.getRanges() ) : [],\r\n\t\t\tisBackward: docSelection.isBackward\r\n\t\t};\r\n\r\n\t\tthis._stack.push( { batch, selection } );\r\n\t\tthis.refresh();\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all items from the stack.\r\n\t */\r\n\tclearStack() {\r\n\t\tthis._stack = [];\r\n\t\tthis.refresh();\r\n\t}\r\n\r\n\t/**\r\n\t * Restores the {@link module:engine/model/document~Document#selection document selection} state after a batch was undone.\r\n\t *\r\n\t * @protected\r\n\t * @param {Array.<module:engine/model/range~Range>} ranges Ranges to be restored.\r\n\t * @param {Boolean} isBackward A flag describing whether the restored range was selected forward or backward.\r\n\t * @param {Array.<module:engine/model/operation/operation~Operation>} operations Operations which has been applied\r\n\t * since selection has been stored.\r\n\t */\r\n\t_restoreSelection( ranges, isBackward, operations ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\r\n\t\t// This will keep the transformed selection ranges.\r\n\t\tconst selectionRanges = [];\r\n\r\n\t\t// Transform all ranges from the restored selection.\r\n\t\tfor ( const range of ranges ) {\r\n\t\t\tconst transformed = transformSelectionRange( range, operations );\r\n\r\n\t\t\t// For each `range` from `ranges`, we take only one transformed range.\r\n\t\t\t// This is because we want to prevent situation where single-range selection\r\n\t\t\t// got transformed to multi-range selection. We will take the first range that\r\n\t\t\t// is not in the graveyard.\r\n\t\t\tconst newRange = transformed.find(\r\n\t\t\t\trange => range.start.root != document.graveyard\r\n\t\t\t);\r\n\r\n\t\t\t// `transformedRange` might be `undefined` if transformed range ended up in graveyard.\r\n\t\t\tif ( newRange ) {\r\n\t\t\t\tselectionRanges.push( newRange );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// `selectionRanges` may be empty if all ranges ended up in graveyard. If that is the case, do not restore selection.\r\n\t\tif ( selectionRanges.length ) {\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\twriter.setSelection( selectionRanges, { backward: isBackward } );\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Undoes a batch by reversing that batch, transforming reversed batch and finally applying it.\r\n\t * This is a helper method for {@link #execute}.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/batch~Batch} batchToUndo The batch to be undone.\r\n\t * @param {module:engine/model/batch~Batch} undoingBatch The batch that will contain undoing changes.\r\n\t */\r\n\t_undo( batchToUndo, undoingBatch ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\r\n\t\t// All changes done by the command execution will be saved as one batch.\r\n\t\tthis._createdBatches.add( undoingBatch );\r\n\r\n\t\tconst operationsToUndo = batchToUndo.operations.slice().filter( operation => operation.isDocumentOperation );\r\n\t\toperationsToUndo.reverse();\r\n\r\n\t\t// We will process each operation from `batchToUndo`, in reverse order. If there were operations A, B and C in undone batch,\r\n\t\t// we need to revert them in reverse order, so first C' (reversed C), then B', then A'.\r\n\t\tfor ( const operationToUndo of operationsToUndo ) {\r\n\t\t\tconst nextBaseVersion = operationToUndo.baseVersion + 1;\r\n\t\t\tconst historyOperations = Array.from( document.history.getOperations( nextBaseVersion ) );\r\n\r\n\t\t\tconst transformedSets = transformSets(\r\n\t\t\t\t[ operationToUndo.getReversed() ],\r\n\t\t\t\thistoryOperations,\r\n\t\t\t\t{\r\n\t\t\t\t\tuseRelations: true,\r\n\t\t\t\t\tdocument: this.editor.model.document,\r\n\t\t\t\t\tpadWithNoOps: false\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tconst reversedOperations = transformedSets.operationsA;\r\n\r\n\t\t\t// After reversed operation has been transformed by all history operations, apply it.\r\n\t\t\tfor ( const operation of reversedOperations ) {\r\n\t\t\t\t// Before applying, add the operation to the `undoingBatch`.\r\n\t\t\t\tundoingBatch.addOperation( operation );\r\n\t\t\t\tmodel.applyOperation( operation );\r\n\r\n\t\t\t\tdocument.history.setOperationAsUndone( operationToUndo, operation );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Transforms given range `range` by given `operations`.\r\n// Returns an array containing one or more ranges, which are result of the transformation.\r\nfunction transformSelectionRange( range, operations ) {\r\n\tconst transformed = range.getTransformedByOperations( operations );\r\n\r\n\t// After `range` got transformed, we have an array of ranges. Some of those\r\n\t// ranges may be \"touching\" -- they can be next to each other and could be merged.\r\n\t// First, we have to sort those ranges to assure that they are in order.\r\n\ttransformed.sort( ( a, b ) => a.start.isBefore( b.start ) ? -1 : 1 );\r\n\r\n\t// Then, we check if two consecutive ranges are touching.\r\n\tfor ( let i = 1; i < transformed.length; i++ ) {\r\n\t\tconst a = transformed[ i - 1 ];\r\n\t\tconst b = transformed[ i ];\r\n\r\n\t\tif ( a.end.isTouching( b.start ) ) {\r\n\t\t\t// And join them together if they are.\r\n\t\t\ta.end = b.end;\r\n\t\t\ttransformed.splice( i, 1 );\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n\r\n\treturn transformed;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module undo/undocommand\r\n */\r\n\r\nimport BaseCommand from './basecommand';\r\n\r\n/**\r\n * The undo command stores {@link module:engine/model/batch~Batch batches} applied to the\r\n * {@link module:engine/model/document~Document document} and is able to undo a batch by reversing it and transforming by\r\n * batches from {@link module:engine/model/document~Document#history history} that happened after the reversed batch.\r\n *\r\n * The undo command also takes care of restoring the {@link module:engine/model/document~Document#selection document selection}.\r\n *\r\n * @extends module:undo/basecommand~BaseCommand\r\n */\r\nexport default class UndoCommand extends BaseCommand {\r\n\t/**\r\n\t * Executes the command. This method reverts a {@link module:engine/model/batch~Batch batch} added to the command's stack, transforms\r\n\t * and applies the reverted version on the {@link module:engine/model/document~Document document} and removes the batch from the stack.\r\n\t * Then, it restores the {@link module:engine/model/document~Document#selection document selection}.\r\n\t *\r\n\t * @fires execute\r\n\t * @fires revert\r\n\t * @param {module:engine/model/batch~Batch} [batch] A batch that should be undone. If not set, the last added batch will be undone.\r\n\t */\r\n\texecute( batch = null ) {\r\n\t\t// If batch is not given, set `batchIndex` to the last index in command stack.\r\n\t\tconst batchIndex = batch ? this._stack.findIndex( a => a.batch == batch ) : this._stack.length - 1;\r\n\r\n\t\tconst item = this._stack.splice( batchIndex, 1 )[ 0 ];\r\n\t\tconst undoingBatch = this.editor.model.createBatch();\r\n\r\n\t\t// All changes has to be done in one `enqueueChange` callback so other listeners will not\r\n\t\t// step between consecutive operations, or won't do changes to the document before selection is properly restored.\r\n\t\tthis.editor.model.enqueueChange( undoingBatch, () => {\r\n\t\t\tthis._undo( item.batch, undoingBatch );\r\n\r\n\t\t\tconst operations = this.editor.model.document.history.getOperations( item.batch.baseVersion );\r\n\t\t\tthis._restoreSelection( item.selection.ranges, item.selection.isBackward, operations );\r\n\r\n\t\t\tthis.fire( 'revert', item.batch, undoingBatch );\r\n\t\t} );\r\n\r\n\t\tthis.refresh();\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when execution of the command reverts some batch.\r\n *\r\n * @event revert\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module undo/redocommand\r\n */\r\n\r\nimport BaseCommand from './basecommand';\r\n\r\n/**\r\n * The redo command stores {@link module:engine/model/batch~Batch batches} that were used to undo a batch by\r\n * {@link module:undo/undocommand~UndoCommand}. It is able to redo a previously undone batch by reversing the undoing\r\n * batches created by `UndoCommand`. The reversed batch is transformed by all the batches from\r\n * {@link module:engine/model/document~Document#history history} that happened after the reversed undo batch.\r\n *\r\n * The redo command also takes care of restoring the {@link module:engine/model/document~Document#selection document selection}.\r\n *\r\n * @extends module:undo/basecommand~BaseCommand\r\n */\r\nexport default class RedoCommand extends BaseCommand {\r\n\t/**\r\n\t * Executes the command. This method reverts the last {@link module:engine/model/batch~Batch batch} added to\r\n\t * the command's stack, applies the reverted and transformed version on the\r\n\t * {@link module:engine/model/document~Document document} and removes the batch from the stack.\r\n\t * Then, it restores the {@link module:engine/model/document~Document#selection document selection}.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst item = this._stack.pop();\r\n\t\tconst redoingBatch = this.editor.model.createBatch();\r\n\r\n\t\t// All changes have to be done in one `enqueueChange` callback so other listeners will not step between consecutive\r\n\t\t// operations, or won't do changes to the document before selection is properly restored.\r\n\t\tthis.editor.model.enqueueChange( redoingBatch, () => {\r\n\t\t\tconst lastOperation = item.batch.operations[ item.batch.operations.length - 1 ];\r\n\t\t\tconst nextBaseVersion = lastOperation.baseVersion + 1;\r\n\t\t\tconst operations = this.editor.model.document.history.getOperations( nextBaseVersion );\r\n\r\n\t\t\tthis._restoreSelection( item.selection.ranges, item.selection.isBackward, operations );\r\n\t\t\tthis._undo( item.batch, redoingBatch );\r\n\t\t} );\r\n\r\n\t\tthis.refresh();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module undo/undoediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport UndoCommand from './undocommand';\r\nimport RedoCommand from './redocommand';\r\n\r\n/**\r\n * The undo engine feature.\r\n *\r\n * It introduces the `'undo'` and `'redo'` commands to the editor.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class UndoEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The command that manages undo {@link module:engine/model/batch~Batch batches} stack (history).\r\n\t\t * Created and registered during the {@link #init feature initialization}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:undo/undocommand~UndoCommand} #_undoCommand\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The command that manages redo {@link module:engine/model/batch~Batch batches} stack (history).\r\n\t\t * Created and registered during the {@link #init feature initialization}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:undo/undocommand~UndoCommand} #_redoCommand\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Keeps track of which batches were registered in undo.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {WeakSet.<module:engine/model/batch~Batch>}\r\n\t\t */\r\n\t\tthis._batchRegistry = new WeakSet();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// Create commands.\r\n\t\tthis._undoCommand = new UndoCommand( editor );\r\n\t\tthis._redoCommand = new RedoCommand( editor );\r\n\r\n\t\t// Register command to the editor.\r\n\t\teditor.commands.add( 'undo', this._undoCommand );\r\n\t\teditor.commands.add( 'redo', this._redoCommand );\r\n\r\n\t\tthis.listenTo( editor.model, 'applyOperation', ( evt, args ) => {\r\n\t\t\tconst operation = args[ 0 ];\r\n\r\n\t\t\t// Do not register batch if the operation is not a document operation.\r\n\t\t\t// This prevents from creating empty undo steps, where all operations where non-document operations.\r\n\t\t\t// Non-document operations creates and alters content in detached tree fragments (for example, document fragments).\r\n\t\t\t// Most of time this is preparing data before it is inserted into actual tree (for example during copy & paste).\r\n\t\t\t// Such operations should not be reversed.\r\n\t\t\tif ( !operation.isDocumentOperation ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst batch = operation.batch;\r\n\r\n\t\t\t// If changes are not a part of a batch or this is not a new batch, omit those changes.\r\n\t\t\tif ( this._batchRegistry.has( batch ) || batch.type == 'transparent' ) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tif ( this._redoCommand._createdBatches.has( batch ) ) {\r\n\t\t\t\t\t// If this batch comes from `redoCommand`, add it to `undoCommand` stack.\r\n\t\t\t\t\tthis._undoCommand.addBatch( batch );\r\n\t\t\t\t} else if ( !this._undoCommand._createdBatches.has( batch ) ) {\r\n\t\t\t\t\t// A default batch - these are new changes in the document, not introduced by undo feature.\r\n\t\t\t\t\t// Add them to `undoCommand` stack and clear `redoCommand` stack.\r\n\t\t\t\t\tthis._undoCommand.addBatch( batch );\r\n\t\t\t\t\tthis._redoCommand.clearStack();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add the batch to the registry so it will not be processed again.\r\n\t\t\tthis._batchRegistry.add( batch );\r\n\t\t}, { priority: 'highest' } );\r\n\r\n\t\tthis.listenTo( this._undoCommand, 'revert', ( evt, undoneBatch, undoingBatch ) => {\r\n\t\t\tthis._redoCommand.addBatch( undoingBatch );\r\n\t\t} );\r\n\r\n\t\teditor.keystrokes.set( 'CTRL+Z', 'undo' );\r\n\t\teditor.keystrokes.set( 'CTRL+Y', 'redo' );\r\n\t\teditor.keystrokes.set( 'CTRL+SHIFT+Z', 'redo' );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* global DOMParser */\r\n\r\n/**\r\n * @module ui/icon/iconview\r\n */\r\n\r\nimport View from '../view';\r\n\r\nimport '../../theme/components/icon/icon.css';\r\n\r\n/**\r\n * The icon view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class IconView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * The SVG source of the icon.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #content\r\n\t\t */\r\n\t\tthis.set( 'content', '' );\r\n\r\n\t\t/**\r\n\t\t * This attribute specifies the boundaries to which the\r\n\t\t * icon content should stretch.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default '0 0 20 20'\r\n\t\t * @member {String} #viewBox\r\n\t\t */\r\n\t\tthis.set( 'viewBox', '0 0 20 20' );\r\n\r\n\t\t/**\r\n\t\t * The fill color of the child `path.ck-icon__fill`.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default ''\r\n\t\t * @member {String} #fillColor\r\n\t\t */\r\n\t\tthis.set( 'fillColor', '' );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'svg',\r\n\t\t\tns: 'http://www.w3.org/2000/svg',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-icon'\r\n\t\t\t\t],\r\n\t\t\t\tviewBox: bind.to( 'viewBox' )\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tthis._updateXMLContent();\r\n\t\tthis._colorFillPaths();\r\n\r\n\t\t// This is a hack for lack of innerHTML binding.\r\n\t\t// See: https://github.com/ckeditor/ckeditor5-ui/issues/99.\r\n\t\tthis.on( 'change:content', () => {\r\n\t\t\tthis._updateXMLContent();\r\n\t\t\tthis._colorFillPaths();\r\n\t\t} );\r\n\r\n\t\tthis.on( 'change:fillColor', () => {\r\n\t\t\tthis._colorFillPaths();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the {@link #element} with the value of {@link #content}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_updateXMLContent() {\r\n\t\tif ( this.content ) {\r\n\t\t\tconst parsed = new DOMParser().parseFromString( this.content.trim(), 'image/svg+xml' );\r\n\t\t\tconst svg = parsed.querySelector( 'svg' );\r\n\t\t\tconst viewBox = svg.getAttribute( 'viewBox' );\r\n\r\n\t\t\tif ( viewBox ) {\r\n\t\t\t\tthis.viewBox = viewBox;\r\n\t\t\t}\r\n\r\n\t\t\tthis.element.innerHTML = '';\r\n\r\n\t\t\twhile ( svg.childNodes.length > 0 ) {\r\n\t\t\t\tthis.element.appendChild( svg.childNodes[ 0 ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Fills all child `path.ck-icon__fill` with the `#fillColor`.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_colorFillPaths() {\r\n\t\tif ( this.fillColor ) {\r\n\t\t\tthis.element.querySelectorAll( '.ck-icon__fill' ).forEach( path => {\r\n\t\t\t\tpath.style.fill = this.fillColor;\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/tooltip/tooltipview\r\n */\r\n\r\nimport View from '../view';\r\n\r\nimport '../../theme/components/tooltip/tooltip.css';\r\n\r\n/**\r\n * The tooltip view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class TooltipView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * The text of the tooltip visible to the user.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #text\r\n\t\t */\r\n\t\tthis.set( 'text', '' );\r\n\r\n\t\t/**\r\n\t\t * The position of the tooltip (south or north).\r\n\t\t *\r\n\t\t *\t\t+-----------+\r\n\t\t *\t\t|   north   |\r\n\t\t *\t\t+-----------+\r\n\t\t *\t\t      V\r\n\t\t *\t\t  [element]\r\n\t\t *\r\n\t\t *\t\t  [element]\r\n\t\t *\t\t      ^\r\n\t\t *\t\t+-----------+\r\n\t\t *\t\t|   south   |\r\n\t\t *\t\t+-----------+\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 's'\r\n\t\t * @member {'s'|'n'} #position\r\n\t\t */\r\n\t\tthis.set( 'position', 's' );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'span',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-tooltip',\r\n\t\t\t\t\tbind.to( 'position', position => 'ck-tooltip_' + position ),\r\n\t\t\t\t\tbind.if( 'text', 'ck-hidden', value => !value.trim() )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'span',\r\n\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: [\r\n\t\t\t\t\t\t\t'ck',\r\n\t\t\t\t\t\t\t'ck-tooltip__text'\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: bind.to( 'text' ),\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/button/buttonview\r\n */\r\n\r\nimport View from '../view';\r\nimport IconView from '../icon/iconview';\r\nimport TooltipView from '../tooltip/tooltipview';\r\n\r\nimport uid from '@ckeditor/ckeditor5-utils/src/uid';\r\nimport { getEnvKeystrokeText } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\nimport '../../theme/components/button/button.css';\r\n\r\n/**\r\n * The button view class.\r\n *\r\n *\t\tconst view = new ButtonView();\r\n *\r\n *\t\tview.set( {\r\n *\t\t\tlabel: 'A button',\r\n *\t\t\tkeystroke: 'Ctrl+B',\r\n *\t\t\ttooltip: true,\r\n *\t\t\twithText: true\r\n *\t\t} );\r\n *\r\n *\t\tview.render();\r\n *\r\n *\t\tdocument.body.append( view.element );\r\n *\r\n * @extends module:ui/view~View\r\n * @implements module:ui/button/button~Button\r\n */\r\nexport default class ButtonView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\t\tconst ariaLabelUid = uid();\r\n\r\n\t\t// Implement the Button interface.\r\n\t\tthis.set( 'class' );\r\n\t\tthis.set( 'labelStyle' );\r\n\t\tthis.set( 'icon' );\r\n\t\tthis.set( 'isEnabled', true );\r\n\t\tthis.set( 'isOn', false );\r\n\t\tthis.set( 'isVisible', true );\r\n\t\tthis.set( 'keystroke' );\r\n\t\tthis.set( 'label' );\r\n\t\tthis.set( 'tabindex', -1 );\r\n\t\tthis.set( 'tooltip' );\r\n\t\tthis.set( 'tooltipPosition', 's' );\r\n\t\tthis.set( 'type', 'button' );\r\n\t\tthis.set( 'withText', false );\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views inside of the button {@link #element}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.children = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * Tooltip of the button view. It is configurable using the {@link #tooltip tooltip attribute}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/tooltip/tooltipview~TooltipView} #tooltipView\r\n\t\t */\r\n\t\tthis.tooltipView = this._createTooltipView();\r\n\r\n\t\t/**\r\n\t\t * Label of the button view. It is configurable using the {@link #label label attribute}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/view~View} #labelView\r\n\t\t */\r\n\t\tthis.labelView = this._createLabelView( ariaLabelUid );\r\n\r\n\t\t/**\r\n\t\t * The icon view of the button. Will be added to {@link #children} when the\r\n\t\t * {@link #icon icon attribute} is defined.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/icon/iconview~IconView} #iconView\r\n\t\t */\r\n\t\tthis.iconView = new IconView();\r\n\r\n\t\tthis.iconView.extendTemplate( {\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: 'ck-button__icon'\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * Tooltip of the button bound to the template.\r\n\t\t *\r\n\t\t * @see #tooltip\r\n\t\t * @see #_getTooltipString\r\n\t\t * @private\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #_tooltipString\r\n\t\t */\r\n\t\tthis.bind( '_tooltipString' ).to(\r\n\t\t\tthis, 'tooltip',\r\n\t\t\tthis, 'label',\r\n\t\t\tthis, 'keystroke',\r\n\t\t\tthis._getTooltipString.bind( this )\r\n\t\t);\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'button',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-button',\r\n\t\t\t\t\tbind.to( 'class' ),\r\n\t\t\t\t\tbind.if( 'isEnabled', 'ck-disabled', value => !value ),\r\n\t\t\t\t\tbind.if( 'isVisible', 'ck-hidden', value => !value ),\r\n\t\t\t\t\tbind.to( 'isOn', value => value ? 'ck-on' : 'ck-off' ),\r\n\t\t\t\t\tbind.if( 'withText', 'ck-button_with-text' )\r\n\t\t\t\t],\r\n\t\t\t\ttype: bind.to( 'type', value => value ? value : 'button' ),\r\n\t\t\t\ttabindex: bind.to( 'tabindex' ),\r\n\t\t\t\t'aria-labelledby': `ck-editor__aria-label_${ ariaLabelUid }`,\r\n\t\t\t\t'aria-disabled': bind.if( 'isEnabled', true, value => !value ),\r\n\t\t\t\t'aria-pressed': bind.if( 'isOn', true )\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.children,\r\n\r\n\t\t\ton: {\r\n\t\t\t\tmousedown: bind.to( evt => {\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t} ),\r\n\r\n\t\t\t\tclick: bind.to( evt => {\r\n\t\t\t\t\t// We can't make the button disabled using the disabled attribute, because it won't be focusable.\r\n\t\t\t\t\t// Though, shouldn't this condition be moved to the button controller?\r\n\t\t\t\t\tif ( this.isEnabled ) {\r\n\t\t\t\t\t\tthis.fire( 'execute' );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Prevent the default when button is disabled, to block e.g.\r\n\t\t\t\t\t\t// automatic form submitting. See ckeditor/ckeditor5-link#74.\r\n\t\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t} )\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tif ( this.icon ) {\r\n\t\t\tthis.iconView.bind( 'content' ).to( this, 'icon' );\r\n\t\t\tthis.children.add( this.iconView );\r\n\t\t}\r\n\r\n\t\tthis.children.add( this.tooltipView );\r\n\t\tthis.children.add( this.labelView );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #element} of the button.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.element.focus();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:ui/tooltip/tooltipview~TooltipView} instance and binds it with button\r\n\t * attributes.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/tooltip/tooltipview~TooltipView}\r\n\t */\r\n\t_createTooltipView() {\r\n\t\tconst tooltipView = new TooltipView();\r\n\r\n\t\ttooltipView.bind( 'text' ).to( this, '_tooltipString' );\r\n\t\ttooltipView.bind( 'position' ).to( this, 'tooltipPosition' );\r\n\r\n\t\treturn tooltipView;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a label view instance and binds it with button attributes.\r\n\t *\r\n\t * @private\r\n\t * @param {String} ariaLabelUid The aria label UID.\r\n\t * @returns {module:ui/view~View}\r\n\t */\r\n\t_createLabelView( ariaLabelUid ) {\r\n\t\tconst labelView = new View();\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tlabelView.setTemplate( {\r\n\t\t\ttag: 'span',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-button__label'\r\n\t\t\t\t],\r\n\t\t\t\tstyle: bind.to( 'labelStyle' ),\r\n\t\t\t\tid: `ck-editor__aria-label_${ ariaLabelUid }`,\r\n\t\t\t},\r\n\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: this.bindTemplate.to( 'label' )\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\treturn labelView;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the text for the {@link #tooltipView} from the combination of\r\n\t * {@link #tooltip}, {@link #label} and {@link #keystroke} attributes.\r\n\t *\r\n\t * @private\r\n\t * @see #tooltip\r\n\t * @see #_tooltipString\r\n\t * @param {Boolean|String|Function} tooltip Button tooltip.\r\n\t * @param {String} label Button label.\r\n\t * @param {String} keystroke Button keystroke.\r\n\t * @returns {String}\r\n\t */\r\n\t_getTooltipString( tooltip, label, keystroke ) {\r\n\t\tif ( tooltip ) {\r\n\t\t\tif ( typeof tooltip == 'string' ) {\r\n\t\t\t\treturn tooltip;\r\n\t\t\t} else {\r\n\t\t\t\tif ( keystroke ) {\r\n\t\t\t\t\tkeystroke = getEnvKeystrokeText( keystroke );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( tooltip instanceof Function ) {\r\n\t\t\t\t\treturn tooltip( label, keystroke );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn `${ label }${ keystroke ? ` (${ keystroke })` : '' }`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module undo/undoui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport undoIcon from '../theme/icons/undo.svg';\nimport redoIcon from '../theme/icons/redo.svg';\n/**\r\n * The undo UI feature. It introduces the `'undo'` and `'redo'` buttons to the editor.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class UndoUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        this._addButton('undo', t('az'), 'CTRL+Z', undoIcon);\n        this._addButton('redo', t('ba'), 'CTRL+Y', redoIcon);\n    }\n    /**\r\n\t * Creates a button for the specified command.\r\n\t *\r\n\t * @private\r\n\t * @param {String} name Command name.\r\n\t * @param {String} label Button label.\r\n\t * @param {String} keystroke Command keystroke.\r\n\t * @param {String} Icon Source of the icon.\r\n\t */\n    _addButton(name, label, keystroke, Icon) {\n        const editor = this.editor;\n        editor.ui.componentFactory.add(name, locale => {\n            const command = editor.commands.get(name);\n            const view = new ButtonView(locale);\n            view.set({\n                label,\n                icon: Icon,\n                keystroke,\n                tooltip: true\n            });\n            view.bind('isEnabled').to(command, 'isEnabled');\n            this.listenTo(view, 'execute', () => editor.execute(name));\n            return view;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module undo/undo\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport UndoEditing from './undoediting';\r\nimport UndoUI from './undoui';\r\n\r\n/**\r\n * The undo feature.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:undo/undoediting~UndoEditing undo editing feature}\r\n * and {@link module:undo/undoui~UndoUI undo UI feature}.\r\n *\r\n * Below is the explanation of the undo mechanism working together with {@link module:engine/model/history~History History}:\r\n *\r\n * Whenever a {@link module:engine/model/operation/operation~Operation operation} is applied to the\r\n * {@link module:engine/model/document~Document document}, it is saved to `History` as is.\r\n * The {@link module:engine/model/batch~Batch batch} that owns that operation is also saved, in\r\n * {@link module:undo/undocommand~UndoCommand}, together with the selection that was present in the document before the\r\n * operation was applied. A batch is saved instead of the operation because changes are undone batch-by-batch, not operation-by-operation\r\n * and a batch is seen as one undo step.\r\n *\r\n * After some changes happen to the document, the `History` and `UndoCommand` stack can be represented as follows:\r\n *\r\n *\t\t    History                            Undo stack\r\n *\t\t==============             ==================================\r\n *\t\t[operation A1]                         [batch A]\r\n *\t\t[operation B1]                         [batch B]\r\n *\t\t[operation B2]                         [batch C]\r\n *\t\t[operation C1]\r\n *\t\t[operation C2]\r\n *\t\t[operation B3]\r\n *\t\t[operation C3]\r\n *\r\n * Where operations starting with the same letter are from same batch.\r\n *\r\n * Undoing a batch means that a set of operations which will reverse the effects of that batch needs to be generated.\r\n * For example, if a batch added several letters, undoing the batch should remove them. It is important to apply undoing\r\n * operations in the reversed order, so if a batch has operation `X`, `Y`, `Z`, reversed operations `Zr`, `Yr` and `Xr`\r\n * need to be applied. Otherwise reversed operation `Xr` would operate on a wrong document state, because operation `X`\r\n * does not know that operations `Y` and `Z` happened.\r\n *\r\n * After operations from an undone batch got {@link module:engine/model/operation/operation~Operation#getReversed reversed},\r\n * one needs to make sure if they are ready to be applied. In the scenario above, operation `C3` is the last operation and `C3r`\r\n * bases on up-to-date document state, so it can be applied to the document.\r\n *\r\n *\t\t     History                             Undo stack\r\n *\t\t=================             ==================================\r\n *\t\t[ operation A1  ]                      [  batch A  ]\r\n *\t\t[ operation B1  ]                      [  batch B  ]\r\n *\t\t[ operation B2  ]             [   processing undoing batch C   ]\r\n *\t\t[ operation C1  ]\r\n *\t\t[ operation C2  ]\r\n *\t\t[ operation B3  ]\r\n *\t\t[ operation C3  ]\r\n *\t\t[ operation C3r ]\r\n *\r\n * Next is operation `C2`, reversed to `C2r`. `C2r` bases on `C2`, so it bases on the wrong document state. It needs to be\r\n * transformed by operations from history that happened after it, so it \"knows\" about them. Let us assume that `C2' = C2r * B3 * C3 * C3r`,\r\n * where `*` means \"transformed by\". Rest of operations from that batch are processed in the same fashion.\r\n *\r\n *\t\t     History                             Undo stack                                      Redo stack\r\n *\t\t=================             ==================================             ==================================\r\n *\t\t[ operation A1  ]                      [  batch A  ]                                    [ batch Cr ]\r\n *\t\t[ operation B1  ]                      [  batch B  ]\r\n *\t\t[ operation B2  ]\r\n *\t\t[ operation C1  ]\r\n *\t\t[ operation C2  ]\r\n *\t\t[ operation B3  ]\r\n *\t\t[ operation C3  ]\r\n *\t\t[ operation C3r ]\r\n *\t\t[ operation C2' ]\r\n *\t\t[ operation C1' ]\r\n *\r\n * Selective undo works on the same basis, however, instead of undoing the last batch in the undo stack, any batch can be undone.\r\n * The same algorithm applies: operations from a batch (i.e. `A1`) are reversed and then transformed by operations stored in history.\r\n *\r\n * Redo also is very similar to undo. It has its own stack that is filled with undoing (reversed batches). Operations from\r\n * batch that is re-done are reversed-back, transformed in proper order and applied to the document.\r\n *\r\n *\t\t     History                             Undo stack                                      Redo stack\r\n *\t\t=================             ==================================             ==================================\r\n *\t\t[ operation A1  ]                      [  batch A  ]\r\n *\t\t[ operation B1  ]                      [  batch B  ]\r\n *\t\t[ operation B2  ]                      [ batch Crr ]\r\n *\t\t[ operation C1  ]\r\n *\t\t[ operation C2  ]\r\n *\t\t[ operation B3  ]\r\n *\t\t[ operation C3  ]\r\n *\t\t[ operation C3r ]\r\n *\t\t[ operation C2' ]\r\n *\t\t[ operation C1' ]\r\n *\t\t[ operation C1'r]\r\n *\t\t[ operation C2'r]\r\n *\t\t[ operation C3rr]\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Undo extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ UndoEditing, UndoUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Undo';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module core/pendingactions\r\n */\r\n\r\nimport Plugin from './plugin';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * The list of pending editor actions.\r\n *\r\n * This plugin should be used to synchronise plugins that execute long-lasting actions\r\n * (e.g. file upload) with the editor integration. It gives the developer who integrates the editor\r\n * an easy way to check if there are any actions pending whenever such information is needed.\r\n * All plugins that register a pending action also provide a message about the action that is ongoing\r\n * which can be displayed to the user. This lets them decide if they want to interrupt the action or wait.\r\n *\r\n * Adding and updating a pending action:\r\n *\r\n * \t\tconst pendingActions = editor.plugins.get( 'PendingActions' );\r\n * \t\tconst action = pendingActions.add( 'Upload in progress: 0%.' );\r\n *\r\n *\t\t// You can update the message:\r\n * \t\taction.message = 'Upload in progress: 10%.';\r\n *\r\n * Removing a pending action:\r\n *\r\n * \t\tconst pendingActions = editor.plugins.get( 'PendingActions' );\r\n * \t\tconst action = pendingActions.add( 'Unsaved changes.' );\r\n *\r\n * \t\tpendingActions.remove( action );\r\n *\r\n * Getting pending actions:\r\n *\r\n * \t\tconst pendingActions = editor.plugins.get( 'PendingActions' );\r\n *\r\n * \t\tconst action1 = pendingActions.add( 'Action 1' );\r\n * \t\tconst action2 = pendingActions.add( 'Action 2' );\r\n *\r\n * \t\tpendingActions.first; // Returns action1\r\n * \t\tArray.from( pendingActions ); // Returns [ action1, action2 ]\r\n *\r\n * This plugin is used by features like {@link module:upload/filerepository~FileRepository} to register their ongoing actions\r\n * and by features like {@link module:autosave/autosave~Autosave} to detect whether there are any ongoing actions.\r\n * Read more about saving the data in the {@glink builds/guides/integration/saving-data Saving and getting data} guide.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class PendingActions extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'PendingActions';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\t/**\r\n\t\t * Defines whether there is any registered pending action.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #hasAny\r\n\t\t */\r\n\t\tthis.set( 'hasAny', false );\r\n\r\n\t\t/**\r\n\t\t * A list of pending actions.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {module:utils/collection~Collection}\r\n\t\t */\r\n\t\tthis._actions = new Collection( { idProperty: '_id' } );\r\n\t\tthis._actions.delegate( 'add', 'remove' ).to( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an action to the list of pending actions.\r\n\t *\r\n\t * This method returns an action object with an observable message property.\r\n\t * The action object can be later used in the {@link #remove} method. It also allows you to change the message.\r\n\t *\r\n\t * @param {String} message The action message.\r\n\t * @returns {Object} An observable object that represents a pending action.\r\n\t */\r\n\tadd( message ) {\r\n\t\tif ( typeof message !== 'string' ) {\r\n\t\t\t/**\r\n\t\t\t * The message must be a string.\r\n\t\t\t *\r\n\t\t\t * @error pendingactions-add-invalid-message\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'pendingactions-add-invalid-message: The message must be a string.' );\r\n\t\t}\r\n\r\n\t\tconst action = Object.create( ObservableMixin );\r\n\r\n\t\taction.set( 'message', message );\r\n\t\tthis._actions.add( action );\r\n\t\tthis.hasAny = true;\r\n\r\n\t\treturn action;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an action from the list of pending actions.\r\n\t *\r\n\t * @param {Object} action An action object.\r\n\t */\r\n\tremove( action ) {\r\n\t\tthis._actions.remove( action );\r\n\t\tthis.hasAny = !!this._actions.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first action from the list or null when list is empty\r\n\t *\r\n\t * returns {Object|null} The pending action object.\r\n\t */\r\n\tget first() {\r\n\t\treturn this._actions.get( 0 );\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * @returns {Iterable.<*>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this._actions[ Symbol.iterator ]();\r\n\t}\r\n\r\n\t/**\r\n\t * Fired when an action is added to the list.\r\n\t *\r\n\t * @event add\r\n\t * @param {Object} action The added action.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when an action is removed from the list.\r\n\t *\r\n\t * @event remove\r\n\t * @param {Object} action The removed action.\r\n\t */\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module upload/filereader\r\n */\r\n\r\n/* globals window */\r\n\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Wrapper over the native `FileReader`.\r\n */\r\nexport default class FileReader {\r\n\t/**\r\n\t * Creates an instance of the FileReader.\r\n\t */\r\n\tconstructor() {\r\n\t\tconst reader = new window.FileReader();\r\n\r\n\t\t/**\r\n\t\t * Instance of native FileReader.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {FileReader} #_reader\r\n\t\t */\r\n\t\tthis._reader = reader;\r\n\r\n\t\t/**\r\n\t\t * Number of bytes loaded.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number} #loaded\r\n\t\t */\r\n\t\tthis.set( 'loaded', 0 );\r\n\r\n\t\treader.onprogress = evt => {\r\n\t\t\tthis.loaded = evt.loaded;\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns error that occurred during file reading.\r\n\t *\r\n\t * @returns {Error}\r\n\t */\r\n\tget error() {\r\n\t\treturn this._reader.error;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the provided file.\r\n\t *\r\n\t * @param {File} file Native File object.\r\n\t * @returns {Promise} Returns a promise that will be resolved with file's content.\r\n\t * The promise will be rejected in case of an error or when the reading process is aborted.\r\n\t */\r\n\tread( file ) {\r\n\t\tconst reader = this._reader;\r\n\t\tthis.total = file.size;\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\t\t\treader.onload = () => {\r\n\t\t\t\tresolve( reader.result );\r\n\t\t\t};\r\n\r\n\t\t\treader.onerror = () => {\r\n\t\t\t\treject( 'error' );\r\n\t\t\t};\r\n\r\n\t\t\treader.onabort = () => {\r\n\t\t\t\treject( 'aborted' );\r\n\t\t\t};\r\n\r\n\t\t\tthis._reader.readAsDataURL( file );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Aborts file reader.\r\n\t */\r\n\tabort() {\r\n\t\tthis._reader.abort();\r\n\t}\r\n}\r\n\r\nmix( FileReader, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module upload/filerepository\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport PendingActions from '@ckeditor/ckeditor5-core/src/pendingactions';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport log from '@ckeditor/ckeditor5-utils/src/log';\nimport FileReader from './filereader.js';\nimport uid from '@ckeditor/ckeditor5-utils/src/uid.js';\n/**\r\n * File repository plugin. A central point for managing file upload.\r\n *\r\n * To use it, first you need an upload adapter. Upload adapter's job is to handle communication with the server\r\n * (sending the file and handling server's response). You can use one of the existing plugins introducing upload adapters\r\n * (e.g. {@link module:easy-image/cloudservicesuploadadapter~CloudServicesUploadAdapter} or\r\n * {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter}) or write your own one – see\r\n * the {@glink framework/guides/deep-dive/upload-adapter \"Custom image upload adpter\" deep dive guide}.\r\n *\r\n * Then, you can use {@link module:upload/filerepository~FileRepository#createLoader `createLoader()`} and the returned\r\n * {@link module:upload/filerepository~FileLoader} instance to load and upload files.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class FileRepository extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get pluginName() {\n        return 'FileRepository';\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [PendingActions];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        /**\r\n\t\t * Collection of loaders associated with this repository.\r\n\t\t *\r\n\t\t * @member {module:utils/collection~Collection} #loaders\r\n\t\t */\n        this.loaders = new Collection();\n        // Keeps upload in a sync with pending actions.\n        this.loaders.on('add', () => this._updatePendingAction());\n        this.loaders.on('remove', () => this._updatePendingAction());\n        /**\r\n\t\t * Reference to a pending action registered in a {@link module:core/pendingactions~PendingActions} plugin\r\n\t\t * while upload is in progress. When there is no upload then value is `null`.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Object} #_pendingAction\r\n\t\t */\n        this._pendingAction = null;\n        /**\r\n\t\t * A factory function which should be defined before using `FileRepository`.\r\n\t\t *\r\n\t\t * It should return a new instance of {@link module:upload/filerepository~UploadAdapter} that will be used to upload files.\r\n\t\t * {@link module:upload/filerepository~FileLoader} instance associated with the adapter\r\n\t\t * will be passed to that function.\r\n\t\t *\r\n\t\t * For more information and example see {@link module:upload/filerepository~UploadAdapter}.\r\n\t\t *\r\n\t\t * @member {Function} #createUploadAdapter\r\n\t\t */\n        /**\r\n\t\t * Number of bytes uploaded.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number} #uploaded\r\n\t\t */\n        this.set('uploaded', 0);\n        /**\r\n\t\t * Number of total bytes to upload.\r\n\t\t *\r\n\t\t * It might be different than the file size because of headers and additional data.\r\n\t\t * It contains `null` if value is not available yet, so it's better to use {@link #uploadedPercent} to monitor\r\n\t\t * the progress.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number|null} #uploadTotal\r\n\t\t */\n        this.set('uploadTotal', null);\n        /**\r\n\t\t * Upload progress in percents.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number} #uploadedPercent\r\n\t\t */\n        this.bind('uploadedPercent').to(this, 'uploaded', this, 'uploadTotal', (uploaded, total) => {\n            return total ? uploaded / total * 100 : 0;\n        });\n    }\n    /**\r\n\t * Returns the loader associated with specified file.\r\n\t *\r\n\t * To get loader by id use `fileRepository.loaders.get( id )`.\r\n\t *\r\n\t * @param {File} file Native file handle.\r\n\t * @returns {module:upload/filerepository~FileLoader|null}\r\n\t */\n    getLoader(file) {\n        for (const loader of this.loaders) {\n            if (loader.file == file) {\n                return loader;\n            }\n        }\n        return null;\n    }\n    /**\r\n\t * Creates a loader instance for the given file.\r\n\t *\r\n\t * Requires {@link #createUploadAdapter} factory to be defined.\r\n\t *\r\n\t * @param {File} file Native File object.\r\n\t * @returns {module:upload/filerepository~FileLoader|null}\r\n\t */\n    createLoader(file) {\n        if (!this.createUploadAdapter) {\n            /**\r\n\t\t\t * You need to enable an upload adapter in order to be able to upload files.\r\n\t\t\t *\r\n\t\t\t * This warning shows up when {@link module:upload/filerepository~FileRepository} is being used\r\n\t\t\t * without {@link #createUploadAdapter definining an upload adapter}.\r\n\t\t\t *\r\n\t\t\t * **If you see this warning when using one of the {@glink builds/index CKEditor 5 Builds}**\r\n\t\t\t * it means that you did not configure any of the upload adapters available by default in those builds.\r\n\t\t\t *\r\n\t\t\t * See the {@glink features/image-upload comprehensive \"Image upload\" guide} to learn which upload\r\n\t\t\t * adapters are available in the builds and how to configure them.\r\n\t\t\t *\r\n\t\t\t * **If you see this warning when using a custom build** there is a chance that you enabled\r\n\t\t\t * a feature like {@link module:image/imageupload~ImageUpload},\r\n\t\t\t * or {@link module:image/imageupload/imageuploadui~ImageUploadUI} but you did not enable any upload adapter.\r\n\t\t\t * You can choose one of the existing upload adapters listed in the\r\n\t\t\t * {@glink features/image-upload \"Image upload\" guide}.\r\n\t\t\t *\r\n\t\t\t * You can also implement your {@glink framework/guides/deep-dive/upload-adapter own upload adapter}.\r\n\t\t\t *\r\n\t\t\t * @error filerepository-no-upload-adapter\r\n\t\t\t */\n            log.error('filerepository-no-upload-adapter: Upload adapter is not defined.');\n            return null;\n        }\n        const loader = new FileLoader(file);\n        loader._adapter = this.createUploadAdapter(loader);\n        this.loaders.add(loader);\n        loader.on('change:uploaded', () => {\n            let aggregatedUploaded = 0;\n            for (const loader of this.loaders) {\n                aggregatedUploaded += loader.uploaded;\n            }\n            this.uploaded = aggregatedUploaded;\n        });\n        loader.on('change:uploadTotal', () => {\n            let aggregatedTotal = 0;\n            for (const loader of this.loaders) {\n                if (loader.uploadTotal) {\n                    aggregatedTotal += loader.uploadTotal;\n                }\n            }\n            this.uploadTotal = aggregatedTotal;\n        });\n        return loader;\n    }\n    /**\r\n\t * Destroys the given loader.\r\n\t *\r\n\t * @param {File|module:upload/filerepository~FileLoader} fileOrLoader File associated with that loader or loader\r\n\t * itself.\r\n\t */\n    destroyLoader(fileOrLoader) {\n        const loader = fileOrLoader instanceof FileLoader ? fileOrLoader : this.getLoader(fileOrLoader);\n        loader._destroy();\n        this.loaders.remove(loader);\n    }\n    /**\r\n\t * Registers or deregisters pending action bound with upload progress.\r\n\t *\r\n\t * @private\r\n\t */\n    _updatePendingAction() {\n        const pendingActions = this.editor.plugins.get(PendingActions);\n        if (this.loaders.length) {\n            if (!this._pendingAction) {\n                const t = this.editor.t;\n                const getMessage = value => `${ t('ap') } ${ parseInt(value) }%.`;\n                this._pendingAction = pendingActions.add(getMessage(this.uploadedPercent));\n                this._pendingAction.bind('message').to(this, 'uploadedPercent', getMessage);\n            }\n        } else {\n            pendingActions.remove(this._pendingAction);\n            this._pendingAction = null;\n        }\n    }\n}\nmix(FileRepository, ObservableMixin);\n/**\r\n * File loader class.\r\n *\r\n * It is used to control the process of reading the file and uploading it using the specified upload adapter.\r\n */\nclass FileLoader {\n    /**\r\n\t * Creates a new instance of `FileLoader`.\r\n\t *\r\n\t * @param {File} file A native file instance.\r\n\t * @param {module:upload/filerepository~UploadAdapter} adapter\r\n\t */\n    constructor(file, adapter) {\n        /**\r\n\t\t * Unique id of FileLoader instance.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\n        this.id = uid();\n        /**\r\n\t\t * A `File` instance associated with this file loader.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {File}\r\n\t\t */\n        this.file = file;\n        /**\r\n\t\t * Adapter instance associated with this file loader.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:upload/filerepository~UploadAdapter}\r\n\t\t */\n        this._adapter = adapter;\n        /**\r\n\t\t * FileReader used by FileLoader.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:upload/filereader~FileReader}\r\n\t\t */\n        this._reader = new FileReader();\n        /**\r\n\t\t * Current status of FileLoader. It can be one of the following:\r\n\t\t *\r\n\t\t * * 'idle',\r\n\t\t * * 'reading',\r\n\t\t * * 'uploading',\r\n\t\t * * 'aborted',\r\n\t\t * * 'error'.\r\n\t\t *\r\n\t\t * When reading status can change in a following way:\r\n\t\t *\r\n\t\t * `idle` -> `reading` -> `idle`\r\n\t\t * `idle` -> `reading -> `aborted`\r\n\t\t * `idle` -> `reading -> `error`\r\n\t\t *\r\n\t\t * When uploading status can change in a following way:\r\n\t\t *\r\n\t\t * `idle` -> `uploading` -> `idle`\r\n\t\t * `idle` -> `uploading` -> `aborted`\r\n\t\t * `idle` -> `uploading` -> `error`\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {String} #status\r\n\t\t */\n        this.set('status', 'idle');\n        /**\r\n\t\t * Number of bytes uploaded.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number} #uploaded\r\n\t\t */\n        this.set('uploaded', 0);\n        /**\r\n\t\t * Number of total bytes to upload.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number|null} #uploadTotal\r\n\t\t */\n        this.set('uploadTotal', null);\n        /**\r\n\t\t * Upload progress in percents.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Number} #uploadedPercent\r\n\t\t */\n        this.bind('uploadedPercent').to(this, 'uploaded', this, 'uploadTotal', (uploaded, total) => {\n            return total ? uploaded / total * 100 : 0;\n        });\n        /**\r\n\t\t * Response of the upload.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @observable\r\n\t\t * @member {Object|null} #uploadResponse\r\n\t\t */\n        this.set('uploadResponse', null);\n    }\n    /**\r\n\t * Reads file using {@link module:upload/filereader~FileReader}.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-read-wrong-status` when status\r\n\t * is different than `idle`.\r\n\t *\r\n\t * Example usage:\r\n\t *\r\n\t *\tfileLoader.read()\r\n\t *\t\t.then( data => { ... } )\r\n\t *\t\t.catch( err => {\r\n\t *\t\t\tif ( err === 'aborted' ) {\r\n\t *\t\t\t\tconsole.log( 'Reading aborted.' );\r\n\t *\t\t\t} else {\r\n\t *\t\t\t\tconsole.log( 'Reading error.', err );\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * @returns {Promise} Returns promise that will be resolved with read data. Promise will be rejected if error\r\n\t * occurs or if read process is aborted.\r\n\t */\n    read() {\n        if (this.status != 'idle') {\n            throw new CKEditorError('filerepository-read-wrong-status: You cannot call read if the status is different than idle.');\n        }\n        this.status = 'reading';\n        return this._reader.read(this.file).then(data => {\n            this.status = 'idle';\n            return data;\n        }).catch(err => {\n            if (err === 'aborted') {\n                this.status = 'aborted';\n                throw 'aborted';\n            }\n            this.status = 'error';\n            throw this._reader.error;\n        });\n    }\n    /**\r\n\t * Reads file using the provided {@link module:upload/filerepository~UploadAdapter}.\r\n\t *\r\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-upload-wrong-status` when status\r\n\t * is different than `idle`.\r\n\t * Example usage:\r\n\t *\r\n\t *\tfileLoader.upload()\r\n\t *\t\t.then( data => { ... } )\r\n\t *\t\t.catch( e => {\r\n\t *\t\t\tif ( e === 'aborted' ) {\r\n\t *\t\t\t\tconsole.log( 'Uploading aborted.' );\r\n\t *\t\t\t} else {\r\n\t *\t\t\t\tconsole.log( 'Uploading error.', e );\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t *\r\n\t * @returns {Promise} Returns promise that will be resolved with response data. Promise will be rejected if error\r\n\t * occurs or if read process is aborted.\r\n\t */\n    upload() {\n        if (this.status != 'idle') {\n            throw new CKEditorError('filerepository-upload-wrong-status: You cannot call upload if the status is different than idle.');\n        }\n        this.status = 'uploading';\n        return this._adapter.upload().then(data => {\n            this.uploadResponse = data;\n            this.status = 'idle';\n            return data;\n        }).catch(err => {\n            if (this.status === 'aborted') {\n                throw 'aborted';\n            }\n            this.status = 'error';\n            throw err;\n        });\n    }\n    /**\r\n\t * Aborts loading process.\r\n\t */\n    abort() {\n        const status = this.status;\n        this.status = 'aborted';\n        if (status == 'reading') {\n            this._reader.abort();\n        }\n        if (status == 'uploading' && this._adapter.abort) {\n            this._adapter.abort();\n        }\n        this._destroy();\n    }\n    /**\r\n\t * Performs cleanup.\r\n\t *\r\n\t * @private\r\n\t */\n    _destroy() {\n        this._reader = undefined;\n        this._adapter = undefined;\n        this.data = undefined;\n        this.uploadResponse = undefined;\n        this.file = undefined;\n    }\n}\nmix(FileLoader, ObservableMixin);    /**\r\n * Upload adapter interface used by the {@link module:upload/filerepository~FileRepository file repository}\r\n * to handle file upload. An upload adapter is a bridge between the editor and server that handles file uploads.\r\n * It should contain a logic necessary to initiate an upload process and monitor its progress.\r\n *\r\n * Learn how to develop your own upload adapter for CKEditor 5 in the\r\n * {@glink framework/guides/deep-dive/upload-adapter \"Custom upload adapter\" guide}.\r\n *\r\n * @interface UploadAdapter\r\n */\n                                     /**\r\n * Executes the upload process.\r\n * This method should return a promise that will resolve when data will be uploaded to server. Promise should be\r\n * resolved with an object containing information about uploaded file:\r\n *\r\n *\t\t{\r\n *\t\t\tdefault: 'http://server/default-size.image.png'\r\n *\t\t}\r\n *\r\n * Additionally, other image sizes can be provided:\r\n *\r\n *\t\t{\r\n *\t\t\tdefault: 'http://server/default-size.image.png',\r\n *\t\t\t'160': 'http://server/size-160.image.png',\r\n *\t\t\t'500': 'http://server/size-500.image.png',\r\n *\t\t\t'1000': 'http://server/size-1000.image.png',\r\n *\t\t\t'1052': 'http://server/default-size.image.png'\r\n *\t\t}\r\n *\r\n * NOTE: When returning multiple images, the widest returned one should equal the default one. It is essential to\r\n * correctly set `width` attribute of the image. See this discussion:\r\n * https://github.com/ckeditor/ckeditor5-easy-image/issues/4 for more information.\r\n *\r\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\r\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\r\n *\r\n * @method module:upload/filerepository~UploadAdapter#upload\r\n * @returns {Promise} Promise that should be resolved when data is uploaded.\r\n */\n                                     /**\r\n * Aborts the upload process.\r\n * After aborting it should reject promise returned from {@link #upload upload()}.\r\n *\r\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\r\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\r\n *\r\n * @method module:upload/filerepository~UploadAdapter#abort\r\n */","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* globals window, document */\r\n\r\n/**\r\n * @module adapter-ckfinder/utils\r\n */\r\n\r\nconst TOKEN_COOKIE_NAME = 'ckCsrfToken';\r\nconst TOKEN_LENGTH = 40;\r\nconst tokenCharset = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n/**\r\n * Returns the CSRF token value. The value is a hash stored in `document.cookie`\r\n * under the `ckCsrfToken` key. The CSRF token can be used to secure the communication\r\n * between the web browser and the CKFinder server.\r\n *\r\n * @returns {String}\r\n */\r\nexport function getCsrfToken() {\r\n\tlet token = getCookie( TOKEN_COOKIE_NAME );\r\n\r\n\tif ( !token || token.length != TOKEN_LENGTH ) {\r\n\t\ttoken = generateToken( TOKEN_LENGTH );\r\n\t\tsetCookie( TOKEN_COOKIE_NAME, token );\r\n\t}\r\n\r\n\treturn token;\r\n}\r\n\r\n/**\r\n * Returns the value of the cookie with a given name or `null` if the cookie is not found.\r\n *\r\n * @param {String} name\r\n * @returns {String|null}\r\n */\r\nexport function getCookie( name ) {\r\n\tname = name.toLowerCase();\r\n\tconst parts = document.cookie.split( ';' );\r\n\r\n\tfor ( const part of parts ) {\r\n\t\tconst pair = part.split( '=' );\r\n\t\tconst key = decodeURIComponent( pair[ 0 ].trim().toLowerCase() );\r\n\r\n\t\tif ( key === name ) {\r\n\t\t\treturn decodeURIComponent( pair[ 1 ] );\r\n\t\t}\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * Sets the value of the cookie with a given name.\r\n *\r\n * @param {String} name\r\n * @param {String} value\r\n */\r\nexport function setCookie( name, value ) {\r\n\tdocument.cookie = encodeURIComponent( name ) + '=' + encodeURIComponent( value ) + ';path=/';\r\n}\r\n\r\n// Generates the CSRF token with the given length.\r\n//\r\n// @private\r\n// @param {Number} length\r\n// @returns {string}\r\nfunction generateToken( length ) {\r\n\tlet result = '';\r\n\tconst randValues = new Uint8Array( length );\r\n\r\n\twindow.crypto.getRandomValues( randValues );\r\n\r\n\tfor ( let j = 0; j < randValues.length; j++ ) {\r\n\t\tconst character = tokenCharset.charAt( randValues[ j ] % tokenCharset.length );\r\n\t\tresult += Math.random() > 0.5 ? character.toUpperCase() : character;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/* globals XMLHttpRequest, FormData */\n/**\r\n * @module adapter-ckfinder/uploadadapter\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport FileRepository from '@ckeditor/ckeditor5-upload/src/filerepository';\nimport { getCsrfToken } from './utils';\n/**\r\n * A plugin that enables file uploads in CKEditor 5 using the CKFinder server–side connector.\r\n *\r\n * See the {@glink features/ckfinder \"CKFinder integration\" guide} to learn how to configure\r\n * and use this feature as well as find out more about the full integration with the file manager\r\n * provided by the {@link module:ckfinder/ckfinder~CKFinder} plugin.\r\n *\r\n * Check out the {@glink features/image-upload comprehensive \"Image upload\" guide} to learn about\r\n * other ways to upload images into CKEditor 5.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class CKFinderUploadAdapter extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [FileRepository];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get pluginName() {\n        return 'CKFinderUploadAdapter';\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const url = this.editor.config.get('ckfinder.uploadUrl');\n        if (!url) {\n            return;\n        }\n        // Register CKFinderAdapter\n        this.editor.plugins.get(FileRepository).createUploadAdapter = loader => new UploadAdapter(loader, url, this.editor.t);\n    }\n}\n/**\r\n * Upload adapter for CKFinder.\r\n *\r\n * @private\r\n * @implements module:upload/filerepository~UploadAdapter\r\n */\nclass UploadAdapter {\n    /**\r\n\t * Creates a new adapter instance.\r\n\t *\r\n\t * @param {module:upload/filerepository~FileLoader} loader\r\n\t * @param {String} url\r\n\t * @param {module:utils/locale~Locale#t} t\r\n\t */\n    constructor(loader, url, t) {\n        /**\r\n\t\t * FileLoader instance to use during the upload.\r\n\t\t *\r\n\t\t * @member {module:upload/filerepository~FileLoader} #loader\r\n\t\t */\n        this.loader = loader;\n        /**\r\n\t\t * Upload URL.\r\n\t\t *\r\n\t\t * @member {String} #url\r\n\t\t */\n        this.url = url;\n        /**\r\n\t\t * Locale translation method.\r\n\t\t *\r\n\t\t * @member {module:utils/locale~Locale#t} #t\r\n\t\t */\n        this.t = t;\n    }\n    /**\r\n\t * Starts the upload process.\r\n\t *\r\n\t * @see module:upload/filerepository~UploadAdapter#upload\r\n\t * @returns {Promise}\r\n\t */\n    upload() {\n        return new Promise((resolve, reject) => {\n            this._initRequest();\n            this._initListeners(resolve, reject);\n            this._sendRequest();\n        });\n    }\n    /**\r\n\t * Aborts the upload process.\r\n\t *\r\n\t * @see module:upload/filerepository~UploadAdapter#abort\r\n\t * @returns {Promise}\r\n\t */\n    abort() {\n        if (this.xhr) {\n            this.xhr.abort();\n        }\n    }\n    /**\r\n\t * Initializes the XMLHttpRequest object.\r\n\t *\r\n\t * @private\r\n\t */\n    _initRequest() {\n        const xhr = this.xhr = new XMLHttpRequest();\n        xhr.open('POST', this.url, true);\n        xhr.responseType = 'json';\n    }\n    /**\r\n\t * Initializes XMLHttpRequest listeners.\r\n\t *\r\n\t * @private\r\n\t * @param {Function} resolve Callback function to be called when the request is successful.\r\n\t * @param {Function} reject Callback function to be called when the request cannot be completed.\r\n\t */\n    _initListeners(resolve, reject) {\n        const xhr = this.xhr;\n        const loader = this.loader;\n        const t = this.t;\n        const genericError = t('a') + ` ${ loader.file.name }.`;\n        xhr.addEventListener('error', () => reject(genericError));\n        xhr.addEventListener('abort', () => reject());\n        xhr.addEventListener('load', () => {\n            const response = xhr.response;\n            if (!response || !response.uploaded) {\n                return reject(response && response.error && response.error.message ? response.error.message : genericError);\n            }\n            resolve({ default: response.url });\n        });\n        // Upload progress when it's supported.\n        /* istanbul ignore else */\n        if (xhr.upload) {\n            xhr.upload.addEventListener('progress', evt => {\n                if (evt.lengthComputable) {\n                    loader.uploadTotal = evt.total;\n                    loader.uploaded = evt.loaded;\n                }\n            });\n        }\n    }\n    /**\r\n\t * Prepares the data and sends the request.\r\n\t *\r\n\t * @private\r\n\t */\n    _sendRequest() {\n        // Prepare form data.\n        const data = new FormData();\n        data.append('upload', this.loader.file);\n        data.append('ckCsrfToken', getCsrfToken());\n        // Send request.\n        this.xhr.send(data);\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module autoformat/blockautoformatediting\r\n */\r\n\r\n/**\r\n * The block autoformatting engine. It allows to format various block patterns. For example,\r\n * it can be configured to turn a paragraph starting with `*` and followed by a space into a list item.\r\n *\r\n * The autoformatting operation is integrated with the undo manager,\r\n * so the autoformatting step can be undone if the user's intention was not to format the text.\r\n *\r\n * See the constructors documentation to learn how to create custom inline autoformatters. You can also use\r\n * the {@link module:autoformat/autoformat~Autoformat} feature which enables a set of default autoformatters\r\n * (lists, headings, bold and italic).\r\n */\r\nexport default class BlockAutoformatEditing {\r\n\t/**\r\n\t * Creates a listener triggered on `change` event in the document.\r\n\t * Calls the callback when inserted text matches the regular expression or the command name\r\n\t * if provided instead of the callback.\r\n\t *\r\n\t * Examples of usage:\r\n\t *\r\n\t * To convert a paragraph to heading 1 when `- ` is typed, using just the commmand name:\r\n\t *\r\n\t *\t\tnew BlockAutoformatEditing( editor, /^\\- $/, 'heading1' );\r\n\t *\r\n\t * To convert a paragraph to heading 1 when `- ` is typed, using just the callback:\r\n\t *\r\n\t *\t\tnew BlockAutoformatEditing( editor, /^\\- $/, ( context ) => {\r\n\t *\t\t\tconst { match } = context;\r\n\t *\t\t\tconst headingLevel = match[ 1 ].length;\r\n\t *\r\n\t *\t\t\teditor.execute( 'heading', {\r\n\t *\t\t\t\tformatId: `heading${ headingLevel }`\r\n\t *\t\t\t} );\r\n\t * \t\t} );\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {RegExp} pattern The regular expression to execute on just inserted text.\r\n\t * @param {Function|String} callbackOrCommand The callback to execute or the command to run when the text is matched.\r\n\t * In case of providing the callback, it receives the following parameter:\r\n\t * * {Object} match RegExp.exec() result of matching the pattern to inserted text.\r\n\t */\r\n\tconstructor( editor, pattern, callbackOrCommand ) {\r\n\t\tlet callback;\r\n\r\n\t\tif ( typeof callbackOrCommand == 'function' ) {\r\n\t\t\tcallback = callbackOrCommand;\r\n\t\t} else {\r\n\t\t\t// We assume that the actual command name was provided.\r\n\t\t\tconst command = callbackOrCommand;\r\n\r\n\t\t\tcallback = () => {\r\n\t\t\t\teditor.execute( command );\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\teditor.model.document.on( 'change', ( evt, batch ) => {\r\n\t\t\tif ( batch.type == 'transparent' ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst changes = Array.from( editor.model.document.differ.getChanges() );\r\n\t\t\tconst entry = changes[ 0 ];\r\n\r\n\t\t\t// Typing is represented by only a single change.\r\n\t\t\tif ( changes.length != 1 || entry.type !== 'insert' || entry.name != '$text' || entry.length != 1 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst item = entry.position.textNode || entry.position.nodeAfter;\r\n\r\n\t\t\tif ( !item.parent.is( 'paragraph' ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst match = pattern.exec( item.data );\r\n\r\n\t\t\tif ( !match ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Use enqueueChange to create new batch to separate typing batch from the auto-format changes.\r\n\t\t\teditor.model.enqueueChange( writer => {\r\n\t\t\t\t// Matched range.\r\n\t\t\t\tconst start = writer.createPositionAt( item.parent, 0 );\r\n\t\t\t\tconst end = writer.createPositionAt( item.parent, match[ 0 ].length );\r\n\t\t\t\tconst range = writer.createRange( start, end );\r\n\r\n\t\t\t\t// Remove matched text.\r\n\t\t\t\twriter.remove( range );\r\n\r\n\t\t\t\tcallback( { match } );\r\n\t\t\t} );\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module autoformat/inlineautoformatediting\r\n */\r\n\r\n/**\r\n * The inline autoformatting engine. It allows to format various inline patterns. For example,\r\n * it can be configured to make \"foo\" bold when typed `**foo**` (the `**` markers will be removed).\r\n *\r\n * The autoformatting operation is integrated with the undo manager,\r\n * so the autoformatting step can be undone if the user's intention was not to format the text.\r\n *\r\n * See the constructors documentation to learn how to create custom inline autoformatters. You can also use\r\n * the {@link module:autoformat/autoformat~Autoformat} feature which enables a set of default autoformatters\r\n * (lists, headings, bold and italic).\r\n */\r\nexport default class InlineAutoformatEditing {\r\n\t/**\r\n\t * Enables autoformatting mechanism for a given {@link module:core/editor/editor~Editor}.\r\n\t *\r\n\t * It formats the matched text by applying the given model attribute or by running the provided formatting callback.\r\n\t * On every change applied to the model the autoformatting engine checks the text on the left of the selection\r\n\t * and executes the provided action if the text matches given criteria (regular expression or callback).\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {Function|RegExp} testRegexpOrCallback The regular expression or callback to execute on text.\r\n\t * Provided regular expression *must* have three capture groups. The first and the third capture group\r\n\t * should match opening and closing delimiters. The second capture group should match the text to format.\r\n\t *\r\n\t *\t\t// Matches the `**bold text**` pattern.\r\n\t *\t\t// There are three capturing groups:\r\n\t *\t\t// - The first to match the starting `**` delimiter.\r\n\t *\t\t// - The second to match the text to format.\r\n\t *\t\t// - The third to match the ending `**` delimiter.\r\n\t *\t\tnew InlineAutoformatEditing( editor, /(\\*\\*)([^\\*]+?)(\\*\\*)$/g, 'bold' );\r\n\t *\r\n\t * When a function is provided instead of the regular expression, it will be executed with the text to match as a parameter.\r\n\t * The function should return proper \"ranges\" to delete and format.\r\n\t *\r\n\t *\t\t{\r\n\t *\t\t\tremove: [\r\n\t *\t\t\t\t[ 0, 1 ],\t// Remove the first letter from the given text.\r\n\t *\t\t\t\t[ 5, 6 ]\t// Remove the 6th letter from the given text.\r\n\t *\t\t\t],\r\n\t *\t\t\tformat: [\r\n\t *\t\t\t\t[ 1, 5 ]\t// Format all letters from 2nd to 5th.\r\n\t *\t\t\t]\r\n\t *\t\t}\r\n\t *\r\n\t * @param {Function|String} attributeOrCallback The name of attribute to apply on matching text or a callback for manual\r\n\t * formatting.\r\n\t *\r\n\t *\t\t// Use attribute name:\r\n\t *\t\tnew InlineAutoformatEditing( editor, /(\\*\\*)([^\\*]+?)(\\*\\*)$/g, 'bold' );\r\n\t *\r\n\t *\t\t// Use formatting callback:\r\n\t *\t\tnew InlineAutoformatEditing( editor, /(\\*\\*)([^\\*]+?)(\\*\\*)$/g, ( writer, validRanges ) => {\r\n\t *\t\t\tfor ( let range of validRanges ) {\r\n\t *\t\t\t\twriter.setAttribute( command, true, range );\r\n\t *\t\t\t}\r\n\t *\t\t} );\r\n\t */\r\n\tconstructor( editor, testRegexpOrCallback, attributeOrCallback ) {\r\n\t\tlet regExp;\r\n\t\tlet attributeKey;\r\n\t\tlet testCallback;\r\n\t\tlet formatCallback;\r\n\r\n\t\tif ( testRegexpOrCallback instanceof RegExp ) {\r\n\t\t\tregExp = testRegexpOrCallback;\r\n\t\t} else {\r\n\t\t\ttestCallback = testRegexpOrCallback;\r\n\t\t}\r\n\r\n\t\tif ( typeof attributeOrCallback == 'string' ) {\r\n\t\t\tattributeKey = attributeOrCallback;\r\n\t\t} else {\r\n\t\t\tformatCallback = attributeOrCallback;\r\n\t\t}\r\n\r\n\t\t// A test callback run on changed text.\r\n\t\ttestCallback = testCallback || ( text => {\r\n\t\t\tlet result;\r\n\t\t\tconst remove = [];\r\n\t\t\tconst format = [];\r\n\r\n\t\t\twhile ( ( result = regExp.exec( text ) ) !== null ) {\r\n\t\t\t\t// There should be full match and 3 capture groups.\r\n\t\t\t\tif ( result && result.length < 4 ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet {\r\n\t\t\t\t\tindex,\r\n\t\t\t\t\t'1': leftDel,\r\n\t\t\t\t\t'2': content,\r\n\t\t\t\t\t'3': rightDel\r\n\t\t\t\t} = result;\r\n\r\n\t\t\t\t// Real matched string - there might be some non-capturing groups so we need to recalculate starting index.\r\n\t\t\t\tconst found = leftDel + content + rightDel;\r\n\t\t\t\tindex += result[ 0 ].length - found.length;\r\n\r\n\t\t\t\t// Start and End offsets of delimiters to remove.\r\n\t\t\t\tconst delStart = [\r\n\t\t\t\t\tindex,\r\n\t\t\t\t\tindex + leftDel.length\r\n\t\t\t\t];\r\n\t\t\t\tconst delEnd = [\r\n\t\t\t\t\tindex + leftDel.length + content.length,\r\n\t\t\t\t\tindex + leftDel.length + content.length + rightDel.length\r\n\t\t\t\t];\r\n\r\n\t\t\t\tremove.push( delStart );\r\n\t\t\t\tremove.push( delEnd );\r\n\r\n\t\t\t\tformat.push( [ index + leftDel.length, index + leftDel.length + content.length ] );\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tremove,\r\n\t\t\t\tformat\r\n\t\t\t};\r\n\t\t} );\r\n\r\n\t\t// A format callback run on matched text.\r\n\t\tformatCallback = formatCallback || ( ( writer, validRanges ) => {\r\n\t\t\tfor ( const range of validRanges ) {\r\n\t\t\t\twriter.setAttribute( attributeKey, true, range );\r\n\t\t\t}\r\n\r\n\t\t\t// After applying attribute to the text, remove given attribute from the selection.\r\n\t\t\t// This way user is able to type a text without attribute used by auto formatter.\r\n\t\t\twriter.removeSelectionAttribute( attributeKey );\r\n\t\t} );\r\n\r\n\t\teditor.model.document.on( 'change', ( evt, batch ) => {\r\n\t\t\tif ( batch.type == 'transparent' ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst selection = editor.model.document.selection;\r\n\r\n\t\t\t// Do nothing if selection is not collapsed.\r\n\t\t\tif ( !selection.isCollapsed ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst changes = Array.from( editor.model.document.differ.getChanges() );\r\n\t\t\tconst entry = changes[ 0 ];\r\n\r\n\t\t\t// Typing is represented by only a single change.\r\n\t\t\tif ( changes.length != 1 || entry.type !== 'insert' || entry.name != '$text' || entry.length != 1 ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst block = selection.focus.parent;\r\n\t\t\tconst text = getText( block ).slice( 0, selection.focus.offset );\r\n\t\t\tconst testOutput = testCallback( text );\r\n\t\t\tconst rangesToFormat = testOutputToRanges( block, testOutput.format, editor.model );\r\n\t\t\tconst rangesToRemove = testOutputToRanges( block, testOutput.remove, editor.model );\r\n\r\n\t\t\tif ( !( rangesToFormat.length && rangesToRemove.length ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Use enqueueChange to create new batch to separate typing batch from the auto-format changes.\r\n\t\t\teditor.model.enqueueChange( writer => {\r\n\t\t\t\tconst validRanges = editor.model.schema.getValidRanges( rangesToFormat, attributeKey );\r\n\r\n\t\t\t\t// Apply format.\r\n\t\t\t\tformatCallback( writer, validRanges );\r\n\r\n\t\t\t\t// Remove delimiters - use reversed order to not mix the offsets while removing.\r\n\t\t\t\tfor ( const range of rangesToRemove.reverse() ) {\r\n\t\t\t\t\twriter.remove( range );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Returns whole text from parent element by adding all data from text nodes together.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} element\r\n// @returns {String}\r\nfunction getText( element ) {\r\n\treturn Array.from( element.getChildren() ).reduce( ( a, b ) => a + b.data, '' );\r\n}\r\n\r\n// Converts output of the test function provided to the InlineAutoformatEditing and converts it to the model ranges\r\n// inside provided block.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} block\r\n// @param {Array.<Array>} arrays\r\n// @param {module:engine/model/model~Model} model\r\nfunction testOutputToRanges( block, arrays, model ) {\r\n\treturn arrays\r\n\t\t.filter( array => ( array[ 0 ] !== undefined && array[ 1 ] !== undefined ) )\r\n\t\t.map( array => {\r\n\t\t\treturn model.createRange( model.createPositionAt( block, array[ 0 ] ), model.createPositionAt( block, array[ 1 ] ) );\r\n\t\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module basic-styles/attributecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\n/**\r\n * An extension of the base {@link module:core/command~Command} class, which provides utilities for a command\r\n * that toggles a single attribute on a text or an element.\r\n *\r\n * `AttributeCommand` uses {@link module:engine/model/document~Document#selection}\r\n * to decide which nodes (if any) should be changed, and applies or removes the attribute from them.\r\n *\r\n * The command checks the {@link module:engine/model/model~Model#schema} to decide if it can be enabled\r\n * for the current selection and to which nodes the attribute can be applied.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class AttributeCommand extends Command {\r\n\t/**\r\n\t * @param {module:core/editor/editor~Editor} editor\r\n\t * @param {String} attributeKey Attribute that will be set by the command.\r\n\t */\r\n\tconstructor( editor, attributeKey ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The attribute that will be set by the command.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.attributeKey = attributeKey;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether the command is active. The command is active when the\r\n\t\t * {@link module:engine/model/selection~Selection#hasAttribute selection has the attribute} which means that:\r\n\t\t *\r\n\t\t * * If the selection is not empty &ndash; That the attribute is set on the first node in the selection that allows this attribute.\r\n\t\t * * If the selection is empty &ndash; That the selection has the attribute itself (which means that newly typed\r\n\t\t * text will have this attribute, too).\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #value\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the command's {@link #value} and {@link #isEnabled} based on the current selection.\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tthis.value = this._getValueFromFirstAllowedNode();\r\n\t\tthis.isEnabled = model.schema.checkAttributeInSelection( doc.selection, this.attributeKey );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command &mdash; applies the attribute to the selection or removes it from the selection.\r\n\t *\r\n\t * If the command is active (`value == true`), it will remove attributes. Otherwise, it will set attributes.\r\n\t *\r\n\t * The execution result differs, depending on the {@link module:engine/model/document~Document#selection}:\r\n\t *\r\n\t * * If the selection is on a range, the command applies the attribute to all nodes in that range\r\n\t * (if they are allowed to have this attribute by the {@link module:engine/model/schema~Schema schema}).\r\n\t * * If the selection is collapsed in a non-empty node, the command applies the attribute to the\r\n\t * {@link module:engine/model/document~Document#selection} itself (note that typed characters copy attributes from the selection).\r\n\t * * If the selection is collapsed in an empty node, the command applies the attribute to the parent node of the selection (note\r\n\t * that the selection inherits all attributes from a node if it is in an empty node).\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} [options] Command options.\r\n\t * @param {Boolean} [options.forceValue] If set, it will force the command behavior. If `true`, the command will apply the attribute,\r\n\t * otherwise the command will remove the attribute.\r\n\t * If not set, the command will look for its current value to decide what it should do.\r\n\t */\r\n\texecute( options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\t\tconst value = ( options.forceValue === undefined ) ? !this.value : options.forceValue;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tif ( selection.isCollapsed ) {\r\n\t\t\t\tif ( value ) {\r\n\t\t\t\t\twriter.setSelectionAttribute( this.attributeKey, true );\r\n\t\t\t\t} else {\r\n\t\t\t\t\twriter.removeSelectionAttribute( this.attributeKey );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst ranges = model.schema.getValidRanges( selection.getRanges(), this.attributeKey );\r\n\r\n\t\t\t\tfor ( const range of ranges ) {\r\n\t\t\t\t\tif ( value ) {\r\n\t\t\t\t\t\twriter.setAttribute( this.attributeKey, value, range );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twriter.removeAttribute( this.attributeKey, range );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks the attribute value of the first node in the selection that allows the attribute.\r\n\t * For the collapsed selection returns the selection attribute.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} The attribute value.\r\n\t */\r\n\t_getValueFromFirstAllowedNode() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst schema = model.schema;\r\n\t\tconst selection = model.document.selection;\r\n\r\n\t\tif ( selection.isCollapsed ) {\r\n\t\t\treturn selection.hasAttribute( this.attributeKey );\r\n\t\t}\r\n\r\n\t\tfor ( const range of selection.getRanges() ) {\r\n\t\t\tfor ( const item of range.getItems() ) {\r\n\t\t\t\tif ( schema.checkAttribute( item, this.attributeKey ) ) {\r\n\t\t\t\t\treturn item.hasAttribute( this.attributeKey );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module basic-styles/bold/boldediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport AttributeCommand from '../attributecommand';\r\n\r\nconst BOLD = 'bold';\r\n\r\n/**\r\n * The bold editing feature.\r\n *\r\n * It registers the `'bold'` command and introduces the `bold` attribute in the model which renders to the view\r\n * as a `<strong>` element.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class BoldEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\t// Allow bold attribute on text nodes.\r\n\t\teditor.model.schema.extend( '$text', { allowAttributes: BOLD } );\r\n\r\n\t\t// Build converter from model to view for data and editing pipelines.\r\n\r\n\t\teditor.conversion.attributeToElement( {\r\n\t\t\tmodel: BOLD,\r\n\t\t\tview: 'strong',\r\n\t\t\tupcastAlso: [\r\n\t\t\t\t'b',\r\n\t\t\t\t{\r\n\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t'font-weight': 'bold'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\t// Create bold command.\r\n\t\teditor.commands.add( BOLD, new AttributeCommand( editor, BOLD ) );\r\n\r\n\t\t// Set the Ctrl+B keystroke.\r\n\t\teditor.keystrokes.set( 'CTRL+B', BOLD );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module basic-styles/bold/boldui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport boldIcon from '../../theme/icons/bold.svg';\nconst BOLD = 'bold';\n/**\r\n * The bold UI feature. It introduces the Bold button.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class BoldUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        // Add bold button to feature components.\n        editor.ui.componentFactory.add(BOLD, locale => {\n            const command = editor.commands.get(BOLD);\n            const view = new ButtonView(locale);\n            view.set({\n                label: t('b'),\n                icon: boldIcon,\n                keystroke: 'CTRL+B',\n                tooltip: true\n            });\n            view.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n            // Execute command.\n            this.listenTo(view, 'execute', () => editor.execute(BOLD));\n            return view;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module basic-styles/italic/italicediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport AttributeCommand from '../attributecommand';\r\n\r\nconst ITALIC = 'italic';\r\n\r\n/**\r\n * The italic editing feature.\r\n *\r\n * It registers the `'italic'` command, the <kbd>Ctrl+I</kbd> keystroke and introduces the `italic` attribute in the model\r\n * which renders to the view as an `<em>` element.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ItalicEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// Allow italic attribute on text nodes.\r\n\t\teditor.model.schema.extend( '$text', { allowAttributes: ITALIC } );\r\n\r\n\t\teditor.conversion.attributeToElement( {\r\n\t\t\tmodel: ITALIC,\r\n\t\t\tview: 'i',\r\n\t\t\tupcastAlso: [\r\n\t\t\t\t'em',\r\n\t\t\t\t{\r\n\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t'font-style': 'italic'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\t// Create italic command.\r\n\t\teditor.commands.add( ITALIC, new AttributeCommand( editor, ITALIC ) );\r\n\r\n\t\t// Set the Ctrl+I keystroke.\r\n\t\teditor.keystrokes.set( 'CTRL+I', ITALIC );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module basic-styles/italic/italicui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport italicIcon from '../../theme/icons/italic.svg';\nconst ITALIC = 'italic';\n/**\r\n * The italic UI feature. It introduces the Italic button.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ItalicUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        // Add bold button to feature components.\n        editor.ui.componentFactory.add(ITALIC, locale => {\n            const command = editor.commands.get(ITALIC);\n            const view = new ButtonView(locale);\n            view.set({\n                label: t('c'),\n                icon: italicIcon,\n                keystroke: 'CTRL+I',\n                tooltip: true\n            });\n            view.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n            // Execute command.\n            this.listenTo(view, 'execute', () => editor.execute(ITALIC));\n            return view;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/first\r\n */\r\n\r\n/**\r\n * Returns first item of the given `iterable`.\r\n *\r\n * @param {Iterable.<*>} iterable\r\n * @returns {*}\r\n */\r\nexport default function first( iterable ) {\r\n\tconst iteratorItem = iterable.next();\r\n\r\n\tif ( iteratorItem.done ) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn iteratorItem.value;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module block-quote/blockquotecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * The block quote command plugin.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class BlockQuoteCommand extends Command {\r\n\t/**\r\n\t * Whether the selection starts in a block quote.\r\n\t *\r\n\t * @observable\r\n\t * @readonly\r\n\t * @member {Boolean} #value\r\n\t */\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.value = this._getValue();\r\n\t\tthis.isEnabled = this._checkEnabled();\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command. When the command {@link #value is on}, all block quotes within\r\n\t * the selection will be removed. If it is off, all selected blocks will be wrapped with\r\n\t * a block quote.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst schema = model.schema;\r\n\t\tconst blocks = Array.from( doc.selection.getSelectedBlocks() );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tif ( this.value ) {\r\n\t\t\t\tthis._removeQuote( writer, blocks.filter( findQuote ) );\r\n\t\t\t} else {\r\n\t\t\t\tconst blocksToQuote = blocks.filter( block => {\r\n\t\t\t\t\t// Already quoted blocks needs to be considered while quoting too\r\n\t\t\t\t\t// in order to reuse their <bQ> elements.\r\n\t\t\t\t\treturn findQuote( block ) || checkCanBeQuoted( schema, block );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tthis._applyQuote( writer, blocksToQuote );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks the command's {@link #value}.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} The current value.\r\n\t */\r\n\t_getValue() {\r\n\t\tconst firstBlock = first( this.editor.model.document.selection.getSelectedBlocks() );\r\n\r\n\t\t// In the current implementation, the block quote must be an immediate parent of a block element.\r\n\t\treturn !!( firstBlock && findQuote( firstBlock ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the command can be enabled in the current context.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} Whether the command should be enabled.\r\n\t */\r\n\t_checkEnabled() {\r\n\t\tif ( this.value ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst selection = this.editor.model.document.selection;\r\n\t\tconst schema = this.editor.model.schema;\r\n\r\n\t\tconst firstBlock = first( selection.getSelectedBlocks() );\r\n\r\n\t\tif ( !firstBlock ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn checkCanBeQuoted( schema, firstBlock );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the quote from given blocks.\r\n\t *\r\n\t * If blocks which are supposed to be \"unquoted\" are in the middle of a quote,\r\n\t * start it or end it, then the quote will be split (if needed) and the blocks\r\n\t * will be moved out of it, so other quoted blocks remained quoted.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/writer~Writer} writer\r\n\t * @param {Array.<module:engine/model/element~Element>} blocks\r\n\t */\r\n\t_removeQuote( writer, blocks ) {\r\n\t\t// Unquote all groups of block. Iterate in the reverse order to not break following ranges.\r\n\t\tgetRangesOfBlockGroups( writer, blocks ).reverse().forEach( groupRange => {\r\n\t\t\tif ( groupRange.start.isAtStart && groupRange.end.isAtEnd ) {\r\n\t\t\t\twriter.unwrap( groupRange.start.parent );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// The group of blocks are at the beginning of an <bQ> so let's move them left (out of the <bQ>).\r\n\t\t\tif ( groupRange.start.isAtStart ) {\r\n\t\t\t\tconst positionBefore = writer.createPositionBefore( groupRange.start.parent );\r\n\r\n\t\t\t\twriter.move( groupRange, positionBefore );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// The blocks are in the middle of an <bQ> so we need to split the <bQ> after the last block\r\n\t\t\t// so we move the items there.\r\n\t\t\tif ( !groupRange.end.isAtEnd ) {\r\n\t\t\t\twriter.split( groupRange.end );\r\n\t\t\t}\r\n\r\n\t\t\t// Now we are sure that groupRange.end.isAtEnd is true, so let's move the blocks right.\r\n\r\n\t\t\tconst positionAfter = writer.createPositionAfter( groupRange.end.parent );\r\n\r\n\t\t\twriter.move( groupRange, positionAfter );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Applies the quote to given blocks.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/writer~Writer} writer\r\n\t * @param {Array.<module:engine/model/element~Element>} blocks\r\n\t */\r\n\t_applyQuote( writer, blocks ) {\r\n\t\tconst quotesToMerge = [];\r\n\r\n\t\t// Quote all groups of block. Iterate in the reverse order to not break following ranges.\r\n\t\tgetRangesOfBlockGroups( writer, blocks ).reverse().forEach( groupRange => {\r\n\t\t\tlet quote = findQuote( groupRange.start );\r\n\r\n\t\t\tif ( !quote ) {\r\n\t\t\t\tquote = writer.createElement( 'blockQuote' );\r\n\r\n\t\t\t\twriter.wrap( groupRange, quote );\r\n\t\t\t}\r\n\r\n\t\t\tquotesToMerge.push( quote );\r\n\t\t} );\r\n\r\n\t\t// Merge subsequent <bQ> elements. Reverse the order again because this time we want to go through\r\n\t\t// the <bQ> elements in the source order (due to how merge works – it moves the right element's content\r\n\t\t// to the first element and removes the right one. Since we may need to merge a couple of subsequent `<bQ>` elements\r\n\t\t// we want to keep the reference to the first (furthest left) one.\r\n\t\tquotesToMerge.reverse().reduce( ( currentQuote, nextQuote ) => {\r\n\t\t\tif ( currentQuote.nextSibling == nextQuote ) {\r\n\t\t\t\twriter.merge( writer.createPositionAfter( currentQuote ) );\r\n\r\n\t\t\t\treturn currentQuote;\r\n\t\t\t}\r\n\r\n\t\t\treturn nextQuote;\r\n\t\t} );\r\n\t}\r\n}\r\n\r\nfunction findQuote( elementOrPosition ) {\r\n\treturn elementOrPosition.parent.name == 'blockQuote' ? elementOrPosition.parent : null;\r\n}\r\n\r\n// Returns a minimal array of ranges containing groups of subsequent blocks.\r\n//\r\n// content:         abcdefgh\r\n// blocks:          [ a, b, d , f, g, h ]\r\n// output ranges:   [ab]c[d]e[fgh]\r\n//\r\n// @param {Array.<module:engine/model/element~Element>} blocks\r\n// @returns {Array.<module:engine/model/range~Range>}\r\nfunction getRangesOfBlockGroups( writer, blocks ) {\r\n\tlet startPosition;\r\n\tlet i = 0;\r\n\tconst ranges = [];\r\n\r\n\twhile ( i < blocks.length ) {\r\n\t\tconst block = blocks[ i ];\r\n\t\tconst nextBlock = blocks[ i + 1 ];\r\n\r\n\t\tif ( !startPosition ) {\r\n\t\t\tstartPosition = writer.createPositionBefore( block );\r\n\t\t}\r\n\r\n\t\tif ( !nextBlock || block.nextSibling != nextBlock ) {\r\n\t\t\tranges.push( writer.createRange( startPosition, writer.createPositionAfter( block ) ) );\r\n\t\t\tstartPosition = null;\r\n\t\t}\r\n\r\n\t\ti++;\r\n\t}\r\n\r\n\treturn ranges;\r\n}\r\n\r\n// Checks whether <bQ> can wrap the block.\r\nfunction checkCanBeQuoted( schema, block ) {\r\n\t// TMP will be replaced with schema.checkWrap().\r\n\tconst isBQAllowed = schema.checkChild( block.parent, 'blockQuote' );\r\n\tconst isBlockAllowedInBQ = schema.checkChild( [ '$root', 'blockQuote' ], block );\r\n\r\n\treturn isBQAllowed && isBlockAllowedInBQ;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module block-quote/blockquoteediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport BlockQuoteCommand from './blockquotecommand';\r\n\r\n/**\r\n * The block quote editing.\r\n *\r\n * Introduces the `'blockQuote'` command and the `'blockQuote'` model element.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class BlockQuoteEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst schema = editor.model.schema;\r\n\r\n\t\teditor.commands.add( 'blockQuote', new BlockQuoteCommand( editor ) );\r\n\r\n\t\tschema.register( 'blockQuote', {\r\n\t\t\tallowWhere: '$block',\r\n\t\t\tallowContentOf: '$root'\r\n\t\t} );\r\n\r\n\t\t// Disallow blockQuote in blockQuote.\r\n\t\tschema.addChildCheck( ( ctx, childDef ) => {\r\n\t\t\tif ( ctx.endsWith( 'blockQuote' ) && childDef.name == 'blockQuote' ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\teditor.conversion.elementToElement( { model: 'blockQuote', view: 'blockquote' } );\r\n\r\n\t\t// Postfixer which cleans incorrect model states connected with block quotes.\r\n\t\teditor.model.document.registerPostFixer( writer => {\r\n\t\t\tconst changes = editor.model.document.differ.getChanges();\r\n\r\n\t\t\tfor ( const entry of changes ) {\r\n\t\t\t\tif ( entry.type == 'insert' ) {\r\n\t\t\t\t\tconst element = entry.position.nodeAfter;\r\n\r\n\t\t\t\t\tif ( !element ) {\r\n\t\t\t\t\t\t// We are inside a text node.\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( element.is( 'blockQuote' ) && element.isEmpty ) {\r\n\t\t\t\t\t\t// Added an empty blockQuote - remove it.\r\n\t\t\t\t\t\twriter.remove( element );\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if ( element.is( 'blockQuote' ) && !schema.checkChild( entry.position, element ) ) {\r\n\t\t\t\t\t\t// Added a blockQuote in incorrect place - most likely inside another blockQuote. Unwrap it\r\n\t\t\t\t\t\t// so the content inside is not lost.\r\n\t\t\t\t\t\twriter.unwrap( element );\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if ( element.is( 'element' ) ) {\r\n\t\t\t\t\t\t// Just added an element. Check its children to see if there are no nested blockQuotes somewhere inside.\r\n\t\t\t\t\t\tconst range = writer.createRangeIn( element );\r\n\r\n\t\t\t\t\t\tfor ( const child of range.getItems() ) {\r\n\t\t\t\t\t\t\tif ( child.is( 'blockQuote' ) && !schema.checkChild( writer.createPositionBefore( child ), child ) ) {\r\n\t\t\t\t\t\t\t\twriter.unwrap( child );\r\n\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if ( entry.type == 'remove' ) {\r\n\t\t\t\t\tconst parent = entry.position.parent;\r\n\r\n\t\t\t\t\tif ( parent.is( 'blockQuote' ) && parent.isEmpty ) {\r\n\t\t\t\t\t\t// Something got removed and now blockQuote is empty. Remove the blockQuote as well.\r\n\t\t\t\t\t\twriter.remove( parent );\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tafterInit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst command = editor.commands.get( 'blockQuote' );\r\n\r\n\t\t// Overwrite default Enter key behavior.\r\n\t\t// If Enter key is pressed with selection collapsed in empty block inside a quote, break the quote.\r\n\t\t// This listener is added in afterInit in order to register it after list's feature listener.\r\n\t\t// We can't use a priority for this, because 'low' is already used by the enter feature, unless\r\n\t\t// we'd use numeric priority in this case.\r\n\t\tthis.listenTo( this.editor.editing.view.document, 'enter', ( evt, data ) => {\r\n\t\t\tconst doc = this.editor.model.document;\r\n\t\t\tconst positionParent = doc.selection.getLastPosition().parent;\r\n\r\n\t\t\tif ( doc.selection.isCollapsed && positionParent.isEmpty && command.value ) {\r\n\t\t\t\tthis.editor.execute( 'blockQuote' );\r\n\t\t\t\tthis.editor.editing.view.scrollToTheSelection();\r\n\r\n\t\t\t\tdata.preventDefault();\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module block-quote/blockquoteui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport quoteIcon from '@ckeditor/ckeditor5-core/theme/icons/quote.svg';\nimport '../theme/blockquote.css';\n/**\r\n * The block quote UI plugin.\r\n *\r\n * It introduces the `'blockQuote'` button.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class BlockQuoteUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        editor.ui.componentFactory.add('blockQuote', locale => {\n            const command = editor.commands.get('blockQuote');\n            const buttonView = new ButtonView(locale);\n            buttonView.set({\n                label: t('d'),\n                icon: quoteIcon,\n                tooltip: true\n            });\n            // Bind button model to command.\n            buttonView.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n            // Execute command.\n            this.listenTo(buttonView, 'execute', () => editor.execute('blockQuote'));\n            return buttonView;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module ckfinder/ckfinderui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport browseFilesIcon from '../theme/icons/browse-files.svg';\n/**\r\n * The CKFinder UI plugin. It introduces he `'ckfinder'` toolbar button.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class CKFinderUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get pluginName() {\n        return 'CKFinderUI';\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const componentFactory = editor.ui.componentFactory;\n        const t = editor.t;\n        componentFactory.add('ckfinder', locale => {\n            const command = editor.commands.get('ckfinder');\n            const button = new ButtonView(locale);\n            button.set({\n                label: t('e'),\n                icon: browseFilesIcon,\n                tooltip: true\n            });\n            button.bind('isEnabled').to(command);\n            button.on('execute', () => {\n                editor.execute('ckfinder');\n                editor.editing.view.focus();\n            });\n            return button;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/notification/notification\r\n */\r\n\r\n/* globals window */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\n/**\r\n * The Notification plugin.\r\n *\r\n * This plugin sends few base types of notifications: `success`, `info` and `warning`. This notifications need to be\r\n * handled and displayed by plugin responsible for showing UI of the notifications. Using this plugin for dispatching\r\n * notifications makes possible to switch the notifications UI.\r\n *\r\n * Note that every unhandled and not stopped `warning` notification will be displayed as system alert.\r\n * See {@link module:ui/notification/notification~Notification#showWarning}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Notification extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Notification';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\t// Each unhandled and not stopped `show:warning` event is displayed as system alert.\r\n\t\tthis.on( 'show:warning', ( evt, data ) => {\r\n\t\t\twindow.alert( data.message ); // eslint-disable-line no-alert\r\n\t\t}, { priority: 'lowest' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Shows success notification.\r\n\t *\r\n\t * At default it fires `show:success` event with given data but event namespace can be extended\r\n\t * by `data.namespace` option e.g.\r\n\t *\r\n\t * \t\tshowSuccess( 'Image is uploaded.', {\r\n\t * \t\t\tnamespace: 'upload:image'\r\n\t * \t\t} );\r\n\t *\r\n\t * will fire `show:success:upload:image` event.\r\n\t * Title of the notification can be provided:\r\n\t *\r\n\t *\t\tshowSuccess( 'Image is uploaded.', {\r\n\t *\t\t\ttitle: 'Image upload success'\r\n\t *\t\t});\r\n\t *\r\n\t * @param {String} message Content of the notification.\r\n\t * @param {Object} [data={}] Additional data.\r\n\t * @param {String} [data.namespace] Additional event namespace.\r\n\t * @param {String} [data.title] Title of the notification.\r\n\t */\r\n\tshowSuccess( message, data = {} ) {\r\n\t\tthis._showNotification( {\r\n\t\t\tmessage,\r\n\t\t\ttype: 'success',\r\n\t\t\tnamespace: data.namespace,\r\n\t\t\ttitle: data.title\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Shows info notification.\r\n\t *\r\n\t * At default it fires `show:info` event with given data but event namespace can be extended\r\n\t * by `data.namespace` option e.g.\r\n\t *\r\n\t * \t\tshowInfo( 'Editor is offline.', {\r\n\t * \t\t\tnamespace: 'editor:status'\r\n\t * \t\t} );\r\n\t *\r\n\t * will fire `show:info:editor:status` event.\r\n\t * Title of the notification can be provided:\r\n\t *\r\n\t *\t\tshowInfo( 'Editor is offline.', {\r\n\t *\t\t\ttitle: 'Network information'\r\n\t *\t\t});\r\n\t *\r\n\t * @param {String} message Content of the notification.\r\n\t * @param {Object} [data={}] Additional data.\r\n\t * @param {String} [data.namespace] Additional event namespace.\r\n\t * @param {String} [data.title] Title of the notification.\r\n\t */\r\n\tshowInfo( message, data = {} ) {\r\n\t\tthis._showNotification( {\r\n\t\t\tmessage,\r\n\t\t\ttype: 'info',\r\n\t\t\tnamespace: data.namespace,\r\n\t\t\ttitle: data.title\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Shows warning notification.\r\n\t *\r\n\t * At default it fires `show:warning` event with given data but event namespace can be extended\r\n\t * by `data.namespace` option e.g.\r\n\t *\r\n\t * \t\tshowWarning( 'Image upload error.', {\r\n\t * \t\t\tnamespace: 'upload:image'\r\n\t * \t\t} );\r\n\t *\r\n\t * will fire `show:warning:upload:image` event.\r\n\t * Title of the notification can be provided:\r\n\t *\r\n\t *\t\tshowWarning( 'Image upload error.', {\r\n\t *\t\t\ttitle: 'Upload failed'\r\n\t *\t\t});\r\n\t *\r\n\t * Note that each unhandled and not stopped `warning` notification will be displayed as system alert.\r\n\t * Plugin responsible for displaying warnings should `stop()` the event to prevent of displaying it as alert:\r\n\t *\r\n\t * \t\tnotifications.on( 'show:warning', ( evt, data ) => {\r\n\t * \t\t\t// Do something with data.\r\n\t *\r\n\t * \t\t\t// Stop this event to prevent of displaying as alert.\r\n\t * \t\t\tevt.stop();\r\n\t * \t\t} );\r\n\t *\r\n\t * You can attach many listeners to the same event and `stop()` this event in the listener with the low priority:\r\n\t *\r\n\t * \t\tnotifications.on( 'show:warning', ( evt, data ) => {\r\n\t * \t\t\t// Show warning in the UI, but not stop it.\r\n\t * \t\t} );\r\n\t *\r\n\t * \t\tnotifications.on( 'show:warning', ( evt, data ) => {\r\n\t * \t\t\t// Log warning to some error tracker.\r\n\t *\r\n\t * \t\t\t// Stop this event to prevent of displaying as alert.\r\n\t * \t\t\tevt.stop();\r\n\t * \t\t}, { priority: 'low' } );\r\n\t *\r\n\t * @param {String} message Content of the notification.\r\n\t * @param {Object} [data={}] Additional data.\r\n\t * @param {String} [data.namespace] Additional event namespace.\r\n\t * @param {String} [data.title] Title of the notification.\r\n\t */\r\n\tshowWarning( message, data = {} ) {\r\n\t\tthis._showNotification( {\r\n\t\t\tmessage,\r\n\t\t\ttype: 'warning',\r\n\t\t\tnamespace: data.namespace,\r\n\t\t\ttitle: data.title\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Fires `show` event with specified type, namespace and message.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} data Message data.\r\n\t * @param {String} data.message Content of the notification.\r\n\t * @param {'success'|'info'|'warning'} data.type Type of message.\r\n\t * @param {String} [data.namespace] Additional event namespace.\r\n\t * @param {String} [data.title=''] Title of the notification.\r\n\t */\r\n\t_showNotification( data ) {\r\n\t\tconst event = `show:${ data.type }` + ( data.namespace ? `:${ data.namespace }` : '' );\r\n\r\n\t\tthis.fire( event, {\r\n\t\t\tmessage: data.message,\r\n\t\t\ttype: data.type,\r\n\t\t\ttitle: data.title || ''\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Fired when one of `showSuccess`, `showInfo`, `showWarning` methods is called.\r\n\t *\r\n\t * @event show\r\n\t * @param {Object} data Notification data.\r\n\t * @param {String} data.message Content of the notification.\r\n\t * @param {String} data.title Title of the notification.\r\n\t * @param {'success'|'info'|'warning'} data.type Type of notification.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `showSuccess` method is called.\r\n\t *\r\n\t * @event show:success\r\n\t * @param {Object} data Notification data.\r\n\t * @param {String} data.message Content of the notification.\r\n\t * @param {String} data.title Title of the notification.\r\n\t * @param {'success'} data.type Type of notification.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `showInfo` method is called.\r\n\t *\r\n\t * @event show:info\r\n\t * @param {Object} data Notification data.\r\n\t * @param {String} data.message Content of the notification.\r\n\t * @param {String} data.title Title of the notification.\r\n\t * @param {'info'} data.type Type of notification.\r\n\t */\r\n\r\n\t/**\r\n\t * Fired when `showWarning` method is called.\r\n\t *\r\n\t * When this event won't be handled and stopped by `event.stop()` then data.message of this event will\r\n\t * be automatically displayed as system alert.\r\n\t *\r\n\t * @event show:warning\r\n\t * @param {Object} data Notification data.\r\n\t * @param {String} data.message Content of the notification.\r\n\t * @param {String} data.title Title of the notification.\r\n\t * @param {'warning'} data.type Type of notification.\r\n\t */\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/* global window */\n/**\r\n * @module ckfinder/ckfindercommand\r\n */\nimport Command from '@ckeditor/ckeditor5-core/src/command';\nimport Notification from '@ckeditor/ckeditor5-ui/src/notification/notification';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\n/**\r\n * The CKFinder command. It is used by the {@link module:ckfinder/ckfinderediting~CKFinderEditing ckfinder editng feature}\r\n * to open a CKFinder file browser to insert an image or a link to a file into content.\r\n *\r\n *\t\teditor.execute( 'ckfinder' );\r\n *\r\n * @extends module:core/command~Command\r\n */\nexport default class CKFinderCommand extends Command {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    constructor(editor) {\n        super(editor);\n        // Remove default document listener to lower its priority.\n        this.stopListening(this.editor.model.document, 'change');\n        // Lower this command listener priority to be sure that refresh() will be called after link & image refresh.\n        this.listenTo(this.editor.model.document, 'change', () => this.refresh(), { priority: 'low' });\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    refresh() {\n        const imageCommand = this.editor.commands.get('imageUpload');\n        const linkCommand = this.editor.commands.get('link');\n        // The CKFinder command is enabled when one of image or link command is enabled.\n        this.isEnabled = imageCommand && linkCommand && (imageCommand.isEnabled || linkCommand.isEnabled);\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    execute() {\n        const editor = this.editor;\n        const openerMethod = this.editor.config.get('ckfinder.openerMethod') || 'modal';\n        if (openerMethod != 'popup' && openerMethod != 'modal') {\n            throw new CKEditorError('ckfinder-unknown-openerMethod: The openerMethod config option must by \"popup\" or \"modal\".');\n        }\n        const options = Object.assign({}, this.editor.config.get('ckfinder.options'));\n        options.chooseFiles = true;\n        // Cache the user-defined onInit method\n        const originalOnInit = options.onInit;\n        // Pass the lang code to the CKFinder if not defined by user.\n        if (!options.language) {\n            options.language = editor.locale.language;\n        }\n        // The onInit method allows to extend CKFinder's behavior. It is used to attach event listeners to file choosing related events.\n        options.onInit = finder => {\n            // Call original options.onInit if it was defined by user.\n            if (originalOnInit) {\n                originalOnInit();\n            }\n            finder.on('files:choose', evt => {\n                const files = evt.data.files.toArray();\n                // Insert links\n                const links = files.filter(file => !file.isImage());\n                const images = files.filter(file => file.isImage());\n                for (const linkFile of links) {\n                    editor.execute('link', linkFile.getUrl());\n                }\n                const imagesUrls = [];\n                for (const image of images) {\n                    const url = image.getUrl();\n                    imagesUrls.push(url ? url : finder.request('file:getProxyUrl', { file: image }));\n                }\n                if (imagesUrls.length) {\n                    insertImages(editor, imagesUrls);\n                }\n            });\n            finder.on('file:choose:resizedImage', evt => {\n                const resizedUrl = evt.data.resizedUrl;\n                if (!resizedUrl) {\n                    const notification = editor.plugins.get(Notification);\n                    const t = editor.locale.t;\n                    notification.showWarning(t('aq'), {\n                        title: t('ar'),\n                        namespace: 'ckfinder'\n                    });\n                    return;\n                }\n                insertImages(editor, [resizedUrl]);\n            });\n        };\n        window.CKFinder[openerMethod](options);\n    }\n}\nfunction insertImages(editor, urls) {\n    const imageCommand = editor.commands.get('imageUpload');\n    // Check if inserting an image is actually possible - it might be possible to only insert a link.\n    if (!imageCommand.isEnabled) {\n        const notification = editor.plugins.get(Notification);\n        const t = editor.locale.t;\n        notification.showWarning(t('as'), {\n            title: t('at'),\n            namespace: 'ckfinder'\n        });\n        return;\n    }\n    editor.execute('imageInsert', { source: urls });\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ckfinder/ckfinderediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Notification from '@ckeditor/ckeditor5-ui/src/notification/notification';\r\n\r\nimport CKFinderCommand from './ckfindercommand';\r\n\r\n/**\r\n * The CKFinder editing feature. It introduces the {@link module:ckfinder/ckfindercommand~CKFinderCommand ckfinder command}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class CKFinderEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'CKFinderEditing';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ Notification ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\teditor.commands.add( 'ckfinder', new CKFinderCommand( editor ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\n'use strict';\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\n\r\nconst BASE64_HEADER_REG_EXP = /^data:(\\S*?);base64,/;\r\n\r\n/**\r\n * FileUploader class used to upload single file.\r\n */\r\nclass FileUploader {\r\n\t/**\r\n\t * Creates `FileUploader` instance.\r\n\t *\r\n\t * @param {Blob|String} fileOrData A blob object or a data string encoded with Base64.\r\n\t * @param {Token} token Token used for authentication.\r\n\t * @param {String} apiAddress API address.\r\n\t */\r\n\tconstructor( fileOrData, token, apiAddress ) {\r\n\t\tif ( !fileOrData ) {\r\n\t\t\tthrow new Error( 'File must be provided' );\r\n\t\t}\r\n\r\n\t\tif ( !token ) {\r\n\t\t\tthrow new Error( 'Token must be provided' );\r\n\t\t}\r\n\r\n\t\tif ( !apiAddress ) {\r\n\t\t\tthrow new Error( 'Api address must be provided' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * A file that is being uploaded.\r\n\t\t *\r\n\t\t * @type {Blob}\r\n\t\t */\r\n\t\tthis.file = _isBase64( fileOrData ) ? _base64ToBlob( fileOrData ) : fileOrData;\r\n\r\n\t\t/**\r\n\t\t * CKEditor Cloud Services access token.\r\n\t\t *\r\n\t\t * @type {Token}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._token = token;\r\n\r\n\t\t/**\r\n\t\t * CKEditor Cloud Services API address.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._apiAddress = apiAddress;\r\n\t}\r\n\r\n\t/**\r\n\t * Registers callback on `progress` event.\r\n\t *\r\n\t * @chainable\r\n\t * @param {Function} callback\r\n\t * @returns {FileUploader}\r\n\t */\r\n\tonProgress( callback ) {\r\n\t\tthis.on( 'progress', ( event, data ) => callback( data ) );\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Registers callback on `error` event. Event is called once when error occurs.\r\n\t *\r\n\t * @chainable\r\n\t * @param {Function} callback\r\n\t * @returns {FileUploader}\r\n\t */\r\n\tonError( callback ) {\r\n\t\tthis.once( 'error', ( event, data ) => callback( data ) );\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Aborts upload process.\r\n\t */\r\n\tabort() {\r\n\t\tthis.xhr.abort();\r\n\t}\r\n\r\n\t/**\r\n\t * Sends XHR request to API.\r\n\t *\r\n\t * @chainable\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tsend() {\r\n\t\tthis._prepareRequest();\r\n\t\tthis._attachXHRListeners();\r\n\r\n\t\treturn this._sendRequest();\r\n\t}\r\n\r\n\t/**\r\n\t * Prepares XHR request.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_prepareRequest() {\r\n\t\tconst xhr = new XMLHttpRequest();\r\n\r\n\t\txhr.open( 'POST', this._apiAddress );\r\n\t\txhr.setRequestHeader( 'Authorization', this._token.value );\r\n\t\txhr.responseType = 'json';\r\n\r\n\t\tthis.xhr = xhr;\r\n\t}\r\n\r\n\t/**\r\n\t * Attaches listeners to the XHR.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_attachXHRListeners() {\r\n\t\tconst that = this;\r\n\t\tconst xhr = this.xhr;\r\n\r\n\t\txhr.addEventListener( 'error', onError( 'Network Error' ) );\r\n\t\txhr.addEventListener( 'abort', onError( 'Abort' ) );\r\n\r\n\t\t/* istanbul ignore else */\r\n\t\tif ( xhr.upload ) {\r\n\t\t\txhr.upload.addEventListener( 'progress', event => {\r\n\t\t\t\tif ( event.lengthComputable ) {\r\n\t\t\t\t\tthis.fire( 'progress', {\r\n\t\t\t\t\t\ttotal: event.total,\r\n\t\t\t\t\t\tuploaded: event.loaded\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\txhr.addEventListener( 'load', () => {\r\n\t\t\tconst statusCode = xhr.status;\r\n\t\t\tconst xhrResponse = xhr.response;\r\n\r\n\t\t\tif ( statusCode < 200 || statusCode > 299 ) {\r\n\t\t\t\treturn this.fire( 'error', xhrResponse.message || xhrResponse.error );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tfunction onError( message ) {\r\n\t\t\treturn () => that.fire( 'error', message );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sends XHR request.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_sendRequest() {\r\n\t\tconst formData = new FormData();\r\n\t\tconst xhr = this.xhr;\r\n\r\n\t\tformData.append( 'file', this.file );\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\t\t\txhr.addEventListener( 'load', () => {\r\n\t\t\t\tconst statusCode = xhr.status;\r\n\t\t\t\tconst xhrResponse = xhr.response;\r\n\r\n\t\t\t\tif ( statusCode < 200 || statusCode > 299 ) {\r\n\t\t\t\t\tif ( xhrResponse.message ) {\r\n\t\t\t\t\t\treturn reject( new Error( xhrResponse.message ) );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn reject( xhrResponse.error );\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn resolve( xhrResponse );\r\n\t\t\t} );\r\n\r\n\t\t\txhr.addEventListener( 'error', () => reject( new Error( 'Network Error' ) ) );\r\n\t\t\txhr.addEventListener( 'abort', () => reject( new Error( 'Abort' ) ) );\r\n\r\n\t\t\txhr.send( formData );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Fired when error occurs.\r\n\t *\r\n\t * @event error\r\n\t * @param {String} error Error message\r\n\t */\r\n\r\n\t/**\r\n\t * Fired on upload progress.\r\n\t *\r\n\t * @event progress\r\n\t * @param {Object} status Total and uploaded status\r\n\t */\r\n}\r\n\r\nmix( FileUploader, EmitterMixin );\r\n\r\n/**\r\n * Transforms Base64 string data into file.\r\n *\r\n * @param {String} base64 String data.\r\n * @param {Number} [sliceSize=512]\r\n * @returns {Blob}\r\n * @private\r\n */\r\nfunction _base64ToBlob( base64, sliceSize = 512 ) {\r\n\ttry {\r\n\t\tconst contentType = base64.match( BASE64_HEADER_REG_EXP )[ 1 ];\r\n\t\tconst base64Data = atob( base64.replace( BASE64_HEADER_REG_EXP, '' ) );\r\n\r\n\t\tconst byteArrays = [];\r\n\r\n\t\tfor ( let offset = 0; offset < base64Data.length; offset += sliceSize ) {\r\n\t\t\tconst slice = base64Data.slice( offset, offset + sliceSize );\r\n\t\t\tconst byteNumbers = new Array( slice.length );\r\n\r\n\t\t\tfor ( let i = 0; i < slice.length; i++ ) {\r\n\t\t\t\tbyteNumbers[ i ] = slice.charCodeAt( i );\r\n\t\t\t}\r\n\r\n\t\t\tbyteArrays.push( new Uint8Array( byteNumbers ) );\r\n\t\t}\r\n\r\n\t\treturn new Blob( byteArrays, { type: contentType } );\r\n\t} catch ( error ) {\r\n\t\tthrow new Error( 'Problem with decoding Base64 image data.' );\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks that string is Base64.\r\n *\r\n * @param {String} string\r\n * @returns {Boolean}\r\n * @private\r\n */\r\nfunction _isBase64( string ) {\r\n\tif ( typeof string !== 'string' ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst match = string.match( BASE64_HEADER_REG_EXP );\r\n\treturn !!( match && match.length );\r\n}\r\n\r\nexport default FileUploader;\r\n","/**\r\n * @license Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\n'use strict';\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\n\r\nconst DEFAULT_OPTIONS = { refreshInterval: 3600000, autoRefresh: true };\r\n\r\n/**\r\n * Class representing the token used for communication with CKEditor Cloud Services.\r\n * Value of the token is retrieving from the specified URL and is refreshed every 1 hour by default.\r\n *\r\n * @mixes ObservableMixin\r\n */\r\nclass Token {\r\n\t/**\r\n\t * Creates `Token` instance.\r\n\t * Method `init` should be called after using the constructor or use `create` method instead.\r\n\t *\r\n\t * @param {String|Function} tokenUrlOrRefreshToken Endpoint address to download the token or a callback that provides the token. If the\r\n\t * value is a function it has to match the {@link ~refreshToken} interface.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.initValue] Initial value of the token.\r\n\t * @param {Number} [options.refreshInterval=3600000] Delay between refreshes. Default 1 hour.\r\n\t * @param {Boolean} [options.autoRefresh=true] Specifies whether to start the refresh automatically.\r\n\t */\r\n\tconstructor( tokenUrlOrRefreshToken, options = DEFAULT_OPTIONS ) {\r\n\t\tif ( !tokenUrlOrRefreshToken ) {\r\n\t\t\tthrow new Error( 'A `tokenUrl` must be provided as the first constructor argument.' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Value of the token.\r\n\t\t * The value of the token is null if `initValue` is not provided or `init` method was not called.\r\n\t\t * `create` method creates token with initialized value from url.\r\n\t\t *\r\n\t\t * @name value\r\n\t\t * @member {String} #value\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t */\r\n\t\tthis.set( 'value', options.initValue );\r\n\r\n\t\t/**\r\n\t\t * Base refreshing function.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {String|Function} #_refresh\r\n\t\t */\r\n\t\tif ( typeof tokenUrlOrRefreshToken === 'function' ) {\r\n\t\t\tthis._refresh = tokenUrlOrRefreshToken;\r\n\t\t} else {\r\n\t\t\tthis._refresh = () => defaultRefreshToken( tokenUrlOrRefreshToken );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._options = Object.assign( {}, DEFAULT_OPTIONS, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the token.\r\n\t *\r\n\t * @returns {Promise.<Token>}\r\n\t */\r\n\tinit() {\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\t\t\tif ( this._options.autoRefresh ) {\r\n\t\t\t\tthis._startRefreshing();\r\n\t\t\t}\r\n\r\n\t\t\tif ( !this.value ) {\r\n\t\t\t\tthis._refreshToken()\r\n\t\t\t\t\t.then( resolve )\r\n\t\t\t\t\t.catch( reject );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tresolve( this );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Refresh token method. Useful in a method form as it can be override in tests.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_refreshToken() {\r\n\t\treturn this._refresh()\r\n\t\t\t.then( value => this.set( 'value', value ) )\r\n\t\t\t.then( () => this );\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys token instance. Stops refreshing.\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._stopRefreshing();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts value refreshing every `refreshInterval` time.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_startRefreshing() {\r\n\t\tthis._refreshInterval = setInterval( () => this._refreshToken(), this._options.refreshInterval );\r\n\t}\r\n\r\n\t/**\r\n\t * Stops value refreshing.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\t_stopRefreshing() {\r\n\t\tclearInterval( this._refreshInterval );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a initialized {@link Token} instance.\r\n\t *\r\n\t * @param {String|Function} tokenUrlOrRefreshToken Endpoint address to download the token or a callback that provides the token. If the\r\n\t * value is a function it has to match the {@link ~refreshToken} interface.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.initValue] Initial value of the token.\r\n\t * @param {Number} [options.refreshInterval=3600000] Delay between refreshes. Default 1 hour.\r\n\t * @param {Boolean} [options.autoRefresh=true] Specifies whether to start the refresh automatically.\r\n\t * @returns {Promise.<Token>}\r\n\t */\r\n\tstatic create( tokenUrlOrRefreshToken, options = DEFAULT_OPTIONS ) {\r\n\t\tconst token = new Token( tokenUrlOrRefreshToken, options );\r\n\r\n\t\treturn token.init();\r\n\t}\r\n}\r\n\r\nmix( Token, ObservableMixin );\r\n\r\n/**\r\n * This function is called in a defined interval by the {@link ~Token} class.\r\n * It should return a promise, which resolves with the new token value.\r\n * If any error occurs it should return a rejected promise with an error message.\r\n *\r\n * @function refreshToken\r\n * @returns {Promise.<String>}\r\n */\r\n\r\n/**\r\n * @private\r\n * @param {String} tokenUrl\r\n */\r\nfunction defaultRefreshToken( tokenUrl ) {\r\n\treturn new Promise( ( resolve, reject ) => {\r\n\t\tconst xhr = new XMLHttpRequest();\r\n\r\n\t\txhr.open( 'GET', tokenUrl );\r\n\r\n\t\txhr.addEventListener( 'load', () => {\r\n\t\t\tconst statusCode = xhr.status;\r\n\t\t\tconst xhrResponse = xhr.response;\r\n\r\n\t\t\tif ( statusCode < 200 || statusCode > 299 ) {\r\n\t\t\t\treturn reject( new Error( 'Cannot download new token!' ) );\r\n\t\t\t}\r\n\r\n\t\t\treturn resolve( xhrResponse );\r\n\t\t} );\r\n\r\n\t\txhr.addEventListener( 'error', () => reject( new Error( 'Network Error' ) ) );\r\n\t\txhr.addEventListener( 'abort', () => reject( new Error( 'Abort' ) ) );\r\n\r\n\t\txhr.send();\r\n\t} );\r\n};\r\n\r\nexport default Token;\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module cloud-services/cloudservices\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Token from '@ckeditor/ckeditor-cloud-services-core/src/token/token';\r\n\r\n/**\r\n * Plugin introducing CKEditor 5's Cloud Services integration.\r\n *\r\n * It initializes the token provider based on\r\n * the {@link module:cloud-services/cloudservices~CloudServicesConfig `config.cloudService`}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class CloudServices extends Plugin {\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'CloudServices';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst config = editor.config;\r\n\r\n\t\tconst options = config.get( 'cloudServices' ) || {};\r\n\r\n\t\tfor ( const optionName in options ) {\r\n\t\t\tthis[ optionName ] = options[ optionName ];\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * The authentication token URL for CKEditor Cloud Services or a callback to the token value promise. See the\r\n\t\t * {@link module:cloud-services/cloudservices~CloudServicesConfig#tokenUrl} for more details.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String|Function|undefined} #tokenUrl\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * The URL to which the files should be uploaded.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} #uploadUrl\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Other plugins use this token for the authorization process. It handles token requesting and refreshing.\r\n\t\t * Its value is `null` when {@link module:cloud-services/cloudservices~CloudServicesConfig#tokenUrl} is not provided.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Object|null} #token\r\n\t\t */\r\n\r\n\t\tif ( !this.tokenUrl ) {\r\n\t\t\tthis.token = null;\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.token = new CloudServices.Token( this.tokenUrl );\r\n\r\n\t\treturn this.token.init();\r\n\t}\r\n}\r\n\r\nCloudServices.Token = Token;\r\n\r\n/**\r\n * The configuration of CKEditor Cloud Services. Introduced by the {@link module:cloud-services/cloudservices~CloudServices} plugin.\r\n *\r\n * Read more in {@link module:cloud-services/cloudservices~CloudServicesConfig}.\r\n *\r\n * @member {module:cloud-services/cloudservices~CloudServicesConfig} module:core/editor/editorconfig~EditorConfig#cloudServices\r\n */\r\n\r\n/**\r\n * The configuration for all plugins using CKEditor Cloud Services.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( document.querySelector( '#editor' ), {\r\n *\t\t\t\tcloudServices: {\r\n *\t\t\t\t\ttokenUrl: 'https://example.com/cs-token-endpoint',\r\n *\t\t\t\t\tuploadUrl: 'https://your-organization-id.cke-cs.com/easyimage/upload/'\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface CloudServicesConfig\r\n */\r\n\r\n/**\r\n * A token URL or a token request function.\r\n *\r\n * As a string it should be a URL to the security token endpoint in your application. The role of this endpoint is to securely authorize the\r\n * end users of your application to use [CKEditor Cloud Services](https://ckeditor.com/ckeditor-cloud-services), only\r\n * if they should have access e.g. to upload files with Easy Image or to access the Collaboraation service.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( document.querySelector( '#editor' ), {\r\n *\t\t\t\tcloudServices: {\r\n *\t\t\t\t\ttokenUrl: 'https://example.com/cs-token-endpoint',\r\n *\t\t\t\t\t...\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * As a function it should provide a promise to the token value, so you can highly customize the token and provide your token URL endpoint.\r\n * By using that approach you can set your own headers to the request.\r\n *\r\n * \t\tClassicEditor\r\n *\t\t\t.create( document.querySelector( '#editor' ), {\r\n *\t\t\t\tcloudServices: {\r\n *\t\t\t\t\ttokenUrl: () => new Promise( ( resolve, reject ) => {\r\n *\t\t\t\t\t\tconst xhr = new XMLHttpRequest();\r\n *\r\n *\t\t\t\t\t\txhr.open( 'GET', 'https://example.com/cs-token-endpoint' );\r\n *\r\n *\t\t\t\t\t\txhr.addEventListener( 'load', () => {\r\n *\t\t\t\t\t\t\tconst statusCode = xhr.status;\r\n *\t\t\t\t\t\t\tconst xhrResponse = xhr.response;\r\n *\r\n *\t\t\t\t\t\t\tif ( statusCode < 200 || statusCode > 299 ) {\r\n *\t\t\t\t\t\t\t\treturn reject( new Error( 'Cannot download new token!' ) );\r\n *\t\t\t\t\t\t\t}\r\n *\r\n *\t\t\t\t\t\t\treturn resolve( xhrResponse );\r\n *\t\t\t\t\t\t} );\r\n *\r\n *\t\t\t\t\t\txhr.addEventListener( 'error', () => reject( new Error( 'Network Error' ) ) );\r\n *\t\t\t\t\t\txhr.addEventListener( 'abort', () => reject( new Error( 'Abort' ) ) );\r\n *\r\n *\t\t\t\t\t\txhr.setRequestHeader( customHeader, customValue );\r\n *\r\n *\t\t\t\t\t\txhr.send();\r\n *\t\t\t\t\t} ),\r\n *\t\t\t\t\t...\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\r\n * You can find more information about token endpoints in the\r\n * {@glink @cs guides/easy-image/quick-start#create-token-endpoint Cloud Services - Quick start}\r\n * and {@glink @cs guides/token-endpoints/tokenendpoint Cloud Services - Creating token endpoint} documentation.\r\n *\r\n * Without a properly working token endpoint (token URL) CKEditor plugins will not be able to connect to CKEditor Cloud Services.\r\n *\r\n * @member {String|Function} module:cloud-services/cloudservices~CloudServicesConfig#tokenUrl\r\n */\r\n\r\n/**\r\n * The endpoint URL for [CKEditor Cloud Services](https://ckeditor.com/ckeditor-cloud-services) uploads.\r\n * This option must be set for Easy Image to work correctly.\r\n *\r\n * The upload URL is unique for each customer and can be found in the [CKEditor Ecosystem dashboard](https://dashboard.ckeditor.com)\r\n * after subscribing to Easy Image service.\r\n * To learn how to start using Easy Image check {@glink @cs guides/easy-image/quick-start Easy Image - Quick start} documentation.\r\n *\r\n * Note: Make sure to also set the {@link module:cloud-services/cloudservices~CloudServicesConfig#tokenUrl} configuration option.\r\n *\r\n * @member {String} module:cloud-services/cloudservices~CloudServicesConfig#uploadUrl\r\n */\r\n\r\n/**\r\n * The URL for web socket communication, used by `RealTimeCollaborativeEditing` plugin. Every customer (organization in the CKEditor\r\n * Ecosystem dashboard) has its own, unique URLs to communicate with CKEditor Cloud Services. The URL can be found in the\r\n * CKEditor Ecosystem dashboard.\r\n *\r\n * Note: unlike most plugins, `RealTimeCollaborativeEditing` is not included in any CKEditor 5 build and has to be installed manually.\r\n * Check [Collaboration overview](https://ckeditor.com/docs/ckeditor5/latest/features/collaboration/overview.html) for more details.\r\n *\r\n * @member {String} module:cloud-services/cloudservices~CloudServicesConfig#webSocketUrl\r\n */\r\n\r\n/**\r\n * Document ID, used by `RealTimeCollaborativeEditing` plugin. All editor instances created with the same document ID will collaborate.\r\n * It means that each document needs a different document ID if you do not want to start collaboration between these documents.\r\n * The ID is usually a primary key of the document in the database, but you are free to provide whatever identifier fits your scenario.\r\n *\r\n * Note: unlike most plugins, `RealTimeCollaborativeEditing` is not included in any CKEditor 5 build and has to be installed manually.\r\n * Check [Collaboration overview](https://ckeditor.com/docs/ckeditor5/latest/features/collaboration/overview.html) for more details.\r\n *\r\n * @member {String} module:cloud-services/cloudservices~CloudServicesConfig#documentId\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n* @module easy-image/cloudservicesuploadadapter\r\n*/\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport FileRepository from '@ckeditor/ckeditor5-upload/src/filerepository';\r\nimport UploadGateway from '@ckeditor/ckeditor-cloud-services-core/src/uploadgateway/uploadgateway';\r\nimport CloudServices from '@ckeditor/ckeditor5-cloud-services/src/cloudservices';\r\n\r\n/**\r\n * A plugin that enables upload to [CKEditor Cloud Services](https://ckeditor.com/ckeditor-cloud-services/).\r\n *\r\n * It is mainly used by the {@link module:easy-image/easyimage~EasyImage} feature.\r\n *\r\n * After enabling this adapter you need to configure the CKEditor Cloud Services integration through\r\n * {@link module:cloud-services/cloudservices~CloudServicesConfig `config.cloudServices`}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class CloudServicesUploadAdapter extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ FileRepository, CloudServices ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\tconst cloudServices = editor.plugins.get( CloudServices );\r\n\r\n\t\tconst token = cloudServices.token;\r\n\t\tconst uploadUrl = cloudServices.uploadUrl;\r\n\r\n\t\tif ( !token ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._uploadGateway = new CloudServicesUploadAdapter._UploadGateway( token, uploadUrl );\r\n\r\n\t\teditor.plugins.get( FileRepository ).createUploadAdapter = loader => {\r\n\t\t\treturn new Adapter( this._uploadGateway, loader );\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * @private\r\n */\r\nclass Adapter {\r\n\tconstructor( uploadGateway, loader ) {\r\n\t\tthis.uploadGateway = uploadGateway;\r\n\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tupload() {\r\n\t\tthis.fileUploader = this.uploadGateway.upload( this.loader.file );\r\n\r\n\t\tthis.fileUploader.on( 'progress', ( evt, data ) => {\r\n\t\t\tthis.loader.uploadTotal = data.total;\r\n\t\t\tthis.loader.uploaded = data.uploaded;\r\n\t\t} );\r\n\r\n\t\treturn this.fileUploader.send();\r\n\t}\r\n\r\n\tabort() {\r\n\t\tthis.fileUploader.abort();\r\n\t}\r\n}\r\n\r\n// Store the API in static property to easily overwrite it in tests.\r\n// Too bad dependency injection does not work in Webpack + ES 6 (const) + Babel.\r\nCloudServicesUploadAdapter._UploadGateway = UploadGateway;\r\n","/**\r\n * @license Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n'use strict';\r\n\r\nimport FileUploader from './fileuploader';\r\n\r\n/**\r\n * UploadGateway abstracts file uploads to CKEditor Cloud Services.\r\n */\r\nexport default class UploadGateway {\r\n\t/**\r\n\t * Creates `UploadGateway` instance.\r\n\t *\r\n\t * @param {Token} token Token used for authentication.\r\n\t * @param {String} apiAddress API address.\r\n\t */\r\n\tconstructor( token, apiAddress ) {\r\n\t\tif ( !token ) {\r\n\t\t\tthrow new Error( 'Token must be provided' );\r\n\t\t}\r\n\r\n\t\tif ( !apiAddress ) {\r\n\t\t\tthrow new Error( 'Api address must be provided' );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * CKEditor Cloud Services access token.\r\n\t\t *\r\n\t\t * @type {Token}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._token = token;\r\n\r\n\t\t/**\r\n\t\t * CKEditor Cloud Services API address.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._apiAddress = apiAddress;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link FileUploader} instance that wraps file upload process.\r\n\t * The file is being sent at a time when the method {@link FileUploader#then then} is called\r\n\t * or when {@link FileUploader#send send} method is called.\r\n\t *\r\n\t *     const token = await Token.create( 'https://token-endpoint' );\r\n\t *     new UploadGateway( token, 'https://example.org' )\r\n\t *        .upload( 'FILE' )\r\n\t *        .onProgress( ( data ) => console.log( data ) )\r\n\t *        .send()\r\n\t *        .then( ( response ) => console.log( response ) );\r\n\t *\r\n\t *     // OR\r\n\t *\r\n\t *     const token = await Token.create( 'https://token-endpoint' );\r\n\t *     new UploadGateway( token, 'https://example.org' )\r\n\t *         .upload( 'FILE' )\r\n\t *         .onProgress( ( data ) => console.log( data ) )\r\n\t *         .send()\r\n\t *         .then( ( response ) => console.log( response ) );\r\n\t *\r\n\t * @param {Blob/String} fileOrData A blob object or a data string encoded with Base64.\r\n\t * @returns {FileUploader} Returns `FileUploader` instance.\r\n\t */\r\n\tupload( fileOrData ) {\r\n\t\treturn new FileUploader( fileOrData, this._token, this._apiAddress );\r\n\t}\r\n}\r\n\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/image/imageloadobserver\r\n */\r\n\r\nimport Observer from '@ckeditor/ckeditor5-engine/src/view/observer/observer';\r\n\r\n/**\r\n * Observes all new images added to the {@link module:engine/view/document~Document},\r\n * fires {@link module:engine/view/document~Document#event:imageLoaded} and\r\n * {@link module:engine/view/document~Document#event:layoutChanged} event every time when the new image\r\n * has been loaded.\r\n *\r\n * **Note:** This event is not fired for images that has been added to the document and rendered as `complete` (already loaded).\r\n *\r\n * @extends module:engine/view/observer/observer~Observer\r\n */\r\nexport default class ImageLoadObserver extends Observer {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\t/**\r\n\t\t * List of img DOM elements that are observed by this observer.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Set.<HTMLElement>}\r\n\t\t */\r\n\t\tthis._observedElements = new Set();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tobserve( domRoot, name ) {\r\n\t\tconst viewRoot = this.document.getRoot( name );\r\n\r\n\t\t// When there is a change in one of the view element\r\n\t\t// we need to check if there are any new `<img/>` elements to observe.\r\n\t\tviewRoot.on( 'change:children', ( evt, node ) => {\r\n\t\t\t// Wait for the render to be sure that `<img/>` elements are rendered in the DOM root.\r\n\t\t\tthis.view.once( 'render', () => this._updateObservedElements( domRoot, node ) );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the list of observed `<img/>` elements.\r\n\t *\r\n\t * @private\r\n\t * @param {HTMLElement} domRoot DOM root element.\r\n\t * @param {module:engine/view/element~Element} viewNode View element where children have changed.\r\n\t */\r\n\t_updateObservedElements( domRoot, viewNode ) {\r\n\t\tif ( !viewNode.is( 'element' ) || viewNode.is( 'attributeElement' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst domNode = this.view.domConverter.mapViewToDom( viewNode );\r\n\r\n\t\t// If there is no `domNode` it means that it was removed from the DOM in the meanwhile.\r\n\t\tif ( !domNode ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor ( const domElement of domNode.querySelectorAll( 'img' ) ) {\r\n\t\t\tif ( !this._observedElements.has( domElement ) ) {\r\n\t\t\t\tthis.listenTo( domElement, 'load', ( evt, domEvt ) => this._fireEvents( domEvt ) );\r\n\t\t\t\tthis._observedElements.add( domElement );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clean up the list of observed elements from elements that has been removed from the root.\r\n\t\tfor ( const domElement of this._observedElements ) {\r\n\t\t\tif ( !domRoot.contains( domElement ) ) {\r\n\t\t\t\tthis.stopListening( domElement );\r\n\t\t\t\tthis._observedElements.delete( domElement );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Fires {@link module:engine/view/document~Document#event:layoutChanged} and\r\n\t * {@link module:engine/view/document~Document#event:imageLoaded}\r\n\t * if observer {@link #isEnabled is enabled}.\r\n\t *\r\n\t * @protected\r\n\t * @param {Event} domEvent The DOM event.\r\n\t */\r\n\t_fireEvents( domEvent ) {\r\n\t\tif ( this.isEnabled ) {\r\n\t\t\tthis.document.fire( 'layoutChanged' );\r\n\t\t\tthis.document.fire( 'imageLoaded', domEvent );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._observedElements.clear();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when an <img/> DOM element has been loaded in the DOM root.\r\n *\r\n * Introduced by {@link module:image/image/imageloadobserver~ImageLoadObserver}.\r\n *\r\n * @see module:image/image/imageloadobserver~ImageLoadObserver\r\n * @event module:engine/view/document~Document#event:imageLoaded\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/image/converters\r\n */\r\n\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * Returns a function that converts the image view representation:\r\n *\r\n *\t\t<figure class=\"image\"><img src=\"...\" alt=\"...\"></img></figure>\r\n *\r\n * to the model representation:\r\n *\r\n *\t\t<image src=\"...\" alt=\"...\"></image>\r\n *\r\n * The entire content of the `<figure>` element except the first `<img>` is being converted as children\r\n * of the `<image>` model element.\r\n *\r\n * @returns {Function}\r\n */\r\nexport function viewFigureToModel() {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'element:figure', converter );\r\n\t};\r\n\r\n\tfunction converter( evt, data, conversionApi ) {\r\n\t\t// Do not convert if this is not an \"image figure\".\r\n\t\tif ( !conversionApi.consumable.test( data.viewItem, { name: true, classes: 'image' } ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Find an image element inside the figure element.\r\n\t\tconst viewImage = Array.from( data.viewItem.getChildren() ).find( viewChild => viewChild.is( 'img' ) );\r\n\r\n\t\t// Do not convert if image element is absent, is missing src attribute or was already converted.\r\n\t\tif ( !viewImage || !viewImage.hasAttribute( 'src' ) || !conversionApi.consumable.test( viewImage, { name: true } ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Convert view image to model image.\r\n\t\tconst conversionResult = conversionApi.convertItem( viewImage, data.modelCursor );\r\n\r\n\t\t// Get image element from conversion result.\r\n\t\tconst modelImage = first( conversionResult.modelRange.getItems() );\r\n\r\n\t\t// When image wasn't successfully converted then finish conversion.\r\n\t\tif ( !modelImage ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Convert rest of the figure element's children as an image children.\r\n\t\tconversionApi.convertChildren( data.viewItem, conversionApi.writer.createPositionAt( modelImage, 0 ) );\r\n\r\n\t\t// Set image range as conversion result.\r\n\t\tdata.modelRange = conversionResult.modelRange;\r\n\r\n\t\t// Continue conversion where image conversion ends.\r\n\t\tdata.modelCursor = conversionResult.modelCursor;\r\n\t}\r\n}\r\n\r\n/**\r\n * Converter used to convert the `srcset` model image attribute to the `srcset`, `sizes` and `width` attributes in the view.\r\n *\r\n * @returns {Function}\r\n */\r\nexport function srcsetAttributeConverter() {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'attribute:srcset:image', converter );\r\n\t};\r\n\r\n\tfunction converter( evt, data, conversionApi ) {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst writer = conversionApi.writer;\r\n\t\tconst figure = conversionApi.mapper.toViewElement( data.item );\r\n\t\tconst img = figure.getChild( 0 );\r\n\r\n\t\tif ( data.attributeNewValue === null ) {\r\n\t\t\tconst srcset = data.attributeOldValue;\r\n\r\n\t\t\tif ( srcset.data ) {\r\n\t\t\t\twriter.removeAttribute( 'srcset', img );\r\n\t\t\t\twriter.removeAttribute( 'sizes', img );\r\n\r\n\t\t\t\tif ( srcset.width ) {\r\n\t\t\t\t\twriter.removeAttribute( 'width', img );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst srcset = data.attributeNewValue;\r\n\r\n\t\t\tif ( srcset.data ) {\r\n\t\t\t\twriter.setAttribute( 'srcset', srcset.data, img );\r\n\t\t\t\t// Always outputting `100vw`. See https://github.com/ckeditor/ckeditor5-image/issues/2.\r\n\t\t\t\twriter.setAttribute( 'sizes', '100vw', img );\r\n\r\n\t\t\t\tif ( srcset.width ) {\r\n\t\t\t\t\twriter.setAttribute( 'width', srcset.width, img );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function modelToViewAttributeConverter( attributeKey ) {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( `attribute:${ attributeKey }:image`, converter );\r\n\t};\r\n\r\n\tfunction converter( evt, data, conversionApi ) {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst figure = conversionApi.mapper.toViewElement( data.item );\r\n\t\tconst img = figure.getChild( 0 );\r\n\r\n\t\tif ( data.attributeNewValue !== null ) {\r\n\t\t\tviewWriter.setAttribute( data.attributeKey, data.attributeNewValue, img );\r\n\t\t} else {\r\n\t\t\tviewWriter.removeAttribute( data.attributeKey, img );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module widget/highlightstack\r\n */\r\n\r\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\n\r\n/**\r\n * Class used to handle correct order of highlights on elements.\r\n *\r\n * When different highlights are applied to same element correct order should be preserved:\r\n *\r\n * * highlight with highest priority should be applied,\r\n * * if two highlights have same priority - sort by CSS class provided in\r\n * {@link module:engine/conversion/downcast-converters~HighlightDescriptor}.\r\n *\r\n * This way, highlight will be applied with the same rules it is applied on texts.\r\n */\r\nexport default class HighlightStack {\r\n\t/**\r\n\t * Creates class instance.\r\n\t */\r\n\tconstructor() {\r\n\t\tthis._stack = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds highlight descriptor to the stack.\r\n\t *\r\n\t * @fires change:top\r\n\t * @param {module:engine/conversion/downcast-converters~HighlightDescriptor} descriptor\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n\t */\r\n\tadd( descriptor, writer ) {\r\n\t\tconst stack = this._stack;\r\n\r\n\t\t// Save top descriptor and insert new one. If top is changed - fire event.\r\n\t\tconst oldTop = stack[ 0 ];\r\n\t\tthis._insertDescriptor( descriptor );\r\n\t\tconst newTop = stack[ 0 ];\r\n\r\n\t\t// When new object is at the top and stores different information.\r\n\t\tif ( oldTop !== newTop && !compareDescriptors( oldTop, newTop ) ) {\r\n\t\t\tthis.fire( 'change:top', {\r\n\t\t\t\toldDescriptor: oldTop,\r\n\t\t\t\tnewDescriptor: newTop,\r\n\t\t\t\twriter\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes highlight descriptor from the stack.\r\n\t *\r\n\t * @fires change:top\r\n\t * @param {String} id Id of the descriptor to remove.\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n\t */\r\n\tremove( id, writer ) {\r\n\t\tconst stack = this._stack;\r\n\r\n\t\tconst oldTop = stack[ 0 ];\r\n\t\tthis._removeDescriptor( id );\r\n\t\tconst newTop = stack[ 0 ];\r\n\r\n\t\t// When new object is at the top and stores different information.\r\n\t\tif ( oldTop !== newTop && !compareDescriptors( oldTop, newTop ) ) {\r\n\t\t\tthis.fire( 'change:top', {\r\n\t\t\t\toldDescriptor: oldTop,\r\n\t\t\t\tnewDescriptor: newTop,\r\n\t\t\t\twriter\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts given descriptor in correct place in the stack. It also takes care about updating information when\r\n\t * descriptor with same id is already present.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/conversion/downcast-converters~HighlightDescriptor} descriptor\r\n\t */\r\n\t_insertDescriptor( descriptor ) {\r\n\t\tconst stack = this._stack;\r\n\t\tconst index = stack.findIndex( item => item.id === descriptor.id );\r\n\r\n\t\t// Inserting exact same descriptor - do nothing.\r\n\t\tif ( compareDescriptors( descriptor, stack[ index ] ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If descriptor with same id but with different information is on the stack - remove it.\r\n\t\tif ( index > -1 ) {\r\n\t\t\tstack.splice( index, 1 );\r\n\t\t}\r\n\r\n\t\t// Find correct place to insert descriptor in the stack.\r\n\t\t// It have different information (for example priority) so it must be re-inserted in correct place.\r\n\t\tlet i = 0;\r\n\r\n\t\twhile ( stack[ i ] && shouldABeBeforeB( stack[ i ], descriptor ) ) {\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\tstack.splice( i, 0, descriptor );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes descriptor with given id from the stack.\r\n\t *\r\n\t * @private\r\n\t * @param {String} id Descriptor's id.\r\n\t */\r\n\t_removeDescriptor( id ) {\r\n\t\tconst stack = this._stack;\r\n\t\tconst index = stack.findIndex( item => item.id === id );\r\n\r\n\t\t// If descriptor with same id is on the list - remove it.\r\n\t\tif ( index > -1 ) {\r\n\t\t\tstack.splice( index, 1 );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmix( HighlightStack, EmitterMixin );\r\n\r\n// Compares two descriptors by checking their priority and class list.\r\n//\r\n// @param {module:engine/conversion/downcast-converters~HighlightDescriptor} a\r\n// @param {module:engine/conversion/downcast-converters~HighlightDescriptor} b\r\n// @returns {Boolean} Returns true if both descriptors are defined and have same priority and classes.\r\nfunction compareDescriptors( a, b ) {\r\n\treturn a && b && a.priority == b.priority && classesToString( a.classes ) == classesToString( b.classes );\r\n}\r\n\r\n// Checks whenever first descriptor should be placed in the stack before second one.\r\n//\r\n// @param {module:engine/conversion/downcast-converters~HighlightDescriptor} a\r\n// @param {module:engine/conversion/downcast-converters~HighlightDescriptor} b\r\n// @returns {Boolean}\r\nfunction shouldABeBeforeB( a, b ) {\r\n\tif ( a.priority > b.priority ) {\r\n\t\treturn true;\r\n\t} else if ( a.priority < b.priority ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// When priorities are equal and names are different - use classes to compare.\r\n\treturn classesToString( a.classes ) > classesToString( b.classes );\r\n}\r\n\r\n// Converts CSS classes passed with {@link module:engine/conversion/downcast-converters~HighlightDescriptor} to\r\n// sorted string.\r\n//\r\n// @param {String|Array<String>} descriptor\r\n// @returns {String}\r\nfunction classesToString( classes ) {\r\n\treturn Array.isArray( classes ) ? classes.sort().join( ',' ) : classes;\r\n}\r\n\r\n/**\r\n * Fired when top element on {@link module:widget/highlightstack~HighlightStack} has been changed\r\n *\r\n * @event change:top\r\n * @param {Object} data Additional information about the change.\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor} [data.newDescriptor] New highlight\r\n * descriptor. It will be `undefined` when last descriptor is removed from the stack.\r\n * @param {module:engine/conversion/downcast-converters~HighlightDescriptor} [data.oldDescriptor] Old highlight\r\n * descriptor. It will be `undefined` when first descriptor is added to the stack.\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer View writer that can be used to modify element.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module widget/utils\r\n */\r\n\r\nimport HighlightStack from './highlightstack';\r\nimport IconView from '@ckeditor/ckeditor5-ui/src/icon/iconview';\r\nimport env from '@ckeditor/ckeditor5-utils/src/env';\r\n\r\nimport dragHandlerIcon from '../theme/icons/drag-handler.svg';\r\n\r\nconst widgetSymbol = Symbol( 'isWidget' );\r\nconst labelSymbol = Symbol( 'label' );\r\n\r\n/**\r\n * CSS class added to each widget element.\r\n *\r\n * @const {String}\r\n */\r\nexport const WIDGET_CLASS_NAME = 'ck-widget';\r\n\r\n/**\r\n * CSS class added to currently selected widget element.\r\n *\r\n * @const {String}\r\n */\r\nexport const WIDGET_SELECTED_CLASS_NAME = 'ck-widget_selected';\r\n\r\n/**\r\n * Returns `true` if given {@link module:engine/view/node~Node} is an {@link module:engine/view/element~Element} and a widget.\r\n *\r\n * @param {module:engine/view/node~Node} node\r\n * @returns {Boolean}\r\n */\r\nexport function isWidget( node ) {\r\n\tif ( !node.is( 'element' ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn !!node.getCustomProperty( widgetSymbol );\r\n}\r\n\r\n/**\r\n * Converts the given {@link module:engine/view/element~Element} to a widget in the following way:\r\n *\r\n * * sets the `contenteditable` attribute to `\"true\"`,\r\n * * adds the `ck-widget` CSS class,\r\n * * adds a custom {@link module:engine/view/element~Element#getFillerOffset `getFillerOffset()`} method returning `null`,\r\n * * adds a custom property allowing to recognize widget elements by using {@link ~isWidget `isWidget()`},\r\n * * implements the {@link ~setHighlightHandling view highlight on widgets}.\r\n *\r\n * This function needs to be used in conjuction with {@link module:engine/conversion/downcast-converters downcast converters}\r\n * like {@link module:engine/conversion/downcast-converters~downcastElementToElement `downcastElementToElement()`}.\r\n * Moreover, typically you will want to use `toWidget()` only for `editingDowncast`, while keeping the `dataDowncast` clean.\r\n *\r\n * For example, in order to convert a `<widget>` model element to `<div class=\"widget\">` in the view, you can define\r\n * such converters:\r\n *\r\n *\t\teditor.conversion.for( 'editingDowncast' )\r\n *\t\t\t.add( downcastElementToElement( {\r\n *\t\t\t\tmodel: 'widget',\r\n *\t\t\t\tview: ( modelItem, writer ) => {\r\n *\t\t\t\t\tconst div = writer.createContainerElement( 'div', { class: 'widget' } );\r\n *\r\n *\t\t\t\t\treturn toWidget( div, writer, { label: 'some widget' } );\r\n *\t\t\t\t}\r\n *\t\t\t} ) );\r\n *\r\n *\t\teditor.conversion.for( 'dataDowncast' )\r\n *\t\t\t.add( downcastElementToElement( {\r\n *\t\t\t\tmodel: 'widget',\r\n *\t\t\t\tview: ( modelItem, writer ) => {\r\n *\t\t\t\t\treturn writer.createContainerElement( 'div', { class: 'widget' } );\r\n *\t\t\t\t}\r\n *\t\t\t} ) );\r\n *\r\n * See the full source code of the widget (with a nested editable) schema definition and converters in\r\n * [this sample](https://github.com/ckeditor/ckeditor5-widget/blob/master/tests/manual/widget-with-nestededitable.js).\r\n *\r\n * @param {module:engine/view/element~Element} element\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n * @param {Object} [options={}]\r\n * @param {String|Function} [options.label] Element's label provided to the {@link ~setLabel} function. It can be passed as\r\n * a plain string or a function returning a string. It represents the widget for assistive technologies (like screen readers).\r\n * @param {Boolean} [options.hasSelectionHandler=false] If `true`, the widget will have a selection handler added.\r\n * @returns {module:engine/view/element~Element} Returns the same element.\r\n */\r\nexport function toWidget( element, writer, options = {} ) {\r\n\t// The selection on Edge behaves better when the whole editor contents is in a single contenteditable element.\r\n\t// https://github.com/ckeditor/ckeditor5/issues/1079\r\n\tif ( !env.isEdge ) {\r\n\t\twriter.setAttribute( 'contenteditable', 'false', element );\r\n\t}\r\n\r\n\twriter.addClass( WIDGET_CLASS_NAME, element );\r\n\twriter.setCustomProperty( widgetSymbol, true, element );\r\n\telement.getFillerOffset = getFillerOffset;\r\n\r\n\tif ( options.label ) {\r\n\t\tsetLabel( element, options.label, writer );\r\n\t}\r\n\r\n\tif ( options.hasSelectionHandler ) {\r\n\t\taddSelectionHandler( element, writer );\r\n\t}\r\n\r\n\tsetHighlightHandling(\r\n\t\telement,\r\n\t\twriter,\r\n\t\t( element, descriptor, writer ) => writer.addClass( normalizeToArray( descriptor.classes ), element ),\r\n\t\t( element, descriptor, writer ) => writer.removeClass( normalizeToArray( descriptor.classes ), element )\r\n\t);\r\n\r\n\treturn element;\r\n\r\n\t// Normalizes CSS class in descriptor that can be provided in form of an array or a string.\r\n\tfunction normalizeToArray( classes ) {\r\n\t\treturn Array.isArray( classes ) ? classes : [ classes ];\r\n\t}\r\n}\r\n\r\n/**\r\n * Sets highlight handling methods. Uses {@link module:widget/highlightstack~HighlightStack} to\r\n * properly determine which highlight descriptor should be used at given time.\r\n *\r\n * @param {module:engine/view/element~Element} element\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n * @param {Function} add\r\n * @param {Function} remove\r\n */\r\nexport function setHighlightHandling( element, writer, add, remove ) {\r\n\tconst stack = new HighlightStack();\r\n\r\n\tstack.on( 'change:top', ( evt, data ) => {\r\n\t\tif ( data.oldDescriptor ) {\r\n\t\t\tremove( element, data.oldDescriptor, data.writer );\r\n\t\t}\r\n\r\n\t\tif ( data.newDescriptor ) {\r\n\t\t\tadd( element, data.newDescriptor, data.writer );\r\n\t\t}\r\n\t} );\r\n\r\n\twriter.setCustomProperty( 'addHighlight', ( element, descriptor, writer ) => stack.add( descriptor, writer ), element );\r\n\twriter.setCustomProperty( 'removeHighlight', ( element, id, writer ) => stack.remove( id, writer ), element );\r\n}\r\n\r\n/**\r\n * Sets label for given element.\r\n * It can be passed as a plain string or a function returning a string. Function will be called each time label is retrieved by\r\n * {@link ~getLabel `getLabel()`}.\r\n *\r\n * @param {module:engine/view/element~Element} element\r\n * @param {String|Function} labelOrCreator\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n */\r\nexport function setLabel( element, labelOrCreator, writer ) {\r\n\twriter.setCustomProperty( labelSymbol, labelOrCreator, element );\r\n}\r\n\r\n/**\r\n * Returns the label of the provided element.\r\n *\r\n * @param {module:engine/view/element~Element} element\r\n * @returns {String}\r\n */\r\nexport function getLabel( element ) {\r\n\tconst labelCreator = element.getCustomProperty( labelSymbol );\r\n\r\n\tif ( !labelCreator ) {\r\n\t\treturn '';\r\n\t}\r\n\r\n\treturn typeof labelCreator == 'function' ? labelCreator() : labelCreator;\r\n}\r\n\r\n/**\r\n * Adds functionality to the provided {@link module:engine/view/editableelement~EditableElement} to act as a widget's editable:\r\n *\r\n * * sets the `contenteditable` attribute to `true` when {@link module:engine/view/editableelement~EditableElement#isReadOnly} is `false`,\r\n * otherwise sets it to `false`,\r\n * * adds the `ck-editor__editable` and `ck-editor__nested-editable` CSS classes,\r\n * * adds the `ck-editor__nested-editable_focused` CSS class when the editable is focused and removes it when it is blurred.\r\n *\r\n * Similarly to {@link ~toWidget `toWidget()`} this function should be used in `dataDowncast` only and it is usually\r\n * used together with {@link module:engine/conversion/downcast-converters~downcastElementToElement `downcastElementToElement()`}.\r\n *\r\n * For example, in order to convert a `<nested>` model element to `<div class=\"nested\">` in the view, you can define\r\n * such converters:\r\n *\r\n *\t\teditor.conversion.for( 'editingDowncast' )\r\n *\t\t\t.add( downcastElementToElement( {\r\n *\t\t\t\tmodel: 'nested',\r\n *\t\t\t\tview: ( modelItem, writer ) => {\r\n *\t\t\t\t\tconst div = writer.createEditableElement( 'div', { class: 'nested' } );\r\n *\r\n *\t\t\t\t\treturn toWidgetEditable( nested, writer );\r\n *\t\t\t\t}\r\n *\t\t\t} ) );\r\n *\r\n *\t\teditor.conversion.for( 'dataDowncast' )\r\n *\t\t\t.add( downcastElementToElement( {\r\n *\t\t\t\tmodel: 'nested',\r\n *\t\t\t\tview: ( modelItem, writer ) => {\r\n *\t\t\t\t\treturn writer.createContainerElement( 'div', { class: 'nested' } );\r\n *\t\t\t\t}\r\n *\t\t\t} ) );\r\n *\r\n * See the full source code of the widget (with nested editable) schema definition and converters in\r\n * [this sample](https://github.com/ckeditor/ckeditor5-widget/blob/master/tests/manual/widget-with-nestededitable.js).\r\n *\r\n * @param {module:engine/view/editableelement~EditableElement} editable\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n * @returns {module:engine/view/editableelement~EditableElement} Returns the same element that was provided in the `editable` parameter\r\n */\r\nexport function toWidgetEditable( editable, writer ) {\r\n\twriter.addClass( [ 'ck-editor__editable', 'ck-editor__nested-editable' ], editable );\r\n\r\n\t// The selection on Edge behaves better when the whole editor contents is in a single contentedible element.\r\n\t// https://github.com/ckeditor/ckeditor5/issues/1079\r\n\tif ( !env.isEdge ) {\r\n\t\t// Set initial contenteditable value.\r\n\t\twriter.setAttribute( 'contenteditable', editable.isReadOnly ? 'false' : 'true', editable );\r\n\r\n\t\t// Bind the contenteditable property to element#isReadOnly.\r\n\t\teditable.on( 'change:isReadOnly', ( evt, property, is ) => {\r\n\t\t\twriter.setAttribute( 'contenteditable', is ? 'false' : 'true', editable );\r\n\t\t} );\r\n\t}\r\n\r\n\teditable.on( 'change:isFocused', ( evt, property, is ) => {\r\n\t\tif ( is ) {\r\n\t\t\twriter.addClass( 'ck-editor__nested-editable_focused', editable );\r\n\t\t} else {\r\n\t\t\twriter.removeClass( 'ck-editor__nested-editable_focused', editable );\r\n\t\t}\r\n\t} );\r\n\r\n\treturn editable;\r\n}\r\n\r\n/**\r\n * Returns a model position which is optimal (in terms of UX) for inserting a widget block.\r\n *\r\n * For instance, if a selection is in the middle of a paragraph, the position before this paragraph\r\n * will be returned so that it is not split. If the selection is at the end of a paragraph,\r\n * the position after this paragraph will be returned.\r\n *\r\n * Note: If the selection is placed in an empty block, that block will be returned. If that position\r\n * is then passed to {@link module:engine/model/model~Model#insertContent},\r\n * the block will be fully replaced by the image.\r\n *\r\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\r\n * The selection based on which the insertion position should be calculated.\r\n * @param {module:engine/model/model~Model} model Model instance.\r\n * @returns {module:engine/model/position~Position} The optimal position.\r\n */\r\nexport function findOptimalInsertionPosition( selection, model ) {\r\n\tconst selectedElement = selection.getSelectedElement();\r\n\r\n\tif ( selectedElement ) {\r\n\t\treturn model.createPositionAfter( selectedElement );\r\n\t}\r\n\r\n\tconst firstBlock = selection.getSelectedBlocks().next().value;\r\n\r\n\tif ( firstBlock ) {\r\n\t\t// If inserting into an empty block – return position in that block. It will get\r\n\t\t// replaced with the image by insertContent(). #42.\r\n\t\tif ( firstBlock.isEmpty ) {\r\n\t\t\treturn model.createPositionAt( firstBlock, 0 );\r\n\t\t}\r\n\r\n\t\tconst positionAfter = model.createPositionAfter( firstBlock );\r\n\r\n\t\t// If selection is at the end of the block - return position after the block.\r\n\t\tif ( selection.focus.isTouching( positionAfter ) ) {\r\n\t\t\treturn positionAfter;\r\n\t\t}\r\n\r\n\t\t// Otherwise return position before the block.\r\n\t\treturn model.createPositionBefore( firstBlock );\r\n\t}\r\n\r\n\treturn selection.focus;\r\n}\r\n\r\n// Default filler offset function applied to all widget elements.\r\n//\r\n// @returns {null}\r\nfunction getFillerOffset() {\r\n\treturn null;\r\n}\r\n\r\n// Adds a drag handler to the editable element.\r\n//\r\n// @param {module:engine/view/editableelement~EditableElement}\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction addSelectionHandler( editable, writer ) {\r\n\tconst selectionHandler = writer.createUIElement( 'div', { class: 'ck ck-widget__selection-handler' }, function( domDocument ) {\r\n\t\tconst domElement = this.toDomElement( domDocument );\r\n\r\n\t\t// Use the IconView from the ui library.\r\n\t\tconst icon = new IconView();\r\n\t\ticon.set( 'content', dragHandlerIcon );\r\n\r\n\t\t// Render the icon view right away to append its #element to the selectionHandler DOM element.\r\n\t\ticon.render();\r\n\r\n\t\tdomElement.appendChild( icon.element );\r\n\r\n\t\treturn domElement;\r\n\t} );\r\n\r\n\t// Append the selection handler into the widget wrapper.\r\n\twriter.insert( writer.createPositionAt( editable, 0 ), selectionHandler );\r\n\twriter.addClass( [ 'ck-widget_selectable' ], editable );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/image/utils\r\n */\r\n\r\nimport { findOptimalInsertionPosition, isWidget, toWidget } from '@ckeditor/ckeditor5-widget/src/utils';\r\n\r\nconst imageSymbol = Symbol( 'isImage' );\r\n\r\n/**\r\n * Converts a given {@link module:engine/view/element~Element} to an image widget:\r\n * * Adds a {@link module:engine/view/element~Element#_setCustomProperty custom property} allowing to recognize the image widget element.\r\n * * Calls the {@link module:widget/utils~toWidget} function with the proper element's label creator.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer An instance of the view writer.\r\n * @param {String} label The element's label. It will be concatenated with the image `alt` attribute if one is present.\r\n * @returns {module:engine/view/element~Element}\r\n */\r\nexport function toImageWidget( viewElement, writer, label ) {\r\n\twriter.setCustomProperty( imageSymbol, true, viewElement );\r\n\r\n\treturn toWidget( viewElement, writer, { label: labelCreator } );\r\n\r\n\tfunction labelCreator() {\r\n\t\tconst imgElement = viewElement.getChild( 0 );\r\n\t\tconst altText = imgElement.getAttribute( 'alt' );\r\n\r\n\t\treturn altText ? `${ altText } ${ label }` : label;\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks if a given view element is an image widget.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @returns {Boolean}\r\n */\r\nexport function isImageWidget( viewElement ) {\r\n\treturn !!viewElement.getCustomProperty( imageSymbol ) && isWidget( viewElement );\r\n}\r\n\r\n/**\r\n * Checks if an image widget is the only selected element.\r\n *\r\n * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} selection\r\n * @returns {Boolean}\r\n */\r\nexport function isImageWidgetSelected( selection ) {\r\n\tconst viewElement = selection.getSelectedElement();\r\n\r\n\treturn !!( viewElement && isImageWidget( viewElement ) );\r\n}\r\n\r\n/**\r\n * Checks if the provided model element is an `image`.\r\n *\r\n * @param {module:engine/model/element~Element} modelElement\r\n * @returns {Boolean}\r\n */\r\nexport function isImage( modelElement ) {\r\n\treturn !!modelElement && modelElement.is( 'image' );\r\n}\r\n\r\n/**\r\n * Handles inserting single file. This method unifies image insertion using {@link module:widget/utils~findOptimalInsertionPosition} method.\r\n *\r\n *\t\tmodel.change( writer => {\r\n *\t\t\tinsertImage( writer, model, { src: 'path/to/image.jpg' } );\r\n *\t\t} );\r\n *\r\n * @param {module:engine/model/writer~Writer} writer\r\n * @param {module:engine/model/model~Model} model\r\n * @param {Object} [attributes={}] Attributes of inserted image\r\n */\r\nexport function insertImage( writer, model, attributes = {} ) {\r\n\tconst imageElement = writer.createElement( 'image', attributes );\r\n\r\n\tconst insertAtSelection = findOptimalInsertionPosition( model.document.selection, model );\r\n\r\n\tmodel.insertContent( imageElement, insertAtSelection );\r\n\r\n\t// Inserting an image might've failed due to schema regulations.\r\n\tif ( imageElement.parent ) {\r\n\t\twriter.setSelection( imageElement, 'on' );\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks if image can be inserted at current model selection.\r\n *\r\n * @param {module:engine/model/model~Model} model\r\n * @returns {Boolean}\r\n */\r\nexport function isImageAllowed( model ) {\r\n\tconst schema = model.schema;\r\n\tconst selection = model.document.selection;\r\n\r\n\treturn isImageAllowedInParent( selection, schema, model ) && checkSelectionWithObject( selection, schema );\r\n}\r\n\r\n// Checks if image is allowed by schema in optimal insertion parent.\r\n//\r\n// @returns {Boolean}\r\nfunction isImageAllowedInParent( selection, schema, model ) {\r\n\tconst parent = getInsertImageParent( selection, model );\r\n\r\n\treturn schema.checkChild( parent, 'image' );\r\n}\r\n\r\n// Check used in image commands for additional cases when the command should be disabled:\r\n//\r\n// - selection is on object\r\n// - selection is inside object\r\n//\r\n// @returns {Boolean}\r\nfunction checkSelectionWithObject( selection, schema ) {\r\n\tconst selectedElement = selection.getSelectedElement();\r\n\r\n\tconst isSelectionOnObject = !!selectedElement && schema.isObject( selectedElement );\r\n\tconst isSelectionInObject = !![ ...selection.focus.getAncestors() ].find( ancestor => schema.isObject( ancestor ) );\r\n\r\n\treturn !isSelectionOnObject && !isSelectionInObject;\r\n}\r\n\r\n// Returns a node that will be used to insert image with `model.insertContent` to check if image can be placed there.\r\nfunction getInsertImageParent( selection, model ) {\r\n\tconst insertAt = findOptimalInsertionPosition( selection, model );\r\n\r\n\tlet parent = insertAt.parent;\r\n\r\n\tif ( !parent.is( '$root' ) ) {\r\n\t\tparent = parent.parent;\r\n\t}\r\n\r\n\treturn parent;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { insertImage, isImageAllowed } from './utils';\r\n\r\n/**\r\n * @module image/image/imageinsertcommand\r\n */\r\n\r\n/**\r\n * Insert image command.\r\n *\r\n * The command is registered by the {@link module:image/image/imageediting~ImageEditing} plugin as `'imageInsert'`.\r\n *\r\n * In order to insert an image at the current selection position\r\n * (according to the {@link module:widget/utils~findOptimalInsertionPosition} algorithm),\r\n * execute the command and specify the image source:\r\n *\r\n *\t\teditor.execute( 'imageInsert', { source: 'http://url.to.the/image' } );\r\n *\r\n * It is also possible to insert multiple images at once:\r\n *\r\n *\t\teditor.execute( 'imageInsert', {\r\n *\t\t\tsource:  [\r\n *\t\t\t\t'path/to/image.jpg',\r\n *\t\t\t\t'path/to/other-image.jpg'\r\n *\t\t\t]\r\n *\t\t} );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ImageInsertCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = isImageAllowed( this.editor.model );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} options Options for the executed command.\r\n\t * @param {String|Array.<String>} options.source The image source or an array of image sources to insert.\r\n\t */\r\n\texecute( options ) {\r\n\t\tconst model = this.editor.model;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst sources = Array.isArray( options.source ) ? options.source : [ options.source ];\r\n\r\n\t\t\tfor ( const src of sources ) {\r\n\t\t\t\tinsertImage( writer, model, { src } );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/image/imageediting\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ImageLoadObserver from './imageloadobserver';\nimport {\n    viewFigureToModel,\n    modelToViewAttributeConverter,\n    srcsetAttributeConverter\n} from './converters';\nimport { toImageWidget } from './utils';\nimport { downcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/downcast-converters';\nimport {\n    upcastElementToElement,\n    upcastAttributeToAttribute\n} from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\nimport ImageInsertCommand from './imageinsertcommand';\n/**\r\n * The image engine plugin.\r\n *\r\n * It registers:\r\n *\r\n * * `<image>` as a block element in the document schema, and allows `alt`, `src` and `srcset` attributes.\r\n * * converters for editing and data pipelines.\r\n * * `'imageInsert'` command.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageEditing extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        const t = editor.t;\n        const conversion = editor.conversion;\n        // See https://github.com/ckeditor/ckeditor5-image/issues/142.\n        editor.editing.view.addObserver(ImageLoadObserver);\n        // Configure schema.\n        schema.register('image', {\n            isObject: true,\n            isBlock: true,\n            allowWhere: '$block',\n            allowAttributes: [\n                'alt',\n                'src',\n                'srcset'\n            ]\n        });\n        conversion.for('dataDowncast').add(downcastElementToElement({\n            model: 'image',\n            view: (modelElement, viewWriter) => createImageViewElement(viewWriter)\n        }));\n        conversion.for('editingDowncast').add(downcastElementToElement({\n            model: 'image',\n            view: (modelElement, viewWriter) => toImageWidget(createImageViewElement(viewWriter), viewWriter, t('h'))\n        }));\n        conversion.for('downcast').add(modelToViewAttributeConverter('src')).add(modelToViewAttributeConverter('alt')).add(srcsetAttributeConverter());\n        conversion.for('upcast').add(upcastElementToElement({\n            view: {\n                name: 'img',\n                attributes: { src: true }\n            },\n            model: (viewImage, modelWriter) => modelWriter.createElement('image', { src: viewImage.getAttribute('src') })\n        })).add(upcastAttributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'alt'\n            },\n            model: 'alt'\n        })).add(upcastAttributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'srcset'\n            },\n            model: {\n                key: 'srcset',\n                value: viewImage => {\n                    const value = { data: viewImage.getAttribute('srcset') };\n                    if (viewImage.hasAttribute('width')) {\n                        value.width = viewImage.getAttribute('width');\n                    }\n                    return value;\n                }\n            }\n        })).add(viewFigureToModel());\n        // Register imageUpload command.\n        editor.commands.add('imageInsert', new ImageInsertCommand(editor));\n    }\n}\n// Creates a view element representing the image.\n//\n//\t\t<figure class=\"image\"><img></img></figure>\n//\n// Note that `alt` and `src` attributes are converted separately, so they are not included.\n//\n// @private\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @returns {module:engine/view/containerelement~ContainerElement}\nexport function createImageViewElement(writer) {\n    const emptyElement = writer.createEmptyElement('img');\n    const figure = writer.createContainerElement('figure', { class: 'image' });\n    writer.insert(writer.createPositionAt(figure, 0), emptyElement);\n    return figure;\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/mouseobserver\r\n */\r\n\r\nimport DomEventObserver from './domeventobserver';\r\n\r\n/**\r\n * Mouse events observer.\r\n *\r\n * Note that this observer is not available by default. To make it available it needs to be added to\r\n * {@link module:engine/view/view~View} by {@link module:engine/view/view~View#addObserver} method.\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class MouseObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tthis.domEventType = 'mousedown';\r\n\t}\r\n\r\n\tonDomEvent( domEvent ) {\r\n\t\tthis.fire( domEvent.type, domEvent );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when mouse button is pressed down on one of the editables.\r\n *\r\n * Introduced by {@link module:engine/view/observer/mouseobserver~MouseObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available {@link module:engine/view/observer/mouseobserver~MouseObserver}\r\n * needs to be added to {@link module:engine/view/view~View} by a {@link module:engine/view/view~View#addObserver} method.\r\n *\r\n * @see module:engine/view/observer/mouseobserver~MouseObserver\r\n * @event module:engine/view/document~Document#event:mousedown\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module widget/widget\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport MouseObserver from '@ckeditor/ckeditor5-engine/src/view/observer/mouseobserver';\r\nimport { isWidget, WIDGET_SELECTED_CLASS_NAME, getLabel } from './utils';\r\nimport { keyCodes, getCode, parseKeystroke } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\n\r\nimport '../theme/widget.css';\r\n\r\nconst selectAllKeystrokeCode = parseKeystroke( 'Ctrl+A' );\r\n\r\n/**\r\n * The widget plugin. It enables base support for widgets.\r\n *\r\n * See {@glink api/widget package page} for more details and documentation.\r\n *\r\n * This plugin enables multiple behaiors required by the widgets:\r\n *\r\n * * The model to view selection converter for the editing pipeline (it handles widget custom selection rendering).\r\n * If a converted selection is wraps around a widget element, that selection is marked as\r\n * {@link module:engine/view/selection~Selection#isFake fake}. Additionally, proper the `ck-widget_selected` CSS class\r\n * is added to indicate that widget has been selected.\r\n * * The mouse and keyboard events handling on and around widget elements.\r\n *\r\n * @extends module:core/plugin~Plugin.\r\n */\r\nexport default class Widget extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Widget';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst view = this.editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\r\n\t\t/**\r\n\t\t * Holds previously selected widgets.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @type {Set.<module:engine/view/element~Element>}\r\n\t\t */\r\n\t\tthis._previouslySelected = new Set();\r\n\r\n\t\t// Model to view selection converter.\r\n\t\t// Converts selection placed over widget element to fake selection\r\n\t\tthis.editor.editing.downcastDispatcher.on( 'selection', ( evt, data, conversionApi ) => {\r\n\t\t\t// Remove selected class from previously selected widgets.\r\n\t\t\tthis._clearPreviouslySelectedWidgets( conversionApi.writer );\r\n\r\n\t\t\tconst viewWriter = conversionApi.writer;\r\n\t\t\tconst viewSelection = viewWriter.document.selection;\r\n\t\t\tconst selectedElement = viewSelection.getSelectedElement();\r\n\t\t\tlet lastMarked = null;\r\n\r\n\t\t\tfor ( const range of viewSelection.getRanges() ) {\r\n\t\t\t\tfor ( const value of range ) {\r\n\t\t\t\t\tconst node = value.item;\r\n\r\n\t\t\t\t\t// Do not mark nested widgets in selected one. See: #57.\r\n\t\t\t\t\tif ( isWidget( node ) && !isChild( node, lastMarked ) ) {\r\n\t\t\t\t\t\tviewWriter.addClass( WIDGET_SELECTED_CLASS_NAME, node );\r\n\r\n\t\t\t\t\t\tthis._previouslySelected.add( node );\r\n\t\t\t\t\t\tlastMarked = node;\r\n\r\n\t\t\t\t\t\t// Check if widget is a single element selected.\r\n\t\t\t\t\t\tif ( node == selectedElement ) {\r\n\t\t\t\t\t\t\tviewWriter.setSelection( viewSelection.getRanges(), { fake: true, label: getLabel( selectedElement ) } );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// If mouse down is pressed on widget - create selection over whole widget.\r\n\t\tview.addObserver( MouseObserver );\r\n\t\tthis.listenTo( viewDocument, 'mousedown', ( ...args ) => this._onMousedown( ...args ) );\r\n\r\n\t\t// Handle custom keydown behaviour.\r\n\t\tthis.listenTo( viewDocument, 'keydown', ( ...args ) => this._onKeydown( ...args ), { priority: 'high' } );\r\n\r\n\t\t// Handle custom delete behaviour.\r\n\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\r\n\t\t\tif ( this._handleDelete( data.direction == 'forward' ) ) {\r\n\t\t\t\tdata.preventDefault();\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Handles {@link module:engine/view/document~Document#event:mousedown mousedown} events on widget elements.\r\n\t *\r\n\t * @private\r\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\r\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\r\n\t */\r\n\t_onMousedown( eventInfo, domEventData ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\t\tlet element = domEventData.target;\r\n\r\n\t\t// Do nothing if inside nested editable.\r\n\t\tif ( isInsideNestedEditable( element ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If target is not a widget element - check if one of the ancestors is.\r\n\t\tif ( !isWidget( element ) ) {\r\n\t\t\telement = element.findAncestor( isWidget );\r\n\r\n\t\t\tif ( !element ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdomEventData.preventDefault();\r\n\r\n\t\t// Focus editor if is not focused already.\r\n\t\tif ( !viewDocument.isFocused ) {\r\n\t\t\tview.focus();\r\n\t\t}\r\n\r\n\t\t// Create model selection over widget.\r\n\t\tconst modelElement = editor.editing.mapper.toModelElement( element );\r\n\r\n\t\tthis._setSelectionOverElement( modelElement );\r\n\t}\r\n\r\n\t/**\r\n\t * Handles {@link module:engine/view/document~Document#event:keydown keydown} events.\r\n\t *\r\n\t * @private\r\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\r\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\r\n\t */\r\n\t_onKeydown( eventInfo, domEventData ) {\r\n\t\tconst keyCode = domEventData.keyCode;\r\n\t\tconst isForward = keyCode == keyCodes.delete || keyCode == keyCodes.arrowdown || keyCode == keyCodes.arrowright;\r\n\t\tlet wasHandled = false;\r\n\r\n\t\t// Checks if the keys were handled and then prevents the default event behaviour and stops\r\n\t\t// the propagation.\r\n\t\tif ( isArrowKeyCode( keyCode ) ) {\r\n\t\t\twasHandled = this._handleArrowKeys( isForward );\r\n\t\t} else if ( isSelectAllKeyCode( domEventData ) ) {\r\n\t\t\twasHandled = this._selectAllNestedEditableContent() || this._selectAllContent();\r\n\t\t} else if ( keyCode === keyCodes.enter ) {\r\n\t\t\twasHandled = this._handleEnterKey( domEventData.shiftKey );\r\n\t\t}\r\n\r\n\t\tif ( wasHandled ) {\r\n\t\t\tdomEventData.preventDefault();\r\n\t\t\teventInfo.stop();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles delete keys: backspace and delete.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} isForward Set to true if delete was performed in forward direction.\r\n\t * @returns {Boolean|undefined} Returns `true` if keys were handled correctly.\r\n\t */\r\n\t_handleDelete( isForward ) {\r\n\t\t// Do nothing when the read only mode is enabled.\r\n\t\tif ( this.editor.isReadOnly ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modelDocument = this.editor.model.document;\r\n\t\tconst modelSelection = modelDocument.selection;\r\n\r\n\t\t// Do nothing on non-collapsed selection.\r\n\t\tif ( !modelSelection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst objectElement = this._getObjectElementNextToSelection( isForward );\r\n\r\n\t\tif ( objectElement ) {\r\n\t\t\tthis.editor.model.change( writer => {\r\n\t\t\t\tlet previousNode = modelSelection.anchor.parent;\r\n\r\n\t\t\t\t// Remove previous element if empty.\r\n\t\t\t\twhile ( previousNode.isEmpty ) {\r\n\t\t\t\t\tconst nodeToRemove = previousNode;\r\n\t\t\t\t\tpreviousNode = nodeToRemove.parent;\r\n\r\n\t\t\t\t\twriter.remove( nodeToRemove );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._setSelectionOverElement( objectElement );\r\n\t\t\t} );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles arrow keys.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} isForward Set to true if arrow key should be handled in forward direction.\r\n\t * @returns {Boolean|undefined} Returns `true` if keys were handled correctly.\r\n\t */\r\n\t_handleArrowKeys( isForward ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst schema = model.schema;\r\n\t\tconst modelDocument = model.document;\r\n\t\tconst modelSelection = modelDocument.selection;\r\n\t\tconst objectElement = modelSelection.getSelectedElement();\r\n\r\n\t\t// If object element is selected.\r\n\t\tif ( objectElement && schema.isObject( objectElement ) ) {\r\n\t\t\tconst position = isForward ? modelSelection.getLastPosition() : modelSelection.getFirstPosition();\r\n\t\t\tconst newRange = schema.getNearestSelectionRange( position, isForward ? 'forward' : 'backward' );\r\n\r\n\t\t\tif ( newRange ) {\r\n\t\t\t\tmodel.change( writer => {\r\n\t\t\t\t\twriter.setSelection( newRange );\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// If selection is next to object element.\r\n\t\t// Return if not collapsed.\r\n\t\tif ( !modelSelection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst objectElement2 = this._getObjectElementNextToSelection( isForward );\r\n\r\n\t\tif ( !!objectElement2 && schema.isObject( objectElement2 ) ) {\r\n\t\t\tthis._setSelectionOverElement( objectElement2 );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the enter key, giving users and access to positions in the editable directly before\r\n\t * (<kbd>Shift</kbd>+<kbd>Enter</kbd>) or after (<kbd>Enter</kbd>) the selected widget.\r\n\t * It improves the UX, mainly when the widget is the first or last child of the root editable\r\n\t * and there's no other way to type after or before it.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} isBackwards Set to true if the new paragraph is to be inserted before\r\n\t * the selected widget (<kbd>Shift</kbd>+<kbd>Enter</kbd>).\r\n\t * @returns {Boolean|undefined} Returns `true` if keys were handled correctly.\r\n\t */\r\n\t_handleEnterKey( isBackwards ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst modelSelection = model.document.selection;\r\n\t\tconst objectElement = modelSelection.getSelectedElement();\r\n\r\n\t\tif ( objectElement && model.schema.isObject( objectElement ) ) {\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\r\n\t\t\t\twriter.insert( paragraph, objectElement, isBackwards ? 'before' : 'after' );\r\n\t\t\t\twriter.setSelection( paragraph, 'in' );\r\n\t\t\t} );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Extends the {@link module:engine/model/selection~Selection document's selection} to span the entire\r\n\t * content of the nested editable if already anchored in one.\r\n\t *\r\n\t * See: {@link module:engine/model/schema~Schema#getLimitElement}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_selectAllNestedEditableContent() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst documentSelection = model.document.selection;\r\n\t\tconst limitElement = model.schema.getLimitElement( documentSelection );\r\n\r\n\t\tif ( documentSelection.getFirstRange().root == limitElement ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\twriter.setSelection( writer.createRangeIn( limitElement ) );\r\n\t\t} );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Handles <kbd>CTRL + A</kbd> when widget is selected.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} Returns true if widget was selected and selecting all was handled by this method.\r\n\t */\r\n\t_selectAllContent() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst editing = this.editor.editing;\r\n\t\tconst view = editing.view;\r\n\t\tconst viewDocument = view.document;\r\n\t\tconst viewSelection = viewDocument.selection;\r\n\r\n\t\tconst selectedElement = viewSelection.getSelectedElement();\r\n\r\n\t\t// Only widget is selected.\r\n\t\t// https://github.com/ckeditor/ckeditor5-widget/issues/23\r\n\t\tif ( selectedElement && isWidget( selectedElement ) ) {\r\n\t\t\tconst widgetParent = editing.mapper.toModelElement( selectedElement.parent );\r\n\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\twriter.setSelection( writer.createRangeIn( widgetParent ) );\r\n\t\t\t} );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets {@link module:engine/model/selection~Selection document's selection} over given element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/element~Element} element\r\n\t */\r\n\t_setSelectionOverElement( element ) {\r\n\t\tthis.editor.model.change( writer => {\r\n\t\t\twriter.setSelection( writer.createRangeOn( element ) );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if {@link module:engine/model/element~Element element} placed next to the current\r\n\t * {@link module:engine/model/selection~Selection model selection} exists and is marked in\r\n\t * {@link module:engine/model/schema~Schema schema} as `object`.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} forward Direction of checking.\r\n\t * @returns {module:engine/model/element~Element|null}\r\n\t */\r\n\t_getObjectElementNextToSelection( forward ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst schema = model.schema;\r\n\t\tconst modelSelection = model.document.selection;\r\n\r\n\t\t// Clone current selection to use it as a probe. We must leave default selection as it is so it can return\r\n\t\t// to its current state after undo.\r\n\t\tconst probe = model.createSelection( modelSelection );\r\n\t\tmodel.modifySelection( probe, { direction: forward ? 'forward' : 'backward' } );\r\n\t\tconst objectElement = forward ? probe.focus.nodeBefore : probe.focus.nodeAfter;\r\n\r\n\t\tif ( !!objectElement && schema.isObject( objectElement ) ) {\r\n\t\t\treturn objectElement;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes CSS class from previously selected widgets.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n\t */\r\n\t_clearPreviouslySelectedWidgets( writer ) {\r\n\t\tfor ( const widget of this._previouslySelected ) {\r\n\t\t\twriter.removeClass( WIDGET_SELECTED_CLASS_NAME, widget );\r\n\t\t}\r\n\r\n\t\tthis._previouslySelected.clear();\r\n\t}\r\n}\r\n\r\n// Returns 'true' if provided key code represents one of the arrow keys.\r\n//\r\n// @param {Number} keyCode\r\n// @returns {Boolean}\r\nfunction isArrowKeyCode( keyCode ) {\r\n\treturn keyCode == keyCodes.arrowright ||\r\n\t\tkeyCode == keyCodes.arrowleft ||\r\n\t\tkeyCode == keyCodes.arrowup ||\r\n\t\tkeyCode == keyCodes.arrowdown;\r\n}\r\n\r\n// Returns 'true' if provided (DOM) key event data corresponds with the Ctrl+A keystroke.\r\n//\r\n// @param {module:engine/view/observer/keyobserver~KeyEventData} domEventData\r\n// @returns {Boolean}\r\nfunction isSelectAllKeyCode( domEventData ) {\r\n\treturn getCode( domEventData ) == selectAllKeystrokeCode;\r\n}\r\n\r\n// Returns `true` when element is a nested editable or is placed inside one.\r\n//\r\n// @param {module:engine/view/element~Element}\r\n// @returns {Boolean}\r\nfunction isInsideNestedEditable( element ) {\r\n\twhile ( element ) {\r\n\t\tif ( !!element && element.is( 'editableElement' ) && !element.is( 'rootElement' ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\telement = element.parent;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n// Checks whether the specified `element` is a child of the `parent` element.\r\n//\r\n// @param {module:engine/view/element~Element} element An element to check.\r\n// @param {module:engine/view/element~Element|null} parent A parent for the element.\r\n// @returns {Boolean}\r\nfunction isChild( element, parent ) {\r\n\tif ( !parent ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn Array.from( element.getAncestors() ).includes( parent );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagetextalternative/imagetextalternativecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { isImage } from '../image/utils';\r\n\r\n/**\r\n * The image text alternative command. It is used to change the `alt` attribute of `<image>` elements.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ImageTextAlternativeCommand extends Command {\r\n\t/**\r\n\t * The command value: `false` if there is no `alt` attribute, otherwise the value of the `alt` attribute.\r\n\t *\r\n\t * @readonly\r\n\t * @observable\r\n\t * @member {String|Boolean} #value\r\n\t */\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst element = this.editor.model.document.selection.getSelectedElement();\r\n\r\n\t\tthis.isEnabled = isImage( element );\r\n\r\n\t\tif ( isImage( element ) && element.hasAttribute( 'alt' ) ) {\r\n\t\t\tthis.value = element.getAttribute( 'alt' );\r\n\t\t} else {\r\n\t\t\tthis.value = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} options\r\n\t * @param {String} options.newValue The new value of the `alt` attribute to set.\r\n\t */\r\n\texecute( options ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst imageElement = model.document.selection.getSelectedElement();\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\twriter.setAttribute( 'alt', options.newValue, imageElement );\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagetextalternative/imagetextalternativeediting\r\n */\r\n\r\nimport ImageTextAlternativeCommand from './imagetextalternativecommand';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\n/**\r\n * The image text alternative editing plugin.\r\n *\r\n * Registers the `'imageTextAlternative'` command.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageTextAlternativeEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tthis.editor.commands.add( 'imageTextAlternative', new ImageTextAlternativeCommand( this.editor ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/bindings/clickoutsidehandler\r\n */\r\n\r\n/* global document */\r\n\r\n/**\r\n * Handles clicking **outside** of a specified set of elements, then fires an action.\r\n *\r\n * **Note**: Actually, the action is executed upon `mousedown`, not `click`. It prevents\r\n * certain issues when the user keeps holding the mouse button and the UI cannot react\r\n * properly.\r\n *\r\n * @param {Object} options Configuration options.\r\n * @param {module:utils/dom/emittermixin~Emitter} options.emitter The emitter to which this behavior\r\n * should be added.\r\n * @param {Function} options.activator Function returning a `Boolean`, to determine whether the handler is active.\r\n * @param {Array.<HTMLElement>} options.contextElements HTML elements that determine the scope of the\r\n * handler. Clicking any of them or their descendants will **not** fire the callback.\r\n * @param {Function} options.callback An action executed by the handler.\r\n */\r\nexport default function clickOutsideHandler( { emitter, activator, callback, contextElements } ) {\r\n\temitter.listenTo( document, 'mousedown', ( evt, { target } ) => {\r\n\t\tif ( !activator() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor ( const contextElement of contextElements ) {\r\n\t\t\tif ( contextElement.contains( target ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcallback();\r\n\t} );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/labeledinput/labeledinputview\r\n */\r\n\r\nimport View from '../view';\r\nimport uid from '@ckeditor/ckeditor5-utils/src/uid';\r\nimport LabelView from '../label/labelview';\r\nimport '../../theme/components/labeledinput/labeledinput.css';\r\n\r\n/**\r\n * The labeled input view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class LabeledInputView extends View {\r\n\t/**\r\n\t * Creates an instance of the labeled input view class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} locale The locale instance.\r\n\t * @param {Function} InputView Constructor of the input view.\r\n\t */\r\n\tconstructor( locale, InputView ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst inputUid = `ck-input-${ uid() }`;\r\n\t\tconst statusUid = `ck-status-${ uid() }`;\r\n\r\n\t\t/**\r\n\t\t * The text of the label.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #label\r\n\t\t */\r\n\t\tthis.set( 'label' );\r\n\r\n\t\t/**\r\n\t\t * The value of the input.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #value\r\n\t\t */\r\n\t\tthis.set( 'value' );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the component is in read-only mode.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * The validation error text. When set, it will be displayed\r\n\t\t * next to the {@link #inputView} as a typical validation error message.\r\n\t\t * Set it to `null` to hide the message.\r\n\t\t *\r\n\t\t * **Note:** Setting this property to anything but `null` will automatically\r\n\t\t * make the {@link module:ui/inputtext/inputtextview~InputTextView#hasError `hasError`}\r\n\t\t * of the {@link #inputView} `true`.\r\n\t\t *\r\n\t\t * **Note:** Typing in the {@link #inputView} which fires the\r\n\t\t * {@link module:ui/inputtext/inputtextview~InputTextView#event:input `input` event}\r\n\t\t * resets this property back to `null`, indicating that the input field can be re–validated.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String|null} #errorText\r\n\t\t */\r\n\t\tthis.set( 'errorText', null );\r\n\r\n\t\t/**\r\n\t\t * The additional information text displayed next to the {@link #inputView} which can\r\n\t\t * be used to inform the user about the purpose of the input, provide help or hints.\r\n\t\t *\r\n\t\t * Set it to `null` to hide the message.\r\n\t\t *\r\n\t\t * **Note:** This text will be displayed in the same place as {@link #errorText} but the\r\n\t\t * latter always takes precedence: if the {@link #errorText} is set, it replaces\r\n\t\t * {@link #errorText} for as long as the value of the input is invalid.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String|null} #infoText\r\n\t\t */\r\n\t\tthis.set( 'infoText', null );\r\n\r\n\t\t/**\r\n\t\t * The label view.\r\n\t\t *\r\n\t\t * @member {module:ui/label/labelview~LabelView} #labelView\r\n\t\t */\r\n\t\tthis.labelView = this._createLabelView( inputUid );\r\n\r\n\t\t/**\r\n\t\t * The input view.\r\n\t\t *\r\n\t\t * @member {module:ui/inputtext/inputtextview~InputTextView} #inputView\r\n\t\t */\r\n\t\tthis.inputView = this._createInputView( InputView, inputUid, statusUid );\r\n\r\n\t\t/**\r\n\t\t * The status view for the {@link #inputView}. It displays {@link #errorText} and\r\n\t\t * {@link #infoText}.\r\n\t\t *\r\n\t\t * @member {module:ui/view~View} #statusView\r\n\t\t */\r\n\t\tthis.statusView = this._createStatusView( statusUid );\r\n\r\n\t\t/**\r\n\t\t * The combined status text made of {@link #errorText} and {@link #infoText}.\r\n\t\t * Note that when present, {@link #errorText} always takes precedence in the\r\n\t\t * status.\r\n\t\t *\r\n\t\t * @see #errorText\r\n\t\t * @see #infoText\r\n\t\t * @see #statusView\r\n\t\t * @private\r\n\t\t * @observable\r\n\t\t * @member {String|null} #_statusText\r\n\t\t */\r\n\t\tthis.bind( '_statusText' ).to(\r\n\t\t\tthis, 'errorText',\r\n\t\t\tthis, 'infoText',\r\n\t\t\t( errorText, infoText ) => errorText || infoText\r\n\t\t);\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-labeled-input',\r\n\t\t\t\t\tbind.if( 'isReadOnly', 'ck-disabled' )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\tthis.labelView,\r\n\t\t\t\tthis.inputView,\r\n\t\t\t\tthis.statusView\r\n\t\t\t]\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates label view class instance and bind with view.\r\n\t *\r\n\t * @private\r\n\t * @param {String} id Unique id to set as labelView#for attribute.\r\n\t * @returns {module:ui/label/labelview~LabelView}\r\n\t */\r\n\t_createLabelView( id ) {\r\n\t\tconst labelView = new LabelView( this.locale );\r\n\r\n\t\tlabelView.for = id;\r\n\t\tlabelView.bind( 'text' ).to( this, 'label' );\r\n\r\n\t\treturn labelView;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates input view class instance and bind with view.\r\n\t *\r\n\t * @private\r\n\t * @param {Function} InputView Input view constructor.\r\n\t * @param {String} inputUid Unique id to set as inputView#id attribute.\r\n\t * @param {String} statusUid Unique id of the status for the input's `aria-describedby` attribute.\r\n\t * @returns {module:ui/inputtext/inputtextview~InputTextView}\r\n\t */\r\n\t_createInputView( InputView, inputUid, statusUid ) {\r\n\t\tconst inputView = new InputView( this.locale, statusUid );\r\n\r\n\t\tinputView.id = inputUid;\r\n\t\tinputView.ariaDesribedById = statusUid;\r\n\t\tinputView.bind( 'value' ).to( this );\r\n\t\tinputView.bind( 'isReadOnly' ).to( this );\r\n\t\tinputView.bind( 'hasError' ).to( this, 'errorText', value => !!value );\r\n\r\n\t\tinputView.on( 'input', () => {\r\n\t\t\t// UX: Make the error text disappear and disable the error indicator as the user\r\n\t\t\t// starts fixing the errors.\r\n\t\t\tthis.errorText = null;\r\n\t\t} );\r\n\r\n\t\treturn inputView;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the status view instance. It displays {@link #errorText} and {@link #infoText}\r\n\t * next to the {@link #inputView}. See {@link #_statusText}.\r\n\t *\r\n\t * @private\r\n\t * @param {String} statusUid Unique id of the status, shared with the input's `aria-describedby` attribute.\r\n\t * @returns {module:ui/view~View}\r\n\t */\r\n\t_createStatusView( statusUid ) {\r\n\t\tconst statusView = new View( this.locale );\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tstatusView.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-labeled-input__status',\r\n\t\t\t\t\tbind.if( 'errorText', 'ck-labeled-input__status_error' ),\r\n\t\t\t\t\tbind.if( '_statusText', 'ck-hidden', value => !value )\r\n\t\t\t\t],\r\n\t\t\t\tid: statusUid\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: bind.to( '_statusText' )\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\treturn statusView;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the focus to the input and selects the value.\r\n\t */\r\n\tselect() {\r\n\t\tthis.inputView.select();\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the input.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.inputView.focus();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/inputtext/inputtextview\r\n */\r\n\r\nimport View from '../view';\r\nimport '../../theme/components/inputtext/inputtext.css';\r\n\r\n/**\r\n * The text input view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class InputTextView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * The value of the input.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #value\r\n\t\t */\r\n\t\tthis.set( 'value' );\r\n\r\n\t\t/**\r\n\t\t * The `id` attribute of the input (i.e. to pair with a `<label>` element).\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #id\r\n\t\t */\r\n\t\tthis.set( 'id' );\r\n\r\n\t\t/**\r\n\t\t * The `placeholder` attribute of the input.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #placeholder\r\n\t\t */\r\n\t\tthis.set( 'placeholder' );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the input view is in read-only mode.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isReadOnly\r\n\t\t */\r\n\t\tthis.set( 'isReadOnly', false );\r\n\r\n\t\t/**\r\n\t\t * Set to `true` when the field has some error. Usually controlled via\r\n\t\t * {@link module:ui/labeledinput/labeledinputview~LabeledInputView#errorText}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #hasError\r\n\t\t */\r\n\t\tthis.set( 'hasError', false );\r\n\r\n\t\t/**\r\n\t\t * The `id` of the element describing this field, e.g. when it has\r\n\t\t * some error, it helps screen readers read the error text.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #ariaDesribedById\r\n\t\t */\r\n\t\tthis.set( 'ariaDesribedById' );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'input',\r\n\t\t\tattributes: {\r\n\t\t\t\ttype: 'text',\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-input',\r\n\t\t\t\t\t'ck-input-text',\r\n\t\t\t\t\tbind.if( 'hasError', 'ck-error' )\r\n\t\t\t\t],\r\n\t\t\t\tid: bind.to( 'id' ),\r\n\t\t\t\tplaceholder: bind.to( 'placeholder' ),\r\n\t\t\t\treadonly: bind.to( 'isReadOnly' ),\r\n\t\t\t\t'aria-invalid': bind.if( 'hasError', true ),\r\n\t\t\t\t'aria-describedby': bind.to( 'ariaDesribedById' )\r\n\t\t\t},\r\n\t\t\ton: {\r\n\t\t\t\tinput: bind.to( 'input' )\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * Fired when the user types in the input. Corresponds to the native\r\n\t\t * DOM `input` event.\r\n\t\t *\r\n\t\t * @event input\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tconst setValue = value => {\r\n\t\t\tthis.element.value = ( !value && value !== 0 ) ? '' : value;\r\n\t\t};\r\n\r\n\t\tsetValue( this.value );\r\n\r\n\t\t// Bind `this.value` to the DOM element's value.\r\n\t\t// We cannot use `value` DOM attribute because removing it on Edge does not clear the DOM element's value property.\r\n\t\tthis.on( 'change:value', ( evt, name, value ) => {\r\n\t\t\tsetValue( value );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the focus to the input and selects the value.\r\n\t */\r\n\tselect() {\r\n\t\tthis.element.select();\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the input.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.element.focus();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/bindings/submithandler\r\n */\r\n\r\n/**\r\n * A handler useful for {@link module:ui/view~View views} working as HTML forms. It intercepts a native DOM\r\n * `submit` event, prevents the default web browser behavior (navigation and page reload) and\r\n * fires the `submit` event on a view instead. Such a custom event can be then used by any\r\n * {@link module:utils/dom/emittermixin~Emitter emitter}, e.g. to serialize the form data.\r\n *\r\n *\t\timport submitHandler from '@ckeditor/ckeditor5-ui/src/bindings/submithandler';\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tclass AnyFormView extends View {\r\n *\t\t\tconstructor() {\r\n *\t\t\t\tsuper();\r\n *\r\n *\t\t\t\t// ...\r\n *\r\n *\t\t\t\tsubmitHandler( {\r\n *\t\t\t\t\tview: this\r\n *\t\t\t\t} );\r\n *\t\t\t}\r\n *\t\t}\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tconst view = new AnyFormView();\r\n *\r\n *\t\t// A sample listener attached by an emitter working with the view.\r\n *\t\tthis.listenTo( view, 'submit', () => {\r\n *\t\t\tsaveTheFormData();\r\n *\t\t\thideTheForm();\r\n *\t\t} );\r\n *\r\n * @param {Object} [options] Configuration options.\r\n * @param {module:ui/view~View} options.view The view which DOM `submit` events should be handled.\r\n */\r\nexport default function submitHandler( { view } ) {\r\n\tview.listenTo( view.element, 'submit', ( evt, domEvt ) => {\r\n\t\tdomEvt.preventDefault();\r\n\t\tview.fire( 'submit' );\r\n\t}, { useCapture: true } );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imagetextalternative/ui/textalternativeformview\r\n */\nimport View from '@ckeditor/ckeditor5-ui/src/view';\nimport ViewCollection from '@ckeditor/ckeditor5-ui/src/viewcollection';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport LabeledInputView from '@ckeditor/ckeditor5-ui/src/labeledinput/labeledinputview';\nimport InputTextView from '@ckeditor/ckeditor5-ui/src/inputtext/inputtextview';\nimport submitHandler from '@ckeditor/ckeditor5-ui/src/bindings/submithandler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '@ckeditor/ckeditor5-ui/src/focuscycler';\nimport checkIcon from '@ckeditor/ckeditor5-core/theme/icons/check.svg';\nimport cancelIcon from '@ckeditor/ckeditor5-core/theme/icons/cancel.svg';\nimport '../../../theme/textalternativeform.css';\n/**\r\n * The TextAlternativeFormView class.\r\n *\r\n * @extends module:ui/view~View\r\n */\nexport default class TextAlternativeFormView extends View {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    constructor(locale) {\n        super(locale);\n        const t = this.locale.t;\n        /**\r\n\t\t * Tracks information about the DOM focus in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\n        this.focusTracker = new FocusTracker();\n        /**\r\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\n        this.keystrokes = new KeystrokeHandler();\n        /**\r\n\t\t * A textarea with a label.\r\n\t\t *\r\n\t\t * @member {module:ui/labeledinput/labeledinputview~LabeledInputView} #labeledTextarea\r\n\t\t */\n        this.labeledInput = this._createLabeledInputView();\n        /**\r\n\t\t * A button used to submit the form.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView} #saveButtonView\r\n\t\t */\n        this.saveButtonView = this._createButton(t('bd'), checkIcon, 'ck-button-save');\n        this.saveButtonView.type = 'submit';\n        /**\r\n\t\t * A button used to cancel the form.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView} #cancelButtonView\r\n\t\t */\n        this.cancelButtonView = this._createButton(t('be'), cancelIcon, 'ck-button-cancel', 'cancel');\n        /**\r\n\t\t * A collection of views which can be focused in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this._focusables = new ViewCollection();\n        /**\r\n\t\t * Helps cycling over {@link #_focusables} in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-text-alternative-form'\n                ],\n                // https://github.com/ckeditor/ckeditor5-image/issues/40\n                tabindex: '-1'\n            },\n            children: [\n                this.labeledInput,\n                this.saveButtonView,\n                this.cancelButtonView\n            ]\n        });\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    render() {\n        super.render();\n        this.keystrokes.listenTo(this.element);\n        submitHandler({ view: this });\n        [\n            this.labeledInput,\n            this.saveButtonView,\n            this.cancelButtonView\n        ].forEach(v => {\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n    }\n    /**\r\n\t * Creates the button view.\r\n\t *\r\n\t * @private\r\n\t * @param {String} label The button label\r\n\t * @param {String} icon The button's icon.\r\n\t * @param {String} className The additional button CSS class name.\r\n\t * @param {String} [eventName] The event name that the ButtonView#execute event will be delegated to.\r\n\t * @returns {module:ui/button/buttonview~ButtonView} The button view instance.\r\n\t */\n    _createButton(label, icon, className, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.extendTemplate({ attributes: { class: className } });\n        if (eventName) {\n            button.delegate('execute').to(this, eventName);\n        }\n        return button;\n    }\n    /**\r\n\t * Creates an input with a label.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/labeledinput/labeledinputview~LabeledInputView}\r\n\t */\n    _createLabeledInputView() {\n        const t = this.locale.t;\n        const labeledInput = new LabeledInputView(this.locale, InputTextView);\n        labeledInput.label = t('bf');\n        labeledInput.inputView.placeholder = t('bf');\n        return labeledInput;\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/position\r\n */\r\n\r\nimport global from './global';\r\nimport Rect from './rect';\r\nimport getPositionedAncestor from './getpositionedancestor';\r\nimport getBorderWidths from './getborderwidths';\r\nimport { isFunction } from 'lodash-es';\r\n\r\n/**\r\n * Calculates the `position: absolute` coordinates of a given element so it can be positioned with respect to the\r\n * target in the visually most efficient way, taking various restrictions like viewport or limiter geometry\r\n * into consideration.\r\n *\r\n *\t\t// The element which is to be positioned.\r\n *\t\tconst element = document.body.querySelector( '#toolbar' );\r\n *\r\n *\t\t// A target to which the element is positioned relatively.\r\n *\t\tconst target = document.body.querySelector( '#container' );\r\n *\r\n *\t\t// Finding the optimal coordinates for the positioning.\r\n *\t\tconst { left, top, name } = getOptimalPosition( {\r\n *\t\t\telement: element,\r\n *\t\t\ttarget: target,\r\n *\r\n * \t\t\t// The algorithm will chose among these positions to meet the requirements such\r\n * \t\t\t// as \"limiter\" element or \"fitInViewport\", set below. The positions are considered\r\n * \t\t\t// in the order of the array.\r\n *\t\t\tpositions: [\r\n *\t\t\t\t//\r\n *\t\t\t \t//\t[ Target ]\r\n *\t\t\t\t//\t+-----------------+\r\n *\t\t\t\t//\t|     Element     |\r\n *\t\t\t\t//\t+-----------------+\r\n *\t\t\t\t//\r\n *\t\t\t\ttargetRect => ( {\r\n *\t\t\t\t\ttop: targetRect.bottom,\r\n *\t\t\t\t\tleft: targetRect.left,\r\n *\t\t\t\t\tname: 'mySouthEastPosition'\r\n *\t\t\t\t} ),\r\n *\r\n *\t\t\t\t//\r\n *\t\t\t\t//\t+-----------------+\r\n *\t\t\t\t//\t|     Element     |\r\n *\t\t\t\t//\t+-----------------+\r\n *\t\t\t\t//\t[ Target ]\r\n *\t\t\t\t//\r\n *\t\t\t\t( targetRect, elementRect ) => ( {\r\n *\t\t\t\t\ttop: targetRect.top - elementRect.height,\r\n *\t\t\t\t\tleft: targetRect.left,\r\n *\t\t\t\t\tname: 'myNorthEastPosition'\r\n *\t\t\t\t} )\r\n *\t\t\t],\r\n *\r\n *\t\t\t// Find a position such guarantees the element remains within visible boundaries of <body>.\r\n *\t\t\tlimiter: document.body,\r\n *\r\n *\t\t\t// Find a position such guarantees the element remains within visible boundaries of the browser viewport.\r\n *\t\t\tfitInViewport: true\r\n *\t\t} );\r\n *\r\n *\t\t// The best position which fits into document.body and the viewport. May be useful\r\n *\t\t// to set proper class on the `element`.\r\n *\t\tconsole.log( name ); // -> \"myNorthEastPosition\"\r\n *\r\n *\t\t// Using the absolute coordinates which has been found to position the element\r\n *\t\t// as in the diagram depicting the \"myNorthEastPosition\" position.\r\n *\t\telement.style.top = top;\r\n *\t\telement.style.left = left;\r\n *\r\n * @param {module:utils/dom/position~Options} options Positioning options object.\r\n * @returns {module:utils/dom/position~Position}\r\n */\r\nexport function getOptimalPosition( { element, target, positions, limiter, fitInViewport } ) {\r\n\t// If the {@link module:utils/dom/position~Options#target} is a function, use what it returns.\r\n\t// https://github.com/ckeditor/ckeditor5-utils/issues/157\r\n\tif ( isFunction( target ) ) {\r\n\t\ttarget = target();\r\n\t}\r\n\r\n\t// If the {@link module:utils/dom/position~Options#limiter} is a function, use what it returns.\r\n\t// https://github.com/ckeditor/ckeditor5-ui/issues/260\r\n\tif ( isFunction( limiter ) ) {\r\n\t\tlimiter = limiter();\r\n\t}\r\n\r\n\tconst positionedElementAncestor = getPositionedAncestor( element.parentElement );\r\n\tconst elementRect = new Rect( element );\r\n\tconst targetRect = new Rect( target );\r\n\r\n\tlet bestPosition;\r\n\tlet name;\r\n\r\n\t// If there are no limits, just grab the very first position and be done with that drama.\r\n\tif ( !limiter && !fitInViewport ) {\r\n\t\t[ name, bestPosition ] = getPosition( positions[ 0 ], targetRect, elementRect );\r\n\t} else {\r\n\t\tconst limiterRect = limiter && new Rect( limiter ).getVisible();\r\n\t\tconst viewportRect = fitInViewport && new Rect( global.window );\r\n\r\n\t\t[ name, bestPosition ] =\r\n\t\t\tgetBestPosition( positions, targetRect, elementRect, limiterRect, viewportRect ) ||\r\n\t\t\t// If there's no best position found, i.e. when all intersections have no area because\r\n\t\t\t// rects have no width or height, then just use the first available position.\r\n\t\t\tgetPosition( positions[ 0 ], targetRect, elementRect );\r\n\t}\r\n\r\n\tlet { left, top } = getAbsoluteRectCoordinates( bestPosition );\r\n\r\n\tif ( positionedElementAncestor ) {\r\n\t\tconst ancestorPosition = getAbsoluteRectCoordinates( new Rect( positionedElementAncestor ) );\r\n\t\tconst ancestorBorderWidths = getBorderWidths( positionedElementAncestor );\r\n\r\n\t\t// (https://github.com/ckeditor/ckeditor5-ui-default/issues/126)\r\n\t\t// If there's some positioned ancestor of the panel, then its `Rect` must be taken into\r\n\t\t// consideration. `Rect` is always relative to the viewport while `position: absolute` works\r\n\t\t// with respect to that positioned ancestor.\r\n\t\tleft -= ancestorPosition.left;\r\n\t\ttop -= ancestorPosition.top;\r\n\r\n\t\t// (https://github.com/ckeditor/ckeditor5-utils/issues/139)\r\n\t\t// If there's some positioned ancestor of the panel, not only its position must be taken into\r\n\t\t// consideration (see above) but also its internal scrolls. Scroll have an impact here because `Rect`\r\n\t\t// is relative to the viewport (it doesn't care about scrolling), while `position: absolute`\r\n\t\t// must compensate that scrolling.\r\n\t\tleft += positionedElementAncestor.scrollLeft;\r\n\t\ttop += positionedElementAncestor.scrollTop;\r\n\r\n\t\t// (https://github.com/ckeditor/ckeditor5-utils/issues/139)\r\n\t\t// If there's some positioned ancestor of the panel, then its `Rect` includes its CSS `borderWidth`\r\n\t\t// while `position: absolute` positioning does not consider it.\r\n\t\t// E.g. `{ position: absolute, top: 0, left: 0 }` means upper left corner of the element,\r\n\t\t// not upper-left corner of its border.\r\n\t\tleft -= ancestorBorderWidths.left;\r\n\t\ttop -= ancestorBorderWidths.top;\r\n\t}\r\n\r\n\treturn { left, top, name };\r\n}\r\n\r\n// For given position function, returns a corresponding `Rect` instance.\r\n//\r\n// @private\r\n// @param {Function} position A function returning {@link module:utils/dom/position~Position}.\r\n// @param {utils/dom/rect~Rect} targetRect A rect of the target.\r\n// @param {utils/dom/rect~Rect} elementRect A rect of positioned element.\r\n// @returns {Array} An array containing position name and its Rect.\r\nfunction getPosition( position, targetRect, elementRect ) {\r\n\tconst { left, top, name } = position( targetRect, elementRect );\r\n\r\n\treturn [ name, elementRect.clone().moveTo( left, top ) ];\r\n}\r\n\r\n// For a given array of positioning functions, returns such that provides the best\r\n// fit of the `elementRect` into the `limiterRect` and `viewportRect`.\r\n//\r\n// @private\r\n// @param {module:utils/dom/position~Options#positions} positions Functions returning\r\n// {@link module:utils/dom/position~Position} to be checked, in the order of preference.\r\n// @param {utils/dom/rect~Rect} targetRect A rect of the {@link module:utils/dom/position~Options#target}.\r\n// @param {utils/dom/rect~Rect} elementRect A rect of positioned {@link module:utils/dom/position~Options#element}.\r\n// @param {utils/dom/rect~Rect} limiterRect A rect of the {@link module:utils/dom/position~Options#limiter}.\r\n// @param {utils/dom/rect~Rect} viewportRect A rect of the viewport.\r\n// @returns {Array} An array containing the name of the position and it's rect.\r\nfunction getBestPosition( positions, targetRect, elementRect, limiterRect, viewportRect ) {\r\n\tlet maxLimiterIntersectArea = 0;\r\n\tlet maxViewportIntersectArea = 0;\r\n\tlet bestPositionRect;\r\n\tlet bestPositionName;\r\n\r\n\t// This is when element is fully visible.\r\n\tconst elementRectArea = elementRect.getArea();\r\n\r\n\tpositions.some( position => {\r\n\t\tconst [ positionName, positionRect ] = getPosition( position, targetRect, elementRect );\r\n\t\tlet limiterIntersectArea;\r\n\t\tlet viewportIntersectArea;\r\n\r\n\t\tif ( limiterRect ) {\r\n\t\t\tif ( viewportRect ) {\r\n\t\t\t\t// Consider only the part of the limiter which is visible in the viewport. So the limiter is getting limited.\r\n\t\t\t\tconst limiterViewportIntersectRect = limiterRect.getIntersection( viewportRect );\r\n\r\n\t\t\t\tif ( limiterViewportIntersectRect ) {\r\n\t\t\t\t\t// If the limiter is within the viewport, then check the intersection between that part of the\r\n\t\t\t\t\t// limiter and actual position.\r\n\t\t\t\t\tlimiterIntersectArea = limiterViewportIntersectRect.getIntersectionArea( positionRect );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlimiterIntersectArea = 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlimiterIntersectArea = limiterRect.getIntersectionArea( positionRect );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( viewportRect ) {\r\n\t\t\tviewportIntersectArea = viewportRect.getIntersectionArea( positionRect );\r\n\t\t}\r\n\r\n\t\t// The only criterion: intersection with the viewport.\r\n\t\tif ( viewportRect && !limiterRect ) {\r\n\t\t\tif ( viewportIntersectArea > maxViewportIntersectArea ) {\r\n\t\t\t\tsetBestPosition();\r\n\t\t\t}\r\n\t\t}\r\n\t\t// The only criterion: intersection with the limiter.\r\n\t\telse if ( !viewportRect && limiterRect ) {\r\n\t\t\tif ( limiterIntersectArea > maxLimiterIntersectArea ) {\r\n\t\t\t\tsetBestPosition();\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Two criteria: intersection with the viewport and the limiter visible in the viewport.\r\n\t\telse {\r\n\t\t\tif ( viewportIntersectArea > maxViewportIntersectArea && limiterIntersectArea >= maxLimiterIntersectArea ) {\r\n\t\t\t\tsetBestPosition();\r\n\t\t\t} else if ( viewportIntersectArea >= maxViewportIntersectArea && limiterIntersectArea > maxLimiterIntersectArea ) {\r\n\t\t\t\tsetBestPosition();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setBestPosition() {\r\n\t\t\tmaxViewportIntersectArea = viewportIntersectArea;\r\n\t\t\tmaxLimiterIntersectArea = limiterIntersectArea;\r\n\t\t\tbestPositionRect = positionRect;\r\n\t\t\tbestPositionName = positionName;\r\n\t\t}\r\n\r\n\t\t// If a such position is found that element is fully container by the limiter then, obviously,\r\n\t\t// there will be no better one, so finishing.\r\n\t\treturn limiterIntersectArea === elementRectArea;\r\n\t} );\r\n\r\n\treturn bestPositionRect ? [ bestPositionName, bestPositionRect ] : null;\r\n}\r\n\r\n// DOMRect (also Rect) works in a scroll–independent geometry but `position: absolute` doesn't.\r\n// This function converts Rect to `position: absolute` coordinates.\r\n//\r\n// @private\r\n// @param {utils/dom/rect~Rect} rect A rect to be converted.\r\n// @returns {Object} Object containing `left` and `top` properties, in absolute coordinates.\r\nfunction getAbsoluteRectCoordinates( { left, top } ) {\r\n\tconst { scrollX, scrollY } = global.window;\r\n\r\n\treturn {\r\n\t\tleft: left + scrollX,\r\n\t\ttop: top + scrollY,\r\n\t};\r\n}\r\n\r\n/**\r\n * The `getOptimalPosition` helper options.\r\n *\r\n * @interface module:utils/dom/position~Options\r\n */\r\n\r\n/**\r\n * Element that is to be positioned.\r\n *\r\n * @member {HTMLElement} #element\r\n */\r\n\r\n/**\r\n * Target with respect to which the `element` is to be positioned.\r\n *\r\n * @member {HTMLElement|Range|ClientRect|Rect|Function} #target\r\n */\r\n\r\n/**\r\n * An array of functions which return {@link module:utils/dom/position~Position} relative\r\n * to the `target`, in the order of preference.\r\n *\r\n * @member {Array.<Function>} #positions\r\n */\r\n\r\n/**\r\n * When set, the algorithm will chose position which fits the most in the\r\n * limiter's bounding rect.\r\n *\r\n * @member {HTMLElement|Range|ClientRect|Rect|Function} #limiter\r\n */\r\n\r\n/**\r\n * When set, the algorithm will chose such a position which fits `element`\r\n * the most inside visible viewport.\r\n *\r\n * @member {Boolean} #fitInViewport\r\n */\r\n\r\n/**\r\n * An object describing a position in `position: absolute` coordinate\r\n * system, along with position name.\r\n *\r\n * @typedef {Object} module:utils/dom/position~Position\r\n *\r\n * @property {Number} top Top position offset.\r\n * @property {Number} left Left position offset.\r\n * @property {String} name Name of the position.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module utils/dom/getpositionedancestor\r\n */\r\n\r\nimport global from './global';\r\n\r\n/**\r\n * For a given element, returns the nearest ancestor element which CSS position is not \"static\".\r\n *\r\n * @param {HTMLElement} element The native DOM element to be checked.\r\n * @returns {HTMLElement|null}\r\n */\r\nexport default function getPositionedAncestor( element ) {\r\n\twhile ( element && element.tagName.toLowerCase() != 'html' ) {\r\n\t\tif ( global.window.getComputedStyle( element ).position != 'static' ) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\r\n\t\telement = element.parentElement;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/panel/balloon/balloonpanelview\r\n */\r\n\r\nimport View from '../../view';\r\nimport { getOptimalPosition } from '@ckeditor/ckeditor5-utils/src/dom/position';\r\nimport isRange from '@ckeditor/ckeditor5-utils/src/dom/isrange';\r\nimport toUnit from '@ckeditor/ckeditor5-utils/src/dom/tounit';\r\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\r\nimport { isElement } from 'lodash-es';\r\n\r\nimport '../../../theme/components/panel/balloonpanel.css';\r\n\r\nconst toPx = toUnit( 'px' );\r\nconst defaultLimiterElement = global.document.body;\r\n\r\n/**\r\n * The balloon panel view class.\r\n *\r\n * A floating container which can\r\n * {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView#pin pin} to any\r\n * {@link module:utils/dom/position~Options#target target} in DOM and remain in that position\r\n * e.g. when the web page is scrolled.\r\n *\r\n * The balloon panel can be used to display contextual, non-blocking UI like forms, toolbars and\r\n * the like in its {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView#content} view\r\n * collection.\r\n *\r\n * There is a number of {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView.defaultPositions}\r\n * that the balloon can use, automatically switching from one to another when the viewport space becomes\r\n * scarce to keep the balloon visible to the user as long as it is possible. The balloon will also\r\n * accept any custom position set provided by the user compatible with the\r\n * {@link module:utils/dom/position~Options options}.\r\n *\r\n *\t\tconst panel = new BalloonPanelView( locale );\r\n *\t\tconst childView = new ChildView();\r\n *\t\tconst positions = BalloonPanelView.defaultPositions;\r\n *\r\n *\t\tpanel.render();\r\n *\r\n *\t\t// Add a child view to the panel's content collection.\r\n *\t\tpanel.content.add( childView );\r\n *\r\n *\t\t// Start pinning the panel to an element with the \"target\" id DOM.\r\n *\t\t// The balloon will remain pinned until unpin() is called.\r\n *\t\tpanel.pin( {\r\n *\t\t\ttarget: document.querySelector( '#target' ),\r\n *\t\t\tpositions: [\r\n *\t\t\t\tpositions.northArrowSouth,\r\n *\t\t\t\tpositions.southArrowNorth\r\n *\t\t\t]\r\n *\t\t} );\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class BalloonPanelView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * The absolute top position of the balloon panel in pixels.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 0\r\n\t\t * @member {Number} #top\r\n\t\t */\r\n\t\tthis.set( 'top', 0 );\r\n\r\n\t\t/**\r\n\t\t * The absolute left position of the balloon panel in pixels.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 0\r\n\t\t * @member {Number} #left\r\n\t\t */\r\n\t\tthis.set( 'left', 0 );\r\n\r\n\t\t/**\r\n\t\t * Balloon panel's current position. The position name is reflected in the CSS class set\r\n\t\t * to the balloon, i.e. `.ck-balloon-panel_arrow_nw` for \"arrow_nw\" position. The class\r\n\t\t * controls the minor aspects of the balloon's visual appearance like placement\r\n\t\t * of an {@link #withArrow arrow}. To support a new position, an additional CSS must be created.\r\n\t\t *\r\n\t\t * Default position names correspond with\r\n\t\t * {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView.defaultPositions}.\r\n\t\t *\r\n\t\t * See the {@link #attachTo} and {@link #pin} methods to learn about custom balloon positions.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 'arrow_nw'\r\n\t\t * @member {'arrow_nw'|'arrow_ne'|'arrow_sw'|'arrow_se'} #position\r\n\t\t */\r\n\t\tthis.set( 'position', 'arrow_nw' );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the balloon panel is visible or not.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default false\r\n\t\t * @member {Boolean} #isVisible\r\n\t\t */\r\n\t\tthis.set( 'isVisible', false );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the balloon panel has an arrow. The presence of the arrow\r\n\t\t * is reflected in `ck-balloon-panel_with-arrow` CSS class.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default true\r\n\t\t * @member {Boolean} #withArrow\r\n\t\t */\r\n\t\tthis.set( 'withArrow', true );\r\n\r\n\t\t/**\r\n\t\t * An additional CSS class added to the {@link #element}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #className\r\n\t\t */\r\n\t\tthis.set( 'className' );\r\n\r\n\t\t/**\r\n\t\t * A callback that starts pining the panel when {@link #isVisible} gets\r\n\t\t * `true`. Used by {@link #pin}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Function} #_pinWhenIsVisibleCallback\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views which creates balloon panel contents.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.content = this.createCollection();\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-balloon-panel',\r\n\t\t\t\t\tbind.to( 'position', value => `ck-balloon-panel_${ value }` ),\r\n\t\t\t\t\tbind.if( 'isVisible', 'ck-balloon-panel_visible' ),\r\n\t\t\t\t\tbind.if( 'withArrow', 'ck-balloon-panel_with-arrow' ),\r\n\t\t\t\t\tbind.to( 'className' )\r\n\t\t\t\t],\r\n\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\ttop: bind.to( 'top', toPx ),\r\n\t\t\t\t\tleft: bind.to( 'left', toPx )\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.content\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Shows the panel.\r\n\t *\r\n\t * See {@link #isVisible}.\r\n\t */\r\n\tshow() {\r\n\t\tthis.isVisible = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the panel.\r\n\t *\r\n\t * See {@link #isVisible}.\r\n\t */\r\n\thide() {\r\n\t\tthis.isVisible = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Attaches the panel to a specified {@link module:utils/dom/position~Options#target} with a\r\n\t * smart positioning heuristics that choses from available positions to make sure the panel\r\n\t * is visible to the user i.e. within the limits of the viewport.\r\n\t *\r\n\t * This method accepts configuration {@link module:utils/dom/position~Options options}\r\n\t * to set the `target`, optional `limiter` and `positions` the balloon should chose from.\r\n\t *\r\n\t *\t\tconst panel = new BalloonPanelView( locale );\r\n\t *\t\tconst positions = BalloonPanelView.defaultPositions;\r\n\t *\r\n\t *\t\tpanel.render();\r\n\t *\r\n\t *\t\t// Attach the panel to an element with the \"target\" id DOM.\r\n\t *\t\tpanel.attachTo( {\r\n\t *\t\t\ttarget: document.querySelector( '#target' ),\r\n\t *\t\t\tpositions: [\r\n\t *\t\t\t\tpositions.northArrowSouth,\r\n\t *\t\t\t\tpositions.southArrowNorth\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t * **Note**: Attaching the panel will also automatically {@link #show} it.\r\n\t *\r\n\t * **Note**: An attached panel will not follow its target when the window is scrolled or resized.\r\n\t * See the {@link #pin} method for more permanent positioning strategy.\r\n\t *\r\n\t * @param {module:utils/dom/position~Options} options Positioning options compatible with\r\n\t * {@link module:utils/dom/position~getOptimalPosition}. Default `positions` array is\r\n\t * {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView.defaultPositions}.\r\n\t */\r\n\tattachTo( options ) {\r\n\t\tthis.show();\r\n\r\n\t\tconst defaultPositions = BalloonPanelView.defaultPositions;\r\n\t\tconst positionOptions = Object.assign( {}, {\r\n\t\t\telement: this.element,\r\n\t\t\tpositions: [\r\n\t\t\t\tdefaultPositions.southArrowNorth,\r\n\t\t\t\tdefaultPositions.southArrowNorthWest,\r\n\t\t\t\tdefaultPositions.southArrowNorthEast,\r\n\t\t\t\tdefaultPositions.northArrowSouth,\r\n\t\t\t\tdefaultPositions.northArrowSouthWest,\r\n\t\t\t\tdefaultPositions.northArrowSouthEast\r\n\t\t\t],\r\n\t\t\tlimiter: defaultLimiterElement,\r\n\t\t\tfitInViewport: true\r\n\t\t}, options );\r\n\r\n\t\tconst { top, left, name: position } = BalloonPanelView._getOptimalPosition( positionOptions );\r\n\r\n\t\tObject.assign( this, { top, left, position } );\r\n\t}\r\n\r\n\t/**\r\n\t * Works the same way as the {@link #attachTo} method except that the position of the panel is\r\n\t * continuously updated when:\r\n\t *\r\n\t * * any ancestor of the {@link module:utils/dom/position~Options#target}\r\n\t * or {@link module:utils/dom/position~Options#limiter} is scrolled,\r\n\t * * the browser window gets resized or scrolled.\r\n\t *\r\n\t * Thanks to that, the panel always sticks to the {@link module:utils/dom/position~Options#target},\r\n\t * immune to the changing environment.\r\n\t *\r\n\t *\t\tconst panel = new BalloonPanelView( locale );\r\n\t *\t\tconst positions = BalloonPanelView.defaultPositions;\r\n\t *\r\n\t *\t\tpanel.render();\r\n\t *\r\n\t *\t\t// Pin the panel to an element with the \"target\" id DOM.\r\n\t *\t\tpanel.pin( {\r\n\t *\t\t\ttarget: document.querySelector( '#target' ),\r\n\t *\t\t\tpositions: [\r\n\t *\t\t\t\tpositions.northArrowSouth,\r\n\t *\t\t\t\tpositions.southArrowNorth\r\n\t *\t\t\t]\r\n\t *\t\t} );\r\n\t *\r\n\t * To leave the pinned state, use the {@link #unpin} method.\r\n\t *\r\n\t * **Note**: Pinning the panel will also automatically {@link #show} it.\r\n\t *\r\n\t * @param {module:utils/dom/position~Options} options Positioning options compatible with\r\n\t * {@link module:utils/dom/position~getOptimalPosition}. Default `positions` array is\r\n\t * {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView.defaultPositions}.\r\n\t */\r\n\tpin( options ) {\r\n\t\tthis.unpin();\r\n\r\n\t\tthis._pinWhenIsVisibleCallback = () => {\r\n\t\t\tif ( this.isVisible ) {\r\n\t\t\t\tthis._startPinning( options );\r\n\t\t\t} else {\r\n\t\t\t\tthis._stopPinning();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis._startPinning( options );\r\n\r\n\t\t// Control the state of the listeners depending on whether the panel is visible\r\n\t\t// or not.\r\n\t\t// TODO: Use on() (https://github.com/ckeditor/ckeditor5-utils/issues/144).\r\n\t\tthis.listenTo( this, 'change:isVisible', this._pinWhenIsVisibleCallback );\r\n\t}\r\n\r\n\t/**\r\n\t * Stops pinning the panel, as set up by {@link #pin}.\r\n\t */\r\n\tunpin() {\r\n\t\tif ( this._pinWhenIsVisibleCallback ) {\r\n\t\t\t// Deactivate listeners attached by pin().\r\n\t\t\tthis._stopPinning();\r\n\r\n\t\t\t// Deactivate the panel pin() control logic.\r\n\t\t\t// TODO: Use off() (https://github.com/ckeditor/ckeditor5-utils/issues/144).\r\n\t\t\tthis.stopListening( this, 'change:isVisible', this._pinWhenIsVisibleCallback );\r\n\r\n\t\t\tthis._pinWhenIsVisibleCallback = null;\r\n\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Starts managing the pinned state of the panel. See {@link #pin}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:utils/dom/position~Options} options Positioning options compatible with\r\n\t * {@link module:utils/dom/position~getOptimalPosition}.\r\n\t */\r\n\t_startPinning( options ) {\r\n\t\tthis.attachTo( options );\r\n\r\n\t\tconst targetElement = getDomElement( options.target );\r\n\t\tconst limiterElement = options.limiter ? getDomElement( options.limiter ) : defaultLimiterElement;\r\n\r\n\t\t// Then we need to listen on scroll event of eny element in the document.\r\n\t\tthis.listenTo( global.document, 'scroll', ( evt, domEvt ) => {\r\n\t\t\tconst scrollTarget = domEvt.target;\r\n\r\n\t\t\t// The position needs to be updated if the positioning target is within the scrolled element.\r\n\t\t\tconst isWithinScrollTarget = targetElement && scrollTarget.contains( targetElement );\r\n\r\n\t\t\t// The position needs to be updated if the positioning limiter is within the scrolled element.\r\n\t\t\tconst isLimiterWithinScrollTarget = limiterElement && scrollTarget.contains( limiterElement );\r\n\r\n\t\t\t// The positioning target and/or limiter can be a Rect, object etc..\r\n\t\t\t// There's no way to optimize the listener then.\r\n\t\t\tif ( isWithinScrollTarget || isLimiterWithinScrollTarget || !targetElement || !limiterElement ) {\r\n\t\t\t\tthis.attachTo( options );\r\n\t\t\t}\r\n\t\t}, { useCapture: true } );\r\n\r\n\t\t// We need to listen on window resize event and update position.\r\n\t\tthis.listenTo( global.window, 'resize', () => {\r\n\t\t\tthis.attachTo( options );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Stops managing the pinned state of the panel. See {@link #pin}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_stopPinning() {\r\n\t\tthis.stopListening( global.document, 'scroll' );\r\n\t\tthis.stopListening( global.window, 'resize' );\r\n\t}\r\n}\r\n\r\n// Returns the DOM element for given object or null, if there's none,\r\n// e.g. when passed object is a Rect instance or so.\r\n//\r\n// @private\r\n// @param {*} object\r\n// @returns {HTMLElement|null}\r\nfunction getDomElement( object ) {\r\n\tif ( isElement( object ) ) {\r\n\t\treturn object;\r\n\t}\r\n\r\n\tif ( isRange( object ) ) {\r\n\t\treturn object.commonAncestorContainer;\r\n\t}\r\n\r\n\tif ( typeof object == 'function' ) {\r\n\t\treturn getDomElement( object() );\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * A horizontal offset of the arrow tip from the edge of the balloon. Controlled by CSS.\r\n *\r\n *\t\t +-----|---------...\r\n *\t\t |     |\r\n *\t\t |     |\r\n *\t\t |     |\r\n *\t\t |     |\r\n *\t\t +--+  |  +------...\r\n *\t\t     \\ | /\r\n *\t\t      \\|/\r\n *\t    >|-----|<---------------- horizontal offset\r\n *\r\n * @default 30\r\n * @member {Number} module:ui/panel/balloon/balloonpanelview~BalloonPanelView.arrowHorizontalOffset\r\n */\r\nBalloonPanelView.arrowHorizontalOffset = 25;\r\n\r\n/**\r\n * A vertical offset of the arrow from the edge of the balloon. Controlled by CSS.\r\n *\r\n *\t\t +-------------...\r\n *\t\t |\r\n *\t\t |\r\n *\t\t |                      /-- vertical offset\r\n *\t\t |                     V\r\n *\t\t +--+    +-----...    ---------\r\n *\t\t     \\  /              |\r\n *\t\t      \\/               |\r\n *\t\t-------------------------------\r\n *\t\t                       ^\r\n *\r\n * @default 15\r\n * @member {Number} module:ui/panel/balloon/balloonpanelview~BalloonPanelView.arrowVerticalOffset\r\n */\r\nBalloonPanelView.arrowVerticalOffset = 10;\r\n\r\n/**\r\n * Function used to calculate the optimal position for the balloon.\r\n *\r\n * @protected\r\n * @member {Function} module:ui/panel/balloon/balloonpanelview~BalloonPanelView._getOptimalPosition\r\n */\r\nBalloonPanelView._getOptimalPosition = getOptimalPosition;\r\n\r\n/**\r\n * A default set of positioning functions used by the balloon panel view\r\n * when attaching using {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView#attachTo} method.\r\n *\r\n * The available positioning functions are as follow:\r\n *\r\n * **North**\r\n *\r\n * * `northArrowSouth`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t         V\r\n * \t\t    [ Target ]\r\n *\r\n * * `northArrowSouthEast`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t               V\r\n * \t\t          [ Target ]\r\n *\r\n * * `northArrowSouthWest`\r\n *\r\n * \t\t  +-----------------+\r\n * \t\t  |     Balloon     |\r\n * \t\t  +-----------------+\r\n * \t\t     V\r\n * \t\t[ Target ]\r\n *\r\n * **North west**\r\n *\r\n * * `northWestArrowSouth`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t         V\r\n * \t\t         [ Target ]\r\n *\r\n * * `northWestArrowSouthWest`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t   V\r\n * \t\t   [ Target ]\r\n *\r\n * * `northWestArrowSouthEast`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t               V\r\n * \t\t               [ Target ]\r\n *\r\n * **North east**\r\n *\r\n * * `northEastArrowSouth`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t         V\r\n * \t\t[ Target ]\r\n *\r\n * * `northEastArrowSouthEast`\r\n *\r\n * \t\t+-----------------+\r\n * \t\t|     Balloon     |\r\n * \t\t+-----------------+\r\n * \t\t               V\r\n * \t\t      [ Target ]\r\n *\r\n * * `northEastArrowSouthWest`\r\n *\r\n * \t\t      +-----------------+\r\n * \t\t      |     Balloon     |\r\n * \t\t      +-----------------+\r\n * \t\t         V\r\n * \t\t[ Target ]\r\n *\r\n * **South**\r\n *\r\n * * `southArrowNorth`\r\n *\r\n *\t\t    [ Target ]\r\n *\t\t         ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southArrowNorthEast`\r\n *\r\n *\t\t          [ Target ]\r\n *\t\t               ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southArrowNorthWest`\r\n *\r\n *\t\t[ Target ]\r\n *\t\t     ^\r\n *\t\t   +-----------------+\r\n *\t\t   |     Balloon     |\r\n *\t\t   +-----------------+\r\n *\r\n * **South west**\r\n *\r\n * * `southWestArrowNorth`\r\n *\r\n *\t\t         [ Target ]\r\n *\t\t         ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southWestArrowNorthWest`\r\n *\r\n *\t\t  [ Target ]\r\n *\t\t  ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southWestArrowNorthEast`\r\n *\r\n *\t\t               [ Target ]\r\n *\t\t               ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * **South east**\r\n *\r\n * * `southEastArrowNorth`\r\n *\r\n *\t\t[ Target ]\r\n *\t\t         ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southEastArrowNorthEast`\r\n *\r\n *\t\t       [ Target ]\r\n *\t\t                ^\r\n *\t\t+-----------------+\r\n *\t\t|     Balloon     |\r\n *\t\t+-----------------+\r\n *\r\n * * `southEastArrowNorthWest`\r\n *\r\n *\t\t[ Target ]\r\n *\t\t         ^\r\n *\t\t       +-----------------+\r\n *\t\t       |     Balloon     |\r\n *\t\t       +-----------------+\r\n *\r\n * See {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView#attachTo}.\r\n *\r\n * Positioning functions must be compatible with {@link module:utils/dom/position~Position}.\r\n *\r\n * The name that position function returns will be reflected in balloon panel's class that\r\n * controls the placement of the \"arrow\". See {@link #position} to learn more.\r\n *\r\n * @member {Object} module:ui/panel/balloon/balloonpanelview~BalloonPanelView.defaultPositions\r\n */\r\nBalloonPanelView.defaultPositions = {\r\n\t// ------- North\r\n\r\n\tnorthArrowSouth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - balloonRect.width / 2,\r\n\t\tname: 'arrow_s'\r\n\t} ),\r\n\r\n\tnorthArrowSouthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_se'\r\n\t} ),\r\n\r\n\tnorthArrowSouthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_sw'\r\n\t} ),\r\n\r\n\t// ------- North west\r\n\r\n\tnorthWestArrowSouth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - balloonRect.width / 2,\r\n\t\tname: 'arrow_s'\r\n\t} ),\r\n\r\n\tnorthWestArrowSouthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_sw'\r\n\t} ),\r\n\r\n\tnorthWestArrowSouthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_se'\r\n\t} ),\r\n\r\n\t// ------- North east\r\n\r\n\tnorthEastArrowSouth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - balloonRect.width / 2,\r\n\t\tname: 'arrow_s'\r\n\t} ),\r\n\r\n\tnorthEastArrowSouthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_se'\r\n\t} ),\r\n\r\n\tnorthEastArrowSouthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getNorthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_sw'\r\n\t} ),\r\n\r\n\t// ------- South\r\n\r\n\tsouthArrowNorth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - balloonRect.width / 2,\r\n\t\tname: 'arrow_n'\r\n\t} ),\r\n\r\n\tsouthArrowNorthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_ne'\r\n\t} ),\r\n\r\n\tsouthArrowNorthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left + targetRect.width / 2 - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_nw'\r\n\t} ),\r\n\r\n\t// ------- South west\r\n\r\n\tsouthWestArrowNorth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - balloonRect.width / 2,\r\n\t\tname: 'arrow_n'\r\n\t} ),\r\n\r\n\tsouthWestArrowNorthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_nw'\r\n\t} ),\r\n\r\n\tsouthWestArrowNorthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.left - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_ne'\r\n\t} ),\r\n\r\n\t// ------- South east\r\n\r\n\tsouthEastArrowNorth: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - balloonRect.width / 2,\r\n\t\tname: 'arrow_n'\r\n\t} ),\r\n\r\n\tsouthEastArrowNorthEast: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - balloonRect.width + BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_ne'\r\n\t} ),\r\n\r\n\tsouthEastArrowNorthWest: ( targetRect, balloonRect ) => ( {\r\n\t\ttop: getSouthTop( targetRect, balloonRect ),\r\n\t\tleft: targetRect.right - BalloonPanelView.arrowHorizontalOffset,\r\n\t\tname: 'arrow_nw'\r\n\t} ),\r\n};\r\n\r\n// Returns the top coordinate for positions starting with `north*`.\r\n//\r\n// @private\r\n// @param {utils/dom/rect~Rect} targetRect A rect of the target.\r\n// @param {utils/dom/rect~Rect} elementRect A rect of the balloon.\r\n// @returns {Number}\r\nfunction getNorthTop( targetRect, balloonRect ) {\r\n\treturn targetRect.top - balloonRect.height - BalloonPanelView.arrowVerticalOffset;\r\n}\r\n\r\n// Returns the top coordinate for positions starting with `south*`.\r\n//\r\n// @private\r\n// @param {utils/dom/rect~Rect} targetRect A rect of the target.\r\n// @param {utils/dom/rect~Rect} elementRect A rect of the balloon.\r\n// @returns {Number}\r\nfunction getSouthTop( targetRect ) {\r\n\treturn targetRect.bottom + BalloonPanelView.arrowVerticalOffset;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/panel/balloon/contextualballoon\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport BalloonPanelView from './balloonpanelview';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Provides the common contextual balloon panel for the editor.\r\n *\r\n * This plugin allows reusing a single {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView} instance\r\n * to display multiple contextual balloon panels in the editor.\r\n *\r\n * Child views of such a panel are stored in the stack and the last one in the stack is visible. When the\r\n * visible view is removed from the stack, the previous view becomes visible, etc. If there are no more\r\n * views in the stack, the balloon panel will hide.\r\n *\r\n * It simplifies managing the views and helps\r\n * avoid the unnecessary complexity of handling multiple {@link module:ui/panel/balloon/balloonpanelview~BalloonPanelView}\r\n * instances in the editor.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ContextualBalloon extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ContextualBalloon';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\t/**\r\n\t\t * The common balloon panel view.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/panel/balloon/balloonpanelview~BalloonPanelView} #view\r\n\t\t */\r\n\t\tthis.view = new BalloonPanelView();\r\n\r\n\t\t/**\r\n\t\t * The {@link module:utils/dom/position~Options#limiter position limiter}\r\n\t\t * for the {@link #view}, used when no `limiter` has been passed into {@link #add}\r\n\t\t * or {@link #updatePosition}.\r\n\t\t *\r\n\t\t * By default, a function, which obtains the farthest DOM\r\n\t\t * {@link module:engine/view/rooteditableelement~RootEditableElement}\r\n\t\t * of the {@link module:engine/view/document~Document#selection}.\r\n\t\t *\r\n\t\t * @member {module:utils/dom/position~Options#limiter} #positionLimiter\r\n\t\t */\r\n\t\tthis.positionLimiter = () => {\r\n\t\t\tconst view = this.editor.editing.view;\r\n\t\t\tconst viewDocument = view.document;\r\n\t\t\tconst editableElement = viewDocument.selection.editableElement;\r\n\r\n\t\t\tif ( editableElement ) {\r\n\t\t\t\treturn view.domConverter.mapViewToDom( editableElement.root );\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Stack of the views injected into the balloon. Last one in the stack is displayed\r\n\t\t * as a content of {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon#view}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Map} #_stack\r\n\t\t */\r\n\t\tthis._stack = new Map();\r\n\r\n\t\t// Add balloon panel view to editor `body` collection and wait until view will be ready.\r\n\t\tthis.editor.ui.view.body.add( this.view );\r\n\r\n\t\t// Editor should be focused when contextual balloon is focused.\r\n\t\tthis.editor.ui.focusTracker.add( this.view.element );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the currently visible view or `null` when there are no\r\n\t * views in the stack.\r\n\t *\r\n\t * @returns {module:ui/view~View|null}\r\n\t */\r\n\tget visibleView() {\r\n\t\tconst item = this._stack.get( this.view.content.get( 0 ) );\r\n\r\n\t\treturn item ? item.view : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` when the given view is in the stack. Otherwise returns `false`.\r\n\t *\r\n\t * @param {module:ui/view~View} view\r\n\t * @returns {Boolean}\r\n\t */\r\n\thasView( view ) {\r\n\t\treturn this._stack.has( view );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a new view to the stack and makes it visible.\r\n\t *\r\n\t * @param {Object} data Configuration of the view.\r\n\t * @param {module:ui/view~View} [data.view] Content of the balloon.\r\n\t * @param {module:utils/dom/position~Options} [data.position] Positioning options.\r\n\t * @param {String} [data.balloonClassName] Additional css class for {@link #view} added when given view is visible.\r\n\t */\r\n\tadd( data ) {\r\n\t\tif ( this.hasView( data.view ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to add configuration of the same view more than once.\r\n\t\t\t *\r\n\t\t\t * @error contextualballoon-add-view-exist\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'contextualballoon-add-view-exist: Cannot add configuration of the same view twice.' );\r\n\t\t}\r\n\r\n\t\t// When adding view to the not empty balloon.\r\n\t\tif ( this.visibleView ) {\r\n\t\t\t// Remove displayed content from the view.\r\n\t\t\tthis.view.content.remove( this.visibleView );\r\n\t\t}\r\n\r\n\t\t// Add new view to the stack.\r\n\t\tthis._stack.set( data.view, data );\r\n\r\n\t\t// And display it.\r\n\t\tthis._show( data );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the given view from the stack. If the removed view was visible,\r\n\t * then the view preceding it in the stack will become visible instead.\r\n\t * When there is no view in the stack then balloon will hide.\r\n\t *\r\n\t * @param {module:ui/view~View} view A view to be removed from the balloon.\r\n\t */\r\n\tremove( view ) {\r\n\t\tif ( !this.hasView( view ) ) {\r\n\t\t\t/**\r\n\t\t\t * Trying to remove configuration of the view not defined in the stack.\r\n\t\t\t *\r\n\t\t\t * @error contextualballoon-remove-view-not-exist\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'contextualballoon-remove-view-not-exist: Cannot remove configuration of not existing view.' );\r\n\t\t}\r\n\r\n\t\t// When visible view is being removed.\r\n\t\tif ( this.visibleView === view ) {\r\n\t\t\t// We need to remove it from the view content.\r\n\t\t\tthis.view.content.remove( view );\r\n\r\n\t\t\t// And then remove from the stack.\r\n\t\t\tthis._stack.delete( view );\r\n\r\n\t\t\t// Next we need to check if there is other view in stack to show.\r\n\t\t\tconst last = Array.from( this._stack.values() ).pop();\r\n\r\n\t\t\t// If it is some other view.\r\n\t\t\tif ( last ) {\r\n\t\t\t\t// Just show it.\r\n\t\t\t\tthis._show( last );\r\n\t\t\t} else {\r\n\t\t\t\t// Hide the balloon panel.\r\n\t\t\t\tthis.view.hide();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Just remove given view from the stack.\r\n\t\t\tthis._stack.delete( view );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the position of the balloon using position data of the first visible view in the stack.\r\n\t * When new position data is given then position data of currently visible panel will be updated.\r\n\t *\r\n\t * @param {module:utils/dom/position~Options} [position] position options.\r\n\t */\r\n\tupdatePosition( position ) {\r\n\t\tif ( position ) {\r\n\t\t\tthis._stack.get( this.visibleView ).position = position;\r\n\t\t}\r\n\r\n\t\tthis.view.pin( this._getBalloonPosition() );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the view as a content of the balloon and attaches balloon using position\r\n\t * options of the first view.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} data Configuration.\r\n\t * @param {module:ui/view~View} [data.view] View to show in the balloon.\r\n\t * @param {String} [data.balloonClassName=''] Additional class name which will added to the {#_balloon} view.\r\n\t */\r\n\t_show( { view, balloonClassName = '' } ) {\r\n\t\tthis.view.className = balloonClassName;\r\n\r\n\t\tthis.view.content.add( view );\r\n\t\tthis.view.pin( this._getBalloonPosition() );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns position options of the last view in the stack.\r\n\t * This keeps the balloon in the same position when view is changed.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:utils/dom/position~Options}\r\n\t */\r\n\t_getBalloonPosition() {\r\n\t\tlet position = Array.from( this._stack.values() ).pop().position;\r\n\r\n\t\t// Use the default limiter if none has been specified.\r\n\t\tif ( position && !position.limiter ) {\r\n\t\t\t// Don't modify the original options object.\r\n\t\t\tposition = Object.assign( {}, position, {\r\n\t\t\t\tlimiter: this.positionLimiter\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\treturn position;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/image/ui/utils\r\n */\r\n\r\nimport BalloonPanelView from '@ckeditor/ckeditor5-ui/src/panel/balloon/balloonpanelview';\r\nimport { isImageWidgetSelected } from '../utils';\r\n\r\n/**\r\n * A helper utility that positions the\r\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} instance\r\n * with respect to the image in the editor content, if one is selected.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n */\r\nexport function repositionContextualBalloon( editor ) {\r\n\tconst balloon = editor.plugins.get( 'ContextualBalloon' );\r\n\r\n\tif ( isImageWidgetSelected( editor.editing.view.document.selection ) ) {\r\n\t\tconst position = getBalloonPositionData( editor );\r\n\r\n\t\tballoon.updatePosition( position );\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns the positioning options that control the geometry of the\r\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} with respect\r\n * to the selected element in the editor content.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n * @returns {module:utils/dom/position~Options}\r\n */\r\nexport function getBalloonPositionData( editor ) {\r\n\tconst editingView = editor.editing.view;\r\n\tconst defaultPositions = BalloonPanelView.defaultPositions;\r\n\r\n\treturn {\r\n\t\ttarget: editingView.domConverter.viewToDom( editingView.document.selection.getSelectedElement() ),\r\n\t\tpositions: [\r\n\t\t\tdefaultPositions.northArrowSouth,\r\n\t\t\tdefaultPositions.northArrowSouthWest,\r\n\t\t\tdefaultPositions.northArrowSouthEast,\r\n\t\t\tdefaultPositions.southArrowNorth,\r\n\t\t\tdefaultPositions.southArrowNorthWest,\r\n\t\t\tdefaultPositions.southArrowNorthEast\r\n\t\t]\r\n\t};\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imagetextalternative/imagetextalternativeui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport clickOutsideHandler from '@ckeditor/ckeditor5-ui/src/bindings/clickoutsidehandler';\nimport TextAlternativeFormView from './ui/textalternativeformview';\nimport ContextualBalloon from '@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon';\nimport textAlternativeIcon from '@ckeditor/ckeditor5-core/theme/icons/low-vision.svg';\nimport {\n    repositionContextualBalloon,\n    getBalloonPositionData\n} from '../image/ui/utils';\nimport { isImageWidgetSelected } from '../image/utils';\n/**\r\n * The image text alternative UI plugin.\r\n *\r\n * The plugin uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageTextAlternativeUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [ContextualBalloon];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        this._createButton();\n        this._createForm();\n    }\n    /**\r\n\t * Creates a button showing the balloon panel for changing the image text alternative and\r\n\t * registers it in the editor {@link module:ui/componentfactory~ComponentFactory ComponentFactory}.\r\n\t *\r\n\t * @private\r\n\t */\n    _createButton() {\n        const editor = this.editor;\n        const t = editor.t;\n        editor.ui.componentFactory.add('imageTextAlternative', locale => {\n            const command = editor.commands.get('imageTextAlternative');\n            const view = new ButtonView(locale);\n            view.set({\n                label: t('ay'),\n                icon: textAlternativeIcon,\n                tooltip: true\n            });\n            view.bind('isEnabled').to(command, 'isEnabled');\n            this.listenTo(view, 'execute', () => this._showForm());\n            return view;\n        });\n    }\n    /**\r\n\t * Creates the {@link module:image/imagetextalternative/ui/textalternativeformview~TextAlternativeFormView}\r\n\t * form.\r\n\t *\r\n\t * @private\r\n\t */\n    _createForm() {\n        const editor = this.editor;\n        const view = editor.editing.view;\n        const viewDocument = view.document;\n        /**\r\n\t\t * The contextual balloon plugin instance.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\r\n\t\t */\n        this._balloon = this.editor.plugins.get('ContextualBalloon');\n        /**\r\n\t\t * A form containing a textarea and buttons, used to change the `alt` text value.\r\n\t\t *\r\n\t\t * @member {module:image/imagetextalternative/ui/textalternativeformview~TextAlternativeFormView}\r\n\t\t */\n        this._form = new TextAlternativeFormView(editor.locale);\n        // Render the form so its #element is available for clickOutsideHandler.\n        this._form.render();\n        this.listenTo(this._form, 'submit', () => {\n            editor.execute('imageTextAlternative', { newValue: this._form.labeledInput.inputView.element.value });\n            this._hideForm(true);\n        });\n        this.listenTo(this._form, 'cancel', () => {\n            this._hideForm(true);\n        });\n        // Close the form on Esc key press.\n        this._form.keystrokes.set('Esc', (data, cancel) => {\n            this._hideForm(true);\n            cancel();\n        });\n        // Reposition the balloon or hide the form if an image widget is no longer selected.\n        this.listenTo(editor.ui, 'update', () => {\n            if (!isImageWidgetSelected(viewDocument.selection)) {\n                this._hideForm(true);\n            } else if (this._isVisible) {\n                repositionContextualBalloon(editor);\n            }\n        });\n        // Close on click outside of balloon panel element.\n        clickOutsideHandler({\n            emitter: this._form,\n            activator: () => this._isVisible,\n            contextElements: [this._form.element],\n            callback: () => this._hideForm()\n        });\n    }\n    /**\r\n\t * Shows the {@link #_form} in the {@link #_balloon}.\r\n\t *\r\n\t * @private\r\n\t */\n    _showForm() {\n        if (this._isVisible) {\n            return;\n        }\n        const editor = this.editor;\n        const command = editor.commands.get('imageTextAlternative');\n        const labeledInput = this._form.labeledInput;\n        if (!this._balloon.hasView(this._form)) {\n            this._balloon.add({\n                view: this._form,\n                position: getBalloonPositionData(editor)\n            });\n        }\n        // Make sure that each time the panel shows up, the field remains in sync with the value of\n        // the command. If the user typed in the input, then canceled the balloon (`labeledInput#value`\n        // stays unaltered) and re-opened it without changing the value of the command, they would see the\n        // old value instead of the actual value of the command.\n        // https://github.com/ckeditor/ckeditor5-image/issues/114\n        labeledInput.value = labeledInput.inputView.element.value = command.value || '';\n        this._form.labeledInput.select();\n    }\n    /**\r\n\t * Removes the {@link #_form} from the {@link #_balloon}.\r\n\t *\r\n\t * @param {Boolean} [focusEditable=false] Controls whether the editing view is focused afterwards.\r\n\t * @private\r\n\t */\n    _hideForm(focusEditable) {\n        if (!this._isVisible) {\n            return;\n        }\n        this._balloon.remove(this._form);\n        if (focusEditable) {\n            this.editor.editing.view.focus();\n        }\n    }\n    /**\r\n\t * Returns `true` when the {@link #_form} is the visible view in the {@link #_balloon}.\r\n\t *\r\n\t * @private\r\n\t * @type {Boolean}\r\n\t */\n    get _isVisible() {\n        return this._balloon.visibleView == this._form;\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagetextalternative\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageTextAlternativeEditing from './imagetextalternative/imagetextalternativeediting';\r\nimport ImageTextAlternativeUI from './imagetextalternative/imagetextalternativeui';\r\n\r\n/**\r\n * The image text alternative plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image#image-styles image styles} documentation.\r\n *\r\n * This is a \"glue\" plugin which loads the\r\n *  {@link module:image/imagetextalternative/imagetextalternativeediting~ImageTextAlternativeEditing}\r\n * and {@link module:image/imagetextalternative/imagetextalternativeui~ImageTextAlternativeUI} plugins.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageTextAlternative extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageTextAlternativeEditing, ImageTextAlternativeUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageTextAlternative';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/image\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageEditing from '../src/image/imageediting';\r\nimport Widget from '@ckeditor/ckeditor5-widget/src/widget';\r\nimport ImageTextAlternative from './imagetextalternative';\r\n\r\nimport '../theme/image.css';\r\n\r\n/**\r\n * The image plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image image feature} documentation.\r\n *\r\n * This is a \"glue\" plugin which loads the following plugins:\r\n *\r\n * * {@link module:image/image/imageediting~ImageEditing},\r\n * * {@link module:image/imagetextalternative~ImageTextAlternative}.\r\n *\r\n * Usually, it is used in conjuction with other plugins from this package. See the {@glink api/image package page}\r\n * for more information.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Image extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageEditing, Widget, ImageTextAlternative ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Image';\r\n\t}\r\n}\r\n\r\n/**\r\n * The configuration of the image features. Used by the image features in the `@ckeditor/ckeditor5-image` package.\r\n *\r\n * Read more in {@link module:image/image~ImageConfig}.\r\n *\r\n * @member {module:image/image~ImageConfig} module:core/editor/editorconfig~EditorConfig#image\r\n */\r\n\r\n/**\r\n * The configuration of the image features. Used by the image features in the `@ckeditor/ckeditor5-image` package.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n * \t\t\t\timage: ... // Image feature options.\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface ImageConfig\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module upload/ui/filedialogbuttonview\r\n */\r\n\r\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\r\nimport View from '@ckeditor/ckeditor5-ui/src/view';\r\nimport ViewCollection from '@ckeditor/ckeditor5-ui/src/viewcollection';\r\nimport './filePickDialogStyle.scss';\r\n\r\n/**\r\n * The file dialog button view.\r\n *\r\n * This component provides a button that opens the native file selection dialog.\r\n * It can be used to implement the UI of a file upload feature.\r\n *\r\n *\t\tconst view = new FileDialogButtonView( locale );\r\n *\r\n *\t\tview.set( {\r\n *\t\t\tacceptedType: 'image/*',\r\n *\t\t\tallowMultipleFiles: true\r\n *\t\t} );\r\n *\r\n *\t\tview.buttonView.set( {\r\n *\t\t\tlabel: t( 'Insert image' ),\r\n *\t\t\ticon: imageIcon,\r\n *\t\t\ttooltip: true\r\n *\t\t} );\r\n *\r\n *\t\tview.on( 'done', ( evt, files ) => {\r\n *\t\t\tfor ( const file of Array.from( files ) ) {\r\n *\t\t\t\tconsole.log( 'Selected file', file );\r\n *\t\t\t}\r\n *\t\t} );\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class FileDialogButtonView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * The button view of the component.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\r\n\t\tthis.buttonView = new ButtonView( locale );\r\n\r\n\t\t/**\r\n\t\t * A hidden `<input>` view used to execute file dialog.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {module:upload/ui/filedialogbuttonview~FileInputView}\r\n\t\t */\r\n\t\tthis._fileInputView = new FileInputView( locale );\r\n\r\n\t\t/**\r\n\t\t * Accepted file types. Can be provided in form of file extensions, media type or one of:\r\n\t\t * * `audio/*`,\r\n\t\t * * `video/*`,\r\n\t\t * * `image/*`.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #acceptedType\r\n\t\t */\r\n\t\tthis._fileInputView.bind( 'acceptedType' ).to( this );\r\n\r\n\t\t/**\r\n\t\t * Indicates if multiple files can be selected. Defaults to `true`.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #allowMultipleFiles\r\n\t\t */\r\n\t\tthis._fileInputView.bind( 'allowMultipleFiles' ).to( this );\r\n\r\n\t\t/**\r\n\t\t * Fired when file dialog is closed with file selected.\r\n\t\t *\r\n\t\t *\t\tview.on( 'done', ( evt, files ) => {\r\n\t\t *\t\t\tfor ( const file of files ) {\r\n\t\t *\t\t\t\tconsole.log( 'Selected file', file );\r\n\t\t *\t\t\t}\r\n\t\t *\t\t}\r\n\t\t *\r\n\t\t * @event done\r\n\t\t * @param {Array.<File>} files Array of selected files.\r\n\t\t */\r\n\t\tthis.on( 'done', ( evt, files ) => {\r\n\t\t\tfor ( const file of files ) {\r\n\t\t\t\tconsole.log( 'Selected file', file );\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._fileInputView.delegate( 'done' ).to( this );\r\n\t\tthis.on( 'toggleVisibleEvent', (evt, msg) => console.log('caught toggleVisibleEvent from FileInputViev _fileInputView /w msg: ', msg))\r\n\t\tthis.delegate( 'toggleVisibleEvent' ).to( this );\r\n\t\tthis.on( 'picPick', (evt, imgSrc) => this.fire('xui', imgSrc));\r\n\t\t// this._fileInputView.delegate( 'picPick' ).to( this );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'span',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: 'ck-file-dialog-button',\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\tthis.buttonView,\r\n\t\t\t\tthis._fileInputView\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\tthis.buttonView.on( 'execute', () => {\r\n      // this._fileInputView.open();\r\n      // console.log('this.buttonView.on( \\'execute\\', ...)');\r\n      // this._fileInputView.element.style.display = 'none';\r\n      // console.log('this._fileInputView.element.style: ', this._fileInputView.element.style);\r\n      this._fileInputView.toggleVisible();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #buttonView}.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.buttonView.focus();\r\n\t}\r\n}\r\n\r\nclass PidorView extends View {\r\n  constructor( locale, imgSrc, imgName ) {\r\n    super( locale );\r\n    const bind = this.bindTemplate;\r\n    console.log(\"PidorView::constructor()\\nimgSrc: \", imgSrc);\r\n    this.setTemplate( {\r\n      tag: 'div',\r\n      attributes: {\r\n      \tclass: ['picture_box']\r\n      },\r\n      on: {\r\n      \tclick: bind.to(evt => {\r\n          console.log(\"PidorView::constructor()::setTemplate()::on::click.evt: \", evt);\r\n          this.fire( 'picturePicked', imgSrc );\r\n      \t})\r\n      },\r\n\r\n      children: [\r\n      {\r\n      \ttag: 'div',\r\n      \tattributes: {\r\n      \t\tclass: ['picture_box_main']\r\n      \t},\r\n\r\n      \tchildren: [\r\n      \t{\r\n      \t\ttag: 'img',\r\n      \t\tattributes: {\r\n      \t\t\tsrc: [imgSrc]\r\n      \t\t}\r\n      \t}]\r\n      },\r\n      {\r\n      \ttag: 'div',\r\n      \tattributes: {\r\n      \t\tclass: ['picture_box_name']\r\n      \t},\r\n\r\n      \tchildren: [\r\n      \t{\r\n      \t\ttag: 'span',\r\n\r\n      \t\tchildren: [\r\n      \t\t{\r\n      \t\t\ttext: imgName\r\n      \t\t}]\r\n      \t}]\r\n      }]\r\n    } );\r\n  }\r\n}\r\n\r\n/**\r\n * The hidden file input view class.\r\n *\r\n * @private\r\n * @extends {module:ui/view~View}\r\n */\r\nclass FileInputView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n    super( locale );\r\n    this.url = \"https://api.b2bfamily.com/upload/img/?apikey=P8hSqAUJjfciHBBldexsv5syya7EUpeM4rax2KbLL0ZS9tf3Lf\";\r\n    this.picturesViews = new ViewCollection(locale);\r\n    this.fetchImagesFromServer(this.url).then(response => response.forEach(imageElement => {\r\n      let pidorView = new PidorView( locale, \"https://\" + imageElement.path, imageElement.name );\r\n      pidorView.delegate('picturePicked').to(this);\r\n      this.picturesViews.add(pidorView);\r\n      console.log('NOW this.picturesViews.length: ', this.picturesViews.length);\r\n    }));\r\n    console.log('INITIAL this.picturesViews.length: ', this.picturesViews.length);\r\n    // this.picturesViews.forEach(pictureViev => pictureViev.delegate('picturePicked').to(this));\r\n    this.on('picturePicked', (evt, imgSrc) => this.fire('picPick', imgSrc));\r\n\t\t/**\r\n\t\t * Accepted file types. Can be provided in form of file extensions, media type or one of:\r\n\t\t * * `audio/*`,\r\n\t\t * * `video/*`,\r\n\t\t * * `image/*`.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #acceptedType\r\n\t\t */\r\n\t\tthis.set( 'acceptedType' );\r\n\r\n\t\t/**\r\n\t\t * Indicates if multiple files can be selected. Defaults to `false`.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #allowMultipleFiles\r\n\t\t */\r\n\t\tthis.set( 'allowMultipleFiles', false );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\tconst imagePickDialogueTemplate = {\r\n      tag: 'div',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tid: [\r\n\t\t\t\t\t'dialogue',\r\n        ],\r\n\t\t\t\ttabindex: '-1'\r\n\t\t\t},\r\n\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tid: ['dialogue_title']\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: 'Свойства изображения'\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tid: ['dialogue_content']\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\tid: ['dialogue_controls']\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tid: ['pic_pick']\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tid: ['link']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'label',\r\n\t\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\t\tfor: ['link_input']\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttext: 'Ссылка'\r\n\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input',\r\n\t\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\t\tid: ['link_input'],\r\n\t\t\t\t\t\t\t\t\t\t\ttype: ['text']\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tid: ['upload']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'label',\r\n\t\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\t\tfor: ['img_upload']\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttext: 'Загрузить на сервер'\r\n\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'form',\r\n\t\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\t\tid: ['files_upload']\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\ttag: 'input',\r\n\t\t\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tid: ['img_upload'],\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: ['file'],\r\n\t\t\t\t\t\t\t\t\t\t\t\tname: ['FileUpload'],\r\n\t\t\t\t\t\t\t\t\t\t\t\taccept: ['.jpg,.jpeg,.png,.gif']\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tid: ['alt_txt']\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'label',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tfor: ['alttxt_input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttext: 'Альтернативный текст'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'input',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tid: ['alttxt_input'],\r\n\t\t\t\t\t\t\t\t\t\ttype: ['text']\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tid: ['pic_props']\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Ширина'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Высота'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Граница'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Гориз. отступ'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Вертик. отступ'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\tclass: ['pic_prop']\r\n\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['caption']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\t\t\t\t children: [\r\n\t\t\t\t\t\t\t\t\t\t {\r\n\t\t\t\t\t\t\t\t\t\t   text: 'Выравнивание'\r\n\t\t\t\t\t\t\t\t\t\t }]\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\t\t\tclass: ['input']\r\n\t\t\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttag: 'input'\r\n\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\tid: ['pictures']\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tchildren: this.picturesViews\r\n\t\t\t\t\t\t\t// this.xuipizda\r\n\t\t\t\t\t\t\t// this.picturesViews\r\n\t\t\t\t\t\t\t// picturesViews\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\tid: ['dialogue_footer']\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tid: ['ok'],\r\n\t\t\t\t\t\t\t\tclass: ['footer_button']\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttext: 'OK'\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tid: ['cancel'],\r\n\t\t\t\t\t\t\t\tclass: ['footer_button']\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttext: 'OTMEHA'\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t}\r\n\t\t\t]\r\n    }\r\n    \r\n    const ImagePickInputTemplate = {\r\n\t\t\ttag: 'input',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\t// class: [\r\n\t\t\t\t// \t'ck-hidden'\r\n        // ],\r\n        style: 'display: none',\r\n\t\t\t\ttype: 'file',\r\n\t\t\t\ttabindex: '-1',\r\n\t\t\t\taccept: bind.to( 'acceptedType' ),\r\n\t\t\t\tmultiple: bind.to( 'allowMultipleFiles' )\r\n\t\t\t},\r\n\r\n\t\t\ton: {\r\n\t\t\t\t// Removing from code coverage since we cannot programmatically set input element files.\r\n\t\t\t\tchange: bind.to( /* istanbul ignore next */ () => {\r\n\t\t\t\t\tif ( this.element && this.element.files && this.element.files.length ) {\r\n\t\t\t\t\t\tthis.fire( 'done', this.element.files );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.element.value = '';\r\n        } ),\r\n        click: bind.to(() => {\r\n          console.log('this.element.style: ', this.element.style)\r\n        })\r\n\t\t\t}\r\n\t\t}\r\n\r\n    this.setTemplate( imagePickDialogueTemplate );\r\n\t}\r\n\r\n\t/**\r\n\t * Opens file dialog.\r\n\t */\r\n\topen() {\r\n\t\tthis.element.click();\r\n  }\r\n  toggleVisible() {\r\n    this.element.classList.toggle('visible');\r\n    this.fire( 'toggleVisibleEvent', 'ololo' );\r\n  }\r\n  // url = \"https://api.b2bfamily.com/upload/img/?apikey=P8hSqAUJjfciHBBldexsv5syya7EUpeM4rax2KbLL0ZS9tf3Lf\";\r\n  fetchImagesFromServer(url) {\r\n    return new Promise((resolve, reject) => {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open(\"GET\", url);\r\n      xhr.onload = () => resolve(JSON.parse(xhr.responseText));\r\n      xhr.onerror = () => reject(xhr.statusText);\r\n      xhr.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imageupload/utils\r\n */\r\n\r\n/* global fetch, File */\r\n\r\n/**\r\n * Checks if a given file is an image.\r\n *\r\n * @param {File} file\r\n * @returns {Boolean}\r\n */\r\nexport function isImageType( file ) {\r\n\tconst types = /^image\\/(jpeg|png|gif|bmp)$/;\r\n\r\n\treturn types.test( file.type );\r\n}\r\n\r\n/**\r\n * Creates a promise which fetches the image local source (base64 or blob) and returns as a `File` object.\r\n *\r\n * @param {module:engine/view/element~Element} image Image which source to fetch.\r\n * @returns {Promise} A promise which resolves when image source is fetched and converted to `File` instance.\r\n * It resolves with object holding initial image element (as `image`) and its file source (as `file`). If\r\n * the `file` attribute is null, it means fetching failed.\r\n */\r\nexport function fetchLocalImage( image ) {\r\n\treturn new Promise( resolve => {\r\n\t\t// Fetch works asynchronously and so does not block browser UI when processing data.\r\n\t\tfetch( image.getAttribute( 'src' ) )\r\n\t\t\t.then( resource => resource.blob() )\r\n\t\t\t.then( blob => {\r\n\t\t\t\tconst mimeType = getImageMimeType( blob, image.getAttribute( 'src' ) );\r\n\t\t\t\tconst ext = mimeType.replace( 'image/', '' );\r\n\t\t\t\tconst filename = `image.${ ext }`;\r\n\t\t\t\tconst file = createFileFromBlob( blob, filename, mimeType );\r\n\r\n\t\t\t\tresolve( { image, file } );\r\n\t\t\t} )\r\n\t\t\t.catch( () => {\r\n\t\t\t\t// We always resolve a promise so `Promise.all` will not reject if one of many fetch fails.\r\n\t\t\t\tresolve( { image, file: null } );\r\n\t\t\t} );\r\n\t} );\r\n}\r\n\r\n/**\r\n * Checks whether given node is an image element with local source (base64 or blob).\r\n *\r\n * @param {module:engine/view/node~Node} node Node to check.\r\n * @returns {Boolean}\r\n */\r\nexport function isLocalImage( node ) {\r\n\tif ( !node.is( 'element', 'img' ) || !node.getAttribute( 'src' ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn node.getAttribute( 'src' ).match( /^data:image\\/\\w+;base64,/g ) ||\r\n\t\tnode.getAttribute( 'src' ).match( /^blob:/g );\r\n}\r\n\r\n// Extracts image type based on its blob representation or its source.\r\n//\r\n// @param {String} src Image src attribute value.\r\n// @param {Blob} blob Image blob representation.\r\n// @returns {String}\r\nfunction getImageMimeType( blob, src ) {\r\n\tif ( blob.type ) {\r\n\t\treturn blob.type;\r\n\t} else if ( src.match( /data:(image\\/\\w+);base64/ ) ) {\r\n\t\treturn src.match( /data:(image\\/\\w+);base64/ )[ 1 ].toLowerCase();\r\n\t} else {\r\n\t\t// Fallback to 'jpeg' as common extension.\r\n\t\treturn 'image/jpeg';\r\n\t}\r\n}\r\n\r\n// Creates `File` instance from the given `Blob` instance using specified filename.\r\n//\r\n// @param {Blob} blob The `Blob` instance from which file will be created.\r\n// @param {String} filename Filename used during file creation.\r\n// @param {String} mimeType File mime type.\r\n// @returns {File|null} The `File` instance created from the given blob or `null` if `File API` is not available.\r\nfunction createFileFromBlob( blob, filename, mimeType ) {\r\n\ttry {\r\n\t\treturn new File( [ blob ], filename, { type: mimeType } );\r\n\t} catch ( err ) {\r\n\t\t// Edge does not support `File` constructor ATM, see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/9551546/.\r\n\t\t// However, the `File` function is present (so cannot be checked with `!window.File` or `typeof File === 'function'`), but\r\n\t\t// calling it with `new File( ... )` throws an error. This try-catch prevents that. Also when the function will\r\n\t\t// be implemented correctly in Edge the code will start working without any changes (see #247).\r\n\t\treturn null;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imageupload/imageuploadui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport FileDialogButtonView from '@ckeditor/ckeditor5-upload/src/ui/filedialogbuttonview';\nimport imageIcon from '@ckeditor/ckeditor5-core/theme/icons/image.svg';\nimport { isImageType } from './utils';\n/**\r\n * The image upload button plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image-upload Image upload feature} documentation.\r\n *\r\n * Adds the `'imageUpload'` button to the {@link module:ui/componentfactory~ComponentFactory UI component factory}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageUploadUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        // Setup `imageUpload` button.\n        editor.ui.componentFactory.add('imageUpload', locale => {\n            const view = new FileDialogButtonView(locale);\n            const command = editor.commands.get('imageUpload');\n            view.set({\n                acceptedType: 'image/*',\n                allowMultipleFiles: true\n            });\n            view.buttonView.set({\n                label: t('n'),\n                icon: imageIcon,\n                tooltip: true\n            });\n            view.buttonView.bind('isEnabled').to(command);\n            view.on('done', (evt, files) => {\n                const imagesToUpload = Array.from(files).filter(isImageType);\n                if (imagesToUpload.length) {\n                    // editor.execute( 'imageUpload', { file: imagesToUpload } );\n                    const content = '<p>A paragraph with <a href=\"https://ckeditor.com\">some link</a>.';\n                    const viewFragment = editor.data.processor.toView(content);\n                    const modelFragment = editor.data.toModel(viewFragment);\n                    editor.model.insertContent(modelFragment);\n                    // editor.model.change(writer => writer.insertText( 'CKEditor 5 rocks!', { linkHref: 'https://ckeditor.com/' }, editor.model.document.selection.getFirstPosition() ));\n                    console.log('DONEDONEDONE!!!');\n                }\n            });\n            view.on('xui', (evt, src) => {\n                const content = '<img src=\"' + src + '\">';\n                const viewFragment = editor.data.processor.toView(content);\n                const modelFragment = editor.data.toModel(viewFragment);\n                editor.model.insertContent(modelFragment);\n                view._fileInputView.toggleVisible();\n            });\n            return view;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imageupload/imageuploadprogress\r\n */\r\n\r\n/* globals setTimeout */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport FileRepository from '@ckeditor/ckeditor5-upload/src/filerepository';\r\nimport uploadingPlaceholder from '../../theme/icons/image_placeholder.svg';\r\nimport env from '@ckeditor/ckeditor5-utils/src/env';\r\n\r\nimport '../../theme/imageuploadprogress.css';\r\nimport '../../theme/imageuploadicon.css';\r\nimport '../../theme/imageuploadloader.css';\r\n\r\n/**\r\n * The image upload progress plugin.\r\n * It shows a placeholder when the image is read from the disk and a progress bar while the image is uploading.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageUploadProgress extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The image placeholder that is displayed before real image data can be accessed.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {String} #placeholder\r\n\t\t */\r\n\t\tthis.placeholder = 'data:image/svg+xml;utf8,' + encodeURIComponent( uploadingPlaceholder );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// Upload status change - update image's view according to that status.\r\n\t\teditor.editing.downcastDispatcher.on( 'attribute:uploadStatus:image', ( ...args ) => this.uploadStatusChange( ...args ) );\r\n\t}\r\n\r\n\t/**\r\n\t * This method is called each time the image `uploadStatus` attribute is changed.\r\n\t *\r\n\t * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n\t * @param {Object} data Additional information about the change.\r\n\t * @param {module:engine/conversion/modelconsumable~ModelConsumable} consumable Values to consume.\r\n\t * @param {Object} conversionApi\r\n\t */\r\n\tuploadStatusChange( evt, data, conversionApi ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst modelImage = data.item;\r\n\t\tconst uploadId = modelImage.getAttribute( 'uploadId' );\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\r\n\t\tconst status = uploadId ? data.attributeNewValue : null;\r\n\t\tconst placeholder = this.placeholder;\r\n\t\tconst viewFigure = editor.editing.mapper.toViewElement( modelImage );\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\tif ( status == 'reading' ) {\r\n\t\t\t// Start \"appearing\" effect and show placeholder with infinite progress bar on the top\r\n\t\t\t// while image is read from disk.\r\n\t\t\t_startAppearEffect( viewFigure, viewWriter );\r\n\t\t\t_showPlaceholder( placeholder, viewFigure, viewWriter );\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Show progress bar on the top of the image when image is uploading.\r\n\t\tif ( status == 'uploading' ) {\r\n\t\t\tconst loader = fileRepository.loaders.get( uploadId );\r\n\r\n\t\t\t// Start appear effect if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\r\n\t\t\t_startAppearEffect( viewFigure, viewWriter );\r\n\r\n\t\t\tif ( !loader ) {\r\n\t\t\t\t// There is no loader associated with uploadId - this means that image came from external changes.\r\n\t\t\t\t// In such cases we still want to show the placeholder until image is fully uploaded.\r\n\t\t\t\t// Show placeholder if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\r\n\t\t\t\t_showPlaceholder( placeholder, viewFigure, viewWriter );\r\n\t\t\t} else {\r\n\t\t\t\t// Hide placeholder and initialize progress bar showing upload progress.\r\n\t\t\t\t_hidePlaceholder( viewFigure, viewWriter );\r\n\t\t\t\t_showProgressBar( viewFigure, viewWriter, loader, editor.editing.view );\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Because in Edge there is no way to show fancy animation of completeIcon we need to skip it.\r\n\t\tif ( status == 'complete' && fileRepository.loaders.get( uploadId ) && !env.isEdge ) {\r\n\t\t\t_showCompleteIcon( viewFigure, viewWriter, editor.editing.view );\r\n\t\t}\r\n\r\n\t\t// Clean up.\r\n\t\t_hideProgressBar( viewFigure, viewWriter );\r\n\t\t_hidePlaceholder( viewFigure, viewWriter );\r\n\t\t_stopAppearEffect( viewFigure, viewWriter );\r\n\t}\r\n}\r\n\r\n// Symbol added to progress bar UIElement to distinguish it from other elements.\r\nconst progressBarSymbol = Symbol( 'progress-bar' );\r\n\r\n// Symbol added to placeholder UIElement to distinguish it from other elements.\r\nconst placeholderSymbol = Symbol( 'placeholder' );\r\n\r\n// Adds ck-appear class to the image figure if one is not already applied.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction _startAppearEffect( viewFigure, writer ) {\r\n\tif ( !viewFigure.hasClass( 'ck-appear' ) ) {\r\n\t\twriter.addClass( 'ck-appear', viewFigure );\r\n\t}\r\n}\r\n\r\n// Removes ck-appear class to the image figure if one is not already removed.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction _stopAppearEffect( viewFigure, writer ) {\r\n\twriter.removeClass( 'ck-appear', viewFigure );\r\n}\r\n\r\n// Shows placeholder together with infinite progress bar on given image figure.\r\n//\r\n// @param {String} Data-uri with a svg placeholder.\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction _showPlaceholder( placeholder, viewFigure, writer ) {\r\n\tif ( !viewFigure.hasClass( 'ck-image-upload-placeholder' ) ) {\r\n\t\twriter.addClass( 'ck-image-upload-placeholder', viewFigure );\r\n\t}\r\n\r\n\tconst viewImg = viewFigure.getChild( 0 );\r\n\r\n\tif ( viewImg.getAttribute( 'src' ) !== placeholder ) {\r\n\t\twriter.setAttribute( 'src', placeholder, viewImg );\r\n\t}\r\n\r\n\tif ( !_getUIElement( viewFigure, placeholderSymbol ) ) {\r\n\t\twriter.insert( writer.createPositionAfter( viewImg ), _createPlaceholder( writer ) );\r\n\t}\r\n}\r\n\r\n// Removes placeholder together with infinite progress bar on given image figure.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction _hidePlaceholder( viewFigure, writer ) {\r\n\tif ( viewFigure.hasClass( 'ck-image-upload-placeholder' ) ) {\r\n\t\twriter.removeClass( 'ck-image-upload-placeholder', viewFigure );\r\n\t}\r\n\r\n\t_removeUIElement( viewFigure, writer, placeholderSymbol );\r\n}\r\n\r\n// Shows progress bar displaying upload progress.\r\n// Attaches it to the file loader to update when upload percentace is changed.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @param {module:upload/filerepository~FileLoader} loader\r\n// @param {module:engine/view/view~View} view\r\nfunction _showProgressBar( viewFigure, writer, loader, view ) {\r\n\tconst progressBar = _createProgressBar( writer );\r\n\twriter.insert( writer.createPositionAt( viewFigure, 'end' ), progressBar );\r\n\r\n\t// Update progress bar width when uploadedPercent is changed.\r\n\tloader.on( 'change:uploadedPercent', ( evt, name, value ) => {\r\n\t\tview.change( writer => {\r\n\t\t\twriter.setStyle( 'width', value + '%', progressBar );\r\n\t\t} );\r\n\t} );\r\n}\r\n\r\n// Hides upload progress bar.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction _hideProgressBar( viewFigure, writer ) {\r\n\t_removeUIElement( viewFigure, writer, progressBarSymbol );\r\n}\r\n\r\n// Shows complete icon and hides after a certain amount of time.\r\n//\r\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @param {module:engine/view/view~View} view\r\nfunction _showCompleteIcon( viewFigure, writer, view ) {\r\n\tconst completeIcon = writer.createUIElement( 'div', { class: 'ck-image-upload-complete-icon' } );\r\n\r\n\twriter.insert( writer.createPositionAt( viewFigure, 'end' ), completeIcon );\r\n\r\n\tsetTimeout( () => {\r\n\t\tview.change( writer => writer.remove( writer.createRangeOn( completeIcon ) ) );\r\n\t}, 3000 );\r\n}\r\n\r\n// Create progress bar element using {@link module:engine/view/uielement~UIElement}.\r\n//\r\n// @private\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @returns {module:engine/view/uielement~UIElement}\r\nfunction _createProgressBar( writer ) {\r\n\tconst progressBar = writer.createUIElement( 'div', { class: 'ck-progress-bar' } );\r\n\r\n\twriter.setCustomProperty( progressBarSymbol, true, progressBar );\r\n\r\n\treturn progressBar;\r\n}\r\n\r\n// Create placeholder element using {@link module:engine/view/uielement~UIElement}.\r\n//\r\n// @private\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @returns {module:engine/view/uielement~UIElement}\r\nfunction _createPlaceholder( writer ) {\r\n\tconst placeholder = writer.createUIElement( 'div', { class: 'ck-upload-placeholder-loader' } );\r\n\r\n\twriter.setCustomProperty( placeholderSymbol, true, placeholder );\r\n\r\n\treturn placeholder;\r\n}\r\n\r\n// Returns {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\r\n// Returns `undefined` if element is not found.\r\n//\r\n// @private\r\n// @param {module:engine/view/element~Element} imageFigure\r\n// @param {Symbol} uniqueProperty\r\n// @returns {module:engine/view/uielement~UIElement|undefined}\r\nfunction _getUIElement( imageFigure, uniqueProperty ) {\r\n\tfor ( const child of imageFigure.getChildren() ) {\r\n\t\tif ( child.getCustomProperty( uniqueProperty ) ) {\r\n\t\t\treturn child;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Removes {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\r\n//\r\n// @private\r\n// @param {module:engine/view/element~Element} imageFigure\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @param {Symbol} uniqueProperty\r\nfunction _removeUIElement( viewFigure, writer, uniqueProperty ) {\r\n\tconst element = _getUIElement( viewFigure, uniqueProperty );\r\n\r\n\tif ( element ) {\r\n\t\twriter.remove( writer.createRangeOn( element ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module module:engine/view/upcastwriter\r\n */\r\n\r\nimport DocumentFragment from './documentfragment';\r\nimport Element from './element';\r\nimport Text from './text';\r\nimport { isPlainObject } from 'lodash-es';\r\nimport Position from './position';\r\nimport Range from './range';\r\nimport Selection from './selection';\r\n\r\n/**\r\n * View upcast writer. It provides a set of methods used to manipulate non-semantic view trees.\r\n *\r\n * It should be used only while working on a non-semantic view\r\n * (e.g. a view created from HTML string on paste).\r\n * To manipulate a view which was or is being downcasted from the the model use the\r\n * {@link module:engine/view/downcastwriter~DowncastWriter downcast writer}.\r\n *\r\n * Read more about changing the view in the {@glink framework/guides/architecture/editing-engine#changing-the-view Changing the view}\r\n * section of the {@glink framework/guides/architecture/editing-engine Editing engine architecture} guide.\r\n *\r\n * Unlike `DowncastWriter`, which is available in the {@link module:engine/view/view~View#change `View#change()`} block,\r\n * `UpcastWriter` can wherever you need it:\r\n *\r\n *\t\tconst writer = new UpcastWriter();\r\n *\t\tconst text = writer.createText( 'foo!' );\r\n *\r\n *\t\twriter.appendChild( text, someViewElement );\r\n */\r\nexport default class UpcastWriter {\r\n\t/**\r\n\t * Creates a new {@link module:engine/view/documentfragment~DocumentFragment} instance.\r\n\t *\r\n\t * @param {module:engine/view/node~Node|Iterable.<module:engine/view/node~Node>} [children]\r\n\t * A list of nodes to be inserted into the created document fragment.\r\n\t * @returns {module:engine/view/documentfragment~DocumentFragment} The created document fragment.\r\n\t */\r\n\tcreateDocumentFragment( children ) {\r\n\t\treturn new DocumentFragment( children );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/view/element~Element} instance.\r\n\t *\r\n\t * Attributes can be passed in various formats:\r\n\t *\r\n\t *\t\tupcastWriter.createElement( 'div', { class: 'editor', contentEditable: 'true' } ); // object\r\n\t *\t\tupcastWriter.createElement( 'div', [ [ 'class', 'editor' ], [ 'contentEditable', 'true' ] ] ); // map-like iterator\r\n\t *\t\tupcastWriter.createElement( 'div', mapOfAttributes ); // map\r\n\t *\r\n\t * @param {String} name Node name.\r\n\t * @param {Object|Iterable} [attrs] Collection of attributes.\r\n\t * @param {module:engine/view/node~Node|Iterable.<module:engine/view/node~Node>} [children]\r\n\t * A list of nodes to be inserted into created element.\r\n\t * @returns {module:engine/view/element~Element} Created element.\r\n\t */\r\n\tcreateElement( name, attrs, children ) {\r\n\t\treturn new Element( name, attrs, children );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/view/text~Text} instance.\r\n\t *\r\n\t * @param {String} data The text's data.\r\n\t * @returns {module:engine/view/text~Text} The created text node.\r\n\t */\r\n\tcreateText( data ) {\r\n\t\treturn new Text( data );\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the provided element.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_clone\r\n\t * @param {module:engine/view/element~Element} element Element to be cloned.\r\n\t * @param {Boolean} [deep=false] If set to `true` clones element and all its children recursively. When set to `false`,\r\n\t * element will be cloned without any children.\r\n\t * @returns {module:engine/view/element~Element} Clone of this element.\r\n\t */\r\n\tclone( element, deep = false ) {\r\n\t\treturn element._clone( deep );\r\n\t}\r\n\r\n\t/**\r\n\t * Appends a child node or a list of child nodes at the end of this node\r\n\t * and sets the parent of these nodes to this element.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_appendChild\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} element Element\r\n\t * to which items will be appended.\r\n\t * @fires module:engine/view/node~Node#event:change\r\n\t * @returns {Number} Number of appended nodes.\r\n\t */\r\n\tappendChild( items, element ) {\r\n\t\treturn element._appendChild( items );\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a child node or a list of child nodes on the given index and sets the parent of these nodes to\r\n\t * this element.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_insertChild\r\n\t * @param {Number} index Offset at which nodes should be inserted.\r\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} element Element\r\n\t * to which items will be inserted.\r\n\t * @fires module:engine/view/node~Node#event:change\r\n\t * @returns {Number} Number of inserted nodes.\r\n\t */\r\n\tinsertChild( index, items, element ) {\r\n\t\treturn element._insertChild( index, items );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the given number of child nodes starting at the given index and set the parent of these nodes to `null`.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_removeChildren\r\n\t * @param {Number} index Offset from which nodes will be removed.\r\n\t * @param {Number} howMany Number of nodes to remove.\r\n\t * @param {module:engine/view/element~Element|module:engine/view/documentfragment~DocumentFragment} element Element\r\n\t * which children will be removed.\r\n\t * @fires module:engine/view/node~Node#event:change\r\n\t * @returns {Array.<module:engine/view/node~Node>} The array containing removed nodes.\r\n\t */\r\n\tremoveChildren( index, howMany, element ) {\r\n\t\treturn element._removeChildren( index, howMany );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes given element from the view structure. Will not have effect on detached elements.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} element Element which will be removed.\r\n\t * @returns {Array.<module:engine/view/node~Node>} The array containing removed nodes.\r\n\t */\r\n\tremove( element ) {\r\n\t\tconst parent = element.parent;\r\n\r\n\t\tif ( parent ) {\r\n\t\t\treturn this.removeChildren( parent.getChildIndex( element ), 1, parent );\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces given element with the new one in the view structure. Will not have effect on detached elements.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} oldElement Element which will be replaced.\r\n\t * @param {module:engine/view/element~Element} newElement Element which will be inserted in the place of the old element.\r\n\t * @returns {Boolean} Whether old element was successfully replaced.\r\n\t */\r\n\treplace( oldElement, newElement ) {\r\n\t\tconst parent = oldElement.parent;\r\n\r\n\t\tif ( parent ) {\r\n\t\t\tconst index = parent.getChildIndex( oldElement );\r\n\r\n\t\t\tthis.removeChildren( index, 1, parent );\r\n\t\t\tthis.insertChild( index, newElement, parent );\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Renames element by creating a copy of a given element but with its name changed and then moving contents of the\r\n\t * old element to the new one.\r\n\t *\r\n\t * Since this function creates a new element and removes the given one, the new element is returned to keep reference.\r\n\t *\r\n\t * @param {String} newName New element name.\r\n\t * @param {module:engine/view/element~Element} element Element to be renamed.\r\n\t * @returns {module:engine/view/element~Element|null} New element or null if the old element\r\n\t * was not replaced (happens for detached elements).\r\n\t */\r\n\trename( newName, element ) {\r\n\t\tconst newElement = new Element( newName, element.getAttributes(), element.getChildren() );\r\n\r\n\t\treturn this.replace( element, newElement ) ? newElement : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds or overwrites element's attribute with a specified key and value.\r\n\t *\r\n\t *\t\twriter.setAttribute( linkElement, 'href', 'http://ckeditor.com' );\r\n\t *\r\n\t * @see module:engine/view/element~Element#_setAttribute\r\n\t * @param {String} key Attribute key.\r\n\t * @param {String} value Attribute value.\r\n\t * @param {module:engine/view/element~Element} element Element for which attribute will be set.\r\n\t */\r\n\tsetAttribute( key, value, element ) {\r\n\t\telement._setAttribute( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes attribute from the element.\r\n\t *\r\n\t *\t\twriter.removeAttribute( linkElement, 'href' );\r\n\t *\r\n\t * @see module:engine/view/element~Element#_removeAttribute\r\n\t * @param {String} key Attribute key.\r\n\t * @param {module:engine/view/element~Element} element Element from which attribute will be removed.\r\n\t */\r\n\tremoveAttribute( key, element ) {\r\n\t\telement._removeAttribute( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds specified class to the element.\r\n\t *\r\n\t *\t\twriter.addClass( linkElement, 'foo' );\r\n\t *\t\twriter.addClass( linkElement, [ 'foo', 'bar' ] );\r\n\t *\r\n\t * @see module:engine/view/element~Element#_addClass\r\n\t * @param {Array.<String>|String} className Single class name or array of class names which will be added.\r\n\t * @param {module:engine/view/element~Element} element Element for which class will be added.\r\n\t */\r\n\taddClass( className, element ) {\r\n\t\telement._addClass( className );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified class from the element.\r\n\t *\r\n\t *\t\twriter.removeClass( linkElement, 'foo' );\r\n\t *\t\twriter.removeClass( linkElement, [ 'foo', 'bar' ] );\r\n\t *\r\n\t * @see module:engine/view/element~Element#_removeClass\r\n\t * @param {Array.<String>|String} className Single class name or array of class names which will be removed.\r\n\t * @param {module:engine/view/element~Element} element Element from which class will be removed.\r\n\t */\r\n\tremoveClass( className, element ) {\r\n\t\telement._removeClass( className );\r\n\t}\r\n\r\n\t/**\r\n\t * Adds style to the element.\r\n\t *\r\n\t *\t\twriter.setStyle( element, 'color', 'red' );\r\n\t *\t\twriter.setStyle( element, {\r\n\t *\t\t\tcolor: 'red',\r\n\t *\t\t\tposition: 'fixed'\r\n\t *\t\t} );\r\n\t *\r\n\t * @see module:engine/view/element~Element#_setStyle\r\n\t * @param {String|Object} property Property name or object with key - value pairs.\r\n\t * @param {String} [value] Value to set. This parameter is ignored if object is provided as the first parameter.\r\n\t * @param {module:engine/view/element~Element} element Element for which style will be added.\r\n\t */\r\n\tsetStyle( property, value, element ) {\r\n\t\tif ( isPlainObject( property ) && element === undefined ) {\r\n\t\t\telement = value;\r\n\t\t}\r\n\t\telement._setStyle( property, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specified style from the element.\r\n\t *\r\n\t *\t\twriter.removeStyle( element, 'color' );  // Removes 'color' style.\r\n\t *\t\twriter.removeStyle( element, [ 'color', 'border-top' ] ); // Removes both 'color' and 'border-top' styles.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_removeStyle\r\n\t * @param {Array.<String>|String} property Style property name or names to be removed.\r\n\t * @param {module:engine/view/element~Element} element Element from which style will be removed.\r\n\t */\r\n\tremoveStyle( property, element ) {\r\n\t\telement._removeStyle( property );\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a custom property on element. Unlike attributes, custom properties are not rendered to the DOM,\r\n\t * so they can be used to add special data to elements.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_setCustomProperty\r\n\t * @param {String|Symbol} key Custom property name/key.\r\n\t * @param {*} value Custom property value to be stored.\r\n\t * @param {module:engine/view/element~Element} element Element for which custom property will be set.\r\n\t */\r\n\tsetCustomProperty( key, value, element ) {\r\n\t\telement._setCustomProperty( key, value );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a custom property stored under the given key.\r\n\t *\r\n\t * @see module:engine/view/element~Element#_removeCustomProperty\r\n\t * @param {String|Symbol} key Name/key of the custom property to be removed.\r\n\t * @param {module:engine/view/element~Element} element Element from which the custom property will be removed.\r\n\t * @returns {Boolean} Returns true if property was removed.\r\n\t */\r\n\tremoveCustomProperty( key, element ) {\r\n\t\treturn element._removeCustomProperty( key );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates position at the given location. The location can be specified as:\r\n\t *\r\n\t * * a {@link module:engine/view/position~Position position},\r\n\t * * parent element and offset (offset defaults to `0`),\r\n\t * * parent element and `'end'` (sets position at the end of that element),\r\n\t * * {@link module:engine/view/item~Item view item} and `'before'` or `'after'` (sets position before or after given view item).\r\n\t *\r\n\t * This method is a shortcut to other constructors such as:\r\n\t *\r\n\t * * {@link #createPositionBefore},\r\n\t * * {@link #createPositionAfter},\r\n\t *\r\n\t * @param {module:engine/view/item~Item|module:engine/model/position~Position} itemOrPosition\r\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\r\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\r\n\t */\r\n\tcreatePositionAt( itemOrPosition, offset ) {\r\n\t\treturn Position._createAt( itemOrPosition, offset );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position after given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item after which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionAfter( item ) {\r\n\t\treturn Position._createAfter( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new position before given view item.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item View item before which the position should be located.\r\n\t * @returns {module:engine/view/position~Position}\r\n\t */\r\n\tcreatePositionBefore( item ) {\r\n\t\treturn Position._createBefore( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range spanning from `start` position to `end` position.\r\n\t *\r\n\t * **Note:** This factory method creates it's own {@link module:engine/view/position~Position} instances basing on passed values.\r\n\t *\r\n\t * @param {module:engine/view/position~Position} start Start position.\r\n\t * @param {module:engine/view/position~Position} [end] End position. If not set, range will be collapsed at `start` position.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRange( start, end ) {\r\n\t\treturn new Range( start, end );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range that starts before given {@link module:engine/view/item~Item view item} and ends after it.\r\n\t *\r\n\t * @param {module:engine/view/item~Item} item\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeOn( item ) {\r\n\t\treturn Range._createOn( item );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\r\n\t * that element and ends after the last child of that element.\r\n\t *\r\n\t * @param {module:engine/view/element~Element} element Element which is a parent for the range.\r\n\t * @returns {module:engine/view/range~Range}\r\n\t */\r\n\tcreateRangeIn( element ) {\r\n\t\treturn Range._createIn( element );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new {@link module:engine/view/selection~Selection} instance.\r\n\t *\r\n\t * \t\t// Creates empty selection without ranges.\r\n\t *\t\tconst selection = writer.createSelection();\r\n\t *\r\n\t *\t\t// Creates selection at the given range.\r\n\t *\t\tconst range = writer.createRange( start, end );\r\n\t *\t\tconst selection = writer.createSelection( range );\r\n\t *\r\n\t *\t\t// Creates selection at the given ranges\r\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\r\n\t *\t\tconst selection = writer.createSelection( ranges );\r\n\t *\r\n\t *\t\t// Creates selection from the other selection.\r\n\t *\t\tconst otherSelection = writer.createSelection();\r\n\t *\t\tconst selection = writer.createSelection( otherSelection );\r\n\t *\r\n\t *\t\t// Creates selection from the document selection.\r\n\t *\t\tconst selection = writer.createSelection( editor.editing.view.document.selection );\r\n\t *\r\n\t * \t\t// Creates selection at the given position.\r\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\r\n\t *\t\tconst selection = writer.createSelection( position );\r\n\t *\r\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\r\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\r\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\r\n\t *\r\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\r\n\t *\t\t// first child of that element and ends after the last child of that element.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\r\n\t *\r\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\r\n\t *\t\t// just after the item.\r\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\r\n\t *\r\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\r\n\t *\r\n\t *\t\t// Creates backward selection.\r\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\r\n\t *\r\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\r\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\r\n\t * represented in other way, for example by applying proper CSS class.\r\n\t *\r\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\r\n\t * (and be  properly handled by screen readers).\r\n\t *\r\n\t *\t\t// Creates fake selection with label.\r\n\t *\t\tconst selection = writer.createSelection( range, { fake: true, label: 'foo' } );\r\n\t *\r\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection|\r\n\t * module:engine/view/position~Position|Iterable.<module:engine/view/range~Range>|module:engine/view/range~Range|\r\n\t * module:engine/view/item~Item|null} [selectable=null]\r\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\r\n\t * @param {Object} [options]\r\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\r\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\r\n\t * @param {String} [options.label] Label for the fake selection.\r\n\t * @returns {module:engine/view/selection~Selection}\r\n\t */\r\n\tcreateSelection( selectable, placeOrOffset, options ) {\r\n\t\treturn new Selection( selectable, placeOrOffset, options );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport FileRepository from '@ckeditor/ckeditor5-upload/src/filerepository';\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { insertImage, isImageAllowed } from '../image/utils';\r\n\r\n/**\r\n * @module image/imageupload/imageuploadcommand\r\n */\r\n\r\n/**\r\n * Image upload command.\r\n *\r\n * The command is registered by the {@link module:image/imageupload/imageuploadediting~ImageUploadEditing} plugin as `'imageUpload'`.\r\n *\r\n * In order to upload an image at the current selection position\r\n * (according to the {@link module:widget/utils~findOptimalInsertionPosition} algorithm),\r\n * execute the command and pass the native image file instance:\r\n *\r\n *\t\tthis.listenTo( editor.editing.view.document, 'clipboardInput', ( evt, data ) => {\r\n *\t\t\t// Assuming that only images were pasted:\r\n *\t\t\tconst images = Array.from( data.dataTransfer.files );\r\n *\r\n *\t\t\t// Upload the first image:\r\n *\t\t\teditor.execute( 'imageUpload', { file: images[ 0 ] } );\r\n *\t\t} );\r\n *\r\n * It is also possible to insert multiple images at once:\r\n *\r\n *\t\teditor.execute( 'imageUpload', {\r\n *\t\t\tfile: [\r\n *\t\t\t\tfile1,\r\n *\t\t\t\tfile2\r\n *\t\t\t]\r\n *\t\t} );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ImageUploadCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = isImageAllowed( this.editor.model );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} options Options for the executed command.\r\n\t * @param {File|Array.<File>} options.file The image file or an array of image files to upload.\r\n\t */\r\n\texecute( options ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst model = editor.model;\r\n\r\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst filesToUpload = Array.isArray( options.file ) ? options.file : [ options.file ];\r\n\r\n\t\t\tfor ( const file of filesToUpload ) {\r\n\t\t\t\tuploadImage( writer, model, fileRepository, file );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Handles uploading single file.\r\n//\r\n// @param {module:engine/model/writer~writer} writer\r\n// @param {module:engine/model/model~Model} model\r\n// @param {File} file\r\nfunction uploadImage( writer, model, fileRepository, file ) {\r\n\tconst loader = fileRepository.createLoader( file );\r\n\r\n\t// Do not throw when upload adapter is not set. FileRepository will log an error anyway.\r\n\tif ( !loader ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tinsertImage( writer, model, { uploadId: loader.id } );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imageupload/imageuploadediting\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport FileRepository from '@ckeditor/ckeditor5-upload/src/filerepository';\nimport Notification from '@ckeditor/ckeditor5-ui/src/notification/notification';\nimport UpcastWriter from '@ckeditor/ckeditor5-engine/src/view/upcastwriter';\nimport { upcastAttributeToAttribute } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\nimport ImageUploadCommand from '../../src/imageupload/imageuploadcommand';\nimport {\n    isImageType,\n    isLocalImage,\n    fetchLocalImage\n} from '../../src/imageupload/utils';\n/**\r\n * The editing part of the image upload feature. It registers the `'imageUpload'` command.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageUploadEditing extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [\n            FileRepository,\n            Notification\n        ];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const doc = editor.model.document;\n        const schema = editor.model.schema;\n        const conversion = editor.conversion;\n        const fileRepository = editor.plugins.get(FileRepository);\n        // Setup schema to allow uploadId and uploadStatus for images.\n        schema.extend('image', {\n            allowAttributes: [\n                'uploadId',\n                'uploadStatus'\n            ]\n        });\n        // Register imageUpload command.\n        editor.commands.add('imageUpload', new ImageUploadCommand(editor));\n        // Register upcast converter for uploadId.\n        conversion.for('upcast').add(upcastAttributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'uploadId'\n            },\n            model: 'uploadId'\n        }));\n        // Handle pasted images.\n        // For every image file, a new file loader is created and a placeholder image is\n        // inserted into the content. Then, those images are uploaded once they appear in the model\n        // (see Document#change listener below).\n        this.listenTo(editor.editing.view.document, 'clipboardInput', (evt, data) => {\n            // Skip if non empty HTML data is included.\n            // https://github.com/ckeditor/ckeditor5-upload/issues/68\n            if (isHtmlIncluded(data.dataTransfer)) {\n                return;\n            }\n            const images = Array.from(data.dataTransfer.files).filter(file => {\n                // See https://github.com/ckeditor/ckeditor5-image/pull/254.\n                if (!file) {\n                    return false;\n                }\n                return isImageType(file);\n            });\n            const ranges = data.targetRanges.map(viewRange => editor.editing.mapper.toModelRange(viewRange));\n            editor.model.change(writer => {\n                // Set selection to paste target.\n                writer.setSelection(ranges);\n                if (images.length) {\n                    evt.stop();\n                    // Upload images after the selection has changed in order to ensure the command's state is refreshed.\n                    editor.model.enqueueChange('default', () => {\n                        editor.execute('imageUpload', { file: images });\n                    });\n                }\n            });\n        });\n        // Handle HTML pasted with images with base64 or blob sources.\n        // For every image file, a new file loader is created and a placeholder image is\n        // inserted into the content. Then, those images are uploaded once they appear in the model\n        // (see Document#change listener below).\n        this.listenTo(editor.plugins.get('Clipboard'), 'inputTransformation', (evt, data) => {\n            const fetchableImages = Array.from(editor.editing.view.createRangeIn(data.content)).filter(value => isLocalImage(value.item) && !value.item.getAttribute('uploadProcessed')).map(value => fetchLocalImage(value.item));\n            if (!fetchableImages.length) {\n                return;\n            }\n            evt.stop();\n            Promise.all(fetchableImages).then(items => {\n                const writer = new UpcastWriter();\n                for (const item of items) {\n                    if (!item.file) {\n                        // Failed to fetch image or create a file instance, remove image element.\n                        writer.remove(item.image);\n                    } else {\n                        // Set attribute marking the image as processed.\n                        writer.setAttribute('uploadProcessed', true, item.image);\n                        const loader = fileRepository.createLoader(item.file);\n                        if (loader) {\n                            writer.setAttribute('src', '', item.image);\n                            writer.setAttribute('uploadId', loader.id, item.image);\n                        }\n                    }\n                }\n                editor.plugins.get('Clipboard').fire('inputTransformation', data);\n            });\n        });\n        // Prevents from the browser redirecting to the dropped image.\n        editor.editing.view.document.on('dragover', (evt, data) => {\n            data.preventDefault();\n        });\n        // Upload placeholder images that appeared in the model.\n        doc.on('change', () => {\n            const changes = doc.differ.getChanges({ includeChangesInGraveyard: true });\n            for (const entry of changes) {\n                if (entry.type == 'insert' && entry.name == 'image') {\n                    const item = entry.position.nodeAfter;\n                    const isInGraveyard = entry.position.root.rootName == '$graveyard';\n                    // Check if the image element still has upload id.\n                    const uploadId = item.getAttribute('uploadId');\n                    if (!uploadId) {\n                        continue;\n                    }\n                    // Check if the image is loaded on this client.\n                    const loader = fileRepository.loaders.get(uploadId);\n                    if (!loader) {\n                        continue;\n                    }\n                    if (isInGraveyard) {\n                        // If the image was inserted to the graveyard - abort the loading process.\n                        loader.abort();\n                    } else if (loader.status == 'idle') {\n                        // If the image was inserted into content and has not been loaded yet, start loading it.\n                        this._readAndUpload(loader, item);\n                    }\n                }\n            }\n        });\n    }\n    /**\r\n\t * Read and upload an image.\r\n\t *\r\n\t * The image is read from the disk and as a base64 encoded string it is set temporarily to\r\n\t * `image[src]`. When the image is successfully uploaded the temporary data is replaced with the target\r\n\t * image's URL (the URL to the uploaded image on the server).\r\n\t *\r\n\t * @protected\r\n\t * @param {module:upload/filerepository~FileLoader} loader\r\n\t * @param {module:engine/model/element~Element} imageElement\r\n\t * @returns {Promise}\r\n\t */\n    _readAndUpload(loader, imageElement) {\n        const editor = this.editor;\n        const model = editor.model;\n        const t = editor.locale.t;\n        const fileRepository = editor.plugins.get(FileRepository);\n        const notification = editor.plugins.get(Notification);\n        model.enqueueChange('transparent', writer => {\n            writer.setAttribute('uploadStatus', 'reading', imageElement);\n        });\n        return loader.read().then(data => {\n            const viewFigure = editor.editing.mapper.toViewElement(imageElement);\n            const viewImg = viewFigure.getChild(0);\n            const promise = loader.upload();\n            editor.editing.view.change(writer => {\n                writer.setAttribute('src', data, viewImg);\n            });\n            model.enqueueChange('transparent', writer => {\n                writer.setAttribute('uploadStatus', 'uploading', imageElement);\n            });\n            return promise;\n        }).then(data => {\n            model.enqueueChange('transparent', writer => {\n                writer.setAttributes({\n                    uploadStatus: 'complete',\n                    src: data.default\n                }, imageElement);\n                this._parseAndSetSrcsetAttributeOnImage(data, imageElement, writer);\n            });\n            clean();\n        }).catch(error => {\n            // If status is not 'error' nor 'aborted' - throw error because it means that something else went wrong,\n            // it might be generic error and it would be real pain to find what is going on.\n            if (loader.status !== 'error' && loader.status !== 'aborted') {\n                throw error;\n            }\n            // Might be 'aborted'.\n            if (loader.status == 'error') {\n                notification.showWarning(error, {\n                    title: t('aj'),\n                    namespace: 'upload'\n                });\n            }\n            clean();\n            // Permanently remove image from insertion batch.\n            model.enqueueChange('transparent', writer => {\n                writer.remove(imageElement);\n            });\n        });\n        function clean() {\n            model.enqueueChange('transparent', writer => {\n                writer.removeAttribute('uploadId', imageElement);\n                writer.removeAttribute('uploadStatus', imageElement);\n            });\n            fileRepository.destroyLoader(loader);\n        }\n    }\n    /**\r\n\t * Creates `srcset` attribute based on a given file upload response and sets it as an attribute to a specific image element.\r\n\t *\r\n\t * @protected\r\n\t * @param {Object} data Data object from which `srcset` will be created.\r\n\t * @param {module:engine/model/element~Element} image The image element on which `srcset` attribute will be set.\r\n\t * @param {module:engine/model/writer~Writer} writer\r\n\t */\n    _parseAndSetSrcsetAttributeOnImage(data, image, writer) {\n        // Srcset attribute for responsive images support.\n        let maxWidth = 0;\n        const srcsetAttribute = Object.keys(data)    // Filter out keys that are not integers.\n.filter(key => {\n            const width = parseInt(key, 10);\n            if (!isNaN(width)) {\n                maxWidth = Math.max(maxWidth, width);\n                return true;\n            }\n        })    // Convert each key to srcset entry.\n.map(key => `${ data[key] } ${ key }w`)    // Join all entries.\n.join(', ');\n        if (srcsetAttribute != '') {\n            writer.setAttribute('srcset', {\n                data: srcsetAttribute,\n                width: maxWidth\n            }, image);\n        }\n    }\n}\n// Returns `true` if non-empty `text/html` is included in the data transfer.\n//\n// @param {module:clipboard/datatransfer~DataTransfer} dataTransfer\n// @returns {Boolean}\nexport function isHtmlIncluded(dataTransfer) {\n    return Array.from(dataTransfer.types).includes('text/html') && dataTransfer.getData('text/html') !== '';\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imageupload\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageUploadUI from './imageupload/imageuploadui';\r\nimport ImageUploadProgress from './imageupload/imageuploadprogress';\r\nimport ImageUploadEditing from './imageupload/imageuploadediting';\r\n\r\n/**\r\n * The image upload plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image-upload image upload feature} documentation.\r\n *\r\n * This plugin does not do anything directly, but it loads a set of specific plugins to enable image uploading:\r\n *\r\n * * {@link module:image/imageupload/imageuploadediting~ImageUploadEditing},\r\n * * {@link module:image/imageupload/imageuploadui~ImageUploadUI},\r\n * * {@link module:image/imageupload/imageuploadprogress~ImageUploadProgress}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageUpload extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageUpload';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageUploadEditing, ImageUploadUI, ImageUploadProgress ];\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paragraph/paragraphcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * The paragraph command.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ParagraphCommand extends Command {\r\n\t/**\r\n\t * The value of the command. Indicates whether the selection start is placed in a paragraph.\r\n\t *\r\n\t * @readonly\r\n\t * @observable\r\n\t * @member {Boolean} #value\r\n\t */\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\t\tconst block = first( document.selection.getSelectedBlocks() );\r\n\r\n\t\tthis.value = !!block && block.is( 'paragraph' );\r\n\t\tthis.isEnabled = !!block && checkCanBecomeParagraph( block, model.schema );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command. All the blocks (see {@link module:engine/model/schema~Schema}) in the selection\r\n\t * will be turned to paragraphs.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {Object} [options] Options for the executed command.\r\n\t * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} [options.selection]\r\n\t * The selection that the command should be applied to.\r\n\t * By default, if not provided, the command is applied to the {@link module:engine/model/document~Document#selection}.\r\n\t */\r\n\texecute( options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst blocks = ( options.selection || document.selection ).getSelectedBlocks();\r\n\r\n\t\t\tfor ( const block of blocks ) {\r\n\t\t\t\tif ( !block.is( 'paragraph' ) && checkCanBecomeParagraph( block, model.schema ) ) {\r\n\t\t\t\t\twriter.rename( block, 'paragraph' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Checks whether the given block can be replaced by a paragraph.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} block A block to be tested.\r\n// @param {module:engine/model/schema~Schema} schema The schema of the document.\r\n// @returns {Boolean}\r\nfunction checkCanBecomeParagraph( block, schema ) {\r\n\treturn schema.checkChild( block.parent, 'paragraph' ) && !schema.isObject( block );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paragraph/paragraph\r\n */\r\n\r\nimport ParagraphCommand from './paragraphcommand';\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\n/**\r\n * The paragraph feature for the editor.\r\n *\r\n * It introduces the `<paragraph>` element in the model which renders as a `<p>` element in the DOM and data.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Paragraph extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Paragraph';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst model = editor.model;\r\n\t\tconst data = editor.data;\r\n\r\n\t\teditor.commands.add( 'paragraph', new ParagraphCommand( editor ) );\r\n\r\n\t\t// Schema.\r\n\t\tmodel.schema.register( 'paragraph', { inheritAllFrom: '$block' } );\r\n\r\n\t\teditor.conversion.elementToElement( { model: 'paragraph', view: 'p' } );\r\n\r\n\t\t// Content autoparagraphing. --------------------------------------------------\r\n\r\n\t\t// Handles elements not converted by plugins and checks if would be converted if\r\n\t\t// we wraps them by a paragraph or changes them to a paragraph.\r\n\t\tdata.upcastDispatcher.on( 'element', ( evt, data, conversionApi ) => {\r\n\t\t\tconst writer = conversionApi.writer;\r\n\r\n\t\t\t// When element is already consumed by higher priority converters then do nothing.\r\n\t\t\tif ( !conversionApi.consumable.test( data.viewItem, { name: data.viewItem.name } ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// When element is paragraph-like lets try to change it into a paragraph.\r\n\t\t\tif ( Paragraph.paragraphLikeElements.has( data.viewItem.name ) ) {\r\n\t\t\t\tif ( data.viewItem.isEmpty ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst paragraph = writer.createElement( 'paragraph' );\r\n\r\n\t\t\t\t// Find allowed parent for paragraph that we are going to insert.\r\n\t\t\t\t// If current parent does not allow to insert paragraph but one of the ancestors does\r\n\t\t\t\t// then split nodes to allowed parent.\r\n\t\t\t\tconst splitResult = conversionApi.splitToAllowedParent( paragraph, data.modelCursor );\r\n\r\n\t\t\t\t// When there is no split result it means that we can't insert paragraph in this position.\r\n\t\t\t\tif ( !splitResult ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert paragraph in allowed position.\r\n\t\t\t\twriter.insert( paragraph, splitResult.position );\r\n\r\n\t\t\t\t// Convert children to paragraph.\r\n\t\t\t\tconst { modelRange } = conversionApi.convertChildren( data.viewItem, writer.createPositionAt( paragraph, 0 ) );\r\n\r\n\t\t\t\t// Output range starts before paragraph but ends inside it after last child.\r\n\t\t\t\t// This is because we want to keep siblings inside the same paragraph as long as it is possible.\r\n\t\t\t\t// When next node won't be allowed in a paragraph it will split this paragraph anyway.\r\n\t\t\t\tdata.modelRange = writer.createRange( writer.createPositionBefore( paragraph ), modelRange.end );\r\n\t\t\t\tdata.modelCursor = data.modelRange.end;\r\n\r\n\t\t\t// When element is not paragraph-like lets try to wrap it by a paragraph.\r\n\t\t\t} else if ( isParagraphable( data.viewItem, data.modelCursor, conversionApi.schema ) ) {\r\n\t\t\t\tdata = Object.assign( data, wrapInParagraph( data.viewItem, data.modelCursor, conversionApi ) );\r\n\t\t\t}\r\n\t\t}, { priority: 'low' } );\r\n\r\n\t\t// Handles not converted text nodes and checks if would be converted if we wraps then by a paragraph.\r\n\t\tdata.upcastDispatcher.on( 'text', ( evt, data, conversionApi ) => {\r\n\t\t\t// When node is already converted then do nothing.\r\n\t\t\tif ( data.modelRange ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( isParagraphable( data.viewItem, data.modelCursor, conversionApi.schema ) ) {\r\n\t\t\t\tdata = Object.assign( data, wrapInParagraph( data.viewItem, data.modelCursor, conversionApi ) );\r\n\t\t\t}\r\n\t\t}, { priority: 'lowest' } );\r\n\r\n\t\t// Empty roots autoparagraphing. -----------------------------------------------\r\n\r\n\t\t// Post-fixer which takes care of adding empty paragraph elements to empty roots.\r\n\t\t// Besides fixing content on #changesDone we also need to handle #dataReady because\r\n\t\t// if initial data is empty or setData() wasn't even called there will be no #change fired.\r\n\t\tmodel.document.registerPostFixer( writer => this._autoparagraphEmptyRoots( writer ) );\r\n\r\n\t\teditor.on( 'dataReady', () => {\r\n\t\t\tmodel.enqueueChange( 'transparent', writer => this._autoparagraphEmptyRoots( writer ) );\r\n\t\t}, { priority: 'lowest' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Fixes all empty roots.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} `true` if any change has been applied, `false` otherwise.\r\n\t */\r\n\t_autoparagraphEmptyRoots( writer ) {\r\n\t\tconst model = this.editor.model;\r\n\r\n\t\tfor ( const rootName of model.document.getRootNames() ) {\r\n\t\t\tconst root = model.document.getRoot( rootName );\r\n\r\n\t\t\tif ( root.isEmpty && root.rootName != '$graveyard' ) {\r\n\t\t\t\t// If paragraph element is allowed in the root, create paragraph element.\r\n\t\t\t\tif ( model.schema.checkChild( root, 'paragraph' ) ) {\r\n\t\t\t\t\twriter.insertElement( 'paragraph', root );\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * A list of element names which should be treated by the autoparagraphing algorithms as\r\n * paragraph-like. This means that e.g. the following content:\r\n *\r\n *\t\t<h1>Foo</h1>\r\n *\t\t<table>\r\n *\t\t\t<tr>\r\n *\t\t\t\t<td>X</td>\r\n *\t\t\t\t<td>\r\n *\t\t\t\t\t<ul>\r\n *\t\t\t\t\t\t<li>Y</li>\r\n *\t\t\t\t\t\t<li>Z</li>\r\n *\t\t\t\t\t</ul>\r\n *\t\t\t\t</td>\r\n *\t\t\t</tr>\r\n *\t\t</table>\r\n *\r\n * contains five paragraph-like elements: `<h1>`, two `<td>`s and two `<li>`s.\r\n * Hence, if none of the features is going to convert those elements the above content will be automatically handled\r\n * by the paragraph feature and converted to:\r\n *\r\n *\t\t<p>Foo</p>\r\n *\t\t<p>X</p>\r\n *\t\t<p>Y</p>\r\n *\t\t<p>Z</p>\r\n *\r\n * Note: The `<td>` containing two `<li>` elements was ignored as the innermost paragraph-like elements\r\n * have a priority upon conversion.\r\n *\r\n * @member {Set.<String>} module:paragraph/paragraph~Paragraph.paragraphLikeElements\r\n */\r\nParagraph.paragraphLikeElements = new Set( [\r\n\t'blockquote',\r\n\t'dd',\r\n\t'div',\r\n\t'dt',\r\n\t'h1',\r\n\t'h2',\r\n\t'h3',\r\n\t'h4',\r\n\t'h5',\r\n\t'h6',\r\n\t'li',\r\n\t'p',\r\n\t'td'\r\n] );\r\n\r\nfunction wrapInParagraph( input, position, conversionApi ) {\r\n\tconst paragraph = conversionApi.writer.createElement( 'paragraph' );\r\n\r\n\tconversionApi.writer.insert( paragraph, position );\r\n\treturn conversionApi.convertItem( input, conversionApi.writer.createPositionAt( paragraph, 0 ) );\r\n}\r\n\r\nfunction isParagraphable( node, position, schema ) {\r\n\tconst context = schema.createContext( position );\r\n\r\n\t// When paragraph is allowed in this context...\r\n\tif ( !schema.checkChild( context, 'paragraph' ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// And a node would be allowed in this paragraph...\r\n\tif ( !schema.checkChild( context.push( 'paragraph' ), node ) ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module heading/headingcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * The heading command. It is used by the {@link module:heading/heading~Heading heading feature} to apply headings.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class HeadingCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the command.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor Editor instance.\r\n\t * @param {Array.<String>} modelElements Names of the element which this command can apply in the model.\r\n\t */\r\n\tconstructor( editor, modelElements ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * If the selection starts in a heading (which {@link #modelElements is supported by this command})\r\n\t\t * the value is set to the name of that heading model element.\r\n\t\t * It is  set to `false` otherwise.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean|String} #value\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Set of defined model's elements names that this command support.\r\n\t\t * See {@link module:heading/heading~HeadingOption}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<String>}\r\n\t\t */\r\n\t\tthis.modelElements = modelElements;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst block = first( this.editor.model.document.selection.getSelectedBlocks() );\r\n\r\n\t\tthis.value = !!block && this.modelElements.includes( block.name ) && block.name;\r\n\t\tthis.isEnabled = !!block && this.modelElements.some( heading => checkCanBecomeHeading( block, heading, this.editor.model.schema ) );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command. Applies the heading to the selected blocks or, if the first selected\r\n\t * block is a heading already, turns selected headings (of this level only) to paragraphs.\r\n\t *\r\n\t * @param {Object} options\r\n\t * @param {String} options.value Name of the element which this command will apply in the model.\r\n\t * @fires execute\r\n\t */\r\n\texecute( options ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\r\n\t\tconst modelElement = options.value;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst blocks = Array.from( document.selection.getSelectedBlocks() )\r\n\t\t\t\t.filter( block => {\r\n\t\t\t\t\treturn checkCanBecomeHeading( block, modelElement, model.schema );\r\n\t\t\t\t} );\r\n\r\n\t\t\tfor ( const block of blocks ) {\r\n\t\t\t\tif ( !block.is( modelElement ) ) {\r\n\t\t\t\t\twriter.rename( block, modelElement );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Checks whether the given block can be replaced by a specific heading.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} block A block to be tested.\r\n// @param {module:heading/headingcommand~HeadingCommand#modelElement} heading Command element name in the model.\r\n// @param {module:engine/model/schema~Schema} schema The schema of the document.\r\n// @returns {Boolean}\r\nfunction checkCanBecomeHeading( block, heading, schema ) {\r\n\treturn schema.checkChild( block.parent, heading ) && !schema.isObject( block );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module heading/headingediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Paragraph from '@ckeditor/ckeditor5-paragraph/src/paragraph';\r\nimport HeadingCommand from './headingcommand';\r\n\r\nimport priorities from '@ckeditor/ckeditor5-utils/src/priorities';\r\nimport { upcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\r\n\r\nconst defaultModelElement = 'paragraph';\r\n\r\n/**\r\n * The headings engine feature. It handles switching between block formats &ndash; headings and paragraph.\r\n * This class represents the engine part of the heading feature. See also {@link module:heading/heading~Heading}.\r\n * It introduces `heading1`-`headingN` commands which allow to convert paragraphs into headings.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class HeadingEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\tsuper( editor );\r\n\r\n\t\teditor.config.define( 'heading', {\r\n\t\t\toptions: [\r\n\t\t\t\t{ model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },\r\n\t\t\t\t{ model: 'heading1', view: 'h2', title: 'Heading 1', class: 'ck-heading_heading1' },\r\n\t\t\t\t{ model: 'heading2', view: 'h3', title: 'Heading 2', class: 'ck-heading_heading2' },\r\n\t\t\t\t{ model: 'heading3', view: 'h4', title: 'Heading 3', class: 'ck-heading_heading3' }\r\n\t\t\t]\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ Paragraph ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst options = editor.config.get( 'heading.options' );\r\n\r\n\t\tconst modelElements = [];\r\n\r\n\t\tfor ( const option of options ) {\r\n\t\t\t// Skip paragraph - it is defined in required Paragraph feature.\r\n\t\t\tif ( option.model !== defaultModelElement ) {\r\n\t\t\t\t// Schema.\r\n\t\t\t\teditor.model.schema.register( option.model, {\r\n\t\t\t\t\tinheritAllFrom: '$block'\r\n\t\t\t\t} );\r\n\r\n\t\t\t\teditor.conversion.elementToElement( option );\r\n\r\n\t\t\t\tmodelElements.push( option.model );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._addDefaultH1Conversion( editor );\r\n\r\n\t\t// Register the heading command for this option.\r\n\t\teditor.commands.add( 'heading', new HeadingCommand( editor, modelElements ) );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tafterInit() {\r\n\t\t// If the enter command is added to the editor, alter its behavior.\r\n\t\t// Enter at the end of a heading element should create a paragraph.\r\n\t\tconst editor = this.editor;\r\n\t\tconst enterCommand = editor.commands.get( 'enter' );\r\n\t\tconst options = editor.config.get( 'heading.options' );\r\n\r\n\t\tif ( enterCommand ) {\r\n\t\t\tthis.listenTo( enterCommand, 'afterExecute', ( evt, data ) => {\r\n\t\t\t\tconst positionParent = editor.model.document.selection.getFirstPosition().parent;\r\n\t\t\t\tconst isHeading = options.some( option => positionParent.is( option.model ) );\r\n\r\n\t\t\t\tif ( isHeading && !positionParent.is( defaultModelElement ) && positionParent.childCount === 0 ) {\r\n\t\t\t\t\tdata.writer.rename( positionParent, defaultModelElement );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds default conversion for `h1` -> `heading1` with a low priority.\r\n\t *\r\n\t * @private\r\n\t * @param {module:core/editor/editor~Editor} editor Editor instance on which to add the `h1` conversion.\r\n\t */\r\n\t_addDefaultH1Conversion( editor ) {\r\n\t\teditor.conversion.for( 'upcast' ).add( upcastElementToElement( {\r\n\t\t\tmodel: 'heading1',\r\n\t\t\tview: 'h1',\r\n\t\t\t// With a `low` priority, `paragraph` plugin autoparagraphing mechanism is executed. Make sure\r\n\t\t\t// this listener is called before it. If not, `h1` will be transformed into a paragraph.\r\n\t\t\tconverterPriority: priorities.get( 'low' ) + 1\r\n\t\t} ) );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/model\r\n */\r\n\r\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\r\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\r\nimport { extend } from 'lodash-es';\r\n\r\n/**\r\n * The base MVC model class.\r\n *\r\n * @mixes module:utils/observablemixin~ObservableMixin\r\n */\r\nexport default class Model {\r\n\t/**\r\n\t * Creates a new Model instance.\r\n\t *\r\n\t * @param {Object} [attributes] The model state attributes to be defined during the instance creation.\r\n\t * @param {Object} [properties] The (out of state) properties to be appended to the instance during creation.\r\n\t */\r\n\tconstructor( attributes, properties ) {\r\n\t\t// Extend this instance with the additional (out of state) properties.\r\n\t\tif ( properties ) {\r\n\t\t\textend( this, properties );\r\n\t\t}\r\n\r\n\t\t// Initialize the attributes.\r\n\t\tif ( attributes ) {\r\n\t\t\tthis.set( attributes );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nmix( Model, ObservableMixin );\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/dropdown/dropdownpanelview\r\n */\r\n\r\nimport View from '../view';\r\n\r\n/**\r\n * The dropdown panel view class.\r\n *\r\n * See {@link module:ui/dropdown/dropdownview~DropdownView} to learn about the common usage.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class DropdownPanelView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * Controls whether the panel is visible.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isVisible\r\n\t\t */\r\n\t\tthis.set( 'isVisible', false );\r\n\r\n\t\t/**\r\n\t\t * The position of the panel, relative to the parent.\r\n\t\t *\r\n\t\t * This property is reflected in the CSS class set to {@link #element} that controls\r\n\t\t * the position of the panel.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 'se'\r\n\t\t * @member {'se'|'sw'|'ne'|'nw'} #position\r\n\t\t */\r\n\t\tthis.set( 'position', 'se' );\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views in this panel.\r\n\t\t *\r\n\t\t * A common child type is the {@link module:ui/list/listview~ListView} and {@link module:ui/toolbar/toolbarview~ToolbarView}.\r\n\t\t * See {@link module:ui/dropdown/utils~addListToDropdown} and\r\n\t\t * {@link module:ui/dropdown/utils~addToolbarToDropdown} to learn more about child views of dropdowns.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.children = this.createCollection();\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-reset',\r\n\t\t\t\t\t'ck-dropdown__panel',\r\n\t\t\t\t\tbind.to( 'position', value => `ck-dropdown__panel_${ value }` ),\r\n\t\t\t\t\tbind.if( 'isVisible', 'ck-dropdown__panel-visible' )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.children,\r\n\r\n\t\t\ton: {\r\n\t\t\t\t// Drag and drop in the panel should not break the selection in the editor.\r\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/228\r\n\t\t\t\tselectstart: bind.to( evt => evt.preventDefault() )\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the view element or first item in view collection on opening dropdown's panel.\r\n\t *\r\n\t * See also {@link module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable}.\r\n\t */\r\n\tfocus() {\r\n\t\tif ( this.children.length ) {\r\n\t\t\tthis.children.first.focus();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the view element or last item in view collection on opening dropdown's panel.\r\n\t *\r\n\t * See also {@link module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable}.\r\n\t */\r\n\tfocusLast() {\r\n\t\tif ( this.children.length ) {\r\n\t\t\tconst lastChild = this.children.last;\r\n\r\n\t\t\tif ( typeof lastChild.focusLast === 'function' ) {\r\n\t\t\t\tlastChild.focusLast();\r\n\t\t\t} else {\r\n\t\t\t\tlastChild.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/dropdown/dropdownview\r\n */\r\n\r\nimport View from '../view';\r\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\r\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\r\n\r\nimport '../../theme/components/dropdown/dropdown.css';\r\n\r\nimport { getOptimalPosition } from '@ckeditor/ckeditor5-utils/src/dom/position';\r\n\r\n/**\r\n * The dropdown view class. It manages the dropdown button and dropdown panel.\r\n *\r\n * In most cases, the easiest way to create a dropdown is by using the {@link module:ui/dropdown/utils~createDropdown}\r\n * util:\r\n *\r\n *\t\tconst dropdown = createDropdown( locale );\r\n *\r\n *\t\t// Configure dropdown's button properties:\r\n *\t\tdropdown.buttonView.set( {\r\n *\t\t\tlabel: 'A dropdown',\r\n *\t\t\twithText: true\r\n *\t\t} );\r\n *\r\n *\t\tdropdown.render();\r\n *\r\n *\t\tdropdown.panelView.element.textContent = 'Content of the panel';\r\n *\r\n *\t\t// Will render a dropdown with a panel containing a \"Content of the panel\" text.\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * If you want to add a richer content to the dropdown panel, you can use the {@link module:ui/dropdown/utils~addListToDropdown}\r\n * and {@link module:ui/dropdown/utils~addToolbarToDropdown} helpers. See more examples in\r\n * {@link module:ui/dropdown/utils~createDropdown} documentation.\r\n *\r\n * If you want to create a completely custom dropdown, then you can compose it manually:\r\n *\r\n *\t\tconst button = new DropdownButtonView( locale );\r\n *\t\tconst panel = new DropdownPanelView( locale );\r\n *\t\tconst dropdown = new DropdownView( locale, button, panel );\r\n *\r\n *\t\tbutton.set( {\r\n *\t\t\tlabel: 'A dropdown',\r\n *\t\t\twithText: true\r\n *\t\t} );\r\n *\r\n *\t\tdropdown.render();\r\n *\r\n *\t\tpanel.element.textContent = 'Content of the panel';\r\n *\r\n *\t\t// Will render a dropdown with a panel containing a \"Content of the panel\" text.\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * However, dropdown created this way will contain little behavior. You will need to implement handlers for actions\r\n * such as {@link module:ui/bindings/clickoutsidehandler~clickOutsideHandler clicking outside an open dropdown}\r\n * (which should close it) and support for arrow keys inside the panel. Therefore, unless you really know what\r\n * you do and you really need to do it, it is recommended to use the {@link module:ui/dropdown/utils~createDropdown} helper.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class DropdownView extends View {\r\n\t/**\r\n\t * Creates an instance of the dropdown.\r\n\t *\r\n\t * Also see {@link #render}.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} [locale] The localization services instance.\r\n\t * @param {module:ui/dropdown/button/dropdownbutton~DropdownButton} buttonView\r\n\t * @param {module:ui/dropdown/dropdownpanelview~DropdownPanelView} panelView\r\n\t */\r\n\tconstructor( locale, buttonView, panelView ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * Button of the dropdown view. Clicking the button opens the {@link #panelView}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/button/buttonview~ButtonView} #buttonView\r\n\t\t */\r\n\t\tthis.buttonView = buttonView;\r\n\r\n\t\t/**\r\n\t\t * Panel of the dropdown. It opens when the {@link #buttonView} is\r\n\t\t * {@link module:ui/button/buttonview~ButtonView#event:execute executed} (i.e. clicked).\r\n\t\t *\r\n\t\t * Child views can be added to the panel's `children` collection:\r\n\t\t *\r\n\t\t *\t\tdropdown.panelView.children.add( childView );\r\n\t\t *\r\n\t\t * See {@link module:ui/dropdown/dropdownpanelview~DropdownPanelView#children} and\r\n\t\t * {@link module:ui/viewcollection~ViewCollection#add}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/dropdown/dropdownpanelview~DropdownPanelView} #panelView\r\n\t\t */\r\n\t\tthis.panelView = panelView;\r\n\r\n\t\t/**\r\n\t\t * Controls whether the dropdown view is open, i.e. shows or hides the {@link #panelView panel}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isOpen\r\n\t\t */\r\n\t\tthis.set( 'isOpen', false );\r\n\r\n\t\t/**\r\n\t\t * Controls whether the dropdown is enabled, i.e. it can be clicked and execute an action.\r\n\t\t *\r\n\t\t * See {@link module:ui/button/buttonview~ButtonView#isEnabled}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isEnabled\r\n\t\t */\r\n\t\tthis.set( 'isEnabled', true );\r\n\r\n\t\t/**\r\n\t\t * (Optional) The additional CSS class set on the dropdown {@link #element}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #class\r\n\t\t */\r\n\t\tthis.set( 'class' );\r\n\r\n\t\t/**\r\n\t\t * The position of the panel, relative to the dropdown.\r\n\t\t *\r\n\t\t * **Note**: When `'auto'`, the panel will use one of the remaining positions to stay\r\n\t\t * in the viewport, visible to the user. The positions correspond directly to\r\n\t\t * {@link module:ui/dropdown/dropdownview~DropdownView.defaultPanelPositions default panel positions}.\r\n\t\t *\r\n\t\t * **Note**: This value has an impact on the\r\n\t\t * {@link module:ui/dropdown/dropdownpanelview~DropdownPanelView#position} property\r\n\t\t * each time the panel becomes {@link #isOpen open}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @default 'auto'\r\n\t\t * @member {'auto'|'se'|'sw'|'ne'|'nw'} #panelPosition\r\n\t\t */\r\n\t\tthis.set( 'panelPosition', 'auto' );\r\n\r\n\t\t/**\r\n\t\t * Tracks information about DOM focus in the dropdown.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\r\n\t\tthis.focusTracker = new FocusTracker();\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}. It manages\r\n\t\t * keystrokes of the dropdown:\r\n\t\t *\r\n\t\t * * <kbd>▼</kbd> opens the dropdown,\r\n\t\t * * <kbd>◀</kbd> and <kbd>Esc</kbd> closes the dropdown.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\r\n\t\tthis.keystrokes = new KeystrokeHandler();\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-dropdown',\r\n\t\t\t\t\tbind.to( 'class' ),\r\n\t\t\t\t\tbind.if( 'isEnabled', 'ck-disabled', value => !value )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: [\r\n\t\t\t\tbuttonView,\r\n\t\t\t\tpanelView\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\tbuttonView.extendTemplate( {\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck-dropdown__button',\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t/**\r\n\t\t * A child {@link module:ui/list/listview~ListView list view} of the dropdown located\r\n\t\t * in its {@link module:ui/dropdown/dropdownview~DropdownView#panelView panel}.\r\n\t\t *\r\n\t\t * **Note**: Only supported when dropdown has list view added using {@link module:ui/dropdown/utils~addListToDropdown}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/list/listview~ListView} #listView\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * A child toolbar of the dropdown located in the\r\n\t\t * {@link module:ui/dropdown/dropdownview~DropdownView#panelView panel}.\r\n\t\t *\r\n\t\t * **Note**: Only supported when dropdown has list view added using {@link module:ui/dropdown/utils~addToolbarToDropdown}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarView} #toolbarView\r\n\t\t */\r\n\r\n\t\t/**\r\n\t\t * Fired when the toolbar button or list item is executed.\r\n\t\t *\r\n\t\t * For {@link #listView} It fires when a child of some {@link module:ui/list/listitemview~ListItemView}\r\n\t\t * fired `execute`.\r\n\t\t *\r\n\t\t * For {@link #toolbarView} It fires when one of the buttons has been\r\n\t\t * {@link module:ui/button/buttonview~ButtonView#event:execute executed}.\r\n\t\t *\r\n\t\t * **Note**: Only supported when dropdown has list view added using {@link module:ui/dropdown/utils~addListToDropdown}\r\n\t\t * or {@link module:ui/dropdown/utils~addToolbarToDropdown}.\r\n\t\t *\r\n\t\t * @event execute\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\t// Toggle the dropdown when its button has been clicked.\r\n\t\tthis.listenTo( this.buttonView, 'open', () => {\r\n\t\t\tthis.isOpen = !this.isOpen;\r\n\t\t} );\r\n\r\n\t\t// Toggle the visibility of the panel when the dropdown becomes open.\r\n\t\tthis.panelView.bind( 'isVisible' ).to( this, 'isOpen' );\r\n\r\n\t\t// Let the dropdown control the position of the panel. The position must\r\n\t\t// be updated every time the dropdown is open.\r\n\t\tthis.on( 'change:isOpen', () => {\r\n\t\t\tif ( !this.isOpen ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If \"auto\", find the best position of the panel to fit into the viewport.\r\n\t\t\t// Otherwise, simply assign the static position.\r\n\t\t\tif ( this.panelPosition === 'auto' ) {\r\n\t\t\t\tconst defaultPanelPositions = DropdownView.defaultPanelPositions;\r\n\r\n\t\t\t\tthis.panelView.position = getOptimalPosition( {\r\n\t\t\t\t\telement: this.panelView.element,\r\n\t\t\t\t\ttarget: this.buttonView.element,\r\n\t\t\t\t\tfitInViewport: true,\r\n\t\t\t\t\tpositions: [\r\n\t\t\t\t\t\tdefaultPanelPositions.southEast,\r\n\t\t\t\t\t\tdefaultPanelPositions.southWest,\r\n\t\t\t\t\t\tdefaultPanelPositions.northEast,\r\n\t\t\t\t\t\tdefaultPanelPositions.northWest\r\n\t\t\t\t\t]\r\n\t\t\t\t} ).name;\r\n\t\t\t} else {\r\n\t\t\t\tthis.panelView.position = this.panelPosition;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Listen for keystrokes coming from within #element.\r\n\t\tthis.keystrokes.listenTo( this.element );\r\n\r\n\t\t// Register #element in the focus tracker.\r\n\t\tthis.focusTracker.add( this.element );\r\n\r\n\t\tconst closeDropdown = ( data, cancel ) => {\r\n\t\t\tif ( this.isOpen ) {\r\n\t\t\t\tthis.buttonView.focus();\r\n\t\t\t\tthis.isOpen = false;\r\n\t\t\t\tcancel();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Open the dropdown panel using the arrow down key, just like with return or space.\r\n\t\tthis.keystrokes.set( 'arrowdown', ( data, cancel ) => {\r\n\t\t\t// Don't open if the dropdown is disabled or already open.\r\n\t\t\tif ( this.buttonView.isEnabled && !this.isOpen ) {\r\n\t\t\t\tthis.isOpen = true;\r\n\t\t\t\tcancel();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Block the right arrow key (until nested dropdowns are implemented).\r\n\t\tthis.keystrokes.set( 'arrowright', ( data, cancel ) => {\r\n\t\t\tif ( this.isOpen ) {\r\n\t\t\t\tcancel();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Close the dropdown using the arrow left/escape key.\r\n\t\tthis.keystrokes.set( 'arrowleft', closeDropdown );\r\n\t\tthis.keystrokes.set( 'esc', closeDropdown );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the {@link #buttonView}.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.buttonView.focus();\r\n\t}\r\n}\r\n\r\n/**\r\n * A set of positioning functions used by the dropdown view to determine\r\n * the optimal position (i.e. fitting into the browser viewport) of its\r\n * {@link module:ui/dropdown/dropdownview~DropdownView#panelView panel} when\r\n * {@link module:ui/dropdown/dropdownview~DropdownView#panelPosition} is set to 'auto'`.\r\n *\r\n * The available positioning functions are as follow:\r\n *\r\n * **South**\r\n *\r\n * * `southEast`\r\n *\r\n *\t\t[ Button ]\r\n *\t\t+-----------------+\r\n *\t\t|      Panel      |\r\n *\t\t+-----------------+\r\n *\r\n * * `southWest`\r\n *\r\n *\t\t         [ Button ]\r\n *\t\t+-----------------+\r\n *\t\t|      Panel      |\r\n *\t\t+-----------------+\r\n *\r\n * **North**\r\n *\r\n * * `northEast`\r\n *\r\n *\t\t+-----------------+\r\n *\t\t|      Panel      |\r\n *\t\t+-----------------+\r\n *\t\t[ Button ]\r\n *\r\n * * `northWest`\r\n *\r\n *\t\t+-----------------+\r\n *\t\t|      Panel      |\r\n *\t\t+-----------------+\r\n *\t\t         [ Button ]\r\n *\r\n * Positioning functions are compatible with {@link module:utils/dom/position~Position}.\r\n *\r\n * The name that position function returns will be reflected in dropdown panel's class that\r\n * controls its placement. See {@link module:ui/dropdown/dropdownview~DropdownView#panelPosition}\r\n * to learn more.\r\n *\r\n * @member {Object} module:ui/dropdown/dropdownview~DropdownView.defaultPanelPositions\r\n */\r\nDropdownView.defaultPanelPositions = {\r\n\tsouthEast: buttonRect => {\r\n\t\treturn {\r\n\t\t\ttop: buttonRect.bottom,\r\n\t\t\tleft: buttonRect.left,\r\n\t\t\tname: 'se'\r\n\t\t};\r\n\t},\r\n\tsouthWest: ( buttonRect, panelRect ) => {\r\n\t\treturn {\r\n\t\t\ttop: buttonRect.bottom,\r\n\t\t\tleft: buttonRect.left - panelRect.width + buttonRect.width,\r\n\t\t\tname: 'sw'\r\n\t\t};\r\n\t},\r\n\tnorthEast: ( buttonRect, panelRect ) => {\r\n\t\treturn {\r\n\t\t\ttop: buttonRect.top - panelRect.height,\r\n\t\t\tleft: buttonRect.left,\r\n\t\t\tname: 'ne'\r\n\t\t};\r\n\t},\r\n\tnorthWest: ( buttonRect, panelRect ) => {\r\n\t\treturn {\r\n\t\t\ttop: buttonRect.bottom - panelRect.height,\r\n\t\t\tleft: buttonRect.left - panelRect.width + buttonRect.width,\r\n\t\t\tname: 'nw'\r\n\t\t};\r\n\t}\r\n};\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/dropdown/button/dropdownbuttonview\r\n */\r\n\r\nimport ButtonView from '../../button/buttonview';\r\n\r\nimport dropdownArrowIcon from '../../../theme/icons/dropdown-arrow.svg';\r\nimport IconView from '../../icon/iconview';\r\n\r\n/**\r\n * The default dropdown button view class.\r\n *\r\n *\t\tconst view = new DropdownButtonView();\r\n *\r\n *\t\tview.set( {\r\n *\t\t\tlabel: 'A button',\r\n *\t\t\tkeystroke: 'Ctrl+B',\r\n *\t\t\ttooltip: true\r\n *\t\t} );\r\n *\r\n *\t\tview.render();\r\n *\r\n *\t\tdocument.body.append( view.element );\r\n *\r\n * Also see the {@link module:ui/dropdown/utils~createDropdown `createDropdown()` util}.\r\n *\r\n * @implements module:ui/dropdown/button/dropdownbutton~DropdownButton\r\n * @extends module:ui/button/buttonview~ButtonView\r\n */\r\nexport default class DropdownButtonView extends ButtonView {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * An icon that displays arrow to indicate a dropdown button.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/icon/iconview~IconView}\r\n\t\t */\r\n\t\tthis.arrowView = this._createArrowView();\r\n\r\n\t\tthis.extendTemplate( {\r\n\t\t\tattributes: {\r\n\t\t\t\t'aria-haspopup': true\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// The DropdownButton interface expects the open event upon which will open the dropdown.\r\n\t\tthis.delegate( 'execute' ).to( this, 'open' );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tthis.children.add( this.arrowView );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a {@link module:ui/icon/iconview~IconView} instance as {@link #arrowView}.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/icon/iconview~IconView}\r\n\t */\r\n\t_createArrowView() {\r\n\t\tconst arrowView = new IconView();\r\n\r\n\t\tarrowView.content = dropdownArrowIcon;\r\n\r\n\t\tarrowView.extendTemplate( {\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: 'ck-dropdown__arrow'\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn arrowView;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/list/listview\r\n */\r\n\r\nimport View from '../view';\r\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\r\nimport FocusCycler from '../focuscycler';\r\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\r\n\r\nimport '../../theme/components/list/list.css';\r\n\r\n/**\r\n * The list view class.\r\n *\r\n * @extends module:ui/view~View\r\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\r\n */\r\nexport default class ListView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/**\r\n\t\t * Collection of the child list views.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.items = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * Tracks information about DOM focus in the list.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\r\n\t\tthis.focusTracker = new FocusTracker();\r\n\r\n\t\t/**\r\n\t\t * Instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\r\n\t\tthis.keystrokes = new KeystrokeHandler();\r\n\r\n\t\t/**\r\n\t\t * Helps cycling over focusable {@link #items} in the list.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\r\n\t\tthis._focusCycler = new FocusCycler( {\r\n\t\t\tfocusables: this.items,\r\n\t\t\tfocusTracker: this.focusTracker,\r\n\t\t\tkeystrokeHandler: this.keystrokes,\r\n\t\t\tactions: {\r\n\t\t\t\t// Navigate list items backwards using the arrowup key.\r\n\t\t\t\tfocusPrevious: 'arrowup',\r\n\r\n\t\t\t\t// Navigate toolbar items forwards using the arrowdown key.\r\n\t\t\t\tfocusNext: 'arrowdown',\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'ul',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-reset',\r\n\t\t\t\t\t'ck-list'\r\n\t\t\t\t]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.items\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\t// Items added before rendering should be known to the #focusTracker.\r\n\t\tfor ( const item of this.items ) {\r\n\t\t\tthis.focusTracker.add( item.element );\r\n\t\t}\r\n\r\n\t\tthis.items.on( 'add', ( evt, item ) => {\r\n\t\t\tthis.focusTracker.add( item.element );\r\n\t\t} );\r\n\r\n\t\tthis.items.on( 'remove', ( evt, item ) => {\r\n\t\t\tthis.focusTracker.remove( item.element );\r\n\t\t} );\r\n\r\n\t\t// Start listening for the keystrokes coming from #element.\r\n\t\tthis.keystrokes.listenTo( this.element );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the first focusable in {@link #items}.\r\n\t */\r\n\tfocus() {\r\n\t\tthis._focusCycler.focusFirst();\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the last focusable in {@link #items}.\r\n\t */\r\n\tfocusLast() {\r\n\t\tthis._focusCycler.focusLast();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/list/listitemview\r\n */\r\n\r\nimport View from '../view';\r\n\r\n/**\r\n * The list item view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class ListItemView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * Collection of the child views inside of the list item {@link #element}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.children = this.createCollection();\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'li',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-list__item'\r\n\t\t\t\t]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: this.children\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the list item.\r\n\t */\r\n\tfocus() {\r\n\t\tthis.children.first.focus();\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/list/listseparatorview\r\n */\r\n\r\nimport View from '../view';\r\n\r\n/**\r\n * The list separator view class.\r\n *\r\n * @extends module:ui/view~View\r\n */\r\nexport default class ListSeparatorView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'li',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-list__separator'\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/button/switchbuttonview\r\n */\r\n\r\nimport View from '../view';\r\nimport ButtonView from './buttonview';\r\n\r\nimport '../../theme/components/button/switchbutton.css';\r\n\r\n/**\r\n * The switch button view class.\r\n *\r\n *\t\tconst view = new SwitchButtonView();\r\n *\r\n *\t\tview.set( {\r\n *\t\t\twithText: true,\r\n *\t\t\tlabel: 'Switch me!'\r\n *\t\t} );\r\n *\r\n *\t\tview.render();\r\n *\r\n *\t\tdocument.body.append( view.element );\r\n *\r\n * @extends module:ui/buttonview~ButtonView\r\n */\r\nexport default class SwitchButtonView extends ButtonView {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\t/**\r\n\t\t * The toggle switch of the button.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/view~View} #toggleSwitchView\r\n\t\t */\r\n\t\tthis.toggleSwitchView = this._createToggleView();\r\n\r\n\t\tthis.extendTemplate( {\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: 'ck-switchbutton'\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trender() {\r\n\t\tsuper.render();\r\n\r\n\t\tthis.children.add( this.toggleSwitchView );\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a toggle child view.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/view~View}\r\n\t */\r\n\t_createToggleView() {\r\n\t\tconst toggleSwitchView = new View();\r\n\r\n\t\ttoggleSwitchView.setTemplate( {\r\n\t\t\ttag: 'span',\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck',\r\n\t\t\t\t\t'ck-button__toggle'\r\n\t\t\t\t],\r\n\t\t\t},\r\n\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'span',\r\n\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: [\r\n\t\t\t\t\t\t\t'ck',\r\n\t\t\t\t\t\t\t'ck-button__toggle__inner'\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} );\r\n\r\n\t\treturn toggleSwitchView;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ui/dropdown/utils\r\n */\r\n\r\nimport DropdownPanelView from './dropdownpanelview';\r\nimport DropdownView from './dropdownview';\r\nimport DropdownButtonView from './button/dropdownbuttonview';\r\nimport ToolbarView from '../toolbar/toolbarview';\r\nimport ListView from '../list/listview';\r\nimport ListItemView from '../list/listitemview';\r\nimport ListSeparatorView from '../list/listseparatorview';\r\nimport ButtonView from '../button/buttonview';\r\nimport SwitchButtonView from '../button/switchbuttonview';\r\n\r\nimport clickOutsideHandler from '../bindings/clickoutsidehandler';\r\n\r\nimport '../../theme/components/dropdown/toolbardropdown.css';\r\nimport '../../theme/components/dropdown/listdropdown.css';\r\n\r\n/**\r\n * A helper for creating dropdowns. It creates an instance of a {@link module:ui/dropdown/dropdownview~DropdownView dropdown},\r\n * with a {@link module:ui/dropdown/button/dropdownbutton~DropdownButton button},\r\n * {@link module:ui/dropdown/dropdownpanelview~DropdownPanelView panel} and all standard dropdown's behaviors.\r\n *\r\n * # Creating dropdowns\r\n *\r\n * By default, the default {@link module:ui/dropdown/button/dropdownbuttonview~DropdownButtonView} class is used as\r\n * definition of the button:\r\n *\r\n *\t\tconst dropdown = createDropdown( model );\r\n *\r\n *\t\t// Configure dropdown's button properties:\r\n *\t\tdropdown.buttonView.set( {\r\n *\t\t\tlabel: 'A dropdown',\r\n *\t\t\twithText: true\r\n *\t\t} );\r\n *\r\n *\t\tdropdown.render();\r\n *\r\n *\t\t// Will render a dropdown labeled \"A dropdown\" with an empty panel.\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * You can also provide other button views (they need to implement the\r\n * {@link module:ui/dropdown/button/dropdownbutton~DropdownButton} interface). For instance, you can use\r\n * {@link module:ui/dropdown/button/splitbuttonview~SplitButtonView} to create a dropdown with a split button.\r\n *\r\n *\t\tconst dropdown = createDropdown( model, SplitButtonView );\r\n *\r\n *\t\t// Configure dropdown's button properties:\r\n *\t\tdropdown.buttonView.set( {\r\n *\t\t\tlabel: 'A dropdown',\r\n *\t\t\twithText: true\r\n *\t\t} );\r\n *\r\n *\t\tdropdown.buttonView.on( 'execute', () => {\r\n *\t\t\t// Add the behavior of the \"action part\" of the split button.\r\n *\t\t\t// Split button consists of the \"action part\" and \"arrow part\".\r\n *\t\t\t// The arrow opens the dropdown while the action part can have some other behavior.\r\n * \t\t} );\r\n *\r\n *\t\tdropdown.render();\r\n *\r\n *\t\t// Will render a dropdown labeled \"A dropdown\" with an empty panel.\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * # Adding content to the dropdown's panel\r\n *\r\n * The content of the panel can be inserted directly into the `dropdown.panelView.element`:\r\n *\r\n *\t\tdropdown.panelView.element.textContent = 'Content of the panel';\r\n *\r\n * However, most of the time you will want to add there either a {@link module:ui/list/listview~ListView list of options}\r\n * or a list of buttons (i.e. a {@link module:ui/toolbar/toolbarview~ToolbarView toolbar}).\r\n * To simplify the task, you can use, respectively, {@link module:ui/dropdown/utils~addListToDropdown} or\r\n * {@link module:ui/dropdown/utils~addToolbarToDropdown} utils.\r\n *\r\n * @param {module:utils/locale~Locale} locale The locale instance.\r\n * @param {Function} ButtonClass The dropdown button view class. Needs to implement the\r\n * {@link module:ui/dropdown/button/dropdownbutton~DropdownButton} interface.\r\n * @returns {module:ui/dropdown/dropdownview~DropdownView} The dropdown view instance.\r\n */\r\nexport function createDropdown( locale, ButtonClass = DropdownButtonView ) {\r\n\tconst buttonView = new ButtonClass( locale );\r\n\r\n\tconst panelView = new DropdownPanelView( locale );\r\n\tconst dropdownView = new DropdownView( locale, buttonView, panelView );\r\n\r\n\tbuttonView.bind( 'isEnabled' ).to( dropdownView );\r\n\r\n\tif ( buttonView instanceof DropdownButtonView ) {\r\n\t\tbuttonView.bind( 'isOn' ).to( dropdownView, 'isOpen' );\r\n\t} else {\r\n\t\tbuttonView.arrowView.bind( 'isOn' ).to( dropdownView, 'isOpen' );\r\n\t}\r\n\r\n\taddDefaultBehavior( dropdownView );\r\n\r\n\treturn dropdownView;\r\n}\r\n\r\n/**\r\n * Adds an instance of {@link module:ui/toolbar/toolbarview~ToolbarView} to a dropdown.\r\n *\r\n *\t\tconst buttons = [];\r\n *\r\n *\t\t// Either create a new ButtonView instance or create existing.\r\n *\t\tbuttons.push( new ButtonView() );\r\n *\t\tbuttons.push( editor.ui.componentFactory.get( 'someButton' ) );\r\n *\r\n *\t\tconst dropdown = createDropdown( locale );\r\n *\r\n *\t\taddToolbarToDropdown( dropdown, buttons );\r\n *\r\n *\t\tdropdown.toolbarView.isVertical = true;\r\n *\r\n *\t\t// Will render a vertical button dropdown labeled \"A button dropdown\"\r\n *\t\t// with a button group in the panel containing two buttons.\r\n *\t\tdropdown.render()\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * See {@link module:ui/dropdown/utils~createDropdown} and {@link module:ui/toolbar/toolbarview~ToolbarView}.\r\n *\r\n * @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView A dropdown instance to which `ToolbarView` will be added.\r\n * @param {Iterable.<module:ui/button/buttonview~ButtonView>} buttons\r\n */\r\nexport function addToolbarToDropdown( dropdownView, buttons ) {\r\n\tconst toolbarView = dropdownView.toolbarView = new ToolbarView();\r\n\r\n\tdropdownView.extendTemplate( {\r\n\t\tattributes: {\r\n\t\t\tclass: [ 'ck-toolbar-dropdown' ]\r\n\t\t}\r\n\t} );\r\n\r\n\tbuttons.map( view => toolbarView.items.add( view ) );\r\n\r\n\tdropdownView.panelView.children.add( toolbarView );\r\n\ttoolbarView.items.delegate( 'execute' ).to( dropdownView );\r\n}\r\n\r\n/**\r\n * Adds an instance of {@link module:ui/list/listview~ListView} to a dropdown.\r\n *\r\n *\t\tconst items = new Collection();\r\n *\r\n *\t\titems.add( {\r\n *\t\t\ttype: 'button',\r\n *\t\t\tmodel: new Model( {\r\n *\t\t\t\twithText: true,\r\n *\t\t\t\tlabel: 'First item',\r\n *\t\t\t\tlabelStyle: 'color: red'\r\n *\t\t\t} )\r\n *\t\t} );\r\n *\r\n *\t\titems.add( {\r\n *\t\t\t type: 'button',\r\n *\t\t\t model: new Model( {\r\n *\t\t\t\twithText: true,\r\n *\t\t\t\tlabel: 'Second item',\r\n *\t\t\t\tlabelStyle: 'color: green',\r\n *\t\t\t\tclass: 'foo'\r\n *\t\t\t} )\r\n *\t\t} );\r\n *\r\n *\t\tconst dropdown = createDropdown( locale );\r\n *\r\n *\t\taddListToDropdown( dropdown, items );\r\n *\r\n *\t\t// Will render a dropdown with a list in the panel containing two items.\r\n *\t\tdropdown.render()\r\n *\t\tdocument.body.appendChild( dropdown.element );\r\n *\r\n * The `items` collection passed to this methods controls the presence and attributes of respective\r\n * {@link module:ui/list/listitemview~ListItemView list items}.\r\n *\r\n *\r\n * See {@link module:ui/dropdown/utils~createDropdown} and {@link module:list/list~List}.\r\n *\r\n * @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView A dropdown instance to which `ListVIew` will be added.\r\n * @param {Iterable.<module:ui/dropdown/utils~ListDropdownItemDefinition>} items\r\n * A collection of the list item definitions to populate the list.\r\n */\r\nexport function addListToDropdown( dropdownView, items ) {\r\n\tconst locale = dropdownView.locale;\r\n\tconst listView = dropdownView.listView = new ListView( locale );\r\n\r\n\tlistView.items.bindTo( items ).using( ( { type, model } ) => {\r\n\t\tif ( type === 'separator' ) {\r\n\t\t\treturn new ListSeparatorView( locale );\r\n\t\t} else if ( type === 'button' || type === 'switchbutton' ) {\r\n\t\t\tconst listItemView = new ListItemView( locale );\r\n\t\t\tlet buttonView;\r\n\r\n\t\t\tif ( type === 'button' ) {\r\n\t\t\t\tbuttonView = new ButtonView( locale );\r\n\t\t\t} else {\r\n\t\t\t\tbuttonView = new SwitchButtonView( locale );\r\n\t\t\t}\r\n\r\n\t\t\t// Bind all model properties to the button view.\r\n\t\t\tbuttonView.bind( ...Object.keys( model ) ).to( model );\r\n\t\t\tbuttonView.delegate( 'execute' ).to( listItemView );\r\n\r\n\t\t\tlistItemView.children.add( buttonView );\r\n\r\n\t\t\treturn listItemView;\r\n\t\t}\r\n\t} );\r\n\r\n\tdropdownView.panelView.children.add( listView );\r\n\r\n\tlistView.items.delegate( 'execute' ).to( dropdownView );\r\n}\r\n\r\n// Add a set of default behaviors to dropdown view.\r\n//\r\n// @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView\r\nfunction addDefaultBehavior( dropdownView ) {\r\n\tcloseDropdownOnBlur( dropdownView );\r\n\tcloseDropdownOnExecute( dropdownView );\r\n\tfocusDropdownContentsOnArrows( dropdownView );\r\n}\r\n\r\n// Adds a behavior to a dropdownView that closes opened dropdown when user clicks outside the dropdown.\r\n//\r\n// @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView\r\nfunction closeDropdownOnBlur( dropdownView ) {\r\n\tdropdownView.on( 'render', () => {\r\n\t\tclickOutsideHandler( {\r\n\t\t\temitter: dropdownView,\r\n\t\t\tactivator: () => dropdownView.isOpen,\r\n\t\t\tcallback: () => {\r\n\t\t\t\tdropdownView.isOpen = false;\r\n\t\t\t},\r\n\t\t\tcontextElements: [ dropdownView.element ]\r\n\t\t} );\r\n\t} );\r\n}\r\n\r\n// Adds a behavior to a dropdownView that closes the dropdown view on \"execute\" event.\r\n//\r\n// @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView\r\nfunction closeDropdownOnExecute( dropdownView ) {\r\n\t// Close the dropdown when one of the list items has been executed.\r\n\tdropdownView.on( 'execute', evt => {\r\n\t\t// Toggling a switch button view should not close the dropdown.\r\n\t\tif ( evt.source instanceof SwitchButtonView ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdropdownView.isOpen = false;\r\n\t} );\r\n}\r\n\r\n// Adds a behavior to a dropdownView that focuses the dropdown's panel view contents on keystrokes.\r\n//\r\n// @param {module:ui/dropdown/dropdownview~DropdownView} dropdownView\r\nfunction focusDropdownContentsOnArrows( dropdownView ) {\r\n\t// If the dropdown panel is already open, the arrow down key should focus the first child of the #panelView.\r\n\tdropdownView.keystrokes.set( 'arrowdown', ( data, cancel ) => {\r\n\t\tif ( dropdownView.isOpen ) {\r\n\t\t\tdropdownView.panelView.focus();\r\n\t\t\tcancel();\r\n\t\t}\r\n\t} );\r\n\r\n\t// If the dropdown panel is already open, the arrow up key should focus the last child of the #panelView.\r\n\tdropdownView.keystrokes.set( 'arrowup', ( data, cancel ) => {\r\n\t\tif ( dropdownView.isOpen ) {\r\n\t\t\tdropdownView.panelView.focusLast();\r\n\t\t\tcancel();\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * A definition of the list item used by the {@link module:ui/dropdown/utils~addListToDropdown}\r\n * utility.\r\n *\r\n * @typedef {Object} module:ui/dropdown/utils~ListDropdownItemDefinition\r\n *\r\n * @property {String} type Either `'separator'`, `'button'` or `'switchbutton'`.\r\n * @property {module:ui/model~Model} [model] Model of the item (when **not** `'separator'`).\r\n * Its properties fuel the newly created list item (or its children, depending on the `type`).\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module heading/headingui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport Model from '@ckeditor/ckeditor5-ui/src/model';\nimport {\n    createDropdown,\n    addListToDropdown\n} from '@ckeditor/ckeditor5-ui/src/dropdown/utils';\nimport { getLocalizedOptions } from './utils';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport '../theme/heading.css';\n/**\r\n * The headings UI feature. It introduces the `headings` dropdown.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class HeadingUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = editor.t;\n        const options = getLocalizedOptions(editor);\n        const defaultTitle = t('f');\n        const dropdownTooltip = t('g');\n        // Register UI component.\n        editor.ui.componentFactory.add('heading', locale => {\n            const titles = {};\n            const itemDefinitions = new Collection();\n            const headingCommand = editor.commands.get('heading');\n            const paragraphCommand = editor.commands.get('paragraph');\n            const commands = [headingCommand];\n            for (const option of options) {\n                const def = {\n                    type: 'button',\n                    model: new Model({\n                        label: option.title,\n                        class: option.class,\n                        withText: true\n                    })\n                };\n                if (option.model === 'paragraph') {\n                    def.model.bind('isOn').to(paragraphCommand, 'value');\n                    def.model.set('commandName', 'paragraph');\n                    commands.push(paragraphCommand);\n                } else {\n                    def.model.bind('isOn').to(headingCommand, 'value', value => value === option.model);\n                    def.model.set({\n                        commandName: 'heading',\n                        commandValue: option.model\n                    });\n                }\n                // Add the option to the collection.\n                itemDefinitions.add(def);\n                titles[option.model] = option.title;\n            }\n            const dropdownView = createDropdown(locale);\n            addListToDropdown(dropdownView, itemDefinitions);\n            dropdownView.buttonView.set({\n                isOn: false,\n                withText: true,\n                tooltip: dropdownTooltip\n            });\n            dropdownView.extendTemplate({ attributes: { class: ['ck-heading-dropdown'] } });\n            dropdownView.bind('isEnabled').toMany(commands, 'isEnabled', (...areEnabled) => {\n                return areEnabled.some(isEnabled => isEnabled);\n            });\n            dropdownView.buttonView.bind('label').to(headingCommand, 'value', paragraphCommand, 'value', (value, para) => {\n                const whichModel = value || para && 'paragraph';\n                // If none of the commands is active, display default title.\n                return titles[whichModel] ? titles[whichModel] : defaultTitle;\n            });\n            // Execute command when an item from the dropdown is selected.\n            this.listenTo(dropdownView, 'execute', evt => {\n                editor.execute(evt.source.commandName, evt.source.commandValue ? { value: evt.source.commandValue } : undefined);\n                editor.editing.view.focus();\n            });\n            return dropdownView;\n        });\n    }\n}","/**\r\n * Returns heading options as defined in `config.heading.options` but processed to consider\r\n * editor localization, i.e. to display {@link module:heading/heading~HeadingOption}\r\n * in the correct language.\r\n *\r\n * Note: The reason behind this method is that there's no way to use {@link module:utils/locale~Locale#t}\r\n * when the user config is defined because the editor does not exist yet.\r\n *\r\n * @param {module:core/editor/editor~Editor} editor\r\n * @returns {Array.<module:heading/heading~HeadingOption>}.\r\n */\nexport function getLocalizedOptions(editor) {\n    const t = editor.t;\n    const localizedTitles = {\n        Paragraph: t('au'),\n        'Heading 1': t('av'),\n        'Heading 2': t('aw'),\n        'Heading 3': t('ax')\n    };\n    return editor.config.get('heading.options').map(option => {\n        const title = localizedTitles[option.title];\n        if (title && title != option.title) {\n            // Clone the option to avoid altering the original `config.heading.options`.\n            option = Object.assign({}, option, { title });\n        }\n        return option;\n    });\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/placeholder\r\n */\r\n\r\nimport '../../theme/placeholder.css';\r\n\r\n// Each document stores information about its placeholder elements and check functions.\r\nconst documentPlaceholders = new WeakMap();\r\n\r\n/**\r\n * Attaches placeholder to provided element and updates it's visibility. To change placeholder simply call this method\r\n * once again with new parameters.\r\n *\r\n * @param {module:engine/view/view~View} view View controller.\r\n * @param {module:engine/view/element~Element} element Element to attach placeholder to.\r\n * @param {String} placeholderText Placeholder text to use.\r\n * @param {Function} [checkFunction] If provided it will be called before checking if placeholder should be displayed.\r\n * If function returns `false` placeholder will not be showed.\r\n */\r\nexport function attachPlaceholder( view, element, placeholderText, checkFunction ) {\r\n\tconst document = view.document;\r\n\r\n\t// Single listener per document.\r\n\tif ( !documentPlaceholders.has( document ) ) {\r\n\t\tdocumentPlaceholders.set( document, new Map() );\r\n\r\n\t\t// Create view post-fixer that will add placeholder where needed.\r\n\t\tdocument.registerPostFixer( writer => updateAllPlaceholders( document, writer ) );\r\n\t}\r\n\r\n\t// Store information about element with placeholder.\r\n\tdocumentPlaceholders.get( document ).set( element, {\r\n\t\tplaceholderText,\r\n\t\tcheckFunction\r\n\t} );\r\n\r\n\t// Update view right away.\r\n\tview.render();\r\n}\r\n\r\n/**\r\n * Removes placeholder functionality from given element.\r\n *\r\n * @param {module:engine/view/view~View} view\r\n * @param {module:engine/view/element~Element} element\r\n */\r\nexport function detachPlaceholder( view, element ) {\r\n\tconst doc = element.document;\r\n\r\n\tview.change( writer => {\r\n\t\tif ( documentPlaceholders.has( doc ) ) {\r\n\t\t\tdocumentPlaceholders.get( doc ).delete( element );\r\n\t\t}\r\n\r\n\t\twriter.removeClass( 'ck-placeholder', element );\r\n\t\twriter.removeAttribute( 'data-placeholder', element );\r\n\t} );\r\n}\r\n\r\n// Updates all placeholders of given document.\r\n//\r\n// @private\r\n// @param {module:engine/view/document~Document} view\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\nfunction updateAllPlaceholders( document, writer ) {\r\n\tconst placeholders = documentPlaceholders.get( document );\r\n\tlet changed = false;\r\n\r\n\tfor ( const [ element, info ] of placeholders ) {\r\n\t\tif ( updateSinglePlaceholder( writer, element, info ) ) {\r\n\t\t\tchanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn changed;\r\n}\r\n\r\n// Updates placeholder class of given element.\r\n//\r\n// @private\r\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n// @param {module:engine/view/element~Element} element\r\n// @param {Object} info\r\nfunction updateSinglePlaceholder( writer, element, info ) {\r\n\tconst document = element.document;\r\n\tconst text = info.placeholderText;\r\n\tlet changed = false;\r\n\r\n\t// Element was removed from document.\r\n\tif ( !document ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Update data attribute if needed.\r\n\tif ( element.getAttribute( 'data-placeholder' ) !== text ) {\r\n\t\twriter.setAttribute( 'data-placeholder', text, element );\r\n\t\tchanged = true;\r\n\t}\r\n\r\n\tconst viewSelection = document.selection;\r\n\tconst anchor = viewSelection.anchor;\r\n\tconst checkFunction = info.checkFunction;\r\n\r\n\t// If checkFunction is provided and returns false - remove placeholder.\r\n\tif ( checkFunction && !checkFunction() ) {\r\n\t\tif ( element.hasClass( 'ck-placeholder' ) ) {\r\n\t\t\twriter.removeClass( 'ck-placeholder', element );\r\n\t\t\tchanged = true;\r\n\t\t}\r\n\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t// Element is empty for placeholder purposes when it has no children or only ui elements.\r\n\t// This check is taken from `view.ContainerElement#getFillerOffset`.\r\n\tconst isEmptyish = !Array.from( element.getChildren() ).some( element => !element.is( 'uiElement' ) );\r\n\r\n\t// If element is empty and editor is blurred.\r\n\tif ( !document.isFocused && isEmptyish ) {\r\n\t\tif ( !element.hasClass( 'ck-placeholder' ) ) {\r\n\t\t\twriter.addClass( 'ck-placeholder', element );\r\n\t\t\tchanged = true;\r\n\t\t}\r\n\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t// It there are no child elements and selection is not placed inside element.\r\n\tif ( isEmptyish && anchor && anchor.parent !== element ) {\r\n\t\tif ( !element.hasClass( 'ck-placeholder' ) ) {\r\n\t\t\twriter.addClass( 'ck-placeholder', element );\r\n\t\t\tchanged = true;\r\n\t\t}\r\n\t} else {\r\n\t\tif ( element.hasClass( 'ck-placeholder' ) ) {\r\n\t\t\twriter.removeClass( 'ck-placeholder', element );\r\n\t\t\tchanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn changed;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagecaption/utils\r\n */\r\n\r\nimport { attachPlaceholder } from '@ckeditor/ckeditor5-engine/src/view/placeholder';\r\nimport { toWidgetEditable } from '@ckeditor/ckeditor5-widget/src/utils';\r\n\r\nconst captionSymbol = Symbol( 'imageCaption' );\r\n\r\n/**\r\n * Returns a function that creates a caption editable element for the given {@link module:engine/view/document~Document}.\r\n *\r\n * @param {module:engine/view/view~View} view\r\n * @param {String} placeholderText The text to be displayed when the caption is empty.\r\n * @returns {Function}\r\n */\r\nexport function captionElementCreator( view, placeholderText ) {\r\n\treturn writer => {\r\n\t\tconst editable = writer.createEditableElement( 'figcaption' );\r\n\t\twriter.setCustomProperty( captionSymbol, true, editable );\r\n\t\tattachPlaceholder( view, editable, placeholderText );\r\n\r\n\t\treturn toWidgetEditable( editable, writer );\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns `true` if a given view element is the image caption editable.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @returns {Boolean}\r\n */\r\nexport function isCaption( viewElement ) {\r\n\treturn !!viewElement.getCustomProperty( captionSymbol );\r\n}\r\n\r\n/**\r\n * Returns the caption model element from a given image element. Returns `null` if no caption is found.\r\n *\r\n * @param {module:engine/model/element~Element} imageModelElement\r\n * @returns {module:engine/model/element~Element|null}\r\n */\r\nexport function getCaptionFromImage( imageModelElement ) {\r\n\tfor ( const node of imageModelElement.getChildren() ) {\r\n\t\tif ( !!node && node.is( 'caption' ) ) {\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * {@link module:engine/view/matcher~Matcher} pattern. Checks if a given element is a `<figcaption>` element that is placed\r\n * inside the image `<figure>` element.\r\n *\r\n * @param {module:engine/view/element~Element} element\r\n * @returns {Object|null} Returns the object accepted by {@link module:engine/view/matcher~Matcher} or `null` if the element\r\n * cannot be matched.\r\n */\r\nexport function matchImageCaption( element ) {\r\n\tconst parent = element.parent;\r\n\r\n\t// Convert only captions for images.\r\n\tif ( element.name == 'figcaption' && parent && parent.name == 'figure' && parent.hasClass( 'image' ) ) {\r\n\t\treturn { name: true };\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imagecaption/imagecaptionediting\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport { upcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\nimport { isImage } from '../image/utils';\nimport {\n    captionElementCreator,\n    getCaptionFromImage,\n    matchImageCaption\n} from './utils';\n/**\r\n * The image caption engine plugin.\r\n *\r\n * It registers proper converters. It takes care of adding a caption element if the image without it is inserted\r\n * to the model document.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageCaptionEditing extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const view = editor.editing.view;\n        const schema = editor.model.schema;\n        const data = editor.data;\n        const editing = editor.editing;\n        const t = editor.t;\n        /**\r\n\t\t * The last selected caption editable.\r\n\t\t * It is used for hiding the editable when it is empty and the image widget is no longer selected.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/view/editableelement~EditableElement} #_lastSelectedCaption\r\n\t\t */\n        // Schema configuration.\n        schema.register('caption', {\n            allowIn: 'image',\n            allowContentOf: '$block',\n            isLimit: true\n        });\n        // Add caption element to each image inserted without it.\n        editor.model.document.registerPostFixer(writer => this._insertMissingModelCaptionElement(writer));\n        // View to model converter for the data pipeline.\n        editor.conversion.for('upcast').add(upcastElementToElement({\n            view: matchImageCaption,\n            model: 'caption'\n        }));\n        // Model to view converter for the data pipeline.\n        const createCaptionForData = writer => writer.createContainerElement('figcaption');\n        data.downcastDispatcher.on('insert:caption', captionModelToView(createCaptionForData, false));\n        // Model to view converter for the editing pipeline.\n        const createCaptionForEditing = captionElementCreator(view, t('ai'));\n        editing.downcastDispatcher.on('insert:caption', captionModelToView(createCaptionForEditing));\n        // Always show caption in view when something is inserted in model.\n        editing.downcastDispatcher.on('insert', this._fixCaptionVisibility(data => data.item), { priority: 'high' });\n        // Hide caption when everything is removed from it.\n        editing.downcastDispatcher.on('remove', this._fixCaptionVisibility(data => data.position.parent), { priority: 'high' });\n        // Update caption visibility on view in post fixer.\n        view.document.registerPostFixer(writer => this._updateCaptionVisibility(writer));\n    }\n    /**\r\n\t * Updates the view before each rendering, making sure that empty captions (so unnecessary ones) are hidden\r\n\t * and then visible when the image is selected.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\r\n\t * @returns {Boolean} Returns `true` when the view is updated.\r\n\t */\n    _updateCaptionVisibility(viewWriter) {\n        const mapper = this.editor.editing.mapper;\n        const lastCaption = this._lastSelectedCaption;\n        let viewCaption;\n        // If whole image is selected.\n        const modelSelection = this.editor.model.document.selection;\n        const selectedElement = modelSelection.getSelectedElement();\n        if (selectedElement && selectedElement.is('image')) {\n            const modelCaption = getCaptionFromImage(selectedElement);\n            viewCaption = mapper.toViewElement(modelCaption);\n        }\n        // If selection is placed inside caption.\n        const position = modelSelection.getFirstPosition();\n        const modelCaption = getParentCaption(position.parent);\n        if (modelCaption) {\n            viewCaption = mapper.toViewElement(modelCaption);\n        }\n        // Is currently any caption selected?\n        if (viewCaption) {\n            // Was any caption selected before?\n            if (lastCaption) {\n                // Same caption as before?\n                if (lastCaption === viewCaption) {\n                    return showCaption(viewCaption, viewWriter);\n                } else {\n                    hideCaptionIfEmpty(lastCaption, viewWriter);\n                    this._lastSelectedCaption = viewCaption;\n                    return showCaption(viewCaption, viewWriter);\n                }\n            } else {\n                this._lastSelectedCaption = viewCaption;\n                return showCaption(viewCaption, viewWriter);\n            }\n        } else {\n            // Was any caption selected before?\n            if (lastCaption) {\n                const viewModified = hideCaptionIfEmpty(lastCaption, viewWriter);\n                this._lastSelectedCaption = null;\n                return viewModified;\n            } else {\n                return false;\n            }\n        }\n    }\n    /**\r\n\t * Returns a converter that fixes caption visibility during the model-to-view conversion.\r\n\t * Checks if the changed node is placed inside the caption element and fixes its visibility in the view.\r\n\t *\r\n\t * @private\r\n\t * @param {Function} nodeFinder\r\n\t * @returns {Function}\r\n\t */\n    _fixCaptionVisibility(nodeFinder) {\n        return (evt, data, conversionApi) => {\n            const node = nodeFinder(data);\n            const modelCaption = getParentCaption(node);\n            const mapper = this.editor.editing.mapper;\n            const viewWriter = conversionApi.writer;\n            if (modelCaption) {\n                const viewCaption = mapper.toViewElement(modelCaption);\n                if (viewCaption) {\n                    if (modelCaption.childCount) {\n                        viewWriter.removeClass('ck-hidden', viewCaption);\n                    } else {\n                        viewWriter.addClass('ck-hidden', viewCaption);\n                    }\n                }\n            }\n        };\n    }\n    /**\r\n\t * Checks whether the data inserted to the model document have an image element that has no caption element inside it.\r\n\t * If there is none, it adds it to the image element.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/writer~Writer} writer The writer to make changes with.\r\n\t * @returns {Boolean} `true` if any change was applied, `false` otherwise.\r\n\t */\n    _insertMissingModelCaptionElement(writer) {\n        const model = this.editor.model;\n        const changes = model.document.differ.getChanges();\n        for (const entry of changes) {\n            if (entry.type == 'insert' && entry.name == 'image') {\n                const item = entry.position.nodeAfter;\n                if (!getCaptionFromImage(item)) {\n                    writer.appendElement('caption', item);\n                    return true;\n                }\n            }\n        }\n    }\n}\n// Creates a converter that converts image caption model element to view element.\n//\n// @private\n// @param {Function} elementCreator\n// @param {Boolean} [hide=true] When set to `false` view element will not be inserted when it's empty.\n// @returns {Function}\nfunction captionModelToView(elementCreator, hide = true) {\n    return (evt, data, conversionApi) => {\n        const captionElement = data.item;\n        // Return if element shouldn't be present when empty.\n        if (!captionElement.childCount && !hide) {\n            return;\n        }\n        if (isImage(captionElement.parent)) {\n            if (!conversionApi.consumable.consume(data.item, 'insert')) {\n                return;\n            }\n            const viewImage = conversionApi.mapper.toViewElement(data.range.start.parent);\n            const viewCaption = elementCreator(conversionApi.writer);\n            const viewWriter = conversionApi.writer;\n            // Hide if empty.\n            if (!captionElement.childCount) {\n                viewWriter.addClass('ck-hidden', viewCaption);\n            }\n            insertViewCaptionAndBind(viewCaption, data.item, viewImage, conversionApi);\n        }\n    };\n}\n// Inserts `viewCaption` at the end of `viewImage` and binds it to `modelCaption`.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} viewCaption\n// @param {module:engine/model/element~Element} modelCaption\n// @param {module:engine/view/containerelement~ContainerElement} viewImage\n// @param {Object} conversionApi\nfunction insertViewCaptionAndBind(viewCaption, modelCaption, viewImage, conversionApi) {\n    const viewPosition = conversionApi.writer.createPositionAt(viewImage, 'end');\n    conversionApi.writer.insert(viewPosition, viewCaption);\n    conversionApi.mapper.bindElements(modelCaption, viewCaption);\n}\n// Checks if the provided node or one of its ancestors is a caption element, and returns it.\n//\n// @private\n// @param {module:engine/model/node~Node} node\n// @returns {module:engine/model/element~Element|null}\nfunction getParentCaption(node) {\n    const ancestors = node.getAncestors({ includeSelf: true });\n    const caption = ancestors.find(ancestor => ancestor.name == 'caption');\n    if (caption && caption.parent && caption.parent.name == 'image') {\n        return caption;\n    }\n    return null;\n}\n// Hides a given caption in the view if it is empty.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} caption\n// @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\n// @returns {Boolean} Returns `true` if the view was modified.\nfunction hideCaptionIfEmpty(caption, viewWriter) {\n    if (!caption.childCount && !caption.hasClass('ck-hidden')) {\n        viewWriter.addClass('ck-hidden', caption);\n        return true;\n    }\n    return false;\n}\n// Shows the caption.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} caption\n// @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\n// @returns {Boolean} Returns `true` if the view was modified.\nfunction showCaption(caption, viewWriter) {\n    if (caption.hasClass('ck-hidden')) {\n        viewWriter.removeClass('ck-hidden', caption);\n        return true;\n    }\n    return false;\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagestyle/imagestylecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { isImage } from '../image/utils';\r\n\r\n/**\r\n * The image style command. It is used to apply different image styles.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ImageStyleCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the image style command. Each command instance is handling one style.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>} styles The styles that this command supports.\r\n\t */\r\n\tconstructor( editor, styles ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The cached name of the default style if it is present. If there is no default style, it defaults to `false`.\r\n\t\t *\r\n\t\t * @type {Boolean|String}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._defaultStyle = false;\r\n\r\n\t\t/**\r\n\t\t * A style handled by this command.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>} #styles\r\n\t\t */\r\n\t\tthis.styles = styles.reduce( ( styles, style ) => {\r\n\t\t\tstyles[ style.name ] = style;\r\n\r\n\t\t\tif ( style.isDefault ) {\r\n\t\t\t\tthis._defaultStyle = style.name;\r\n\t\t\t}\r\n\r\n\t\t\treturn styles;\r\n\t\t}, {} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst element = this.editor.model.document.selection.getSelectedElement();\r\n\r\n\t\tthis.isEnabled = isImage( element );\r\n\r\n\t\tif ( !element ) {\r\n\t\t\tthis.value = false;\r\n\t\t} else if ( element.hasAttribute( 'imageStyle' ) ) {\r\n\t\t\tconst attributeValue = element.getAttribute( 'imageStyle' );\r\n\t\t\tthis.value = this.styles[ attributeValue ] ? attributeValue : false;\r\n\t\t} else {\r\n\t\t\tthis.value = this._defaultStyle;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t *\t\teditor.execute( 'imageStyle', { value: 'side' } );\r\n\t *\r\n\t * @param {Object} options\r\n\t * @param {String} options.value The name of the style (based on the\r\n\t * {@link module:image/image~ImageConfig#styles `image.styles`} configuration option).\r\n\t * @fires execute\r\n\t */\r\n\texecute( options ) {\r\n\t\tconst styleName = options.value;\r\n\r\n\t\tconst model = this.editor.model;\r\n\t\tconst imageElement = model.document.selection.getSelectedElement();\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// Default style means that there is no `imageStyle` attribute in the model.\r\n\t\t\t// https://github.com/ckeditor/ckeditor5-image/issues/147\r\n\t\t\tif ( this.styles[ styleName ].isDefault ) {\r\n\t\t\t\twriter.removeAttribute( 'imageStyle', imageElement );\r\n\t\t\t} else {\r\n\t\t\t\twriter.setAttribute( 'imageStyle', styleName, imageElement );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * @module image/imagestyle/converters\r\n */\r\n\r\n/**\r\n * Returns a converter for the `imageStyle` attribute. It can be used for adding, changing and removing the attribute.\r\n *\r\n * @param {Object} styles An object containing available styles. See {@link module:image/imagestyle/imagestyleediting~ImageStyleFormat}\r\n * for more details.\r\n * @returns {Function} A model-to-view attribute converter.\r\n */\r\nexport function modelToViewStyleAttribute( styles ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check if there is class name associated with given value.\r\n\t\tconst newStyle = getStyleByName( data.attributeNewValue, styles );\r\n\t\tconst oldStyle = getStyleByName( data.attributeOldValue, styles );\r\n\r\n\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item );\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\tif ( oldStyle ) {\r\n\t\t\tviewWriter.removeClass( oldStyle.className, viewElement );\r\n\t\t}\r\n\r\n\t\tif ( newStyle ) {\r\n\t\t\tviewWriter.addClass( newStyle.className, viewElement );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns a view-to-model converter converting image CSS classes to a proper value in the model.\r\n *\r\n * @param {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>} styles The styles for which the converter is created.\r\n * @returns {Function} A view-to-model converter.\r\n */\r\nexport function viewToModelStyleAttribute( styles ) {\r\n\t// Convert only non–default styles.\r\n\tconst filteredStyles = styles.filter( style => !style.isDefault );\r\n\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( !data.modelRange ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewFigureElement = data.viewItem;\r\n\t\tconst modelImageElement = first( data.modelRange.getItems() );\r\n\r\n\t\t// Check if `imageStyle` attribute is allowed for current element.\r\n\t\tif ( !conversionApi.schema.checkAttribute( modelImageElement, 'imageStyle' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Convert style one by one.\r\n\t\tfor ( const style of filteredStyles ) {\r\n\t\t\t// Try to consume class corresponding with style.\r\n\t\t\tif ( conversionApi.consumable.consume( viewFigureElement, { classes: style.className } ) ) {\r\n\t\t\t\t// And convert this style to model attribute.\r\n\t\t\t\tconversionApi.writer.setAttribute( 'imageStyle', style.name, modelImageElement );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n// Returns the style with a given `name` from an array of styles.\r\n//\r\n// @param {String} name\r\n// @param {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat> } styles\r\n// @returns {module:image/imagestyle/imagestyleediting~ImageStyleFormat|undefined}\r\nfunction getStyleByName( name, styles ) {\r\n\tfor ( const style of styles ) {\r\n\t\tif ( style.name === name ) {\r\n\t\t\treturn style;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagestyle/utils\r\n */\r\n\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\n\r\nimport fullWidthIcon from '@ckeditor/ckeditor5-core/theme/icons/object-full-width.svg';\r\nimport leftIcon from '@ckeditor/ckeditor5-core/theme/icons/object-left.svg';\r\nimport centerIcon from '@ckeditor/ckeditor5-core/theme/icons/object-center.svg';\r\nimport rightIcon from '@ckeditor/ckeditor5-core/theme/icons/object-right.svg';\r\n\r\n/**\r\n * Default image styles provided by the plugin that can be referred in the\r\n * {@link module:image/image~ImageConfig#styles} configuration.\r\n *\r\n * Among them, 2 default semantic content styles are available:\r\n *\r\n * * `full` is a full–width image without any CSS class,\r\n * * `side` is a side image styled with the `image-style-side` CSS class.\r\n *\r\n * There are also 3 styles focused on formatting:\r\n *\r\n * * `alignLeft` aligns the image to the left using the `image-style-align-left` class,\r\n * * `alignCenter` centers the image using the `image-style-align-center` class,\r\n * * `alignRight` aligns the image to the right using the `image-style-align-right` class,\r\n *\r\n * @member {Object.<String,Object>}\r\n */\r\nconst defaultStyles = {\r\n\t// This option is equal to the situation when no style is applied.\r\n\tfull: {\r\n\t\tname: 'full',\r\n\t\ttitle: 'Full size image',\r\n\t\ticon: fullWidthIcon,\r\n\t\tisDefault: true\r\n\t},\r\n\r\n\t// This represents a side image.\r\n\tside: {\r\n\t\tname: 'side',\r\n\t\ttitle: 'Side image',\r\n\t\ticon: rightIcon,\r\n\t\tclassName: 'image-style-side'\r\n\t},\r\n\r\n\t// This style represents an image aligned to the left.\r\n\talignLeft: {\r\n\t\tname: 'alignLeft',\r\n\t\ttitle: 'Left aligned image',\r\n\t\ticon: leftIcon,\r\n\t\tclassName: 'image-style-align-left'\r\n\t},\r\n\r\n\t// This style represents a centered image.\r\n\talignCenter: {\r\n\t\tname: 'alignCenter',\r\n\t\ttitle: 'Centered image',\r\n\t\ticon: centerIcon,\r\n\t\tclassName: 'image-style-align-center'\r\n\t},\r\n\r\n\t// This style represents an image aligned to the right.\r\n\talignRight: {\r\n\t\tname: 'alignRight',\r\n\t\ttitle: 'Right aligned image',\r\n\t\ticon: rightIcon,\r\n\t\tclassName: 'image-style-align-right'\r\n\t}\r\n};\r\n\r\n/**\r\n * Default image style icons provided by the plugin that can be referred in the\r\n * {@link module:image/image~ImageConfig#styles} configuration.\r\n *\r\n * There are 4 icons available: `'full'`, `'left'`, `'center'` and `'right'`.\r\n *\r\n * @member {Object.<String, String>}\r\n */\r\nconst defaultIcons = {\r\n\tfull: fullWidthIcon,\r\n\tleft: leftIcon,\r\n\tright: rightIcon,\r\n\tcenter: centerIcon\r\n};\r\n\r\n/**\r\n * Returns a {@link module:image/image~ImageConfig#styles} array with items normalized in the\r\n * {@link module:image/imagestyle/imagestyleediting~ImageStyleFormat} format and a complete `icon` markup for each style.\r\n *\r\n * @returns {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>}\r\n */\r\nexport function normalizeImageStyles( configuredStyles = [] ) {\r\n\treturn configuredStyles\r\n\t\t.map( _normalizeStyle )\r\n\t\t.map( style => Object.assign( {}, style ) );\r\n}\r\n\r\n// Normalizes an image style provided in the {@link module:image/image~ImageConfig#styles}\r\n// and returns it in a {@link module:image/imagestyle/imagestyleediting~ImageStyleFormat}.\r\n//\r\n// @param {Object} style\r\n// @returns {@link module:image/imagestyle/imagestyleediting~ImageStyleFormat}\r\nfunction _normalizeStyle( style ) {\r\n\t// Just the name of the style has been passed.\r\n\tif ( typeof style == 'string' ) {\r\n\t\tconst styleName = style;\r\n\r\n\t\t// If it's one of the defaults, just use it.\r\n\t\tif ( defaultStyles[ styleName ] ) {\r\n\t\t\t// Clone the style to avoid overriding defaults.\r\n\t\t\tstyle = Object.assign( {}, defaultStyles[ styleName ] );\r\n\t\t}\r\n\t\t// If it's just a name but none of the defaults, warn because probably it's a mistake.\r\n\t\telse {\r\n\t\t\tlog.warn(\r\n\t\t\t\t'image-style-not-found: There is no such image style of given name.',\r\n\t\t\t\t{ name: styleName }\r\n\t\t\t);\r\n\r\n\t\t\t// Normalize the style anyway to prevent errors.\r\n\t\t\tstyle = {\r\n\t\t\t\tname: styleName\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t// If an object style has been passed and if the name matches one of the defaults,\r\n\t// extend it with defaults – the user wants to customize a default style.\r\n\t// Note: Don't override the user–defined style object, clone it instead.\r\n\telse if ( defaultStyles[ style.name ] ) {\r\n\t\tconst defaultStyle = defaultStyles[ style.name ];\r\n\t\tconst extendedStyle = Object.assign( {}, style );\r\n\r\n\t\tfor ( const prop in defaultStyle ) {\r\n\t\t\tif ( !style.hasOwnProperty( prop ) ) {\r\n\t\t\t\textendedStyle[ prop ] = defaultStyle[ prop ];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstyle = extendedStyle;\r\n\t}\r\n\r\n\t// If an icon is defined as a string and correspond with a name\r\n\t// in default icons, use the default icon provided by the plugin.\r\n\tif ( typeof style.icon == 'string' && defaultIcons[ style.icon ] ) {\r\n\t\tstyle.icon = defaultIcons[ style.icon ];\r\n\t}\r\n\r\n\treturn style;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagestyle/imagestyleediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageStyleCommand from './imagestylecommand';\r\nimport ImageEditing from '../image/imageediting';\r\nimport { viewToModelStyleAttribute, modelToViewStyleAttribute } from './converters';\r\nimport { normalizeImageStyles } from './utils';\r\n\r\n/**\r\n * The image style engine plugin. It sets the default configuration, creates converters and registers\r\n * {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand ImageStyleCommand}.\r\n *\r\n * @extends {module:core/plugin~Plugin}\r\n */\r\nexport default class ImageStyleEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageEditing ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageStyleEditing';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst schema = editor.model.schema;\r\n\t\tconst data = editor.data;\r\n\t\tconst editing = editor.editing;\r\n\r\n\t\t// Define default configuration.\r\n\t\teditor.config.define( 'image.styles', [ 'full', 'side' ] );\r\n\r\n\t\t// Get configuration.\r\n\t\tconst styles = normalizeImageStyles( editor.config.get( 'image.styles' ) );\r\n\r\n\t\t// Allow imageStyle attribute in image.\r\n\t\t// We could call it 'style' but https://github.com/ckeditor/ckeditor5-engine/issues/559.\r\n\t\tschema.extend( 'image', { allowAttributes: 'imageStyle' } );\r\n\r\n\t\t// Converters for imageStyle attribute from model to view.\r\n\t\tconst modelToViewConverter = modelToViewStyleAttribute( styles );\r\n\t\tediting.downcastDispatcher.on( 'attribute:imageStyle:image', modelToViewConverter );\r\n\t\tdata.downcastDispatcher.on( 'attribute:imageStyle:image', modelToViewConverter );\r\n\r\n\t\t// Converter for figure element from view to model.\r\n\t\tdata.upcastDispatcher.on( 'element:figure', viewToModelStyleAttribute( styles ), { priority: 'low' } );\r\n\r\n\t\t// Register imageStyle command.\r\n\t\teditor.commands.add( 'imageStyle', new ImageStyleCommand( editor, styles ) );\r\n\t}\r\n}\r\n\r\n/**\r\n * The image style format descriptor.\r\n *\r\n *\t\timport fullSizeIcon from 'path/to/icon.svg';\r\n *\r\n *\t\tconst imageStyleFormat = {\r\n *\t\t\tname: 'fullSize',\r\n *\t\t\ticon: fullSizeIcon,\r\n *\t\t\ttitle: 'Full size image',\r\n *\t\t\tclassName: 'image-full-size'\r\n *\t\t}\r\n *\r\n * @typedef {Object} module:image/imagestyle/imagestyleediting~ImageStyleFormat\r\n *\r\n * @property {String} name The unique name of the style. It will be used to:\r\n *\r\n * * Store the chosen style in the model by setting the `imageStyle` attribute of the `<image>` element.\r\n * * As a value of the {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand#execute `imageStyle` command},\r\n * * when registering a button for each of the styles (`'imageStyle:{name}'`) in the\r\n * {@link module:ui/componentfactory~ComponentFactory UI components factory} (this functionality is provided by the\r\n * {@link module:image/imagestyle/imagestyleui~ImageStyleUI} plugin).\r\n *\r\n * @property {Boolean} [isDefault] When set, the style will be used as the default one.\r\n * A default style does not apply any CSS class to the view element.\r\n *\r\n * @property {String} icon One of the following to be used when creating the style's button:\r\n *\r\n * * An SVG icon source (as an XML string).\r\n * * One of {@link module:image/imagestyle/utils~defaultIcons} to use a default icon provided by the plugin.\r\n *\r\n * @property {String} title The style's title.\r\n *\r\n * @property {String} className The CSS class used to represent the style in the view.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module image/imagestyle/imagestyleui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport { normalizeImageStyles } from './utils';\nimport '../../theme/imagestyle.css';\n/**\r\n * The image style UI plugin.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ImageStyleUI extends Plugin {\n    /**\r\n\t * Returns the default localized style titles provided by the plugin.\r\n\t *\r\n\t * The following localized titles corresponding with\r\n\t * {@link module:image/imagestyle/utils~defaultStyles} are available:\r\n\t *\r\n\t * * `'Full size image'`,\r\n\t * * `'Side image'`,\r\n\t * * `'Left aligned image'`,\r\n\t * * `'Centered image'`,\r\n\t * * `'Right aligned image'`\r\n\t *\r\n\t * @returns {Object.<String,String>}\r\n\t */\n    get localizedDefaultStylesTitles() {\n        const t = this.editor.t;\n        return {\n            'Full size image': t('i'),\n            'Side image': t('j'),\n            'Left aligned image': t('k'),\n            'Centered image': t('l'),\n            'Right aligned image': t('m')\n        };\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const configuredStyles = editor.config.get('image.styles');\n        const translatedStyles = translateStyles(normalizeImageStyles(configuredStyles), this.localizedDefaultStylesTitles);\n        for (const style of translatedStyles) {\n            this._createButton(style);\n        }\n    }\n    /**\r\n\t * Creates a button for each style and stores it in the editor {@link module:ui/componentfactory~ComponentFactory ComponentFactory}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:image/imagestyle/imagestyleediting~ImageStyleFormat} style\r\n\t */\n    _createButton(style) {\n        const editor = this.editor;\n        const componentName = `imageStyle:${ style.name }`;\n        editor.ui.componentFactory.add(componentName, locale => {\n            const command = editor.commands.get('imageStyle');\n            const view = new ButtonView(locale);\n            view.set({\n                label: style.title,\n                icon: style.icon,\n                tooltip: true\n            });\n            view.bind('isEnabled').to(command, 'isEnabled');\n            view.bind('isOn').to(command, 'value', value => value === style.name);\n            this.listenTo(view, 'execute', () => editor.execute('imageStyle', { value: style.name }));\n            return view;\n        });\n    }\n}\n/**\r\n * Returns the translated `title` from the passed styles array.\r\n *\r\n * @param {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>} styles\r\n * @param titles\r\n * @returns {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>}\r\n */\nfunction translateStyles(styles, titles) {\n    for (const style of styles) {\n        // Localize the titles of the styles, if a title corresponds with\n        // a localized default provided by the plugin.\n        if (titles[style.title]) {\n            style.title = titles[style.title];\n        }\n    }\n    return styles;\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module widget/widgettoolbarrepository\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ContextualBalloon from '@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon';\r\nimport ToolbarView from '@ckeditor/ckeditor5-ui/src/toolbar/toolbarview';\r\nimport BalloonPanelView from '@ckeditor/ckeditor5-ui/src/panel/balloon/balloonpanelview';\r\nimport { isWidget } from './utils';\r\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\r\n\r\n/**\r\n * Widget toolbar repository plugin. A central point for registering widget toolbars. This plugin handles the whole\r\n * toolbar rendering process and exposes a concise API.\r\n *\r\n * To add a toolbar for your widget use the {@link ~WidgetToolbarRepository#register `WidgetToolbarRepository#register()`} method.\r\n *\r\n * The following example comes from the {@link module:image/imagetoolbar~ImageToolbar} plugin:\r\n *\r\n * \t\tclass ImageToolbar extends Plugin {\r\n *\t\t\tstatic get requires() {\r\n *\t\t\t\treturn [ WidgetToolbarRepository ];\r\n *\t\t\t}\r\n *\r\n *\t\t\tafterInit() {\r\n *\t\t\t\tconst editor = this.editor;\r\n *\t\t\t\tconst widgetToolbarRepository = editor.plugins.get( WidgetToolbarRepository );\r\n *\r\n *\t\t\t\twidgetToolbarRepository.register( 'image', {\r\n *\t\t\t\t\titems: editor.config.get( 'image.toolbar' ),\r\n *\t\t\t\t\tvisibleWhen: viewSelection => isImageWidgetSelected( viewSelection )\r\n *\t\t\t\t} );\r\n *\t\t\t}\r\n *\t\t}\r\n */\r\nexport default class WidgetToolbarRepository extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ContextualBalloon ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'WidgetToolbarRepository';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst balloonToolbar = editor.plugins.get( 'BalloonToolbar' );\r\n\r\n\t\t// Disables the default balloon toolbar for all widgets.\r\n\t\tif ( balloonToolbar ) {\r\n\t\t\tthis.listenTo( balloonToolbar, 'show', evt => {\r\n\t\t\t\tif ( isWidgetSelected( editor.editing.view.document.selection ) ) {\r\n\t\t\t\t\tevt.stop();\r\n\t\t\t\t}\r\n\t\t\t}, { priority: 'high' } );\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * A map of toolbars.\r\n\t\t *\r\n\t\t * @protected\r\n\t\t * @member {Map.<string,Object>} #_toolbars\r\n\t\t */\r\n\t\tthis._toolbars = new Map();\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._balloon = this.editor.plugins.get( 'ContextualBalloon' );\r\n\r\n\t\tthis.listenTo( editor.ui, 'update', () => {\r\n\t\t\tthis._updateToolbarsVisibility();\r\n\t\t} );\r\n\r\n\t\t// UI#update is not fired after focus is back in editor, we need to check if balloon panel should be visible.\r\n\t\tthis.listenTo( editor.ui.focusTracker, 'change:isFocused', () => {\r\n\t\t\tthis._updateToolbarsVisibility();\r\n\t\t}, { priority: 'low' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Registers toolbar in the WidgetToolbarRepository. It renders it in the `ContextualBalloon` based on the value of the invoked\r\n\t * `visibleWhen` function. Toolbar items are gathered from `items` array.\r\n\t * The balloon's CSS class is by default `ck-toolbar-container` and may be override with the `balloonClassName` option.\r\n\t *\r\n\t * Note: This method should be called in the {@link module:core/plugin~PluginInterface#afterInit `Plugin#afterInit()`}\r\n\t * callback (or later) to make sure that the given toolbar items were already registered by other plugins.\r\n\t *\r\n\t * @param {String} toolbarId An id for the toolbar. Used to\r\n\t * @param {Object} options\r\n\t * @param {Array.<String>} options.items Array of toolbar items.\r\n\t * @param {Function} options.visibleWhen Callback which specifies when the toolbar should be visible for the widget.\r\n\t * @param {String} [options.balloonClassName='ck-toolbar-container'] CSS class for the widget balloon.\r\n\t */\r\n\tregister( toolbarId, { items, visibleWhen, balloonClassName = 'ck-toolbar-container' } ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst toolbarView = new ToolbarView();\r\n\r\n\t\tif ( this._toolbars.has( toolbarId ) ) {\r\n\t\t\t/**\r\n\t\t\t * Toolbar with the given id was already added.\r\n\t\t\t *\r\n\t\t\t * @error widget-toolbar-duplicated\r\n\t\t\t * @param toolbarId Toolbar id.\r\n\t\t\t */\r\n\t\t\tthrow new CKEditorError( 'widget-toolbar-duplicated: Toolbar with the given id was already added.', { toolbarId } );\r\n\t\t}\r\n\r\n\t\ttoolbarView.fillFromConfig( items, editor.ui.componentFactory );\r\n\r\n\t\tthis._toolbars.set( toolbarId, {\r\n\t\t\tview: toolbarView,\r\n\t\t\tvisibleWhen,\r\n\t\t\tballoonClassName,\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Iterates over stored toolbars and makes them visible or hidden.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_updateToolbarsVisibility() {\r\n\t\tfor ( const toolbar of this._toolbars.values() ) {\r\n\t\t\tif ( !this.editor.ui.focusTracker.isFocused || !toolbar.visibleWhen( this.editor.editing.view.document.selection ) ) {\r\n\t\t\t\tthis._hideToolbar( toolbar );\r\n\t\t\t} else {\r\n\t\t\t\tthis._showToolbar( toolbar );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the given toolbar.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} toolbar\r\n\t */\r\n\t_hideToolbar( toolbar ) {\r\n\t\tif ( !this._isToolbarVisible( toolbar ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._balloon.remove( toolbar.view );\r\n\t}\r\n\r\n\t/**\r\n\t * Shows up the toolbar if the toolbar is not visible and repositions the toolbar's balloon when toolbar's\r\n\t * view is the most top view in balloon stack.\r\n\t *\r\n\t * It might happen here that the toolbar's view is under another view. Then do nothing as the other toolbar view\r\n\t * should be still visible after the {@link module:core/editor/editorui~EditorUI#event:update}.\r\n\t *\r\n\t * @private\r\n\t * @param {Object} toolbar\r\n\t */\r\n\t_showToolbar( toolbar ) {\r\n\t\tif ( this._isToolbarVisible( toolbar ) ) {\r\n\t\t\trepositionContextualBalloon( this.editor );\r\n\t\t} else if ( !this._balloon.hasView( toolbar.view ) ) {\r\n\t\t\tthis._balloon.add( {\r\n\t\t\t\tview: toolbar.view,\r\n\t\t\t\tposition: getBalloonPositionData( this.editor ),\r\n\t\t\t\tballoonClassName: toolbar.balloonClassName,\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {Object} toolbar\r\n\t */\r\n\t_isToolbarVisible( toolbar ) {\r\n\t\treturn this._balloon.visibleView == toolbar.view;\r\n\t}\r\n}\r\n\r\nfunction repositionContextualBalloon( editor ) {\r\n\tconst balloon = editor.plugins.get( 'ContextualBalloon' );\r\n\tconst position = getBalloonPositionData( editor );\r\n\r\n\tballoon.updatePosition( position );\r\n}\r\n\r\nfunction getBalloonPositionData( editor ) {\r\n\tconst editingView = editor.editing.view;\r\n\tconst defaultPositions = BalloonPanelView.defaultPositions;\r\n\tconst widget = getParentWidget( editingView.document.selection );\r\n\r\n\treturn {\r\n\t\ttarget: editingView.domConverter.viewToDom( widget ),\r\n\t\tpositions: [\r\n\t\t\tdefaultPositions.northArrowSouth,\r\n\t\t\tdefaultPositions.northArrowSouthWest,\r\n\t\t\tdefaultPositions.northArrowSouthEast,\r\n\t\t\tdefaultPositions.southArrowNorth,\r\n\t\t\tdefaultPositions.southArrowNorthWest,\r\n\t\t\tdefaultPositions.southArrowNorthEast\r\n\t\t]\r\n\t};\r\n}\r\n\r\nfunction getParentWidget( selection ) {\r\n\tconst selectedElement = selection.getSelectedElement();\r\n\r\n\tif ( selectedElement && isWidget( selectedElement ) ) {\r\n\t\treturn selectedElement;\r\n\t}\r\n\r\n\tconst position = selection.getFirstPosition();\r\n\tlet parent = position.parent;\r\n\r\n\twhile ( parent ) {\r\n\t\tif ( parent.is( 'element' ) && isWidget( parent ) ) {\r\n\t\t\treturn parent;\r\n\t\t}\r\n\r\n\t\tparent = parent.parent;\r\n\t}\r\n}\r\n\r\nfunction isWidgetSelected( selection ) {\r\n\tconst viewElement = selection.getSelectedElement();\r\n\r\n\treturn !!( viewElement && isWidget( viewElement ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/findlinkrange\r\n */\r\n\r\n/**\r\n * Returns a range containing the entire link in which the given `position` is placed.\r\n *\r\n * It can be used e.g. to get the entire range on which the `linkHref` attribute needs to be changed when having a\r\n * selection inside a link.\r\n *\r\n * @param {module:engine/model/position~Position} position The start position.\r\n * @param {String} value The `linkHref` attribute value.\r\n * @returns {module:engine/model/range~Range} The link range.\r\n */\r\nexport default function findLinkRange( position, value, model ) {\r\n\treturn model.createRange( _findBound( position, value, true, model ), _findBound( position, value, false, model ) );\r\n}\r\n\r\n// Walks forward or backward (depends on the `lookBack` flag), node by node, as long as they have the same `linkHref` attribute value\r\n// and returns a position just before or after (depends on the `lookBack` flag) the last matched node.\r\n//\r\n// @param {module:engine/model/position~Position} position The start position.\r\n// @param {String} value The `linkHref` attribute value.\r\n// @param {Boolean} lookBack Whether the walk direction is forward (`false`) or backward (`true`).\r\n// @returns {module:engine/model/position~Position} The position just before the last matched node.\r\nfunction _findBound( position, value, lookBack, model ) {\r\n\t// Get node before or after position (depends on `lookBack` flag).\r\n\t// When position is inside text node then start searching from text node.\r\n\tlet node = position.textNode || ( lookBack ? position.nodeBefore : position.nodeAfter );\r\n\r\n\tlet lastNode = null;\r\n\r\n\twhile ( node && node.getAttribute( 'linkHref' ) == value ) {\r\n\t\tlastNode = node;\r\n\t\tnode = lookBack ? node.previousSibling : node.nextSibling;\r\n\t}\r\n\r\n\treturn lastNode ? model.createPositionAt( lastNode, lookBack ? 'before' : 'after' ) : position;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/linkcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport findLinkRange from './findlinkrange';\r\nimport toMap from '@ckeditor/ckeditor5-utils/src/tomap';\r\n\r\n/**\r\n * The link command. It is used by the {@link module:link/link~Link link feature}.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class LinkCommand extends Command {\r\n\t/**\r\n\t * The value of the `'linkHref'` attribute if the start of the selection is located in a node with this attribute.\r\n\t *\r\n\t * @observable\r\n\t * @readonly\r\n\t * @member {Object|undefined} #value\r\n\t */\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tthis.value = doc.selection.getAttribute( 'linkHref' );\r\n\t\tthis.isEnabled = model.schema.checkAttributeInSelection( doc.selection, 'linkHref' );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * When the selection is non-collapsed, the `linkHref` attribute will be applied to nodes inside the selection, but only to\r\n\t * those nodes where the `linkHref` attribute is allowed (disallowed nodes will be omitted).\r\n\t *\r\n\t * When the selection is collapsed and is not inside the text with the `linkHref` attribute, the\r\n\t * new {@link module:engine/model/text~Text Text node} with the `linkHref` attribute will be inserted in place of caret, but\r\n\t * only if such element is allowed in this place. The `_data` of the inserted text will equal the `href` parameter.\r\n\t * The selection will be updated to wrap the just inserted text node.\r\n\t *\r\n\t * When the selection is collapsed and inside the text with the `linkHref` attribute, the attribute value will be updated.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {String} href Link destination.\r\n\t */\r\n\texecute( href ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// If selection is collapsed then update selected link or insert new one at the place of caret.\r\n\t\t\tif ( selection.isCollapsed ) {\r\n\t\t\t\tconst position = selection.getFirstPosition();\r\n\r\n\t\t\t\t// When selection is inside text with `linkHref` attribute.\r\n\t\t\t\tif ( selection.hasAttribute( 'linkHref' ) ) {\r\n\t\t\t\t\t// Then update `linkHref` value.\r\n\t\t\t\t\tconst linkRange = findLinkRange( selection.getFirstPosition(), selection.getAttribute( 'linkHref' ), model );\r\n\r\n\t\t\t\t\twriter.setAttribute( 'linkHref', href, linkRange );\r\n\r\n\t\t\t\t\t// Create new range wrapping changed link.\r\n\t\t\t\t\twriter.setSelection( linkRange );\r\n\t\t\t\t}\r\n\t\t\t\t// If not then insert text node with `linkHref` attribute in place of caret.\r\n\t\t\t\t// However, since selection in collapsed, attribute value will be used as data for text node.\r\n\t\t\t\t// So, if `href` is empty, do not create text node.\r\n\t\t\t\telse if ( href !== '' ) {\r\n\t\t\t\t\tconst attributes = toMap( selection.getAttributes() );\r\n\r\n\t\t\t\t\tattributes.set( 'linkHref', href );\r\n\r\n\t\t\t\t\tconst node = writer.createText( href, attributes );\r\n\r\n\t\t\t\t\twriter.insert( node, position );\r\n\r\n\t\t\t\t\t// Create new range wrapping created node.\r\n\t\t\t\t\twriter.setSelection( writer.createRangeOn( node ) );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// If selection has non-collapsed ranges, we change attribute on nodes inside those ranges\r\n\t\t\t\t// omitting nodes where `linkHref` attribute is disallowed.\r\n\t\t\t\tconst ranges = model.schema.getValidRanges( selection.getRanges(), 'linkHref' );\r\n\r\n\t\t\t\tfor ( const range of ranges ) {\r\n\t\t\t\t\twriter.setAttribute( 'linkHref', href, range );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/unlinkcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport findLinkRange from './findlinkrange';\r\n\r\n/**\r\n * The unlink command. It is used by the {@link module:link/link~Link link plugin}.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class UnlinkCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = this.editor.model.document.selection.hasAttribute( 'linkHref' );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * When the selection is collapsed, removes the `linkHref` attribute from each node with the same `linkHref` attribute value.\r\n\t * When the selection is non-collapsed, removes the `linkHref` attribute from each node in selected ranges.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// Get ranges to unlink.\r\n\t\t\tconst rangesToUnlink = selection.isCollapsed ?\r\n\t\t\t\t[ findLinkRange( selection.getFirstPosition(), selection.getAttribute( 'linkHref' ), model ) ] : selection.getRanges();\r\n\r\n\t\t\t// Remove `linkHref` attribute from specified ranges.\r\n\t\t\tfor ( const range of rangesToUnlink ) {\r\n\t\t\t\twriter.removeAttribute( 'linkHref', range );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/utils\r\n */\r\n\r\nconst linkElementSymbol = Symbol( 'linkElement' );\r\n\r\nconst ATTRIBUTE_WHITESPACES = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205f\\u3000]/g; // eslint-disable-line no-control-regex\r\nconst SAFE_URL = /^(?:(?:https?|ftps?|mailto):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))/i;\r\n\r\n/**\r\n * Returns `true` if a given view node is the link element.\r\n *\r\n * @param {module:engine/view/node~Node} node\r\n * @returns {Boolean}\r\n */\r\nexport function isLinkElement( node ) {\r\n\treturn node.is( 'attributeElement' ) && !!node.getCustomProperty( linkElementSymbol );\r\n}\r\n\r\n/**\r\n * Creates link {@link module:engine/view/attributeelement~AttributeElement} with provided `href` attribute.\r\n *\r\n * @param {String} href\r\n * @returns {module:engine/view/attributeelement~AttributeElement}\r\n */\r\nexport function createLinkElement( href, writer ) {\r\n\t// Priority 5 - https://github.com/ckeditor/ckeditor5-link/issues/121.\r\n\tconst linkElement = writer.createAttributeElement( 'a', { href }, { priority: 5 } );\r\n\twriter.setCustomProperty( linkElementSymbol, true, linkElement );\r\n\r\n\treturn linkElement;\r\n}\r\n\r\n/**\r\n * Returns a safe URL based on a given value.\r\n *\r\n * An URL is considered safe if it is safe for the user (does not contain any malicious code).\r\n *\r\n * If URL is considered unsafe, a simple `\"#\"` is returned.\r\n *\r\n * @protected\r\n * @param {*} url\r\n * @returns {String} Safe URL.\r\n */\r\nexport function ensureSafeUrl( url ) {\r\n\turl = String( url );\r\n\r\n\treturn isSafeUrl( url ) ? url : '#';\r\n}\r\n\r\n// Checks whether the given URL is safe for the user (does not contain any malicious code).\r\n//\r\n// @param {String} url URL to check.\r\nfunction isSafeUrl( url ) {\r\n\tconst normalizedUrl = url.replace( ATTRIBUTE_WHITESPACES, '' );\r\n\r\n\treturn normalizedUrl.match( SAFE_URL );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/utils/bindtwostepcarettoattribute\r\n */\r\n\r\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\r\nimport priorities from '@ckeditor/ckeditor5-utils/src/priorities';\r\n\r\n/**\r\n * This helper enabled the two-step caret (phantom) movement behavior for the given {@link module:engine/model/model~Model}\r\n * attribute on arrow right (<kbd>→</kbd>) and left (<kbd>←</kbd>) key press.\r\n *\r\n * Thanks to this (phantom) caret movement the user is able to type before/after as well as at the\r\n * beginning/end of an attribute.\r\n *\r\n * # Forward movement\r\n *\r\n * ## \"Entering\" an attribute:\r\n *\r\n * When this behavior is enabled for the `a` attribute and the selection is right before it\r\n * (at the attribute boundary), pressing the right arrow key will not move the selection but update its\r\n * attributes accordingly:\r\n *\r\n * * When enabled:\r\n *\r\n *   \t\tfoo{}<$text a=\"true\">bar</$text>\r\n *\r\n *    <kbd>→</kbd>\r\n *\r\n *   \t\tfoo<$text a=\"true\">{}bar</$text>\r\n *\r\n * * When disabled:\r\n *\r\n *   \t\tfoo{}<$text a=\"true\">bar</$text>\r\n *\r\n *   <kbd>→</kbd>\r\n *\r\n *   \t\tfoo<$text a=\"true\">b{}ar</$text>\r\n *\r\n *\r\n * ## \"Leaving\" an attribute:\r\n *\r\n * * When enabled:\r\n *\r\n *   \t\t<$text a=\"true\">bar{}</$text>baz\r\n *\r\n *    <kbd>→</kbd>\r\n *\r\n *   \t\t<$text a=\"true\">bar</$text>{}baz\r\n *\r\n * * When disabled:\r\n *\r\n *   \t\t<$text a=\"true\">bar{}</$text>baz\r\n *\r\n *   <kbd>→</kbd>\r\n *\r\n *   \t\t<$text a=\"true\">bar</$text>b{}az\r\n *\r\n * # Backward movement\r\n *\r\n * * When enabled:\r\n *\r\n *   \t\t<$text a=\"true\">bar</$text>{}baz\r\n *\r\n *    <kbd>←</kbd>\r\n *\r\n *   \t\t<$text a=\"true\">bar{}</$text>baz\r\n *\r\n * * When disabled:\r\n *\r\n *   \t\t<$text a=\"true\">bar</$text>{}baz\r\n *\r\n *   <kbd>←</kbd>\r\n *\r\n *   \t\t<$text a=\"true\">ba{}r</$text>b{}az\r\n *\r\n * @param {module:engine/view/view~View} view View controller instance.\r\n * @param {module:engine/model/model~Model} model Data model instance.\r\n * @param {module:utils/dom/emittermixin~Emitter} emitter The emitter to which this behavior should be added\r\n * (e.g. a plugin instance).\r\n * @param {String} attribute Attribute for which this behavior will be added.\r\n */\r\nexport default function bindTwoStepCaretToAttribute( view, model, emitter, attribute ) {\r\n\tconst twoStepCaretHandler = new TwoStepCaretHandler( model, emitter, attribute );\r\n\tconst modelSelection = model.document.selection;\r\n\r\n\t// Listen to keyboard events and handle the caret movement according to the 2-step caret logic.\r\n\t//\r\n\t// Note: This listener has the \"high+1\" priority:\r\n\t// * \"high\" because of the filler logic implemented in the renderer which also engages on #keydown.\r\n\t// When the gravity is overridden the attributes of the (model) selection attributes are reset.\r\n\t// It may end up with the filler kicking in and breaking the selection.\r\n\t// * \"+1\" because we would like to avoid collisions with other features (like Widgets), which\r\n\t// take over the keydown events with the \"high\" priority. Two-step caret movement takes precedence\r\n\t// over Widgets in that matter.\r\n\t//\r\n\t// Find out more in https://github.com/ckeditor/ckeditor5-engine/issues/1301.\r\n\temitter.listenTo( view.document, 'keydown', ( evt, data ) => {\r\n\t\t// This implementation works only for collapsed selection.\r\n\t\tif ( !modelSelection.isCollapsed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// When user tries to expand the selection or jump over the whole word or to the beginning/end then\r\n\t\t// two-steps movement is not necessary.\r\n\t\tif ( data.shiftKey || data.altKey || data.ctrlKey ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst arrowRightPressed = data.keyCode == keyCodes.arrowright;\r\n\t\tconst arrowLeftPressed = data.keyCode == keyCodes.arrowleft;\r\n\r\n\t\t// When neither left or right arrow has been pressed then do noting.\r\n\t\tif ( !arrowRightPressed && !arrowLeftPressed ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst position = modelSelection.getFirstPosition();\r\n\t\tlet isMovementHandled;\r\n\r\n\t\tif ( arrowRightPressed ) {\r\n\t\t\tisMovementHandled = twoStepCaretHandler.handleForwardMovement( position, data );\r\n\t\t} else {\r\n\t\t\tisMovementHandled = twoStepCaretHandler.handleBackwardMovement( position, data );\r\n\t\t}\r\n\r\n\t\t// Stop the keydown event if the two-step arent movement handled it. Avoid collisions\r\n\t\t// with other features which may also take over the caret movement (e.g. Widget).\r\n\t\tif ( isMovementHandled ) {\r\n\t\t\tevt.stop();\r\n\t\t}\r\n\t}, { priority: priorities.get( 'high' ) + 1 } );\r\n}\r\n\r\n/**\r\n * This is a private helper–class for {@link module:engine/utils/bindtwostepcarettoattribute}.\r\n * It handles the state of the 2-step caret movement for a single {@link module:engine/model/model~Model}\r\n * attribute upon the `keypress` in the {@link module:engine/view/view~View}.\r\n *\r\n * @private\r\n */\r\nclass TwoStepCaretHandler {\r\n\t/*\r\n\t * Creates two step handler instance.\r\n\t *\r\n\t * @param {module:engine/model/model~Model} model Data model instance.\r\n\t * @param {module:utils/dom/emittermixin~Emitter} emitter The emitter to which this behavior should be added\r\n\t * (e.g. a plugin instance).\r\n\t * @param {String} attribute Attribute for which the behavior will be added.\r\n\t */\r\n\tconstructor( model, emitter, attribute ) {\r\n\t\t/**\r\n\t\t * The model instance this class instance operates on.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/model~Model#schema}\r\n\t\t */\r\n\t\tthis.model = model;\r\n\r\n\t\t/**\r\n\t\t * The Attribute this class instance operates on.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.attribute = attribute;\r\n\r\n\t\t/**\r\n\t\t * A reference to the document selection.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/selection~Selection}\r\n\t\t */\r\n\t\tthis._modelSelection = model.document.selection;\r\n\r\n\t\t/**\r\n\t\t * The current UID of the overridden gravity, as returned by\r\n\t\t * {@link module:engine/model/writer~Writer#overrideSelectionGravity}.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis._overrideUid = null;\r\n\r\n\t\t/**\r\n\t\t * A flag indicating that the automatic gravity restoration for this attribute\r\n\t\t * should not happen upon the next\r\n\t\t * {@link module:engine/model/selection~Selection#event:change:range} event.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis._isNextGravityRestorationSkipped = false;\r\n\r\n\t\t// The automatic gravity restoration logic.\r\n\t\temitter.listenTo( this._modelSelection, 'change:range', ( evt, data ) => {\r\n\t\t\t// Skipping the automatic restoration is needed if the selection should change\r\n\t\t\t// but the gravity must remain overridden afterwards. See the #handleBackwardMovement\r\n\t\t\t// to learn more.\r\n\t\t\tif ( this._isNextGravityRestorationSkipped ) {\r\n\t\t\t\tthis._isNextGravityRestorationSkipped = false;\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Skip automatic restore when the gravity is not overridden — simply, there's nothing to restore\r\n\t\t\t// at this moment.\r\n\t\t\tif ( !this._isGravityOverridden ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Skip automatic restore when the change is indirect AND the selection is at the attribute boundary.\r\n\t\t\t// It means that e.g. if the change was external (collaboration) and the user had their\r\n\t\t\t// selection around the link, its gravity should remain intact in this change:range event.\r\n\t\t\tif ( !data.directChange && isAtBoundary( this._modelSelection.getFirstPosition(), attribute ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._restoreGravity();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the document selection and the view according to the two–step caret movement state\r\n\t * when moving **forwards**. Executed upon `keypress` in the {@link module:engine/view/view~View}.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position The model position at the moment of the key press.\r\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} data Data of the key press.\r\n\t * @returns {Boolean} `true` when the handler prevented caret movement\r\n\t */\r\n\thandleForwardMovement( position, data ) {\r\n\t\tconst attribute = this.attribute;\r\n\r\n\t\t// DON'T ENGAGE 2-SCM if gravity is already overridden. It means that we just entered\r\n\t\t//\r\n\t\t// \t\t<paragraph>foo<$text attribute>{}bar</$text>baz</paragraph>\r\n\t\t//\r\n\t\t// or left the attribute\r\n\t\t//\r\n\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>{}baz</paragraph>\r\n\t\t//\r\n\t\t// and the gravity will be restored automatically.\r\n\t\tif ( this._isGravityOverridden ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// DON'T ENGAGE 2-SCM when the selection is at the beginning of the block AND already has the\r\n\t\t// attribute:\r\n\t\t// * when the selection was initially set there using the mouse,\r\n\t\t// * when the editor has just started\r\n\t\t//\r\n\t\t//\t\t<paragraph><$text attribute>{}bar</$text>baz</paragraph>\r\n\t\t//\r\n\t\tif ( position.isAtStart && this._hasSelectionAttribute ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// ENGAGE 2-SCM when about to leave one attribute value and enter another:\r\n\t\t//\r\n\t\t// \t\t<paragraph><$text attribute=\"1\">foo{}</$text><$text attribute=\"2\">bar</$text></paragraph>\r\n\t\t//\r\n\t\t// but DON'T when already in between of them (no attribute selection):\r\n\t\t//\r\n\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\r\n\t\t//\r\n\t\tif ( isBetweenDifferentValues( position, attribute ) && this._hasSelectionAttribute ) {\r\n\t\t\tthis._preventCaretMovement( data );\r\n\t\t\tthis._removeSelectionAttribute();\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ENGAGE 2-SCM when entering an attribute:\r\n\t\t//\r\n\t\t// \t\t<paragraph>foo{}<$text attribute>bar</$text>baz</paragraph>\r\n\t\t//\r\n\t\tif ( isAtStartBoundary( position, attribute ) ) {\r\n\t\t\tthis._preventCaretMovement( data );\r\n\t\t\tthis._overrideGravity();\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ENGAGE 2-SCM when leaving an attribute:\r\n\t\t//\r\n\t\t//\t\t<paragraph>foo<$text attribute>bar{}</$text>baz</paragraph>\r\n\t\t//\r\n\t\tif ( isAtEndBoundary( position, attribute ) && this._hasSelectionAttribute ) {\r\n\t\t\tthis._preventCaretMovement( data );\r\n\t\t\tthis._overrideGravity();\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the document selection and the view according to the two–step caret movement state\r\n\t * when moving **backwards**. Executed upon `keypress` in the {@link module:engine/view/view~View}.\r\n\t *\r\n\t * @param {module:engine/model/position~Position} position The model position at the moment of the key press.\r\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} data Data of the key press.\r\n\t * @returns {Boolean} `true` when the handler prevented caret movement\r\n\t */\r\n\thandleBackwardMovement( position, data ) {\r\n\t\tconst attribute = this.attribute;\r\n\r\n\t\t// When the gravity is already overridden...\r\n\t\tif ( this._isGravityOverridden ) {\r\n\t\t\t// ENGAGE 2-SCM & REMOVE SELECTION ATTRIBUTE\r\n\t\t\t// when about to leave one attribute value and enter another:\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text><$text attribute=\"2\">{}bar</$text></paragraph>\r\n\t\t\t//\r\n\t\t\t// but DON'T when already in between of them (no attribute selection):\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\r\n\t\t\t//\r\n\t\t\tif ( isBetweenDifferentValues( position, attribute ) && this._hasSelectionAttribute ) {\r\n\t\t\t\tthis._preventCaretMovement( data );\r\n\t\t\t\tthis._restoreGravity();\r\n\t\t\t\tthis._removeSelectionAttribute();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// ENGAGE 2-SCM when at any boundary of the attribute:\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>{}baz</paragraph>\r\n\t\t\t// \t\t<paragraph>foo<$text attribute>{}bar</$text>baz</paragraph>\r\n\t\t\t//\r\n\t\t\telse {\r\n\t\t\t\tthis._preventCaretMovement( data );\r\n\t\t\t\tthis._restoreGravity();\r\n\r\n\t\t\t\t// REMOVE SELECTION ATRIBUTE at the beginning of the block.\r\n\t\t\t\t// It's like restoring gravity but towards a non-existent content when\r\n\t\t\t\t// the gravity is overridden:\r\n\t\t\t\t//\r\n\t\t\t\t// \t\t<paragraph><$text attribute>{}bar</$text></paragraph>\r\n\t\t\t\t//\r\n\t\t\t\t// becomes:\r\n\t\t\t\t//\r\n\t\t\t\t// \t\t<paragraph>{}<$text attribute>bar</$text></paragraph>\r\n\t\t\t\t//\r\n\t\t\t\tif ( position.isAtStart ) {\r\n\t\t\t\t\tthis._removeSelectionAttribute();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// ENGAGE 2-SCM when between two different attribute values but selection has no attribute:\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\r\n\t\t\t//\r\n\t\t\tif ( isBetweenDifferentValues( position, attribute ) && !this._hasSelectionAttribute ) {\r\n\t\t\t\tthis._preventCaretMovement( data );\r\n\t\t\t\tthis._setSelectionAttributeFromTheNodeBefore( position );\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// End of block boundary cases:\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph><$text attribute>bar{}</$text></paragraph>\r\n\t\t\t// \t\t<paragraph><$text attribute>bar</$text>{}</paragraph>\r\n\t\t\t//\r\n\t\t\tif ( position.isAtEnd && isAtEndBoundary( position, attribute ) ) {\r\n\t\t\t\t// DON'T ENGAGE 2-SCM if the selection has the attribute already.\r\n\t\t\t\t// This is a common selection if set using the mouse.\r\n\t\t\t\t//\r\n\t\t\t\t// \t\t<paragraph><$text attribute>bar{}</$text></paragraph>\r\n\t\t\t\t//\r\n\t\t\t\tif ( this._hasSelectionAttribute ) {\r\n\t\t\t\t\t// DON'T ENGAGE 2-SCM if the attribute at the end of the block which has length == 1.\r\n\t\t\t\t\t// Make sure the selection will not the attribute after it moves backwards.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// \t\t<paragraph>foo<$text attribute>b{}</$text></paragraph>\r\n\t\t\t\t\t//\r\n\t\t\t\t\tif ( isStepAfterTheAttributeBoundary( position, attribute ) ) {\r\n\t\t\t\t\t\t// Skip the automatic gravity restore upon the next selection#change:range event.\r\n\t\t\t\t\t\t// If not skipped, it would automatically restore the gravity, which should remain\r\n\t\t\t\t\t\t// overridden.\r\n\t\t\t\t\t\tthis._skipNextAutomaticGravityRestoration();\r\n\t\t\t\t\t\tthis._overrideGravity();\r\n\r\n\t\t\t\t\t\t// Don't return \"true\" here because we didn't call _preventCaretMovement.\r\n\t\t\t\t\t\t// Returning here will destabilize the filler logic, which also listens to\r\n\t\t\t\t\t\t// keydown (and the event would be stopped).\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// ENGAGE 2-SCM if the selection has no attribute. This may happen when the user\r\n\t\t\t\t// left the attribute using a FORWARD 2-SCM.\r\n\t\t\t\t//\r\n\t\t\t\t// \t\t<paragraph><$text attribute>bar</$text>{}</paragraph>\r\n\t\t\t\t//\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._preventCaretMovement( data );\r\n\t\t\t\t\tthis._setSelectionAttributeFromTheNodeBefore( position );\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// REMOVE SELECTION ATRIBUTE when restoring gravity towards a non-existent content at the\r\n\t\t\t// beginning of the block.\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph>{}<$text attribute>bar</$text></paragraph>\r\n\t\t\t//\r\n\t\t\tif ( position.isAtStart ) {\r\n\t\t\t\tif ( this._hasSelectionAttribute ) {\r\n\t\t\t\t\tthis._removeSelectionAttribute();\r\n\t\t\t\t\tthis._preventCaretMovement( data );\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// DON'T ENGAGE 2-SCM when about to enter of leave an attribute.\r\n\t\t\t// We need to check if the caret is a one position before the attribute boundary:\r\n\t\t\t//\r\n\t\t\t// \t\t<paragraph>foo<$text attribute>b{}ar</$text>baz</paragraph>\r\n\t\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>b{}az</paragraph>\r\n\t\t\t//\r\n\t\t\tif ( isStepAfterTheAttributeBoundary( position, attribute ) ) {\r\n\t\t\t\t// Skip the automatic gravity restore upon the next selection#change:range event.\r\n\t\t\t\t// If not skipped, it would automatically restore the gravity, which should remain\r\n\t\t\t\t// overridden.\r\n\t\t\t\tthis._skipNextAutomaticGravityRestoration();\r\n\t\t\t\tthis._overrideGravity();\r\n\r\n\t\t\t\t// Don't return \"true\" here because we didn't call _preventCaretMovement.\r\n\t\t\t\t// Returning here will destabilize the filler logic, which also listens to\r\n\t\t\t\t// keydown (and the event would be stopped).\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * `true` when the gravity is overridden for the {@link #attribute}.\r\n\t *\r\n\t * @readonly\r\n\t * @private\r\n\t * @type {Boolean}\r\n\t */\r\n\tget _isGravityOverridden() {\r\n\t\treturn !!this._overrideUid;\r\n\t}\r\n\r\n\t/**\r\n\t * `true` when the {@link module:engine/model/selection~Selection} has the {@link #attribute}.\r\n\t *\r\n\t * @readonly\r\n\t * @private\r\n\t * @type {Boolean}\r\n\t */\r\n\tget _hasSelectionAttribute() {\r\n\t\treturn this._modelSelection.hasAttribute( this.attribute );\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides the gravity using the {@link module:engine/model/writer~Writer model writer}\r\n\t * and stores the information about this fact in the {@link #_overrideUid}.\r\n\t *\r\n\t * A shorthand for {@link module:engine/model/writer~Writer#overrideSelectionGravity}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_overrideGravity() {\r\n\t\tthis._overrideUid = this.model.change( writer => writer.overrideSelectionGravity() );\r\n\t}\r\n\r\n\t/**\r\n\t * Restores the gravity using the {@link module:engine/model/writer~Writer model writer}.\r\n\t *\r\n\t * A shorthand for {@link module:engine/model/writer~Writer#restoreSelectionGravity}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_restoreGravity() {\r\n\t\tthis.model.change( writer => {\r\n\t\t\twriter.restoreSelectionGravity( this._overrideUid );\r\n\t\t\tthis._overrideUid = null;\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Prevents the caret movement in the view by calling `preventDefault` on the event data.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_preventCaretMovement( data ) {\r\n\t\tdata.preventDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the {@link #attribute} from the selection using using the\r\n\t * {@link module:engine/model/writer~Writer model writer}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_removeSelectionAttribute() {\r\n\t\tthis.model.change( writer => {\r\n\t\t\twriter.removeSelectionAttribute( this.attribute );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Applies the {@link #attribute} to the current selection using using the\r\n\t * value from the node before the current position. Uses\r\n\t * the {@link module:engine/model/writer~Writer model writer}.\r\n\t *\r\n\t * @private\r\n\t * @param {module:engine/model/position~Position} position\r\n\t */\r\n\t_setSelectionAttributeFromTheNodeBefore( position ) {\r\n\t\tconst attribute = this.attribute;\r\n\r\n\t\tthis.model.change( writer => {\r\n\t\t\twriter.setSelectionAttribute( this.attribute, position.nodeBefore.getAttribute( attribute ) );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Skips the next automatic selection gravity restoration upon the\r\n\t * {@link module:engine/model/selection~Selection#event:change:range} event.\r\n\t *\r\n\t * See {@link #_isNextGravityRestorationSkipped}.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_skipNextAutomaticGravityRestoration() {\r\n\t\tthis._isNextGravityRestorationSkipped = true;\r\n\t}\r\n}\r\n\r\n// @param {module:engine/model/position~Position} position\r\n// @param {String} attribute\r\n// @returns {Boolean} `true` when position between the nodes sticks to the bound of text with given attribute.\r\nfunction isAtBoundary( position, attribute ) {\r\n\treturn isAtStartBoundary( position, attribute ) || isAtEndBoundary( position, attribute );\r\n}\r\n\r\n// @param {module:engine/model/position~Position} position\r\n// @param {String} attribute\r\nfunction isAtStartBoundary( position, attribute ) {\r\n\tconst { nodeBefore, nodeAfter } = position;\r\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\r\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\r\n\r\n\treturn isAttrAfter && ( !isAttrBefore || nodeBefore.getAttribute( attribute ) !== nodeAfter.getAttribute( attribute ) );\r\n}\r\n\r\n// @param {module:engine/model/position~Position} position\r\n// @param {String} attribute\r\nfunction isAtEndBoundary( position, attribute ) {\r\n\tconst { nodeBefore, nodeAfter } = position;\r\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\r\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\r\n\r\n\treturn isAttrBefore && ( !isAttrAfter || nodeBefore.getAttribute( attribute ) !== nodeAfter.getAttribute( attribute ) );\r\n}\r\n\r\n// @param {module:engine/model/position~Position} position\r\n// @param {String} attribute\r\nfunction isBetweenDifferentValues( position, attribute ) {\r\n\tconst { nodeBefore, nodeAfter } = position;\r\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\r\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\r\n\r\n\tif ( !isAttrAfter || !isAttrBefore ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn nodeAfter.getAttribute( attribute ) !== nodeBefore.getAttribute( attribute );\r\n}\r\n\r\n// @param {module:engine/model/position~Position} position\r\n// @param {String} attribute\r\nfunction isStepAfterTheAttributeBoundary( position, attribute ) {\r\n\treturn isAtBoundary( position.getShiftedBy( -1 ), attribute );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/linkediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport { downcastAttributeToElement } from '@ckeditor/ckeditor5-engine/src/conversion/downcast-converters';\r\nimport { upcastElementToAttribute } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\r\nimport LinkCommand from './linkcommand';\r\nimport UnlinkCommand from './unlinkcommand';\r\nimport { createLinkElement, ensureSafeUrl } from './utils';\r\nimport bindTwoStepCaretToAttribute from '@ckeditor/ckeditor5-engine/src/utils/bindtwostepcarettoattribute';\r\nimport findLinkRange from './findlinkrange';\r\nimport '../theme/link.css';\r\n\r\nconst HIGHLIGHT_CLASS = 'ck-link_selected';\r\n\r\n/**\r\n * The link engine feature.\r\n *\r\n * It introduces the `linkHref=\"url\"` attribute in the model which renders to the view as a `<a href=\"url\">` element\r\n * as well as `'link'` and `'unlink'` commands.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class LinkEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// Allow link attribute on all inline nodes.\r\n\t\teditor.model.schema.extend( '$text', { allowAttributes: 'linkHref' } );\r\n\r\n\t\teditor.conversion.for( 'dataDowncast' )\r\n\t\t\t.add( downcastAttributeToElement( { model: 'linkHref', view: createLinkElement } ) );\r\n\r\n\t\teditor.conversion.for( 'editingDowncast' )\r\n\t\t\t.add( downcastAttributeToElement( { model: 'linkHref', view: ( href, writer ) => {\r\n\t\t\t\treturn createLinkElement( ensureSafeUrl( href ), writer );\r\n\t\t\t} } ) );\r\n\r\n\t\teditor.conversion.for( 'upcast' )\r\n\t\t\t.add( upcastElementToAttribute( {\r\n\t\t\t\tview: {\r\n\t\t\t\t\tname: 'a',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\thref: true\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tmodel: {\r\n\t\t\t\t\tkey: 'linkHref',\r\n\t\t\t\t\tvalue: viewElement => viewElement.getAttribute( 'href' )\r\n\t\t\t\t}\r\n\t\t\t} ) );\r\n\r\n\t\t// Create linking commands.\r\n\t\teditor.commands.add( 'link', new LinkCommand( editor ) );\r\n\t\teditor.commands.add( 'unlink', new UnlinkCommand( editor ) );\r\n\r\n\t\t// Enable two-step caret movement for `linkHref` attribute.\r\n\t\tbindTwoStepCaretToAttribute( editor.editing.view, editor.model, this, 'linkHref' );\r\n\r\n\t\t// Setup highlight over selected link.\r\n\t\tthis._setupLinkHighlight();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a visual highlight style to a link in which the selection is anchored.\r\n\t * Together with two-step caret movement, they indicate that the user is typing inside the link.\r\n\t *\r\n\t * Highlight is turned on by adding `.ck-link_selected` class to the link in the view:\r\n\t *\r\n\t * * the class is removed before conversion has started, as callbacks added with `'highest'` priority\r\n\t * to {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher} events,\r\n\t * * the class is added in the view post fixer, after other changes in the model tree were converted to the view.\r\n\t *\r\n\t * This way, adding and removing highlight does not interfere with conversion.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_setupLinkHighlight() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst view = editor.editing.view;\r\n\t\tconst highlightedLinks = new Set();\r\n\r\n\t\t// Adding the class.\r\n\t\tview.document.registerPostFixer( writer => {\r\n\t\t\tconst selection = editor.model.document.selection;\r\n\r\n\t\t\tif ( selection.hasAttribute( 'linkHref' ) ) {\r\n\t\t\t\tconst modelRange = findLinkRange( selection.getFirstPosition(), selection.getAttribute( 'linkHref' ), editor.model );\r\n\t\t\t\tconst viewRange = editor.editing.mapper.toViewRange( modelRange );\r\n\r\n\t\t\t\t// There might be multiple `a` elements in the `viewRange`, for example, when the `a` element is\r\n\t\t\t\t// broken by a UIElement.\r\n\t\t\t\tfor ( const item of viewRange.getItems() ) {\r\n\t\t\t\t\tif ( item.is( 'a' ) ) {\r\n\t\t\t\t\t\twriter.addClass( HIGHLIGHT_CLASS, item );\r\n\t\t\t\t\t\thighlightedLinks.add( item );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Removing the class.\r\n\t\teditor.conversion.for( 'editingDowncast' ).add( dispatcher => {\r\n\t\t\t// Make sure the highlight is removed on every possible event, before conversion is started.\r\n\t\t\tdispatcher.on( 'insert', removeHighlight, { priority: 'highest' } );\r\n\t\t\tdispatcher.on( 'remove', removeHighlight, { priority: 'highest' } );\r\n\t\t\tdispatcher.on( 'attribute', removeHighlight, { priority: 'highest' } );\r\n\t\t\tdispatcher.on( 'selection', removeHighlight, { priority: 'highest' } );\r\n\r\n\t\t\tfunction removeHighlight() {\r\n\t\t\t\tview.change( writer => {\r\n\t\t\t\t\tfor ( const item of highlightedLinks.values() ) {\r\n\t\t\t\t\t\twriter.removeClass( HIGHLIGHT_CLASS, item );\r\n\t\t\t\t\t\thighlightedLinks.delete( item );\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","\r\n/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module engine/view/observer/clickobserver\r\n */\r\n\r\nimport DomEventObserver from './domeventobserver';\r\n\r\n/**\r\n * {@link module:engine/view/document~Document#event:click Click} event observer.\r\n *\r\n * Note that this observer is not available by default. To make it available it needs to be added to\r\n * {@link module:engine/view/view~View view controller}\r\n * by a {@link module:engine/view/view~View#addObserver} method.\r\n *\r\n * @extends module:engine/view/observer/domeventobserver~DomEventObserver\r\n */\r\nexport default class ClickObserver extends DomEventObserver {\r\n\tconstructor( view ) {\r\n\t\tsuper( view );\r\n\r\n\t\tthis.domEventType = 'click';\r\n\t}\r\n\r\n\tonDomEvent( domEvent ) {\r\n\t\tthis.fire( domEvent.type, domEvent );\r\n\t}\r\n}\r\n\r\n/**\r\n * Fired when one of the editables has been clicked.\r\n *\r\n * Introduced by {@link module:engine/view/observer/clickobserver~ClickObserver}.\r\n *\r\n * Note that this event is not available by default. To make it available\r\n * {@link module:engine/view/observer/clickobserver~ClickObserver} needs to be added\r\n * to {@link module:engine/view/view~View} by a {@link module:engine/view/view~View#addObserver} method.\r\n *\r\n * @see module:engine/view/observer/clickobserver~ClickObserver\r\n * @event module:engine/view/document~Document#event:click\r\n * @param {module:engine/view/observer/domeventdata~DomEventData} data Event data.\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module link/ui/linkformview\r\n */\nimport View from '@ckeditor/ckeditor5-ui/src/view';\nimport ViewCollection from '@ckeditor/ckeditor5-ui/src/viewcollection';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport LabeledInputView from '@ckeditor/ckeditor5-ui/src/labeledinput/labeledinputview';\nimport InputTextView from '@ckeditor/ckeditor5-ui/src/inputtext/inputtextview';\nimport submitHandler from '@ckeditor/ckeditor5-ui/src/bindings/submithandler';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '@ckeditor/ckeditor5-ui/src/focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport checkIcon from '@ckeditor/ckeditor5-core/theme/icons/check.svg';\nimport cancelIcon from '@ckeditor/ckeditor5-core/theme/icons/cancel.svg';\nimport '../../theme/linkform.css';\n/**\r\n * The link form view controller class.\r\n *\r\n * See {@link module:link/ui/linkformview~LinkFormView}.\r\n *\r\n * @extends module:ui/view~View\r\n */\nexport default class LinkFormView extends View {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    constructor(locale) {\n        super(locale);\n        const t = locale.t;\n        /**\r\n\t\t * Tracks information about DOM focus in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\n        this.focusTracker = new FocusTracker();\n        /**\r\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\n        this.keystrokes = new KeystrokeHandler();\n        /**\r\n\t\t * The URL input view.\r\n\t\t *\r\n\t\t * @member {module:ui/labeledinput/labeledinputview~LabeledInputView}\r\n\t\t */\n        this.urlInputView = this._createUrlInput();\n        /**\r\n\t\t * The Save button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.saveButtonView = this._createButton(t('bd'), checkIcon, 'ck-button-save');\n        this.saveButtonView.type = 'submit';\n        /**\r\n\t\t * The Cancel button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.cancelButtonView = this._createButton(t('be'), cancelIcon, 'ck-button-cancel', 'cancel');\n        /**\r\n\t\t * A collection of views which can be focused in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this._focusables = new ViewCollection();\n        /**\r\n\t\t * Helps cycling over {@link #_focusables} in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-link-form'\n                ],\n                // https://github.com/ckeditor/ckeditor5-link/issues/90\n                tabindex: '-1'\n            },\n            children: [\n                this.urlInputView,\n                this.saveButtonView,\n                this.cancelButtonView\n            ]\n        });\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    render() {\n        super.render();\n        submitHandler({ view: this });\n        const childViews = [\n            this.urlInputView,\n            this.saveButtonView,\n            this.cancelButtonView\n        ];\n        childViews.forEach(v => {\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n        // Start listening for the keystrokes coming from #element.\n        this.keystrokes.listenTo(this.element);\n    }\n    /**\r\n\t * Focuses the fist {@link #_focusables} in the form.\r\n\t */\n    focus() {\n        this._focusCycler.focusFirst();\n    }\n    /**\r\n\t * Creates a labeled input view.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/labeledinput/labeledinputview~LabeledInputView} Labeled input view instance.\r\n\t */\n    _createUrlInput() {\n        const t = this.locale.t;\n        const labeledInput = new LabeledInputView(this.locale, InputTextView);\n        labeledInput.label = t('bg');\n        labeledInput.inputView.placeholder = 'https://example.com';\n        return labeledInput;\n    }\n    /**\r\n\t * Creates a button view.\r\n\t *\r\n\t * @private\r\n\t * @param {String} label The button label.\r\n\t * @param {String} icon The button's icon.\r\n\t * @param {String} className The additional button CSS class name.\r\n\t * @param {String} [eventName] An event name that the `ButtonView#execute` event will be delegated to.\r\n\t * @returns {module:ui/button/buttonview~ButtonView} The button view instance.\r\n\t */\n    _createButton(label, icon, className, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.extendTemplate({ attributes: { class: className } });\n        if (eventName) {\n            button.delegate('execute').to(this, eventName);\n        }\n        return button;\n    }\n}    /**\r\n * Fired when the form view is submitted (when one of the children triggered the submit event),\r\n * e.g. click on {@link #saveButtonView}.\r\n *\r\n * @event submit\r\n */\n     /**\r\n * Fired when the form view is canceled, e.g. click on {@link #cancelButtonView}.\r\n *\r\n * @event cancel\r\n */","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module link/ui/linkactionsview\r\n */\nimport View from '@ckeditor/ckeditor5-ui/src/view';\nimport ViewCollection from '@ckeditor/ckeditor5-ui/src/viewcollection';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '@ckeditor/ckeditor5-ui/src/focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport { ensureSafeUrl } from '../utils';\nimport unlinkIcon from '../../theme/icons/unlink.svg';\nimport pencilIcon from '@ckeditor/ckeditor5-core/theme/icons/pencil.svg';\nimport '../../theme/linkactions.css';\n/**\r\n * The link actions view class. This view displays link preview, allows\r\n * unlinking or editing the link.\r\n *\r\n * @extends module:ui/view~View\r\n */\nexport default class LinkActionsView extends View {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    constructor(locale) {\n        super(locale);\n        const t = locale.t;\n        /**\r\n\t\t * Tracks information about DOM focus in the actions.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\n        this.focusTracker = new FocusTracker();\n        /**\r\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\n        this.keystrokes = new KeystrokeHandler();\n        /**\r\n\t\t * The href preview view.\r\n\t\t *\r\n\t\t * @member {module:ui/view~View}\r\n\t\t */\n        this.previewButtonView = this._createPreviewButton();\n        /**\r\n\t\t * The unlink button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.unlinkButtonView = this._createButton(t('bh'), unlinkIcon, 'unlink');\n        /**\r\n\t\t * The edit link button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.editButtonView = this._createButton(t('bi'), pencilIcon, 'edit');\n        /**\r\n\t\t * Value of the \"href\" attribute of the link to use in the {@link #previewButtonView}.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String}\r\n\t\t */\n        this.set('href');\n        /**\r\n\t\t * A collection of views which can be focused in the view.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this._focusables = new ViewCollection();\n        /**\r\n\t\t * Helps cycling over {@link #_focusables} in the view.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        this.setTemplate({\n            tag: 'div',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-link-actions'\n                ],\n                // https://github.com/ckeditor/ckeditor5-link/issues/90\n                tabindex: '-1'\n            },\n            children: [\n                this.previewButtonView,\n                this.editButtonView,\n                this.unlinkButtonView\n            ]\n        });\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    render() {\n        super.render();\n        const childViews = [\n            this.previewButtonView,\n            this.editButtonView,\n            this.unlinkButtonView\n        ];\n        childViews.forEach(v => {\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n        // Start listening for the keystrokes coming from #element.\n        this.keystrokes.listenTo(this.element);\n    }\n    /**\r\n\t * Focuses the fist {@link #_focusables} in the actions.\r\n\t */\n    focus() {\n        this._focusCycler.focusFirst();\n    }\n    /**\r\n\t * Creates a button view.\r\n\t *\r\n\t * @private\r\n\t * @param {String} label The button label.\r\n\t * @param {String} icon The button's icon.\r\n\t * @param {String} [eventName] An event name that the `ButtonView#execute` event will be delegated to.\r\n\t * @returns {module:ui/button/buttonview~ButtonView} The button view instance.\r\n\t */\n    _createButton(label, icon, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.delegate('execute').to(this, eventName);\n        return button;\n    }\n    /**\r\n\t * Creates a link href preview button.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/button/buttonview~ButtonView} The button view instance.\r\n\t */\n    _createPreviewButton() {\n        const button = new ButtonView(this.locale);\n        const bind = this.bindTemplate;\n        const t = this.t;\n        button.set({\n            withText: true,\n            tooltip: t('bj')\n        });\n        button.extendTemplate({\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-link-actions__preview'\n                ],\n                href: bind.to('href', href => href && ensureSafeUrl(href)),\n                target: '_blank'\n            }\n        });\n        button.bind('label').to(this, 'href', href => {\n            return href || t('bk');\n        });\n        button.bind('isEnabled').to(this, 'href', href => !!href);\n        button.template.tag = 'a';\n        button.template.eventListeners = {};\n        return button;\n    }\n}    /**\r\n * Fired when the {@link #editButtonView} is clicked.\r\n *\r\n * @event edit\r\n */\n     /**\r\n * Fired when the {@link #unlinkButtonView} is clicked.\r\n *\r\n * @event unlink\r\n */","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module link/linkui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ClickObserver from '@ckeditor/ckeditor5-engine/src/view/observer/clickobserver';\nimport { isLinkElement } from './utils';\nimport ContextualBalloon from '@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon';\nimport clickOutsideHandler from '@ckeditor/ckeditor5-ui/src/bindings/clickoutsidehandler';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport LinkFormView from './ui/linkformview';\nimport LinkActionsView from './ui/linkactionsview';\nimport linkIcon from '../theme/icons/link.svg';\nconst linkKeystroke = 'Ctrl+K';\n/**\r\n * The link UI plugin. It introduces the `'link'` and `'unlink'` buttons and support for the <kbd>Ctrl+K</kbd> keystroke.\r\n *\r\n * It uses the\r\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon plugin}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class LinkUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [ContextualBalloon];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        editor.editing.view.addObserver(ClickObserver);\n        /**\r\n\t\t * The actions view displayed inside of the balloon.\r\n\t\t *\r\n\t\t * @member {module:link/ui/linkactionsview~LinkActionsView}\r\n\t\t */\n        this.actionsView = this._createActionsView();\n        /**\r\n\t\t * The form view displayed inside the balloon.\r\n\t\t *\r\n\t\t * @member {module:link/ui/linkformview~LinkFormView}\r\n\t\t */\n        this.formView = this._createFormView();\n        /**\r\n\t\t * The contextual balloon plugin instance.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\r\n\t\t */\n        this._balloon = editor.plugins.get(ContextualBalloon);\n        // Create toolbar buttons.\n        this._createToolbarLinkButton();\n        // Attach lifecycle actions to the the balloon.\n        this._enableUserBalloonInteractions();\n    }\n    /**\r\n\t * Creates the {@link module:link/ui/linkactionsview~LinkActionsView} instance.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:link/ui/linkactionsview~LinkActionsView} The link actions view instance.\r\n\t */\n    _createActionsView() {\n        const editor = this.editor;\n        const actionsView = new LinkActionsView(editor.locale);\n        const linkCommand = editor.commands.get('link');\n        const unlinkCommand = editor.commands.get('unlink');\n        actionsView.bind('href').to(linkCommand, 'value');\n        actionsView.editButtonView.bind('isEnabled').to(linkCommand);\n        actionsView.unlinkButtonView.bind('isEnabled').to(unlinkCommand);\n        // Execute unlink command after clicking on the \"Edit\" button.\n        this.listenTo(actionsView, 'edit', () => {\n            this._addFormView();\n        });\n        // Execute unlink command after clicking on the \"Unlink\" button.\n        this.listenTo(actionsView, 'unlink', () => {\n            editor.execute('unlink');\n            this._hideUI();\n        });\n        // Close the panel on esc key press when the **actions have focus**.\n        actionsView.keystrokes.set('Esc', (data, cancel) => {\n            this._hideUI();\n            cancel();\n        });\n        // Open the form view on Ctrl+K when the **actions have focus**..\n        actionsView.keystrokes.set(linkKeystroke, (data, cancel) => {\n            this._addFormView();\n            cancel();\n        });\n        return actionsView;\n    }\n    /**\r\n\t * Creates the {@link module:link/ui/linkformview~LinkFormView} instance.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:link/ui/linkformview~LinkFormView} The link form instance.\r\n\t */\n    _createFormView() {\n        const editor = this.editor;\n        const formView = new LinkFormView(editor.locale);\n        const linkCommand = editor.commands.get('link');\n        formView.urlInputView.bind('value').to(linkCommand, 'value');\n        // Form elements should be read-only when corresponding commands are disabled.\n        formView.urlInputView.bind('isReadOnly').to(linkCommand, 'isEnabled', value => !value);\n        formView.saveButtonView.bind('isEnabled').to(linkCommand);\n        // Execute link command after clicking the \"Save\" button.\n        this.listenTo(formView, 'submit', () => {\n            editor.execute('link', formView.urlInputView.inputView.element.value);\n            this._removeFormView();\n        });\n        // Hide the panel after clicking the \"Cancel\" button.\n        this.listenTo(formView, 'cancel', () => {\n            this._removeFormView();\n        });\n        // Close the panel on esc key press when the **form has focus**.\n        formView.keystrokes.set('Esc', (data, cancel) => {\n            this._removeFormView();\n            cancel();\n        });\n        return formView;\n    }\n    /**\r\n\t * Creates a toolbar Link button. Clicking this button will show\r\n\t * a {@link #_balloon} attached to the selection.\r\n\t *\r\n\t * @private\r\n\t */\n    _createToolbarLinkButton() {\n        const editor = this.editor;\n        const linkCommand = editor.commands.get('link');\n        const t = editor.t;\n        // Handle the `Ctrl+K` keystroke and show the panel.\n        editor.keystrokes.set(linkKeystroke, (keyEvtData, cancel) => {\n            // Prevent focusing the search bar in FF and opening new tab in Edge. #153, #154.\n            cancel();\n            if (linkCommand.isEnabled) {\n                this._showUI();\n            }\n        });\n        editor.ui.componentFactory.add('link', locale => {\n            const button = new ButtonView(locale);\n            button.isEnabled = true;\n            button.label = t('ao');\n            button.icon = linkIcon;\n            button.keystroke = linkKeystroke;\n            button.tooltip = true;\n            // Bind button to the command.\n            button.bind('isOn', 'isEnabled').to(linkCommand, 'value', 'isEnabled');\n            // Show the panel on button click.\n            this.listenTo(button, 'execute', () => this._showUI());\n            return button;\n        });\n    }\n    /**\r\n\t * Attaches actions that control whether the balloon panel containing the\r\n\t * {@link #formView} is visible or not.\r\n\t *\r\n\t * @private\r\n\t */\n    _enableUserBalloonInteractions() {\n        const viewDocument = this.editor.editing.view.document;\n        // Handle click on view document and show panel when selection is placed inside the link element.\n        // Keep panel open until selection will be inside the same link element.\n        this.listenTo(viewDocument, 'click', () => {\n            const parentLink = this._getSelectedLinkElement();\n            if (parentLink) {\n                // Then show panel but keep focus inside editor editable.\n                this._showUI();\n            }\n        });\n        // Focus the form if the balloon is visible and the Tab key has been pressed.\n        this.editor.keystrokes.set('Tab', (data, cancel) => {\n            if (this._areActionsVisible && !this.actionsView.focusTracker.isFocused) {\n                this.actionsView.focus();\n                cancel();\n            }\n        }, {\n            // Use the high priority because the link UI navigation is more important\n            // than other feature's actions, e.g. list indentation.\n            // https://github.com/ckeditor/ckeditor5-link/issues/146\n            priority: 'high'\n        });\n        // Close the panel on the Esc key press when the editable has focus and the balloon is visible.\n        this.editor.keystrokes.set('Esc', (data, cancel) => {\n            if (this._isUIVisible) {\n                this._hideUI();\n                cancel();\n            }\n        });\n        // Close on click outside of balloon panel element.\n        clickOutsideHandler({\n            emitter: this.formView,\n            activator: () => this._isUIVisible,\n            contextElements: [this._balloon.view.element],\n            callback: () => this._hideUI()\n        });\n    }\n    /**\r\n\t * Adds the {@link #actionsView} to the {@link #_balloon}.\r\n\t *\r\n\t * @protected\r\n\t */\n    _addActionsView() {\n        if (this._areActionsInPanel) {\n            return;\n        }\n        this._balloon.add({\n            view: this.actionsView,\n            position: this._getBalloonPositionData()\n        });\n    }\n    /**\r\n\t * Adds the {@link #formView} to the {@link #_balloon}.\r\n\t *\r\n\t * @protected\r\n\t */\n    _addFormView() {\n        if (this._isFormInPanel) {\n            return;\n        }\n        const editor = this.editor;\n        const linkCommand = editor.commands.get('link');\n        this._balloon.add({\n            view: this.formView,\n            position: this._getBalloonPositionData()\n        });\n        this.formView.urlInputView.select();\n        // Make sure that each time the panel shows up, the URL field remains in sync with the value of\n        // the command. If the user typed in the input, then canceled the balloon (`urlInputView#value` stays\n        // unaltered) and re-opened it without changing the value of the link command (e.g. because they\n        // clicked the same link), they would see the old value instead of the actual value of the command.\n        // https://github.com/ckeditor/ckeditor5-link/issues/78\n        // https://github.com/ckeditor/ckeditor5-link/issues/123\n        this.formView.urlInputView.inputView.element.value = linkCommand.value || '';\n    }\n    /**\r\n\t * Removes the {@link #formView} from the {@link #_balloon}.\r\n\t *\r\n\t * @protected\r\n\t */\n    _removeFormView() {\n        if (this._isFormInPanel) {\n            this._balloon.remove(this.formView);\n            // Because the form has an input which has focus, the focus must be brought back\n            // to the editor. Otherwise, it would be lost.\n            this.editor.editing.view.focus();\n        }\n    }\n    /**\r\n\t * Shows the right kind of the UI for current state of the command. It's either\r\n\t * {@link #formView} or {@link #actionsView}.\r\n\t *\r\n\t * @private\r\n\t */\n    _showUI() {\n        const editor = this.editor;\n        const linkCommand = editor.commands.get('link');\n        if (!linkCommand.isEnabled) {\n            return;\n        }\n        // When there's no link under the selection, go straight to the editing UI.\n        if (!this._getSelectedLinkElement()) {\n            this._addActionsView();\n            this._addFormView();\n        }    // If theres a link under the selection...\n        else {\n            // Go to the editing UI if actions are already visible.\n            if (this._areActionsVisible) {\n                this._addFormView();\n            }    // Otherwise display just the actions UI.\n            else {\n                this._addActionsView();\n            }\n        }\n        // Begin responding to ui#update once the UI is added.\n        this._startUpdatingUI();\n    }\n    /**\r\n\t * Removes the {@link #formView} from the {@link #_balloon}.\r\n\t *\r\n\t * See {@link #_addFormView}, {@link #_addActionsView}.\r\n\t *\r\n\t * @protected\r\n\t */\n    _hideUI() {\n        if (!this._isUIInPanel) {\n            return;\n        }\n        const editor = this.editor;\n        this.stopListening(editor.ui, 'update');\n        // Remove form first because it's on top of the stack.\n        this._removeFormView();\n        // Then remove the actions view because it's beneath the form.\n        this._balloon.remove(this.actionsView);\n        // Make sure the focus always gets back to the editable.\n        editor.editing.view.focus();\n    }\n    /**\r\n\t * Makes the UI react to the {@link module:core/editor/editorui~EditorUI#event:update} event to\r\n\t * reposition itself when the editor ui should be refreshed.\r\n\t *\r\n\t * See: {@link #_hideUI} to learn when the UI stops reacting to the `update` event.\r\n\t *\r\n\t * @protected\r\n\t */\n    _startUpdatingUI() {\n        const editor = this.editor;\n        const viewDocument = editor.editing.view.document;\n        let prevSelectedLink = this._getSelectedLinkElement();\n        let prevSelectionParent = getSelectionParent();\n        this.listenTo(editor.ui, 'update', () => {\n            const selectedLink = this._getSelectedLinkElement();\n            const selectionParent = getSelectionParent();\n            // Hide the panel if:\n            //\n            // * the selection went out of the EXISTING link element. E.g. user moved the caret out\n            //   of the link,\n            // * the selection went to a different parent when creating a NEW link. E.g. someone\n            //   else modified the document.\n            // * the selection has expanded (e.g. displaying link actions then pressing SHIFT+Right arrow).\n            //\n            // Note: #_getSelectedLinkElement will return a link for a non-collapsed selection only\n            // when fully selected.\n            if (prevSelectedLink && !selectedLink || !prevSelectedLink && selectionParent !== prevSelectionParent) {\n                this._hideUI();\n            }    // Update the position of the panel when:\n                 //  * the selection remains in the original link element,\n                 //  * there was no link element in the first place, i.e. creating a new link\n            else {\n                // If still in a link element, simply update the position of the balloon.\n                // If there was no link (e.g. inserting one), the balloon must be moved\n                // to the new position in the editing view (a new native DOM range).\n                this._balloon.updatePosition(this._getBalloonPositionData());\n            }\n            prevSelectedLink = selectedLink;\n            prevSelectionParent = selectionParent;\n        });\n        function getSelectionParent() {\n            return viewDocument.selection.focus.getAncestors().reverse().find(node => node.is('element'));\n        }\n    }\n    /**\r\n\t * Returns true when {@link #formView} is in the {@link #_balloon}.\r\n\t *\r\n\t * @readonly\r\n\t * @protected\r\n\t * @type {Boolean}\r\n\t */\n    get _isFormInPanel() {\n        return this._balloon.hasView(this.formView);\n    }\n    /**\r\n\t * Returns true when {@link #actionsView} is in the {@link #_balloon}.\r\n\t *\r\n\t * @readonly\r\n\t * @protected\r\n\t * @type {Boolean}\r\n\t */\n    get _areActionsInPanel() {\n        return this._balloon.hasView(this.actionsView);\n    }\n    /**\r\n\t * Returns true when {@link #actionsView} is in the {@link #_balloon} and it is\r\n\t * currently visible.\r\n\t *\r\n\t * @readonly\r\n\t * @protected\r\n\t * @type {Boolean}\r\n\t */\n    get _areActionsVisible() {\n        return this._balloon.visibleView === this.actionsView;\n    }\n    /**\r\n\t * Returns true when {@link #actionsView} or {@link #formView} is in the {@link #_balloon}.\r\n\t *\r\n\t * @readonly\r\n\t * @protected\r\n\t * @type {Boolean}\r\n\t */\n    get _isUIInPanel() {\n        return this._isFormInPanel || this._areActionsInPanel;\n    }\n    /**\r\n\t * Returns true when {@link #actionsView} or {@link #formView} is in the {@link #_balloon} and it is\r\n\t * currently visible.\r\n\t *\r\n\t * @readonly\r\n\t * @protected\r\n\t * @type {Boolean}\r\n\t */\n    get _isUIVisible() {\n        const visibleView = this._balloon.visibleView;\n        return visibleView == this.formView || this._areActionsVisible;\n    }\n    /**\r\n\t * Returns positioning options for the {@link #_balloon}. They control the way the balloon is attached\r\n\t * to the target element or selection.\r\n\t *\r\n\t * If the selection is collapsed and inside a link element, the panel will be attached to the\r\n\t * entire link element. Otherwise, it will be attached to the selection.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:utils/dom/position~Options}\r\n\t */\n    _getBalloonPositionData() {\n        const view = this.editor.editing.view;\n        const viewDocument = view.document;\n        const targetLink = this._getSelectedLinkElement();\n        const target = targetLink ? // When selection is inside link element, then attach panel to this element.\n        view.domConverter.mapViewToDom(targetLink) : // Otherwise attach panel to the selection.\n        view.domConverter.viewRangeToDom(viewDocument.selection.getFirstRange());\n        return { target };\n    }\n    /**\r\n\t * Returns the link {@link module:engine/view/attributeelement~AttributeElement} under\r\n\t * the {@link module:engine/view/document~Document editing view's} selection or `null`\r\n\t * if there is none.\r\n\t *\r\n\t * **Note**: For a non–collapsed selection the link element is only returned when **fully**\r\n\t * selected and the **only** element within the selection boundaries.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:engine/view/attributeelement~AttributeElement|null}\r\n\t */\n    _getSelectedLinkElement() {\n        const view = this.editor.editing.view;\n        const selection = view.document.selection;\n        if (selection.isCollapsed) {\n            return findLinkElementAncestor(selection.getFirstPosition());\n        } else {\n            // The range for fully selected link is usually anchored in adjacent text nodes.\n            // Trim it to get closer to the actual link element.\n            const range = selection.getFirstRange().getTrimmed();\n            const startLink = findLinkElementAncestor(range.start);\n            const endLink = findLinkElementAncestor(range.end);\n            if (!startLink || startLink != endLink) {\n                return null;\n            }\n            // Check if the link element is fully selected.\n            if (view.createRangeIn(startLink).getTrimmed().isEqual(range)) {\n                return startLink;\n            } else {\n                return null;\n            }\n        }\n    }\n}\n// Returns a link element if there's one among the ancestors of the provided `Position`.\n//\n// @private\n// @param {module:engine/view/position~Position} View position to analyze.\n// @returns {module:engine/view/attributeelement~AttributeElement|null} Link element at the position or null.\nfunction findLinkElementAncestor(position) {\n    return position.getAncestors().find(ancestor => isLinkElement(ancestor));\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/listcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * The list command. It is used by the {@link module:list/list~List list feature}.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class ListCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the command.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {'numbered'|'bulleted'} type List type that will be handled by this command.\r\n\t */\r\n\tconstructor( editor, type ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The type of the list created by the command.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {'numbered'|'bulleted'}\r\n\t\t */\r\n\t\tthis.type = type == 'bulleted' ? 'bulleted' : 'numbered';\r\n\r\n\t\t/**\r\n\t\t * A flag indicating whether the command is active, which means that the selection starts in a list of the same type.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #value\r\n\t\t */\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.value = this._getValue();\r\n\t\tthis.isEnabled = this._checkEnabled();\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\t\tconst blocks = Array.from( document.selection.getSelectedBlocks() )\r\n\t\t\t.filter( block => checkCanBecomeListItem( block, model.schema ) );\r\n\r\n\t\t// Whether we are turning off some items.\r\n\t\tconst turnOff = this.value === true;\r\n\t\t// If we are turning off items, we are going to rename them to paragraphs.\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// If part of a list got turned off, we need to handle (outdent) all of sub-items of the last turned-off item.\r\n\t\t\t// To be sure that model is all the time in a good state, we first fix items below turned-off item.\r\n\t\t\tif ( turnOff ) {\r\n\t\t\t\t// Start from the model item that is just after the last turned-off item.\r\n\t\t\t\tlet next = blocks[ blocks.length - 1 ].nextSibling;\r\n\t\t\t\tlet currentIndent = Number.POSITIVE_INFINITY;\r\n\t\t\t\tlet changes = [];\r\n\r\n\t\t\t\t// Correct indent of all items after the last turned off item.\r\n\t\t\t\t// Rules that should be followed:\r\n\t\t\t\t// 1. All direct sub-items of turned-off item should become indent 0, because the first item after it\r\n\t\t\t\t//    will be the first item of a new list. Other items are at the same level, so should have same 0 index.\r\n\t\t\t\t// 2. All items with indent lower than indent of turned-off item should become indent 0, because they\r\n\t\t\t\t//    should not end up as a child of any of list items that they were not children of before.\r\n\t\t\t\t// 3. All other items should have their indent changed relatively to it's parent.\r\n\t\t\t\t//\r\n\t\t\t\t// For example:\r\n\t\t\t\t// 1  * --------\r\n\t\t\t\t// 2     * --------\r\n\t\t\t\t// 3        * --------\t\t\t<-- this is turned off.\r\n\t\t\t\t// 4           * --------\t\t<-- this has to become indent = 0, because it will be first item on a new list.\r\n\t\t\t\t// 5              * --------\t<-- this should be still be a child of item above, so indent = 1.\r\n\t\t\t\t// 6        * --------\t\t\t<-- this has to become indent = 0, because it should not be a child of any of items above.\r\n\t\t\t\t// 7           * --------\t\t<-- this should be still be a child of item above, so indent = 1.\r\n\t\t\t\t// 8     * --------\t\t\t\t<-- this has to become indent = 0.\r\n\t\t\t\t// 9        * --------\t\t\t<-- this should still be a child of item above, so indent = 1.\r\n\t\t\t\t// 10          * --------\t\t<-- this should still be a child of item above, so indent = 2.\r\n\t\t\t\t// 11          * --------\t\t<-- this should still be at the same level as item above, so indent = 2.\r\n\t\t\t\t// 12 * --------\t\t\t\t<-- this and all below are left unchanged.\r\n\t\t\t\t// 13    * --------\r\n\t\t\t\t// 14       * --------\r\n\t\t\t\t//\r\n\t\t\t\t// After turning off 3 the list becomes:\r\n\t\t\t\t//\r\n\t\t\t\t// 1  * --------\r\n\t\t\t\t// 2     * --------\r\n\t\t\t\t//\r\n\t\t\t\t// 3  --------\r\n\t\t\t\t//\r\n\t\t\t\t// 4  * --------\r\n\t\t\t\t// 5     * --------\r\n\t\t\t\t// 6  * --------\r\n\t\t\t\t// 7     * --------\r\n\t\t\t\t// 8  * --------\r\n\t\t\t\t// 9     * --------\r\n\t\t\t\t// 10       * --------\r\n\t\t\t\t// 11       * --------\r\n\t\t\t\t// 12 * --------\r\n\t\t\t\t// 13    * --------\r\n\t\t\t\t// 14       * --------\r\n\t\t\t\t//\r\n\t\t\t\t// Thanks to this algorithm no lists are mismatched and no items get unexpected children/parent, while\r\n\t\t\t\t// those parent-child connection which are possible to maintain are still maintained. It's worth noting\r\n\t\t\t\t// that this is the same effect that we would be get by multiple use of outdent command. However doing\r\n\t\t\t\t// it like this is much more efficient because it's less operation (less memory usage, easier OT) and\r\n\t\t\t\t// less conversion (faster).\r\n\t\t\t\twhile ( next && next.name == 'listItem' && next.getAttribute( 'listIndent' ) !== 0 ) {\r\n\t\t\t\t\t// Check each next list item, as long as its indent is bigger than 0.\r\n\t\t\t\t\t// If the indent is 0 we are not going to change anything anyway.\r\n\t\t\t\t\tconst indent = next.getAttribute( 'listIndent' );\r\n\r\n\t\t\t\t\t// We check if that's item indent is lower as current relative indent.\r\n\t\t\t\t\tif ( indent < currentIndent ) {\r\n\t\t\t\t\t\t// If it is, current relative indent becomes that indent.\r\n\t\t\t\t\t\tcurrentIndent = indent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Fix indent relatively to current relative indent.\r\n\t\t\t\t\t// Note, that if we just changed the current relative indent, the newIndent will be equal to 0.\r\n\t\t\t\t\tconst newIndent = indent - currentIndent;\r\n\r\n\t\t\t\t\t// Save the entry in changes array. We do not apply it at the moment, because we will need to\r\n\t\t\t\t\t// reverse the changes so the last item is changed first.\r\n\t\t\t\t\t// This is to keep model in correct state all the time.\r\n\t\t\t\t\tchanges.push( { element: next, listIndent: newIndent } );\r\n\r\n\t\t\t\t\t// Find next item.\r\n\t\t\t\t\tnext = next.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchanges = changes.reverse();\r\n\r\n\t\t\t\tfor ( const item of changes ) {\r\n\t\t\t\t\twriter.setAttribute( 'listIndent', item.listIndent, item.element );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If we are turning on, we might change some items that are already `listItem`s but with different type.\r\n\t\t\t// Changing one nested list item to other type should also trigger changing all its siblings so the\r\n\t\t\t// whole nested list is of the same type.\r\n\t\t\t// Example (assume changing to numbered list):\r\n\t\t\t// * ------\t\t\t\t<-- do not fix, top level item\r\n\t\t\t//   * ------\t\t\t<-- fix, because latter list item of this item's list is changed\r\n\t\t\t//      * ------\t\t<-- do not fix, item is not affected (different list)\r\n\t\t\t//   * ------\t\t\t<-- fix, because latter list item of this item's list is changed\r\n\t\t\t//      * ------\t\t<-- fix, because latter list item of this item's list is changed\r\n\t\t\t//      * ---[--\t\t<-- already in selection\r\n\t\t\t//   * ------\t\t\t<-- already in selection\r\n\t\t\t//   * ------\t\t\t<-- already in selection\r\n\t\t\t// * ------\t\t\t\t<-- already in selection, but does not cause other list items to change because is top-level\r\n\t\t\t//   * ---]--\t\t\t<-- already in selection\r\n\t\t\t//   * ------\t\t\t<-- fix, because preceding list item of this item's list is changed\r\n\t\t\t//      * ------\t\t<-- do not fix, item is not affected (different list)\r\n\t\t\t// * ------\t\t\t\t<-- do not fix, top level item\r\n\t\t\tif ( !turnOff ) {\r\n\t\t\t\t// Find lowest indent among selected items. This will be indicator what is the indent of\r\n\t\t\t\t// top-most list affected by the command.\r\n\t\t\t\tlet lowestIndent = Number.POSITIVE_INFINITY;\r\n\r\n\t\t\t\tfor ( const item of blocks ) {\r\n\t\t\t\t\tif ( item.is( 'listItem' ) && item.getAttribute( 'listIndent' ) < lowestIndent ) {\r\n\t\t\t\t\t\tlowestIndent = item.getAttribute( 'listIndent' );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Do not execute the fix for top-level lists.\r\n\t\t\t\tlowestIndent = lowestIndent === 0 ? 1 : lowestIndent;\r\n\r\n\t\t\t\t// Fix types of list items that are \"before\" the selected blocks.\r\n\t\t\t\t_fixType( blocks, true, lowestIndent );\r\n\r\n\t\t\t\t// Fix types of list items that are \"after\" the selected blocks.\r\n\t\t\t\t_fixType( blocks, false, lowestIndent );\r\n\t\t\t}\r\n\r\n\t\t\t// Phew! Now it will be easier :).\r\n\t\t\t// For each block element that was in the selection, we will either: turn it to list item,\r\n\t\t\t// turn it to paragraph, or change it's type. Or leave it as it is.\r\n\t\t\t// Do it in reverse as there might be multiple blocks (same as with changing indents).\r\n\t\t\tfor ( const element of blocks.reverse() ) {\r\n\t\t\t\tif ( turnOff && element.name == 'listItem' ) {\r\n\t\t\t\t\t// We are turning off and the element is a `listItem` - it should be converted to `paragraph`.\r\n\t\t\t\t\t// List item specific attributes are removed by post fixer.\r\n\t\t\t\t\twriter.rename( element, 'paragraph' );\r\n\t\t\t\t} else if ( !turnOff && element.name != 'listItem' ) {\r\n\t\t\t\t\t// We are turning on and the element is not a `listItem` - it should be converted to `listItem`.\r\n\t\t\t\t\t// The order of operations is important to keep model in correct state.\r\n\t\t\t\t\twriter.setAttributes( { listType: this.type, listIndent: 0 }, element );\r\n\t\t\t\t\twriter.rename( element, 'listItem' );\r\n\t\t\t\t} else if ( !turnOff && element.name == 'listItem' && element.getAttribute( 'listType' ) != this.type ) {\r\n\t\t\t\t\t// We are turning on and the element is a `listItem` but has different type - change it's type and\r\n\t\t\t\t\t// type of it's all siblings that have same indent.\r\n\t\t\t\t\twriter.setAttribute( 'listType', this.type, element );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks the command's {@link #value}.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} The current value.\r\n\t */\r\n\t_getValue() {\r\n\t\t// Check whether closest `listItem` ancestor of the position has a correct type.\r\n\t\tconst listItem = first( this.editor.model.document.selection.getSelectedBlocks() );\r\n\r\n\t\treturn !!listItem && listItem.is( 'listItem' ) && listItem.getAttribute( 'listType' ) == this.type;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the command can be enabled in the current context.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} Whether the command should be enabled.\r\n\t */\r\n\t_checkEnabled() {\r\n\t\t// If command value is true it means that we are in list item, so the command should be enabled.\r\n\t\tif ( this.value ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst selection = this.editor.model.document.selection;\r\n\t\tconst schema = this.editor.model.schema;\r\n\r\n\t\tconst firstBlock = first( selection.getSelectedBlocks() );\r\n\r\n\t\tif ( !firstBlock ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Otherwise, check if list item can be inserted at the position start.\r\n\t\treturn checkCanBecomeListItem( firstBlock, schema );\r\n\t}\r\n}\r\n\r\n// Helper function used when one or more list item have their type changed. Fixes type of other list items\r\n// that are affected by the change (are in same lists) but are not directly in selection. The function got extracted\r\n// not to duplicated code, as same fix has to be performed before and after selection.\r\n//\r\n// @param {Array.<module:engine/model/node~Node>} blocks Blocks that are in selection.\r\n// @param {Boolean} isBackward Specified whether fix will be applied for blocks before first selected block (`true`)\r\n// or blocks after last selected block (`false`).\r\n// @param {Number} lowestIndent Lowest indent among selected blocks.\r\nfunction _fixType( blocks, isBackward, lowestIndent ) {\r\n\t// We need to check previous sibling of first changed item and next siblings of last changed item.\r\n\tconst startingItem = isBackward ? blocks[ 0 ] : blocks[ blocks.length - 1 ];\r\n\r\n\tif ( startingItem.is( 'listItem' ) ) {\r\n\t\tlet item = startingItem[ isBackward ? 'previousSibling' : 'nextSibling' ];\r\n\t\t// During processing items, keeps the lowest indent of already processed items.\r\n\t\t// This saves us from changing too many items.\r\n\t\t// Following example is for going forward as it is easier to read, however same applies to going backward.\r\n\t\t// * ------\r\n\t\t//   * ------\r\n\t\t//     * --[---\r\n\t\t//   * ------\t\t<-- `lowestIndent` should be 1\r\n\t\t//     * --]---\t\t<-- `startingItem`, `currentIndent` = 2, `lowestIndent` == 1\r\n\t\t//     * ------\t\t<-- should be fixed, `indent` == 2 == `currentIndent`\r\n\t\t//   * ------\t\t<-- should be fixed, set `currentIndent` to 1, `indent` == 1 == `currentIndent`\r\n\t\t//     * ------\t\t<-- should not be fixed, item is in different list, `indent` = 2, `indent` != `currentIndent`\r\n\t\t//   * ------\t\t<-- should be fixed, `indent` == 1 == `currentIndent`\r\n\t\t// * ------\t\t\t<-- break loop (`indent` < `lowestIndent`)\r\n\t\tlet currentIndent = startingItem.getAttribute( 'listIndent' );\r\n\r\n\t\t// Look back until a list item with indent lower than reference `lowestIndent`.\r\n\t\t// That would be the parent of nested sublist which contains item having `lowestIndent`.\r\n\t\twhile ( item && item.is( 'listItem' ) && item.getAttribute( 'listIndent' ) >= lowestIndent ) {\r\n\t\t\tif ( currentIndent > item.getAttribute( 'listIndent' ) ) {\r\n\t\t\t\tcurrentIndent = item.getAttribute( 'listIndent' );\r\n\t\t\t}\r\n\r\n\t\t\t// Found an item that is in the same nested sublist.\r\n\t\t\tif ( item.getAttribute( 'listIndent' ) == currentIndent ) {\r\n\t\t\t\t// Just add the item to selected blocks like it was selected by the user.\r\n\t\t\t\tblocks[ isBackward ? 'unshift' : 'push' ]( item );\r\n\t\t\t}\r\n\r\n\t\t\titem = item[ isBackward ? 'previousSibling' : 'nextSibling' ];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Checks whether the given block can be replaced by a listItem.\r\n//\r\n// @private\r\n// @param {module:engine/model/element~Element} block A block to be tested.\r\n// @param {module:engine/model/schema~Schema} schema The schema of the document.\r\n// @returns {Boolean}\r\nfunction checkCanBecomeListItem( block, schema ) {\r\n\treturn schema.checkChild( block.parent, 'listItem' ) && !schema.isObject( block );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/indentcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport first from '@ckeditor/ckeditor5-utils/src/first';\r\n\r\n/**\r\n * The list indent command. It is used by the {@link module:list/list~List list feature}.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class IndentCommand extends Command {\r\n\t/**\r\n\t * Creates an instance of the command.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor instance.\r\n\t * @param {'forward'|'backward'} indentDirection The direction of indent. If it is equal to `backward`, the command\r\n\t * will outdent a list item.\r\n\t */\r\n\tconstructor( editor, indentDirection ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * Determines by how much the command will change the list item's indent attribute.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @private\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis._indentBy = indentDirection == 'forward' ? 1 : -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tthis.isEnabled = this._checkEnabled();\r\n\t}\r\n\r\n\t/**\r\n\t * Indents or outdents (depends on the {@link #constructor}'s `indentDirection` parameter) selected list items.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tlet itemsToChange = Array.from( doc.selection.getSelectedBlocks() );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst lastItem = itemsToChange[ itemsToChange.length - 1 ];\r\n\r\n\t\t\t// Indenting a list item should also indent all the items that are already sub-items of indented item.\r\n\t\t\tlet next = lastItem.nextSibling;\r\n\r\n\t\t\t// Check all items after last indented item, as long as their indent is bigger than indent of that item.\r\n\t\t\twhile ( next && next.name == 'listItem' && next.getAttribute( 'listIndent' ) > lastItem.getAttribute( 'listIndent' ) ) {\r\n\t\t\t\titemsToChange.push( next );\r\n\r\n\t\t\t\tnext = next.nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\t// We need to be sure to keep model in correct state after each small change, because converters\r\n\t\t\t// bases on that state and assumes that model is correct.\r\n\t\t\t// Because of that, if the command outdents items, we will outdent them starting from the last item, as\r\n\t\t\t// it is safer.\r\n\t\t\tif ( this._indentBy < 0 ) {\r\n\t\t\t\titemsToChange = itemsToChange.reverse();\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const item of itemsToChange ) {\r\n\t\t\t\tconst indent = item.getAttribute( 'listIndent' ) + this._indentBy;\r\n\r\n\t\t\t\t// If indent is lower than 0, it means that the item got outdented when it was not indented.\r\n\t\t\t\t// This means that we need to convert that list item to paragraph.\r\n\t\t\t\tif ( indent < 0 ) {\r\n\t\t\t\t\t// To keep the model as correct as possible, first rename listItem, then remove attributes,\r\n\t\t\t\t\t// as listItem without attributes is very incorrect and will cause problems in converters.\r\n\t\t\t\t\t// No need to remove attributes, will be removed by post fixer.\r\n\t\t\t\t\twriter.rename( item, 'paragraph' );\r\n\t\t\t\t}\r\n\t\t\t\t// If indent is >= 0, change the attribute value.\r\n\t\t\t\telse {\r\n\t\t\t\t\twriter.setAttribute( 'listIndent', indent, item );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the command can be enabled in the current context.\r\n\t *\r\n\t * @private\r\n\t * @returns {Boolean} Whether the command should be enabled.\r\n\t */\r\n\t_checkEnabled() {\r\n\t\t// Check whether any of position's ancestor is a list item.\r\n\t\tconst listItem = first( this.editor.model.document.selection.getSelectedBlocks() );\r\n\r\n\t\t// If selection is not in a list item, the command is disabled.\r\n\t\tif ( !listItem || !listItem.is( 'listItem' ) ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( this._indentBy > 0 ) {\r\n\t\t\t// Cannot indent first item in it's list. Check if before `listItem` is a list item that is in same list.\r\n\t\t\t// To be in the same list, the item has to have same attributes and cannot be \"split\" by an item with lower indent.\r\n\t\t\tconst indent = listItem.getAttribute( 'listIndent' );\r\n\t\t\tconst type = listItem.getAttribute( 'listType' );\r\n\r\n\t\t\tlet prev = listItem.previousSibling;\r\n\r\n\t\t\twhile ( prev && prev.is( 'listItem' ) && prev.getAttribute( 'listIndent' ) >= indent ) {\r\n\t\t\t\tif ( prev.getAttribute( 'listIndent' ) == indent ) {\r\n\t\t\t\t\t// The item is on the same level.\r\n\t\t\t\t\t// If it has same type, it means that we found a preceding sibling from the same list.\r\n\t\t\t\t\t// If it does not have same type, it means that `listItem` is on different list (this can happen only\r\n\t\t\t\t\t// on top level lists, though).\r\n\t\t\t\t\treturn prev.getAttribute( 'listType' ) == type;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprev = prev.previousSibling;\r\n\t\t\t}\r\n\r\n\t\t\t// Could not find similar list item, this means that `listItem` is first in its list.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// If we are outdenting it is enough to be in list item. Every list item can always be outdented.\r\n\t\treturn true;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/utils\r\n */\r\n\r\nimport { getFillerOffset } from '@ckeditor/ckeditor5-engine/src/view/containerelement';\r\n\r\n/**\r\n * Creates list item {@link module:engine/view/containerelement~ContainerElement}.\r\n *\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer The writer instance.\r\n * @returns {module:engine/view/containerelement~ContainerElement}\r\n */\r\nexport function createViewListItemElement( writer ) {\r\n\tconst viewItem = writer.createContainerElement( 'li' );\r\n\tviewItem.getFillerOffset = getListItemFillerOffset;\r\n\r\n\treturn viewItem;\r\n}\r\n\r\n// Implementation of getFillerOffset for view list item element.\r\n//\r\n// @returns {Number|null} Block filler offset or `null` if block filler is not needed.\r\nfunction getListItemFillerOffset() {\r\n\tconst hasOnlyLists = !this.isEmpty && ( this.getChild( 0 ).name == 'ul' || this.getChild( 0 ).name == 'ol' );\r\n\r\n\tif ( this.isEmpty || hasOnlyLists ) {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\treturn getFillerOffset.call( this );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/converters\r\n */\r\n\r\nimport { createViewListItemElement } from './utils';\r\n\r\n/**\r\n * A model-to-view converter for `listItem` model element insertion.\r\n *\r\n * It creates a `<ul><li></li><ul>` (or `<ol>`) view structure out of a `listItem` model element, inserts it at the correct\r\n * position, and merges the list with surrounding lists (if available).\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:insert\r\n * @param {module:engine/model/model~Model} model Model instance.\r\n * @returns {Function} Returns a conversion callback.\r\n */\r\nexport function modelViewInsertion( model ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst consumable = conversionApi.consumable;\r\n\r\n\t\tif ( !consumable.test( data.item, 'insert' ) ||\r\n\t\t\t!consumable.test( data.item, 'attribute:listType' ) ||\r\n\t\t\t!consumable.test( data.item, 'attribute:listIndent' )\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsumable.consume( data.item, 'insert' );\r\n\t\tconsumable.consume( data.item, 'attribute:listType' );\r\n\t\tconsumable.consume( data.item, 'attribute:listIndent' );\r\n\r\n\t\tconst modelItem = data.item;\r\n\t\tconst viewItem = generateLiInUl( modelItem, conversionApi );\r\n\r\n\t\tinjectViewList( modelItem, viewItem, conversionApi, model );\r\n\t};\r\n}\r\n\r\n/**\r\n * A model-to-view converter for `listItem` model element removal.\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:remove\r\n * @param {module:engine/model/model~Model} model Model instance.\r\n * @returns {Function} Returns a conversion callback.\r\n */\r\nexport function modelViewRemove( model ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tconst viewStart = conversionApi.mapper.toViewPosition( data.position ).getLastMatchingPosition( value => !value.item.is( 'li' ) );\r\n\t\tconst viewItem = viewStart.nodeAfter;\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\t// 1. Break the container after and before the list item.\r\n\t\t// This will create a view list with one view list item - the one to remove.\r\n\t\tviewWriter.breakContainer( viewWriter.createPositionBefore( viewItem ) );\r\n\t\tviewWriter.breakContainer( viewWriter.createPositionAfter( viewItem ) );\r\n\r\n\t\t// 2. Remove the list with the item to remove.\r\n\t\tconst viewList = viewItem.parent;\r\n\t\tconst viewListPrev = viewList.previousSibling;\r\n\t\tconst removeRange = viewWriter.createRangeOn( viewList );\r\n\t\tconst removed = viewWriter.remove( removeRange );\r\n\r\n\t\t// 3. Merge the whole created by breaking and removing the list.\r\n\t\tif ( viewListPrev && viewListPrev.nextSibling ) {\r\n\t\t\tmergeViewLists( viewWriter, viewListPrev, viewListPrev.nextSibling );\r\n\t\t}\r\n\r\n\t\t// 4. Bring back nested list that was in the removed <li>.\r\n\t\tconst modelItem = conversionApi.mapper.toModelElement( viewItem );\r\n\r\n\t\thoistNestedLists( modelItem.getAttribute( 'listIndent' ) + 1, data.position, removeRange.start, viewItem, conversionApi, model );\r\n\r\n\t\t// 5. Unbind removed view item and all children.\r\n\t\tfor ( const child of viewWriter.createRangeIn( removed ).getItems() ) {\r\n\t\t\tconversionApi.mapper.unbindViewElement( child );\r\n\t\t}\r\n\r\n\t\tevt.stop();\r\n\t};\r\n}\r\n\r\n/**\r\n * A model-to-view converter for `type` attribute change on `listItem` model element.\r\n *\r\n * This change means that `<li>` elements parent changes from `<ul>` to `<ol>` (or vice versa). This is accomplished\r\n * by breaking view elements, changing their name and merging them.\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data Additional information about the change.\r\n * @param {Object} conversionApi Conversion interface.\r\n */\r\nexport function modelViewChangeType( evt, data, conversionApi ) {\r\n\tif ( !conversionApi.consumable.consume( data.item, 'attribute:listType' ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst viewItem = conversionApi.mapper.toViewElement( data.item );\r\n\tconst viewWriter = conversionApi.writer;\r\n\r\n\t// 1. Break the container after and before the list item.\r\n\t// This will create a view list with one view list item -- the one that changed type.\r\n\tviewWriter.breakContainer( viewWriter.createPositionBefore( viewItem ) );\r\n\tviewWriter.breakContainer( viewWriter.createPositionAfter( viewItem ) );\r\n\r\n\t// 2. Change name of the view list that holds the changed view item.\r\n\t// We cannot just change name property, because that would not render properly.\r\n\tlet viewList = viewItem.parent;\r\n\tconst listName = data.attributeNewValue == 'numbered' ? 'ol' : 'ul';\r\n\tviewList = viewWriter.rename( listName, viewList );\r\n\r\n\t// 3. Merge the changed view list with other lists, if possible.\r\n\tmergeViewLists( viewWriter, viewList, viewList.nextSibling );\r\n\tmergeViewLists( viewWriter, viewList.previousSibling, viewList );\r\n\r\n\t// 4. Consumable insertion of children inside the item. They are already handled by re-building the item in view.\r\n\tfor ( const child of data.item.getChildren() ) {\r\n\t\tconversionApi.consumable.consume( child, 'insert' );\r\n\t}\r\n}\r\n\r\n/**\r\n * A model-to-view converter for `listIndent` attribute change on `listItem` model element.\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:attribute\r\n * @param {module:engine/model/model~Model} model Model instance.\r\n * @returns {Function} Returns a conversion callback.\r\n */\r\nexport function modelViewChangeIndent( model ) {\r\n\treturn ( evt, data, conversionApi ) => {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, 'attribute:listIndent' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst viewItem = conversionApi.mapper.toViewElement( data.item );\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\r\n\t\t// 1. Break the container after and before the list item.\r\n\t\t// This will create a view list with one view list item -- the one that changed type.\r\n\t\tviewWriter.breakContainer( viewWriter.createPositionBefore( viewItem ) );\r\n\t\tviewWriter.breakContainer( viewWriter.createPositionAfter( viewItem ) );\r\n\r\n\t\t// 2. Extract view list with changed view list item and merge \"hole\" possibly created by breaking and removing elements.\r\n\t\tconst viewList = viewItem.parent;\r\n\t\tconst viewListPrev = viewList.previousSibling;\r\n\t\tconst removeRange = viewWriter.createRangeOn( viewList );\r\n\t\tviewWriter.remove( removeRange );\r\n\r\n\t\tif ( viewListPrev && viewListPrev.nextSibling ) {\r\n\t\t\tmergeViewLists( viewWriter, viewListPrev, viewListPrev.nextSibling );\r\n\t\t}\r\n\r\n\t\t// 3. Bring back nested list that was in the removed <li>.\r\n\t\thoistNestedLists( data.attributeOldValue + 1, data.range.start, removeRange.start, viewItem, conversionApi, model );\r\n\r\n\t\t// 4. Inject view list like it is newly inserted.\r\n\t\tinjectViewList( data.item, viewItem, conversionApi, model );\r\n\r\n\t\t// 5. Consume insertion of children inside the item. They are already handled by re-building the item in view.\r\n\t\tfor ( const child of data.item.getChildren() ) {\r\n\t\t\tconversionApi.consumable.consume( child, 'insert' );\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * A special model-to-view converter introduced by the {@link module:list/list~List list feature}. This converter is fired for\r\n * insert change of every model item, and should be fired before the actual converter. The converter checks whether the inserted\r\n * model item is a non-`listItem` element. If it is, and it is inserted inside a view list, the converter breaks the\r\n * list so the model element is inserted to the view parent element corresponding to its model parent element.\r\n *\r\n * The converter prevents such situations:\r\n *\r\n *\t\t// Model:                        // View:\r\n *\t\t<listItem>foo</listItem>         <ul>\r\n *\t\t<listItem>bar</listItem>             <li>foo</li>\r\n *\t\t                                     <li>bar</li>\r\n *\t\t                                 </ul>\r\n *\r\n *\t\t// After change:                 // Correct view guaranteed by this converter:\r\n *\t\t<listItem>foo</listItem>         <ul><li>foo</li></ul><p>xxx</p><ul><li>bar</li></ul>\r\n *\t\t<paragraph>xxx</paragraph>       // Instead of this wrong view state:\r\n *\t\t<listItem>bar</listItem>         <ul><li>foo</li><p>xxx</p><li>bar</li></ul>\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:insert\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data Additional information about the change.\r\n * @param {Object} conversionApi Conversion interface.\r\n */\r\nexport function modelViewSplitOnInsert( evt, data, conversionApi ) {\r\n\tif ( data.item.name != 'listItem' ) {\r\n\t\tlet viewPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst lists = [];\r\n\r\n\t\t// Break multiple ULs/OLs if there are.\r\n\t\t//\r\n\t\t// Imagine following list:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1 --------\r\n\t\t//     1.1.1 --------\r\n\t\t//     1.1.2 --------\r\n\t\t//     1.1.3 --------\r\n\t\t//       1.1.3.1 --------\r\n\t\t//   1.2 --------\r\n\t\t//     1.2.1 --------\r\n\t\t// 2 --------\r\n\t\t//\r\n\t\t// Insert paragraph after item 1.1.1:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1 --------\r\n\t\t//     1.1.1 --------\r\n\t\t//\r\n\t\t// Lorem ipsum.\r\n\t\t//\r\n\t\t//     1.1.2 --------\r\n\t\t//     1.1.3 --------\r\n\t\t//       1.1.3.1 --------\r\n\t\t//   1.2 --------\r\n\t\t//     1.2.1 --------\r\n\t\t// 2 --------\r\n\t\t//\r\n\t\t// In this case 1.1.2 has to become beginning of a new list.\r\n\t\t// We need to break list before 1.1.2 (obvious), then we need to break list also before 1.2.\r\n\t\t// Then we need to move those broken pieces one after another and merge:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1 --------\r\n\t\t//     1.1.1 --------\r\n\t\t//\r\n\t\t// Lorem ipsum.\r\n\t\t//\r\n\t\t// 1.1.2 --------\r\n\t\t//   1.1.3 --------\r\n\t\t//     1.1.3.1 --------\r\n\t\t// 1.2 --------\r\n\t\t//   1.2.1 --------\r\n\t\t// 2 --------\r\n\t\t//\r\n\t\twhile ( viewPosition.parent.name == 'ul' || viewPosition.parent.name == 'ol' ) {\r\n\t\t\tviewPosition = viewWriter.breakContainer( viewPosition );\r\n\r\n\t\t\tif ( viewPosition.parent.name != 'li' ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove lists that are after inserted element.\r\n\t\t\t// They will be brought back later, below the inserted element.\r\n\t\t\tconst removeStart = viewPosition;\r\n\t\t\tconst removeEnd = viewWriter.createPositionAt( viewPosition.parent, 'end' );\r\n\r\n\t\t\t// Don't remove if there is nothing to remove.\r\n\t\t\tif ( !removeStart.isEqual( removeEnd ) ) {\r\n\t\t\t\tconst removed = viewWriter.remove( viewWriter.createRange( removeStart, removeEnd ) );\r\n\t\t\t\tlists.push( removed );\r\n\t\t\t}\r\n\r\n\t\t\tviewPosition = viewWriter.createPositionAfter( viewPosition.parent );\r\n\t\t}\r\n\r\n\t\t// Bring back removed lists.\r\n\t\tif ( lists.length > 0 ) {\r\n\t\t\tfor ( let i = 0; i < lists.length; i++ ) {\r\n\t\t\t\tconst previousList = viewPosition.nodeBefore;\r\n\t\t\t\tconst insertedRange = viewWriter.insert( viewPosition, lists[ i ] );\r\n\t\t\t\tviewPosition = insertedRange.end;\r\n\r\n\t\t\t\t// Don't merge first list! We want a split in that place (this is why this converter is introduced).\r\n\t\t\t\tif ( i > 0 ) {\r\n\t\t\t\t\tconst mergePos = mergeViewLists( viewWriter, previousList, previousList.nextSibling );\r\n\r\n\t\t\t\t\t// If `mergePos` is in `previousList` it means that the lists got merged.\r\n\t\t\t\t\t// In this case, we need to fix insert position.\r\n\t\t\t\t\tif ( mergePos && mergePos.parent == previousList ) {\r\n\t\t\t\t\t\tviewPosition.offset--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Merge last inserted list with element after it.\r\n\t\t\tmergeViewLists( viewWriter, viewPosition.nodeBefore, viewPosition.nodeAfter );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * A special model-to-view converter introduced by the {@link module:list/list~List list feature}. This converter takes care of\r\n * merging view lists after something is removed or moved from near them.\r\n *\r\n * Example:\r\n *\r\n *\t\t// Model:                        // View:\r\n *\t\t<listItem>foo</listItem>         <ul><li>foo</li></ul>\r\n *\t\t<paragraph>xxx</paragraph>       <p>xxx</p>\r\n *\t\t<listItem>bar</listItem>         <ul><li>bar</li></ul>\r\n *\r\n *\t\t// After change:                 // Correct view guaranteed by this converter:\r\n *\t\t<listItem>foo</listItem>         <ul>\r\n *\t\t<listItem>bar</listItem>             <li>foo</li>\r\n *\t\t                                     <li>bar</li>\r\n *\t\t                                 </ul>\r\n *\r\n * @see module:engine/conversion/downcastdispatcher~DowncastDispatcher#event:remove\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data Additional information about the change.\r\n * @param {Object} conversionApi Conversion interface.\r\n */\r\nexport function modelViewMergeAfter( evt, data, conversionApi ) {\r\n\tconst viewPosition = conversionApi.mapper.toViewPosition( data.position );\r\n\tconst viewItemPrev = viewPosition.nodeBefore;\r\n\tconst viewItemNext = viewPosition.nodeAfter;\r\n\r\n\t// Merge lists if something (remove, move) was done from inside of list.\r\n\t// Merging will be done only if both items are view lists of the same type.\r\n\t// The check is done inside the helper function.\r\n\tmergeViewLists( conversionApi.writer, viewItemPrev, viewItemNext );\r\n}\r\n\r\n/**\r\n * A view-to-model converter that converts `<li>` view elements into `listItem` model elements.\r\n *\r\n * To set correct values of the `listType` and `listIndent` attributes the converter:\r\n * * checks `<li>`'s parent,\r\n * * stores and increases the `conversionApi.store.indent` value when `<li>`'s sub-items are converted.\r\n *\r\n * @see module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data An object containing conversion input and a placeholder for conversion output and possibly other values.\r\n * @param {Object} conversionApi Conversion interface to be used by the callback.\r\n */\r\nexport function viewModelConverter( evt, data, conversionApi ) {\r\n\tif ( conversionApi.consumable.consume( data.viewItem, { name: true } ) ) {\r\n\t\tconst writer = conversionApi.writer;\r\n\t\tconst conversionStore = this.conversionApi.store;\r\n\r\n\t\t// 1. Create `listItem` model element.\r\n\t\tconst listItem = writer.createElement( 'listItem' );\r\n\r\n\t\t// 2. Handle `listItem` model element attributes.\r\n\t\tconversionStore.indent = conversionStore.indent || 0;\r\n\t\twriter.setAttribute( 'listIndent', conversionStore.indent, listItem );\r\n\r\n\t\t// Set 'bulleted' as default. If this item is pasted into a context,\r\n\t\tconst type = data.viewItem.parent && data.viewItem.parent.name == 'ol' ? 'numbered' : 'bulleted';\r\n\t\twriter.setAttribute( 'listType', type, listItem );\r\n\r\n\t\t// `listItem`s created recursively should have bigger indent.\r\n\t\tconversionStore.indent++;\r\n\r\n\t\t// Try to find allowed parent for list item.\r\n\t\tconst splitResult = conversionApi.splitToAllowedParent( listItem, data.modelCursor );\r\n\r\n\t\t// When there is no allowed parent it means that list item cannot be converted at current model position\r\n\t\t// and in any of position ancestors.\r\n\t\tif ( !splitResult ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twriter.insert( listItem, splitResult.position );\r\n\r\n\t\tconst nextPosition = viewToModelListItemChildrenConverter( listItem, data.viewItem.getChildren(), conversionApi );\r\n\r\n\t\tconversionStore.indent--;\r\n\r\n\t\t// Result range starts before the first item and ends after the last.\r\n\t\tdata.modelRange = writer.createRange( data.modelCursor, nextPosition );\r\n\r\n\t\t// When modelCursor parent had to be split to insert list item.\r\n\t\tif ( splitResult.cursorParent ) {\r\n\t\t\t// Then continue conversion in split element.\r\n\t\t\tdata.modelCursor = writer.createPositionAt( splitResult.cursorParent, 0 );\r\n\t\t} else {\r\n\t\t\t// Otherwise continue conversion after last list item.\r\n\t\t\tdata.modelCursor = data.modelRange.end;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * A view-to-model converter for `<ul>` and `<ol>` view elements that cleans the input view of garbage.\r\n * This is mostly to clean whitespaces from between `<li>` view elements inside the view list element, however, also\r\n * incorrect data can be cleared if the view was incorrect.\r\n *\r\n * @see module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data An object containing conversion input and a placeholder for conversion output and possibly other values.\r\n * @param {Object} conversionApi Conversion interface to be used by the callback.\r\n */\r\nexport function cleanList( evt, data, conversionApi ) {\r\n\tif ( conversionApi.consumable.test( data.viewItem, { name: true } ) ) {\r\n\t\t// Caching children because when we start removing them iterating fails.\r\n\t\tconst children = Array.from( data.viewItem.getChildren() );\r\n\r\n\t\tfor ( const child of children ) {\r\n\t\t\tif ( !child.is( 'li' ) ) {\r\n\t\t\t\tchild._remove();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * A view-to-model converter for `<li>` elements that cleans whitespace formatting from the input view.\r\n *\r\n * @see module:engine/conversion/upcastdispatcher~UpcastDispatcher#event:element\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Object} data An object containing conversion input and a placeholder for conversion output and possibly other values.\r\n * @param {Object} conversionApi Conversion interface to be used by the callback.\r\n */\r\nexport function cleanListItem( evt, data, conversionApi ) {\r\n\tif ( conversionApi.consumable.test( data.viewItem, { name: true } ) ) {\r\n\t\tif ( data.viewItem.childCount === 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst children = [ ...data.viewItem.getChildren() ];\r\n\r\n\t\tlet foundList = false;\r\n\t\tlet firstNode = true;\r\n\r\n\t\tfor ( const child of children ) {\r\n\t\t\tif ( foundList && !child.is( 'ul' ) && !child.is( 'ol' ) ) {\r\n\t\t\t\tchild._remove();\r\n\t\t\t}\r\n\r\n\t\t\tif ( child.is( 'text' ) ) {\r\n\t\t\t\t// If this is the first node and it's a text node, left-trim it.\r\n\t\t\t\tif ( firstNode ) {\r\n\t\t\t\t\tchild._data = child.data.replace( /^\\s+/, '' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If this is the last text node before <ul> or <ol>, right-trim it.\r\n\t\t\t\tif ( !child.nextSibling || ( child.nextSibling.is( 'ul' ) || child.nextSibling.is( 'ol' ) ) ) {\r\n\t\t\t\t\tchild._data = child.data.replace( /\\s+$/, '' );\r\n\t\t\t\t}\r\n\t\t\t} else if ( child.is( 'ul' ) || child.is( 'ol' ) ) {\r\n\t\t\t\t// If this is a <ul> or <ol>, do not process it, just mark that we already visited list element.\r\n\t\t\t\tfoundList = true;\r\n\t\t\t}\r\n\r\n\t\t\tfirstNode = false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns callback for model position to view position mapping for {@link module:engine/conversion/mapper~Mapper}. The callback fixes\r\n * positions between `listItem` elements that would be incorrectly mapped because of how list items are represented in model\r\n * and view.\r\n *\r\n * @see module:engine/conversion/mapper~Mapper#event:modelToViewPosition\r\n * @param {module:engine/view/view~View} view A view instance.\r\n * @returns {Function}\r\n */\r\nexport function modelToViewPosition( view ) {\r\n\treturn ( evt, data ) => {\r\n\t\tif ( data.isPhantom ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modelItem = data.modelPosition.nodeBefore;\r\n\r\n\t\tif ( modelItem && modelItem.is( 'listItem' ) ) {\r\n\t\t\tconst viewItem = data.mapper.toViewElement( modelItem );\r\n\t\t\tconst topmostViewList = viewItem.getAncestors().find( element => element.is( 'ul' ) || element.is( 'ol' ) );\r\n\t\t\tconst walker = view.createPositionAt( viewItem, 0 ).getWalker();\r\n\r\n\t\t\tfor ( const value of walker ) {\r\n\t\t\t\tif ( value.type == 'elementStart' && value.item.is( 'li' ) ) {\r\n\t\t\t\t\tdata.viewPosition = value.previousPosition;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if ( value.type == 'elementEnd' && value.item == topmostViewList ) {\r\n\t\t\t\t\tdata.viewPosition = value.nextPosition;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * The callback for view position to model position mapping for {@link module:engine/conversion/mapper~Mapper}. The callback fixes\r\n * positions between `<li>` elements that would be incorrectly mapped because of how list items are represented in model\r\n * and view.\r\n *\r\n * @see module:engine/conversion/mapper~Mapper#event:viewToModelPosition\r\n * @param {module:engine/model/model~Model} model Model instance.\r\n * @returns {Function} Returns a conversion callback.\r\n */\r\nexport function viewToModelPosition( model ) {\r\n\treturn ( evt, data ) => {\r\n\t\tconst viewPos = data.viewPosition;\r\n\t\tconst viewParent = viewPos.parent;\r\n\t\tconst mapper = data.mapper;\r\n\r\n\t\tif ( viewParent.name == 'ul' || viewParent.name == 'ol' ) {\r\n\t\t\t// Position is directly in <ul> or <ol>.\r\n\t\t\tif ( !viewPos.isAtEnd ) {\r\n\t\t\t\t// If position is not at the end, it must be before <li>.\r\n\t\t\t\t// Get that <li>, map it to `listItem` and set model position before that `listItem`.\r\n\t\t\t\tconst modelNode = mapper.toModelElement( viewPos.nodeAfter );\r\n\r\n\t\t\t\tdata.modelPosition = model.createPositionBefore( modelNode );\r\n\t\t\t} else {\r\n\t\t\t\t// Position is at the end of <ul> or <ol>, so there is no <li> after it to be mapped.\r\n\t\t\t\t// There is <li> before the position, but we cannot just map it to `listItem` and set model position after it,\r\n\t\t\t\t// because that <li> may contain nested items.\r\n\t\t\t\t// We will check \"model length\" of that <li>, in other words - how many `listItem`s are in that <li>.\r\n\t\t\t\tconst modelNode = mapper.toModelElement( viewPos.nodeBefore );\r\n\t\t\t\tconst modelLength = mapper.getModelLength( viewPos.nodeBefore );\r\n\r\n\t\t\t\t// Then we get model position before mapped `listItem` and shift it accordingly.\r\n\t\t\t\tdata.modelPosition = model.createPositionBefore( modelNode ).getShiftedBy( modelLength );\r\n\t\t\t}\r\n\r\n\t\t\tevt.stop();\r\n\t\t} else if (\r\n\t\t\tviewParent.name == 'li' &&\r\n\t\t\tviewPos.nodeBefore &&\r\n\t\t\t( viewPos.nodeBefore.name == 'ul' || viewPos.nodeBefore.name == 'ol' )\r\n\t\t) {\r\n\t\t\t// In most cases when view position is in <li> it is in text and this is a correct position.\r\n\t\t\t// However, if position is after <ul> or <ol> we have to fix it -- because in model <ul>/<ol> are not in the `listItem`.\r\n\t\t\tconst modelNode = mapper.toModelElement( viewParent );\r\n\r\n\t\t\t// Check all <ul>s and <ol>s that are in the <li> but before mapped position.\r\n\t\t\t// Get model length of those elements and then add it to the offset of `listItem` mapped to the original <li>.\r\n\t\t\tlet modelLength = 1; // Starts from 1 because the original <li> has to be counted in too.\r\n\t\t\tlet viewList = viewPos.nodeBefore;\r\n\r\n\t\t\twhile ( viewList && ( viewList.is( 'ul' ) || viewList.is( 'ol' ) ) ) {\r\n\t\t\t\tmodelLength += mapper.getModelLength( viewList );\r\n\r\n\t\t\t\tviewList = viewList.previousSibling;\r\n\t\t\t}\r\n\r\n\t\t\tdata.modelPosition = model.createPositionBefore( modelNode ).getShiftedBy( modelLength );\r\n\r\n\t\t\tevt.stop();\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Post-fixer that reacts to changes on document and fixes incorrect model states.\r\n *\r\n * In an example below, there is a correct list structure.\r\n * Then the middle element will be removed so the list structure will become incorrect:\r\n *\r\n *\t\t<listItem listType=\"bulleted\" listIndent=0>Item 1</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=1>Item 2</listItem>   <--- this is removed.\r\n *\t\t<listItem listType=\"bulleted\" listIndent=2>Item 3</listItem>\r\n *\r\n * List structure after the middle element removed:\r\n *\r\n * \t\t<listItem listType=\"bulleted\" listIndent=0>Item 1</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=2>Item 3</listItem>\r\n *\r\n * Should become:\r\n *\r\n *\t\t<listItem listType=\"bulleted\" listIndent=0>Item 1</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=1>Item 3</listItem>   <--- note that indent got post-fixed.\r\n *\r\n * @param {module:engine/model/model~Model} model The data model.\r\n * @param {module:engine/model/writer~Writer} writer The writer to do changes with.\r\n * @returns {Boolean} `true` if any change has been applied, `false` otherwise.\r\n */\r\nexport function modelChangePostFixer( model, writer ) {\r\n\tconst changes = model.document.differ.getChanges();\r\n\tconst itemToListHead = new Map();\r\n\r\n\tlet applied = false;\r\n\r\n\tfor ( const entry of changes ) {\r\n\t\tif ( entry.type == 'insert' && entry.name == 'listItem' ) {\r\n\t\t\t_addListToFix( entry.position );\r\n\t\t} else if ( entry.type == 'insert' && entry.name != 'listItem' ) {\r\n\t\t\tif ( entry.name != '$text' ) {\r\n\t\t\t\t// In case of renamed element.\r\n\t\t\t\tconst item = entry.position.nodeAfter;\r\n\r\n\t\t\t\tif ( item.hasAttribute( 'listIndent' ) ) {\r\n\t\t\t\t\twriter.removeAttribute( 'listIndent', item );\r\n\r\n\t\t\t\t\tapplied = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( item.hasAttribute( 'listType' ) ) {\r\n\t\t\t\t\twriter.removeAttribute( 'listType', item );\r\n\r\n\t\t\t\t\tapplied = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst posAfter = entry.position.getShiftedBy( entry.length );\r\n\r\n\t\t\t_addListToFix( posAfter );\r\n\t\t} else if ( entry.type == 'remove' && entry.name == 'listItem' ) {\r\n\t\t\t_addListToFix( entry.position );\r\n\t\t} else if ( entry.type == 'attribute' && entry.attributeKey == 'listIndent' ) {\r\n\t\t\t_addListToFix( entry.range.start );\r\n\t\t} else if ( entry.type == 'attribute' && entry.attributeKey == 'listType' ) {\r\n\t\t\t_addListToFix( entry.range.start );\r\n\t\t}\r\n\t}\r\n\r\n\tfor ( const listHead of itemToListHead.values() ) {\r\n\t\t_fixListIndents( listHead );\r\n\t\t_fixListTypes( listHead );\r\n\t}\r\n\r\n\treturn applied;\r\n\r\n\tfunction _addListToFix( position ) {\r\n\t\tconst prev = position.nodeBefore;\r\n\r\n\t\tif ( !prev || !prev.is( 'listItem' ) ) {\r\n\t\t\tconst item = position.nodeAfter;\r\n\r\n\t\t\tif ( item && item.is( 'listItem' ) ) {\r\n\t\t\t\titemToListHead.set( item, item );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet listHead = prev;\r\n\r\n\t\t\tif ( itemToListHead.has( listHead ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\twhile ( listHead.previousSibling && listHead.previousSibling.is( 'listItem' ) ) {\r\n\t\t\t\tlistHead = listHead.previousSibling;\r\n\r\n\t\t\t\tif ( itemToListHead.has( listHead ) ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\titemToListHead.set( position.nodeBefore, listHead );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _fixListIndents( item ) {\r\n\t\tlet maxIndent = 0;\r\n\t\tlet fixBy = null;\r\n\r\n\t\twhile ( item && item.is( 'listItem' ) ) {\r\n\t\t\tconst itemIndent = item.getAttribute( 'listIndent' );\r\n\r\n\t\t\tif ( itemIndent > maxIndent ) {\r\n\t\t\t\tlet newIndent;\r\n\r\n\t\t\t\tif ( fixBy === null ) {\r\n\t\t\t\t\tfixBy = itemIndent - maxIndent;\r\n\t\t\t\t\tnewIndent = maxIndent;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ( fixBy > itemIndent ) {\r\n\t\t\t\t\t\tfixBy = itemIndent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnewIndent = itemIndent - fixBy;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twriter.setAttribute( 'listIndent', newIndent, item );\r\n\r\n\t\t\t\tapplied = true;\r\n\t\t\t} else {\r\n\t\t\t\tfixBy = null;\r\n\t\t\t\tmaxIndent = item.getAttribute( 'listIndent' ) + 1;\r\n\t\t\t}\r\n\r\n\t\t\titem = item.nextSibling;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _fixListTypes( item ) {\r\n\t\tlet typesStack = [];\r\n\t\tlet prev = null;\r\n\r\n\t\twhile ( item && item.is( 'listItem' ) ) {\r\n\t\t\tconst itemIndent = item.getAttribute( 'listIndent' );\r\n\r\n\t\t\tif ( prev && prev.getAttribute( 'listIndent' ) > itemIndent ) {\r\n\t\t\t\ttypesStack = typesStack.slice( 0, itemIndent + 1 );\r\n\t\t\t}\r\n\r\n\t\t\tif ( itemIndent != 0 ) {\r\n\t\t\t\tif ( typesStack[ itemIndent ] ) {\r\n\t\t\t\t\tconst type = typesStack[ itemIndent ];\r\n\r\n\t\t\t\t\tif ( item.getAttribute( 'listType' ) != type ) {\r\n\t\t\t\t\t\twriter.setAttribute( 'listType', type, item );\r\n\r\n\t\t\t\t\t\tapplied = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttypesStack[ itemIndent ] = item.getAttribute( 'listType' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprev = item;\r\n\t\t\titem = item.nextSibling;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * A fixer for pasted content that includes list items.\r\n *\r\n * It fixes indentation of pasted list items so the pasted items match correctly to the context they are pasted into.\r\n *\r\n * Example:\r\n *\r\n *\t\t<listItem listType=\"bulleted\" listIndent=0>A</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=1>B^</listItem>\r\n *\t\t// At ^ paste:  <listItem listType=\"bulleted\" listIndent=4>X</listItem>\r\n *\t\t//              <listItem listType=\"bulleted\" listIndent=5>Y</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=2>C</listItem>\r\n *\r\n * Should become:\r\n *\r\n *\t\t<listItem listType=\"bulleted\" listIndent=0>A</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=1>BX</listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=2>Y/listItem>\r\n *\t\t<listItem listType=\"bulleted\" listIndent=2>C</listItem>\r\n *\r\n * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\r\n * @param {Array} args Arguments of {@link module:engine/model/model~Model#insertContent}.\r\n */\r\nexport function modelIndentPasteFixer( evt, [ content, selectable ] ) {\r\n\t// Check whether inserted content starts from a `listItem`. If it does not, it means that there are some other\r\n\t// elements before it and there is no need to fix indents, because even if we insert that content into a list,\r\n\t// that list will be broken.\r\n\t// Note: we also need to handle singular elements because inserting item with indent 0 into 0,1,[],2\r\n\t// would create incorrect model.\r\n\tlet item = content.is( 'documentFragment' ) ? content.getChild( 0 ) : content;\r\n\r\n\tlet selection;\r\n\r\n\tif ( !selectable ) {\r\n\t\tselection = this.document.selection;\r\n\t} else {\r\n\t\tselection = this.createSelection( selectable );\r\n\t}\r\n\r\n\tif ( item && item.is( 'listItem' ) ) {\r\n\t\t// Get a reference list item. Inserted list items will be fixed according to that item.\r\n\t\tconst pos = selection.getFirstPosition();\r\n\t\tlet refItem = null;\r\n\r\n\t\tif ( pos.parent.is( 'listItem' ) ) {\r\n\t\t\trefItem = pos.parent;\r\n\t\t} else if ( pos.nodeBefore && pos.nodeBefore.is( 'listItem' ) ) {\r\n\t\t\trefItem = pos.nodeBefore;\r\n\t\t}\r\n\r\n\t\t// If there is `refItem` it means that we do insert list items into an existing list.\r\n\t\tif ( refItem ) {\r\n\t\t\t// First list item in `data` has indent equal to 0 (it is a first list item). It should have indent equal\r\n\t\t\t// to the indent of reference item. We have to fix the first item and all of it's children and following siblings.\r\n\t\t\t// Indent of all those items has to be adjusted to reference item.\r\n\t\t\tconst indentChange = refItem.getAttribute( 'listIndent' );\r\n\r\n\t\t\t// Fix only if there is anything to fix.\r\n\t\t\tif ( indentChange > 0 ) {\r\n\t\t\t\t// Adjust indent of all \"first\" list items in inserted data.\r\n\t\t\t\twhile ( item && item.is( 'listItem' ) ) {\r\n\t\t\t\t\titem._setAttribute( 'listIndent', item.getAttribute( 'listIndent' ) + indentChange );\r\n\r\n\t\t\t\t\titem = item.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Helper function that creates a `<ul><li></li></ul>` or (`<ol>`) structure out of given `modelItem` model `listItem` element.\r\n// Then, it binds created view list item (<li>) with model `listItem` element.\r\n// The function then returns created view list item (<li>).\r\nfunction generateLiInUl( modelItem, conversionApi ) {\r\n\tconst mapper = conversionApi.mapper;\r\n\tconst viewWriter = conversionApi.writer;\r\n\tconst listType = modelItem.getAttribute( 'listType' ) == 'numbered' ? 'ol' : 'ul';\r\n\tconst viewItem = createViewListItemElement( viewWriter );\r\n\r\n\tconst viewList = viewWriter.createContainerElement( listType, null );\r\n\tviewWriter.insert( viewWriter.createPositionAt( viewList, 0 ), viewItem );\r\n\r\n\tmapper.bindElements( modelItem, viewItem );\r\n\r\n\treturn viewItem;\r\n}\r\n\r\n// Helper function that converts children of a given `<li>` view element into corresponding model elements.\r\n// The function maintains proper order of elements if model `listItem` is split during the conversion\r\n// due to block children conversion.\r\n//\r\n// @param {module:engine/model/element~Element} listItemModel List item model element to which converted children will be inserted.\r\n// @param {Iterable.<module:engine/view/node~Node>} viewChildren View elements which will be converted.\r\n// @param {Object} conversionApi Conversion interface to be used by the callback.\r\n// @returns {module:engine/model/position~Position} Position on which next elements should be inserted after children conversion.\r\nfunction viewToModelListItemChildrenConverter( listItemModel, viewChildren, conversionApi ) {\r\n\tconst writer = conversionApi.writer;\r\n\tlet lastListItem = listItemModel;\r\n\tlet nextPosition = writer.createPositionAfter( listItemModel );\r\n\r\n\t// Check all children of the converted `<li>`. At this point we assume there are no \"whitespace\" view text nodes\r\n\t// in view list, between view list items. This should be handled by `<ul>` and `<ol>` converters.\r\n\tfor ( const child of viewChildren ) {\r\n\t\t// If this is a view list element, we will insert its conversion result after currently handled `listItem`.\r\n\t\tif ( child.name == 'ul' || child.name == 'ol' ) {\r\n\t\t\tnextPosition = conversionApi.convertItem( child, nextPosition ).modelCursor;\r\n\t\t}\r\n\t\t// If it is not a view list element it is a \"regular\" list item content. Its conversion result will\r\n\t\t// be inserted as `listItem` children (block children may split current `listItem`).\r\n\t\telse {\r\n\t\t\tconst result = conversionApi.convertItem( child, writer.createPositionAt( lastListItem, 'end' ) );\r\n\t\t\tconst convertedChild = result.modelRange.start.nodeAfter;\r\n\r\n\t\t\tnextPosition = result.modelCursor;\r\n\r\n\t\t\t// If there is a block element child being converted it may split the current list item, for example:\r\n\t\t\t//\r\n\t\t\t//\t\t<li><p>Foo</p></li>\r\n\t\t\t//\r\n\t\t\t// will be converted to:\r\n\t\t\t//\r\n\t\t\t//\t\t<listItem></listItem><paragraph>Foo</paragraph><listItem></listItem>\r\n\t\t\t//\r\n\t\t\t// so we need to update reference to `lastListItem`.\r\n\t\t\tif ( convertedChild && convertedChild.is( 'element' ) &&\r\n\t\t\t\t!conversionApi.schema.checkChild( lastListItem, convertedChild.name ) ) {\r\n\t\t\t\tlastListItem = nextPosition.parent;\r\n\r\n\t\t\t\t// Depending on the used converter for block elements, usually the position (`result.modelCursor`\r\n\t\t\t\t// marked as # below) points to the second list item after conversion:\r\n\t\t\t\t//\r\n\t\t\t\t//\t\t`<li><p>Foo</p></li>` -> `<listItem></listItem><paragraph>Foo</paragraph><listItem>#</listItem>`\r\n\t\t\t\t//\r\n\t\t\t\t// However, in some cases like autoparagraphing the position is placed on the end of the block element:\r\n\t\t\t\t//\r\n\t\t\t\t//\t\t`<li><h2>Foo</h2></li>` -> `<listItem></listItem><paragraph>Foo#</paragraph><listItem></listItem>`\r\n\t\t\t\t//\r\n\t\t\t\t// We need to check for such cases and use proper list item and position based on it.\r\n\t\t\t\tif ( !lastListItem.is( 'listItem' ) && lastListItem.nextSibling && lastListItem.nextSibling.is( 'listItem' ) ) {\r\n\t\t\t\t\tlastListItem = lastListItem.nextSibling;\r\n\t\t\t\t\tnextPosition = writer.createPositionAt( lastListItem, 'end' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn nextPosition;\r\n}\r\n\r\n// Helper function that seeks for a list item sibling of given model item (or position) which meets given criteria.\r\n// `options` object may contain one or more of given values (by default they are `false`):\r\n// `options.sameIndent` - whether sought sibling should have same indent (default = no),\r\n// `options.smallerIndent` - whether sought sibling should have smaller indent (default = no).\r\n// `options.indent` - used as reference item when first parameter is a position\r\n// Either `options.sameIndent` or `options.biggerIndent` should be set to `true`.\r\nfunction getSiblingListItem( modelItem, options ) {\r\n\tconst sameIndent = !!options.sameIndent;\r\n\tconst smallerIndent = !!options.smallerIndent;\r\n\tconst indent = options.listIndent;\r\n\r\n\tlet item = modelItem;\r\n\r\n\twhile ( item && item.name == 'listItem' ) {\r\n\t\tconst itemIndent = item.getAttribute( 'listIndent' );\r\n\r\n\t\tif ( ( sameIndent && indent == itemIndent ) || ( smallerIndent && indent > itemIndent ) ) {\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\titem = item.previousSibling;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n// Helper function that takes two parameters, that are expected to be view list elements, and merges them.\r\n// The merge happen only if both parameters are UL or OL elements.\r\nfunction mergeViewLists( viewWriter, firstList, secondList ) {\r\n\tif ( firstList && secondList && ( firstList.name == 'ul' || firstList.name == 'ol' ) && firstList.name == secondList.name ) {\r\n\t\treturn viewWriter.mergeContainers( viewWriter.createPositionAfter( firstList ) );\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\n// Helper function that takes model list item element `modelItem`, corresponding view list item element `injectedItem`\r\n// that is not added to the view and is inside a view list element (`ul` or `ol`) and is that's list only child.\r\n// The list is inserted at correct position (element breaking may be needed) and then merged with it's siblings.\r\n// See comments below to better understand the algorithm.\r\nfunction injectViewList( modelItem, injectedItem, conversionApi, model ) {\r\n\tconst injectedList = injectedItem.parent;\r\n\tconst mapper = conversionApi.mapper;\r\n\tconst viewWriter = conversionApi.writer;\r\n\r\n\t// Position where view list will be inserted.\r\n\tlet insertPosition = mapper.toViewPosition( model.createPositionBefore( modelItem ) );\r\n\r\n\t// 1. Find previous list item that has same or smaller indent. Basically we are looking for a first model item\r\n\t// that is \"parent\" or \"sibling\" of injected model item.\r\n\t// If there is no such list item, it means that injected list item is the first item in \"its list\".\r\n\tconst refItem = getSiblingListItem( modelItem.previousSibling, {\r\n\t\tsameIndent: true,\r\n\t\tsmallerIndent: true,\r\n\t\tlistIndent: modelItem.getAttribute( 'listIndent' )\r\n\t} );\r\n\tconst prevItem = modelItem.previousSibling;\r\n\r\n\tif ( refItem && refItem.getAttribute( 'listIndent' ) == modelItem.getAttribute( 'listIndent' ) ) {\r\n\t\t// There is a list item with same indent - we found same-level sibling.\r\n\t\t// Break the list after it. Inserted view item will be inserted in the broken space.\r\n\t\tconst viewItem = mapper.toViewElement( refItem );\r\n\t\tinsertPosition = viewWriter.breakContainer( viewWriter.createPositionAfter( viewItem ) );\r\n\t} else {\r\n\t\t// There is no list item with same indent. Check previous model item.\r\n\t\tif ( prevItem && prevItem.name == 'listItem' ) {\r\n\t\t\t// If it is a list item, it has to have lower indent.\r\n\t\t\t// It means that inserted item should be added to it as its nested item.\r\n\t\t\tinsertPosition = mapper.toViewPosition( model.createPositionAt( prevItem, 'end' ) );\r\n\t\t} else {\r\n\t\t\t// Previous item is not a list item (or does not exist at all).\r\n\t\t\t// Just map the position and insert the view item at mapped position.\r\n\t\t\tinsertPosition = mapper.toViewPosition( model.createPositionBefore( modelItem ) );\r\n\t\t}\r\n\t}\r\n\r\n\tinsertPosition = positionAfterUiElements( insertPosition );\r\n\r\n\t// Insert the view item.\r\n\tviewWriter.insert( insertPosition, injectedList );\r\n\r\n\t// 2. Handle possible children of injected model item.\r\n\tif ( prevItem && prevItem.name == 'listItem' ) {\r\n\t\tconst prevView = mapper.toViewElement( prevItem );\r\n\r\n\t\tconst walkerBoundaries = viewWriter.createRange( viewWriter.createPositionAt( prevView, 0 ), insertPosition );\r\n\t\tconst walker = walkerBoundaries.getWalker( { ignoreElementEnd: true } );\r\n\r\n\t\tfor ( const value of walker ) {\r\n\t\t\tif ( value.item.is( 'li' ) ) {\r\n\t\t\t\tconst breakPosition = viewWriter.breakContainer( viewWriter.createPositionBefore( value.item ) );\r\n\t\t\t\tconst viewList = value.item.parent;\r\n\r\n\t\t\t\tconst targetPosition = viewWriter.createPositionAt( injectedItem, 'end' );\r\n\t\t\t\tmergeViewLists( viewWriter, targetPosition.nodeBefore, targetPosition.nodeAfter );\r\n\t\t\t\tviewWriter.move( viewWriter.createRangeOn( viewList ), targetPosition );\r\n\r\n\t\t\t\twalker.position = breakPosition;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tconst nextViewList = injectedList.nextSibling;\r\n\r\n\t\tif ( nextViewList && ( nextViewList.is( 'ul' ) || nextViewList.is( 'ol' ) ) ) {\r\n\t\t\tlet lastSubChild = null;\r\n\r\n\t\t\tfor ( const child of nextViewList.getChildren() ) {\r\n\t\t\t\tconst modelChild = mapper.toModelElement( child );\r\n\r\n\t\t\t\tif ( modelChild && modelChild.getAttribute( 'listIndent' ) > modelItem.getAttribute( 'listIndent' ) ) {\r\n\t\t\t\t\tlastSubChild = child;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( lastSubChild ) {\r\n\t\t\t\tviewWriter.breakContainer( viewWriter.createPositionAfter( lastSubChild ) );\r\n\t\t\t\tviewWriter.move( viewWriter.createRangeOn( lastSubChild.parent ), viewWriter.createPositionAt( injectedItem, 'end' ) );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Merge inserted view list with its possible neighbour lists.\r\n\tmergeViewLists( viewWriter, injectedList, injectedList.nextSibling );\r\n\tmergeViewLists( viewWriter, injectedList.previousSibling, injectedList );\r\n}\r\n\r\n// Helper function that takes all children of given `viewRemovedItem` and moves them in a correct place, according\r\n// to other given parameters.\r\nfunction hoistNestedLists( nextIndent, modelRemoveStartPosition, viewRemoveStartPosition, viewRemovedItem, conversionApi, model ) {\r\n\t// Find correct previous model list item element.\r\n\t// The element has to have either same or smaller indent than given reference indent.\r\n\t// This will be the model element which will get nested items (if it has smaller indent) or sibling items (if it has same indent).\r\n\t// Keep in mind that such element might not be found, if removed item was the first item.\r\n\tconst prevModelItem = getSiblingListItem( modelRemoveStartPosition.nodeBefore, {\r\n\t\tsameIndent: true,\r\n\t\tsmallerIndent: true,\r\n\t\tlistIndent: nextIndent,\r\n\t\tfoo: 'b'\r\n\t} );\r\n\r\n\tconst mapper = conversionApi.mapper;\r\n\tconst viewWriter = conversionApi.writer;\r\n\r\n\t// Indent of found element or `null` if the element has not been found.\r\n\tconst prevIndent = prevModelItem ? prevModelItem.getAttribute( 'listIndent' ) : null;\r\n\r\n\tlet insertPosition;\r\n\r\n\tif ( !prevModelItem ) {\r\n\t\t// If element has not been found, simply insert lists at the position where the removed item was:\r\n\t\t//\r\n\t\t// Lorem ipsum.\r\n\t\t// 1 --------           <--- this is removed, no previous list item, put nested items in place of removed item.\r\n\t\t//   1.1 --------       <--- this is reference indent.\r\n\t\t//     1.1.1 --------\r\n\t\t//     1.1.2 --------\r\n\t\t//   1.2 --------\r\n\t\t//\r\n\t\t// Becomes:\r\n\t\t//\r\n\t\t// Lorem ipsum.\r\n\t\t// 1.1 --------\r\n\t\t//   1.1.1 --------\r\n\t\t//   1.1.2 --------\r\n\t\t// 1.2 --------\r\n\t\tinsertPosition = viewRemoveStartPosition;\r\n\t} else if ( prevIndent == nextIndent ) {\r\n\t\t// If element has been found and has same indent as reference indent it means that nested items should\r\n\t\t// become siblings of found element:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1 --------\r\n\t\t//   1.2 --------       <--- this is `prevModelItem`.\r\n\t\t// 2 --------           <--- this is removed, previous list item has indent same as reference indent.\r\n\t\t//   2.1 --------       <--- this is reference indent, this and 2.2 should become siblings of 1.2.\r\n\t\t//   2.2 --------\r\n\t\t//\r\n\t\t// Becomes:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1 --------\r\n\t\t//   1.2 --------\r\n\t\t//   2.1 --------\r\n\t\t//   2.2 --------\r\n\t\tconst prevViewList = mapper.toViewElement( prevModelItem ).parent;\r\n\t\tinsertPosition = viewWriter.createPositionAfter( prevViewList );\r\n\t} else {\r\n\t\t// If element has been found and has smaller indent as reference indent it means that nested items\r\n\t\t// should become nested items of found item:\r\n\t\t//\r\n\t\t// 1 --------           <--- this is `prevModelItem`.\r\n\t\t//   1.1 --------       <--- this is removed, previous list item has indent smaller than reference indent.\r\n\t\t//     1.1.1 --------   <--- this is reference indent, this and 1.1.1 should become nested items of 1.\r\n\t\t//     1.1.2 --------\r\n\t\t//   1.2 --------\r\n\t\t//\r\n\t\t// Becomes:\r\n\t\t//\r\n\t\t// 1 --------\r\n\t\t//   1.1.1 --------\r\n\t\t//   1.1.2 --------\r\n\t\t//   1.2 --------\r\n\t\t//\r\n\t\t// Note: in this case 1.1.1 have indent 2 while 1 have indent 0. In model that should not be possible,\r\n\t\t// because following item may have indent bigger only by one. But this is fixed by postfixer.\r\n\t\tconst modelPosition = model.createPositionAt( prevModelItem, 'end' );\r\n\t\tinsertPosition = mapper.toViewPosition( modelPosition );\r\n\t}\r\n\r\n\tinsertPosition = positionAfterUiElements( insertPosition );\r\n\r\n\t// Handle multiple lists. This happens if list item has nested numbered and bulleted lists. Following lists\r\n\t// are inserted after the first list (no need to recalculate insertion position for them).\r\n\tfor ( const child of [ ...viewRemovedItem.getChildren() ] ) {\r\n\t\tif ( child.is( 'ul' ) || child.is( 'ol' ) ) {\r\n\t\t\tinsertPosition = viewWriter.move( viewWriter.createRangeOn( child ), insertPosition ).end;\r\n\r\n\t\t\tmergeViewLists( viewWriter, child, child.nextSibling );\r\n\t\t\tmergeViewLists( viewWriter, child.previousSibling, child );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Helper function that for given `view.Position`, returns a `view.Position` that is after all `view.UIElement`s that\r\n// are after given position.\r\n// For example:\r\n// <container:p>foo^<ui:span></ui:span><ui:span></ui:span>bar</contain:p>\r\n// For position ^, a position before \"bar\" will be returned.\r\nfunction positionAfterUiElements( viewPosition ) {\r\n\treturn viewPosition.getLastMatchingPosition( value => value.item.is( 'uiElement' ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/listediting\r\n */\r\n\r\nimport ListCommand from './listcommand';\r\nimport IndentCommand from './indentcommand';\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Paragraph from '@ckeditor/ckeditor5-paragraph/src/paragraph';\r\n\r\nimport {\r\n\tcleanList,\r\n\tcleanListItem,\r\n\tmodelViewInsertion,\r\n\tmodelViewChangeType,\r\n\tmodelViewMergeAfter,\r\n\tmodelViewRemove,\r\n\tmodelViewSplitOnInsert,\r\n\tmodelViewChangeIndent,\r\n\tmodelChangePostFixer,\r\n\tmodelIndentPasteFixer,\r\n\tviewModelConverter,\r\n\tmodelToViewPosition,\r\n\tviewToModelPosition\r\n} from './converters';\r\n\r\n/**\r\n * The engine of the list feature. It handles creating, editing and removing lists and list items.\r\n *\r\n * It registers the `'numberedList'`, `'bulletedList'`, `'indentList'` and `'outdentList'` commands.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ListEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ Paragraph ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// Schema.\r\n\t\t// Note: in case `$block` will ever be allowed in `listItem`, keep in mind that this feature\r\n\t\t// uses `Selection#getSelectedBlocks()` without any additional processing to obtain all selected list items.\r\n\t\t// If there are blocks allowed inside list item, algorithms using `getSelectedBlocks()` will have to be modified.\r\n\t\teditor.model.schema.register( 'listItem', {\r\n\t\t\tinheritAllFrom: '$block',\r\n\t\t\tallowAttributes: [ 'listType', 'listIndent' ]\r\n\t\t} );\r\n\r\n\t\t// Converters.\r\n\t\tconst data = editor.data;\r\n\t\tconst editing = editor.editing;\r\n\r\n\t\teditor.model.document.registerPostFixer( writer => modelChangePostFixer( editor.model, writer ) );\r\n\r\n\t\tediting.mapper.registerViewToModelLength( 'li', getViewListItemLength );\r\n\t\tdata.mapper.registerViewToModelLength( 'li', getViewListItemLength );\r\n\r\n\t\tediting.mapper.on( 'modelToViewPosition', modelToViewPosition( editing.view ) );\r\n\t\tediting.mapper.on( 'viewToModelPosition', viewToModelPosition( editor.model ) );\r\n\t\tdata.mapper.on( 'modelToViewPosition', modelToViewPosition( editing.view ) );\r\n\r\n\t\tediting.downcastDispatcher.on( 'insert', modelViewSplitOnInsert, { priority: 'high' } );\r\n\t\tediting.downcastDispatcher.on( 'insert:listItem', modelViewInsertion( editor.model ) );\r\n\t\tdata.downcastDispatcher.on( 'insert', modelViewSplitOnInsert, { priority: 'high' } );\r\n\t\tdata.downcastDispatcher.on( 'insert:listItem', modelViewInsertion( editor.model ) );\r\n\r\n\t\tediting.downcastDispatcher.on( 'attribute:listType:listItem', modelViewChangeType );\r\n\t\tdata.downcastDispatcher.on( 'attribute:listType:listItem', modelViewChangeType );\r\n\t\tediting.downcastDispatcher.on( 'attribute:listIndent:listItem', modelViewChangeIndent( editor.model ) );\r\n\t\tdata.downcastDispatcher.on( 'attribute:listIndent:listItem', modelViewChangeIndent( editor.model ) );\r\n\r\n\t\tediting.downcastDispatcher.on( 'remove:listItem', modelViewRemove( editor.model ) );\r\n\t\tediting.downcastDispatcher.on( 'remove', modelViewMergeAfter, { priority: 'low' } );\r\n\t\tdata.downcastDispatcher.on( 'remove:listItem', modelViewRemove( editor.model ) );\r\n\t\tdata.downcastDispatcher.on( 'remove', modelViewMergeAfter, { priority: 'low' } );\r\n\r\n\t\tdata.upcastDispatcher.on( 'element:ul', cleanList, { priority: 'high' } );\r\n\t\tdata.upcastDispatcher.on( 'element:ol', cleanList, { priority: 'high' } );\r\n\t\tdata.upcastDispatcher.on( 'element:li', cleanListItem, { priority: 'high' } );\r\n\t\tdata.upcastDispatcher.on( 'element:li', viewModelConverter );\r\n\r\n\t\t// Fix indentation of pasted items.\r\n\t\teditor.model.on( 'insertContent', modelIndentPasteFixer, { priority: 'high' } );\r\n\r\n\t\t// Register commands for numbered and bulleted list.\r\n\t\teditor.commands.add( 'numberedList', new ListCommand( editor, 'numbered' ) );\r\n\t\teditor.commands.add( 'bulletedList', new ListCommand( editor, 'bulleted' ) );\r\n\r\n\t\t// Register commands for indenting.\r\n\t\teditor.commands.add( 'indentList', new IndentCommand( editor, 'forward' ) );\r\n\t\teditor.commands.add( 'outdentList', new IndentCommand( editor, 'backward' ) );\r\n\r\n\t\tconst viewDocument = this.editor.editing.view.document;\r\n\r\n\t\t// Overwrite default Enter key behavior.\r\n\t\t// If Enter key is pressed with selection collapsed in empty list item, outdent it instead of breaking it.\r\n\t\tthis.listenTo( viewDocument, 'enter', ( evt, data ) => {\r\n\t\t\tconst doc = this.editor.model.document;\r\n\t\t\tconst positionParent = doc.selection.getLastPosition().parent;\r\n\r\n\t\t\tif ( doc.selection.isCollapsed && positionParent.name == 'listItem' && positionParent.isEmpty ) {\r\n\t\t\t\tthis.editor.execute( 'outdentList' );\r\n\r\n\t\t\t\tdata.preventDefault();\r\n\t\t\t\tevt.stop();\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Overwrite default Backspace key behavior.\r\n\t\t// If Backspace key is pressed with selection collapsed on first position in first list item, outdent it. #83\r\n\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\r\n\t\t\t// Check conditions from those that require less computations like those immediately available.\r\n\t\t\tif ( data.direction !== 'backward' ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst selection = this.editor.model.document.selection;\r\n\r\n\t\t\tif ( !selection.isCollapsed ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst firstPosition = selection.getFirstPosition();\r\n\r\n\t\t\tif ( !firstPosition.isAtStart ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst positionParent = firstPosition.parent;\r\n\r\n\t\t\tif ( positionParent.name !== 'listItem' ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst previousIsAListItem = positionParent.previousSibling && positionParent.previousSibling.name === 'listItem';\r\n\r\n\t\t\tif ( previousIsAListItem ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.editor.execute( 'outdentList' );\r\n\r\n\t\t\tdata.preventDefault();\r\n\t\t\tevt.stop();\r\n\t\t}, { priority: 'high' } );\r\n\r\n\t\tconst getCommandExecuter = commandName => {\r\n\t\t\treturn ( data, cancel ) => {\r\n\t\t\t\tconst command = this.editor.commands.get( commandName );\r\n\r\n\t\t\t\tif ( command.isEnabled ) {\r\n\t\t\t\t\tthis.editor.execute( commandName );\r\n\t\t\t\t\tcancel();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tthis.editor.keystrokes.set( 'Tab', getCommandExecuter( 'indentList' ) );\r\n\t\tthis.editor.keystrokes.set( 'Shift+Tab', getCommandExecuter( 'outdentList' ) );\r\n\t}\r\n}\r\n\r\nfunction getViewListItemLength( element ) {\r\n\tlet length = 1;\r\n\r\n\tfor ( const child of element.getChildren() ) {\r\n\t\tif ( child.name == 'ul' || child.name == 'ol' ) {\r\n\t\t\tfor ( const item of child.getChildren() ) {\r\n\t\t\t\tlength += getViewListItemLength( item );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn length;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module list/listui\r\n */\nimport numberedListIcon from '../theme/icons/numberedlist.svg';\nimport bulletedListIcon from '../theme/icons/bulletedlist.svg';\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\n/**\r\n * The list UI feature. It introduces the `'numberedList'` and `'bulletedList'` buttons that\r\n * allow to convert paragraphs to and from list items and indent or outdent them.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class ListUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        // Create two buttons and link them with numberedList and bulletedList commands.\n        const t = this.editor.t;\n        this._addButton('numberedList', t('o'), numberedListIcon);\n        this._addButton('bulletedList', t('p'), bulletedListIcon);\n    }\n    /**\r\n\t * Helper method for initializing a button and linking it with an appropriate command.\r\n\t *\r\n\t * @private\r\n\t * @param {String} commandName The name of the command.\r\n\t * @param {Object} label The button label.\r\n\t * @param {String} icon The source of the icon.\r\n\t */\n    _addButton(commandName, label, icon) {\n        const editor = this.editor;\n        editor.ui.componentFactory.add(commandName, locale => {\n            const command = editor.commands.get(commandName);\n            const buttonView = new ButtonView(locale);\n            buttonView.set({\n                label,\n                icon,\n                tooltip: true\n            });\n            // Bind button model to command.\n            buttonView.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n            // Execute command.\n            this.listenTo(buttonView, 'execute', () => editor.execute(commandName));\n            return buttonView;\n        });\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/converters\r\n */\r\n\r\n/**\r\n * Returns a function that converts the model \"url\" attribute to the view representation.\r\n *\r\n * Depending on the configuration, the view representation can be \"semantic\" (for the data pipeline):\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<oembed url=\"foo\"></oembed>\r\n *\t\t</figure>\r\n *\r\n * or \"non-semantic\" (for the editing view pipeline):\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<div data-oembed-url=\"foo\">[ non-semantic media preview for \"foo\" ]</div>\r\n *\t\t</figure>\r\n *\r\n * **Note:** Changing the model \"url\" attribute replaces the entire content of the\r\n * `<figure>` in the view.\r\n *\r\n * @param {module:media-embed/mediaregistry~MediaRegistry} registry The registry providing\r\n * the media and their content.\r\n * @param {Object} options\r\n * @param {String} [options.renderMediaPreview] When `true`, the converter will create the view in the non-semantic form.\r\n * @param {String} [options.renderForEditingView] When `true`, the converter will create a view specific for the\r\n * editing pipeline (e.g. including CSS classes, content placeholders).\r\n * @returns {Function}\r\n */\r\nexport function modelToViewUrlAttributeConverter( registry, options ) {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'attribute:url:media', converter );\r\n\t};\r\n\r\n\tfunction converter( evt, data, conversionApi ) {\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst url = data.attributeNewValue;\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst figure = conversionApi.mapper.toViewElement( data.item );\r\n\r\n\t\t// TODO: removing it and creating it from scratch is a hack. We can do better than that.\r\n\t\tviewWriter.remove( viewWriter.createRangeIn( figure ) );\r\n\r\n\t\tconst mediaViewElement = registry.getMediaViewElement( viewWriter, url, options );\r\n\r\n\t\tviewWriter.insert( viewWriter.createPositionAt( figure, 0 ), mediaViewElement );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/utils\r\n */\r\n\r\nimport { isWidget, toWidget } from '@ckeditor/ckeditor5-widget/src/utils';\r\n\r\nconst mediaSymbol = Symbol( 'isMedia' );\r\n\r\n/**\r\n * Converts a given {@link module:engine/view/element~Element} to a media embed widget:\r\n * * Adds a {@link module:engine/view/element~Element#_setCustomProperty custom property} allowing to recognize the media widget element.\r\n * * Calls the {@link module:widget/utils~toWidget} function with the proper element's label creator.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer An instance of the view writer.\r\n * @param {String} label The element's label.\r\n * @returns {module:engine/view/element~Element}\r\n */\r\nexport function toMediaWidget( viewElement, writer, label ) {\r\n\twriter.setCustomProperty( mediaSymbol, true, viewElement );\r\n\r\n\treturn toWidget( viewElement, writer, { label } );\r\n}\r\n\r\nexport function isMediaWidgetSelected( viewSelection ) {\r\n\tconst viewElement = viewSelection.getSelectedElement();\r\n\r\n\treturn !!( viewElement && isMediaWidget( viewElement ) );\r\n}\r\n\r\nexport function isMediaWidget( viewElement ) {\r\n\treturn !!viewElement.getCustomProperty( mediaSymbol ) && isWidget( viewElement );\r\n}\r\n\r\n/**\r\n * Creates a view element representing the media. Either \"semantic\" one for the data pipeline:\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<oembed url=\"foo\"></oembed>\r\n *\t\t</figure>\r\n *\r\n * or \"non-semantic\" (for the editing view pipeline):\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<div data-oembed-url=\"foo\">[ non-semantic media preview for \"foo\" ]</div>\r\n *\t\t</figure>\r\n *\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer\r\n * @param {module:media-embed/mediaregistry~MediaRegistry} registry\r\n * @param {String} url\r\n * @param {Object} options\r\n * @param {String} [options.useSemanticWrapper]\r\n * @param {String} [options.renderForEditingView]\r\n * @returns {module:engine/view/containerelement~ContainerElement}\r\n */\r\nexport function createMediaFigureElement( writer, registry, url, options ) {\r\n\tconst figure = writer.createContainerElement( 'figure', { class: 'media' } );\r\n\r\n\t// TODO: This is a hack. Without it, the figure in the data pipeline will contain &nbsp; because\r\n\t// its only child is the UIElement (wrapper).\r\n\t//\r\n\t// Note: The hack is a copy&paste from widget utils; it makes the figure act like it's a widget.\r\n\tfigure.getFillerOffset = getFillerOffset;\r\n\r\n\twriter.insert( writer.createPositionAt( figure, 0 ), registry.getMediaViewElement( writer, url, options ) );\r\n\r\n\treturn figure;\r\n}\r\n\r\n/**\r\n * Returns a selected media element in the model, if any.\r\n *\r\n * @param {module:engine/model/selection~Selection} selection\r\n * @returns {module:engine/model/element~Element|null}\r\n */\r\nexport function getSelectedMediaElement( selection ) {\r\n\tconst selectedElement = selection.getSelectedElement();\r\n\r\n\tif ( selectedElement && selectedElement.is( 'media' ) ) {\r\n\t\treturn selectedElement;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction getFillerOffset() {\r\n\treturn null;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/mediaembedcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { findOptimalInsertionPosition } from '@ckeditor/ckeditor5-widget/src/utils';\r\nimport { getSelectedMediaElement } from './utils';\r\n\r\n/**\r\n * The insert media command.\r\n *\r\n * The command is registered by the {@link module:media-embed/mediaembedediting~MediaEmbedEditing} as `'mediaEmbed'`.\r\n *\r\n * To insert media at the current selection, execute the command and specify the URL:\r\n *\r\n *\t\teditor.execute( 'mediaEmbed', 'http://url.to.the/media' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class MediaEmbedCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\t\tconst schema = model.schema;\r\n\t\tconst position = selection.getFirstPosition();\r\n\t\tconst selectedMedia = getSelectedMediaElement( selection );\r\n\r\n\t\tlet parent = position.parent;\r\n\r\n\t\tif ( parent != parent.root ) {\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\r\n\t\tthis.value = selectedMedia ? selectedMedia.getAttribute( 'url' ) : null;\r\n\t\tthis.isEnabled = schema.checkChild( parent, 'media' );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command, which either:\r\n\t *\r\n\t * * updates the URL of the selected media,\r\n\t * * inserts the new media into the editor and puts the selection around it.\r\n\t *\r\n\t * @fires execute\r\n\t * @param {String} url The URL of the media.\r\n\t */\r\n\texecute( url ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\t\tconst selectedMedia = getSelectedMediaElement( selection );\r\n\r\n\t\tif ( selectedMedia ) {\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\twriter.setAttribute( 'url', url, selectedMedia );\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tconst insertPosition = findOptimalInsertionPosition( selection, model );\r\n\r\n\t\t\tmodel.change( writer => {\r\n\t\t\t\tconst mediaElement = writer.createElement( 'media', { url } );\r\n\r\n\t\t\t\tmodel.insertContent( mediaElement, insertPosition );\r\n\r\n\t\t\t\twriter.setSelection( mediaElement, 'on' );\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/mediaregistry\r\n */\r\n\r\nimport mediaPlaceholderIcon from '../theme/icons/media-placeholder.svg';\r\nimport log from '@ckeditor/ckeditor5-utils/src/log';\r\nimport TooltipView from '@ckeditor/ckeditor5-ui/src/tooltip/tooltipview';\r\nimport IconView from '@ckeditor/ckeditor5-ui/src/icon/iconview';\r\nimport Template from '@ckeditor/ckeditor5-ui/src/template';\r\n\r\nconst mediaPlaceholderIconViewBox = '0 0 64 42';\r\n\r\n/**\r\n * A bridge between the raw media content provider definitions and the editor view content.\r\n *\r\n * It helps translating media URLs to corresponding {@link module:engine/view/element~Element view elements}.\r\n *\r\n * Mostly used by the {@link module:media-embed/mediaembedediting~MediaEmbedEditing} plugin.\r\n */\r\nexport default class MediaRegistry {\r\n\t/**\r\n\t * Creates an instance of the {@link module:media-embed/mediaregistry~MediaRegistry} class.\r\n\t *\r\n\t * @param {module:utils/locale~Locale} locale The localization services instance.\r\n\t * @param {module:media-embed/mediaembed~MediaEmbedConfig} config The configuration of the media embed feature.\r\n\t */\r\n\tconstructor( locale, config ) {\r\n\t\tconst providers = config.providers;\r\n\t\tconst extraProviders = config.extraProviders || [];\r\n\t\tconst removedProviders = new Set( config.removeProviders );\r\n\t\tconst providerDefinitions = providers\r\n\t\t\t.concat( extraProviders )\r\n\t\t\t.filter( provider => {\r\n\t\t\t\tconst name = provider.name;\r\n\r\n\t\t\t\tif ( !name ) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * One of the providers (or extra providers) specified in the media embed configuration\r\n\t\t\t\t\t * has no name and will not be used by the editor. In order to get this media\r\n\t\t\t\t\t * provider working, double check your editor configuration.\r\n\t\t\t\t\t *\r\n\t\t\t\t\t * @warning media-embed-no-provider-name\r\n\t\t\t\t\t */\r\n\t\t\t\t\tlog.warn( 'media-embed-no-provider-name: The configured media provider has no name and cannot be used.',\r\n\t\t\t\t\t\t{ provider } );\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn !removedProviders.has( name );\r\n\t\t\t} );\r\n\r\n\t\t/**\r\n\t\t * The locale {@link module:utils/locale~Locale} instance.\r\n\t\t *\r\n\t\t * @member {module:utils/locale~Locale}\r\n\t\t */\r\n\t\tthis.locale = locale;\r\n\r\n\t\t/**\r\n\t\t * The media provider definitions available for the registry. Usually corresponding with the\r\n\t\t * {@link module:media-embed/mediaembed~MediaEmbedConfig media configuration}.\r\n\t\t *\r\n\t\t * @member {Array}\r\n\t\t */\r\n\t\tthis.providerDefinitions = providerDefinitions;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the passed URL is representing a certain media type allowed in the editor.\r\n\t *\r\n\t * @param {String} url The URL to be checked\r\n\t * @returns {Boolean}\r\n\t */\r\n\thasMedia( url ) {\r\n\t\treturn !!this._getMedia( url );\r\n\t}\r\n\r\n\t/**\r\n\t * For the given media URL string and options, it returns the {@link module:engine/view/element~Element view element}\r\n\t * representing that media.\r\n\t *\r\n\t * **Note:** If no URL is specified, an empty view element is returned.\r\n\t *\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer The view writer used to produce a view element.\r\n\t * @param {String} url The URL to be translated into a view element.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.renderMediaPreview]\r\n\t * @param {String} [options.renderForEditingView]\r\n\t * @returns {module:engine/view/element~Element}\r\n\t */\r\n\tgetMediaViewElement( writer, url, options ) {\r\n\t\treturn this._getMedia( url ).getViewElement( writer, options );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a `Media` instance for the given URL.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} url The URL of the media.\r\n\t * @returns {module:media-embed/mediaregistry~Media|null} The `Media` instance or `null` when there is none.\r\n\t */\r\n\t_getMedia( url ) {\r\n\t\tif ( !url ) {\r\n\t\t\treturn new Media( this.locale );\r\n\t\t}\r\n\r\n\t\turl = url.trim();\r\n\r\n\t\tfor ( const definition of this.providerDefinitions ) {\r\n\t\t\tconst previewRenderer = definition.html;\r\n\t\t\tlet pattern = definition.url;\r\n\r\n\t\t\tif ( !Array.isArray( pattern ) ) {\r\n\t\t\t\tpattern = [ pattern ];\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const subPattern of pattern ) {\r\n\t\t\t\tconst match = this._getUrlMatches( url, subPattern );\r\n\r\n\t\t\t\tif ( match ) {\r\n\t\t\t\t\treturn new Media( this.locale, url, match, previewRenderer );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to match `url` to `pattern`.\r\n\t *\r\n\t * @private\r\n\t * @param {String} url The URL of the media.\r\n\t * @param {RegExp} pattern The pattern that should accept the media URL.\r\n\t * @returns {Array|null}\r\n\t */\r\n\t_getUrlMatches( url, pattern ) {\r\n\t\t// 1. Try to match without stripping the protocol and \"www\" subdomain.\r\n\t\tlet match = url.match( pattern );\r\n\r\n\t\tif ( match ) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\t// 2. Try to match after stripping the protocol.\r\n\t\tlet rawUrl = url.replace( /^https?:\\/\\//, '' );\r\n\t\tmatch = rawUrl.match( pattern );\r\n\r\n\t\tif ( match ) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\t// 3. Try to match after stripping the \"www\" subdomain.\r\n\t\trawUrl = rawUrl.replace( /^www\\./, '' );\r\n\t\tmatch = rawUrl.match( pattern );\r\n\r\n\t\tif ( match ) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n/**\r\n * Represents media defined by the provider configuration.\r\n *\r\n * It can be rendered to the {@link module:engine/view/element~Element view element} and used in the editing or data pipeline.\r\n *\r\n * @private\r\n */\r\nclass Media {\r\n\tconstructor( locale, url, match, previewRenderer ) {\r\n\t\t/**\r\n\t\t * The URL this Media instance represents.\r\n\t\t *\r\n\t\t * @member {String}\r\n\t\t */\r\n\t\tthis.url = this._getValidUrl( url );\r\n\r\n\t\t/**\r\n\t\t * Shorthand for {@link module:utils/locale~Locale#t}.\r\n\t\t *\r\n\t\t * @see module:utils/locale~Locale#t\r\n\t\t * @method\r\n\t\t */\r\n\t\tthis._t = locale.t;\r\n\r\n\t\t/**\r\n\t\t * The output of the `RegExp.match` which validated the {@link #url} of this media.\r\n\t\t *\r\n\t\t * @member {Object}\r\n\t\t */\r\n\t\tthis._match = match;\r\n\r\n\t\t/**\r\n\t\t * The function returning the HTML string preview of this media.\r\n\t\t *\r\n\t\t * @member {Function}\r\n\t\t */\r\n\t\tthis._previewRenderer = previewRenderer;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the view element representation of the media.\r\n\t *\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer The view writer used to produce a view element.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.renderMediaPreview]\r\n\t * @param {String} [options.renderForEditingView]\r\n\t * @returns {module:engine/view/element~Element}\r\n\t */\r\n\tgetViewElement( writer, options ) {\r\n\t\tconst attributes = {};\r\n\r\n\t\tif ( options.renderForEditingView || ( options.renderMediaPreview && this.url && this._previewRenderer ) ) {\r\n\t\t\tif ( this.url ) {\r\n\t\t\t\tattributes[ 'data-oembed-url' ] = this.url;\r\n\t\t\t}\r\n\r\n\t\t\tif ( options.renderForEditingView ) {\r\n\t\t\t\tattributes.class = 'ck-media__wrapper';\r\n\t\t\t}\r\n\r\n\t\t\tconst mediaHtml = this._getPreviewHtml( options );\r\n\r\n\t\t\treturn writer.createUIElement( 'div', attributes, function( domDocument ) {\r\n\t\t\t\tconst domElement = this.toDomElement( domDocument );\r\n\r\n\t\t\t\tdomElement.innerHTML = mediaHtml;\r\n\r\n\t\t\t\treturn domElement;\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tif ( this.url ) {\r\n\t\t\t\tattributes.url = this.url;\r\n\t\t\t}\r\n\r\n\t\t\treturn writer.createEmptyElement( 'oembed', attributes );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the HTML string of the media content preview.\r\n\t *\r\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer The view writer used to produce a view element.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.renderForEditingView]\r\n\t * @returns {String}\r\n\t */\r\n\t_getPreviewHtml( options ) {\r\n\t\tif ( this._previewRenderer ) {\r\n\t\t\treturn this._previewRenderer( this._match );\r\n\t\t} else {\r\n\t\t\t// The placeholder only makes sense for editing view and media which have URLs.\r\n\t\t\t// Placeholder is never displayed in data and URL-less media have no content.\r\n\t\t\tif ( this.url && options.renderForEditingView ) {\r\n\t\t\t\treturn this._getPlaceholderHtml();\r\n\t\t\t}\r\n\r\n\t\t\treturn '';\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the placeholder HTML when the media has no content preview.\r\n\t *\r\n\t * @returns {String}\r\n\t */\r\n\t_getPlaceholderHtml() {\r\n\t\tconst tooltip = new TooltipView();\r\n\t\tconst icon = new IconView();\r\n\r\n\t\ttooltip.text = this._t( 'Open media in new tab' );\r\n\t\ticon.content = mediaPlaceholderIcon;\r\n\t\ticon.viewBox = mediaPlaceholderIconViewBox;\r\n\r\n\t\tconst placeholder = new Template( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: 'ck ck-reset_all ck-media__placeholder'\r\n\t\t\t},\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: 'ck-media__placeholder__icon'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchildren: [ icon ]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'a',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: 'ck-media__placeholder__url',\r\n\t\t\t\t\t\ttarget: 'new',\r\n\t\t\t\t\t\thref: this.url\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttag: 'span',\r\n\t\t\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t\t\tclass: 'ck-media__placeholder__url__text'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tchildren: [ this.url ]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t} ).render();\r\n\r\n\t\treturn placeholder.outerHTML;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the full URL to the specified media.\r\n\t *\r\n\t * @param {String} url The URL of the media.\r\n\t * @returns {String|null}\r\n\t */\r\n\t_getValidUrl( url ) {\r\n\t\tif ( !url ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif ( url.match( /^https?/ ) ) {\r\n\t\t\treturn url;\r\n\t\t}\r\n\r\n\t\treturn 'https://' + url;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module media-embed/mediaembedediting\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport { modelToViewUrlAttributeConverter } from './converters';\nimport MediaEmbedCommand from './mediaembedcommand';\nimport MediaRegistry from './mediaregistry';\nimport {\n    toMediaWidget,\n    createMediaFigureElement\n} from './utils';\nimport { downcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/downcast-converters';\nimport { upcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\nimport '../theme/mediaembedediting.css';\n/**\r\n * The media embed editing feature.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class MediaEmbedEditing extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    constructor(editor) {\n        super(editor);\n        editor.config.define('mediaEmbed', {\n            providers: [\n                {\n                    name: 'dailymotion',\n                    url: /^dailymotion\\.com\\/video\\/(\\w+)/,\n                    html: match => {\n                        const id = match[1];\n                        return '<div style=\"position: relative; padding-bottom: 100%; height: 0; \">' + `<iframe src=\"https://www.dailymotion.com/embed/video/${ id }\" ` + 'style=\"position: absolute; width: 100%; height: 100%; top: 0; left: 0;\" ' + 'frameborder=\"0\" width=\"480\" height=\"270\" allowfullscreen allow=\"autoplay\">' + '</iframe>' + '</div>';\n                    }\n                },\n                {\n                    name: 'spotify',\n                    url: [\n                        /^open\\.spotify\\.com\\/(artist\\/\\w+)/,\n                        /^open\\.spotify\\.com\\/(album\\/\\w+)/,\n                        /^open\\.spotify\\.com\\/(track\\/\\w+)/\n                    ],\n                    html: match => {\n                        const id = match[1];\n                        return '<div style=\"position: relative; padding-bottom: 100%; height: 0; padding-bottom: 126%;\">' + `<iframe src=\"https://open.spotify.com/embed/${ id }\" ` + 'style=\"position: absolute; width: 100%; height: 100%; top: 0; left: 0;\" ' + 'frameborder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\">' + '</iframe>' + '</div>';\n                    }\n                },\n                {\n                    name: 'youtube',\n                    url: [\n                        /^youtube\\.com\\/watch\\?v=([\\w-]+)/,\n                        /^youtube\\.com\\/v\\/([\\w-]+)/,\n                        /^youtube\\.com\\/embed\\/([\\w-]+)/,\n                        /^youtu\\.be\\/([\\w-]+)/\n                    ],\n                    html: match => {\n                        const id = match[1];\n                        return '<div style=\"position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;\">' + `<iframe src=\"https://www.youtube.com/embed/${ id }\" ` + 'style=\"position: absolute; width: 100%; height: 100%; top: 0; left: 0;\" ' + 'frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen>' + '</iframe>' + '</div>';\n                    }\n                },\n                {\n                    name: 'vimeo',\n                    url: [\n                        /^vimeo\\.com\\/(\\d+)/,\n                        /^vimeo\\.com\\/[^/]+\\/[^/]+\\/video\\/(\\d+)/,\n                        /^vimeo\\.com\\/album\\/[^/]+\\/video\\/(\\d+)/,\n                        /^vimeo\\.com\\/channels\\/[^/]+\\/(\\d+)/,\n                        /^vimeo\\.com\\/groups\\/[^/]+\\/videos\\/(\\d+)/,\n                        /^vimeo\\.com\\/ondemand\\/[^/]+\\/(\\d+)/,\n                        /^player\\.vimeo\\.com\\/video\\/(\\d+)/\n                    ],\n                    html: match => {\n                        const id = match[1];\n                        return '<div style=\"position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;\">' + `<iframe src=\"https://player.vimeo.com/video/${ id }\" ` + 'style=\"position: absolute; width: 100%; height: 100%; top: 0; left: 0;\" ' + 'frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen>' + '</iframe>' + '</div>';\n                    }\n                },\n                {\n                    name: 'instagram',\n                    url: /^instagram\\.com\\/p\\/(\\w+)/\n                },\n                {\n                    name: 'twitter',\n                    url: /^twitter\\.com/\n                },\n                {\n                    name: 'googleMaps',\n                    url: /^google\\.com\\/maps/\n                },\n                {\n                    name: 'flickr',\n                    url: /^flickr\\.com/\n                },\n                {\n                    name: 'facebook',\n                    url: /^facebook\\.com/\n                }\n            ]\n        });\n        /**\r\n\t\t * The media registry managing the media providers in the editor.\r\n\t\t *\r\n\t\t * @member {module:media-embed/mediaregistry~MediaRegistry} #registry\r\n\t\t */\n        this.registry = new MediaRegistry(editor.locale, editor.config.get('mediaEmbed'));\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        const t = editor.t;\n        const conversion = editor.conversion;\n        const renderMediaPreview = editor.config.get('mediaEmbed.previewsInData');\n        const registry = this.registry;\n        editor.commands.add('mediaEmbed', new MediaEmbedCommand(editor));\n        // Configure the schema.\n        schema.register('media', {\n            isObject: true,\n            isBlock: true,\n            allowWhere: '$block',\n            allowAttributes: ['url']\n        });\n        // Model -> Data\n        conversion.for('dataDowncast').add(downcastElementToElement({\n            model: 'media',\n            view: (modelElement, viewWriter) => {\n                const url = modelElement.getAttribute('url');\n                return createMediaFigureElement(viewWriter, registry, url, { renderMediaPreview: url && renderMediaPreview });\n            }\n        }));\n        // Model -> Data (url -> data-oembed-url)\n        conversion.for('dataDowncast').add(modelToViewUrlAttributeConverter(registry, { renderMediaPreview }));\n        // Model -> View (element)\n        conversion.for('editingDowncast').add(downcastElementToElement({\n            model: 'media',\n            view: (modelElement, viewWriter) => {\n                const url = modelElement.getAttribute('url');\n                const figure = createMediaFigureElement(viewWriter, registry, url, { renderForEditingView: true });\n                return toMediaWidget(figure, viewWriter, t('ak'));\n            }\n        }));\n        // Model -> View (url -> data-oembed-url)\n        conversion.for('editingDowncast').add(modelToViewUrlAttributeConverter(registry, { renderForEditingView: true }));\n        // View -> Model (data-oembed-url -> url)\n        conversion.for('upcast')    // Upcast semantic media.\n.add(upcastElementToElement({\n            view: {\n                name: 'oembed',\n                attributes: { url: true }\n            },\n            model: (viewMedia, modelWriter) => {\n                const url = viewMedia.getAttribute('url');\n                if (registry.hasMedia(url)) {\n                    return modelWriter.createElement('media', { url });\n                }\n            }\n        }))    // Upcast non-semantic media.\n.add(upcastElementToElement({\n            view: {\n                name: 'div',\n                attributes: { 'data-oembed-url': true }\n            },\n            model: (viewMedia, modelWriter) => {\n                const url = viewMedia.getAttribute('data-oembed-url');\n                if (registry.hasMedia(url)) {\n                    return modelWriter.createElement('media', { url });\n                }\n            }\n        }));\n    }\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/automediaembed\r\n */\r\n\r\nimport MediaEmbedEditing from './mediaembedediting';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Clipboard from '@ckeditor/ckeditor5-clipboard/src/clipboard';\r\nimport LiveRange from '@ckeditor/ckeditor5-engine/src/model/liverange';\r\nimport LivePosition from '@ckeditor/ckeditor5-engine/src/model/liveposition';\r\nimport Undo from '@ckeditor/ckeditor5-undo/src/undo';\r\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\r\n\r\nconst URL_REGEXP = /^(?:http(s)?:\\/\\/)?[\\w.-]+(?:\\.[\\w.-]+)+[\\w\\-._~:/?#[\\]@!$&'()*+,;=]+$/;\r\n\r\n/**\r\n * The auto-media embed plugin. It recognizes media links in the pasted content and embeds\r\n * them shortly after they are injected into the document.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class AutoMediaEmbed extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ Clipboard, Undo ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'AutoMediaEmbed';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( editor ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The paste–to–embed `setTimeout` ID. Stored as a property to allow\r\n\t\t * cleaning of the timeout.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {Number} #_timeoutId\r\n\t\t */\r\n\t\tthis._timeoutId = null;\r\n\r\n\t\t/**\r\n\t\t * The position where the `<media>` element will be inserted after the timeout,\r\n\t\t * determined each time the new content is pasted into the document.\r\n\t\t *\r\n\t\t * @private\r\n\t\t * @member {module:engine/model/liveposition~LivePosition} #_positionToInsert\r\n\t\t */\r\n\t\tthis._positionToInsert = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst modelDocument = editor.model.document;\r\n\r\n\t\t// We need to listen on `Clipboard#inputTransformation` because we need to save positions of selection.\r\n\t\t// After pasting, the content between those positions will be checked for a URL that could be transformed\r\n\t\t// into media.\r\n\t\tthis.listenTo( editor.plugins.get( Clipboard ), 'inputTransformation', () => {\r\n\t\t\tconst firstRange = modelDocument.selection.getFirstRange();\r\n\r\n\t\t\tconst leftLivePosition = LivePosition.fromPosition( firstRange.start );\r\n\t\t\tleftLivePosition.stickiness = 'toPrevious';\r\n\r\n\t\t\tconst rightLivePosition = LivePosition.fromPosition( firstRange.end );\r\n\t\t\trightLivePosition.stickiness = 'toNext';\r\n\r\n\t\t\tmodelDocument.once( 'change:data', () => {\r\n\t\t\t\tthis._embedMediaBetweenPositions( leftLivePosition, rightLivePosition );\r\n\r\n\t\t\t\tleftLivePosition.detach();\r\n\t\t\t\trightLivePosition.detach();\r\n\t\t\t}, { priority: 'high' } );\r\n\t\t} );\r\n\r\n\t\teditor.commands.get( 'undo' ).on( 'execute', () => {\r\n\t\t\tif ( this._timeoutId ) {\r\n\t\t\t\tglobal.window.clearTimeout( this._timeoutId );\r\n\t\t\t\tthis._positionToInsert.detach();\r\n\r\n\t\t\t\tthis._timeoutId = null;\r\n\t\t\t\tthis._positionToInsert = null;\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Analyzes the part of the document between provided positions in search for a URL representing media.\r\n\t * When the URL is found, it is automatically converted into media.\r\n\t *\r\n\t * @protected\r\n\t * @param {module:engine/model/liveposition~LivePosition} leftPosition Left position of the selection.\r\n\t * @param {module:engine/model/liveposition~LivePosition} rightPosition Right position of the selection.\r\n\t */\r\n\t_embedMediaBetweenPositions( leftPosition, rightPosition ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst mediaRegistry = editor.plugins.get( MediaEmbedEditing ).registry;\r\n\t\t// TODO: Use marker instead of LiveRange & LivePositions.\r\n\t\tconst urlRange = new LiveRange( leftPosition, rightPosition );\r\n\t\tconst walker = urlRange.getWalker( { ignoreElementEnd: true } );\r\n\r\n\t\tlet url = '';\r\n\r\n\t\tfor ( const node of walker ) {\r\n\t\t\tif ( node.item.is( 'textProxy' ) ) {\r\n\t\t\t\turl += node.item.data;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\turl = url.trim();\r\n\r\n\t\t// If the URL does not match to universal URL regexp, let's skip that.\r\n\t\tif ( !url.match( URL_REGEXP ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If the URL represents a media, let's use it.\r\n\t\tif ( !mediaRegistry.hasMedia( url ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst mediaEmbedCommand = editor.commands.get( 'mediaEmbed' );\r\n\r\n\t\t// Do not anything if media element cannot be inserted at the current position (#47).\r\n\t\tif ( !mediaEmbedCommand.isEnabled ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Position won't be available in the `setTimeout` function so let's clone it.\r\n\t\tthis._positionToInsert = LivePosition.fromPosition( leftPosition );\r\n\r\n\t\t// This action mustn't be executed if undo was called between pasting and auto-embedding.\r\n\t\tthis._timeoutId = global.window.setTimeout( () => {\r\n\t\t\teditor.model.change( writer => {\r\n\t\t\t\tthis._timeoutId = null;\r\n\r\n\t\t\t\twriter.remove( urlRange );\r\n\r\n\t\t\t\t// Check if position where the media element should be inserted is still valid.\r\n\t\t\t\tif ( this._positionToInsert.root.rootName !== '$graveyard' ) {\r\n\t\t\t\t\twriter.setSelection( this._positionToInsert );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmediaEmbedCommand.execute( url );\r\n\r\n\t\t\t\tthis._positionToInsert.detach();\r\n\t\t\t\tthis._positionToInsert = null;\r\n\t\t\t} );\r\n\t\t}, 100 );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module media-embed/ui/mediaformview\r\n */\nimport View from '@ckeditor/ckeditor5-ui/src/view';\nimport ViewCollection from '@ckeditor/ckeditor5-ui/src/viewcollection';\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport LabeledInputView from '@ckeditor/ckeditor5-ui/src/labeledinput/labeledinputview';\nimport InputTextView from '@ckeditor/ckeditor5-ui/src/inputtext/inputtextview';\nimport submitHandler from '@ckeditor/ckeditor5-ui/src/bindings/submithandler';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '@ckeditor/ckeditor5-ui/src/focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport checkIcon from '@ckeditor/ckeditor5-core/theme/icons/check.svg';\nimport cancelIcon from '@ckeditor/ckeditor5-core/theme/icons/cancel.svg';\nimport '../../theme/mediaform.css';\n/**\r\n * The media form view controller class.\r\n *\r\n * See {@link module:media-embed/ui/mediaformview~MediaFormView}.\r\n *\r\n * @extends module:ui/view~View\r\n */\nexport default class MediaFormView extends View {\n    /**\r\n\t * @param {Array.<Function>} validators Form validators used by {@link #isValid}.\r\n\t * @param {module:utils/locale~Locale} [locale] The localization services instance.\r\n\t */\n    constructor(validators, locale) {\n        super(locale);\n        const t = locale.t;\n        /**\r\n\t\t * Tracks information about DOM focus in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/focustracker~FocusTracker}\r\n\t\t */\n        this.focusTracker = new FocusTracker();\n        /**\r\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\r\n\t\t */\n        this.keystrokes = new KeystrokeHandler();\n        /**\r\n\t\t * The URL input view.\r\n\t\t *\r\n\t\t * @member {module:ui/labeledinput/labeledinputview~LabeledInputView}\r\n\t\t */\n        this.urlInputView = this._createUrlInput();\n        /**\r\n\t\t * The Save button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.saveButtonView = this._createButton(t('bd'), checkIcon, 'ck-button-save');\n        this.saveButtonView.type = 'submit';\n        /**\r\n\t\t * The Cancel button view.\r\n\t\t *\r\n\t\t * @member {module:ui/button/buttonview~ButtonView}\r\n\t\t */\n        this.cancelButtonView = this._createButton(t('be'), cancelIcon, 'ck-button-cancel', 'cancel');\n        /**\r\n\t\t * A collection of views that can be focused in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\n        this._focusables = new ViewCollection();\n        /**\r\n\t\t * Helps cycling over {@link #_focusables} in the form.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {module:ui/focuscycler~FocusCycler}\r\n\t\t */\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        /**\r\n\t\t * An array of form validators used by {@link #isValid}.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @protected\r\n\t\t * @member {Array.<Function>}\r\n\t\t */\n        this._validators = validators;\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-media-form'\n                ],\n                tabindex: '-1'\n            },\n            children: [\n                this.urlInputView,\n                this.saveButtonView,\n                this.cancelButtonView\n            ]\n        });\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    render() {\n        super.render();\n        submitHandler({ view: this });\n        const childViews = [\n            this.urlInputView,\n            this.saveButtonView,\n            this.cancelButtonView\n        ];\n        childViews.forEach(v => {\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n        // Start listening for the keystrokes coming from #element.\n        this.keystrokes.listenTo(this.element);\n        const stopPropagation = data => data.stopPropagation();\n        // Since the form is in the dropdown panel which is a child of the toolbar, the toolbar's\n        // keystroke handler would take over the key management in the URL input. We need to prevent\n        // this ASAP. Otherwise, the basic caret movement using the arrow keys will be impossible.\n        this.keystrokes.set('arrowright', stopPropagation);\n        this.keystrokes.set('arrowleft', stopPropagation);\n        this.keystrokes.set('arrowup', stopPropagation);\n        this.keystrokes.set('arrowdown', stopPropagation);\n        // Intercept the \"selectstart\" event, which is blocked by default because of the default behavior\n        // of the DropdownView#panelView.\n        // TODO: blocking \"selectstart\" in the #panelView should be configurable per–drop–down instance.\n        this.listenTo(this.urlInputView.element, 'selectstart', (evt, domEvt) => {\n            domEvt.stopPropagation();\n        }, { priority: 'high' });\n    }\n    /**\r\n\t * Focuses the fist {@link #_focusables} in the form.\r\n\t */\n    focus() {\n        this._focusCycler.focusFirst();\n    }\n    /**\r\n\t * The native DOM `value` of the {@link #urlInputView} element.\r\n\t *\r\n\t * **Note**: Do not confuse it with the {@link module:ui/inputtext/inputtextview~InputTextView#value}\r\n\t * which works one way only and may not represent the actual state of the component in the DOM.\r\n\t *\r\n\t * @type {Number}\r\n\t */\n    get url() {\n        return this.urlInputView.inputView.element.value.trim();\n    }\n    /**\r\n\t * Sets the native DOM `value` of the {@link #urlInputView} element.\r\n\t *\r\n\t * **Note**: Do not confuse it with the {@link module:ui/inputtext/inputtextview~InputTextView#value}\r\n\t * which works one way only and may not represent the actual state of the component in the DOM.\r\n\t *\r\n\t * @param {String} url\r\n\t */\n    set url(url) {\n        this.urlInputView.inputView.element.value = url.trim();\n    }\n    /**\r\n\t * Validates the form and returns `false` when some fields are invalid.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t */\n    isValid() {\n        this.resetFormStatus();\n        for (const validator of this._validators) {\n            const errorText = validator(this);\n            // One error per field is enough.\n            if (errorText) {\n                // Apply updated error.\n                this.urlInputView.errorText = errorText;\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\r\n\t * Cleans up the supplementary error and information text of the {@link #urlInputView}\r\n\t * bringing them back to the state when the form has been displayed for the first time.\r\n\t *\r\n\t * See {@link #isValid}.\r\n\t */\n    resetFormStatus() {\n        this.urlInputView.errorText = null;\n        this.urlInputView.infoText = null;\n    }\n    /**\r\n\t * Creates a labeled input view.\r\n\t *\r\n\t * @private\r\n\t * @returns {module:ui/labeledinput/labeledinputview~LabeledInputView} Labeled input view instance.\r\n\t */\n    _createUrlInput() {\n        const t = this.locale.t;\n        const labeledInput = new LabeledInputView(this.locale, InputTextView);\n        const inputView = labeledInput.inputView;\n        labeledInput.label = t('bl');\n        inputView.placeholder = 'https://example.com';\n        inputView.on('input', () => {\n            // Display the #infoText only when there's some value to hide it when the input\n            // is empty, e.g. user used backspace to clean it up.\n            labeledInput.infoText = inputView.element.value ? t('bm') : null;\n        });\n        return labeledInput;\n    }\n    /**\r\n\t * Creates a button view.\r\n\t *\r\n\t * @private\r\n\t * @param {String} label The button label.\r\n\t * @param {String} icon The button icon.\r\n\t * @param {String} className The additional button CSS class name.\r\n\t * @param {String} [eventName] An event name that the `ButtonView#execute` event will be delegated to.\r\n\t * @returns {module:ui/button/buttonview~ButtonView} The button view instance.\r\n\t */\n    _createButton(label, icon, className, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.extendTemplate({ attributes: { class: className } });\n        if (eventName) {\n            button.delegate('execute').to(this, eventName);\n        }\n        return button;\n    }\n}    /**\r\n * Fired when the form view is submitted (when one of the children triggered the submit event),\r\n * e.g. click on {@link #saveButtonView}.\r\n *\r\n * @event submit\r\n */\n     /**\r\n * Fired when the form view is canceled, e.g. click on {@link #cancelButtonView}.\r\n *\r\n * @event cancel\r\n */","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module media-embed/mediaembedui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport { createDropdown } from '@ckeditor/ckeditor5-ui/src/dropdown/utils';\nimport MediaFormView from './ui/mediaformview';\nimport MediaEmbedEditing from './mediaembedediting';\nimport mediaIcon from '../theme/icons/media.svg';\n/**\r\n * The media embed UI plugin.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class MediaEmbedUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    static get requires() {\n        return [MediaEmbedEditing];\n    }\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const command = editor.commands.get('mediaEmbed');\n        const registry = editor.plugins.get(MediaEmbedEditing).registry;\n        // Setup `imageUpload` button.\n        editor.ui.componentFactory.add('mediaEmbed', locale => {\n            const form = new MediaFormView(getFormValidators(editor.t, registry), locale);\n            const dropdown = createDropdown(locale);\n            this._setUpDropdown(dropdown, form, command, editor);\n            this._setUpForm(form, dropdown, command);\n            return dropdown;\n        });\n    }\n    _setUpDropdown(dropdown, form, command) {\n        const editor = this.editor;\n        const t = editor.t;\n        const button = dropdown.buttonView;\n        dropdown.bind('isEnabled').to(command);\n        dropdown.panelView.children.add(form);\n        button.set({\n            label: t('al'),\n            icon: mediaIcon,\n            tooltip: true\n        });\n        // Note: Use the low priority to make sure the following listener starts working after the\n        // default action of the drop-down is executed (i.e. the panel showed up). Otherwise, the\n        // invisible form/input cannot be focused/selected.\n        button.on('open', () => {\n            // Make sure that each time the panel shows up, the URL field remains in sync with the value of\n            // the command. If the user typed in the input, then canceled (`urlInputView#value` stays\n            // unaltered) and re-opened it without changing the value of the media command (e.g. because they\n            // didn't change the selection), they would see the old value instead of the actual value of the\n            // command.\n            form.url = command.value || '';\n            form.urlInputView.select();\n            form.focus();\n        }, { priority: 'low' });\n        dropdown.on('submit', () => {\n            if (form.isValid()) {\n                editor.execute('mediaEmbed', form.url);\n                closeUI();\n            }\n        });\n        dropdown.on('change:isOpen', () => form.resetFormStatus());\n        dropdown.on('cancel', () => closeUI());\n        function closeUI() {\n            editor.editing.view.focus();\n            dropdown.isOpen = false;\n        }\n    }\n    _setUpForm(form, dropdown, command) {\n        form.delegate('submit', 'cancel').to(dropdown);\n        form.urlInputView.bind('value').to(command, 'value');\n        // Form elements should be read-only when corresponding commands are disabled.\n        form.urlInputView.bind('isReadOnly').to(command, 'isEnabled', value => !value);\n        form.saveButtonView.bind('isEnabled').to(command);\n    }\n}\nfunction getFormValidators(t, registry) {\n    return [\n        form => {\n            if (!form.url.length) {\n                return t('am');\n            }\n        },\n        form => {\n            if (!registry.hasMedia(form.url)) {\n                return t('an');\n            }\n        }\n    ];\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paste-from-office/filters/space\r\n */\r\n\r\n/**\r\n * Replaces last space preceding elements closing tag with `&nbsp;`. Such operation prevents spaces from being removed\r\n * during further DOM/View processing (see especially {@link module:engine/view/domconverter~DomConverter#_processDataFromDomText}).\r\n * This method also takes into account Word specific `<o:p></o:p>` empty tags.\r\n * Additionally multiline sequences of spaces and new lines between tags are removed (see #39 and #40).\r\n *\r\n * @param {String} htmlString HTML string in which spacing should be normalized.\r\n * @returns {String} Input HTML with spaces normalized.\r\n */\r\nexport function normalizeSpacing( htmlString ) {\r\n\treturn normalizeSafariSpaceSpans( normalizeSafariSpaceSpans( htmlString ) ) // Run normalization two times to cover nested spans.\r\n\t\t.replace( / <\\//g, '\\u00A0</' )\r\n\t\t.replace( / <o:p><\\/o:p>/g, '\\u00A0<o:p></o:p>' )\r\n\t\t.replace( />(\\s*(\\r\\n?|\\n)\\s*)+</g, '><' );\r\n}\r\n\r\n/**\r\n * Normalizes spacing in special Word `spacerun spans` (`<span style='mso-spacerun:yes'>\\s+</span>`) by replacing\r\n * all spaces with `&nbsp; ` pairs. This prevents spaces from being removed during further DOM/View processing\r\n * (see especially {@link module:engine/view/domconverter~DomConverter#_processDataFromDomText}).\r\n *\r\n * @param {Document} htmlDocument Native `Document` object in which spacing should be normalized.\r\n */\r\nexport function normalizeSpacerunSpans( htmlDocument ) {\r\n\thtmlDocument.querySelectorAll( 'span[style*=spacerun]' ).forEach( el => {\r\n\t\t// Use `el.childNodes[ 0 ].data.length` instead of `el.innerText.length`. For `el.innerText.length` which\r\n\t\t// contains spaces mixed with `&nbsp;` Edge browser returns incorrect length.\r\n\t\tconst innerTextLength = el.childNodes[ 0 ].data.length;\r\n\r\n\t\tel.innerHTML = Array( innerTextLength + 1 ).join( '\\u00A0 ' ).substr( 0, innerTextLength );\r\n\t} );\r\n}\r\n\r\n// Normalizes specific spacing generated by Safari when content pasted from Word (`<span class=\"Apple-converted-space\"> </span>`)\r\n// by replacing all spaces sequences longer than 1 space with `&nbsp; ` pairs. This prevents spaces from being removed during\r\n// further DOM/View processing (see especially {@link module:engine/view/domconverter~DomConverter#_processDataFromDomText}).\r\n//\r\n// This function is similar to {@link module:clipboard/utils/normalizeclipboarddata normalizeClipboardData util} but uses\r\n// regular spaces / &nbsp; sequence for replacement.\r\n//\r\n// @param {String} htmlString HTML string in which spacing should be normalized\r\n// @returns {String} Input HTML with spaces normalized.\r\nfunction normalizeSafariSpaceSpans( htmlString ) {\r\n\treturn htmlString.replace( /<span(?: class=\"Apple-converted-space\"|)>(\\s+)<\\/span>/g, ( fullMatch, spaces ) => {\r\n\t\treturn spaces.length === 1 ? ' ' : Array( spaces.length + 1 ).join( '\\u00A0 ' ).substr( 0, spaces.length );\r\n\t} );\r\n}\r\n\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paste-from-office/filters/parse\r\n */\r\n\r\n/* globals DOMParser */\r\n\r\nimport DomConverter from '@ckeditor/ckeditor5-engine/src/view/domconverter';\r\nimport { NBSP_FILLER } from '@ckeditor/ckeditor5-engine/src/view/filler';\r\n\r\nimport { normalizeSpacing, normalizeSpacerunSpans } from './space';\r\n\r\n/**\r\n * Parses provided HTML extracting contents of `<body>` and `<style>` tags.\r\n *\r\n * @param {String} htmlString HTML string to be parsed.\r\n * @returns {Object} result\r\n * @returns {module:engine/view/documentfragment~DocumentFragment} result.body Parsed body\r\n * content as a traversable structure.\r\n * @returns {String} result.bodyString Entire body content as a string.\r\n * @returns {Array.<CSSStyleSheet>} result.styles Array of native `CSSStyleSheet` objects, each representing\r\n * separate `style` tag from the source HTML.\r\n * @returns {String} result.stylesString All `style` tags contents combined in the order of occurrence into one string.\r\n */\r\nexport function parseHtml( htmlString ) {\r\n\tconst domParser = new DOMParser();\r\n\r\n\t// Remove Word specific \"if comments\" so content inside is not omitted by the parser.\r\n\thtmlString = htmlString.replace( /<!--\\[if gte vml 1]>/g, '' );\r\n\r\n\tconst normalizedHtml = normalizeSpacing( cleanContentAfterBody( htmlString ) );\r\n\r\n\t// Parse htmlString as native Document object.\r\n\tconst htmlDocument = domParser.parseFromString( normalizedHtml, 'text/html' );\r\n\r\n\tnormalizeSpacerunSpans( htmlDocument );\r\n\r\n\t// Get `innerHTML` first as transforming to View modifies the source document.\r\n\tconst bodyString = htmlDocument.body.innerHTML;\r\n\r\n\t// Transform document.body to View.\r\n\tconst bodyView = documentToView( htmlDocument );\r\n\r\n\t// Extract stylesheets.\r\n\tconst stylesObject = extractStyles( htmlDocument );\r\n\r\n\treturn {\r\n\t\tbody: bodyView,\r\n\t\tbodyString,\r\n\t\tstyles: stylesObject.styles,\r\n\t\tstylesString: stylesObject.stylesString\r\n\t};\r\n}\r\n\r\n// Transforms native `Document` object into {@link module:engine/view/documentfragment~DocumentFragment}.\r\n//\r\n// @param {Document} htmlDocument Native `Document` object to be transformed.\r\n// @returns {module:engine/view/documentfragment~DocumentFragment}\r\nfunction documentToView( htmlDocument ) {\r\n\tconst domConverter = new DomConverter( { blockFiller: NBSP_FILLER } );\r\n\tconst fragment = htmlDocument.createDocumentFragment();\r\n\tconst nodes = htmlDocument.body.childNodes;\r\n\r\n\twhile ( nodes.length > 0 ) {\r\n\t\tfragment.appendChild( nodes[ 0 ] );\r\n\t}\r\n\r\n\treturn domConverter.domToView( fragment );\r\n}\r\n\r\n// Extracts both `CSSStyleSheet` and string representation from all `style` elements available in a provided `htmlDocument`.\r\n//\r\n// @param {Document} htmlDocument Native `Document` object from which styles will be extracted.\r\n// @returns {Object} result\r\n// @returns {Array.<CSSStyleSheet>} result.styles Array of native `CSSStyleSheet` object, each representing\r\n// separate `style` tag from the source object.\r\n// @returns {String} result.stylesString All `style` tags contents combined in the order of occurrence as one string.\r\nfunction extractStyles( htmlDocument ) {\r\n\tconst styles = [];\r\n\tconst stylesString = [];\r\n\tconst styleTags = Array.from( htmlDocument.getElementsByTagName( 'style' ) );\r\n\r\n\tfor ( const style of styleTags ) {\r\n\t\tif ( style.sheet && style.sheet.cssRules && style.sheet.cssRules.length ) {\r\n\t\t\tstyles.push( style.sheet );\r\n\t\t\tstylesString.push( style.innerHTML );\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tstyles,\r\n\t\tstylesString: stylesString.join( ' ' )\r\n\t};\r\n}\r\n\r\n// Removes leftover content from between closing </body> and closing </html> tag:\r\n//\r\n// \t\t<html><body><p>Foo Bar</p></body><span>Fo</span></html> -> <html><body><p>Foo Bar</p></body></html>\r\n//\r\n// This function is used as specific browsers (Edge) add some random content after `body` tag when pasting from Word.\r\n// @param {String} htmlString The HTML string to be cleaned.\r\n// @returns {String} The HTML string with leftover content removed.\r\nfunction cleanContentAfterBody( htmlString ) {\r\n\tconst regexp = /<\\/body>(.*?)(<\\/html>|$)/;\r\n\tconst match = htmlString.match( regexp );\r\n\r\n\tif ( match && match[ 1 ] ) {\r\n\t\thtmlString = htmlString.slice( 0, match.index ) + htmlString.slice( match.index ).replace( match[ 1 ], '' );\r\n\t}\r\n\r\n\treturn htmlString;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paste-from-office/filters/list\r\n */\r\n\r\nimport Element from '@ckeditor/ckeditor5-engine/src/view/element';\r\nimport Matcher from '@ckeditor/ckeditor5-engine/src/view/matcher';\r\nimport UpcastWriter from '@ckeditor/ckeditor5-engine/src/view/upcastwriter';\r\n\r\n/**\r\n * Transforms Word specific list-like elements to the semantic HTML lists.\r\n *\r\n * Lists in Word are represented by block elements with special attributes like:\r\n *\r\n *\t\t<p class=MsoListParagraphCxSpFirst style='mso-list:l1 level1 lfo1'>...</p> // Paragraph based list.\r\n *\t\t<h1 style='mso-list:l0 level1 lfo1'>...</h1> // Heading 1 based list.\r\n *\r\n * @param {module:engine/view/documentfragment~DocumentFragment} documentFragment The view structure which to transform.\r\n * @param {String} stylesString Styles from which list-like elements styling will be extracted.\r\n */\r\nexport function transformListItemLikeElementsIntoLists( documentFragment, stylesString ) {\r\n\tif ( !documentFragment.childCount ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst writer = new UpcastWriter();\r\n\tconst itemLikeElements = findAllItemLikeElements( documentFragment, writer );\r\n\r\n\tif ( !itemLikeElements.length ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet currentList = null;\r\n\r\n\titemLikeElements.forEach( ( itemLikeElement, i ) => {\r\n\t\tif ( !currentList || isNewListNeeded( itemLikeElements[ i - 1 ], itemLikeElement ) ) {\r\n\t\t\tconst listStyle = detectListStyle( itemLikeElement, stylesString );\r\n\r\n\t\t\tcurrentList = insertNewEmptyList( listStyle, itemLikeElement.element, writer );\r\n\t\t}\r\n\r\n\t\tconst listItem = transformElementIntoListItem( itemLikeElement.element, writer );\r\n\r\n\t\twriter.appendChild( listItem, currentList );\r\n\t} );\r\n}\r\n\r\n// Finds all list-like elements in a given document fragment.\r\n//\r\n// @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment\r\n// in which to look for list-like nodes.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\n// @returns {Array.<Object>} Array of found list-like items. Each item is an object containing:\r\n//\r\n//\t\t* {module:engine/src/view/element~Element} element List-like element.\r\n//\t\t* {Number} id List item id parsed from `mso-list` style (see `getListItemData()` function).\r\n//\t\t* {Number} order List item creation order parsed from `mso-list` style (see `getListItemData()` function).\r\n//\t\t* {Number} indent List item indentation level parsed from `mso-list` style (see `getListItemData()` function).\r\nfunction findAllItemLikeElements( documentFragment, writer ) {\r\n\tconst range = writer.createRangeIn( documentFragment );\r\n\r\n\t// Matcher for finding list-like elements.\r\n\tconst itemLikeElementsMatcher = new Matcher( {\r\n\t\tname: /^p|h\\d+$/,\r\n\t\tstyles: {\r\n\t\t\t'mso-list': /.*/\r\n\t\t}\r\n\t} );\r\n\r\n\tconst itemLikeElements = [];\r\n\r\n\tfor ( const value of range ) {\r\n\t\tif ( value.type === 'elementStart' && itemLikeElementsMatcher.match( value.item ) ) {\r\n\t\t\tconst itemData = getListItemData( value.item );\r\n\r\n\t\t\titemLikeElements.push( {\r\n\t\t\t\telement: value.item,\r\n\t\t\t\tid: itemData.id,\r\n\t\t\t\torder: itemData.order,\r\n\t\t\t\tindent: itemData.indent\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\treturn itemLikeElements;\r\n}\r\n\r\n// Extracts list item style from the provided CSS.\r\n//\r\n// List item style is extracted from CSS stylesheet. Each list with its specific style attribute\r\n// value (`mso-list:l1 level1 lfo1`) has its dedicated properties in a CSS stylesheet defined with a selector like:\r\n//\r\n// \t\t@list l1:level1 { ... }\r\n//\r\n// It contains `mso-level-number-format` property which defines list numbering/bullet style. If this property\r\n// is not defined it means default `decimal` numbering.\r\n//\r\n// Here CSS string representation is used as `mso-level-number-format` property is an invalid CSS property\r\n// and will be removed during CSS parsing.\r\n//\r\n// @param {Object} listLikeItem List-like item for which list style will be searched for. Usually\r\n// a result of `findAllItemLikeElements()` function.\r\n// @param {String} stylesString CSS stylesheet.\r\n// @returns {Object} result\r\n// @returns {String} result.type List type, could be `ul` or `ol`.\r\n// @returns {String} result.style List style, for example: `decimal`, `lower-roman`, etc. It is extracted\r\n// directly from Word stylesheet without further processing and may be not compatible\r\n// with CSS `list-style-type` property accepted values.\r\nfunction detectListStyle( listLikeItem, stylesString ) {\r\n\tconst listStyleRegexp = new RegExp( `@list l${ listLikeItem.id }:level${ listLikeItem.indent }\\\\s*({[^}]*)`, 'gi' );\r\n\tconst listStyleTypeRegex = /mso-level-number-format:([^;]*);/gi;\r\n\r\n\tconst listStyleMatch = listStyleRegexp.exec( stylesString );\r\n\r\n\tlet listStyleType = 'decimal'; // Decimal is default one.\r\n\tif ( listStyleMatch && listStyleMatch[ 1 ] ) {\r\n\t\tconst listStyleTypeMatch = listStyleTypeRegex.exec( listStyleMatch[ 1 ] );\r\n\r\n\t\tif ( listStyleTypeMatch && listStyleTypeMatch[ 1 ] ) {\r\n\t\t\tlistStyleType = listStyleTypeMatch[ 1 ].trim();\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\ttype: listStyleType !== 'bullet' && listStyleType !== 'image' ? 'ol' : 'ul',\r\n\t\tstyle: listStyleType\r\n\t};\r\n}\r\n\r\n// Creates empty list of a given type and inserts it after a specified element.\r\n//\r\n// @param {Object} listStyle List style object which determines the type of newly created list.\r\n// Usually a result of `detectListStyle()` function.\r\n// @param {module:engine/view/element~Element} element Element before which list is inserted.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\n// @returns {module:engine/view/element~Element} Newly created list element.\r\nfunction insertNewEmptyList( listStyle, element, writer ) {\r\n\tconst list = new Element( listStyle.type );\r\n\tconst position = element.parent.getChildIndex( element );\r\n\r\n\twriter.insertChild( position, list, element.parent );\r\n\r\n\treturn list;\r\n}\r\n\r\n// Transforms given element into a semantic list item. As the function operates on a provided\r\n// {module:engine/src/view/element~Element element} it will modify the view structure to which this element belongs.\r\n//\r\n// @param {module:engine/view/element~Element} element Element which will be transformed into list item.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\n// @returns {module:engine/view/element~Element} New element to which the given one was transformed. It is\r\n// inserted in place of the old element (the reference to the old element is lost due to renaming).\r\nfunction transformElementIntoListItem( element, writer ) {\r\n\tremoveBulletElement( element, writer );\r\n\r\n\treturn writer.rename( 'li', element );\r\n}\r\n\r\n// Extracts list item information from Word specific list-like element style:\r\n//\r\n//\t\t`style=\"mso-list:l1 level1 lfo1\"`\r\n//\r\n// where:\r\n//\r\n//\t\t* `l1` is a list id (all elements with the same id belongs to the same list),\r\n//\t\t* `level1` is a list item indentation level,\r\n//\t\t* `lfo1` is a list insertion order in a document.\r\n//\r\n// @param {module:engine/view/element~Element} element Element from which style data is extracted.\r\n// @returns {Object} result\r\n// @returns {Number} result.id Parent list id.\r\n// @returns {Number} result.order List item creation order.\r\n// @returns {Number} result.indent List item indentation level.\r\nfunction getListItemData( element ) {\r\n\tconst data = {};\r\n\tconst listStyle = element.getStyle( 'mso-list' );\r\n\r\n\tif ( listStyle ) {\r\n\t\tdata.id = parseInt( listStyle.match( /(^|\\s+)l(\\d+)/i )[ 2 ] );\r\n\t\tdata.order = parseInt( listStyle.match( /\\s*lfo(\\d+)/i )[ 1 ] );\r\n\t\tdata.indent = parseInt( listStyle.match( /\\s*level(\\d+)/i )[ 1 ] );\r\n\t}\r\n\r\n\treturn data;\r\n}\r\n\r\n// Removes span with a numbering/bullet from a given element.\r\n//\r\n// @param {module:engine/view/element~Element} element\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\nfunction removeBulletElement( element, writer ) {\r\n\t// Matcher for finding `span` elements holding lists numbering/bullets.\r\n\tconst bulletMatcher = new Matcher( {\r\n\t\tname: 'span',\r\n\t\tstyles: {\r\n\t\t\t'mso-list': 'Ignore'\r\n\t\t}\r\n\t} );\r\n\r\n\tconst range = writer.createRangeIn( element );\r\n\r\n\tfor ( const value of range ) {\r\n\t\tif ( value.type === 'elementStart' && bulletMatcher.match( value.item ) ) {\r\n\t\t\twriter.remove( value.item );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction isNewListNeeded( previousItem, currentItem ) {\r\n\treturn previousItem.id !== currentItem.id;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paste-from-office/filters/image\r\n */\r\n\r\n/* globals btoa */\r\n\r\nimport ViewMatcher from '@ckeditor/ckeditor5-engine/src/view/matcher';\r\nimport UpcastWriter from '@ckeditor/ckeditor5-engine/src/view/upcastwriter';\r\n\r\n/**\r\n * Replaces source attribute of all `<img>` elements representing regular\r\n * images (not the Word shapes) with inlined base64 image representation extracted from RTF or Blob data.\r\n *\r\n * @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment on which transform images.\r\n * @param {String} rtfData The RTF data from which images representation will be used.\r\n */\r\nexport function replaceImagesSourceWithBase64( documentFragment, rtfData ) {\r\n\tif ( !documentFragment.childCount ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst upcastWriter = new UpcastWriter();\r\n\tconst shapesIds = findAllShapesIds( documentFragment, upcastWriter );\r\n\r\n\tremoveAllImgElementsRepresentingShapes( shapesIds, documentFragment, upcastWriter );\r\n\tremoveAllShapeElements( documentFragment, upcastWriter );\r\n\r\n\tconst images = findAllImageElementsWithLocalSource( documentFragment, upcastWriter );\r\n\r\n\tif ( images.length ) {\r\n\t\treplaceImagesFileSourceWithInlineRepresentation( images, extractImageDataFromRtf( rtfData ), upcastWriter );\r\n\t}\r\n}\r\n\r\n/**\r\n * Converts given HEX string to base64 representation.\r\n *\r\n * @protected\r\n * @param {String} hexString The HEX string to be converted.\r\n * @returns {String} Base64 representation of a given HEX string.\r\n */\r\nexport function _convertHexToBase64( hexString ) {\r\n\treturn btoa( hexString.match( /\\w{2}/g ).map( char => {\r\n\t\treturn String.fromCharCode( parseInt( char, 16 ) );\r\n\t} ).join( '' ) );\r\n}\r\n\r\n// Finds all shapes (`<v:*>...</v:*>`) ids. Shapes can represent images (canvas)\r\n// or Word shapes (which does not have RTF or Blob representation).\r\n//\r\n// @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment\r\n// from which to extract shape ids.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\n// @returns {Array.<String>} Array of shape ids.\r\nfunction findAllShapesIds( documentFragment, writer ) {\r\n\tconst range = writer.createRangeIn( documentFragment );\r\n\r\n\tconst shapeElementsMatcher = new ViewMatcher( {\r\n\t\tname: /v:(.+)/\r\n\t} );\r\n\r\n\tconst shapesIds = [];\r\n\r\n\tfor ( const value of range ) {\r\n\t\tconst el = value.item;\r\n\t\tconst prevSiblingName = el.previousSibling && el.previousSibling.name || null;\r\n\r\n\t\t// If shape element have 'o:gfxdata' attribute and is not directly before `<v:shapetype>` element it means it represent Word shape.\r\n\t\tif ( shapeElementsMatcher.match( el ) && el.getAttribute( 'o:gfxdata' ) && prevSiblingName !== 'v:shapetype' ) {\r\n\t\t\tshapesIds.push( value.item.getAttribute( 'id' ) );\r\n\t\t}\r\n\t}\r\n\r\n\treturn shapesIds;\r\n}\r\n\r\n// Removes all `<img>` elements which represents Word shapes and not regular images.\r\n//\r\n// @param {Array.<String>} shapesIds Shape ids which will be checked against `<img>` elements.\r\n// @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment from which to remove `<img>` elements.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\nfunction removeAllImgElementsRepresentingShapes( shapesIds, documentFragment, writer ) {\r\n\tconst range = writer.createRangeIn( documentFragment );\r\n\r\n\tconst imageElementsMatcher = new ViewMatcher( {\r\n\t\tname: 'img'\r\n\t} );\r\n\r\n\tconst imgs = [];\r\n\r\n\tfor ( const value of range ) {\r\n\t\tif ( imageElementsMatcher.match( value.item ) ) {\r\n\t\t\tconst el = value.item;\r\n\t\t\tconst shapes = el.getAttribute( 'v:shapes' ) ? el.getAttribute( 'v:shapes' ).split( ' ' ) : [];\r\n\r\n\t\t\tif ( shapes.length && shapes.every( shape => shapesIds.indexOf( shape ) > -1 ) ) {\r\n\t\t\t\timgs.push( el );\r\n\t\t\t// Shapes may also have empty source while content is paste in some browsers (Safari).\r\n\t\t\t} else if ( !el.getAttribute( 'src' ) ) {\r\n\t\t\t\timgs.push( el );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfor ( const img of imgs ) {\r\n\t\twriter.remove( img );\r\n\t}\r\n}\r\n\r\n// Removes all shape elements (`<v:*>...</v:*>`) so they do not pollute the output structure.\r\n//\r\n// @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment from which to remove shape elements.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\nfunction removeAllShapeElements( documentFragment, writer ) {\r\n\tconst range = writer.createRangeIn( documentFragment );\r\n\r\n\tconst shapeElementsMatcher = new ViewMatcher( {\r\n\t\tname: /v:(.+)/\r\n\t} );\r\n\r\n\tconst shapes = [];\r\n\r\n\tfor ( const value of range ) {\r\n\t\tif ( shapeElementsMatcher.match( value.item ) ) {\r\n\t\t\tshapes.push( value.item );\r\n\t\t}\r\n\t}\r\n\r\n\tfor ( const shape of shapes ) {\r\n\t\twriter.remove( shape );\r\n\t}\r\n}\r\n\r\n// Finds all `<img>` elements in a given document fragment which have source pointing to local `file://` resource.\r\n//\r\n// @param {module:engine/view/documentfragment~DocumentFragment} documentFragment Document fragment in which to look for `<img>` elements.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\n// @returns {Object} result All found images grouped by source type.\r\n// @returns {Array.<module:engine/view/element~Element>} result.file Array of found `<img>` elements with `file://` source.\r\n// @returns {Array.<module:engine/view/element~Element>} result.blob Array of found `<img>` elements with `blob:` source.\r\nfunction findAllImageElementsWithLocalSource( documentFragment, writer ) {\r\n\tconst range = writer.createRangeIn( documentFragment );\r\n\r\n\tconst imageElementsMatcher = new ViewMatcher( {\r\n\t\tname: 'img'\r\n\t} );\r\n\r\n\tconst imgs = [];\r\n\r\n\tfor ( const value of range ) {\r\n\t\tif ( imageElementsMatcher.match( value.item ) ) {\r\n\t\t\tif ( value.item.getAttribute( 'src' ).startsWith( 'file://' ) ) {\r\n\t\t\t\timgs.push( value.item );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn imgs;\r\n}\r\n\r\n// Extracts all images HEX representations from a given RTF data.\r\n//\r\n// @param {String} rtfData The RTF data from which to extract images HEX representation.\r\n// @returns {Array.<Object>} Array of found HEX representations. Each array item is an object containing:\r\n//\r\n// \t\t* {String} hex Image representation in HEX format.\r\n// \t\t* {string} type Type of image, `image/png` or `image/jpeg`.\r\nfunction extractImageDataFromRtf( rtfData ) {\r\n\tif ( !rtfData ) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst regexPictureHeader = /{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?({\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s}]*?/;\r\n\tconst regexPicture = new RegExp( '(?:(' + regexPictureHeader.source + '))([\\\\da-fA-F\\\\s]+)\\\\}', 'g' );\r\n\tconst images = rtfData.match( regexPicture );\r\n\tconst result = [];\r\n\r\n\tif ( images ) {\r\n\t\tfor ( const image of images ) {\r\n\t\t\tlet imageType = false;\r\n\r\n\t\t\tif ( image.includes( '\\\\pngblip' ) ) {\r\n\t\t\t\timageType = 'image/png';\r\n\t\t\t} else if ( image.includes( '\\\\jpegblip' ) ) {\r\n\t\t\t\timageType = 'image/jpeg';\r\n\t\t\t}\r\n\r\n\t\t\tif ( imageType ) {\r\n\t\t\t\tresult.push( {\r\n\t\t\t\t\thex: image.replace( regexPictureHeader, '' ).replace( /[^\\da-fA-F]/g, '' ),\r\n\t\t\t\t\ttype: imageType\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\n// Replaces `src` attribute value of all given images with the corresponding base64 image representation.\r\n//\r\n// @param {Array.<module:engine/view/element~Element>} imageElements Array of image elements which will have its source replaced.\r\n// @param {Array.<Object>} imagesHexSources Array of images hex sources (usually the result of `extractImageDataFromRtf()` function).\r\n// The array should be the same length as `imageElements` parameter.\r\n// @param {module:engine/view/upcastwriter~UpcastWriter} writer\r\nfunction replaceImagesFileSourceWithInlineRepresentation( imageElements, imagesHexSources, writer ) {\r\n\t// Assume there is an equal amount of image elements and images HEX sources so they can be matched accordingly based on existing order.\r\n\tif ( imageElements.length === imagesHexSources.length ) {\r\n\t\tfor ( let i = 0; i < imageElements.length; i++ ) {\r\n\t\t\tconst newSrc = `data:${ imagesHexSources[ i ].type };base64,${ _convertHexToBase64( imagesHexSources[ i ].hex ) }`;\r\n\t\t\twriter.setAttribute( 'src', newSrc, imageElements[ i ] );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/utils\r\n */\r\n\r\n/**\r\n * Returns the parent element of given name. Returns undefined if position is not inside desired parent.\r\n *\r\n * @param {String} parentName Name of parent element to find.\r\n * @param {module:engine/model/position~Position|module:engine/model/position~Position} position Position to start searching.\r\n * @returns {module:engine/model/element~Element|module:engine/model/documentfragment~DocumentFragment}\r\n */\r\nexport function findAncestor( parentName, position ) {\r\n\tlet parent = position.parent;\r\n\r\n\twhile ( parent ) {\r\n\t\tif ( parent.name === parentName ) {\r\n\t\t\treturn parent;\r\n\t\t}\r\n\r\n\t\tparent = parent.parent;\r\n\t}\r\n}\r\n\r\n/**\r\n * A common method to update the numeric value. If a value is the default one, it will be unset.\r\n *\r\n * @param {String} key Attribute key.\r\n * @param {*} value The new attribute value.\r\n * @param {module:engine/model/item~Item} item Model item on which the attribute will be set.\r\n * @param {module:engine/model/writer~Writer} writer\r\n * @param {*} defaultValue Default attribute value. If a value is lower or equal, it will be unset.\r\n */\r\nexport function updateNumericAttribute( key, value, item, writer, defaultValue = 1 ) {\r\n\tif ( value > defaultValue ) {\r\n\t\twriter.setAttribute( key, value, item );\r\n\t} else {\r\n\t\twriter.removeAttribute( key, item );\r\n\t}\r\n}\r\n\r\n/**\r\n * Common method to create empty table cell - it will create proper model structure as table cell must have at least one block inside.\r\n *\r\n * @param {module:engine/model/writer~Writer} writer Model writer.\r\n * @param {module:engine/model/position~Position} insertPosition Position at which table cell should be inserted.\r\n * @param {Object} attributes Element's attributes.\r\n */\r\nexport function createEmptyTableCell( writer, insertPosition, attributes = {} ) {\r\n\tconst tableCell = writer.createElement( 'tableCell', attributes );\r\n\twriter.insertElement( 'paragraph', tableCell );\r\n\twriter.insert( tableCell, insertPosition );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/converters/upcasttable\r\n */\r\n\r\nimport { createEmptyTableCell } from '../commands/utils';\r\n\r\n/**\r\n * View table element to model table element conversion helper.\r\n *\r\n * This conversion helper converts the table element as well as table rows.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport default function upcastTable() {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( 'element:table', ( evt, data, conversionApi ) => {\r\n\t\t\tconst viewTable = data.viewItem;\r\n\r\n\t\t\t// When element was already consumed then skip it.\r\n\t\t\tif ( !conversionApi.consumable.test( viewTable, { name: true } ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst { rows, headingRows, headingColumns } = scanTable( viewTable );\r\n\r\n\t\t\t// Only set attributes if values is greater then 0.\r\n\t\t\tconst attributes = {};\r\n\r\n\t\t\tif ( headingColumns ) {\r\n\t\t\t\tattributes.headingColumns = headingColumns;\r\n\t\t\t}\r\n\r\n\t\t\tif ( headingRows ) {\r\n\t\t\t\tattributes.headingRows = headingRows;\r\n\t\t\t}\r\n\r\n\t\t\tconst table = conversionApi.writer.createElement( 'table', attributes );\r\n\r\n\t\t\t// Insert element on allowed position.\r\n\t\t\tconst splitResult = conversionApi.splitToAllowedParent( table, data.modelCursor );\r\n\r\n\t\t\t// When there is no split result it means that we can't insert element to model tree, so let's skip it.\r\n\t\t\tif ( !splitResult ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconversionApi.writer.insert( table, splitResult.position );\r\n\t\t\tconversionApi.consumable.consume( viewTable, { name: true } );\r\n\r\n\t\t\tif ( rows.length ) {\r\n\t\t\t\t// Upcast table rows in proper order (heading rows first).\r\n\t\t\t\trows.forEach( row => conversionApi.convertItem( row, conversionApi.writer.createPositionAt( table, 'end' ) ) );\r\n\t\t\t} else {\r\n\t\t\t\t// Create one row and one table cell for empty table.\r\n\t\t\t\tconst row = conversionApi.writer.createElement( 'tableRow' );\r\n\t\t\t\tconversionApi.writer.insert( row, conversionApi.writer.createPositionAt( table, 'end' ) );\r\n\r\n\t\t\t\tcreateEmptyTableCell( conversionApi.writer, conversionApi.writer.createPositionAt( row, 'end' ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Set conversion result range.\r\n\t\t\tdata.modelRange = conversionApi.writer.createRange(\r\n\t\t\t\t// Range should start before inserted element\r\n\t\t\t\tconversionApi.writer.createPositionBefore( table ),\r\n\t\t\t\t// Should end after but we need to take into consideration that children could split our\r\n\t\t\t\t// element, so we need to move range after parent of the last converted child.\r\n\t\t\t\t// before: <allowed>[]</allowed>\r\n\t\t\t\t// after: <allowed>[<converted><child></child></converted><child></child><converted>]</converted></allowed>\r\n\t\t\t\tconversionApi.writer.createPositionAfter( table )\r\n\t\t\t);\r\n\r\n\t\t\t// Now we need to check where the modelCursor should be.\r\n\t\t\t// If we had to split parent to insert our element then we want to continue conversion inside split parent.\r\n\t\t\t//\r\n\t\t\t// before: <allowed><notAllowed>[]</notAllowed></allowed>\r\n\t\t\t// after:  <allowed><notAllowed></notAllowed><converted></converted><notAllowed>[]</notAllowed></allowed>\r\n\t\t\tif ( splitResult.cursorParent ) {\r\n\t\t\t\tdata.modelCursor = conversionApi.writer.createPositionAt( splitResult.cursorParent, 0 );\r\n\r\n\t\t\t\t// Otherwise just continue after inserted element.\r\n\t\t\t} else {\r\n\t\t\t\tdata.modelCursor = data.modelRange.end;\r\n\t\t\t}\r\n\t\t} );\r\n\t};\r\n}\r\n\r\nexport function upcastTableCell( elementName ) {\r\n\treturn dispatcher => {\r\n\t\tdispatcher.on( `element:${ elementName }`, ( evt, data, conversionApi ) => {\r\n\t\t\tconst viewTableCell = data.viewItem;\r\n\r\n\t\t\t// When element was already consumed then skip it.\r\n\t\t\tif ( !conversionApi.consumable.test( viewTableCell, { name: true } ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst tableCell = conversionApi.writer.createElement( 'tableCell' );\r\n\r\n\t\t\t// Insert element on allowed position.\r\n\t\t\tconst splitResult = conversionApi.splitToAllowedParent( tableCell, data.modelCursor );\r\n\r\n\t\t\t// When there is no split result it means that we can't insert element to model tree, so let's skip it.\r\n\t\t\tif ( !splitResult ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconversionApi.writer.insert( tableCell, splitResult.position );\r\n\t\t\tconversionApi.consumable.consume( viewTableCell, { name: true } );\r\n\r\n\t\t\tconst modelCursor = conversionApi.writer.createPositionAt( tableCell, 0 );\r\n\t\t\tconversionApi.convertChildren( viewTableCell, modelCursor );\r\n\r\n\t\t\t// Ensure a paragraph in the model for empty table cells.\r\n\t\t\tif ( !tableCell.childCount ) {\r\n\t\t\t\tconversionApi.writer.insertElement( 'paragraph', modelCursor );\r\n\t\t\t}\r\n\r\n\t\t\t// Set conversion result range.\r\n\t\t\tdata.modelRange = conversionApi.writer.createRange(\r\n\t\t\t\t// Range should start before inserted element\r\n\t\t\t\tconversionApi.writer.createPositionBefore( tableCell ),\r\n\t\t\t\t// Should end after but we need to take into consideration that children could split our\r\n\t\t\t\t// element, so we need to move range after parent of the last converted child.\r\n\t\t\t\t// before: <allowed>[]</allowed>\r\n\t\t\t\t// after: <allowed>[<converted><child></child></converted><child></child><converted>]</converted></allowed>\r\n\t\t\t\tconversionApi.writer.createPositionAfter( tableCell )\r\n\t\t\t);\r\n\r\n\t\t\t// Continue after inserted element.\r\n\t\t\tdata.modelCursor = data.modelRange.end;\r\n\t\t} );\r\n\t};\r\n}\r\n\r\n// Scans table rows and extracts required metadata from the table:\r\n//\r\n// headingRows    - the number of rows that goes as table header.\r\n// headingColumns - max number of row headings.\r\n// rows           - sorted `<tr>`s as they should go into the model - ie. if `<thead>` is inserted after `<tbody>` in the view.\r\n//\r\n// @param {module:engine/view/element~Element} viewTable\r\n// @returns {{headingRows, headingColumns, rows}}\r\nfunction scanTable( viewTable ) {\r\n\tconst tableMeta = {\r\n\t\theadingRows: 0,\r\n\t\theadingColumns: 0\r\n\t};\r\n\r\n\t// The `<tbody>` and <thead> sections in the DOM do not have to be in order `<thead>` -> `<tbody>` and there might be more then one of\r\n\t// them.\r\n\t// As the model does not have those sections, rows from different sections must be sorted.\r\n\t// For example, below is a valid HTML table:\r\n\t//\r\n\t//\t\t<table>\r\n\t//\t\t\t<tbody><tr><td>2</td></tr></tbody>\r\n\t//\t\t\t<thead><tr><td>1</td></tr></thead>\r\n\t//\t\t\t<tbody><tr><td>3</td></tr></tbody>\r\n\t//\t\t</table>\r\n\t//\r\n\t// But browsers will render rows in order as: 1 as heading and 2 and 3 as (body).\r\n\tconst headRows = [];\r\n\tconst bodyRows = [];\r\n\r\n\t// Currently the editor does not support more then one <thead> section.\r\n\t// Only the first <thead> from the view will be used as heading rows and others will be converted to body rows.\r\n\tlet firstTheadElement;\r\n\r\n\tfor ( const tableChild of Array.from( viewTable.getChildren() ) ) {\r\n\t\t// Only <thead>, <tbody> & <tfoot> from allowed table children can have <tr>s.\r\n\t\t// The else is for future purposes (mainly <caption>).\r\n\t\tif ( tableChild.name === 'tbody' || tableChild.name === 'thead' || tableChild.name === 'tfoot' ) {\r\n\t\t\t// Save the first <thead> in the table as table header - all other ones will be converted to table body rows.\r\n\t\t\tif ( tableChild.name === 'thead' && !firstTheadElement ) {\r\n\t\t\t\tfirstTheadElement = tableChild;\r\n\t\t\t}\r\n\r\n\t\t\t// There might be some extra empty text nodes between the `tr`s.\r\n\t\t\t// Make sure further code operates on `tr`s only. (#145)\r\n\t\t\tconst trs = Array.from( tableChild.getChildren() ).filter( el => el.is( 'element', 'tr' ) );\r\n\r\n\t\t\tfor ( const tr of trs ) {\r\n\t\t\t\t// This <tr> is a child of a first <thead> element.\r\n\t\t\t\tif ( tr.parent.name === 'thead' && tr.parent === firstTheadElement ) {\r\n\t\t\t\t\ttableMeta.headingRows++;\r\n\t\t\t\t\theadRows.push( tr );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbodyRows.push( tr );\r\n\t\t\t\t\t// For other rows check how many column headings this row has.\r\n\r\n\t\t\t\t\tconst headingCols = scanRowForHeadingColumns( tr, tableMeta, firstTheadElement );\r\n\r\n\t\t\t\t\tif ( headingCols > tableMeta.headingColumns ) {\r\n\t\t\t\t\t\ttableMeta.headingColumns = headingCols;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttableMeta.rows = [ ...headRows, ...bodyRows ];\r\n\r\n\treturn tableMeta;\r\n}\r\n\r\n// Scans `<tr>` and its children for metadata:\r\n// - For heading row:\r\n//     - either adds this row to heading or body rows.\r\n//     - updates number of heading rows.\r\n// - For body rows:\r\n//     - calculates the number of column headings.\r\n//\r\n// @param {module:engine/view/element~Element} tr\r\n// @returns {Number}\r\nfunction scanRowForHeadingColumns( tr ) {\r\n\tlet headingColumns = 0;\r\n\tlet index = 0;\r\n\r\n\t// Filter out empty text nodes from tr children.\r\n\tconst children = Array.from( tr.getChildren() )\r\n\t\t.filter( child => child.name === 'th' || child.name === 'td' );\r\n\r\n\t// Count starting adjacent <th> elements of a <tr>.\r\n\twhile ( index < children.length && children[ index ].name === 'th' ) {\r\n\t\tconst th = children[ index ];\r\n\r\n\t\t// Adjust columns calculation by the number of spanned columns.\r\n\t\tconst colspan = parseInt( th.getAttribute( 'colspan' ) || 1 );\r\n\r\n\t\theadingColumns = headingColumns + colspan;\r\n\t\tindex++;\r\n\t}\r\n\r\n\treturn headingColumns;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/tablewalker\r\n */\r\n\r\n/**\r\n * Table iterator class. It allows to iterate over table cells. For each cell the iterator yields\r\n * {@link module:table/tablewalker~TableWalkerValue} with proper table cell attributes.\r\n */\r\nexport default class TableWalker {\r\n\t/**\r\n\t * Creates an instance of the table walker.\r\n\t *\r\n\t *\r\n\t * The table walker iterates internally by traversing the table from row index = 0 and column index = 0.\r\n\t * It walks row by row and column by column in order to output values defined in the constructor.\r\n\t * By default it will output only those locations that are occupied by a cell. To include also spanned rows and columns,\r\n\t * pass the `includeSpanned` option to the constructor.\r\n\t *\r\n\t * The most important values of the iterator are column and row indexes of a cell.\r\n\t *\r\n\t * To iterate over a given row:\r\n\t *\r\n\t *\t\tconst tableWalker = new TableWalker( table, { startRow: 1, endRow: 2 } );\r\n\t *\r\n\t *\t\tfor ( const cellInfo of tableWalker ) {\r\n\t *\t\t\tconsole.log( 'A cell at row ' + cellInfo.row + ' and column ' + cellInfo.column );\r\n\t *\t\t}\r\n\t *\r\n\t * For instance the code above for the following table:\r\n\t *\r\n\t *\t\t+----+----+----+----+----+----+\r\n\t *\t\t| 00      | 02 | 03      | 05 |\r\n\t *\t\t|         +----+----+----+----+\r\n\t *\t\t|         | 12      | 14 | 15 |\r\n\t *\t\t|         +----+----+----+----+\r\n\t *\t\t|         | 22                |\r\n\t *\t\t|----+----+                   +\r\n\t *\t\t| 31 | 32 |                   |\r\n\t *\t\t+----+----+----+----+----+----+\r\n\t *\r\n\t * will log in the console:\r\n\t *\r\n\t *\t\t'A cell at row 1 and column 2'\r\n\t *\t\t'A cell at row 1 and column 4'\r\n\t *\t\t'A cell at row 1 and column 5'\r\n\t *\t\t'A cell at row 2 and column 2'\r\n\t *\r\n\t * To also iterate over spanned cells:\r\n\t *\r\n\t *\t\tconst tableWalker = new TableWalker( table, { startRow: 1, endRow: 1, includeSpanned: true } );\r\n\t *\r\n\t *\t\tfor ( const cellInfo of tableWalker ) {\r\n\t *\t\t\tconsole.log( 'Cell at ' + cellInfo.row + ' x ' + cellInfo.column + ' : ' + ( cellInfo.cell ? 'has data' : 'is spanned' ) );\r\n\t *\t\t}\r\n\t *\r\n\t * will log in the console for the table from previous example:\r\n\t *\r\n\t *\t\t'Cell at 1 x 0 : is spanned'\r\n\t *\t\t'Cell at 1 x 1 : is spanned'\r\n\t *\t\t'Cell at 1 x 2 : has data'\r\n\t *\t\t'Cell at 1 x 3 : is spanned'\r\n\t *\t\t'Cell at 1 x 4 : has data'\r\n\t *\t\t'Cell at 1 x 5 : has data'\r\n\t *\r\n\t * @constructor\r\n\t * @param {module:engine/model/element~Element} table A table over which the walker iterates.\r\n\t * @param {Object} [options={}] An object with configuration.\r\n\t * @param {Number} [options.column] A column index for which this iterator will output cells.\r\n\t * @param {Number} [options.startRow=0] A row index for which this iterator should start.\r\n\t * @param {Number} [options.endRow] A row index for which this iterator should end.\r\n\t * @param {Boolean} [options.includeSpanned] Also return values for spanned cells.\r\n\t */\r\n\tconstructor( table, options = {} ) {\r\n\t\t/**\r\n\t\t * The walker's table element.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:engine/model/element~Element}\r\n\t\t */\r\n\t\tthis.table = table;\r\n\r\n\t\t/**\r\n\t\t * A row index on which this iterator will start.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.startRow = options.startRow || 0;\r\n\r\n\t\t/**\r\n\t\t * A row index on which this iterator will end.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.endRow = typeof options.endRow == 'number' ? options.endRow : undefined;\r\n\r\n\t\t/**\r\n\t\t * Enables output of spanned cells that are normally not yielded.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean}\r\n\t\t */\r\n\t\tthis.includeSpanned = !!options.includeSpanned;\r\n\r\n\t\t/**\r\n\t\t * If set, the table walker will only output cells of a given column or cells that overlap it.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t */\r\n\t\tthis.column = typeof options.column == 'number' ? options.column : undefined;\r\n\r\n\t\t/**\r\n\t\t * Row indexes to skip from the iteration.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Set<Number>}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._skipRows = new Set();\r\n\r\n\t\t/**\r\n\t\t * The current row index.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._row = 0;\r\n\r\n\t\t/**\r\n\t\t * The current column index.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._column = 0;\r\n\r\n\t\t/**\r\n\t\t * The cell index in a parent row. For spanned cells when {@link #includeSpanned} is set to `true`,\r\n\t\t * this represents the index of the next table cell.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Number}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._cell = 0;\r\n\r\n\t\t/**\r\n\t\t * Holds a map of spanned cells in a table.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Map<Number, Map.<Number, Number>>}\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._spannedCells = new Map();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterable interface.\r\n\t *\r\n\t * @returns {Iterable.<module:table/tablewalker~TableWalkerValue>}\r\n\t */\r\n\t[ Symbol.iterator ]() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next table walker's value.\r\n\t *\r\n\t * @returns {module:table/tablewalker~TableWalkerValue} The next table walker's value.\r\n\t */\r\n\tnext() {\r\n\t\tconst row = this.table.getChild( this._row );\r\n\r\n\t\t// Iterator is done when no row (table end) or the row is after #endRow.\r\n\t\tif ( !row || this._isOverEndRow() ) {\r\n\t\t\treturn { done: true };\r\n\t\t}\r\n\r\n\t\t// Spanned cell location handling.\r\n\t\tif ( this._isSpanned( this._row, this._column ) ) {\r\n\t\t\t// Current column must be kept as it will be updated before returning current value.\r\n\t\t\tconst currentColumn = this._column;\r\n\t\t\tconst outValue = this._formatOutValue( undefined, currentColumn );\r\n\r\n\t\t\t// Advance to next column - always.\r\n\t\t\tthis._column++;\r\n\r\n\t\t\tconst skipCurrentValue = !this.includeSpanned || this._shouldSkipRow() || this._shouldSkipColumn( currentColumn, 1 );\r\n\r\n\t\t\t// The current value will be returned only if #includedSpanned=true and also current row and column are not skipped.\r\n\t\t\treturn skipCurrentValue ? this.next() : outValue;\r\n\t\t}\r\n\r\n\t\t// The cell location is not spanned by other cells.\r\n\t\tconst cell = row.getChild( this._cell );\r\n\r\n\t\tif ( !cell ) {\r\n\t\t\t// If there are no more cells left in row advance to next row.\r\n\t\t\tthis._row++;\r\n\t\t\t// And reset column & cell indexes.\r\n\t\t\tthis._column = 0;\r\n\t\t\tthis._cell = 0;\r\n\r\n\t\t\t// Return next value.\r\n\t\t\treturn this.next();\r\n\t\t}\r\n\r\n\t\t// Read table cell attributes.\r\n\t\tconst colspan = parseInt( cell.getAttribute( 'colspan' ) || 1 );\r\n\t\tconst rowspan = parseInt( cell.getAttribute( 'rowspan' ) || 1 );\r\n\r\n\t\t// Record this cell spans if it's not 1x1 cell.\r\n\t\tif ( colspan > 1 || rowspan > 1 ) {\r\n\t\t\tthis._recordSpans( this._row, this._column, rowspan, colspan );\r\n\t\t}\r\n\r\n\t\t// Current column must be kept as it will be updated before returning current value.\r\n\t\tconst currentColumn = this._column;\r\n\t\tconst outValue = this._formatOutValue( cell, currentColumn, rowspan, colspan );\r\n\r\n\t\t// Advance to next column before returning value.\r\n\t\tthis._column++;\r\n\r\n\t\t// Advance to next cell in a parent row before returning value.\r\n\t\tthis._cell++;\r\n\r\n\t\tconst skipCurrentValue = this._shouldSkipRow() || this._shouldSkipColumn( currentColumn, colspan );\r\n\r\n\t\t// The current value will be returned only if current row & column are not skipped.\r\n\t\treturn skipCurrentValue ? this.next() : outValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a row to skip in the next iteration. It will also skip cells from the current row if there are any cells from the current row\r\n\t * to output.\r\n\t *\r\n\t * @param {Number} row Row index to skip.\r\n\t */\r\n\tskipRow( row ) {\r\n\t\tthis._skipRows.add( row );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the current row is over {@link #endRow}.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_isOverEndRow() {\r\n\t\t// If {@link #endRow) is defined skip all rows above it.\r\n\t\treturn this.endRow !== undefined && this._row > this.endRow;\r\n\t}\r\n\r\n\t/**\r\n\t * A common method for formatting the iterator's output value.\r\n\t *\r\n\t * @param {module:engine/model/element~Element|undefined} cell The table cell to output. It might be undefined for spanned cell\r\n\t * locations.\r\n\t * @param {Number} column Column index (use the cached value)\r\n\t * @param {Number} rowspan Rowspan of the current cell.\r\n\t * @param {Number} colspan Colspan of the current cell.\r\n\t * @returns {{done: boolean, value: {cell: *, row: Number, column: *, rowspan: *, colspan: *, cellIndex: Number}}}\r\n\t * @private\r\n\t */\r\n\t_formatOutValue( cell, column, rowspan = 1, colspan = 1 ) {\r\n\t\treturn {\r\n\t\t\tdone: false,\r\n\t\t\tvalue: {\r\n\t\t\t\tcell,\r\n\t\t\t\trow: this._row,\r\n\t\t\t\tcolumn,\r\n\t\t\t\trowspan,\r\n\t\t\t\tcolspan,\r\n\t\t\t\tcellIndex: this._cell\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the current row should be skipped.\r\n\t *\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_shouldSkipRow() {\r\n\t\tconst rowIsBelowStartRow = this._row < this.startRow;\r\n\t\tconst rowIsMarkedAsSkipped = this._skipRows.has( this._row );\r\n\r\n\t\treturn rowIsBelowStartRow || rowIsMarkedAsSkipped;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the current column should be skipped.\r\n\t *\r\n\t * @param {Number} column\r\n\t * @param {Number} colspan\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_shouldSkipColumn( column, colspan ) {\r\n\t\tif ( this.column === undefined ) {\r\n\t\t\t// The {@link #column} is not defined so output all columns.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// When outputting cells from given column we skip:\r\n\t\t// - Cells that are not on that column.\r\n\t\tconst isCurrentColumn = column === this.column;\r\n\t\t// - CSells that are before given column and they overlaps given column.\r\n\t\tconst isPreviousThatOverlapsColumn = column < this.column && column + colspan > this.column;\r\n\r\n\t\treturn !isCurrentColumn && !isPreviousThatOverlapsColumn;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the current cell location (row x column) is spanned by another cell.\r\n\t *\r\n\t * @param {Number} row Row index of a cell location to check.\r\n\t * @param {Number} column Column index of a cell location to check.\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_isSpanned( row, column ) {\r\n\t\tif ( !this._spannedCells.has( row ) ) {\r\n\t\t\t// No spans for given row.\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst rowSpans = this._spannedCells.get( row );\r\n\r\n\t\t// If spans for given rows has entry for column it means that this location if spanned by other cell.\r\n\t\treturn rowSpans.has( column );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates spanned cells map relative to the current cell location and its span dimensions.\r\n\t *\r\n\t * @param {Number} row Row index of a cell.\r\n\t * @param {Number} column Column index of a cell.\r\n\t * @param {Number} rowspan Cell height.\r\n\t * @param {Number} colspan Cell width.\r\n\t * @private\r\n\t */\r\n\t_recordSpans( row, column, rowspan, colspan ) {\r\n\t\t// This will update all cell locations after current column - ie a cell has colspan set.\r\n\t\tfor ( let columnToUpdate = column + 1; columnToUpdate <= column + colspan - 1; columnToUpdate++ ) {\r\n\t\t\tthis._markSpannedCell( row, columnToUpdate );\r\n\t\t}\r\n\r\n\t\t// This will update all rows below current up to row's height.\r\n\t\tfor ( let rowToUpdate = row + 1; rowToUpdate < row + rowspan; rowToUpdate++ ) {\r\n\t\t\tfor ( let columnToUpdate = column; columnToUpdate <= column + colspan - 1; columnToUpdate++ ) {\r\n\t\t\t\tthis._markSpannedCell( rowToUpdate, columnToUpdate );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Marks the cell location as spanned by another cell.\r\n\t *\r\n\t * @param {Number} row Row index of the cell location.\r\n\t * @param {Number} column Column index of the cell location.\r\n\t * @private\r\n\t */\r\n\t_markSpannedCell( row, column ) {\r\n\t\tif ( !this._spannedCells.has( row ) ) {\r\n\t\t\tthis._spannedCells.set( row, new Map() );\r\n\t\t}\r\n\r\n\t\tconst rowSpans = this._spannedCells.get( row );\r\n\r\n\t\trowSpans.set( column, true );\r\n\t}\r\n}\r\n\r\n/**\r\n * An object returned by {@link module:table/tablewalker~TableWalker} when traversing table cells.\r\n *\r\n * @typedef {Object} module:table/tablewalker~TableWalkerValue\r\n * @property {module:engine/model/element~Element} [cell] The current table cell. Might be empty if\r\n * {@link module:table/tablewalker~TableWalker#includeSpanned} is set to `true`.\r\n * @property {Number} row The row index of a cell.\r\n * @property {Number} column The column index of a cell. Column index is adjusted to widths and heights of previous cells.\r\n * @property {Number} [colspan] The `colspan` attribute of a cell. It is always defined even if the model attribute is not present. Not\r\n * set if {@link module:table/tablewalker~TableWalker#includeSpanned} is set to `true`.\r\n * @property {Number} [rowspan] The `rowspan` attribute of a cell. It is always defined even if the model attribute is not present. Not\r\n * set if {@link module:table/tablewalker~TableWalker#includeSpanned} is set to `true`.\r\n * @property {Number} cellIndex The index of the current cell in a parent row. When using the `includeSpanned` option it will indicate the\r\n * next child index if #cell is empty (which indicates that the cell is spanned by another cell).\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/utils\r\n */\r\n\r\nimport { isWidget, toWidget } from '@ckeditor/ckeditor5-widget/src/utils';\r\nimport { findAncestor } from './commands/utils';\r\n\r\nconst tableSymbol = Symbol( 'isTable' );\r\n\r\n/**\r\n * Converts a given {@link module:engine/view/element~Element} to a table widget:\r\n * * Adds a {@link module:engine/view/element~Element#_setCustomProperty custom property} allowing to recognize the table widget element.\r\n * * Calls the {@link module:widget/utils~toWidget} function with the proper element's label creator.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @param {module:engine/view/downcastwriter~DowncastWriter} writer An instance of the view writer.\r\n * @param {String} label The element's label. It will be concatenated with the table `alt` attribute if one is present.\r\n * @returns {module:engine/view/element~Element}\r\n */\r\nexport function toTableWidget( viewElement, writer ) {\r\n\twriter.setCustomProperty( tableSymbol, true, viewElement );\r\n\r\n\treturn toWidget( viewElement, writer, { hasSelectionHandler: true } );\r\n}\r\n\r\n/**\r\n * Checks if a given view element is a table widget.\r\n *\r\n * @param {module:engine/view/element~Element} viewElement\r\n * @returns {Boolean}\r\n */\r\nexport function isTableWidget( viewElement ) {\r\n\treturn !!viewElement.getCustomProperty( tableSymbol ) && isWidget( viewElement );\r\n}\r\n\r\n/**\r\n * Checks if a table widget is the only selected element.\r\n *\r\n * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} selection\r\n * @returns {Boolean}\r\n */\r\nexport function isTableWidgetSelected( selection ) {\r\n\tconst viewElement = selection.getSelectedElement();\r\n\r\n\treturn !!( viewElement && isTableWidget( viewElement ) );\r\n}\r\n\r\n/**\r\n * Checks if a table widget content is selected.\r\n *\r\n * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} selection\r\n * @returns {Boolean}\r\n */\r\nexport function isTableContentSelected( selection ) {\r\n\tconst parentTable = findAncestor( 'table', selection.getFirstPosition() );\r\n\r\n\treturn !!( parentTable && isTableWidget( parentTable.parent ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/converters/downcast\r\n */\r\n\r\nimport TableWalker from './../tablewalker';\r\nimport { toWidgetEditable } from '@ckeditor/ckeditor5-widget/src/utils';\r\nimport { toTableWidget } from '../utils';\r\n\r\n/**\r\n * Model table element to view table element conversion helper.\r\n *\r\n * This conversion helper creates the whole table element with child elements.\r\n *\r\n * @param {Object} options\r\n * @param {Boolean} options.asWidget If set to `true`, the downcast conversion will produce a widget.\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastInsertTable( options = {} ) {\r\n\treturn dispatcher => dispatcher.on( 'insert:table', ( evt, data, conversionApi ) => {\r\n\t\tconst table = data.item;\r\n\r\n\t\tif ( !conversionApi.consumable.consume( table, 'insert' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Consume attributes if present to not fire attribute change downcast\r\n\t\tconversionApi.consumable.consume( table, 'attribute:headingRows:table' );\r\n\t\tconversionApi.consumable.consume( table, 'attribute:headingColumns:table' );\r\n\r\n\t\tconst asWidget = options && options.asWidget;\r\n\r\n\t\tconst figureElement = conversionApi.writer.createContainerElement( 'figure', { class: 'table' } );\r\n\t\tconst tableElement = conversionApi.writer.createContainerElement( 'table' );\r\n\t\tconversionApi.writer.insert( conversionApi.writer.createPositionAt( figureElement, 0 ), tableElement );\r\n\r\n\t\tlet tableWidget;\r\n\r\n\t\tif ( asWidget ) {\r\n\t\t\ttableWidget = toTableWidget( figureElement, conversionApi.writer );\r\n\t\t}\r\n\r\n\t\tconst tableWalker = new TableWalker( table );\r\n\r\n\t\tconst tableAttributes = {\r\n\t\t\theadingRows: table.getAttribute( 'headingRows' ) || 0,\r\n\t\t\theadingColumns: table.getAttribute( 'headingColumns' ) || 0\r\n\t\t};\r\n\r\n\t\tfor ( const tableWalkerValue of tableWalker ) {\r\n\t\t\tconst { row, cell } = tableWalkerValue;\r\n\r\n\t\t\tconst tableSection = getOrCreateTableSection( getSectionName( row, tableAttributes ), tableElement, conversionApi );\r\n\t\t\tconst tableRow = table.getChild( row );\r\n\r\n\t\t\t// Check if row was converted\r\n\t\t\tconst trElement = getOrCreateTr( tableRow, row, tableSection, conversionApi );\r\n\r\n\t\t\t// Consume table cell - it will be always consumed as we convert whole table at once.\r\n\t\t\tconversionApi.consumable.consume( cell, 'insert' );\r\n\r\n\t\t\tconst insertPosition = conversionApi.writer.createPositionAt( trElement, 'end' );\r\n\r\n\t\t\tcreateViewTableCellElement( tableWalkerValue, tableAttributes, insertPosition, conversionApi, options );\r\n\t\t}\r\n\r\n\t\tconst viewPosition = conversionApi.mapper.toViewPosition( data.range.start );\r\n\r\n\t\tconversionApi.mapper.bindElements( table, asWidget ? tableWidget : figureElement );\r\n\t\tconversionApi.writer.insert( viewPosition, asWidget ? tableWidget : figureElement );\r\n\t} );\r\n}\r\n\r\n/**\r\n * Model row element to view `<tr>` element conversion helper.\r\n *\r\n * This conversion helper creates the whole `<tr>` element with child elements.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastInsertRow( options = {} ) {\r\n\treturn dispatcher => dispatcher.on( 'insert:tableRow', ( evt, data, conversionApi ) => {\r\n\t\tconst tableRow = data.item;\r\n\r\n\t\tif ( !conversionApi.consumable.consume( tableRow, 'insert' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst figureElement = conversionApi.mapper.toViewElement( table );\r\n\t\tconst tableElement = getViewTable( figureElement );\r\n\r\n\t\tconst row = table.getChildIndex( tableRow );\r\n\r\n\t\tconst tableWalker = new TableWalker( table, { startRow: row, endRow: row } );\r\n\r\n\t\tconst tableAttributes = {\r\n\t\t\theadingRows: table.getAttribute( 'headingRows' ) || 0,\r\n\t\t\theadingColumns: table.getAttribute( 'headingColumns' ) || 0\r\n\t\t};\r\n\r\n\t\tfor ( const tableWalkerValue of tableWalker ) {\r\n\t\t\tconst tableSection = getOrCreateTableSection( getSectionName( row, tableAttributes ), tableElement, conversionApi );\r\n\t\t\tconst trElement = getOrCreateTr( tableRow, row, tableSection, conversionApi );\r\n\r\n\t\t\t// Consume table cell - it will be always consumed as we convert whole row at once.\r\n\t\t\tconversionApi.consumable.consume( tableWalkerValue.cell, 'insert' );\r\n\r\n\t\t\tconst insertPosition = conversionApi.writer.createPositionAt( trElement, 'end' );\r\n\r\n\t\t\tcreateViewTableCellElement( tableWalkerValue, tableAttributes, insertPosition, conversionApi, options );\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Model table cell element to view `<td>` or `<th>` element conversion helper.\r\n *\r\n * This conversion helper will create proper `<th>` elements for table cells that are in the heading section (heading row or column)\r\n * and `<td>` otherwise.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastInsertCell( options = {} ) {\r\n\treturn dispatcher => dispatcher.on( 'insert:tableCell', ( evt, data, conversionApi ) => {\r\n\t\tconst tableCell = data.item;\r\n\r\n\t\tif ( !conversionApi.consumable.consume( tableCell, 'insert' ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\t\tconst rowIndex = table.getChildIndex( tableRow );\r\n\r\n\t\tconst tableWalker = new TableWalker( table, { startRow: rowIndex, endRow: rowIndex } );\r\n\r\n\t\tconst tableAttributes = {\r\n\t\t\theadingRows: table.getAttribute( 'headingRows' ) || 0,\r\n\t\t\theadingColumns: table.getAttribute( 'headingColumns' ) || 0\r\n\t\t};\r\n\r\n\t\t// We need to iterate over a table in order to get proper row & column values from a walker\r\n\t\tfor ( const tableWalkerValue of tableWalker ) {\r\n\t\t\tif ( tableWalkerValue.cell === tableCell ) {\r\n\t\t\t\tconst trElement = conversionApi.mapper.toViewElement( tableRow );\r\n\t\t\t\tconst insertPosition = conversionApi.writer.createPositionAt( trElement, tableRow.getChildIndex( tableCell ) );\r\n\r\n\t\t\t\tcreateViewTableCellElement( tableWalkerValue, tableAttributes, insertPosition, conversionApi, options );\r\n\r\n\t\t\t\t// No need to iterate further.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Conversion helper that acts on heading rows table attribute change.\r\n *\r\n * This converter will:\r\n *\r\n * * Rename `<td>` to `<th>` elements or vice versa depending on headings.\r\n * * Create `<thead>` or `<tbody>` elements if needed.\r\n * * Remove empty `<thead>` or `<tbody>` if needed.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastTableHeadingRowsChange( options = {} ) {\r\n\tconst asWidget = !!options.asWidget;\r\n\r\n\treturn dispatcher => dispatcher.on( 'attribute:headingRows:table', ( evt, data, conversionApi ) => {\r\n\t\tconst table = data.item;\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst figureElement = conversionApi.mapper.toViewElement( table );\r\n\t\tconst viewTable = getViewTable( figureElement );\r\n\r\n\t\tconst oldRows = data.attributeOldValue;\r\n\t\tconst newRows = data.attributeNewValue;\r\n\r\n\t\t// The head section has grown so move rows from <tbody> to <thead>.\r\n\t\tif ( newRows > oldRows ) {\r\n\t\t\t// Filter out only those rows that are in wrong section.\r\n\t\t\tconst rowsToMove = Array.from( table.getChildren() ).filter( ( { index } ) => isBetween( index, oldRows - 1, newRows ) );\r\n\r\n\t\t\tconst viewTableHead = getOrCreateTableSection( 'thead', viewTable, conversionApi );\r\n\t\t\tmoveViewRowsToTableSection( rowsToMove, viewTableHead, conversionApi, 'end' );\r\n\r\n\t\t\t// Rename all table cells from moved rows to 'th' as they lands in <thead>.\r\n\t\t\tfor ( const tableRow of rowsToMove ) {\r\n\t\t\t\tfor ( const tableCell of tableRow.getChildren() ) {\r\n\t\t\t\t\trenameViewTableCell( tableCell, 'th', conversionApi, asWidget );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Cleanup: this will remove any empty section from the view which may happen when moving all rows from a table section.\r\n\t\t\tremoveTableSectionIfEmpty( 'tbody', viewTable, conversionApi );\r\n\t\t}\r\n\t\t// The head section has shrunk so move rows from <thead> to <tbody>.\r\n\t\telse {\r\n\t\t\t// Filter out only those rows that are in wrong section.\r\n\t\t\tconst rowsToMove = Array.from( table.getChildren() )\r\n\t\t\t\t.filter( ( { index } ) => isBetween( index, newRows - 1, oldRows ) )\r\n\t\t\t\t.reverse(); // The rows will be moved from <thead> to <tbody> in reverse order at the beginning of a <tbody>.\r\n\r\n\t\t\tconst viewTableBody = getOrCreateTableSection( 'tbody', viewTable, conversionApi );\r\n\t\t\tmoveViewRowsToTableSection( rowsToMove, viewTableBody, conversionApi, 0 );\r\n\r\n\t\t\t// Check if cells moved from <thead> to <tbody> requires renaming to <td> as this depends on current heading columns attribute.\r\n\t\t\tconst tableWalker = new TableWalker( table, { startRow: newRows ? newRows - 1 : newRows, endRow: oldRows - 1 } );\r\n\r\n\t\t\tconst tableAttributes = {\r\n\t\t\t\theadingRows: table.getAttribute( 'headingRows' ) || 0,\r\n\t\t\t\theadingColumns: table.getAttribute( 'headingColumns' ) || 0\r\n\t\t\t};\r\n\r\n\t\t\tfor ( const tableWalkerValue of tableWalker ) {\r\n\t\t\t\trenameViewTableCellIfRequired( tableWalkerValue, tableAttributes, conversionApi, asWidget );\r\n\t\t\t}\r\n\r\n\t\t\t// Cleanup: this will remove any empty section from the view which may happen when moving all rows from a table section.\r\n\t\t\tremoveTableSectionIfEmpty( 'thead', viewTable, conversionApi );\r\n\t\t}\r\n\r\n\t\tfunction isBetween( index, lower, upper ) {\r\n\t\t\treturn index > lower && index < upper;\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Conversion helper that acts on heading columns table attribute change.\r\n *\r\n * Depending on changed attributes this converter will rename `<td` to `<th>` elements or vice versa depending of the cell column index.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastTableHeadingColumnsChange( options = {} ) {\r\n\tconst asWidget = !!options.asWidget;\r\n\r\n\treturn dispatcher => dispatcher.on( 'attribute:headingColumns:table', ( evt, data, conversionApi ) => {\r\n\t\tconst table = data.item;\r\n\r\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst tableAttributes = {\r\n\t\t\theadingRows: table.getAttribute( 'headingRows' ) || 0,\r\n\t\t\theadingColumns: table.getAttribute( 'headingColumns' ) || 0\r\n\t\t};\r\n\r\n\t\tconst oldColumns = data.attributeOldValue;\r\n\t\tconst newColumns = data.attributeNewValue;\r\n\r\n\t\tconst lastColumnToCheck = ( oldColumns > newColumns ? oldColumns : newColumns ) - 1;\r\n\r\n\t\tfor ( const tableWalkerValue of new TableWalker( table ) ) {\r\n\t\t\t// Skip cells that were not in heading section before and after the change.\r\n\t\t\tif ( tableWalkerValue.column > lastColumnToCheck ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\trenameViewTableCellIfRequired( tableWalkerValue, tableAttributes, conversionApi, asWidget );\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n/**\r\n * Conversion helper that acts on a removed row.\r\n *\r\n * @returns {Function} Conversion helper.\r\n */\r\nexport function downcastRemoveRow() {\r\n\treturn dispatcher => dispatcher.on( 'remove:tableRow', ( evt, data, conversionApi ) => {\r\n\t\t// Prevent default remove converter.\r\n\t\tevt.stop();\r\n\t\tconst viewWriter = conversionApi.writer;\r\n\t\tconst mapper = conversionApi.mapper;\r\n\r\n\t\tconst viewStart = mapper.toViewPosition( data.position ).getLastMatchingPosition( value => !value.item.is( 'tr' ) );\r\n\t\tconst viewItem = viewStart.nodeAfter;\r\n\t\tconst tableSection = viewItem.parent;\r\n\r\n\t\t// Remove associated <tr> from the view.\r\n\t\tconst removeRange = viewWriter.createRangeOn( viewItem );\r\n\t\tconst removed = viewWriter.remove( removeRange );\r\n\r\n\t\tfor ( const child of viewWriter.createRangeIn( removed ).getItems() ) {\r\n\t\t\tmapper.unbindViewElement( child );\r\n\t\t}\r\n\r\n\t\t// Check if table section has any children left - if not remove it from the view.\r\n\t\tif ( !tableSection.childCount ) {\r\n\t\t\t// No need to unbind anything as table section is not represented in the model.\r\n\t\t\tviewWriter.remove( viewWriter.createRangeOn( tableSection ) );\r\n\t\t}\r\n\t}, { priority: 'higher' } );\r\n}\r\n\r\n// Renames an existing table cell in the view to a given element name.\r\n//\r\n// **Note** This method will not do anything if a view table cell was not yet converted.\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @param {String} desiredCellElementName\r\n// @param {Object} conversionApi\r\n// @param {Boolean} asWidget\r\nfunction renameViewTableCell( tableCell, desiredCellElementName, conversionApi, asWidget ) {\r\n\tconst viewWriter = conversionApi.writer;\r\n\tconst viewCell = conversionApi.mapper.toViewElement( tableCell );\r\n\r\n\t// View cell might be not yet converted - skip it as it will be properly created by cell converter later on.\r\n\tif ( !viewCell ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet renamedCell;\r\n\r\n\tif ( asWidget ) {\r\n\t\tconst editable = viewWriter.createEditableElement( desiredCellElementName, viewCell.getAttributes() );\r\n\t\trenamedCell = toWidgetEditable( editable, viewWriter );\r\n\r\n\t\tviewWriter.insert( viewWriter.createPositionAfter( viewCell ), renamedCell );\r\n\t\tviewWriter.move( viewWriter.createRangeIn( viewCell ), viewWriter.createPositionAt( renamedCell, 0 ) );\r\n\t\tviewWriter.remove( viewWriter.createRangeOn( viewCell ) );\r\n\t} else {\r\n\t\trenamedCell = viewWriter.rename( desiredCellElementName, viewCell );\r\n\t}\r\n\r\n\tconversionApi.mapper.bindElements( tableCell, renamedCell );\r\n}\r\n\r\n// Renames a table cell element in the view according to its location in the table.\r\n//\r\n// @param {module:table/tablewalker~TableWalkerValue} tableWalkerValue\r\n// @param {{headingColumns, headingRows}} tableAttributes\r\n// @param {Object} conversionApi\r\n// @param {Boolean} asWidget\r\nfunction renameViewTableCellIfRequired( tableWalkerValue, tableAttributes, conversionApi, asWidget ) {\r\n\tconst { cell } = tableWalkerValue;\r\n\r\n\t// Check whether current columnIndex is overlapped by table cells from previous rows.\r\n\tconst desiredCellElementName = getCellElementName( tableWalkerValue, tableAttributes );\r\n\r\n\tconst viewCell = conversionApi.mapper.toViewElement( cell );\r\n\r\n\t// If in single change we're converting attribute changes and inserting cell the table cell might not be inserted into view\r\n\t// because of child conversion is done after parent.\r\n\tif ( viewCell && viewCell.name !== desiredCellElementName ) {\r\n\t\trenameViewTableCell( cell, desiredCellElementName, conversionApi, asWidget );\r\n\t}\r\n}\r\n\r\n// Creates a table cell element in the view.\r\n//\r\n// @param {module:table/tablewalker~TableWalkerValue} tableWalkerValue\r\n// @param {module:engine/view/position~Position} insertPosition\r\n// @param {Object} conversionApi\r\nfunction createViewTableCellElement( tableWalkerValue, tableAttributes, insertPosition, conversionApi, options ) {\r\n\tconst asWidget = options && options.asWidget;\r\n\tconst cellElementName = getCellElementName( tableWalkerValue, tableAttributes );\r\n\r\n\tconst cellElement = asWidget ?\r\n\t\ttoWidgetEditable( conversionApi.writer.createEditableElement( cellElementName ), conversionApi.writer ) :\r\n\t\tconversionApi.writer.createContainerElement( cellElementName );\r\n\r\n\tconst tableCell = tableWalkerValue.cell;\r\n\r\n\tconst isSingleParagraph = tableCell.childCount === 1 && tableCell.getChild( 0 ).name === 'paragraph';\r\n\r\n\tconversionApi.writer.insert( insertPosition, cellElement );\r\n\r\n\tif ( isSingleParagraph ) {\r\n\t\tconst innerParagraph = tableCell.getChild( 0 );\r\n\t\tconst paragraphInsertPosition = conversionApi.writer.createPositionAt( cellElement, 'end' );\r\n\r\n\t\tconversionApi.consumable.consume( innerParagraph, 'insert' );\r\n\r\n\t\tif ( options.asWidget ) {\r\n\t\t\tconst containerName = [ ...innerParagraph.getAttributeKeys() ].length ? 'p' : 'span';\r\n\r\n\t\t\tconst fakeParagraph = conversionApi.writer.createContainerElement( containerName );\r\n\r\n\t\t\tconversionApi.mapper.bindElements( innerParagraph, fakeParagraph );\r\n\t\t\tconversionApi.writer.insert( paragraphInsertPosition, fakeParagraph );\r\n\r\n\t\t\tconversionApi.mapper.bindElements( tableCell, cellElement );\r\n\t\t} else {\r\n\t\t\tconversionApi.mapper.bindElements( tableCell, cellElement );\r\n\t\t\tconversionApi.mapper.bindElements( innerParagraph, cellElement );\r\n\t\t}\r\n\t} else {\r\n\t\tconversionApi.mapper.bindElements( tableCell, cellElement );\r\n\t}\r\n}\r\n\r\n// Creates or returns an existing `<tr>` element from the view.\r\n//\r\n// @param {module:engine/view/element~Element} tableRow\r\n// @param {Number} rowIndex\r\n// @param {module:engine/view/element~Element} tableSection\r\n// @param {Object} conversionApi\r\n// @returns {module:engine/view/element~Element}\r\nfunction getOrCreateTr( tableRow, rowIndex, tableSection, conversionApi ) {\r\n\tlet trElement = conversionApi.mapper.toViewElement( tableRow );\r\n\r\n\tif ( !trElement ) {\r\n\t\t// Will always consume since we're converting <tableRow> element from a parent <table>.\r\n\t\tconversionApi.consumable.consume( tableRow, 'insert' );\r\n\r\n\t\ttrElement = conversionApi.writer.createContainerElement( 'tr' );\r\n\t\tconversionApi.mapper.bindElements( tableRow, trElement );\r\n\r\n\t\tconst headingRows = tableRow.parent.getAttribute( 'headingRows' ) || 0;\r\n\t\tconst offset = headingRows > 0 && rowIndex >= headingRows ? rowIndex - headingRows : rowIndex;\r\n\r\n\t\tconst position = conversionApi.writer.createPositionAt( tableSection, offset );\r\n\t\tconversionApi.writer.insert( position, trElement );\r\n\t}\r\n\r\n\treturn trElement;\r\n}\r\n\r\n// Returns `th` for heading cells and `td` for other cells for the current table walker value.\r\n//\r\n// @param {module:table/tablewalker~TableWalkerValue} tableWalkerValue\r\n// @param {{headingColumns, headingRows}} tableAttributes\r\n// @returns {String}\r\nfunction getCellElementName( tableWalkerValue, tableAttributes ) {\r\n\tconst { row, column } = tableWalkerValue;\r\n\tconst { headingColumns, headingRows } = tableAttributes;\r\n\r\n\t// Column heading are all tableCells in the first `columnHeading` rows.\r\n\tconst isColumnHeading = headingRows && headingRows > row;\r\n\r\n\t// So a whole row gets <th> element.\r\n\tif ( isColumnHeading ) {\r\n\t\treturn 'th';\r\n\t}\r\n\r\n\t// Row heading are tableCells which columnIndex is lower then headingColumns.\r\n\tconst isRowHeading = headingColumns && headingColumns > column;\r\n\r\n\treturn isRowHeading ? 'th' : 'td';\r\n}\r\n\r\n// Returns the table section name for the current table walker value.\r\n//\r\n// @param {Number} row\r\n// @param {{headingColumns, headingRows}} tableAttributes\r\n// @returns {String}\r\nfunction getSectionName( row, tableAttributes ) {\r\n\treturn row < tableAttributes.headingRows ? 'thead' : 'tbody';\r\n}\r\n\r\n// Creates or returns an existing `<tbody>` or `<thead>` element witch caching.\r\n//\r\n// @param {String} sectionName\r\n// @param {module:engine/view/element~Element} viewTable\r\n// @param {Object} conversionApi\r\n// @param {Object} cachedTableSection An object that stores cached elements.\r\n// @returns {module:engine/view/containerelement~ContainerElement}\r\nfunction getOrCreateTableSection( sectionName, viewTable, conversionApi ) {\r\n\tconst viewTableSection = getExistingTableSectionElement( sectionName, viewTable );\r\n\r\n\treturn viewTableSection ? viewTableSection : createTableSection( sectionName, viewTable, conversionApi );\r\n}\r\n\r\n// Finds an existing `<tbody>` or `<thead>` element or returns undefined.\r\n//\r\n// @param {String} sectionName\r\n// @param {module:engine/view/element~Element} tableElement\r\n// @param {Object} conversionApi\r\nfunction getExistingTableSectionElement( sectionName, tableElement ) {\r\n\tfor ( const tableSection of tableElement.getChildren() ) {\r\n\t\tif ( tableSection.name == sectionName ) {\r\n\t\t\treturn tableSection;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Creates a table section at the end of the table.\r\n//\r\n// @param {String} sectionName\r\n// @param {module:engine/view/element~Element} tableElement\r\n// @param {Object} conversionApi\r\n// @returns {module:engine/view/containerelement~ContainerElement}\r\nfunction createTableSection( sectionName, tableElement, conversionApi ) {\r\n\tconst tableChildElement = conversionApi.writer.createContainerElement( sectionName );\r\n\r\n\tconst insertPosition = conversionApi.writer.createPositionAt( tableElement, sectionName == 'tbody' ? 'end' : 0 );\r\n\r\n\tconversionApi.writer.insert( insertPosition, tableChildElement );\r\n\r\n\treturn tableChildElement;\r\n}\r\n\r\n// Removes an existing `<tbody>` or `<thead>` element if it is empty.\r\n//\r\n// @param {String} sectionName\r\n// @param {module:engine/view/element~Element} tableElement\r\n// @param {Object} conversionApi\r\nfunction removeTableSectionIfEmpty( sectionName, tableElement, conversionApi ) {\r\n\tconst tableSection = getExistingTableSectionElement( sectionName, tableElement );\r\n\r\n\tif ( tableSection && tableSection.childCount === 0 ) {\r\n\t\tconversionApi.writer.remove( conversionApi.writer.createRangeOn( tableSection ) );\r\n\t}\r\n}\r\n\r\n// Moves view table rows associated with passed model rows to the provided table section element.\r\n//\r\n// **Note** This method will skip not converted table rows.\r\n//\r\n// @param {Array.<module:engine/model/element~Element>} rowsToMove\r\n// @param {module:engine/view/element~Element} viewTableSection\r\n// @param {Object} conversionApi\r\n// @param {Number|'end'|'before'|'after'} offset Offset or one of the flags.\r\nfunction moveViewRowsToTableSection( rowsToMove, viewTableSection, conversionApi, offset ) {\r\n\tfor ( const tableRow of rowsToMove ) {\r\n\t\tconst viewTableRow = conversionApi.mapper.toViewElement( tableRow );\r\n\r\n\t\t// View table row might be not yet converted - skip it as it will be properly created by cell converter later on.\r\n\t\tif ( viewTableRow ) {\r\n\t\t\tconversionApi.writer.move(\r\n\t\t\t\tconversionApi.writer.createRangeOn( viewTableRow ),\r\n\t\t\t\tconversionApi.writer.createPositionAt( viewTableSection, offset )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Properly finds '<table>' element inside `<figure>` widget.\r\n//\r\n// @param {module:engine/view/element~Element} viewFigure\r\nfunction getViewTable( viewFigure ) {\r\n\tfor ( const child of viewFigure.getChildren() ) {\r\n\t\tif ( child.name === 'table' ) {\r\n\t\t\treturn child;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/tableutils\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport TableWalker from './tablewalker';\r\nimport { createEmptyTableCell, updateNumericAttribute } from './commands/utils';\r\n\r\n/**\r\n * The table utilities plugin.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class TableUtils extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'TableUtils';\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the table cell location as an object with table row and table column indexes.\r\n\t *\r\n\t * For instance in the table below:\r\n\t *\r\n\t *\t\t    0   1   2   3\r\n\t *\t\t  +---+---+---+---+\r\n\t *\t\t0 | a     | b | c |\r\n\t *\t\t  +       +   +---+\r\n\t *\t\t1 |       |   | d |\r\n\t *\t\t  +---+---+   +---+\r\n\t *\t\t2 | e     |   | f |\r\n\t *\t\t  +---+---+---+---+\r\n\t *\r\n\t * the method will return:\r\n\t *\r\n\t *\t\tconst cellA = table.getNodeByPath( [ 0, 0 ] );\r\n\t *\t\teditor.plugins.get( 'TableUtils' ).getCellLocation( cellA );\r\n\t *\t\t// will return { row: 0, column: 0 }\r\n\t *\r\n\t *\t\tconst cellD = table.getNodeByPath( [ 1, 0 ] );\r\n\t *\t\teditor.plugins.get( 'TableUtils' ).getCellLocation( cellD );\r\n\t *\t\t// will return { row: 1, column: 3 }\r\n\t *\r\n\t * @param {module:engine/model/element~Element} tableCell\r\n\t * @returns {Object} Returns a `{row, column}` object.\r\n\t */\r\n\tgetCellLocation( tableCell ) {\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst rowIndex = table.getChildIndex( tableRow );\r\n\r\n\t\tconst tableWalker = new TableWalker( table, { startRow: rowIndex, endRow: rowIndex } );\r\n\r\n\t\tfor ( const { cell, row, column } of tableWalker ) {\r\n\t\t\tif ( cell === tableCell ) {\r\n\t\t\t\treturn { row, column };\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an empty table with proper structure. The table needs to be inserted into the model,\r\n\t * ie. using {@link module:engine/model/model~Model#insertContent} function.\r\n\t *\r\n\t *\t\tmodel.change( ( writer ) => {\r\n\t *\t\t\t// Create a table of 2 rows and 7 columns:\r\n\t *\t\t\tconst table = tableUtils.createTable( writer, 2, 7);\r\n\t *\r\n\t *\t\t\t// Insert table to the model at the best position taking current selection:\r\n\t *\t\t\tmodel.insertContent( table );\r\n\t *\t\t}\r\n\t *\r\n\t * @param {module:engine/model/writer~Writer} writer The model writer.\r\n\t * @param {Number} rows The number of rows to create.\r\n\t * @param {Number} columns The number of columns to create.\r\n\t * @returns {module:engine/model/element~Element} The created table element.\r\n\t */\r\n\tcreateTable( writer, rows, columns ) {\r\n\t\tconst table = writer.createElement( 'table' );\r\n\r\n\t\tcreateEmptyRows( writer, table, 0, rows, columns );\r\n\r\n\t\treturn table;\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts rows into a table.\r\n\t *\r\n\t *\t\teditor.plugins.get( 'TableUtils' ).insertRows( table, { at: 1, rows: 2 } );\r\n\t *\r\n\t * Assuming the table on the left, the above code will transform it to the table on the right:\r\n\t *\r\n\t *\t\trow index\r\n\t *\t\t  0 +---+---+---+       `at` = 1,      +---+---+---+ 0\r\n\t *\t\t    | a | b | c |       `rows` = 2,    | a | b | c |\r\n\t *\t\t  1 +   +---+---+   <-- insert here    +   +---+---+ 1\r\n\t *\t\t    |   | d | e |                      |   |   |   |\r\n\t *\t\t  2 +   +---+---+       will give:     +   +---+---+ 2\r\n\t *\t\t    |   | f | g |                      |   |   |   |\r\n\t *\t\t  3 +---+---+---+                      +   +---+---+ 3\r\n\t *\t\t                                       |   | d | e |\r\n\t *\t\t                                       +---+---+---+ 4\r\n\t *\t\t                                       +   + f | g |\r\n\t *\t\t                                       +---+---+---+ 5\r\n\t *\r\n\t * @param {module:engine/model/element~Element} table The table model element where the rows will be inserted.\r\n\t * @param {Object} options\r\n\t * @param {Number} [options.at=0] Row index at which the rows will be inserted.\r\n\t * @param {Number} [options.rows=1] The number of rows to insert.\r\n\t */\r\n\tinsertRows( table, options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\r\n\t\tconst insertAt = options.at || 0;\r\n\t\tconst rowsToInsert = options.rows || 1;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst headingRows = table.getAttribute( 'headingRows' ) || 0;\r\n\r\n\t\t\t// Inserting rows inside heading section requires to update `headingRows` attribute as the heading section will grow.\r\n\t\t\tif ( headingRows > insertAt ) {\r\n\t\t\t\twriter.setAttribute( 'headingRows', headingRows + rowsToInsert, table );\r\n\t\t\t}\r\n\r\n\t\t\t// Inserting at the end and at the beginning of a table doesn't require to calculate anything special.\r\n\t\t\tif ( insertAt === 0 || insertAt === table.childCount ) {\r\n\t\t\t\tcreateEmptyRows( writer, table, insertAt, rowsToInsert, this.getColumns( table ) );\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Iterate over all rows above inserted rows in order to check for rowspanned cells.\r\n\t\t\tconst tableIterator = new TableWalker( table, { endRow: insertAt } );\r\n\r\n\t\t\t// Will hold number of cells needed to insert in created rows.\r\n\t\t\t// The number might be different then table cell width when there are rowspanned cells.\r\n\t\t\tlet cellsToInsert = 0;\r\n\r\n\t\t\tfor ( const { row, rowspan, colspan, cell } of tableIterator ) {\r\n\t\t\t\tconst isBeforeInsertedRow = row < insertAt;\r\n\t\t\t\tconst overlapsInsertedRow = row + rowspan > insertAt;\r\n\r\n\t\t\t\tif ( isBeforeInsertedRow && overlapsInsertedRow ) {\r\n\t\t\t\t\t// This cell overlaps inserted rows so we need to expand it further.\r\n\t\t\t\t\twriter.setAttribute( 'rowspan', rowspan + rowsToInsert, cell );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Calculate how many cells to insert based on the width of cells in a row at insert position.\r\n\t\t\t\t// It might be lower then table width as some cells might overlaps inserted row.\r\n\t\t\t\t// In the table above the cell 'a' overlaps inserted row so only two empty cells are need to be created.\r\n\t\t\t\tif ( row === insertAt ) {\r\n\t\t\t\t\tcellsToInsert += colspan;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcreateEmptyRows( writer, table, insertAt, rowsToInsert, cellsToInsert );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts columns into a table.\r\n\t *\r\n\t *\t\teditor.plugins.get( 'TableUtils' ).insertColumns( table, { at: 1, columns: 2 } );\r\n\t *\r\n\t * Assuming the table on the left, the above code will transform it to the table on the right:\r\n\t *\r\n\t *\t\t0   1   2   3                   0   1   2   3   4   5\r\n\t *\t\t+---+---+---+                   +---+---+---+---+---+\r\n\t *\t\t| a     | b |                   | a             | b |\r\n\t *\t\t+       +---+                   +               +---+\r\n\t *\t\t|       | c |                   |               | c |\r\n\t *\t\t+---+---+---+     will give:    +---+---+---+---+---+\r\n\t *\t\t| d | e | f |                   | d |   |   | e | f |\r\n\t *\t\t+---+   +---+                   +---+---+---+  +---+\r\n\t *\t\t| g |   | h |                   | g |   |   |   | h |\r\n\t *\t\t+---+---+---+                   +---+---+---+---+---+\r\n\t *\t\t| i         |                   | i                 |\r\n\t *\t\t+---+---+---+                   +---+---+---+---+---+\r\n\t *\t\t    ^---- insert here, `at` = 1, `columns` = 2\r\n\t *\r\n\t * @param {module:engine/model/element~Element} table The table model element where the columns will be inserted.\r\n\t * @param {Object} options\r\n\t * @param {Number} [options.at=0] Column index at which the columns will be inserted.\r\n\t * @param {Number} [options.columns=1] The number of columns to insert.\r\n\t */\r\n\tinsertColumns( table, options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\r\n\t\tconst insertAt = options.at || 0;\r\n\t\tconst columnsToInsert = options.columns || 1;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst headingColumns = table.getAttribute( 'headingColumns' );\r\n\r\n\t\t\t// Inserting columns inside heading section requires to update `headingColumns` attribute as the heading section will grow.\r\n\t\t\tif ( insertAt < headingColumns ) {\r\n\t\t\t\twriter.setAttribute( 'headingColumns', headingColumns + columnsToInsert, table );\r\n\t\t\t}\r\n\r\n\t\t\tconst tableColumns = this.getColumns( table );\r\n\r\n\t\t\t// Inserting at the end and at the beginning of a table doesn't require to calculate anything special.\r\n\t\t\tif ( insertAt === 0 || tableColumns === insertAt ) {\r\n\t\t\t\tfor ( const tableRow of table.getChildren() ) {\r\n\t\t\t\t\tcreateCells( columnsToInsert, writer, writer.createPositionAt( tableRow, insertAt ? 'end' : 0 ) );\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst tableWalker = new TableWalker( table, { column: insertAt, includeSpanned: true } );\r\n\r\n\t\t\tfor ( const { row, column, cell, colspan, rowspan, cellIndex } of tableWalker ) {\r\n\t\t\t\t// When iterating over column the table walker outputs either:\r\n\t\t\t\t// - cells at given column index (cell \"e\" from method docs),\r\n\t\t\t\t// - spanned columns (spanned cell from row between cells \"g\" and \"h\" - spanned by \"e\", only if `includeSpanned: true`),\r\n\t\t\t\t// - or a cell from the same row which spans over this column (cell \"a\").\r\n\r\n\t\t\t\tif ( column !== insertAt ) {\r\n\t\t\t\t\t// If column is different than `insertAt`, it is a cell that spans over an inserted column (cell \"a\" & \"i\").\r\n\t\t\t\t\t// For such cells expand them by a number of columns inserted.\r\n\t\t\t\t\twriter.setAttribute( 'colspan', colspan + columnsToInsert, cell );\r\n\r\n\t\t\t\t\t// The `includeSpanned` option will output the \"empty\"/spanned column so skip this row already.\r\n\t\t\t\t\ttableWalker.skipRow( row );\r\n\r\n\t\t\t\t\t// This cell will overlap cells in rows below so skip them also (because of `includeSpanned` option) - (cell \"a\")\r\n\t\t\t\t\tif ( rowspan > 1 ) {\r\n\t\t\t\t\t\tfor ( let i = row + 1; i < row + rowspan; i++ ) {\r\n\t\t\t\t\t\t\ttableWalker.skipRow( i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// It's either cell at this column index or spanned cell by a rowspanned cell from row above.\r\n\t\t\t\t\t// In table above it's cell \"e\" and a spanned position from row below (empty cell between cells \"g\" and \"h\")\r\n\t\t\t\t\tconst insertPosition = writer.createPositionAt( table.getChild( row ), cellIndex );\r\n\r\n\t\t\t\t\tcreateCells( columnsToInsert, writer, insertPosition );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Divides a table cell vertically into several ones.\r\n\t *\r\n\t * The cell will be visually split into more cells by updating colspans of other cells in a column\r\n\t * and inserting cells (columns) after that cell.\r\n\t *\r\n\t * In the table below, if cell \"a\" is split to 3 cells:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a | b | c |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| d | e | f |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * it will result in the table below:\r\n\t *\r\n\t *\t\t+---+---+---+---+---+\r\n\t *\t\t| a |   |   | b | c |\r\n\t *\t\t+---+---+---+---+---+\r\n\t *\t\t| d         | e | f |\r\n\t *\t\t+---+---+---+---+---+\r\n\t *\r\n\t * So cell \"d\" will get its `colspan` updated to `3` and 2 cells will be added (2 columns will be created).\r\n\t *\r\n\t * Splitting a cell that already has a `colspan` attribute set will distribute the cell `colspan` evenly and the remainder\r\n\t * will be left to the original cell:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a         |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| b | c | d |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * Splitting cell \"a\" with `colspan=3` to 2 cells will create 1 cell with a `colspan=a` and cell \"a\" that will have `colspan=2`:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a     |   |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| b | c | d |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * @param {module:engine/model/element~Element} tableCell\r\n\t * @param {Number} numberOfCells\r\n\t */\r\n\tsplitCellVertically( tableCell, numberOfCells = 2 ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst rowspan = parseInt( tableCell.getAttribute( 'rowspan' ) || 1 );\r\n\t\tconst colspan = parseInt( tableCell.getAttribute( 'colspan' ) || 1 );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// First check - the cell spans over multiple rows so before doing anything else just split this cell.\r\n\t\t\tif ( colspan > 1 ) {\r\n\t\t\t\t// Get spans of new (inserted) cells and span to update of split cell.\r\n\t\t\t\tconst { newCellsSpan, updatedSpan } = breakSpanEvenly( colspan, numberOfCells );\r\n\r\n\t\t\t\tupdateNumericAttribute( 'colspan', updatedSpan, tableCell, writer );\r\n\r\n\t\t\t\t// Each inserted cell will have the same attributes:\r\n\t\t\t\tconst newCellsAttributes = {};\r\n\r\n\t\t\t\t// Do not store default value in the model.\r\n\t\t\t\tif ( newCellsSpan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.colspan = newCellsSpan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy rowspan of split cell.\r\n\t\t\t\tif ( rowspan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.rowspan = rowspan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst cellsToInsert = colspan > numberOfCells ? numberOfCells - 1 : colspan - 1;\r\n\t\t\t\tcreateCells( cellsToInsert, writer, writer.createPositionAfter( tableCell ), newCellsAttributes );\r\n\t\t\t}\r\n\r\n\t\t\t// Second check - the cell has colspan of 1 or we need to create more cells then the currently one spans over.\r\n\t\t\tif ( colspan < numberOfCells ) {\r\n\t\t\t\tconst cellsToInsert = numberOfCells - colspan;\r\n\r\n\t\t\t\t// First step: expand cells on the same column as split cell.\r\n\t\t\t\tconst tableMap = [ ...new TableWalker( table ) ];\r\n\r\n\t\t\t\t// Get the column index of split cell.\r\n\t\t\t\tconst { column: splitCellColumn } = tableMap.find( ( { cell } ) => cell === tableCell );\r\n\r\n\t\t\t\t// Find cells which needs to be expanded vertically - those on the same column or those that spans over split cell's column.\r\n\t\t\t\tconst cellsToUpdate = tableMap.filter( ( { cell, colspan, column } ) => {\r\n\t\t\t\t\tconst isOnSameColumn = cell !== tableCell && column === splitCellColumn;\r\n\t\t\t\t\tconst spansOverColumn = ( column < splitCellColumn && column + colspan > splitCellColumn );\r\n\r\n\t\t\t\t\treturn isOnSameColumn || spansOverColumn;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t// Expand cells vertically.\r\n\t\t\t\tfor ( const { cell, colspan } of cellsToUpdate ) {\r\n\t\t\t\t\twriter.setAttribute( 'colspan', colspan + cellsToInsert, cell );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Second step: create columns after split cell.\r\n\r\n\t\t\t\t// Each inserted cell will have the same attributes:\r\n\t\t\t\tconst newCellsAttributes = {};\r\n\r\n\t\t\t\t// Do not store default value in the model.\r\n\r\n\t\t\t\t// Copy rowspan of split cell.\r\n\t\t\t\tif ( rowspan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.rowspan = rowspan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcreateCells( cellsToInsert, writer, writer.createPositionAfter( tableCell ), newCellsAttributes );\r\n\r\n\t\t\t\tconst headingColumns = table.getAttribute( 'headingColumns' ) || 0;\r\n\r\n\t\t\t\t// Update heading section if split cell is in heading section.\r\n\t\t\t\tif ( headingColumns > splitCellColumn ) {\r\n\t\t\t\t\tupdateNumericAttribute( 'headingColumns', headingColumns + cellsToInsert, table, writer );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Divides a table cell horizontally into several ones.\r\n\t *\r\n\t * The cell will be visually split into more cells by updating rowspans of other cells in the row and inserting rows with a single cell\r\n\t * below.\r\n\t *\r\n\t * If in the table below cell \"b\" is split to 3 cells:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a | b | c |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| d | e | f |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * It will result in the table below:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a | b | c |\r\n\t *\t\t+   +---+   +\r\n\t *\t\t|   |   |   |\r\n\t *\t\t+   +---+   +\r\n\t *\t\t|   |   |   |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| d | e | f |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * So cells \"a\" and \"b\" will get their `rowspan` updated to `3` and 2 rows with a single cell will be added.\r\n\t *\r\n\t * Splitting a cell that already has a `rowspan` attribute set will distribute the cell `rowspan` evenly and the remainder\r\n\t * will be left to the original cell:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a | b | c |\r\n\t *\t\t+   +---+---+\r\n\t *\t\t|   | d | e |\r\n\t *\t\t+   +---+---+\r\n\t *\t\t|   | f | g |\r\n\t *\t\t+   +---+---+\r\n\t *\t\t|   | h | i |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * Splitting cell \"a\" with `rowspan=4` to 3 cells will create 2 cells with a `rowspan=1` and cell \"a\" will have `rowspan=2`:\r\n\t *\r\n\t *\t\t+---+---+---+\r\n\t *\t\t| a | b | c |\r\n\t *\t\t+   +---+---+\r\n\t *\t\t|   | d | e |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t|   | f | g |\r\n\t *\t\t+---+---+---+\r\n\t *\t\t|   | h | i |\r\n\t *\t\t+---+---+---+\r\n\t *\r\n\t * @param {module:engine/model/element~Element} tableCell\r\n\t * @param {Number} numberOfCells\r\n\t */\r\n\tsplitCellHorizontally( tableCell, numberOfCells = 2 ) {\r\n\t\tconst model = this.editor.model;\r\n\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\t\tconst splitCellRow = table.getChildIndex( tableRow );\r\n\r\n\t\tconst rowspan = parseInt( tableCell.getAttribute( 'rowspan' ) || 1 );\r\n\t\tconst colspan = parseInt( tableCell.getAttribute( 'colspan' ) || 1 );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// First check - the cell spans over multiple rows so before doing anything else just split this cell.\r\n\t\t\tif ( rowspan > 1 ) {\r\n\t\t\t\t// Cache table map before updating table.\r\n\t\t\t\tconst tableMap = [ ...new TableWalker( table, {\r\n\t\t\t\t\tstartRow: splitCellRow,\r\n\t\t\t\t\tendRow: splitCellRow + rowspan - 1,\r\n\t\t\t\t\tincludeSpanned: true\r\n\t\t\t\t} ) ];\r\n\r\n\t\t\t\t// Get spans of new (inserted) cells and span to update of split cell.\r\n\t\t\t\tconst { newCellsSpan, updatedSpan } = breakSpanEvenly( rowspan, numberOfCells );\r\n\r\n\t\t\t\tupdateNumericAttribute( 'rowspan', updatedSpan, tableCell, writer );\r\n\r\n\t\t\t\tconst { column: cellColumn } = tableMap.find( ( { cell } ) => cell === tableCell );\r\n\r\n\t\t\t\t// Each inserted cell will have the same attributes:\r\n\t\t\t\tconst newCellsAttributes = {};\r\n\r\n\t\t\t\t// Do not store default value in the model.\r\n\t\t\t\tif ( newCellsSpan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.rowspan = newCellsSpan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy colspan of split cell.\r\n\t\t\t\tif ( colspan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.colspan = colspan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( const { column, row, cellIndex } of tableMap ) {\r\n\t\t\t\t\t// As both newly created cells and the split cell might have rowspan,\r\n\t\t\t\t\t// the insertion of new cells must go to appropriate rows:\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// 1. It's a row after split cell + it's height.\r\n\t\t\t\t\tconst isAfterSplitCell = row >= splitCellRow + updatedSpan;\r\n\t\t\t\t\t// 2. Is on the same column.\r\n\t\t\t\t\tconst isOnSameColumn = column === cellColumn;\r\n\t\t\t\t\t// 3. And it's row index is after previous cell height.\r\n\t\t\t\t\tconst isInEvenlySplitRow = ( row + splitCellRow + updatedSpan ) % newCellsSpan === 0;\r\n\r\n\t\t\t\t\tif ( isAfterSplitCell && isOnSameColumn && isInEvenlySplitRow ) {\r\n\t\t\t\t\t\tconst position = writer.createPositionAt( table.getChild( row ), cellIndex );\r\n\r\n\t\t\t\t\t\tcreateCells( 1, writer, position, newCellsAttributes );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Second check - the cell has rowspan of 1 or we need to create more cells than the current cell spans over.\r\n\t\t\tif ( rowspan < numberOfCells ) {\r\n\t\t\t\t// We already split the cell in check one so here we split to the remaining number of cells only.\r\n\t\t\t\tconst cellsToInsert = numberOfCells - rowspan;\r\n\r\n\t\t\t\t// This check is needed since we need to check if there are any cells from previous rows than spans over this cell's row.\r\n\t\t\t\tconst tableMap = [ ...new TableWalker( table, { startRow: 0, endRow: splitCellRow } ) ];\r\n\r\n\t\t\t\t// First step: expand cells.\r\n\t\t\t\tfor ( const { cell, rowspan, row } of tableMap ) {\r\n\t\t\t\t\t// Expand rowspan of cells that are either:\r\n\t\t\t\t\t// - on the same row as current cell,\r\n\t\t\t\t\t// - or are below split cell row and overlaps that row.\r\n\t\t\t\t\tif ( cell !== tableCell && row + rowspan > splitCellRow ) {\r\n\t\t\t\t\t\tconst rowspanToSet = rowspan + cellsToInsert;\r\n\r\n\t\t\t\t\t\twriter.setAttribute( 'rowspan', rowspanToSet, cell );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Second step: create rows with single cell below split cell.\r\n\t\t\t\tconst newCellsAttributes = {};\r\n\r\n\t\t\t\t// Copy colspan of split cell.\r\n\t\t\t\tif ( colspan > 1 ) {\r\n\t\t\t\t\tnewCellsAttributes.colspan = colspan;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcreateEmptyRows( writer, table, splitCellRow + 1, cellsToInsert, 1, newCellsAttributes );\r\n\r\n\t\t\t\t// Update heading section if split cell is in heading section.\r\n\t\t\t\tconst headingRows = table.getAttribute( 'headingRows' ) || 0;\r\n\r\n\t\t\t\tif ( headingRows > splitCellRow ) {\r\n\t\t\t\t\tupdateNumericAttribute( 'headingRows', headingRows + cellsToInsert, table, writer );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of columns for a given table.\r\n\t *\r\n\t *\t\teditor.plugins.get( 'TableUtils' ).getColumns( table );\r\n\t *\r\n\t * @param {module:engine/model/element~Element} table The table to analyze.\r\n\t * @returns {Number}\r\n\t */\r\n\tgetColumns( table ) {\r\n\t\t// Analyze first row only as all the rows should have the same width.\r\n\t\tconst row = table.getChild( 0 );\r\n\r\n\t\treturn [ ...row.getChildren() ].reduce( ( columns, row ) => {\r\n\t\t\tconst columnWidth = parseInt( row.getAttribute( 'colspan' ) || 1 );\r\n\r\n\t\t\treturn columns + columnWidth;\r\n\t\t}, 0 );\r\n\t}\r\n}\r\n\r\n// Creates empty rows at the given index in an existing table.\r\n//\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/element~Element} table\r\n// @param {Number} insertAt Row index of row insertion.\r\n// @param {Number} rows Number of rows to create.\r\n// @param {Number} tableCellToInsert Number of cells to insert in each row.\r\nfunction createEmptyRows( writer, table, insertAt, rows, tableCellToInsert, attributes = {} ) {\r\n\tfor ( let i = 0; i < rows; i++ ) {\r\n\t\tconst tableRow = writer.createElement( 'tableRow' );\r\n\r\n\t\twriter.insert( tableRow, table, insertAt );\r\n\r\n\t\tcreateCells( tableCellToInsert, writer, writer.createPositionAt( tableRow, 'end' ), attributes );\r\n\t}\r\n}\r\n\r\n// Creates cells at a given position.\r\n//\r\n// @param {Number} columns Number of columns to create\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/position~Position} insertPosition\r\nfunction createCells( cells, writer, insertPosition, attributes = {} ) {\r\n\tfor ( let i = 0; i < cells; i++ ) {\r\n\t\tcreateEmptyTableCell( writer, insertPosition, attributes );\r\n\t}\r\n}\r\n\r\n// Evenly distributes the span of a cell to a number of provided cells.\r\n// The resulting spans will always be integer values.\r\n//\r\n// For instance breaking a span of 7 into 3 cells will return:\r\n//\r\n//\t\t{ newCellsSpan: 2, updatedSpan: 3 }\r\n//\r\n// as two cells will have a span of 2 and the remainder will go the first cell so its span will change to 3.\r\n//\r\n// @param {Number} span Span value do break.\r\n// @param {Number} numberOfCells Number of resulting spans.\r\n// @returns {{newCellsSpan: Number, updatedSpan: Number}}\r\nfunction breakSpanEvenly( span, numberOfCells ) {\r\n\tif ( span < numberOfCells ) {\r\n\t\treturn { newCellsSpan: 1, updatedSpan: 1 };\r\n\t}\r\n\r\n\tconst newCellsSpan = Math.floor( span / numberOfCells );\r\n\tconst updatedSpan = ( span - newCellsSpan * numberOfCells ) + newCellsSpan;\r\n\r\n\treturn { newCellsSpan, updatedSpan };\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/inserttablecommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { findOptimalInsertionPosition } from '@ckeditor/ckeditor5-widget/src/utils';\r\nimport TableUtils from '../tableutils';\r\n\r\n/**\r\n * The insert table command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'insertTable'` editor command.\r\n *\r\n * To insert a table at the current selection, execute the command and specify the dimensions:\r\n *\r\n *\t\teditor.execute( 'insertTable', { rows: 20, columns: 5 } );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class InsertTableCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\t\tconst schema = model.schema;\r\n\r\n\t\tconst validParent = getInsertTableParent( selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = schema.checkChild( validParent, 'table' );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * Inserts a table with the given number of rows and columns into the editor.\r\n\t *\r\n\t * @param {Object} options\r\n\t * @param {Number} [options.rows=2] The number of rows to create in the inserted table.\r\n\t * @param {Number} [options.columns=2] The number of columns to create in the inserted table.\r\n\t * @fires execute\r\n\t */\r\n\texecute( options = {} ) {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\t\tconst tableUtils = this.editor.plugins.get( TableUtils );\r\n\r\n\t\tconst rows = parseInt( options.rows ) || 2;\r\n\t\tconst columns = parseInt( options.columns ) || 2;\r\n\r\n\t\tconst insertPosition = findOptimalInsertionPosition( selection, model );\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst table = tableUtils.createTable( writer, rows, columns );\r\n\r\n\t\t\tmodel.insertContent( table, insertPosition );\r\n\r\n\t\t\twriter.setSelection( writer.createPositionAt( table.getNodeByPath( [ 0, 0, 0 ] ), 0 ) );\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n// Returns valid parent to insert table\r\n//\r\n// @param {module:engine/model/position} position\r\nfunction getInsertTableParent( position ) {\r\n\tconst parent = position.parent;\r\n\r\n\treturn parent === parent.root ? parent : parent.parent;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/insertrowcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { findAncestor } from './utils';\r\nimport TableUtils from '../tableutils';\r\n\r\n/**\r\n * The insert row command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'insertTableRowBelow'` and\r\n * `'insertTableRowAbove'` editor commands.\r\n *\r\n * To insert a row below the selected cell, execute the following command:\r\n *\r\n *\t\teditor.execute( 'insertTableRowBelow' );\r\n *\r\n * To insert a row above the selected cell, execute the following command:\r\n *\r\n *\t\teditor.execute( 'insertTableRowAbove' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class InsertRowCommand extends Command {\r\n\t/**\r\n\t * Creates a new `InsertRowCommand` instance.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor on which this command will be used.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.order=\"below\"] The order of insertion relative to the row in which the caret is located.\r\n\t * Possible values: `\"above\"` and `\"below\"`.\r\n\t */\r\n\tconstructor( editor, options = {} ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The order of insertion relative to the row in which the caret is located.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} module:table/commands/insertrowcommand~InsertRowCommand#order\r\n\t\t */\r\n\t\tthis.order = options.order || 'below';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst selection = this.editor.model.document.selection;\r\n\r\n\t\tconst tableParent = findAncestor( 'table', selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = !!tableParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * Depending on the command's {@link #order} value, it inserts a row `'below'` or `'above'` the row in which selection is set.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst selection = editor.model.document.selection;\r\n\t\tconst tableUtils = editor.plugins.get( TableUtils );\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', selection.getFirstPosition() );\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst row = table.getChildIndex( tableRow );\r\n\t\tconst insertAt = this.order === 'below' ? row + 1 : row;\r\n\r\n\t\ttableUtils.insertRows( table, { rows: 1, at: insertAt } );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/insertcolumncommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport { findAncestor } from './utils';\r\nimport TableUtils from '../tableutils';\r\n\r\n/**\r\n * The insert column command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'insertTableColumnLeft'` and\r\n * `'insertTableColumnRight'` editor commands.\r\n *\r\n * To insert a column to the left of the selected cell, execute the following command:\r\n *\r\n *\t\teditor.execute( 'insertTableColumnLeft' );\r\n *\r\n * To insert a column to the right of the selected cell, execute the following command:\r\n *\r\n *\t\teditor.execute( 'insertTableColumnRight' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class InsertColumnCommand extends Command {\r\n\t/**\r\n\t * Creates a new `InsertColumnCommand` instance.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor An editor on which this command will be used.\r\n\t * @param {Object} options\r\n\t * @param {String} [options.order=\"right\"] The order of insertion relative to the column in which the caret is located.\r\n\t * Possible values: `\"left\"` and `\"right\"`.\r\n\t */\r\n\tconstructor( editor, options = {} ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The order of insertion relative to the column in which the caret is located.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} module:table/commands/insertcolumncommand~InsertColumnCommand#order\r\n\t\t */\r\n\t\tthis.order = options.order || 'right';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst selection = this.editor.model.document.selection;\r\n\r\n\t\tconst tableParent = findAncestor( 'table', selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = !!tableParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * Depending on the command's {@link #order} value, it inserts a column to the `'left'` or `'right'` of the column\r\n\t * in which the selection is set.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst selection = editor.model.document.selection;\r\n\t\tconst tableUtils = editor.plugins.get( TableUtils );\r\n\r\n\t\tconst firstPosition = selection.getFirstPosition();\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', firstPosition );\r\n\t\tconst table = tableCell.parent.parent;\r\n\r\n\t\tconst { column } = tableUtils.getCellLocation( tableCell );\r\n\t\tconst insertAt = this.order === 'right' ? column + 1 : column;\r\n\r\n\t\ttableUtils.insertColumns( table, { columns: 1, at: insertAt } );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/splitcellcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport TableUtils from '../tableutils';\r\nimport { findAncestor } from './utils';\r\n\r\n/**\r\n * The split cell command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'splitTableCellVertically'`\r\n * and `'splitTableCellHorizontally'`  editor commands.\r\n *\r\n * You can split any cell vertically or horizontally by executing this command. For example, to split the selected table cell vertically:\r\n *\r\n *\t\teditor.execute( 'splitTableCellVertically' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class SplitCellCommand extends Command {\r\n\t/**\r\n\t * Creates a new `SplitCellCommand` instance.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor on which this command will be used.\r\n\t * @param {Object} options\r\n\t * @param {String} options.direction Indicates whether the command should split cells `'horizontally'` or `'vertically'`.\r\n\t */\r\n\tconstructor( editor, options = {} ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The direction that indicates which cell will be split.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} #direction\r\n\t\t */\r\n\t\tthis.direction = options.direction || 'horizontally';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', doc.selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = !!tableCell;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst document = model.document;\r\n\t\tconst selection = document.selection;\r\n\r\n\t\tconst firstPosition = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', firstPosition );\r\n\r\n\t\tconst isHorizontally = this.direction === 'horizontally';\r\n\r\n\t\tconst tableUtils = this.editor.plugins.get( TableUtils );\r\n\r\n\t\tif ( isHorizontally ) {\r\n\t\t\ttableUtils.splitCellHorizontally( tableCell, 2 );\r\n\t\t} else {\r\n\t\t\ttableUtils.splitCellVertically( tableCell, 2 );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/mergecellcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\nimport TableWalker from '../tablewalker';\r\nimport { findAncestor, updateNumericAttribute } from './utils';\r\nimport TableUtils from '../tableutils';\r\n\r\n/**\r\n * The merge cell command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'mergeTableCellRight'`, `'mergeTableCellLeft'`,\r\n * `'mergeTableCellUp'` and `'mergeTableCellDown'` editor commands.\r\n *\r\n * To merge a table cell at the current selection with another cell, execute the command corresponding with the preferred direction.\r\n *\r\n * For example, to merge with a cell to the right:\r\n *\r\n *\t\teditor.execute( 'mergeTableCellRight' );\r\n *\r\n * **Note**: If a table cell has a different [`rowspan`](https://www.w3.org/TR/html50/tabular-data.html#attr-tdth-rowspan)\r\n * (for `'mergeTableCellRight'` and `'mergeTableCellLeft'`) or [`colspan`](https://www.w3.org/TR/html50/tabular-data.html#attr-tdth-colspan)\r\n * (for `'mergeTableCellUp'` and `'mergeTableCellDown'`), the command will be disabled.\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class MergeCellCommand extends Command {\r\n\t/**\r\n\t * Creates a new `MergeCellCommand` instance.\r\n\t *\r\n\t * @param {module:core/editor/editor~Editor} editor The editor on which this command will be used.\r\n\t * @param {Object} options\r\n\t * @param {String} options.direction Indicates which cell to merge with the currently selected one.\r\n\t * Possible values are: `'left'`, `'right'`, `'up'` and `'down'`.\r\n\t */\r\n\tconstructor( editor, options ) {\r\n\t\tsuper( editor );\r\n\r\n\t\t/**\r\n\t\t * The direction that indicates which cell will be merged with the currently selected one.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {String} #direction\r\n\t\t */\r\n\t\tthis.direction = options.direction;\r\n\r\n\t\t/**\r\n\t\t * Whether the merge is horizontal (left/right) or vertical (up/down).\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #isHorizontal\r\n\t\t */\r\n\t\tthis.isHorizontal = this.direction == 'right' || this.direction == 'left';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst cellToMerge = this._getMergeableCell();\r\n\r\n\t\tthis.isEnabled = !!cellToMerge;\r\n\t\t// In order to check if currently selected cell can be merged with one defined by #direction some computation are done beforehand.\r\n\t\t// As such we can cache it as a command's value.\r\n\t\tthis.value = cellToMerge;\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * Depending on the command's {@link #direction} value, it will merge the cell that is to the `'left'`, `'right'`, `'up'` or `'down'`.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst tableCell = findAncestor( 'tableCell', doc.selection.getFirstPosition() );\r\n\t\tconst cellToMerge = this.value;\r\n\t\tconst direction = this.direction;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tconst isMergeNext = direction == 'right' || direction == 'down';\r\n\r\n\t\t\t// The merge mechanism is always the same so sort cells to be merged.\r\n\t\t\tconst cellToExpand = isMergeNext ? tableCell : cellToMerge;\r\n\t\t\tconst cellToRemove = isMergeNext ? cellToMerge : tableCell;\r\n\r\n\t\t\t// Cache the parent of cell to remove for later check.\r\n\t\t\tconst removedTableCellRow = cellToRemove.parent;\r\n\r\n\t\t\tmergeTableCells( cellToRemove, cellToExpand, writer );\r\n\r\n\t\t\tconst spanAttribute = this.isHorizontal ? 'colspan' : 'rowspan';\r\n\t\t\tconst cellSpan = parseInt( tableCell.getAttribute( spanAttribute ) || 1 );\r\n\t\t\tconst cellToMergeSpan = parseInt( cellToMerge.getAttribute( spanAttribute ) || 1 );\r\n\r\n\t\t\t// Update table cell span attribute and merge set selection on merged contents.\r\n\t\t\twriter.setAttribute( spanAttribute, cellSpan + cellToMergeSpan, cellToExpand );\r\n\t\t\twriter.setSelection( writer.createRangeIn( cellToExpand ) );\r\n\r\n\t\t\t// Remove empty row after merging.\r\n\t\t\tif ( !removedTableCellRow.childCount ) {\r\n\t\t\t\tremoveEmptyRow( removedTableCellRow, writer );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a cell that can be merged with the current cell depending on the command's direction.\r\n\t *\r\n\t * @returns {module:engine/model/element|undefined}\r\n\t * @private\r\n\t */\r\n\t_getMergeableCell() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst tableCell = findAncestor( 'tableCell', doc.selection.getFirstPosition() );\r\n\r\n\t\tif ( !tableCell ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst tableUtils = this.editor.plugins.get( TableUtils );\r\n\r\n\t\t// First get the cell on proper direction.\r\n\t\tconst cellToMerge = this.isHorizontal ?\r\n\t\t\tgetHorizontalCell( tableCell, this.direction, tableUtils ) :\r\n\t\t\tgetVerticalCell( tableCell, this.direction );\r\n\r\n\t\tif ( !cellToMerge ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If found check if the span perpendicular to merge direction is equal on both cells.\r\n\t\tconst spanAttribute = this.isHorizontal ? 'rowspan' : 'colspan';\r\n\t\tconst span = parseInt( tableCell.getAttribute( spanAttribute ) || 1 );\r\n\r\n\t\tconst cellToMergeSpan = parseInt( cellToMerge.getAttribute( spanAttribute ) || 1 );\r\n\r\n\t\tif ( cellToMergeSpan === span ) {\r\n\t\t\treturn cellToMerge;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Returns the cell that can be merged horizontally.\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @param {String} direction\r\n// @returns {module:engine/model/node~Node|null}\r\nfunction getHorizontalCell( tableCell, direction, tableUtils ) {\r\n\tconst horizontalCell = direction == 'right' ? tableCell.nextSibling : tableCell.previousSibling;\r\n\r\n\tif ( !horizontalCell ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Sort cells:\r\n\tconst cellOnLeft = direction == 'right' ? tableCell : horizontalCell;\r\n\tconst cellOnRight = direction == 'right' ? horizontalCell : tableCell;\r\n\r\n\t// Get their column indexes:\r\n\tconst { column: leftCellColumn } = tableUtils.getCellLocation( cellOnLeft );\r\n\tconst { column: rightCellColumn } = tableUtils.getCellLocation( cellOnRight );\r\n\r\n\tconst leftCellSpan = parseInt( cellOnLeft.getAttribute( 'colspan' ) || 1 );\r\n\r\n\t// The cell on the right must have index that is distant to the cell on the left by the left cell's width (colspan).\r\n\tconst cellsAreTouching = leftCellColumn + leftCellSpan === rightCellColumn;\r\n\r\n\t// If the right cell's column index is different it means that there are rowspanned cells between them.\r\n\treturn cellsAreTouching ? horizontalCell : undefined;\r\n}\r\n\r\n// Returns the cell that can be merged vertically.\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @param {String} direction\r\n// @returns {module:engine/model/node~Node|null}\r\nfunction getVerticalCell( tableCell, direction ) {\r\n\tconst tableRow = tableCell.parent;\r\n\tconst table = tableRow.parent;\r\n\r\n\tconst rowIndex = table.getChildIndex( tableRow );\r\n\r\n\t// Don't search for mergeable cell if direction points out of the table.\r\n\tif ( ( direction == 'down' && rowIndex === table.childCount - 1 ) || ( direction == 'up' && rowIndex === 0 ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst rowspan = parseInt( tableCell.getAttribute( 'rowspan' ) || 1 );\r\n\tconst headingRows = table.getAttribute( 'headingRows' ) || 0;\r\n\r\n\tconst isMergeWithBodyCell = direction == 'down' && ( rowIndex + rowspan ) === headingRows;\r\n\tconst isMergeWithHeadCell = direction == 'up' && rowIndex === headingRows;\r\n\r\n\t// Don't search for mergeable cell if direction points out of the current table section.\r\n\tif ( headingRows && ( isMergeWithBodyCell || isMergeWithHeadCell ) ) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst currentCellRowSpan = parseInt( tableCell.getAttribute( 'rowspan' ) || 1 );\r\n\tconst rowOfCellToMerge = direction == 'down' ? rowIndex + currentCellRowSpan : rowIndex;\r\n\r\n\tconst tableMap = [ ...new TableWalker( table, { endRow: rowOfCellToMerge } ) ];\r\n\r\n\tconst currentCellData = tableMap.find( value => value.cell === tableCell );\r\n\tconst mergeColumn = currentCellData.column;\r\n\r\n\tconst cellToMergeData = tableMap.find( ( { row, rowspan, column } ) => {\r\n\t\tif ( column !== mergeColumn ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( direction == 'down' ) {\r\n\t\t\t// If merging a cell below the mergeRow is already calculated.\r\n\t\t\treturn row === rowOfCellToMerge;\r\n\t\t} else {\r\n\t\t\t// If merging a cell above calculate if it spans to mergeRow.\r\n\t\t\treturn rowOfCellToMerge === row + rowspan;\r\n\t\t}\r\n\t} );\r\n\r\n\treturn cellToMergeData && cellToMergeData.cell;\r\n}\r\n\r\n// Properly removes empty row from a table. Will update `rowspan` attribute of cells that overlaps removed row.\r\n//\r\n// @param {module:engine/model/element~Element} removedTableCellRow\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction removeEmptyRow( removedTableCellRow, writer ) {\r\n\tconst table = removedTableCellRow.parent;\r\n\r\n\tconst removedRowIndex = table.getChildIndex( removedTableCellRow );\r\n\r\n\tfor ( const { cell, row, rowspan } of new TableWalker( table, { endRow: removedRowIndex } ) ) {\r\n\t\tconst overlapsRemovedRow = row + rowspan - 1 >= removedRowIndex;\r\n\r\n\t\tif ( overlapsRemovedRow ) {\r\n\t\t\tupdateNumericAttribute( 'rowspan', rowspan - 1, cell, writer );\r\n\t\t}\r\n\t}\r\n\r\n\twriter.remove( removedTableCellRow );\r\n}\r\n\r\n// Merges two table cells - will ensure that after merging cells with empty paragraph the result table cell will only have one paragraph.\r\n// If one of the merged table cell is empty the merged table cell will have contents of the non-empty table cell.\r\n// If both are empty the merged table cell will have only one empty paragraph.\r\n//\r\n// @param {module:engine/model/element~Element} cellToRemove\r\n// @param {module:engine/model/element~Element} cellToExpand\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction mergeTableCells( cellToRemove, cellToExpand, writer ) {\r\n\tif ( !isEmpty( cellToRemove ) ) {\r\n\t\tif ( isEmpty( cellToExpand ) ) {\r\n\t\t\twriter.remove( writer.createRangeIn( cellToExpand ) );\r\n\t\t}\r\n\r\n\t\twriter.move( writer.createRangeIn( cellToRemove ), writer.createPositionAt( cellToExpand, 'end' ) );\r\n\t}\r\n\r\n\t// Remove merged table cell.\r\n\twriter.remove( cellToRemove );\r\n}\r\n\r\n// Checks if passed table cell contains empty paragraph.\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @returns {Boolean}\r\nfunction isEmpty( tableCell ) {\r\n\treturn tableCell.childCount == 1 && tableCell.getChild( 0 ).is( 'paragraph' ) && tableCell.getChild( 0 ).isEmpty;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/removerowcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\nimport TableWalker from '../tablewalker';\r\nimport { findAncestor, updateNumericAttribute } from './utils';\r\n\r\n/**\r\n * The remove row command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'removeTableRow'` editor command.\r\n *\r\n * To remove the row containing the selected cell, execute the command:\r\n *\r\n *\t\teditor.execute( 'removeTableRow' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class RemoveRowCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', doc.selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = !!tableCell && tableCell.parent.parent.childCount > 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\r\n\t\tconst firstPosition = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', firstPosition );\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst currentRow = table.getChildIndex( tableRow );\r\n\t\tconst headingRows = table.getAttribute( 'headingRows' ) || 0;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tif ( headingRows && currentRow <= headingRows ) {\r\n\t\t\t\tupdateNumericAttribute( 'headingRows', headingRows - 1, table, writer, 0 );\r\n\t\t\t}\r\n\r\n\t\t\tconst tableMap = [ ...new TableWalker( table, { endRow: currentRow } ) ];\r\n\r\n\t\t\tconst cellsToMove = new Map();\r\n\r\n\t\t\t// Get cells from removed row that are spanned over multiple rows.\r\n\t\t\ttableMap\r\n\t\t\t\t.filter( ( { row, rowspan } ) => row === currentRow && rowspan > 1 )\r\n\t\t\t\t.forEach( ( { column, cell, rowspan } ) => cellsToMove.set( column, { cell, rowspanToSet: rowspan - 1 } ) );\r\n\r\n\t\t\t// Reduce rowspan on cells that are above removed row and overlaps removed row.\r\n\t\t\ttableMap\r\n\t\t\t\t.filter( ( { row, rowspan } ) => row <= currentRow - 1 && row + rowspan > currentRow )\r\n\t\t\t\t.forEach( ( { cell, rowspan } ) => updateNumericAttribute( 'rowspan', rowspan - 1, cell, writer ) );\r\n\r\n\t\t\t// Move cells to another row.\r\n\t\t\tconst targetRow = currentRow + 1;\r\n\t\t\tconst tableWalker = new TableWalker( table, { includeSpanned: true, startRow: targetRow, endRow: targetRow } );\r\n\r\n\t\t\tlet previousCell;\r\n\r\n\t\t\tfor ( const { row, column, cell } of [ ...tableWalker ] ) {\r\n\t\t\t\tif ( cellsToMove.has( column ) ) {\r\n\t\t\t\t\tconst { cell: cellToMove, rowspanToSet } = cellsToMove.get( column );\r\n\t\t\t\t\tconst targetPosition = previousCell ?\r\n\t\t\t\t\t\twriter.createPositionAfter( previousCell ) :\r\n\t\t\t\t\t\twriter.createPositionAt( table.getChild( row ), 0 );\r\n\r\n\t\t\t\t\twriter.move( writer.createRangeOn( cellToMove ), targetPosition );\r\n\t\t\t\t\tupdateNumericAttribute( 'rowspan', rowspanToSet, cellToMove, writer );\r\n\r\n\t\t\t\t\tpreviousCell = cellToMove;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpreviousCell = cell;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twriter.remove( tableRow );\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/removecolumncommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\nimport TableWalker from '../tablewalker';\r\nimport TableUtils from '../tableutils';\r\nimport { findAncestor, updateNumericAttribute } from './utils';\r\n\r\n/**\r\n * The remove column command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'removeTableColumn'` editor command.\r\n *\r\n * To remove the column containing the selected cell, execute the command:\r\n *\r\n *\t\teditor.execute( 'removeTableColumn' );\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class RemoveColumnCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst selection = editor.model.document.selection;\r\n\t\tconst tableUtils = editor.plugins.get( TableUtils );\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', selection.getFirstPosition() );\r\n\r\n\t\tthis.isEnabled = !!tableCell && tableUtils.getColumns( tableCell.parent.parent ) > 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst selection = model.document.selection;\r\n\r\n\t\tconst firstPosition = selection.getFirstPosition();\r\n\r\n\t\tconst tableCell = findAncestor( 'tableCell', firstPosition );\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst headingColumns = table.getAttribute( 'headingColumns' ) || 0;\r\n\t\tconst row = table.getChildIndex( tableRow );\r\n\r\n\t\t// Cache the table before removing or updating colspans.\r\n\t\tconst tableMap = [ ...new TableWalker( table ) ];\r\n\r\n\t\t// Get column index of removed column.\r\n\t\tconst cellData = tableMap.find( value => value.cell === tableCell );\r\n\t\tconst removedColumn = cellData.column;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\t// Update heading columns attribute if removing a row from head section.\r\n\t\t\tif ( headingColumns && row <= headingColumns ) {\r\n\t\t\t\twriter.setAttribute( 'headingColumns', headingColumns - 1, table );\r\n\t\t\t}\r\n\r\n\t\t\tfor ( const { cell, column, colspan } of tableMap ) {\r\n\t\t\t\t// If colspaned cell overlaps removed column decrease it's span.\r\n\t\t\t\tif ( column <= removedColumn && colspan > 1 && column + colspan > removedColumn ) {\r\n\t\t\t\t\tupdateNumericAttribute( 'colspan', colspan - 1, cell, writer );\r\n\t\t\t\t} else if ( column === removedColumn ) {\r\n\t\t\t\t\t// The cell in removed column has colspan of 1.\r\n\t\t\t\t\twriter.remove( cell );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/setheaderrowcommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\nimport { createEmptyTableCell, findAncestor, updateNumericAttribute } from './utils';\r\nimport TableWalker from '../tablewalker';\r\n\r\n/**\r\n * The header row command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'setTableColumnHeader'` editor command.\r\n *\r\n * You can make the row containing the selected cell a [header](https://www.w3.org/TR/html50/tabular-data.html#the-th-element) by executing:\r\n *\r\n *\t\teditor.execute( 'setTableRowHeader' );\r\n *\r\n * **Note:** All preceding rows will also become headers. If the current row is already a header, executing this command\r\n * will make it a regular row back again (including the following rows).\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class SetHeaderRowCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\r\n\t\tconst position = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', position );\r\n\t\tconst isInTable = !!tableCell;\r\n\r\n\t\tthis.isEnabled = isInTable;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether the command is active. The command is active when the\r\n\t\t * {@link module:engine/model/selection~Selection} is in a header row.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #value\r\n\t\t */\r\n\t\tthis.value = isInTable && this._isInHeading( tableCell, tableCell.parent.parent );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * When the selection is in a non-header row, the command will set the `headingRows` table attribute to cover that row.\r\n\t *\r\n\t * When the selection is already in a header row, it will set `headingRows` so the heading section will end before that row.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\r\n\t\tconst position = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', position );\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst currentHeadingRows = table.getAttribute( 'headingRows' ) || 0;\r\n\t\tconst selectionRow = tableRow.index;\r\n\r\n\t\tconst headingRowsToSet = currentHeadingRows > selectionRow ? selectionRow : selectionRow + 1;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tif ( headingRowsToSet ) {\r\n\t\t\t\t// Changing heading rows requires to check if any of a heading cell is overlapping vertically the table head.\r\n\t\t\t\t// Any table cell that has a rowspan attribute > 1 will not exceed the table head so we need to fix it in rows below.\r\n\t\t\t\tconst cellsToSplit = getOverlappingCells( table, headingRowsToSet, currentHeadingRows );\r\n\r\n\t\t\t\tfor ( const cell of cellsToSplit ) {\r\n\t\t\t\t\tsplitHorizontally( cell, headingRowsToSet, writer );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tupdateNumericAttribute( 'headingRows', headingRowsToSet, table, writer, 0 );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a table cell is in the heading section.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} tableCell\r\n\t * @param {module:engine/model/element~Element} table\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_isInHeading( tableCell, table ) {\r\n\t\tconst headingRows = parseInt( table.getAttribute( 'headingRows' ) || 0 );\r\n\r\n\t\treturn !!headingRows && tableCell.parent.index < headingRows;\r\n\t}\r\n}\r\n\r\n// Returns cells that span beyond the new heading section.\r\n//\r\n// @param {module:engine/model/element~Element} table The table to check.\r\n// @param {Number} headingRowsToSet New heading rows attribute.\r\n// @param {Number} currentHeadingRows Current heading rows attribute.\r\n// @returns {Array.<module:engine/model/element~Element>}\r\nfunction getOverlappingCells( table, headingRowsToSet, currentHeadingRows ) {\r\n\tconst cellsToSplit = [];\r\n\r\n\tconst startAnalysisRow = headingRowsToSet > currentHeadingRows ? currentHeadingRows : 0;\r\n\t// We're analyzing only when headingRowsToSet > 0.\r\n\tconst endAnalysisRow = headingRowsToSet - 1;\r\n\r\n\tconst tableWalker = new TableWalker( table, { startRow: startAnalysisRow, endRow: endAnalysisRow } );\r\n\r\n\tfor ( const { row, rowspan, cell } of tableWalker ) {\r\n\t\tif ( rowspan > 1 && row + rowspan > headingRowsToSet ) {\r\n\t\t\tcellsToSplit.push( cell );\r\n\t\t}\r\n\t}\r\n\r\n\treturn cellsToSplit;\r\n}\r\n\r\n// Splits the table cell horizontally.\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @param {Number} headingRows\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction splitHorizontally( tableCell, headingRows, writer ) {\r\n\tconst tableRow = tableCell.parent;\r\n\tconst table = tableRow.parent;\r\n\tconst rowIndex = tableRow.index;\r\n\r\n\tconst rowspan = parseInt( tableCell.getAttribute( 'rowspan' ) );\r\n\tconst newRowspan = headingRows - rowIndex;\r\n\r\n\tconst attributes = {};\r\n\r\n\tconst spanToSet = rowspan - newRowspan;\r\n\r\n\tif ( spanToSet > 1 ) {\r\n\t\tattributes.rowspan = spanToSet;\r\n\t}\r\n\r\n\tconst startRow = table.getChildIndex( tableRow );\r\n\tconst endRow = startRow + newRowspan;\r\n\tconst tableMap = [ ...new TableWalker( table, { startRow, endRow, includeSpanned: true } ) ];\r\n\r\n\tlet columnIndex;\r\n\r\n\tfor ( const { row, column, cell, colspan, cellIndex } of tableMap ) {\r\n\t\tif ( cell === tableCell ) {\r\n\t\t\tcolumnIndex = column;\r\n\r\n\t\t\tif ( colspan > 1 ) {\r\n\t\t\t\tattributes.colspan = colspan;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( columnIndex !== undefined && columnIndex === column && row === endRow ) {\r\n\t\t\tconst tableRow = table.getChild( row );\r\n\t\t\tconst tableCellPosition = writer.createPositionAt( tableRow, cellIndex );\r\n\r\n\t\t\tcreateEmptyTableCell( writer, tableCellPosition, attributes );\r\n\t\t}\r\n\t}\r\n\r\n\t// Update the rowspan attribute after updating table.\r\n\tupdateNumericAttribute( 'rowspan', newRowspan, tableCell, writer );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/commands/setheadercolumncommand\r\n */\r\n\r\nimport Command from '@ckeditor/ckeditor5-core/src/command';\r\n\r\nimport { findAncestor, updateNumericAttribute } from './utils';\r\n\r\n/**\r\n * The header column command.\r\n *\r\n * The command is registered by {@link module:table/tableediting~TableEditing} as `'setTableColumnHeader'` editor command.\r\n *\r\n * You can make the column containing the selected cell a [header](https://www.w3.org/TR/html50/tabular-data.html#the-th-element)\r\n * by executing:\r\n *\r\n *\t\teditor.execute( 'setTableColumnHeader' );\r\n *\r\n * **Note:** All preceding columns will also become headers. If the current column is already a header, executing this command\r\n * will make it a regular column back again (including the following columns).\r\n *\r\n * @extends module:core/command~Command\r\n */\r\nexport default class SetHeaderColumnCommand extends Command {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\trefresh() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\r\n\t\tconst position = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', position );\r\n\r\n\t\tconst isInTable = !!tableCell;\r\n\r\n\t\tthis.isEnabled = isInTable;\r\n\r\n\t\t/**\r\n\t\t * Flag indicating whether the command is active. The command is active when the\r\n\t\t * {@link module:engine/model/selection~Selection} is in a header column.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @readonly\r\n\t\t * @member {Boolean} #value\r\n\t\t */\r\n\t\tthis.value = isInTable && this._isInHeading( tableCell, tableCell.parent.parent );\r\n\t}\r\n\r\n\t/**\r\n\t * Executes the command.\r\n\t *\r\n\t * When the selection is in a non-header column, the command will set the `headingColumns` table attribute to cover that column.\r\n\t *\r\n\t * When the selection is already in a header column, it will set `headingColumns` so the heading section will end before that column.\r\n\t *\r\n\t * @fires execute\r\n\t */\r\n\texecute() {\r\n\t\tconst model = this.editor.model;\r\n\t\tconst doc = model.document;\r\n\t\tconst selection = doc.selection;\r\n\t\tconst tableUtils = this.editor.plugins.get( 'TableUtils' );\r\n\r\n\t\tconst position = selection.getFirstPosition();\r\n\t\tconst tableCell = findAncestor( 'tableCell', position.parent );\r\n\t\tconst tableRow = tableCell.parent;\r\n\t\tconst table = tableRow.parent;\r\n\r\n\t\tconst currentHeadingColumns = parseInt( table.getAttribute( 'headingColumns' ) || 0 );\r\n\t\tconst { column: selectionColumn } = tableUtils.getCellLocation( tableCell );\r\n\r\n\t\tconst headingColumnsToSet = currentHeadingColumns > selectionColumn ? selectionColumn : selectionColumn + 1;\r\n\r\n\t\tmodel.change( writer => {\r\n\t\t\tupdateNumericAttribute( 'headingColumns', headingColumnsToSet, table, writer, 0 );\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if a table cell is in the heading section.\r\n\t *\r\n\t * @param {module:engine/model/element~Element} tableCell\r\n\t * @param {module:engine/model/element~Element} table\r\n\t * @returns {Boolean}\r\n\t * @private\r\n\t */\r\n\t_isInHeading( tableCell, table ) {\r\n\t\tconst headingColumns = parseInt( table.getAttribute( 'headingColumns' ) || 0 );\r\n\r\n\t\tconst tableUtils = this.editor.plugins.get( 'TableUtils' );\r\n\r\n\t\tconst { column } = tableUtils.getCellLocation( tableCell );\r\n\r\n\t\treturn !!headingColumns && column < headingColumns;\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/converters/table-layout-post-fixer\r\n */\r\n\r\nimport { createEmptyTableCell, findAncestor, updateNumericAttribute } from './../commands/utils';\r\nimport TableWalker from './../tablewalker';\r\n\r\n/**\r\n * Injects a table layout post-fixer into the model.\r\n *\r\n * The role of the table layout post-fixer is to ensure that the table rows have the correct structure\r\n * after a {@link module:engine/model/model~Model#change `change()`} block was executed.\r\n *\r\n * The correct structure means that:\r\n *\r\n * * All table rows have the same size.\r\n * * None of a table cells that extend vertically beyond their section (either header or body).\r\n * * A table cell has always at least one element as child.\r\n *\r\n * If the table structure is not correct, the post-fixer will automatically correct it in two steps:\r\n *\r\n * 1. It will clip table cells that extends beyond it section.\r\n * 2. It will add empty table cells to those rows which are narrower then the widest table row.\r\n *\r\n * ## Clipping overlapping table cells\r\n *\r\n * Such situation may occur when pasting a table (or part of a table) to the editor from external sources.\r\n *\r\n * For example, see the following table which has the cell (FOO) with the rowspan attribute (2):\r\n *\r\n *\t\t<table headingRows=\"1\">\r\n *\t\t\t<tableRow>\r\n *\t\t\t\t<tableCell rowspan=\"2\"><paragraph>FOO</paragraph></tableCell>\r\n *\t\t\t\t<tableCell colspan=\"2\"><paragraph>BAR</paragraph></tableCell>\r\n *\t\t\t</tableRow>\r\n *\t\t\t<tableRow>\r\n *\t\t\t\t<tableCell><paragraph>BAZ</paragraph></tableCell>\r\n *\t\t\t\t<tableCell><paragraph>XYZ</paragraph></tableCell>\r\n *\t\t\t</tableRow>\r\n *\t\t</table>\r\n *\r\n * will be rendered in the view as:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<thead>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td rowspan=\"2\">FOO</td>\r\n *\t\t\t\t\t<td colspan=\"2\">BAR</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</thead>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>BAZ</td>\r\n *\t\t\t\t\t<td>XYZ</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * In the above example the table will be rendered as a table with two rows - one in the header and second one in the body.\r\n * The table cell (FOO) cannot span over multiple rows as it would expand from the header to the body section.\r\n * The `rowspan` attribute must be changed to (1). The value (1) is a default value of the `rowspan` attribute\r\n * so the `rowspan` attribute will be removed from the model.\r\n *\r\n * The table cell with BAZ contents will be in the first column of the table.\r\n *\r\n * ## Adding missing table cells\r\n *\r\n * The table post-fixer will insert empty table cells to equalize table rows sizes (number of columns).\r\n * The size of a table row is calculated by counting column spans of table cells - both horizontal (from the same row) and\r\n * vertical (from rows above).\r\n *\r\n * In the above example, the table row in the body section of the table is narrower then the row from the header - it has two cells\r\n * with the default colspan (1). The header row has one cell with colspan (1) and second with colspan (2).\r\n * The table cell (FOO) does not expand beyond the head section (and as such will be fixed in the first step of this post-fixer).\r\n * The post-fixer will add a missing table cell to the row in the body section of the table.\r\n *\r\n * The table from the above example will be fixed and rendered to the view as below:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<thead>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td rowspan=\"2\">FOO</td>\r\n *\t\t\t\t\t<td colspan=\"2\">BAR</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</thead>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>BAZ</td>\r\n *\t\t\t\t\t<td>XYZ</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * ## Collaboration & Undo - Expectations vs post-fixer results\r\n *\r\n * The table post-fixer only ensures proper structure without deeper analysis of the nature of a change. As such, it might lead\r\n * to a structure which was not intended by the user changes. In particular, it will also fix undo steps (in conjunction with collaboration)\r\n * in which editor content might not return to the original state.\r\n *\r\n * This will usually happen when one or more users changes size of the table.\r\n *\r\n * As en example see a table below:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>11</td>\r\n *\t\t\t\t\t<td>12</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>21</td>\r\n *\t\t\t\t\t<td>22</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * and user actions:\r\n *\r\n * 1. Both user have table with two rows and two columns.\r\n * 2. User A adds a column at the end of the table - this will insert empty table cells to two rows.\r\n * 3. User B adds a row at the end of the table- this will insert a row with two empty table cells.\r\n * 4. Both users will have a table as below:\r\n *\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>11</td>\r\n *\t\t\t\t\t<td>12</td>\r\n *\t\t\t\t\t<td>(empty, inserted by A)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>21</td>\r\n *\t\t\t\t\t<td>22</td>\r\n *\t\t\t\t\t<td>(empty, inserted by A)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * The last row is shorter then others so table post-fixer will add empty row to tha last row:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>11</td>\r\n *\t\t\t\t\t<td>12</td>\r\n *\t\t\t\t\t<td>(empty, inserted by A)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>21</td>\r\n *\t\t\t\t\t<td>22</td>\r\n *\t\t\t\t\t<td>(empty, inserted by A)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by a post-fixer)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * Unfortunately undo doesn't know the nature of changes and depending which user will apply post-fixer changes undoing them might lead to\r\n * broken table. If User B will undo inserting column to a table the undo engine will undo only operations of\r\n * inserting empty cells to rows from initial table state (row 1 & 2) but the cell in post-fixed row will remain:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>11</td>\r\n *\t\t\t\t\t<td>12</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>21</td>\r\n *\t\t\t\t\t<td>22</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by a post-fixer)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n *\r\n * After undo the table post-fixer will detect that two rows are shorter then other and will fix table to:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tbody>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>11</td>\r\n *\t\t\t\t\t<td>12</td>\r\n *\t\t\t\t\t<td>(empty, inserted by a post-fixer after undo)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>21</td>\r\n *\t\t\t\t\t<td>22</td>\r\n *\t\t\t\t\t<td>(empty, inserted by a post-fixer after undo)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t\t<tr>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by B)</td>\r\n *\t\t\t\t\t<td>(empty, inserted by a post-fixer)</td>\r\n *\t\t\t\t</tr>\r\n *\t\t\t</tbody>\r\n *\t\t</table>\r\n * @param {module:engine/model/model~Model} model\r\n */\r\nexport default function injectTableLayoutPostFixer( model ) {\r\n\tmodel.document.registerPostFixer( writer => tableLayoutPostFixer( writer, model ) );\r\n}\r\n\r\n// The table layout post-fixer.\r\n//\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/model~Model} model\r\nfunction tableLayoutPostFixer( writer, model ) {\r\n\tconst changes = model.document.differ.getChanges();\r\n\r\n\tlet wasFixed = false;\r\n\r\n\t// Do not analyze the same table more then once - may happen for multiple changes in the same table.\r\n\tconst analyzedTables = new Set();\r\n\r\n\tfor ( const entry of changes ) {\r\n\t\tlet table;\r\n\r\n\t\tif ( entry.name == 'table' && entry.type == 'insert' ) {\r\n\t\t\ttable = entry.position.nodeAfter;\r\n\t\t}\r\n\r\n\t\t// Fix table on adding/removing table cells and rows.\r\n\t\tif ( entry.name == 'tableRow' || entry.name == 'tableCell' ) {\r\n\t\t\ttable = findAncestor( 'table', entry.position );\r\n\t\t}\r\n\r\n\t\t// Fix table on any table's attribute change - including attributes of table cells.\r\n\t\tif ( isTableAttributeEntry( entry ) ) {\r\n\t\t\ttable = findAncestor( 'table', entry.range.start );\r\n\t\t}\r\n\r\n\t\tif ( table && !analyzedTables.has( table ) ) {\r\n\t\t\t// Step 1: correct rowspans of table cells if necessary.\r\n\t\t\t// The wasFixed flag should be true if any of tables in batch was fixed - might be more then one.\r\n\t\t\twasFixed = fixTableCellsRowspan( table, writer ) || wasFixed;\r\n\t\t\t// Step 2: fix table rows sizes.\r\n\t\t\twasFixed = fixTableRowsSizes( table, writer ) || wasFixed;\r\n\r\n\t\t\tanalyzedTables.add( table );\r\n\t\t}\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Fixes the invalid value of the rowspan attribute because a table cell cannot vertically extend beyond the table section it belongs to.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @returns {Boolean} Returns true if table was fixed.\r\nfunction fixTableCellsRowspan( table, writer ) {\r\n\tlet wasFixed = false;\r\n\r\n\tconst cellsToTrim = findCellsToTrim( table );\r\n\r\n\tif ( cellsToTrim.length ) {\r\n\t\twasFixed = true;\r\n\r\n\t\tfor ( const data of cellsToTrim ) {\r\n\t\t\tupdateNumericAttribute( 'rowspan', data.rowspan, data.cell, writer, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Makes all table rows in a table the same size.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @returns {Boolean} Returns true if table was fixed.\r\nfunction fixTableRowsSizes( table, writer ) {\r\n\tlet wasFixed = false;\r\n\r\n\tconst rowsLengths = getRowsLengths( table );\r\n\tconst tableSize = rowsLengths[ 0 ];\r\n\r\n\tconst isValid = Object.values( rowsLengths ).every( length => length === tableSize );\r\n\r\n\tif ( !isValid ) {\r\n\t\tconst maxColumns = Object.values( rowsLengths ).reduce( ( prev, current ) => current > prev ? current : prev, 0 );\r\n\r\n\t\tfor ( const [ rowIndex, size ] of Object.entries( rowsLengths ) ) {\r\n\t\t\tconst columnsToInsert = maxColumns - size;\r\n\r\n\t\t\tif ( columnsToInsert ) {\r\n\t\t\t\tfor ( let i = 0; i < columnsToInsert; i++ ) {\r\n\t\t\t\t\tcreateEmptyTableCell( writer, writer.createPositionAt( table.getChild( rowIndex ), 'end' ) );\r\n\t\t\t\t}\r\n\r\n\t\t\t\twasFixed = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Searches for the table cells that extends beyond the table section to which they belong to. It will return an array of objects\r\n// that holds table cells to be trimmed and correct value of a rowspan attribute to set.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @returns {Array.<{{cell, rowspan}}>}\r\nfunction findCellsToTrim( table ) {\r\n\tconst headingRows = parseInt( table.getAttribute( 'headingRows' ) || 0 );\r\n\tconst maxRows = table.childCount;\r\n\r\n\tconst cellsToTrim = [];\r\n\r\n\tfor ( const { row, rowspan, cell } of new TableWalker( table ) ) {\r\n\t\t// Skip cells that do not expand over its row.\r\n\t\tif ( rowspan < 2 ) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst isInHeader = row < headingRows;\r\n\r\n\t\t// Row limit is either end of header section or whole table as table body is after the header.\r\n\t\tconst rowLimit = isInHeader ? headingRows : maxRows;\r\n\r\n\t\t// If table cell expands over its limit reduce it height to proper value.\r\n\t\tif ( row + rowspan > rowLimit ) {\r\n\t\t\tconst newRowspan = rowLimit - row;\r\n\r\n\t\t\tcellsToTrim.push( { cell, rowspan: newRowspan } );\r\n\t\t}\r\n\t}\r\n\r\n\treturn cellsToTrim;\r\n}\r\n\r\n// Returns an object with lengths of rows assigned to the corresponding row index.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @returns {Object}\r\nfunction getRowsLengths( table ) {\r\n\tconst lengths = {};\r\n\r\n\tfor ( const { row } of new TableWalker( table, { includeSpanned: true } ) ) {\r\n\t\tif ( !lengths[ row ] ) {\r\n\t\t\tlengths[ row ] = 0;\r\n\t\t}\r\n\r\n\t\tlengths[ row ] += 1;\r\n\t}\r\n\r\n\treturn lengths;\r\n}\r\n\r\n// Checks if the differ entry for an attribute change is one of table's attributes.\r\n//\r\n// @param entry\r\n// @returns {Boolean}\r\nfunction isTableAttributeEntry( entry ) {\r\n\tconst isAttributeType = entry.type === 'attribute';\r\n\tconst key = entry.attributeKey;\r\n\r\n\treturn isAttributeType && ( key === 'headingRows' || key === 'colspan' || key === 'rowspan' );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/converters/table-cell-content-post-fixer\r\n */\r\n\r\n/**\r\n * Injects a table cell post-fixer into the model.\r\n *\r\n * The role of the table post-fixer is to ensure that the table cells have the correct content\r\n * after a {@link module:engine/model/model~Model#change `change()`} block was executed.\r\n *\r\n * A table cells must contains at least one block as a child. The empty table cell will have empty `<paragraph>` as a child.\r\n *\r\n *        <table>\r\n *            <tableRow>\r\n *                <tableCell></tableCell>\r\n *            </tableRow>\r\n *        </table>\r\n *\r\n * Will be fixed to:\r\n *\r\n *        <table>\r\n *            <tableRow>\r\n *                <tableCell><paragraph></paragraph></tableCell>\r\n *            </tableRow>\r\n *        </table>\r\n *\r\n * @param {module:engine/model/model~Model} model\r\n */\r\nexport default function injectTableCellContentPostFixer( model ) {\r\n\tmodel.document.registerPostFixer( writer => tableCellContentsPostFixer( writer, model ) );\r\n}\r\n\r\n// The table cell contents post-fixer.\r\n//\r\n// @param {module:engine/model/writer~Writer} writer\r\n// @param {module:engine/model/model~Model} model\r\nfunction tableCellContentsPostFixer( writer, model ) {\r\n\tconst changes = model.document.differ.getChanges();\r\n\r\n\tlet wasFixed = false;\r\n\r\n\tfor ( const entry of changes ) {\r\n\t\t// Enforce paragraph in tableCell even after other feature remove its contents.\r\n\t\tif ( entry.type == 'remove' && entry.position.parent.is( 'tableCell' ) ) {\r\n\t\t\twasFixed = fixTableCellContent( entry.position.parent, writer ) || wasFixed;\r\n\t\t}\r\n\r\n\t\t// Analyze table cells on insertion.\r\n\t\tif ( entry.type == 'insert' ) {\r\n\t\t\tif ( entry.name == 'table' ) {\r\n\t\t\t\twasFixed = fixTable( entry.position.nodeAfter, writer ) || wasFixed;\r\n\t\t\t}\r\n\r\n\t\t\tif ( entry.name == 'tableRow' ) {\r\n\t\t\t\twasFixed = fixTableRow( entry.position.nodeAfter, writer ) || wasFixed;\r\n\t\t\t}\r\n\r\n\t\t\tif ( entry.name == 'tableCell' ) {\r\n\t\t\t\twasFixed = fixTableCellContent( entry.position.nodeAfter, writer ) || wasFixed;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Fixes all table cells in a table.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction fixTable( table, writer ) {\r\n\tlet wasFixed = false;\r\n\r\n\tfor ( const row of table.getChildren() ) {\r\n\t\twasFixed = fixTableRow( row, writer ) || wasFixed;\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Fixes all table cells in a table row.\r\n//\r\n// @param {module:engine/model/element~Element} tableRow\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction fixTableRow( tableRow, writer ) {\r\n\tlet wasFixed = false;\r\n\r\n\tfor ( const tableCell of tableRow.getChildren() ) {\r\n\t\twasFixed = fixTableCellContent( tableCell, writer ) || wasFixed;\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Fixes all table cell content by adding paragraph to a table cell without any child.\r\n//\r\n// @param {module:engine/model/element~Element} table\r\n// @param {module:engine/model/writer~Writer} writer\r\nfunction fixTableCellContent( tableCell, writer ) {\r\n\tif ( tableCell.childCount == 0 ) {\r\n\t\twriter.insertElement( 'paragraph', tableCell );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/converters/tablecell-post-fixer\r\n */\r\n\r\n/**\r\n * Injects a table cell post-fixer into the editing controller.\r\n *\r\n * The role of the table cell post-fixer is to ensure that the table cell contents in the editing view are properly converted.\r\n *\r\n * This post-fixer will ensure that after model changes in the editing view:\r\n * * single paragraphs are rendered as `<span>\r\n * * single paragraphs with one or more attributes are rendered as `<p>`\r\n * * single paragraphs in table cell with other block elements are rendered as `<p>`\r\n * * paragraphs in table cells with other block elements (including other paragraphs) are rendered as `<p>`.\r\n *\r\n * In the model each table cell has always at least one block element inside. If no other block was defined (empty table cell) the table\r\n * feature will insert empty `<paragraph>`. Similarly text nodes will be wrapped in paragraphs. Rendering in the data pipeline differs\r\n * from rendering in the editing pipeline - text nodes in single `<paragraph>` are rendered in the data pipeline as direct children\r\n * of the `<td>` or `<th>` elements. In other cases `<paragraph>` elements are rendered as `<p>` blocks.\r\n *\r\n * To ensure proper mappings between model and view elements and positions in the editing pipeline the table feature will always render\r\n * an element in the view: `<span>` for single or empty `<paragraph>` and `<p>` otherwise.\r\n *\r\n * Example:\r\n *\r\n *\t\t<table>\r\n *\t\t\t<tableRow>\r\n *\t\t\t\t<tableCell><paragraph></paragraph></tableCell>\r\n *\t\t\t\t<tableCell><paragraph>foo</paragraph></tableCell>\r\n *\t\t\t\t<tableCell><paragraph baz=\"bar\">foo</paragraph></tableCell>\r\n *\t\t\t\t<tableCell><heading2>bar</heading2><paragraph>baz</paragraph></tableCell>\r\n *\t\t\t</tableRow>\r\n *\t\t</table>\r\n *\r\n * The editor will render in the data pipeline:\r\n *\r\n *\t\t<figure>\r\n *\t\t\t<table>\r\n *\t\t\t\t<tbody>\r\n *\t\t\t\t\t<tr>\r\n *\t\t\t\t\t\t<td></td>\r\n *\t\t\t\t\t\t<td>foo</td>\r\n *\t\t\t\t\t\t<td><p baz=\"bar\">foo</p></td>\r\n *\t\t\t\t\t\t<td><h3>bar</h3><p>baz</p></td>\r\n *\t\t\t\t\t</tr>\r\n *\t\t\t\t</tbody>\r\n *\t\t\t</table>\r\n *\t\t</figure>\r\n *\r\n * and in the editing view (without widget markup):\r\n *\r\n *\t\t<figure>\r\n *\t\t\t<table>\r\n *\t\t\t\t<tbody>\r\n *\t\t\t\t\t<tr>\r\n *\t\t\t\t\t\t<td><span></span></td>\r\n *\t\t\t\t\t\t<td><span>foo</span></td>\r\n *\t\t\t\t\t\t<td><p baz=\"bar\">foo</p></td>\r\n *\t\t\t\t\t\t<td><h3>bar</h3><p>baz</p></td>\r\n *\t\t\t\t\t</tr>\r\n *\t\t\t\t</tbody>\r\n *\t\t\t</table>\r\n *\t\t</figure>\r\n *\r\n * @param {module:engine/model/model~Model} model\r\n * @param {module:engine/controller/editingcontroller~EditingController} editing\r\n */\r\nexport default function injectTableCellPostFixer( model, editing ) {\r\n\tediting.view.document.registerPostFixer( writer => tableCellPostFixer( writer, model, editing.mapper, editing.view ) );\r\n}\r\n\r\n// The table cell post-fixer.\r\n//\r\n// @param {module:engine/view/writer~Writer} writer\r\n// @param {module:engine/model/model~Model} model\r\n// @param {module:engine/conversion/mapper~Mapper} mapper\r\nfunction tableCellPostFixer( writer, model, mapper, view ) {\r\n\tlet wasFixed = false;\r\n\r\n\tconst elementsToCheck = getElementsToCheck( view );\r\n\r\n\tfor ( const element of elementsToCheck ) {\r\n\t\twasFixed = ensureProperElementName( element, mapper, writer ) || wasFixed;\r\n\t}\r\n\r\n\t// Selection in the view might not be updated to renamed elements. Happens mostly when other feature inserts paragraph to the table cell\r\n\t// (ie. when deleting table cell contents) and sets selection to it while table-post fixer changes view <p> to <span> element.\r\n\t// The view.selection would have outdated nodes.\r\n\tif ( wasFixed ) {\r\n\t\tupdateRangesInViewSelection( model.document.selection, mapper, writer );\r\n\t}\r\n\r\n\treturn wasFixed;\r\n}\r\n\r\n// Returns view elements changed in current view.change() block.\r\n//\r\n// **Note**: Currently it uses private property of the view: _renderer to get changed view elements to check.\r\n//\r\n// @param {module:engine/view/view~View} view\r\nfunction getElementsToCheck( view ) {\r\n\tconst elementsWithChangedAttributes = Array.from( view._renderer.markedAttributes )\r\n\t\t.filter( el => !!el.parent )\r\n\t\t.filter( isSpanOrP )\r\n\t\t.filter( el => isTdOrTh( el.parent ) );\r\n\r\n\tconst changedChildren = Array.from( view._renderer.markedChildren )\r\n\t\t.filter( el => !!el.parent )\r\n\t\t.filter( isTdOrTh )\r\n\t\t.reduce( ( prev, element ) => {\r\n\t\t\tconst childrenToCheck = Array.from( element.getChildren() ).filter( isSpanOrP );\r\n\r\n\t\t\treturn [ ...prev, ...childrenToCheck ];\r\n\t\t}, [] );\r\n\r\n\treturn [ ...elementsWithChangedAttributes, ...changedChildren ];\r\n}\r\n\r\n// This method checks if view element for model's <paragraph> was properly converter.\r\n// Paragraph should be either\r\n// - span: for single paragraph with no attributes.\r\n// - p   : in other cases.\r\nfunction ensureProperElementName( currentViewElement, mapper, writer ) {\r\n\tconst modelParagraph = mapper.toModelElement( currentViewElement );\r\n\tconst expectedViewElementName = getExpectedElementName( modelParagraph.parent, modelParagraph );\r\n\r\n\tif ( currentViewElement.name !== expectedViewElementName ) {\r\n\t\t// Unbind current view element as it should be cleared from mapper.\r\n\t\tmapper.unbindViewElement( currentViewElement );\r\n\r\n\t\tconst renamedViewElement = writer.rename( expectedViewElementName, currentViewElement );\r\n\r\n\t\t// Bind paragraph inside table cell to the renamed view element.\r\n\t\tmapper.bindElements( modelParagraph, renamedViewElement );\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n// Expected view element name depends on model elements:\r\n// - <paragraph> with any attribute set should be rendered as <p>\r\n// - all <paragraphs> in <tableCell> that has more then one children should be rendered as <p>\r\n// - an only <paragraph> child with no attributes should be rendered as <span>\r\n//\r\n// @param {module:engine/model/element~Element} tableCell\r\n// @param {module:engine/model/element~Element} paragraph\r\n// @returns {String}\r\nfunction getExpectedElementName( tableCell, paragraph ) {\r\n\tconst isOnlyChild = tableCell.childCount > 1;\r\n\tconst hasAttributes = !![ ...paragraph.getAttributes() ].length;\r\n\r\n\treturn ( isOnlyChild || hasAttributes ) ? 'p' : 'span';\r\n}\r\n\r\n// Method to filter out <span> and <p> elements.\r\n//\r\n// @param {module:engine/view/element~Element} element\r\nfunction isSpanOrP( element ) {\r\n\treturn element.is( 'p' ) || element.is( 'span' );\r\n}\r\n\r\n// Method to filter out <td> and <th> elements.\r\n//\r\n// @param {module:engine/view/element~Element} element\r\nfunction isTdOrTh( element ) {\r\n\treturn element.is( 'td' ) || element.is( 'th' );\r\n}\r\n\r\n// Resets view selections based on model selection.\r\nfunction updateRangesInViewSelection( selection, mapper, writer ) {\r\n\tconst fixedRanges = Array.from( selection.getRanges() )\r\n\t\t.map( range => mapper.toViewRange( range ) );\r\n\r\n\twriter.setSelection( fixedRanges, { backward: selection.isBackward } );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/tableediting\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport { upcastElementToElement } from '@ckeditor/ckeditor5-engine/src/conversion/upcast-converters';\r\n\r\nimport upcastTable, { upcastTableCell } from './converters/upcasttable';\r\nimport {\r\n\tdowncastInsertCell,\r\n\tdowncastInsertRow,\r\n\tdowncastInsertTable,\r\n\tdowncastRemoveRow,\r\n\tdowncastTableHeadingColumnsChange,\r\n\tdowncastTableHeadingRowsChange\r\n} from './converters/downcast';\r\n\r\nimport InsertTableCommand from './commands/inserttablecommand';\r\nimport InsertRowCommand from './commands/insertrowcommand';\r\nimport InsertColumnCommand from './commands/insertcolumncommand';\r\nimport SplitCellCommand from './commands/splitcellcommand';\r\nimport MergeCellCommand from './commands/mergecellcommand';\r\nimport RemoveRowCommand from './commands/removerowcommand';\r\nimport RemoveColumnCommand from './commands/removecolumncommand';\r\nimport SetHeaderRowCommand from './commands/setheaderrowcommand';\r\nimport SetHeaderColumnCommand from './commands/setheadercolumncommand';\r\nimport { findAncestor } from './commands/utils';\r\nimport TableUtils from '../src/tableutils';\r\n\r\nimport injectTableLayoutPostFixer from './converters/table-layout-post-fixer';\r\nimport injectTableCellContentsPostFixer from './converters/table-cell-content-post-fixer';\r\nimport injectTableCellPostFixer from './converters/tablecell-post-fixer';\r\n\r\nimport '../theme/tableediting.css';\r\n\r\n/**\r\n * The table editing feature.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class TableEditing extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst model = editor.model;\r\n\t\tconst schema = model.schema;\r\n\t\tconst conversion = editor.conversion;\r\n\r\n\t\tschema.register( 'table', {\r\n\t\t\tallowWhere: '$block',\r\n\t\t\tallowAttributes: [ 'headingRows', 'headingColumns' ],\r\n\t\t\tisLimit: true,\r\n\t\t\tisObject: true\r\n\t\t} );\r\n\r\n\t\tschema.register( 'tableRow', {\r\n\t\t\tallowIn: 'table',\r\n\t\t\tisLimit: true\r\n\t\t} );\r\n\r\n\t\tschema.register( 'tableCell', {\r\n\t\t\tallowIn: 'tableRow',\r\n\t\t\tallowAttributes: [ 'colspan', 'rowspan' ],\r\n\t\t\tisLimit: true\r\n\t\t} );\r\n\r\n\t\t// Allow all $block content inside table cell.\r\n\t\tschema.extend( '$block', { allowIn: 'tableCell' } );\r\n\r\n\t\t// Disallow table in table.\r\n\t\tschema.addChildCheck( ( context, childDefinition ) => {\r\n\t\t\tif ( childDefinition.name == 'table' && Array.from( context.getNames() ).includes( 'table' ) ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Disallow image and media in table cell.\r\n\t\tschema.addChildCheck( ( context, childDefinition ) => {\r\n\t\t\tif ( !Array.from( context.getNames() ).includes( 'table' ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( childDefinition.name == 'image' || childDefinition.name == 'media' ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Table conversion.\r\n\t\tconversion.for( 'upcast' ).add( upcastTable() );\r\n\r\n\t\tconversion.for( 'editingDowncast' ).add( downcastInsertTable( { asWidget: true } ) );\r\n\t\tconversion.for( 'dataDowncast' ).add( downcastInsertTable() );\r\n\r\n\t\t// Table row conversion.\r\n\t\tconversion.for( 'upcast' ).add( upcastElementToElement( { model: 'tableRow', view: 'tr' } ) );\r\n\r\n\t\tconversion.for( 'editingDowncast' ).add( downcastInsertRow( { asWidget: true } ) );\r\n\t\tconversion.for( 'dataDowncast' ).add( downcastInsertRow() );\r\n\t\tconversion.for( 'downcast' ).add( downcastRemoveRow() );\r\n\r\n\t\t// Table cell conversion.\r\n\t\tconversion.for( 'upcast' ).add( upcastTableCell( 'td' ) );\r\n\t\tconversion.for( 'upcast' ).add( upcastTableCell( 'th' ) );\r\n\r\n\t\tconversion.for( 'editingDowncast' ).add( downcastInsertCell( { asWidget: true } ) );\r\n\t\tconversion.for( 'dataDowncast' ).add( downcastInsertCell() );\r\n\r\n\t\t// Table attributes conversion.\r\n\t\tconversion.attributeToAttribute( { model: 'colspan', view: 'colspan' } );\r\n\t\tconversion.attributeToAttribute( { model: 'rowspan', view: 'rowspan' } );\r\n\r\n\t\t// Table heading rows and cols conversion.\r\n\t\tconversion.for( 'editingDowncast' ).add( downcastTableHeadingColumnsChange( { asWidget: true } ) );\r\n\t\tconversion.for( 'dataDowncast' ).add( downcastTableHeadingColumnsChange() );\r\n\t\tconversion.for( 'editingDowncast' ).add( downcastTableHeadingRowsChange( { asWidget: true } ) );\r\n\t\tconversion.for( 'dataDowncast' ).add( downcastTableHeadingRowsChange() );\r\n\r\n\t\tinjectTableCellPostFixer( editor.model, editor.editing );\r\n\r\n\t\t// Define all the commands.\r\n\t\teditor.commands.add( 'insertTable', new InsertTableCommand( editor ) );\r\n\t\teditor.commands.add( 'insertTableRowAbove', new InsertRowCommand( editor, { order: 'above' } ) );\r\n\t\teditor.commands.add( 'insertTableRowBelow', new InsertRowCommand( editor, { order: 'below' } ) );\r\n\t\teditor.commands.add( 'insertTableColumnLeft', new InsertColumnCommand( editor, { order: 'left' } ) );\r\n\t\teditor.commands.add( 'insertTableColumnRight', new InsertColumnCommand( editor, { order: 'right' } ) );\r\n\r\n\t\teditor.commands.add( 'removeTableRow', new RemoveRowCommand( editor ) );\r\n\t\teditor.commands.add( 'removeTableColumn', new RemoveColumnCommand( editor ) );\r\n\r\n\t\teditor.commands.add( 'splitTableCellVertically', new SplitCellCommand( editor, { direction: 'vertically' } ) );\r\n\t\teditor.commands.add( 'splitTableCellHorizontally', new SplitCellCommand( editor, { direction: 'horizontally' } ) );\r\n\r\n\t\teditor.commands.add( 'mergeTableCellRight', new MergeCellCommand( editor, { direction: 'right' } ) );\r\n\t\teditor.commands.add( 'mergeTableCellLeft', new MergeCellCommand( editor, { direction: 'left' } ) );\r\n\t\teditor.commands.add( 'mergeTableCellDown', new MergeCellCommand( editor, { direction: 'down' } ) );\r\n\t\teditor.commands.add( 'mergeTableCellUp', new MergeCellCommand( editor, { direction: 'up' } ) );\r\n\r\n\t\teditor.commands.add( 'setTableColumnHeader', new SetHeaderColumnCommand( editor ) );\r\n\t\teditor.commands.add( 'setTableRowHeader', new SetHeaderRowCommand( editor ) );\r\n\r\n\t\tinjectTableLayoutPostFixer( model );\r\n\t\tinjectTableCellContentsPostFixer( model );\r\n\r\n\t\t// Handle tab key navigation.\r\n\t\tthis.editor.keystrokes.set( 'Tab', ( ...args ) => this._handleTabOnSelectedTable( ...args ), { priority: 'low' } );\r\n\t\tthis.editor.keystrokes.set( 'Tab', this._getTabHandler( true ), { priority: 'low' } );\r\n\t\tthis.editor.keystrokes.set( 'Shift+Tab', this._getTabHandler( false ), { priority: 'low' } );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ TableUtils ];\r\n\t}\r\n\r\n\t/**\r\n\t * Handles {@link module:engine/view/document~Document#event:keydown keydown} events for the <kbd>Tab</kbd> key executed\r\n\t * when the table widget is selected.\r\n\t *\r\n\t * @private\r\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\r\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\r\n\t */\r\n\t_handleTabOnSelectedTable( domEventData, cancel ) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst selection = editor.model.document.selection;\r\n\r\n\t\tif ( !selection.isCollapsed && selection.rangeCount === 1 && selection.getFirstRange().isFlat ) {\r\n\t\t\tconst selectedElement = selection.getSelectedElement();\r\n\r\n\t\t\tif ( !selectedElement || !selectedElement.is( 'table' ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcancel();\r\n\r\n\t\t\teditor.model.change( writer => {\r\n\t\t\t\twriter.setSelection( writer.createRangeIn( selectedElement.getChild( 0 ).getChild( 0 ) ) );\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a handler for {@link module:engine/view/document~Document#event:keydown keydown} events for the <kbd>Tab</kbd> key executed\r\n\t * inside table cell.\r\n\t *\r\n\t * @private\r\n\t * @param {Boolean} isForward Whether this handler will move selection to the next cell or previous.\r\n\t */\r\n\t_getTabHandler( isForward ) {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\treturn ( domEventData, cancel ) => {\r\n\t\t\tconst selection = editor.model.document.selection;\r\n\r\n\t\t\tconst firstPosition = selection.getFirstPosition();\r\n\r\n\t\t\tconst tableCell = findAncestor( 'tableCell', firstPosition );\r\n\r\n\t\t\tif ( !tableCell ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcancel();\r\n\r\n\t\t\tconst tableRow = tableCell.parent;\r\n\t\t\tconst table = tableRow.parent;\r\n\r\n\t\t\tconst currentRowIndex = table.getChildIndex( tableRow );\r\n\t\t\tconst currentCellIndex = tableRow.getChildIndex( tableCell );\r\n\r\n\t\t\tconst isFirstCellInRow = currentCellIndex === 0;\r\n\r\n\t\t\tif ( !isForward && isFirstCellInRow && currentRowIndex === 0 ) {\r\n\t\t\t\t// It's the first cell of a table - don't do anything (stay in current position).\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst isLastCellInRow = currentCellIndex === tableRow.childCount - 1;\r\n\t\t\tconst isLastRow = currentRowIndex === table.childCount - 1;\r\n\r\n\t\t\tif ( isForward && isLastRow && isLastCellInRow ) {\r\n\t\t\t\teditor.plugins.get( TableUtils ).insertRows( table, { at: table.childCount } );\r\n\t\t\t}\r\n\r\n\t\t\tlet cellToFocus;\r\n\r\n\t\t\t// Move to first cell in next row.\r\n\t\t\tif ( isForward && isLastCellInRow ) {\r\n\t\t\t\tconst nextRow = table.getChild( currentRowIndex + 1 );\r\n\r\n\t\t\t\tcellToFocus = nextRow.getChild( 0 );\r\n\t\t\t}\r\n\t\t\t// Move to last cell in a previous row.\r\n\t\t\telse if ( !isForward && isFirstCellInRow ) {\r\n\t\t\t\tconst previousRow = table.getChild( currentRowIndex - 1 );\r\n\r\n\t\t\t\tcellToFocus = previousRow.getChild( previousRow.childCount - 1 );\r\n\t\t\t}\r\n\t\t\t// Move to next/previous cell.\r\n\t\t\telse {\r\n\t\t\t\tcellToFocus = tableRow.getChild( currentCellIndex + ( isForward ? 1 : -1 ) );\r\n\t\t\t}\r\n\r\n\t\t\teditor.model.change( writer => {\r\n\t\t\t\twriter.setSelection( writer.createRangeIn( cellToFocus ) );\r\n\t\t\t} );\r\n\t\t};\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/ui/inserttableview\r\n */\r\n\r\nimport View from '@ckeditor/ckeditor5-ui/src/view';\r\n\r\nimport './../../theme/inserttable.css';\r\n\r\n/**\r\n * The table size view.\r\n *\r\n * It renders a 10x10 grid to choose the inserted table size.\r\n *\r\n * @extends module:ui/view~View\r\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\r\n */\r\nexport default class InsertTableView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * A collection of table size box items.\r\n\t\t *\r\n\t\t * @readonly\r\n\t\t * @member {module:ui/viewcollection~ViewCollection}\r\n\t\t */\r\n\t\tthis.items = this.createCollection();\r\n\r\n\t\t/**\r\n\t\t * The currently selected number of rows of the new table.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Number} #rows\r\n\t\t */\r\n\t\tthis.set( 'rows', 0 );\r\n\r\n\t\t/**\r\n\t\t * The currently selected number of columns of the new table.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Number} #columns\r\n\t\t */\r\n\t\tthis.set( 'columns', 0 );\r\n\r\n\t\t/**\r\n\t\t * The label text displayed under the boxes.\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {String} #label\r\n\t\t */\r\n\t\tthis.bind( 'label' )\r\n\t\t\t.to( this, 'columns', this, 'rows', ( columns, rows ) => `${ rows } x ${ columns }` );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [ 'ck' ]\r\n\t\t\t},\r\n\r\n\t\t\tchildren: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: [ 'ck-insert-table-dropdown__grid' ]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchildren: this.items\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttag: 'div',\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\tclass: [ 'ck-insert-table-dropdown__label' ]\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttext: bind.to( 'label' )\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\ton: {\r\n\t\t\t\tmousedown: bind.to( evt => {\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t} ),\r\n\r\n\t\t\t\tclick: bind.to( () => {\r\n\t\t\t\t\tthis.fire( 'execute' );\r\n\t\t\t\t} )\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Add grid boxes to table selection view.\r\n\t\tfor ( let index = 0; index < 100; index++ ) {\r\n\t\t\tconst boxView = new TableSizeGridBoxView();\r\n\r\n\t\t\t// Listen to box view 'over' event which indicates that mouse is over this box.\r\n\t\t\tboxView.on( 'over', () => {\r\n\t\t\t\t// Translate box index to the row & column index.\r\n\t\t\t\tconst row = Math.floor( index / 10 );\r\n\t\t\t\tconst column = index % 10;\r\n\r\n\t\t\t\t// As row & column indexes are zero-based transform it to number of selected rows & columns.\r\n\t\t\t\tthis.set( 'rows', row + 1 );\r\n\t\t\t\tthis.set( 'columns', column + 1 );\r\n\t\t\t} );\r\n\r\n\t\t\tthis.items.add( boxView );\r\n\t\t}\r\n\r\n\t\tthis.on( 'change:columns', () => {\r\n\t\t\tthis._highlightGridBoxes();\r\n\t\t} );\r\n\r\n\t\tthis.on( 'change:rows', () => {\r\n\t\t\tthis._highlightGridBoxes();\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tfocus() {\r\n\t\t// The dropdown panel expects DropdownPanelFocusable interface on views passed to dropdown panel. See #30.\r\n\t\t// The method should be implemented while working on keyboard support for this view. See #22.\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tfocusLast() {\r\n\t\t// The dropdown panel expects DropdownPanelFocusable interface on views passed to dropdown panel. See #30.\r\n\t\t// The method should be implemented while working on keyboard support for this view. See #22.\r\n\t}\r\n\r\n\t/**\r\n\t * Highlights grid boxes depending on rows and columns selected.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_highlightGridBoxes() {\r\n\t\tconst rows = this.rows;\r\n\t\tconst columns = this.columns;\r\n\r\n\t\tthis.items.map( ( boxView, index ) => {\r\n\t\t\t// Translate box index to the row & column index.\r\n\t\t\tconst itemRow = Math.floor( index / 10 );\r\n\t\t\tconst itemColumn = index % 10;\r\n\r\n\t\t\t// Grid box is highlighted when its row & column index belongs to selected number of rows & columns.\r\n\t\t\tconst isOn = itemRow < rows && itemColumn < columns;\r\n\r\n\t\t\tboxView.set( 'isOn', isOn );\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n/**\r\n * A single grid box view element.\r\n *\r\n * This class is used to render the table size selection grid in {@link module:table/ui/inserttableview~InsertTableView}.\r\n *\r\n * @private\r\n */\r\nclass TableSizeGridBoxView extends View {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tconstructor( locale ) {\r\n\t\tsuper( locale );\r\n\r\n\t\tconst bind = this.bindTemplate;\r\n\r\n\t\t/**\r\n\t\t * Controls whether the grid box view is \"on\".\r\n\t\t *\r\n\t\t * @observable\r\n\t\t * @member {Boolean} #isOn\r\n\t\t */\r\n\t\tthis.set( 'isOn', false );\r\n\r\n\t\tthis.setTemplate( {\r\n\t\t\ttag: 'div',\r\n\t\t\tattributes: {\r\n\t\t\t\tclass: [\r\n\t\t\t\t\t'ck-insert-table-dropdown-grid-box',\r\n\t\t\t\t\tbind.if( 'isOn', 'ck-on' )\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\ton: {\r\n\t\t\t\tmouseover: bind.to( 'over' )\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\n/**\r\n * @module table/tableui\r\n */\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport {\n    addListToDropdown,\n    createDropdown\n} from '@ckeditor/ckeditor5-ui/src/dropdown/utils';\nimport Model from '@ckeditor/ckeditor5-ui/src/model';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport InsertTableView from './ui/inserttableview';\nimport tableIcon from './../theme/icons/table.svg';\nimport tableColumnIcon from './../theme/icons/table-column.svg';\nimport tableRowIcon from './../theme/icons/table-row.svg';\nimport tableMergeCellIcon from './../theme/icons/table-merge-cell.svg';\n/**\r\n * The table UI plugin. It introduces:\r\n *\r\n * * The `'insertTable'` dropdown,\r\n * * The `'tableColumn'` dropdown,\r\n * * The `'tableRow'` dropdown,\r\n * * The `'mergeTableCells'` dropdown.\r\n *\r\n * The `'tableColumn'`, `'tableRow'`, `'mergeTableCells'` dropdowns work best with {@link module:table/tabletoolbar~TableToolbar}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\nexport default class TableUI extends Plugin {\n    /**\r\n\t * @inheritDoc\r\n\t */\n    init() {\n        const editor = this.editor;\n        const t = this.editor.t;\n        editor.ui.componentFactory.add('insertTable', locale => {\n            const command = editor.commands.get('insertTable');\n            const dropdownView = createDropdown(locale);\n            dropdownView.bind('isEnabled').to(command);\n            // Decorate dropdown's button.\n            dropdownView.buttonView.set({\n                icon: tableIcon,\n                label: t('q'),\n                tooltip: true\n            });\n            // Prepare custom view for dropdown's panel.\n            const insertTableView = new InsertTableView(locale);\n            dropdownView.panelView.children.add(insertTableView);\n            insertTableView.delegate('execute').to(dropdownView);\n            dropdownView.buttonView.on('open', () => {\n                // Reset the chooser before showing it to the user.\n                insertTableView.rows = 0;\n                insertTableView.columns = 0;\n            });\n            dropdownView.on('execute', () => {\n                editor.execute('insertTable', {\n                    rows: insertTableView.rows,\n                    columns: insertTableView.columns\n                });\n                editor.editing.view.focus();\n            });\n            return dropdownView;\n        });\n        editor.ui.componentFactory.add('tableColumn', locale => {\n            const options = [\n                {\n                    type: 'switchbutton',\n                    model: {\n                        commandName: 'setTableColumnHeader',\n                        label: t('r'),\n                        bindIsOn: true\n                    }\n                },\n                { type: 'separator' },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'insertTableColumnLeft',\n                        label: t('s')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'insertTableColumnRight',\n                        label: t('t')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'removeTableColumn',\n                        label: t('u')\n                    }\n                }\n            ];\n            return this._prepareDropdown(t('v'), tableColumnIcon, options, locale);\n        });\n        editor.ui.componentFactory.add('tableRow', locale => {\n            const options = [\n                {\n                    type: 'switchbutton',\n                    model: {\n                        commandName: 'setTableRowHeader',\n                        label: t('w'),\n                        bindIsOn: true\n                    }\n                },\n                { type: 'separator' },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'insertTableRowBelow',\n                        label: t('x')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'insertTableRowAbove',\n                        label: t('y')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'removeTableRow',\n                        label: t('z')\n                    }\n                }\n            ];\n            return this._prepareDropdown(t('aa'), tableRowIcon, options, locale);\n        });\n        editor.ui.componentFactory.add('mergeTableCells', locale => {\n            const options = [\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'mergeTableCellUp',\n                        label: t('ab')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'mergeTableCellRight',\n                        label: t('ac')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'mergeTableCellDown',\n                        label: t('ad')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'mergeTableCellLeft',\n                        label: t('ae')\n                    }\n                },\n                { type: 'separator' },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'splitTableCellVertically',\n                        label: t('af')\n                    }\n                },\n                {\n                    type: 'button',\n                    model: {\n                        commandName: 'splitTableCellHorizontally',\n                        label: t('ag')\n                    }\n                }\n            ];\n            return this._prepareDropdown(t('ah'), tableMergeCellIcon, options, locale);\n        });\n    }\n    /**\r\n\t * Creates a dropdown view from the set of options.\r\n\t *\r\n\t * @private\r\n\t * @param {String} label The dropdown button label.\r\n\t * @param {String} icon An icon for the dropdown button.\r\n\t * @param {Array.<module:ui/dropdown/utils~ListDropdownItemDefinition>} options The list of options for the dropdown.\r\n\t * @param {module:utils/locale~Locale} locale\r\n\t * @returns {module:ui/dropdown/dropdownview~DropdownView}\r\n\t */\n    _prepareDropdown(label, icon, options, locale) {\n        const editor = this.editor;\n        const dropdownView = createDropdown(locale);\n        const commands = [];\n        // Prepare dropdown list items for list dropdown.\n        const itemDefinitions = new Collection();\n        for (const option of options) {\n            addListOption(option, editor, commands, itemDefinitions);\n        }\n        addListToDropdown(dropdownView, itemDefinitions);\n        // Decorate dropdown's button.\n        dropdownView.buttonView.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        // Make dropdown button disabled when all options are disabled.\n        dropdownView.bind('isEnabled').toMany(commands, 'isEnabled', (...areEnabled) => {\n            return areEnabled.some(isEnabled => isEnabled);\n        });\n        this.listenTo(dropdownView, 'execute', evt => {\n            editor.execute(evt.source.commandName);\n            editor.editing.view.focus();\n        });\n        return dropdownView;\n    }\n}\n// Adds an option to a list view.\n//\n// @param {module:table/tableui~DropdownOption} option Configuration option.\n// @param {module:core/editor/editor~Editor} editor\n// @param {Array.<module:core/command~Command>} commands List of commands to update.\n// @param {Iterable.<module:ui/dropdown/utils~ListDropdownItemDefinition>} itemDefinitions\n// Collection of dropdown items to update with given option.\nfunction addListOption(option, editor, commands, itemDefinitions) {\n    const model = option.model = new Model(option.model);\n    const {commandName, bindIsOn} = option.model;\n    if (option.type !== 'separator') {\n        const command = editor.commands.get(commandName);\n        commands.push(command);\n        model.set({ commandName });\n        model.bind('isEnabled').to(command);\n        if (bindIsOn) {\n            model.bind('isOn').to(command, 'value');\n        }\n    }\n    model.set({ withText: true });\n    itemDefinitions.add(option);\n}","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n// The editor creator to use.\r\nimport ClassicEditorBase from '@ckeditor/ckeditor5-editor-classic/src/classiceditor';\r\n\r\nimport Essentials from '@ckeditor/ckeditor5-essentials/src/essentials';\r\nimport UploadAdapter from '@ckeditor/ckeditor5-adapter-ckfinder/src/uploadadapter';\r\nimport Autoformat from '@ckeditor/ckeditor5-autoformat/src/autoformat';\r\nimport Bold from '@ckeditor/ckeditor5-basic-styles/src/bold';\r\nimport Italic from '@ckeditor/ckeditor5-basic-styles/src/italic';\r\nimport BlockQuote from '@ckeditor/ckeditor5-block-quote/src/blockquote';\r\nimport CKFinder from '@ckeditor/ckeditor5-ckfinder/src/ckfinder';\r\nimport EasyImage from '@ckeditor/ckeditor5-easy-image/src/easyimage';\r\nimport Heading from '@ckeditor/ckeditor5-heading/src/heading';\r\nimport Image from '@ckeditor/ckeditor5-image/src/image';\r\nimport ImageCaption from '@ckeditor/ckeditor5-image/src/imagecaption';\r\nimport ImageStyle from '@ckeditor/ckeditor5-image/src/imagestyle';\r\nimport ImageToolbar from '@ckeditor/ckeditor5-image/src/imagetoolbar';\r\nimport ImageUpload from '@ckeditor/ckeditor5-image/src/imageupload';\r\nimport Link from '@ckeditor/ckeditor5-link/src/link';\r\nimport List from '@ckeditor/ckeditor5-list/src/list';\r\nimport MediaEmbed from '@ckeditor/ckeditor5-media-embed/src/mediaembed';\r\nimport Paragraph from '@ckeditor/ckeditor5-paragraph/src/paragraph';\r\nimport PasteFromOffice from '@ckeditor/ckeditor5-paste-from-office/src/pastefromoffice';\r\nimport Table from '@ckeditor/ckeditor5-table/src/table';\r\nimport TableToolbar from '@ckeditor/ckeditor5-table/src/tabletoolbar';\r\n\r\nexport default class ClassicEditor extends ClassicEditorBase {}\r\n\r\n// Plugins to include in the build.\r\nClassicEditor.builtinPlugins = [\r\n\tEssentials,\r\n\tUploadAdapter,\r\n\tAutoformat,\r\n\tBold,\r\n\tItalic,\r\n\tBlockQuote,\r\n\tCKFinder,\r\n\tEasyImage,\r\n\tHeading,\r\n\tImage,\r\n\tImageCaption,\r\n\tImageStyle,\r\n\tImageToolbar,\r\n\tImageUpload,\r\n\tLink,\r\n\tList,\r\n\tMediaEmbed,\r\n\tParagraph,\r\n\tPasteFromOffice,\r\n\tTable,\r\n\tTableToolbar\r\n];\r\n\r\n// Editor configuration.\r\nClassicEditor.defaultConfig = {\r\n\ttoolbar: {\r\n\t\titems: [\r\n\t\t\t'heading',\r\n\t\t\t'|',\r\n\t\t\t'bold',\r\n\t\t\t'italic',\r\n\t\t\t'link',\r\n\t\t\t'bulletedList',\r\n\t\t\t'numberedList',\r\n\t\t\t'imageUpload',\r\n\t\t\t'blockQuote',\r\n\t\t\t'insertTable',\r\n\t\t\t'mediaEmbed',\r\n\t\t\t'undo',\r\n\t\t\t'redo'\r\n\t\t]\r\n\t},\r\n\timage: {\r\n\t\ttoolbar: [\r\n\t\t\t'imageStyle:full',\r\n\t\t\t'imageStyle:side',\r\n\t\t\t'|',\r\n\t\t\t'imageTextAlternative'\r\n\t\t]\r\n\t},\r\n\ttable: {\r\n\t\tcontentToolbar: [\r\n\t\t\t'tableColumn',\r\n\t\t\t'tableRow',\r\n\t\t\t'mergeTableCells'\r\n\t\t]\r\n\t},\r\n\t// This value must be kept in sync with the language defined in webpack.config.js.\r\n\tlanguage: 'en'\r\n};\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module essentials/essentials\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport Clipboard from '@ckeditor/ckeditor5-clipboard/src/clipboard';\r\nimport Enter from '@ckeditor/ckeditor5-enter/src/enter';\r\nimport ShiftEnter from '@ckeditor/ckeditor5-enter/src/shiftenter';\r\nimport Typing from '@ckeditor/ckeditor5-typing/src/typing';\r\nimport Undo from '@ckeditor/ckeditor5-undo/src/undo';\r\n\r\n/**\r\n * A plugin including all essential editing features. It represents a set of features that enables similar functionalities\r\n * to a `<textarea>` element.\r\n *\r\n * It includes:\r\n *\r\n * * {@link module:clipboard/clipboard~Clipboard},\r\n * * {@link module:enter/enter~Enter},\r\n * * {@link module:enter/shiftenter~ShiftEnter},\r\n * * {@link module:typing/typing~Typing},\r\n * * {@link module:undo/undo~Undo}.\r\n *\r\n * This plugin set does not define any block-level containers (such as {@link module:paragraph/paragraph~Paragraph}).\r\n * If your editor is supposed to handle block content, make sure to include it.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Essentials extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ Clipboard, Enter, ShiftEnter, Typing, Undo ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Essentials';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module autoformat/autoformat\r\n */\r\n\r\nimport BlockAutoformatEditing from './blockautoformatediting';\r\nimport InlineAutoformatEditing from './inlineautoformatediting';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\n/**\r\n * Enables a set of predefined autoformatting actions.\r\n *\r\n * For a detailed overview, check the {@glink features/autoformat Autoformatting feature documentation}\r\n * and the {@glink api/autoformat package page}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Autoformat extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Autoformat';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tafterInit() {\r\n\t\tthis._addListAutoformats();\r\n\t\tthis._addBasicStylesAutoformats();\r\n\t\tthis._addHeadingAutoformats();\r\n\t\tthis._addBlockQuoteAutoformats();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds autoformatting related to the {@link module:list/list~List}.\r\n\t *\r\n\t * When typed:\r\n\t * - `* ` or `- ` &ndash; A paragraph will be changed to a bulleted list.\r\n\t * - `1. ` or `1) ` &ndash; A paragraph will be changed to a numbered list (\"1\" can be any digit or a list of digits).\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_addListAutoformats() {\r\n\t\tconst commands = this.editor.commands;\r\n\r\n\t\tif ( commands.get( 'bulletedList' ) ) {\r\n\t\t\t// eslint-disable-next-line no-new\r\n\t\t\tnew BlockAutoformatEditing( this.editor, /^[*-]\\s$/, 'bulletedList' );\r\n\t\t}\r\n\r\n\t\tif ( commands.get( 'numberedList' ) ) {\r\n\t\t\t// eslint-disable-next-line no-new\r\n\t\t\tnew BlockAutoformatEditing( this.editor, /^\\d+[.|)]\\s$/, 'numberedList' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds autoformatting related to the {@link module:basic-styles/bold~Bold},\r\n\t * {@link module:basic-styles/italic~Italic} and {@link module:basic-styles/code~Code}.\r\n\t *\r\n\t * When typed:\r\n\t * - `**foobar**` &ndash; `**` characters are removed and `foobar` is set to bold,\r\n\t * - `__foobar__` &ndash; `__` characters are removed and `foobar` is set to bold,\r\n\t * - `*foobar*` &ndash; `*` characters are removed and `foobar` is set to italic,\r\n\t * - `_foobar_` &ndash; `_` characters are removed and `foobar` is set to italic,\r\n\t * - ``` `foobar` &ndash; ``` ` ``` characters are removed and `foobar` is set to code.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_addBasicStylesAutoformats() {\r\n\t\tconst commands = this.editor.commands;\r\n\r\n\t\tif ( commands.get( 'bold' ) ) {\r\n\t\t\t/* eslint-disable no-new */\r\n\t\t\tnew InlineAutoformatEditing( this.editor, /(\\*\\*)([^*]+)(\\*\\*)$/g, 'bold' );\r\n\t\t\tnew InlineAutoformatEditing( this.editor, /(__)([^_]+)(__)$/g, 'bold' );\r\n\t\t\t/* eslint-enable no-new */\r\n\t\t}\r\n\r\n\t\tif ( commands.get( 'italic' ) ) {\r\n\t\t\t// The italic autoformatter cannot be triggered by the bold markers, so we need to check the\r\n\t\t\t// text before the pattern (e.g. `(?:^|[^\\*])`).\r\n\r\n\t\t\t/* eslint-disable no-new */\r\n\t\t\tnew InlineAutoformatEditing( this.editor, /(?:^|[^*])(\\*)([^*_]+)(\\*)$/g, 'italic' );\r\n\t\t\tnew InlineAutoformatEditing( this.editor, /(?:^|[^_])(_)([^_]+)(_)$/g, 'italic' );\r\n\t\t\t/* eslint-enable no-new */\r\n\t\t}\r\n\r\n\t\tif ( commands.get( 'code' ) ) {\r\n\t\t\t/* eslint-disable no-new */\r\n\t\t\tnew InlineAutoformatEditing( this.editor, /(`)([^`]+)(`)$/g, 'code' );\r\n\t\t\t/* eslint-enable no-new */\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds autoformatting related to {@link module:heading/heading~Heading}.\r\n\t *\r\n\t * It is using a number at the end of the command name to associate it with the proper trigger:\r\n\t *\r\n\t * * `heading` with value `heading1` will be executed when typing `#`,\r\n\t * * `heading` with value `heading2` will be executed when typing `##`,\r\n\t * * ... up to `heading6` and `######`.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_addHeadingAutoformats() {\r\n\t\tconst command = this.editor.commands.get( 'heading' );\r\n\r\n\t\tif ( command ) {\r\n\t\t\tcommand.modelElements\r\n\t\t\t\t.filter( name => name.match( /^heading[1-6]$/ ) )\r\n\t\t\t\t.forEach( commandValue => {\r\n\t\t\t\t\tconst level = commandValue[ 7 ];\r\n\t\t\t\t\tconst pattern = new RegExp( `^(#{${ level }})\\\\s$` );\r\n\r\n\t\t\t\t\t// eslint-disable-next-line no-new\r\n\t\t\t\t\tnew BlockAutoformatEditing( this.editor, pattern, () => {\r\n\t\t\t\t\t\tthis.editor.execute( 'heading', { value: commandValue } );\r\n\t\t\t\t\t} );\r\n\t\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds autoformatting related to {@link module:block-quote/blockquote~BlockQuote}.\r\n\t *\r\n\t * When typed:\r\n\t * * `> ` &ndash; A paragraph will be changed to a block quote.\r\n\t *\r\n\t * @private\r\n\t */\r\n\t_addBlockQuoteAutoformats() {\r\n\t\tif ( this.editor.commands.get( 'blockQuote' ) ) {\r\n\t\t\t// eslint-disable-next-line no-new\r\n\t\t\tnew BlockAutoformatEditing( this.editor, /^>\\s$/, 'blockQuote' );\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module basic-styles/bold\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport BoldEditing from './bold/boldediting';\r\nimport BoldUI from './bold/boldui';\r\n\r\n/**\r\n * The bold feature.\r\n *\r\n * For a detailed overview check the {@glink features/basic-styles Basic styles feature documentation}\r\n * and the {@glink api/basic-styles package page}.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:basic-styles/bold/boldediting~BoldEditing bold editing feature}\r\n * and {@link module:basic-styles/bold/boldui~BoldUI bold UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Bold extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ BoldEditing, BoldUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Bold';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module basic-styles/italic\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ItalicEditing from './italic/italicediting';\r\nimport ItalicUI from './italic/italicui';\r\n\r\n/**\r\n * The italic feature.\r\n *\r\n * For a detailed overview check the {@glink features/basic-styles Basic styles feature documentation}\r\n * and the {@glink api/basic-styles package page}.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:basic-styles/italic/italicediting~ItalicEditing} and\r\n * {@link module:basic-styles/italic/italicui~ItalicUI} plugins.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Italic extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ItalicEditing, ItalicUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Italic';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module block-quote/blockquote\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport BlockQuoteEditing from './blockquoteediting';\r\nimport BlockQuoteUI from './blockquoteui';\r\n\r\n/**\r\n * The block quote plugin.\r\n *\r\n * For more information about this feature check the {@glink api/block-quote package page}.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:block-quote/blockquoteediting~BlockQuoteEditing block quote editing feature}\r\n * and {@link module:block-quote/blockquoteui~BlockQuoteUI block quote UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class BlockQuote extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ BlockQuoteEditing, BlockQuoteUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'BlockQuote';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module ckfinder/ckfinder\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport CKFinderUI from './ckfinderui';\r\nimport CKFinderEditing from './ckfinderediting';\r\nimport CKFinderUploadAdapter from '@ckeditor/ckeditor5-adapter-ckfinder/src/uploadadapter';\r\n\r\n/**\r\n * The CKFinder feature, a bridge between the CKEditor 5 WYSIWYG editor and the\r\n * [CKFinder](https://ckeditor.com/ckfinder) file manager and uploader.\r\n *\r\n * This is a \"glue\" plugin which enables:\r\n *\r\n * * {@link module:ckfinder/ckfinderediting~CKFinderEditing},\r\n * * {@link module:ckfinder/ckfinderui~CKFinderUI},\r\n * * {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter}.\r\n *\r\n * See the {@glink features/ckfinder \"CKFinder integration\" guide} to learn how to configure\r\n * and use this feature.\r\n *\r\n * Check out the {@glink features/image-upload comprehensive \"Image upload\" guide} to learn about\r\n * other ways to upload images into CKEditor 5.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class CKFinder extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'CKFinder';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ CKFinderEditing, CKFinderUI, CKFinderUploadAdapter ];\r\n\t}\r\n}\r\n\r\n/**\r\n * The configuration of the {@link module:ckfinder/ckfinder~CKFinder CKFinder feature}.\r\n *\r\n * Read more in {@link module:ckfinder/ckfinder~CKFinderConfig}.\r\n *\r\n * @member {module:ckfinder/ckfinder~CKFinderConfig} module:core/editor/editorconfig~EditorConfig#ckfinder\r\n */\r\n\r\n/**\r\n * The configuration of the {@link module:ckfinder/ckfinder~CKFinder CKFinder feature}\r\n * and its {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter upload adapter}.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n *\t\t\t\tckfinder: {\r\n *\t\t\t\t\toptions: {\r\n *\t\t\t\t\t\tresourceType: 'Images'\r\n *\t\t\t\t\t}\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface CKFinderConfig\r\n */\r\n\r\n/**\r\n * The configuration options passed to the CKFinder file manager instance.\r\n *\r\n * Check the file manager {@glink @ckfinder ckfinder3/#!/api/CKFinder.Config documentation} for the complete list of options.\r\n *\r\n * @member {Object} module:ckfinder/ckfinder~CKFinderConfig#options\r\n */\r\n\r\n/**\r\n * The type of the CKFinder opener method.\r\n *\r\n * Supported types are:\r\n *\r\n * * `'modal'` - opens a CKFinder in a modal,\r\n * * `'popup'` - opens a CKFinder in a new \"pop-up\" window.\r\n *\r\n * Defaults to `'modal'`.\r\n *\r\n * @member {String} module:ckfinder/ckfinder~CKFinderConfig#openerMethod\r\n */\r\n\r\n/**\r\n * The path (URL) to the connector which handles the file upload in the CKFinder file manager.\r\n * When specified, enables the automatic upload of resources such as images inserted into the content.\r\n *\r\n * For instance, to use CKFinder's {@glink @ckfinder ckfinder3-php/commands.html#command_quick_upload quick upload}\r\n * command, your can use the following (or similar) path:\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n *\t\t\t\tckfinder: {\r\n *\t\t\t\t\tuploadUrl: '/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Files&responseType=json'\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * Used by the {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter upload adapter}.\r\n *\r\n * @member {String} module:ckfinder/ckfinder~CKFinderConfig#uploadUrl\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module easy-image/easyimage\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport CloudServicesUploadAdapter from './cloudservicesuploadadapter';\r\nimport Image from '@ckeditor/ckeditor5-image/src/image';\r\nimport ImageUpload from '@ckeditor/ckeditor5-image/src/imageupload';\r\n\r\n/**\r\n * The Easy Image feature, which makes the image upload in CKEditor 5 possible with virtually zero\r\n * server setup. A part of the [CKEditor Cloud Services](https://ckeditor.com/ckeditor-cloud-services/)\r\n * family.\r\n *\r\n * This is a \"glue\" plugin which enables:\r\n *\r\n * * {@link module:image/image~Image},\r\n * * {@link module:image/imageupload~ImageUpload},\r\n * * {@link module:easy-image/cloudservicesuploadadapter~CloudServicesUploadAdapter}.\r\n *\r\n * See the {@glink features/easy-image \"Easy Image integration\" guide} to learn how to configure\r\n * and use this feature.\r\n *\r\n * Check out the {@glink features/image-upload comprehensive \"Image upload\" guide} to learn about\r\n * other ways to upload images into CKEditor 5.\r\n *\r\n * **Note**: After enabling the Easy Image plugin you need to configure the\r\n * [CKEditor Cloud Services](https://ckeditor.com/ckeditor-cloud-services/)\r\n * integration through {@link module:cloud-services/cloudservices~CloudServicesConfig `config.cloudServices`}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class EasyImage extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [\r\n\t\t\tCloudServicesUploadAdapter,\r\n\t\t\tImage,\r\n\t\t\tImageUpload\r\n\t\t];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'EasyImage';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module heading/heading\r\n */\r\n\r\nimport HeadingEditing from './headingediting';\r\nimport HeadingUI from './headingui';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport '../theme/heading.css';\r\n\r\n/**\r\n * The headings feature.\r\n *\r\n * For a detailed overview, check the {@glink features/headings Headings feature documentation}\r\n * and the {@glink api/heading package page}.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:heading/headingediting~HeadingEditing heading editing feature}\r\n * and {@link module:heading/headingui~HeadingUI heading UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Heading extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ HeadingEditing, HeadingUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Heading';\r\n\t}\r\n}\r\n\r\n/**\r\n * The configuration of the heading feature. Introduced by the {@link module:heading/headingediting~HeadingEditing} feature.\r\n *\r\n * Read more in {@link module:heading/heading~HeadingConfig}.\r\n *\r\n * @member {module:heading/heading~HeadingConfig} module:core/editor/editorconfig~EditorConfig#heading\r\n */\r\n\r\n/**\r\n * The configuration of the heading feature.\r\n * The option is used by the {@link module:heading/headingediting~HeadingEditing} feature.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( {\r\n * \t\t\t\theading: ... // Heading feature config.\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface HeadingConfig\r\n */\r\n\r\n/**\r\n * The available heading options.\r\n *\r\n * The default value is:\r\n *\r\n *\t\tconst headingConfig = {\r\n *\t\t\toptions: [\r\n *\t\t\t\t{ model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },\r\n *\t\t\t\t{ model: 'heading1', view: 'h2', title: 'Heading 1', class: 'ck-heading_heading1' },\r\n *\t\t\t\t{ model: 'heading2', view: 'h3', title: 'Heading 2', class: 'ck-heading_heading2' },\r\n *\t\t\t\t{ model: 'heading3', view: 'h4', title: 'Heading 3', class: 'ck-heading_heading3' }\r\n *\t\t\t]\r\n *\t\t};\r\n *\r\n * It defines 3 levels of headings. In the editor model they will use `heading1`, `heading2`, and `heading3` elements.\r\n * Their respective view elements (so the elements output by the editor) will be: `h2`, `h3`, and `h4`. This means that\r\n * if you choose \"Heading 1\" in the headings dropdown the editor will turn the current block to `<heading1>` in the model\r\n * which will result in rendering (and outputting to data) the `<h2>` element.\r\n *\r\n * The `title` and `class` properties will be used by the `headings` dropdown to render available options.\r\n * Usually, the first option in the headings dropdown is the \"Paragraph\" option, hence it's also defined on the list.\r\n * However, you don't need to define its view representation because it's handled by\r\n * the {@link module:paragraph/paragraph~Paragraph} feature (which is required by\r\n * the {@link module:heading/headingediting~HeadingEditing} feature).\r\n *\r\n * You can **read more** about configuring heading levels and **see more examples** in\r\n * the {@glink features/headings Headings} guide.\r\n *\r\n * Note: In the model you should always start from `heading1`, regardless of how the headings are represented in the view.\r\n * That's assumption is used by features like {@link module:autoformat/autoformat~Autoformat} to know which element\r\n * they should use when applying the first level heading.\r\n *\r\n * The defined headings are also available as values passed to the `'heading'` command under their model names.\r\n * For example, the below code will apply `<heading1>` to the current selection:\r\n *\r\n *\t\teditor.execute( 'heading', { value: 'heading1' } );\r\n *\r\n * @member {Array.<module:heading/heading~HeadingOption>} module:heading/heading~HeadingConfig#options\r\n */\r\n\r\n/**\r\n * Heading option descriptor.\r\n *\r\n * @typedef {Object} module:heading/heading~HeadingOption\r\n * @property {String} model Name of the model element to convert.\r\n * @property {module:engine/view/elementdefinition~ElementDefinition} view Definition of a view element to convert from/to.\r\n * @property {String} title The user-readable title of the option.\r\n * @property {String} class The class which will be added to the dropdown item representing this option.\r\n * @property {String} [icon] Icon used by {@link module:heading/headingbuttonsui~HeadingButtonsUI}. It can be omitted when using\r\n * the default configuration.\r\n * @extends module:engine/conversion/conversion~ConverterDefinition\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagecaption\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageCaptionEditing from './imagecaption/imagecaptionediting';\r\n\r\nimport '../theme/imagecaption.css';\r\n\r\n/**\r\n * The image caption plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image#image-captions image caption} documentation.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageCaption extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageCaptionEditing ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageCaption';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagestyle\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport ImageStyleEditing from './imagestyle/imagestyleediting';\r\nimport ImageStyleUI from './imagestyle/imagestyleui';\r\n\r\n/**\r\n * The image style plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/image#image-styles image styles} documentation.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:image/imagestyle/imagestyleediting~ImageStyleEditing}\r\n * and {@link module:image/imagestyle/imagestyleui~ImageStyleUI} plugins.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageStyle extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ImageStyleEditing, ImageStyleUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageStyle';\r\n\t}\r\n}\r\n\r\n/**\r\n * Available image styles.\r\n *\r\n * The default value is:\r\n *\r\n *\t\tconst imageConfig = {\r\n *\t\t\tstyles: [ 'full', 'side' ]\r\n *\t\t};\r\n *\r\n * which configures two default styles:\r\n *\r\n *  * the \"full\" style which does not apply any class, e.g. for images styled to span 100% width of the content,\r\n *  * the \"side\" style with the `.image-style-side` CSS class.\r\n *\r\n * See {@link module:image/imagestyle/utils~defaultStyles} to learn more about default\r\n * styles provided by the image feature.\r\n *\r\n * The {@link module:image/imagestyle/utils~defaultStyles default styles} can be customized,\r\n * e.g. to change the icon, title or CSS class of the style. The feature also provides several\r\n * {@link module:image/imagestyle/utils~defaultIcons default icons} to choose from.\r\n *\r\n *\t\timport customIcon from 'custom-icon.svg';\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tconst imageConfig = {\r\n *\t\t\tstyles: [\r\n *\t\t\t\t// This will only customize the icon of the \"full\" style.\r\n *\t\t\t\t// Note: 'right' is one of default icons provided by the feature.\r\n *\t\t\t\t{ name: 'full', icon: 'right' },\r\n *\r\n *\t\t\t\t// This will customize the icon, title and CSS class of the default \"side\" style.\r\n *\t\t\t\t{ name: 'side', icon: customIcon, title: 'My side style', className: 'custom-side-image' }\r\n *\t\t\t]\r\n *\t\t};\r\n *\r\n * If none of the default styles is good enough, it is possible to define independent custom styles, too:\r\n *\r\n *\t\timport fullSizeIcon from '@ckeditor/ckeditor5-core/theme/icons/object-center.svg';\r\n *\t\timport sideIcon from '@ckeditor/ckeditor5-core/theme/icons/object-right.svg';\r\n *\r\n *\t\t// ...\r\n *\r\n *\t\tconst imageConfig = {\r\n *\t\t\tstyles: [\r\n *\t\t\t\t// A completely custom full size style with no class, used as a default.\r\n *\t\t\t\t{ name: 'fullSize', title: 'Full size', icon: fullSizeIcon, isDefault: true },\r\n *\r\n *\t\t\t\t{ name: 'side', title: 'To the side', icon: sideIcon, className: 'side-image' }\r\n *\t\t\t]\r\n *\t\t};\r\n *\r\n * Note: Setting `title` to one of {@link module:image/imagestyle/imagestyleui~ImageStyleUI#localizedDefaultStylesTitles}\r\n * will automatically translate it to the language of the editor.\r\n *\r\n * Read more about styling images in the {@glink features/image#image-styles Image styles guide}.\r\n *\r\n * The feature creates commands based on defined styles, so you can change the style of a selected image by executing\r\n * the following command:\r\n *\r\n *\t\teditor.execute( 'imageStyle' { value: 'side' } );\r\n *\r\n * The feature also creates buttons that execute the commands. So, assuming that you use the\r\n * default image styles setting, you can {@link module:image/image~ImageConfig#toolbar configure the image toolbar}\r\n * (or any other toolbar) to contain these options:\r\n *\r\n *\t\tconst imageConfig = {\r\n *\t\t\ttoolbar: [ 'imageStyle:full', 'imageStyle:side' ]\r\n *\t\t};\r\n *\r\n * @member {Array.<module:image/imagestyle/imagestyleediting~ImageStyleFormat>} module:image/image~ImageConfig#styles\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module image/imagetoolbar\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport { isImageWidgetSelected } from './image/utils';\r\nimport WidgetToolbarRepository from '@ckeditor/ckeditor5-widget/src/widgettoolbarrepository';\r\n\r\n/**\r\n * The image toolbar plugin. It creates and manages the image toolbar (the toolbar displayed when an image is selected).\r\n *\r\n * For a detailed overview, check the {@glink features/image#image-contextual-toolbar image contextual toolbar} documentation.\r\n *\r\n * Instances of toolbar components (e.g. buttons) are created using the editor's\r\n * {@link module:ui/componentfactory~ComponentFactory component factory}\r\n * based on the {@link module:image/image~ImageConfig#toolbar `image.toolbar` configuration option}.\r\n *\r\n * The toolbar uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class ImageToolbar extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ WidgetToolbarRepository ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'ImageToolbar';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tafterInit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst widgetToolbarRepository = editor.plugins.get( WidgetToolbarRepository );\r\n\r\n\t\twidgetToolbarRepository.register( 'image', {\r\n\t\t\titems: editor.config.get( 'image.toolbar' ) || [],\r\n\t\t\tvisibleWhen: isImageWidgetSelected,\r\n\t\t} );\r\n\t}\r\n}\r\n\r\n/**\r\n * Items to be placed in the image toolbar.\r\n * This option is used by the {@link module:image/imagetoolbar~ImageToolbar} feature.\r\n *\r\n * Assuming that you use the following features:\r\n *\r\n * * {@link module:image/imagestyle~ImageStyle} (with a default configuration),\r\n * * {@link module:image/imagetextalternative~ImageTextAlternative},\r\n *\r\n * three toolbar items will be available in {@link module:ui/componentfactory~ComponentFactory}:\r\n * `'imageStyle:full'`, `'imageStyle:side'`, and `'imageTextAlternative'` so you can configure the toolbar like this:\r\n *\r\n *\t\tconst imageConfig = {\r\n *\t\t\ttoolbar: [ 'imageStyle:full', 'imageStyle:side', '|', 'imageTextAlternative' ]\r\n *\t\t};\r\n *\r\n * Of course, the same buttons can also be used in the\r\n * {@link module:core/editor/editorconfig~EditorConfig#toolbar main editor toolbar}.\r\n *\r\n * Read more about configuring toolbar in {@link module:core/editor/editorconfig~EditorConfig#toolbar}.\r\n *\r\n * @member {Array.<String>} module:image/image~ImageConfig#toolbar\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module link/link\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport LinkEditing from './linkediting';\r\nimport LinkUI from './linkui';\r\n\r\n/**\r\n * The link plugin.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:link/linkediting~LinkEditing link editing feature}\r\n * and {@link module:link/linkui~LinkUI link UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Link extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ LinkEditing, LinkUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Link';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module list/list\r\n */\r\n\r\nimport ListEditing from './listediting';\r\nimport ListUI from './listui';\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\n/**\r\n * The list feature.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:list/listediting~ListEditing list editing feature}\r\n * and {@link module:list/listui~ListUI list UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class List extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ ListEditing, ListUI ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'List';\r\n\t}\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module media-embed/mediaembed\r\n */\r\n\r\nimport MediaEmbedEditing from './mediaembedediting';\r\nimport AutoMediaEmbed from './automediaembed';\r\nimport MediaEmbedUI from './mediaembedui';\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Widget from '@ckeditor/ckeditor5-widget/src/widget';\r\n\r\nimport '../theme/mediaembed.css';\r\n\r\n/**\r\n * The media embed plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/media-embed Media Embed feature documentation}.\r\n *\r\n * This is a \"glue\" plugin which loads the following plugins:\r\n *\r\n * * The {@link module:media-embed/mediaembedediting~MediaEmbedEditing media embed editing feature},\r\n * * The {@link module:media-embed/mediaembedui~MediaEmbedUI media embed UI feature} and\r\n * * The {@link module:media-embed/automediaembed~AutoMediaEmbed auto-media embed feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class MediaEmbed extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ MediaEmbedEditing, MediaEmbedUI, AutoMediaEmbed, Widget ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'MediaEmbed';\r\n\t}\r\n}\r\n\r\n/**\r\n * The media embed provider descriptor. Used in\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#providers `config.mediaEmbed.providers`} and\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#extraProviders `config.mediaEmbed.extraProviders`}.\r\n *\r\n * See {@link module:media-embed/mediaembed~MediaEmbedConfig} to learn more.\r\n *\r\n *\t\t{\r\n *\t\t\tname: 'example',\r\n *\r\n *\t\t\t// The following RegExp matches https://www.example.com/media/{media id},\r\n *\t\t\t// (either with \"http(s)://\" and \"www\" or without), so the valid URLs are:\r\n *\t\t\t//\r\n *\t\t\t// * https://www.example.com/media/{media id},\r\n *\t\t\t// * http://www.example.com/media/{media id},\r\n *\t\t\t// * www.example.com/media/{media id},\r\n *\t\t\t// * example.com/media/{media id}\r\n *\t\t\turl: /^example\\.com\\/media\\/(\\w+)/,\r\n *\r\n *\t\t\t// The rendering function of the provider.\r\n *\t\t\t// Used to represent the media when editing the content (i.e. in the view)\r\n *\t\t\t// and also in the data output of the editor if semantic data output is disabled.\r\n *\t\t\thtml: match => `The HTML representing the media with ID=${ match[ 1 ] }.`\r\n *\t\t}\r\n *\r\n * You can allow any sort of media in the editor using the \"allow–all\" `RegExp`.\r\n * But mind that, since URLs are processed in the order of configuration, if one of the previous\r\n * `RegExps` matches the URL, it will have a precedence over this one.\r\n *\r\n *\t\t{\r\n *\t\t\tname: 'allow-all',\r\n *\t\t\turl: /^.+/\r\n *\t\t}\r\n *\r\n * To implement responsive media, you can use the following HTML structure:\r\n *\r\n *\t\t{\r\n *\t\t\t...\r\n *\t\t\thtml: match =>\r\n *\t\t\t\t'<div style=\"position:relative; padding-bottom:100%; height:0\">' +\r\n *\t\t\t\t\t'<iframe src=\"...\" frameborder=\"0\" ' +\r\n *\t\t\t\t\t\t'style=\"position:absolute; width:100%; height:100%; top:0; left:0\">' +\r\n *\t\t\t\t\t'</iframe>' +\r\n *\t\t\t\t'</div>'\r\n *\t\t}\r\n *\r\n * @typedef {Object} module:media-embed/mediaembed~MediaEmbedProvider\r\n * @property {String} name The name of the provider. Used e.g. when\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#removeProviders removing providers}.\r\n * @property {RegExp|Array.<RegExp>} url The `RegExp` object (or array of objects) defining the URL of the media.\r\n * If any URL matches the `RegExp`, it becomes the media in the editor model, as defined by the provider. The result\r\n * of matching (output of `String.prototype.match()`) is passed to the `html` rendering function of the media.\r\n *\r\n * **Note:** You do not need to include the protocol (`http://`, `https://`) and `www` subdomain in your `RegExps`,\r\n * they are stripped from the URLs before matching anyway.\r\n * @property {Function} [html] (optional) The rendering function of the media. The function receives the entire matching\r\n * array from the corresponding `url` `RegExp` as an argument, allowing rendering a dedicated\r\n * preview of the media identified by a certain ID or a hash. When not defined, the media embed feature\r\n * will use a generic media representation in the view and output data.\r\n * Note that when\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#previewsInData `config.mediaEmbed.previewsInData`}\r\n * is `true`, the rendering function **will always** be used for the media in the editor data output.\r\n */\r\n\r\n/**\r\n * The configuration of the {@link module:media-embed/mediaembed~MediaEmbed} feature.\r\n *\r\n * Read more in {@link module:media-embed/mediaembed~MediaEmbedConfig}.\r\n *\r\n * @member {module:media-embed/mediaembed~MediaEmbedConfig} module:core/editor/editorconfig~EditorConfig#mediaEmbed\r\n */\r\n\r\n/**\r\n * The configuration of the media embed features.\r\n *\r\n * Read more about {@glink features/media-embed#configuration configuring the media embed feature}.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n * \t\t\t\tmediaEmbed: ... // Media embed feature options.\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface MediaEmbedConfig\r\n */\r\n\r\n/**\r\n * The default media providers supported by the editor.\r\n *\r\n * The names of providers with rendering functions (previews):\r\n *\r\n * * \"dailymotion\",\r\n * * \"spotify\",\r\n * * \"youtube\",\r\n * * \"vimeo\"\r\n *\r\n * The names of providers without rendering functions:\r\n *\r\n * * \"instagram\",\r\n * * \"twitter\",\r\n * * \"googleMaps\",\r\n * * \"flickr\",\r\n * * \"facebook\"\r\n *\r\n * See the {@link module:media-embed/mediaembed~MediaEmbedProvider provider syntax} to learn more about\r\n * different kinds of media and media providers.\r\n *\r\n * **Note**: The default media provider configuration may not support all possible media URLs,\r\n * only the most common are included.\r\n *\r\n * Media without rendering functions are always represented in the data using the \"semantic\" markup. See\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#previewsInData `config.mediaEmbed.previewsInData`} to\r\n * learn more about possible data outputs.\r\n *\r\n * The priority of media providers corresponds to the order of configuration. The first provider\r\n * to match the URL is always used, even if there are other providers that support a particular URL.\r\n * The URL is never matched against the remaining providers.\r\n *\r\n * To discard **all** default media providers, simply override this configuration with your own\r\n * {@link module:media-embed/mediaembed~MediaEmbedProvider definitions}:\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n *\t\t\t\tplugins: [ MediaEmbed, ... ],\r\n *\t\t\t\tmediaEmbed: {\r\n *\t\t\t\t\tproviders: [\r\n *\t\t\t\t\t\t{\r\n *\t\t\t\t\t\t\t name: 'myProvider',\r\n *\t\t\t\t\t\t\t url: /^example\\.com\\/media\\/(\\w+)/,\r\n *\t\t\t\t\t\t\t html: match => '...'\r\n *\t\t\t\t\t\t},\r\n *\t\t\t\t\t\t...\r\n * \t\t\t\t\t]\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * You can take inspiration from the default configuration of this feature which you can find in:\r\n * https://github.com/ckeditor/ckeditor5-media-embed/blob/master/src/mediaembedediting.js\r\n *\r\n * To **extend** the list of default providers, use\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#extraProviders `config.mediaEmbed.extraProviders`}.\r\n *\r\n * To **remove** certain providers, use\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#removeProviders `config.mediaEmbed.removeProviders`}.\r\n *\r\n * @member {Array.<module:media-embed/mediaembed~MediaEmbedProvider>} module:media-embed/mediaembed~MediaEmbedConfig#providers\r\n */\r\n\r\n/**\r\n * The additional media providers supported by the editor. This configuration helps extend the default\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#providers}.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n *\t\t\t\tplugins: [ MediaEmbed, ... ],\r\n *\t\t\t\tmediaEmbed: {\r\n *\t\t\t\t\textraProviders: [\r\n *\t\t\t\t\t\t{\r\n *\t\t\t\t\t\t\t name: 'extraProvider',\r\n *\t\t\t\t\t\t\t url: /^example\\.com\\/media\\/(\\w+)/,\r\n *\t\t\t\t\t\t\t html: match => '...'\r\n *\t\t\t\t\t\t},\r\n *\t\t\t\t\t\t...\r\n * \t\t\t\t\t]\r\n *\t\t\t\t}\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See the {@link module:media-embed/mediaembed~MediaEmbedProvider provider syntax} to learn more.\r\n *\r\n * @member {Array.<module:media-embed/mediaembed~MediaEmbedProvider>} module:media-embed/mediaembed~MediaEmbedConfig#extraProviders\r\n */\r\n\r\n/**\r\n * The list of media providers that should not be used despite being available in\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#providers `config.mediaEmbed.providers`} and\r\n * {@link module:media-embed/mediaembed~MediaEmbedConfig#extraProviders `config.mediaEmbed.extraProviders`}\r\n *\r\n *\t\tmediaEmbed: {\r\n *\t\t\tremoveProviders: [ 'youtube', 'twitter' ]\r\n *\t\t}\r\n *\r\n * @member {Array.<String>} module:media-embed/mediaembed~MediaEmbedConfig#removeProviders\r\n */\r\n\r\n/**\r\n * Controls the data format produced by the feature.\r\n *\r\n * When `false` (default), the feature produces \"semantic\" data, i.e. it does not include the preview of\r\n * the media, just the `<oembed>` tag with the `url` attribute:\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<oembed url=\"https://url\"></oembed>\r\n *\t\t</figure>\r\n *\r\n * When `true`, the media is represented in the output in the same way it looks in the editor,\r\n * i.e. the media preview is saved to the database:\r\n *\r\n *\t\t<figure class=\"media\">\r\n *\t\t\t<div data-oembed-url=\"https://url\">\r\n *\t\t\t\t<iframe src=\"https://preview\"></iframe>\r\n *\t\t\t</div>\r\n *\t\t</figure>\r\n *\r\n * **Note:** Media without preview are always represented in the data using the \"semantic\" markup\r\n * regardless of the value of the `previewsInData`. Learn more about different kinds of media\r\n * in the {@link module:media-embed/mediaembed~MediaEmbedConfig#providers `config.mediaEmbed.providers`}\r\n * configuration description.\r\n *\r\n * @member {Boolean} [module:media-embed/mediaembed~MediaEmbedConfig#previewsInData=false]\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module paste-from-office/pastefromoffice\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport Clipboard from '@ckeditor/ckeditor5-clipboard/src/clipboard';\r\n\r\nimport { parseHtml } from './filters/parse';\r\nimport { transformListItemLikeElementsIntoLists } from './filters/list';\r\nimport { replaceImagesSourceWithBase64 } from './filters/image';\r\n\r\n/**\r\n * The Paste from Office plugin.\r\n *\r\n * This plugin handles content pasted from Office apps (for now only Word) and transforms it (if necessary)\r\n * to a valid structure which can then be understood by the editor features.\r\n *\r\n * For more information about this feature check the {@glink api/paste-from-office package page}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class PasteFromOffice extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'PasteFromOffice';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tinit() {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\tthis.listenTo( editor.plugins.get( Clipboard ), 'inputTransformation', ( evt, data ) => {\r\n\t\t\tconst html = data.dataTransfer.getData( 'text/html' );\r\n\r\n\t\t\tif ( data.pasteFromOfficeProcessed !== true && isWordInput( html ) ) {\r\n\t\t\t\tdata.content = this._normalizeWordInput( html, data.dataTransfer );\r\n\r\n\t\t\t\t// Set the flag so if `inputTransformation` is re-fired, PFO will not process it again (#44).\r\n\t\t\t\tdata.pasteFromOfficeProcessed = true;\r\n\t\t\t}\r\n\t\t}, { priority: 'high' } );\r\n\t}\r\n\r\n\t/**\r\n\t * Normalizes input pasted from Word to format suitable for editor {@link module:engine/model/model~Model}.\r\n\t *\r\n\t * **Note**: this function was exposed mainly for testing purposes and should not be called directly.\r\n\t *\r\n\t * @protected\r\n\t * @param {String} input Word input.\r\n\t * @param {module:clipboard/datatransfer~DataTransfer} dataTransfer Data transfer instance.\r\n\t * @returns {module:engine/view/documentfragment~DocumentFragment} Normalized input.\r\n\t */\r\n\t_normalizeWordInput( input, dataTransfer ) {\r\n\t\tconst { body, stylesString } = parseHtml( input );\r\n\r\n\t\ttransformListItemLikeElementsIntoLists( body, stylesString );\r\n\t\treplaceImagesSourceWithBase64( body, dataTransfer.getData( 'text/rtf' ) );\r\n\r\n\t\treturn body;\r\n\t}\r\n}\r\n\r\n// Checks if given HTML string is a result of pasting content from Word.\r\n//\r\n// @param {String} html HTML string to test.\r\n// @returns {Boolean} True if given HTML string is a Word HTML.\r\nfunction isWordInput( html ) {\r\n\treturn !!( html && ( html.match( /<meta\\s*name=\"?generator\"?\\s*content=\"?microsoft\\s*word\\s*\\d+\"?\\/?>/gi ) ||\r\n\t\thtml.match( /xmlns:o=\"urn:schemas-microsoft-com/gi ) ) );\r\n}\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/table\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\n\r\nimport TableEditing from './tableediting';\r\nimport TableUI from './tableui';\r\nimport Widget from '@ckeditor/ckeditor5-widget/src/widget';\r\n\r\nimport '../theme/table.css';\r\n\r\n/**\r\n * The table plugin.\r\n *\r\n * For a detailed overview, check the {@glink features/table Table feature documentation}.\r\n *\r\n * This is a \"glue\" plugin which loads the {@link module:table/tableediting~TableEditing table editing feature}\r\n * and {@link module:table/tableui~TableUI table UI feature}.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class Table extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ TableEditing, TableUI, Widget ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'Table';\r\n\t}\r\n}\r\n\r\n/**\r\n * The configuration of the table features. Used by the table features in the `@ckeditor/ckeditor5-table` package.\r\n *\r\n *\t\tClassicEditor\r\n *\t\t\t.create( editorElement, {\r\n * \t\t\t\ttable: ... // Table feature options.\r\n *\t\t\t} )\r\n *\t\t\t.then( ... )\r\n *\t\t\t.catch( ... );\r\n *\r\n * See {@link module:core/editor/editorconfig~EditorConfig all editor options}.\r\n *\r\n * @interface TableConfig\r\n */\r\n","/**\r\n * @license Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.\r\n * For licensing, see LICENSE.md.\r\n */\r\n\r\n/**\r\n * @module table/tabletoolbar\r\n */\r\n\r\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\r\nimport { isTableContentSelected, isTableWidgetSelected } from './utils';\r\nimport WidgetToolbarRepository from '@ckeditor/ckeditor5-widget/src/widgettoolbarrepository';\r\n\r\n/**\r\n * The table toolbar class. It creates toolbars for the table feature and its content (for now only for a table cell content).\r\n *\r\n * Table toolbar shows up when a table widget is selected. Its components (e.g. buttons) are created based on the\r\n * {@link module:table/table~TableConfig#toolbar `table.tableToolbar` configuration option}.\r\n *\r\n * Table content toolbar shows up when the selection is inside the content of a table. It creates its component based on the\r\n * {@link module:table/table~TableConfig#contentToolbar `table.contentToolbar` configuration option}.\r\n *\r\n * Note that the old {@link module:table/table~TableConfig#toolbar `table.toolbar` configuration option} is deprecated\r\n * and will be removed in the next major release.\r\n *\r\n * @extends module:core/plugin~Plugin\r\n */\r\nexport default class TableToolbar extends Plugin {\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get requires() {\r\n\t\treturn [ WidgetToolbarRepository ];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic get pluginName() {\r\n\t\treturn 'TableToolbar';\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tafterInit() {\r\n\t\tconst editor = this.editor;\r\n\t\tconst widgetToolbarRepository = editor.plugins.get( WidgetToolbarRepository );\r\n\r\n\t\tconst tableContentToolbarItems = editor.config.get( 'table.contentToolbar' );\r\n\t\tconst deprecatedTableContentToolbarItems = editor.config.get( 'table.toolbar' );\r\n\r\n\t\tconst tableToolbarItems = editor.config.get( 'table.tableToolbar' );\r\n\r\n\t\tif ( deprecatedTableContentToolbarItems ) {\r\n\t\t\t// eslint-disable-next-line\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'`config.table.toolbar` is deprecated and will be removed in the next major release.' +\r\n\t\t\t\t' Use `config.table.contentToolbar` instead.'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ( tableContentToolbarItems || deprecatedTableContentToolbarItems ) {\r\n\t\t\twidgetToolbarRepository.register( 'tableContent', {\r\n\t\t\t\titems: tableContentToolbarItems || deprecatedTableContentToolbarItems,\r\n\t\t\t\tvisibleWhen: isTableContentSelected,\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\tif ( tableToolbarItems ) {\r\n\t\t\twidgetToolbarRepository.register( 'table', {\r\n\t\t\t\titems: tableToolbarItems,\r\n\t\t\t\tvisibleWhen: isTableWidgetSelected,\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Items to be placed in the table content toolbar.\r\n *\r\n * **Note:** This configuration option is deprecated! Use {@link module:table/table~TableConfig#contentToolbar} instead.\r\n *\r\n * Read more about configuring toolbar in {@link module:core/editor/editorconfig~EditorConfig#toolbar}.\r\n *\r\n * @deprecated\r\n * @member {Array.<String>} module:table/table~TableConfig#toolbar\r\n */\r\n\r\n/**\r\n * Items to be placed in the table content toolbar.\r\n * The {@link module:table/tabletoolbar~TableToolbar} plugin is required to make this toolbar working.\r\n *\r\n * Assuming that you use the {@link module:table/tableui~TableUI} feature, the following toolbar items will be available\r\n * in {@link module:ui/componentfactory~ComponentFactory}:\r\n *\r\n * * `'tableRow'`,\r\n * * `'tableColumn'`,\r\n * * `'mergeTableCells'`.\r\n *\r\n * You can thus configure the toolbar like this:\r\n *\r\n *\t\tconst tableConfig = {\r\n *\t\t\tcontentToolbar: [ 'tableRow', 'tableColumn', 'mergeTableCells' ]\r\n *\t\t};\r\n *\r\n * Of course, the same buttons can also be used in the\r\n * {@link module:core/editor/editorconfig~EditorConfig#toolbar main editor toolbar}.\r\n *\r\n * Read more about configuring toolbar in {@link module:core/editor/editorconfig~EditorConfig#toolbar}.\r\n *\r\n * @member {Array.<String>} module:table/table~TableConfig#contentToolbar\r\n */\r\n\r\n/**\r\n * Items to be placed in the table toolbar.\r\n * The {@link module:table/tabletoolbar~TableToolbar} plugin is required to make this toolbar working.\r\n *\r\n * You can thus configure the toolbar like this:\r\n *\r\n *\t\tconst tableConfig = {\r\n *\t\t\ttableToolbar: [ 'blockQuote' ]\r\n *\t\t};\r\n *\r\n * Of course, the same buttons can also be used in the\r\n * {@link module:core/editor/editorconfig~EditorConfig#toolbar main editor toolbar}.\r\n *\r\n * Read more about configuring toolbar in {@link module:core/editor/editorconfig~EditorConfig#toolbar}.\r\n *\r\n * @member {Array.<String>} module:table/table~TableConfig#tableToolbar\r\n */\r\n"],"sourceRoot":""}